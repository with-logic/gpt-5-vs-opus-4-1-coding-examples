<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Countdown</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            background-color: #000;
            color: white;
            height: 100vh;
        }

        /* Parallax Background */
        .bg-layer {
            position: absolute;
            top: -5%;
            left: -5%;
            width: 110%;
            height: 110%;
            background-size: cover;
            background-position: center;
            /* Default Image */
            background-image: url('https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=2070&auto=format&fit=crop'); 
            filter: brightness(0.5);
            z-index: 0;
            transition: transform 0.1s linear;
        }

        .container {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        /* Edit Panel */
        .edit-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
            backdrop-filter: blur(5px);
            transition: opacity 0.3s;
        }
        
        .edit-panel.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .toggle-edit {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 101;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.5;
        }
        
        .toggle-edit:hover { opacity: 1; }

        input, button {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #222;
            color: white;
            font-family: inherit;
        }
        
        button { cursor: pointer; background: #007aff; border-color: #007aff; font-weight: bold; }
        button:hover { background: #0056b3; }

        /* Typography */
        h1 {
            font-size: 5vw;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 5px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .location {
            font-size: 1.5vw;
            margin-top: 10px;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .timer {
            display: flex;
            gap: 4vw;
            margin-top: 5vh;
        }

        .time-block {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .number {
            font-size: 8vw;
            font-weight: 900;
            line-height: 1;
            text-shadow: 0 5px 15px rgba(0,0,0,0.5);
            font-variant-numeric: tabular-nums;
        }

        .label {
            font-size: 1.2vw;
            text-transform: uppercase;
            opacity: 0.8;
            margin-top: 10px;
        }

        /* Action */
        .action-btn {
            margin-top: 5vh;
            padding: 15px 30px;
            font-size: 1.2rem;
            background: white;
            color: black;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: 700;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        
        .action-btn:hover { transform: scale(1.05); }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 3rem; }
            .location { font-size: 1rem; }
            .timer { gap: 20px; }
            .number { font-size: 4rem; }
            .label { font-size: 0.8rem; }
            .edit-panel { left: 20px; right: 20px; top: 60px; }
        }

    </style>
</head>
<body>

    <div class="bg-layer" id="bg"></div>

    <button class="toggle-edit" onclick="toggleEdit()">⚙️</button>

    <div class="edit-panel" id="editPanel">
        <h3>Event Settings</h3>
        <input type="text" id="inName" placeholder="Event Name" value="New Year's Eve">
        <input type="text" id="inLocation" placeholder="Location" value="Times Square, NYC">
        <input type="datetime-local" id="inDate">
        <label for="inBg" style="font-size: 0.8rem;">Background Image:</label>
        <input type="file" id="inBg" accept="image/*">
        <button onclick="updateEvent()">Update</button>
    </div>

    <div class="container">
        <h1 id="outName">New Year's Eve</h1>
        <div class="location" id="outLocation">Times Square, NYC</div>

        <div class="timer">
            <div class="time-block">
                <span class="number" id="d">00</span>
                <span class="label">Days</span>
            </div>
            <div class="time-block">
                <span class="number" id="h">00</span>
                <span class="label">Hours</span>
            </div>
            <div class="time-block">
                <span class="number" id="m">00</span>
                <span class="label">Minutes</span>
            </div>
            <div class="time-block">
                <span class="number" id="s">00</span>
                <span class="label">Seconds</span>
            </div>
        </div>

        <button class="action-btn" onclick="saveToCalendar()">Save to Calendar</button>
    </div>

    <script>
        // State
        let eventDate = new Date();
        // Default to next year
        eventDate.setFullYear(eventDate.getFullYear() + 1);
        eventDate.setMonth(0);
        eventDate.setDate(1);
        eventDate.setHours(0,0,0,0);

        // Init Input
        const iso = new Date(eventDate.getTime() - (eventDate.getTimezoneOffset() * 60000)).toISOString().slice(0, 16);
        document.getElementById('inDate').value = iso;

        // Elements
        const elD = document.getElementById('d');
        const elH = document.getElementById('h');
        const elM = document.getElementById('m');
        const elS = document.getElementById('s');
        const elName = document.getElementById('outName');
        const elLoc = document.getElementById('outLocation');
        const bg = document.getElementById('bg');

        // Timer Loop
        function updateTimer() {
            const now = new Date();
            const diff = eventDate - now;

            if (diff <= 0) {
                elD.innerText = "00";
                elH.innerText = "00";
                elM.innerText = "00";
                elS.innerText = "00";
                return;
            }

            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const m = Math.floor((diff / 1000 / 60) % 60);
            const s = Math.floor((diff / 1000) % 60);

            elD.innerText = d < 10 ? '0' + d : d;
            elH.innerText = h < 10 ? '0' + h : h;
            elM.innerText = m < 10 ? '0' + m : m;
            elS.innerText = s < 10 ? '0' + s : s;
        }

        setInterval(updateTimer, 1000);
        updateTimer();

        // Update Event
        function updateEvent() {
            elName.innerText = document.getElementById('inName').value;
            elLoc.innerText = document.getElementById('inLocation').value;
            const dVal = document.getElementById('inDate').value;
            if (dVal) eventDate = new Date(dVal);
            
            toggleEdit(); // Close panel
        }

        function toggleEdit() {
            document.getElementById('editPanel').classList.toggle('hidden');
        }

        // Image Upload
        document.getElementById('inBg').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    bg.style.backgroundImage = `url(${e.target.result})`;
                }
                reader.readAsDataURL(file);
            }
        });

        // Parallax
        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth - e.pageX * 2) / 50;
            const y = (window.innerHeight - e.pageY * 2) / 50;
            bg.style.transform = `translate(${x}px, ${y}px)`;
        });

        // Calendar Export
        function saveToCalendar() {
            const name = elName.innerText;
            const loc = elLoc.innerText;
            
            // Format for ICS (YYYYMMDDTHHMMSSZ)
            // Simple approach assuming local time for now or using toISOString
            const start = eventDate.toISOString().replace(/-|:|\.\d\d\d/g, "");
            const end = new Date(eventDate.getTime() + 3600000).toISOString().replace(/-|:|\.\d\d\d/g, ""); // +1 hour

            const icsMsg = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${name}
DTSTART:${start}
DTEND:${end}
LOCATION:${loc}
DESCRIPTION:Countdown to ${name}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsMsg], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'event.ics';
            a.click();
        }

    </script>
</body>
</html>
