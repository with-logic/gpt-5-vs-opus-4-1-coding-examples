<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Viz Playground</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            min-height: 100vh;
        }

        /* Sidebar Controls */
        .controls {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        h1 {
            font-size: 1.5rem;
            margin-top: 0;
            margin-bottom: 2rem;
            color: #4f46e5;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input[type="file"] {
            width: 100%;
            font-size: 0.9rem;
        }

        select, input[type="color"], button {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background: #fff;
            font-family: inherit;
            cursor: pointer;
        }

        button.primary {
            background-color: #4f46e5;
            color: white;
            border: none;
            font-weight: 600;
            transition: background 0.2s;
        }

        button.primary:hover {
            background-color: #4338ca;
        }

        /* Chart Area */
        .chart-container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .placeholder {
            text-align: center;
            color: #9ca3af;
        }

        canvas {
            max-width: 100%;
            max-height: 600px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Controls -->
        <div class="controls">
            <h1>Data Viz</h1>
            
            <div class="form-group">
                <label>1. Upload CSV</label>
                <input type="file" id="csvInput" accept=".csv">
                <p style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                    Format: Header row, then data.<br>
                    Col 1: Labels (String)<br>
                    Col 2: Values (Number)
                </p>
            </div>

            <div class="form-group">
                <label>2. Chart Type</label>
                <select id="chartType">
                    <option value="bar">Bar Chart</option>
                    <option value="line">Line Chart</option>
                    <option value="pie">Pie Chart</option>
                    <option value="doughnut">Doughnut Chart</option>
                    <option value="radar">Radar Chart</option>
                </select>
            </div>

            <div class="form-group">
                <label>3. Color Theme</label>
                <input type="color" id="chartColor" value="#4f46e5">
            </div>

            <div class="form-group" style="margin-top: 2rem;">
                <button class="primary" id="downloadBtn" disabled>Download Image</button>
            </div>
        </div>

        <!-- Chart Display -->
        <div class="chart-container">
            <div id="placeholder" class="placeholder">
                <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-bottom: 1rem;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <h3>No Data Yet</h3>
                <p>Upload a CSV file to generate visualizations.</p>
                <button onclick="loadSample()" style="margin-top: 1rem; color: #4f46e5; border: 1px dashed #4f46e5; background: #eef2ff;">Load Sample Data</button>
            </div>
            <canvas id="myChart" style="display: none;"></canvas>
        </div>
    </div>

    <script>
        let myChart = null;
        const ctx = document.getElementById('myChart').getContext('2d');
        const csvInput = document.getElementById('csvInput');
        const chartType = document.getElementById('chartType');
        const chartColor = document.getElementById('chartColor');
        const downloadBtn = document.getElementById('downloadBtn');
        const placeholder = document.getElementById('placeholder');
        const canvas = document.getElementById('myChart');

        // State
        let currentLabels = [];
        let currentData = [];
        let labelName = 'Data';

        // Listeners
        csvInput.addEventListener('change', handleFileUpload);
        chartType.addEventListener('change', updateChart);
        chartColor.addEventListener('input', updateChart);
        downloadBtn.addEventListener('click', downloadImage);

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                parseCSV(e.target.result);
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            if (lines.length < 2) {
                alert('Invalid CSV: Needs at least a header and one data row.');
                return;
            }

            // Reset
            currentLabels = [];
            currentData = [];

            // Header
            const headers = lines[0].split(',');
            labelName = headers[1] || 'Value';

            // Data
            for (let i = 1; i < lines.length; i++) {
                const cols = lines[i].split(',');
                if (cols.length >= 2) {
                    currentLabels.push(cols[0].trim());
                    currentData.push(parseFloat(cols[1].trim()));
                }
            }

            renderChart();
        }

        function loadSample() {
            const sample = "Month,Sales\nJan,120\nFeb,190\nMar,300\nApr,250\nMay,200\nJun,350";
            parseCSV(sample);
            csvInput.value = ''; // clear input
        }

        function renderChart() {
            if (myChart) {
                myChart.destroy();
            }

            placeholder.style.display = 'none';
            canvas.style.display = 'block';
            downloadBtn.disabled = false;

            const type = chartType.value;
            const color = chartColor.value;
            
            // Generate simple opacity variant
            const bgColors = currentData.map(() => color + '80'); // 50% opacity hex
            const borderColors = currentData.map(() => color);

            myChart = new Chart(ctx, {
                type: type,
                data: {
                    labels: currentLabels,
                    datasets: [{
                        label: labelName,
                        data: currentData,
                        backgroundColor: (type === 'pie' || type === 'doughnut') ? generatePalette(currentData.length) : bgColors,
                        borderColor: (type === 'pie' || type === 'doughnut') ? '#fff' : borderColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Visualization Result'
                        }
                    }
                }
            });
        }

        function updateChart() {
            if (currentLabels.length > 0) renderChart();
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'chart.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function generatePalette(count) {
            // Simple palette generator
            const palette = ['#ef4444', '#f97316', '#f59e0b', '#84cc16', '#10b981', '#06b6d4', '#3b82f6', '#6366f1', '#8b5cf6', '#ec4899'];
            const res = [];
            for(let i=0; i<count; i++) {
                res.push(palette[i % palette.length]);
            }
            return res;
        }

    </script>
</body>
</html>
