<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Habit Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8b5cf6;
            --primary-light: #a78bfa;
            --success: #22c55e;
            --warning: #f59e0b;
            --bg: #faf5ff;
            --card: #ffffff;
            --text: #1e1b4b;
            --text-light: #6b7280;
            --border: #e9d5ff;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 30px 0;
        }

        header h1 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 5px;
        }

        header p {
            color: var(--text-light);
        }

        .date-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .date-nav button {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .date-nav button:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .current-date {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* Habits Grid */
        .habits-section {
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .add-habit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .add-habit-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .habits-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .habit-card {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 20px;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }

        .habit-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .habit-checkbox {
            width: 35px;
            height: 35px;
            border: 3px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1.2rem;
        }

        .habit-checkbox:hover {
            border-color: var(--primary);
        }

        .habit-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .habit-checkbox.skipped {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        .habit-info h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .habit-info .streak {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #fef3c7;
            color: #92400e;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .habit-week {
            display: flex;
            gap: 5px;
        }

        .day-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border);
        }

        .day-dot.completed {
            background: var(--success);
        }

        .day-dot.skipped {
            background: var(--warning);
        }

        .day-dot.today {
            box-shadow: 0 0 0 2px var(--primary);
        }

        .habit-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .action-btn:hover {
            opacity: 1;
        }

        /* Chart Section */
        .chart-section {
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-canvas {
            width: 100%;
            height: 150px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
            padding: 10px 0;
        }

        .chart-bar-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .chart-bar {
            width: 100%;
            max-width: 40px;
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 5px 5px 0 0;
            transition: height 0.3s;
        }

        .chart-label {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        /* Data Actions */
        .data-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .data-btn {
            padding: 12px 25px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--card);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .data-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }

        .modal h3 {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-cancel {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-save {
            background: var(--primary);
            border: none;
            color: white;
        }

        /* Motivational Quote */
        .quote-section {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary) 0%, #ec4899 100%);
            border-radius: 20px;
            color: white;
            margin-bottom: 30px;
        }

        .quote-text {
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 10px;
        }

        .quote-author {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 700px) {
            .habit-card {
                grid-template-columns: auto 1fr;
                grid-template-rows: auto auto;
            }

            .habit-week, .habit-actions {
                grid-column: 2;
            }

            .stats-bar {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ú® Micro Habit Tracker</h1>
            <p>Small steps, big changes</p>
            <div class="date-nav">
                <button onclick="changeDate(-1)">‚Üê Yesterday</button>
                <span class="current-date" id="currentDate"></span>
                <button onclick="changeDate(1)">Tomorrow ‚Üí</button>
            </div>
        </header>

        <!-- Motivational Quote -->
        <div class="quote-section">
            <div class="quote-text" id="quoteText">"We are what we repeatedly do. Excellence, then, is not an act, but a habit."</div>
            <div class="quote-author">‚Äî Aristotle</div>
        </div>

        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value" id="todayCompleted">0</div>
                <div class="stat-label">Completed Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="weeklyRate">0%</div>
                <div class="stat-label">Weekly Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalHabits">0</div>
                <div class="stat-label">Active Habits</div>
            </div>
        </div>

        <!-- Weekly Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <span class="section-title">Weekly Progress</span>
            </div>
            <div class="chart-canvas" id="weeklyChart"></div>
        </div>

        <!-- Habits -->
        <div class="habits-section">
            <div class="section-header">
                <span class="section-title">Today's Habits</span>
                <button class="add-habit-btn" onclick="openAddModal()">+ Add Habit</button>
            </div>
            <div class="habits-grid" id="habitsGrid"></div>
        </div>

        <!-- Data Actions -->
        <div class="data-actions">
            <button class="data-btn" onclick="exportData()">üì§ Export JSON</button>
            <button class="data-btn" onclick="document.getElementById('importInput').click()">üì• Import JSON</button>
            <input type="file" id="importInput" accept=".json" style="display: none;" onchange="importData(event)">
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal-overlay" id="habitModal">
        <div class="modal">
            <h3 id="modalTitle">Add New Habit</h3>
            <form onsubmit="saveHabit(event)">
                <div class="form-group">
                    <label>Habit Name</label>
                    <input type="text" id="habitName" placeholder="e.g., Drink 8 glasses of water" required maxlength="50">
                </div>
                <div class="form-group">
                    <label>Emoji (optional)</label>
                    <input type="text" id="habitEmoji" placeholder="e.g., üíß" maxlength="2">
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data
        let habits = [];
        let history = {};
        let currentDate = new Date();
        let editingId = null;

        const quotes = [
            { text: "We are what we repeatedly do. Excellence, then, is not an act, but a habit.", author: "Aristotle" },
            { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
            { text: "Small daily improvements are the key to staggering long-term results.", author: "Robin Sharma" },
            { text: "Motivation is what gets you started. Habit is what keeps you going.", author: "Jim Ryun" },
            { text: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" }
        ];

        // Initialize with sample data
        function initSampleData() {
            habits = [
                { id: 1, name: 'Morning meditation', emoji: 'üßò' },
                { id: 2, name: 'Read 20 pages', emoji: 'üìö' },
                { id: 3, name: 'Exercise 30 min', emoji: 'üí™' },
                { id: 4, name: 'Drink 8 glasses water', emoji: 'üíß' },
                { id: 5, name: 'No social media before noon', emoji: 'üìµ' }
            ];

            // Generate sample history for past week
            const today = new Date();
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const key = formatDateKey(date);

                history[key] = {};
                habits.forEach(habit => {
                    if (Math.random() > 0.3) {
                        history[key][habit.id] = Math.random() > 0.1 ? 'completed' : 'skipped';
                    }
                });
            }

            saveData();
        }

        // Load/Save data
        function loadData() {
            const savedHabits = localStorage.getItem('microHabits');
            const savedHistory = localStorage.getItem('microHistory');

            if (savedHabits) {
                habits = JSON.parse(savedHabits);
                history = savedHistory ? JSON.parse(savedHistory) : {};
            } else {
                initSampleData();
            }
        }

        function saveData() {
            localStorage.setItem('microHabits', JSON.stringify(habits));
            localStorage.setItem('microHistory', JSON.stringify(history));
        }

        // Date helpers
        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDisplayDate(date) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            if (formatDateKey(date) === formatDateKey(today)) {
                return 'Today';
            } else if (formatDateKey(date) === formatDateKey(yesterday)) {
                return 'Yesterday';
            }
            return date.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
        }

        function changeDate(delta) {
            currentDate.setDate(currentDate.getDate() + delta);
            render();
        }

        // Get habit status for date
        function getStatus(habitId, date) {
            const key = formatDateKey(date);
            return history[key]?.[habitId] || null;
        }

        // Toggle habit status
        function toggleHabit(habitId) {
            const key = formatDateKey(currentDate);
            if (!history[key]) history[key] = {};

            const current = history[key][habitId];
            if (!current) {
                history[key][habitId] = 'completed';
            } else if (current === 'completed') {
                history[key][habitId] = 'skipped';
            } else {
                delete history[key][habitId];
            }

            saveData();
            render();
        }

        // Calculate streak for habit
        function calculateStreak(habitId) {
            let streak = 0;
            const today = new Date();

            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const status = getStatus(habitId, date);

                if (status === 'completed') {
                    streak++;
                } else if (status !== 'skipped') {
                    break;
                }
            }
            return streak;
        }

        // Calculate stats
        function calculateStats() {
            const key = formatDateKey(currentDate);
            const todayData = history[key] || {};

            const completed = Object.values(todayData).filter(s => s === 'completed').length;
            const total = habits.length;

            // Current streak (perfect days in a row)
            let perfectStreak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dayKey = formatDateKey(date);
                const dayData = history[dayKey] || {};

                const dayCompleted = habits.filter(h => dayData[h.id] === 'completed').length;
                if (dayCompleted === habits.length && habits.length > 0) {
                    perfectStreak++;
                } else if (i > 0) {
                    break;
                }
            }

            // Weekly rate
            let weeklyCompleted = 0;
            let weeklyTotal = 0;
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dayKey = formatDateKey(date);
                const dayData = history[dayKey] || {};

                weeklyCompleted += Object.values(dayData).filter(s => s === 'completed').length;
                weeklyTotal += habits.length;
            }
            const weeklyRate = weeklyTotal > 0 ? Math.round((weeklyCompleted / weeklyTotal) * 100) : 0;

            return { completed, total, perfectStreak, weeklyRate };
        }

        // Render
        function render() {
            document.getElementById('currentDate').textContent = formatDisplayDate(currentDate);

            // Random quote
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('quoteText').textContent = `"${quote.text}"`;
            document.querySelector('.quote-author').textContent = `‚Äî ${quote.author}`;

            renderHabits();
            renderStats();
            renderChart();
        }

        function renderHabits() {
            const grid = document.getElementById('habitsGrid');
            grid.innerHTML = '';

            habits.forEach(habit => {
                const status = getStatus(habit.id, currentDate);
                const streak = calculateStreak(habit.id);

                // Last 7 days
                const weekDots = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(currentDate);
                    date.setDate(date.getDate() - i);
                    const dayStatus = getStatus(habit.id, date);
                    const isToday = i === 0;

                    let dotClass = 'day-dot';
                    if (dayStatus === 'completed') dotClass += ' completed';
                    else if (dayStatus === 'skipped') dotClass += ' skipped';
                    if (isToday) dotClass += ' today';

                    weekDots.push(`<div class="${dotClass}"></div>`);
                }

                const card = document.createElement('div');
                card.className = 'habit-card';
                card.innerHTML = `
                    <div class="habit-checkbox ${status || ''}" onclick="toggleHabit(${habit.id})">
                        ${status === 'completed' ? '‚úì' : status === 'skipped' ? '‚àí' : ''}
                    </div>
                    <div class="habit-info">
                        <h3>${habit.emoji || '‚Ä¢'} ${habit.name}</h3>
                        <div class="streak">
                            Tap to mark complete
                            ${streak > 0 ? `<span class="streak-badge">üî• ${streak} day streak</span>` : ''}
                        </div>
                    </div>
                    <div class="habit-week">
                        ${weekDots.join('')}
                    </div>
                    <div class="habit-actions">
                        <button class="action-btn" onclick="editHabit(${habit.id})">‚úèÔ∏è</button>
                        <button class="action-btn" onclick="deleteHabit(${habit.id})">üóëÔ∏è</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function renderStats() {
            const stats = calculateStats();
            document.getElementById('todayCompleted').textContent = `${stats.completed}/${stats.total}`;
            document.getElementById('currentStreak').textContent = stats.perfectStreak;
            document.getElementById('weeklyRate').textContent = stats.weeklyRate + '%';
            document.getElementById('totalHabits').textContent = habits.length;
        }

        function renderChart() {
            const chart = document.getElementById('weeklyChart');
            chart.innerHTML = '';

            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date(currentDate);

            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dayKey = formatDateKey(date);
                const dayData = history[dayKey] || {};

                const completed = Object.values(dayData).filter(s => s === 'completed').length;
                const percentage = habits.length > 0 ? (completed / habits.length) * 100 : 0;

                const container = document.createElement('div');
                container.className = 'chart-bar-container';
                container.innerHTML = `
                    <div class="chart-bar" style="height: ${percentage}%"></div>
                    <span class="chart-label">${days[date.getDay()]}</span>
                `;
                chart.appendChild(container);
            }
        }

        // Modal functions
        function openAddModal() {
            if (habits.length >= 7) {
                alert('Maximum 7 habits allowed for focus!');
                return;
            }
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Add New Habit';
            document.getElementById('habitName').value = '';
            document.getElementById('habitEmoji').value = '';
            document.getElementById('habitModal').classList.add('active');
        }

        function editHabit(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;

            editingId = id;
            document.getElementById('modalTitle').textContent = 'Edit Habit';
            document.getElementById('habitName').value = habit.name;
            document.getElementById('habitEmoji').value = habit.emoji || '';
            document.getElementById('habitModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('habitModal').classList.remove('active');
        }

        function saveHabit(e) {
            e.preventDefault();

            const name = document.getElementById('habitName').value.trim();
            const emoji = document.getElementById('habitEmoji').value.trim();

            if (editingId) {
                const habit = habits.find(h => h.id === editingId);
                if (habit) {
                    habit.name = name;
                    habit.emoji = emoji;
                }
            } else {
                const newId = Math.max(0, ...habits.map(h => h.id)) + 1;
                habits.push({ id: newId, name, emoji });
            }

            saveData();
            closeModal();
            render();
        }

        function deleteHabit(id) {
            if (!confirm('Delete this habit?')) return;
            habits = habits.filter(h => h.id !== id);
            saveData();
            render();
        }

        // Export/Import
        function exportData() {
            const data = { habits, history };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'habit-tracker-backup.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.habits && data.history) {
                        habits = data.habits;
                        history = data.history;
                        saveData();
                        render();
                        alert('Data imported successfully!');
                    }
                } catch (err) {
                    alert('Invalid file format');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Initialize
        loadData();
        render();
    </script>
</body>
</html>
