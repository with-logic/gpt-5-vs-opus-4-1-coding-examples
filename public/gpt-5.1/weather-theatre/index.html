<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Weather Theatre</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        margin: 0;
        font-family: "Space Grotesk", system-ui;
        background: #030712;
        color: #f8fafc;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }
      .stage {
        width: min(900px, 100%);
        background: rgba(0, 0, 0, 0.5);
        border-radius: 2rem;
        padding: 1.5rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
      }
      canvas {
        width: 100%;
        border-radius: 1.5rem;
        background: #111;
      }
      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }
      label {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
      }
      input[type="range"] {
        width: 100%;
      }
      .subtitle {
        margin-top: 1rem;
        font-size: 1.2rem;
        min-height: 1.2rem;
      }
      .curtain {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 50%;
        background: linear-gradient(180deg, #7f1d1d, #450a0a);
        transition: transform 1s ease;
        z-index: 2;
      }
      .curtain.left {
        left: 0;
        transform: translateX(-100%);
      }
      .curtain.right {
        right: 0;
        transform: translateX(100%);
      }
      .curtain.closed.left {
        transform: translateX(0);
      }
      .curtain.closed.right {
        transform: translateX(0);
      }
      .toggle {
        border-radius: 999px;
        border: none;
        padding: 0.6rem 1.2rem;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const moods = ["cosy", "eerie", "heroic"];
      const scene = "Mock forecast: shifting clouds with a gentle drizzle";

      function App() {
        const [values, setValues] = React.useState({ cosy: 40, eerie: 20, heroic: 40 });
        const [matinee, setMatinee] = React.useState(true);
        const [typed, setTyped] = React.useState("");
        const canvasRef = React.useRef(null);
        const [curtain, setCurtain] = React.useState(false);

        React.useEffect(() => {
          const full = `${scene} in a ${values.cosy > values.eerie ? "warm" : "brooding"} ambience.`;
          setTyped("");
          let i = 0;
          const interval = setInterval(() => {
            setTyped((prev) => prev + full[i]);
            i++; if (i >= full.length) clearInterval(interval);
          }, 40);
          return () => clearInterval(interval);
        }, [values, matinee]);

        React.useEffect(() => {
          const canvas = canvasRef.current;
          const ctx = canvas.getContext("2d");
          canvas.width = canvas.offsetWidth;
          canvas.height = 320;
          const cosy = values.cosy / 100;
          const eerie = values.eerie / 100;
          const heroic = values.heroic / 100;
          const skyTop = matinee ? `rgba(${200 + 40 * heroic},${180 + cosy * 40},${150},1)` : `rgba(${20},${30 + cosy * 40},${60 + heroic * 60},1)`;
          const skyBottom = matinee ? `rgba(255,${210},${160 + heroic * 50},1)` : `rgba(10,20,40,1)`;
          const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
          grad.addColorStop(0, skyTop);
          grad.addColorStop(1, skyBottom);
          ctx.fillStyle = grad;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = `rgba(255,255,255,${0.05 + cosy * 0.1})`;
          for (let i = 0; i < 5; i++) {
            ctx.beginPath();
            ctx.ellipse(100 + i * 150, 80 + i * 5, 120, 40, 0, 0, Math.PI * 2);
            ctx.fill();
          }
          ctx.fillStyle = `rgba(30,30,30,${0.4 + eerie * 0.4})`;
          for (let i = 0; i < 3; i++) {
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 60 - i * 20);
            ctx.lineTo(canvas.width, canvas.height - 20 - i * 20);
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            ctx.fill();
          }
          ctx.strokeStyle = `rgba(255,255,200,${0.2 + heroic * 0.5})`;
          ctx.lineWidth = 6;
          ctx.beginPath();
          const sweep = Date.now() / 1000;
          ctx.arc(canvas.width / 2, canvas.height, 260, sweep % Math.PI, sweep % Math.PI + 0.5);
          ctx.stroke();
        }, [values, matinee]);

        const handleChange = (name, value) => {
          setValues((prev) => ({ ...prev, [name]: Number(value) }));
        };

        return (
          <div className="stage">
            <div className={`curtain left ${curtain ? "closed" : ""}`}></div>
            <div className={`curtain right ${curtain ? "closed" : ""}`}></div>
            <canvas ref={canvasRef} height="320"></canvas>
            <button className="toggle" onClick={() => setMatinee((m) => !m)}>
              {matinee ? "Switch to Night" : "Switch to Matin√©e"}
            </button>
            <button className="toggle" onClick={() => setCurtain((c) => !c)}>{curtain ? "Open curtain" : "Close curtain"}</button>
            <div className="controls">
              {moods.map((mood) => (
                <label key={mood}>
                  {mood}
                  <input type="range" min="0" max="100" value={values[mood]} onChange={(e) => handleChange(mood, e.target.value)} />
                </label>
              ))}
            </div>
            <div className="subtitle">{typed}</div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
