<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CamFX | Webcam Playground</title>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;600&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            background-color: #121212;
            color: white;
            font-family: 'Work Sans', sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            padding: 20px;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; }

        #main-area {
            flex-grow: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        video {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none; /* Source hidden, drawn to canvas */
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        /* Controls Bar */
        .controls {
            padding: 20px;
            background: rgba(20, 20, 20, 0.9);
            display: flex;
            justify-content: center;
            gap: 20px;
            overflow-x: auto;
            z-index: 10;
        }

        .filter-btn {
            background: #333;
            border: 2px solid transparent;
            color: #fff;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            font-weight: 600;
        }

        .filter-btn:hover { background: #444; }
        
        .filter-btn.active {
            background: #fff;
            color: #000;
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
        }

        .action-btn {
            background: #ff4081;
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(255, 64, 129, 0.4);
            transition: transform 0.1s;
        }

        .action-btn:active { transform: scale(0.9); }

        .error-msg {
            color: #ff4081;
            text-align: center;
            padding: 20px;
            display: none;
        }

    </style>
</head>
<body>

    <header>
        <h1>CamFX</h1>
        <button class="action-btn" onclick="takeSnapshot()" title="Take Snapshot">ðŸ“¸</button>
    </header>

    <div id="main-area">
        <div class="error-msg" id="errorMsg">Camera access required. Please allow permission.</div>
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
    </div>

    <div class="controls">
        <button class="filter-btn active" onclick="setFilter('none')">Normal</button>
        <button class="filter-btn" onclick="setFilter('grayscale(100%)')">B&W</button>
        <button class="filter-btn" onclick="setFilter('sepia(100%)')">Sepia</button>
        <button class="filter-btn" onclick="setFilter('invert(100%)')">Invert</button>
        <button class="filter-btn" onclick="setFilter('hue-rotate(90deg)')">Alien</button>
        <button class="filter-btn" onclick="setFilter('contrast(200%)')">Dramatic</button>
        <button class="filter-btn" onclick="setFilter('blur(5px)')">Blur</button>
        <button class="filter-btn" onclick="setFilter('saturate(5)')">Deep Fried</button>
    </div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const errorMsg = document.getElementById('errorMsg');
        
        let currentFilter = 'none';
        let stream = null;

        async function initCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720 } });
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    draw();
                };
            } catch (err) {
                console.error("Camera Error:", err);
                errorMsg.style.display = 'block';
            }
        }

        function draw() {
            ctx.filter = currentFilter;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Add "Rec" indicator overlay just for fun? No, minimal is better.
            
            requestAnimationFrame(draw);
        }

        function setFilter(filter) {
            currentFilter = filter;
            // Update UI
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            // Find button with matching onclick content roughly (simple check)
            const buttons = document.querySelectorAll('.filter-btn');
            for (let btn of buttons) {
                if (btn.getAttribute('onclick').includes(filter)) {
                    btn.classList.add('active');
                    break;
                }
            }
        }

        function takeSnapshot() {
            const link = document.createElement('a');
            // Capture current canvas state (which has filter applied via ctx.filter)
            link.download = `snapshot_${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            // Flash effect
            const flash = document.createElement('div');
            flash.style.position = 'fixed';
            flash.style.top = 0; flash.style.left = 0;
            flash.style.width = '100%'; flash.style.height = '100%';
            flash.style.background = 'white';
            flash.style.opacity = 1;
            flash.style.zIndex = 100;
            flash.style.pointerEvents = 'none';
            flash.style.transition = 'opacity 0.5s';
            document.body.appendChild(flash);
            setTimeout(() => {
                flash.style.opacity = 0;
                setTimeout(() => flash.remove(), 500);
            }, 50);
        }

        initCamera();

    </script>
</body>
</html>
