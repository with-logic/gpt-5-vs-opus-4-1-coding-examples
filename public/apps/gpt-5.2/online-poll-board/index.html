<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light" />
    <title>Online Poll Board</title>
    <meta
      name="description"
      content="Online Poll Board — a delightful, local-only mock voting board with animated vote counts and live results."
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg0: #f6fbff;
        --bg1: #fff7fb;
        --card: rgba(255, 255, 255, 0.82);
        --card-strong: rgba(255, 255, 255, 0.92);
        --stroke: rgba(20, 25, 38, 0.12);
        --stroke-strong: rgba(20, 25, 38, 0.18);
        --text: #121827;
        --muted: rgba(18, 24, 39, 0.72);
        --muted2: rgba(18, 24, 39, 0.58);
        --shadow: 0 18px 60px rgba(15, 23, 42, 0.12);
        --shadow2: 0 10px 26px rgba(15, 23, 42, 0.12);
        --radius-xl: 22px;
        --radius-lg: 16px;
        --radius-md: 14px;
        --radius-sm: 12px;
        --ring: 0 0 0 4px rgba(94, 234, 212, 0.26);
        --good: #0ea5e9;
        --mint: #5eead4;
        --rose: #fb7185;
        --amber: #fbbf24;
        --violet: #a78bfa;
        --maxw: 1120px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family:
          "Plus Jakarta Sans",
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Helvetica,
          Arial,
          "Apple Color Emoji",
          "Segoe UI Emoji";
        color: var(--text);
        background:
          radial-gradient(1200px 900px at 12% 8%, rgba(94, 234, 212, 0.22), transparent 60%),
          radial-gradient(900px 800px at 82% 16%, rgba(167, 139, 250, 0.18), transparent 55%),
          radial-gradient(900px 780px at 70% 84%, rgba(251, 113, 133, 0.14), transparent 50%),
          linear-gradient(160deg, var(--bg0), var(--bg1));
        overflow-x: hidden;
      }

      .noise {
        position: fixed;
        inset: 0;
        pointer-events: none;
        opacity: 0.05;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
        mix-blend-mode: multiply;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .wrap {
        max-width: var(--maxw);
        margin: 0 auto;
        padding: 28px 18px 28px;
      }

      header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 18px;
        margin-bottom: 18px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo {
        width: 44px;
        height: 44px;
        border-radius: 16px;
        background:
          radial-gradient(18px 18px at 30% 30%, rgba(255, 255, 255, 0.9), transparent 60%),
          linear-gradient(140deg, rgba(94, 234, 212, 0.9), rgba(167, 139, 250, 0.88), rgba(251, 113, 133, 0.78));
        box-shadow: 0 12px 30px rgba(167, 139, 250, 0.18);
        display: grid;
        place-items: center;
        border: 1px solid rgba(255, 255, 255, 0.6);
      }

      .logo svg {
        width: 24px;
        height: 24px;
        filter: drop-shadow(0 8px 18px rgba(15, 23, 42, 0.22));
      }

      h1 {
        font-size: 22px;
        line-height: 1.1;
        margin: 0;
        letter-spacing: -0.02em;
      }

      .sub {
        margin-top: 4px;
        color: var(--muted);
        font-size: 13.5px;
        line-height: 1.35;
      }

      .pills {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .pill {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px);
        box-shadow: 0 10px 28px rgba(15, 23, 42, 0.06);
        color: var(--muted);
        font-size: 13px;
        user-select: none;
      }

      .pill strong {
        color: var(--text);
        font-weight: 650;
      }

      .pill .dot {
        width: 9px;
        height: 9px;
        border-radius: 999px;
        background: linear-gradient(135deg, var(--mint), rgba(94, 234, 212, 0.2));
        box-shadow: 0 0 0 3px rgba(94, 234, 212, 0.15);
      }

      .pill button {
        appearance: none;
        border: 0;
        background: transparent;
        padding: 0;
        color: inherit;
        font: inherit;
        cursor: pointer;
      }

      .layout {
        display: grid;
        grid-template-columns: 380px 1fr;
        gap: 16px;
        align-items: start;
      }

      @media (max-width: 980px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        border-radius: var(--radius-xl);
        background: var(--card);
        border: 1px solid var(--stroke);
        box-shadow: var(--shadow);
        overflow: hidden;
        position: relative;
        backdrop-filter: blur(12px);
      }

      .panel .inner {
        padding: 16px;
      }

      .controls {
        display: grid;
        grid-template-columns: 1fr 150px;
        gap: 10px;
        margin-bottom: 12px;
      }

      @media (max-width: 980px) {
        .controls {
          grid-template-columns: 1fr;
        }
      }

      .input {
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 12px 12px;
        border-radius: 14px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.66);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.06);
      }

      .input:focus-within {
        box-shadow: var(--ring), 0 12px 30px rgba(15, 23, 42, 0.06);
        border-color: rgba(94, 234, 212, 0.52);
      }

      .input input {
        width: 100%;
        border: 0;
        outline: 0;
        background: transparent;
        font: inherit;
        color: var(--text);
      }

      .select {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 12px 12px;
        border-radius: 14px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.66);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.06);
      }

      .select select {
        width: 100%;
        border: 0;
        outline: 0;
        background: transparent;
        font: inherit;
        color: var(--text);
        appearance: none;
        cursor: pointer;
      }

      .icon {
        width: 18px;
        height: 18px;
        opacity: 0.75;
        flex: 0 0 auto;
      }

      .list {
        display: grid;
        gap: 10px;
        padding-bottom: 6px;
      }

      .card {
        border-radius: var(--radius-lg);
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.68);
        padding: 12px 12px;
        cursor: pointer;
        position: relative;
        transition:
          transform 160ms ease,
          box-shadow 160ms ease,
          border-color 160ms ease;
        overflow: hidden;
      }

      .card:hover {
        transform: translateY(-1px);
        border-color: rgba(18, 24, 39, 0.16);
        box-shadow: var(--shadow2);
      }

      .card[aria-selected="true"] {
        border-color: rgba(94, 234, 212, 0.56);
        box-shadow: var(--ring), var(--shadow2);
        background: rgba(255, 255, 255, 0.78);
      }

      .cardTop {
        display: flex;
        justify-content: space-between;
        gap: 12px;
      }

      .q {
        font-weight: 700;
        letter-spacing: -0.01em;
        line-height: 1.25;
      }

      .meta {
        margin-top: 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        color: var(--muted);
        font-size: 12.5px;
      }

      .badgeRow {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      .badge {
        display: inline-flex;
        gap: 6px;
        align-items: center;
        padding: 6px 9px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.7);
        color: rgba(18, 24, 39, 0.75);
      }

      .badge .sw {
        width: 10px;
        height: 10px;
        border-radius: 4px;
        background: var(--mint);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.6);
      }

      .miniBars {
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: 1fr;
        gap: 4px;
        align-items: end;
        height: 22px;
        width: 112px;
        opacity: 0.9;
      }

      .miniBars span {
        border-radius: 6px;
        background: linear-gradient(180deg, rgba(167, 139, 250, 0.8), rgba(94, 234, 212, 0.55));
        height: 6px;
        transform-origin: bottom;
        transition: height 260ms cubic-bezier(0.2, 0.9, 0.2, 1);
      }

      .card[aria-selected="true"] .miniBars span {
        background: linear-gradient(180deg, rgba(94, 234, 212, 0.95), rgba(167, 139, 250, 0.7));
      }

      .detailHead {
        padding: 16px 16px 0;
      }

      .detailTitleRow {
        display: flex;
        gap: 12px;
        align-items: flex-start;
        justify-content: space-between;
        flex-wrap: wrap;
      }

      .detailTitle {
        font-size: 20px;
        letter-spacing: -0.02em;
        margin: 0;
        line-height: 1.2;
      }

      .detailDesc {
        color: var(--muted);
        margin: 8px 0 0;
        line-height: 1.55;
        font-size: 13.5px;
      }

      .actions {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .btn {
        appearance: none;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.74);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 14px;
        font: inherit;
        cursor: pointer;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.06);
        transition:
          transform 160ms ease,
          box-shadow 160ms ease,
          border-color 160ms ease;
        user-select: none;
      }

      .btn:hover {
        transform: translateY(-1px);
        border-color: rgba(18, 24, 39, 0.16);
        box-shadow: var(--shadow2);
      }

      .btn:active {
        transform: translateY(0px);
      }

      .btn.primary {
        border-color: rgba(94, 234, 212, 0.62);
        background: linear-gradient(180deg, rgba(94, 234, 212, 0.52), rgba(255, 255, 255, 0.72));
      }

      .btn.danger {
        border-color: rgba(251, 113, 133, 0.45);
        background: linear-gradient(180deg, rgba(251, 113, 133, 0.22), rgba(255, 255, 255, 0.74));
      }

      .btn:focus-visible {
        outline: none;
        box-shadow: var(--ring), var(--shadow2);
      }

      .detailBody {
        padding: 16px;
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 14px;
        align-items: start;
      }

      @media (max-width: 980px) {
        .detailBody {
          grid-template-columns: 1fr;
        }
      }

      .section {
        border-radius: var(--radius-xl);
        background: rgba(255, 255, 255, 0.66);
        border: 1px solid var(--stroke);
        box-shadow: 0 16px 44px rgba(15, 23, 42, 0.08);
        overflow: hidden;
      }

      .section .hd {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        padding: 12px 12px;
        border-bottom: 1px solid rgba(20, 25, 38, 0.08);
        background: rgba(255, 255, 255, 0.64);
      }

      .hd .t {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 700;
        letter-spacing: -0.01em;
      }

      .hd .hint {
        color: var(--muted);
        font-size: 12.5px;
      }

      .opts {
        padding: 12px;
        display: grid;
        gap: 10px;
      }

      .opt {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: center;
        border-radius: 16px;
        border: 1px solid var(--stroke);
        padding: 12px 12px;
        background: rgba(255, 255, 255, 0.68);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition:
          transform 160ms ease,
          border-color 160ms ease,
          box-shadow 160ms ease;
      }

      .opt:hover {
        transform: translateY(-1px);
        border-color: rgba(18, 24, 39, 0.16);
        box-shadow: var(--shadow2);
      }

      .opt:focus-visible {
        outline: none;
        box-shadow: var(--ring), var(--shadow2);
        border-color: rgba(94, 234, 212, 0.52);
      }

      .opt[aria-pressed="true"] {
        border-color: rgba(94, 234, 212, 0.62);
        background: linear-gradient(180deg, rgba(94, 234, 212, 0.18), rgba(255, 255, 255, 0.74));
      }

      .opt .label {
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 0;
      }

      .opt .label .main {
        font-weight: 700;
        letter-spacing: -0.01em;
      }

      .opt .label .sub {
        margin: 0;
        font-size: 12.5px;
        color: var(--muted);
      }

      .count {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: rgba(18, 24, 39, 0.88);
        font-weight: 700;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(20, 25, 38, 0.1);
        background: rgba(255, 255, 255, 0.72);
      }

      .spark {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: linear-gradient(135deg, var(--amber), var(--rose));
        box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.18);
      }

      .results {
        padding: 12px;
        display: grid;
        gap: 10px;
      }

      .resRow {
        padding: 12px 12px;
        border-radius: 16px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.66);
        position: relative;
        overflow: hidden;
      }

      .resTop {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
      }

      .resName {
        font-weight: 700;
        letter-spacing: -0.01em;
      }

      .resNums {
        color: var(--muted);
        font-size: 12.5px;
        white-space: nowrap;
      }

      .barTrack {
        margin-top: 10px;
        height: 12px;
        border-radius: 999px;
        background: rgba(18, 24, 39, 0.08);
        overflow: hidden;
        border: 1px solid rgba(20, 25, 38, 0.08);
      }

      .bar {
        height: 100%;
        width: 0%;
        border-radius: 999px;
        background: linear-gradient(90deg, rgba(94, 234, 212, 0.92), rgba(167, 139, 250, 0.92), rgba(251, 113, 133, 0.85));
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.55);
        transition: width 520ms cubic-bezier(0.2, 0.9, 0.2, 1);
      }

      .bar::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(600px 120px at 20% 0%, rgba(255, 255, 255, 0.18), transparent 55%);
        pointer-events: none;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        padding: 12px;
      }

      @media (max-width: 980px) {
        .stats {
          grid-template-columns: 1fr;
        }
      }

      .stat {
        border-radius: 16px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.66);
        padding: 12px;
        overflow: hidden;
        position: relative;
      }

      .stat .k {
        color: var(--muted);
        font-size: 12.5px;
      }

      .stat .v {
        margin-top: 6px;
        font-weight: 800;
        font-size: 18px;
        letter-spacing: -0.02em;
      }

      .stat .mini {
        margin-top: 6px;
        color: var(--muted);
        font-size: 12.5px;
      }

      .stat::before {
        content: "";
        position: absolute;
        inset: -40px -60px auto auto;
        width: 130px;
        height: 130px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, rgba(94, 234, 212, 0.35), transparent 60%);
        transform: rotate(12deg);
        pointer-events: none;
      }

      footer {
        margin-top: 14px;
        color: var(--muted2);
        font-size: 12.5px;
        display: flex;
        justify-content: space-between;
        gap: 14px;
        flex-wrap: wrap;
        align-items: center;
        padding: 6px 2px;
      }

      .kbd {
        font-variant-numeric: tabular-nums;
        padding: 4px 8px;
        border-radius: 10px;
        border: 1px solid rgba(20, 25, 38, 0.12);
        background: rgba(255, 255, 255, 0.56);
      }

      .sr {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .toast {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        border-radius: 999px;
        border: 1px solid rgba(20, 25, 38, 0.12);
        background: rgba(255, 255, 255, 0.82);
        backdrop-filter: blur(10px);
        box-shadow: 0 18px 60px rgba(15, 23, 42, 0.14);
        padding: 10px 12px;
        color: rgba(18, 24, 39, 0.86);
        font-size: 13px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 200ms ease,
          transform 200ms ease;
      }

      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(-4px);
      }

      .toggle {
        display: inline-flex;
        gap: 10px;
        align-items: center;
        user-select: none;
      }

      .switch {
        width: 44px;
        height: 26px;
        border-radius: 999px;
        border: 1px solid rgba(20, 25, 38, 0.14);
        background: rgba(18, 24, 39, 0.12);
        position: relative;
        flex: 0 0 auto;
        cursor: pointer;
        transition: background 180ms ease;
      }

      .switch::after {
        content: "";
        position: absolute;
        width: 20px;
        height: 20px;
        top: 50%;
        left: 3px;
        transform: translateY(-50%);
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 10px 22px rgba(15, 23, 42, 0.18);
        transition: left 180ms ease;
      }

      .switch[aria-checked="true"] {
        background: rgba(94, 234, 212, 0.75);
      }

      .switch[aria-checked="true"]::after {
        left: 21px;
      }

      .pop {
        animation: pop 520ms cubic-bezier(0.18, 0.95, 0.2, 1) both;
      }

      @keyframes pop {
        0% {
          transform: translateY(0) scale(1);
        }
        22% {
          transform: translateY(-1px) scale(1.02);
        }
        55% {
          transform: translateY(0) scale(0.995);
        }
        100% {
          transform: translateY(0) scale(1);
        }
      }

      .confetti {
        position: fixed;
        left: 0;
        top: 0;
        width: 10px;
        height: 14px;
        border-radius: 3px;
        pointer-events: none;
        z-index: 40;
        will-change: transform, opacity;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          scroll-behavior: auto !important;
          transition-duration: 0.01ms !important;
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="noise" aria-hidden="true"></div>
    <div class="wrap">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M4.5 7.8C6.7 5.9 9.2 5 12 5c4.9 0 8.5 2.9 8.5 7 0 4.2-3.6 7-8.5 7-2.3 0-4.4-.6-6.1-1.7l-3 1.1.9-2.9C2.9 11.4 3.1 9.4 4.5 7.8Z"
                stroke="rgba(255,255,255,0.92)"
                stroke-width="1.8"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M8 12.3h8M8.7 9.6h6.6M9.2 15h5.6"
                stroke="rgba(255,255,255,0.92)"
                stroke-width="1.8"
                stroke-linecap="round"
              />
            </svg>
          </div>
          <div>
            <h1>Online Poll Board</h1>
            <div class="sub">Vote on fun topics (mock). Results animate instantly — stored locally on this device.</div>
          </div>
        </div>

        <div class="pills">
          <div class="pill" title="Local-only demo: votes are stored in your browser">
            <span class="dot" aria-hidden="true"></span>
            <span><strong>Local-only</strong> mock voting</span>
          </div>
          <div class="pill">
            <span aria-hidden="true">⌘</span>
            <button id="focusSearch" type="button" title="Focus search (Ctrl/⌘ + K)">Search</button>
          </div>
        </div>
      </header>

      <main class="layout">
        <section class="panel" aria-label="Poll list">
          <div class="inner">
            <div class="controls">
              <label class="input" aria-label="Search polls">
                <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path
                    d="M10.5 18.5a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z"
                    stroke="currentColor"
                    stroke-width="1.8"
                  />
                  <path d="M16.7 16.7 21 21" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                </svg>
                <input id="search" type="text" placeholder="Search polls… (try “coffee”, “weekend”, “UX”)" autocomplete="off" />
              </label>

              <label class="select" aria-label="Sort polls">
                <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path
                    d="M6 7h12M9 12h9M12 17h6"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                  />
                </svg>
                <select id="sort">
                  <option value="trending">Trending</option>
                  <option value="newest">Newest</option>
                  <option value="most">Most votes</option>
                  <option value="az">A → Z</option>
                </select>
              </label>
            </div>

            <div id="list" class="list" role="listbox" aria-label="Polls"></div>
            <div id="empty" class="sub" style="display: none; padding: 6px 4px 0">
              No polls match that search. Try fewer words.
            </div>
          </div>
        </section>

        <section class="panel" aria-label="Poll details">
          <div class="detailHead">
            <div class="detailTitleRow">
              <div style="min-width: 0">
                <div class="badgeRow" id="detailBadges"></div>
                <h2 class="detailTitle" id="detailTitle">Select a poll</h2>
                <p class="detailDesc" id="detailDesc">Pick one from the left to see options and live results.</p>
              </div>
              <div class="actions">
                <button class="btn" id="shareBtn" type="button" title="Copy a shareable snippet">Share</button>
                <button class="btn danger" id="resetVoteBtn" type="button" title="Remove your vote for this poll">Reset my vote</button>
              </div>
            </div>
          </div>

          <div class="detailBody">
            <div class="section" aria-label="Vote options">
              <div class="hd">
                <div class="t">
                  <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path
                      d="M20 7.5 10 17.5l-5-5"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  Vote
                </div>
                <div class="hint" id="voteHint">Choose an option</div>
              </div>
              <div id="options" class="opts"></div>
            </div>

            <div class="section" aria-label="Results">
              <div class="hd">
                <div class="t">
                  <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path
                      d="M4.5 19.5V10.5M9.5 19.5V7.5M14.5 19.5V13.5M19.5 19.5V5.5"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                  Results
                </div>
                <div class="toggle" title="When on, results update instantly as you vote">
                  <span class="hint">Live</span>
                  <button class="switch" id="liveSwitch" type="button" role="switch" aria-checked="true"></button>
                </div>
              </div>
              <div id="results" class="results"></div>
              <div class="stats" id="stats"></div>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <div>
          Tip: use <span class="kbd">↑</span>/<span class="kbd">↓</span> to navigate polls and <span class="kbd">Enter</span> to select.
        </div>
        <div>
          Privacy: no server, no tracking. Data lives in <span class="kbd">localStorage</span>.
        </div>
      </footer>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>
    <div class="sr" id="ariaLive" aria-live="polite"></div>

    <script>
      (() => {
        const $ = (sel, root = document) => root.querySelector(sel);
        const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
        const clone = (obj) => (typeof structuredClone === "function" ? structuredClone(obj) : JSON.parse(JSON.stringify(obj)));
        const cssEscape = (s) => (window.CSS && typeof window.CSS.escape === "function" ? window.CSS.escape(s) : String(s).replace(/[^a-zA-Z0-9_-]/g, "\\$&"));

        const STORAGE = {
          votes: "opb.votes.v1",
          polls: "opb.polls.v1",
          prefs: "opb.prefs.v1",
          voteLog: "opb.votelog.v1",
          counts: "opb.counts.v1",
        };

        const now = () => Date.now();
        const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
        const round1 = (n) => Math.round(n * 10) / 10;
        const safeJsonParse = (text, fallback) => {
          try {
            const v = JSON.parse(text);
            return v ?? fallback;
          } catch {
            return fallback;
          }
        };

        const uid = () => Math.random().toString(16).slice(2) + "-" + Math.random().toString(16).slice(2);
        const formatInt = (n) => new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 }).format(n);
        const formatPct = (n) => `${round1(n)}%`;

        const toastEl = $("#toast");
        let toastTimer = null;
        const toast = (message) => {
          toastEl.textContent = message;
          toastEl.classList.add("show");
          clearTimeout(toastTimer);
          toastTimer = setTimeout(() => toastEl.classList.remove("show"), 1800);
        };
        const announce = (message) => ($("#ariaLive").textContent = message);

        const storage = {
          get(key, fallback) {
            return safeJsonParse(localStorage.getItem(key) || "", fallback);
          },
          set(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
          },
          del(key) {
            localStorage.removeItem(key);
          },
        };

        const seed = (n) => {
          // Tiny deterministic-ish PRNG (for consistent initial vibes, not security)
          let x = (n ^ 0x9e3779b9) >>> 0;
          return () => {
            x ^= x << 13;
            x ^= x >>> 17;
            x ^= x << 5;
            return (x >>> 0) / 4294967296;
          };
        };

        const defaultPolls = (() => {
          const r = seed(1337);
          const mk = (id, question, desc, category, accent, options) => {
            const createdAt = now() - Math.floor(r() * 1000 * 60 * 60 * 24 * 18);
            const opts = options.map((label, i) => ({
              id: `${id}:${i}`,
              label,
              votes: Math.floor(12 + r() * 60),
            }));
            return {
              id,
              question,
              desc,
              category,
              accent,
              createdAt,
              options: opts,
            };
          };

          return [
            mk(
              "weekend-vibe",
              "What’s the perfect Saturday vibe?",
              "Pick the one that makes you feel like the main character (in a good way).",
              "Lifestyle",
              "#5eead4",
              ["Brunch + stroll", "Cozy read & tea", "Hike with friends", "Games + snacks"]
            ),
            mk(
              "coffee-order",
              "Coffee order, no judgment. What are you grabbing?",
              "A tiny ritual, a giant personality test.",
              "Food & Drink",
              "#fb7185",
              ["Iced latte", "Espresso shot", "Cold brew", "Matcha", "Decaf (respect)"]
            ),
            mk(
              "ui-mood",
              "Which UI micro-interaction sparks joy?",
              "These small details make products feel alive.",
              "Design",
              "#a78bfa",
              ["Bouncy toggles", "Smooth skeletons", "Confetti on success", "Gentle haptics", "Subtle gradients"]
            ),
            mk(
              "team-standup",
              "Best standup format?",
              "Choose the style that keeps momentum without draining everyone.",
              "Work",
              "#0ea5e9",
              ["Classic round-robin", "Async updates", "Walking standup", "Kanban walkthrough"]
            ),
            mk(
              "snack-tier",
              "Pick a top-tier desk snack.",
              "This is serious science.",
              "Fun",
              "#fbbf24",
              ["Trail mix", "Chocolate", "Chips", "Fruit", "Popcorn"]
            ),
            mk(
              "next-feature",
              "What should Online Poll Board add next?",
              "Pretend we’re shipping this. Where do we go from here?",
              "Product",
              "#22c55e",
              ["Anonymous comments", "Poll creation", "Time-limited polls", "Export results", "Themes"]
            ),
          ];
        })();

        const COLORS = [
          "linear-gradient(90deg, rgba(94,234,212,.95), rgba(167,139,250,.92), rgba(251,113,133,.86))",
          "linear-gradient(90deg, rgba(14,165,233,.92), rgba(94,234,212,.92))",
          "linear-gradient(90deg, rgba(251,191,36,.92), rgba(251,113,133,.86))",
          "linear-gradient(90deg, rgba(167,139,250,.92), rgba(14,165,233,.9))",
          "linear-gradient(90deg, rgba(34,197,94,.9), rgba(94,234,212,.92))",
        ];

        const state = {
          polls: [],
          selectedId: null,
          search: "",
          sort: "trending",
          live: true,
          votesByPoll: {},
          voteLog: [],
        };

        const el = {
          list: $("#list"),
          empty: $("#empty"),
          search: $("#search"),
          sort: $("#sort"),
          detailBadges: $("#detailBadges"),
          detailTitle: $("#detailTitle"),
          detailDesc: $("#detailDesc"),
          options: $("#options"),
          results: $("#results"),
          stats: $("#stats"),
          voteHint: $("#voteHint"),
          shareBtn: $("#shareBtn"),
          resetVoteBtn: $("#resetVoteBtn"),
          liveSwitch: $("#liveSwitch"),
          focusSearch: $("#focusSearch"),
        };

        const getTotalVotes = (poll) => poll.options.reduce((sum, o) => sum + o.votes, 0);

        const computeTrendingScore = (poll) => {
          // Local-only "trending": blend total votes with recent local activity (last 2 hours)
          const total = getTotalVotes(poll);
          const twoHoursAgo = now() - 2 * 60 * 60 * 1000;
          const recent = state.voteLog.filter((e) => e.pollId === poll.id && e.at >= twoHoursAgo).length;
          return total + recent * 18;
        };

        const getSelectedPoll = () => state.polls.find((p) => p.id === state.selectedId) || null;

        const save = () => {
          storage.set(STORAGE.votes, state.votesByPoll);
          storage.set(STORAGE.voteLog, state.voteLog.slice(-240));
          storage.set(STORAGE.prefs, { live: state.live, sort: state.sort });
          const counts = Object.fromEntries(
            state.polls.map((p) => [p.id, Object.fromEntries(p.options.map((o) => [o.id, o.votes]))])
          );
          storage.set(STORAGE.counts, counts);
          const custom = state.polls.filter((p) => p.custom);
          storage.set(STORAGE.polls, custom);
        };

        const load = () => {
          const customPolls = storage.get(STORAGE.polls, []);
          const votesByPoll = storage.get(STORAGE.votes, {});
          const prefs = storage.get(STORAGE.prefs, {});
          const voteLog = storage.get(STORAGE.voteLog, []);
          const counts = storage.get(STORAGE.counts, {});
          state.voteLog = Array.isArray(voteLog) ? voteLog : [];
          state.votesByPoll = votesByPoll && typeof votesByPoll === "object" ? votesByPoll : {};

          state.live = prefs?.live ?? true;
          state.sort = prefs?.sort ?? "trending";
          el.sort.value = state.sort;
          el.liveSwitch.setAttribute("aria-checked", String(state.live));

          const merged = [
            ...defaultPolls.map((p) => clone(p)),
            ...(Array.isArray(customPolls) ? customPolls : []),
          ];

          // Apply stored vote snapshot? Only for "your vote" marker. Counts are already baked in polls.
          // If custom polls exist, ensure shape.
          state.polls = merged
            .filter((p) => p && p.id && Array.isArray(p.options))
            .map((p) => ({
              ...p,
              createdAt: typeof p.createdAt === "number" ? p.createdAt : now(),
              custom: !!p.custom,
              options: p.options.map((o, i) => ({
                id: o.id || `${p.id}:${i}`,
                label: String(o.label ?? `Option ${i + 1}`),
                votes: clamp(Number(o.votes ?? 0), 0, 1e9),
              })),
            }));

          // Apply locally-persisted counts (if any)
          if (counts && typeof counts === "object") {
            for (const poll of state.polls) {
              const byOpt = counts[poll.id];
              if (!byOpt || typeof byOpt !== "object") continue;
              for (const opt of poll.options) {
                const v = byOpt[opt.id];
                if (typeof v === "number" && Number.isFinite(v)) opt.votes = clamp(v, 0, 1e9);
              }
            }
          }
        };

        const hashToId = () => {
          const h = decodeURIComponent((location.hash || "").replace(/^#/, "").trim());
          if (!h) return null;
          const id = h.split("?")[0].trim();
          return state.polls.some((p) => p.id === id) ? id : null;
        };

        const selectPoll = (id, { scrollList = false, focus = false } = {}) => {
          const poll = state.polls.find((p) => p.id === id);
          if (!poll) return;
          state.selectedId = id;
          location.hash = encodeURIComponent(id);
          renderList();
          renderDetail();
          if (scrollList) {
            const item = el.list.querySelector(`[data-id="${cssEscape(id)}"]`);
            item?.scrollIntoView?.({ block: "nearest", behavior: "smooth" });
          }
          if (focus) {
            el.options.querySelector(".opt")?.focus();
          }
        };

        const getFilteredSortedPolls = () => {
          const q = state.search.trim().toLowerCase();
          let items = state.polls.slice();
          if (q) {
            items = items.filter((p) => {
              const hay = `${p.question} ${p.desc || ""} ${p.category || ""} ${p.options.map((o) => o.label).join(" ")}`.toLowerCase();
              return hay.includes(q);
            });
          }
          switch (state.sort) {
            case "newest":
              items.sort((a, b) => b.createdAt - a.createdAt);
              break;
            case "most":
              items.sort((a, b) => getTotalVotes(b) - getTotalVotes(a));
              break;
            case "az":
              items.sort((a, b) => a.question.localeCompare(b.question));
              break;
            case "trending":
            default:
              items.sort((a, b) => computeTrendingScore(b) - computeTrendingScore(a));
              break;
          }
          return items;
        };

        const miniBarHeights = (poll) => {
          const votes = poll.options.map((o) => o.votes);
          const max = Math.max(1, ...votes);
          return votes.slice(0, 5).map((v, i) => {
            const h = 6 + Math.round((v / max) * 16);
            return clamp(h, 6, 22) + (i % 2 === 0 ? 0 : 0);
          });
        };

        const renderList = () => {
          const items = getFilteredSortedPolls();
          el.list.innerHTML = "";
          el.empty.style.display = items.length ? "none" : "block";

          for (const poll of items) {
            const total = getTotalVotes(poll);
            const your = state.votesByPoll[poll.id] || null;
            const bars = miniBarHeights(poll);

            const card = document.createElement("button");
            card.type = "button";
            card.className = "card";
            card.dataset.id = poll.id;
            card.setAttribute("role", "option");
            card.setAttribute("aria-selected", String(poll.id === state.selectedId));
            card.title = "Open poll";
            card.innerHTML = `
              <div class="cardTop">
                <div style="min-width:0">
                  <div class="q">${escapeHtml(poll.question)}</div>
                </div>
                <div class="miniBars" aria-hidden="true">
                  ${bars
                    .map((h) => `<span style="height:${h}px"></span>`)
                    .join("")}
                </div>
              </div>
              <div class="meta">
                <div class="badgeRow">
                  <span class="badge" title="Category">
                    <span class="sw" style="background:${escapeAttr(poll.accent || "#5eead4")}"></span>
                    ${escapeHtml(poll.category || "Poll")}
                  </span>
                  ${your ? `<span class="badge" title="You voted">✓ Your pick</span>` : ``}
                </div>
                <div title="Total votes">${formatInt(total)} votes</div>
              </div>
            `;
            card.addEventListener("click", () => selectPoll(poll.id, { scrollList: false }));
            el.list.appendChild(card);
          }
        };

        const escapeHtml = (s) =>
          String(s).replace(/[&<>"']/g, (c) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[c]));
        const escapeAttr = (s) => escapeHtml(s).replace(/"/g, "&quot;");

        const animNumber = (node, from, to, duration = 520) => {
          if (!node) return;
          if (matchMedia("(prefers-reduced-motion: reduce)").matches) {
            node.textContent = formatInt(to);
            return;
          }
          const start = performance.now();
          const ease = (t) => 1 - Math.pow(1 - t, 3);
          const tick = (ts) => {
            const t = clamp((ts - start) / duration, 0, 1);
            const v = Math.round(from + (to - from) * ease(t));
            node.textContent = formatInt(v);
            if (t < 1) requestAnimationFrame(tick);
          };
          requestAnimationFrame(tick);
        };

        const makeConfetti = (x, y) => {
          if (matchMedia("(prefers-reduced-motion: reduce)").matches) return;
          const pieces = 18;
          for (let i = 0; i < pieces; i++) {
            const d = document.createElement("div");
            d.className = "confetti";
            d.style.left = `${x}px`;
            d.style.top = `${y}px`;
            d.style.background = ["#5eead4", "#a78bfa", "#fb7185", "#fbbf24", "#0ea5e9", "#22c55e"][i % 6];
            d.style.transform = `translate(-50%, -50%) rotate(${Math.random() * 180}deg)`;
            document.body.appendChild(d);

            const angle = (-Math.PI / 2) + (Math.random() - 0.5) * 1.2;
            const dist = 120 + Math.random() * 140;
            const dx = Math.cos(angle) * dist;
            const dy = Math.sin(angle) * dist + 160;
            const rot = (Math.random() * 720 - 360) | 0;
            const dur = 760 + Math.random() * 380;

            d.animate(
              [
                { transform: `translate(-50%, -50%) translate(0px, 0px) rotate(0deg)`, opacity: 1 },
                { transform: `translate(-50%, -50%) translate(${dx}px, ${dy}px) rotate(${rot}deg)`, opacity: 0 },
              ],
              { duration: dur, easing: "cubic-bezier(.2,.9,.2,1)" }
            );
            setTimeout(() => d.remove(), dur + 40);
          }
        };

        const renderDetail = () => {
          const poll = getSelectedPoll();
          if (!poll) {
            el.detailBadges.innerHTML = "";
            el.detailTitle.textContent = "Select a poll";
            el.detailDesc.textContent = "Pick one from the left to see options and live results.";
            el.options.innerHTML = "";
            el.results.innerHTML = "";
            el.stats.innerHTML = "";
            el.voteHint.textContent = "Choose an option";
            el.shareBtn.disabled = true;
            el.resetVoteBtn.disabled = true;
            return;
          }

          el.shareBtn.disabled = false;
          el.resetVoteBtn.disabled = false;

          el.detailBadges.innerHTML = `
            <span class="badge" title="Category">
              <span class="sw" style="background:${escapeAttr(poll.accent || "#5eead4")}"></span>
              ${escapeHtml(poll.category || "Poll")}
            </span>
            ${poll.custom ? `<span class="badge" title="Custom poll">✦ Custom</span>` : `<span class="badge" title="Built-in poll">★ Featured</span>`}
          `;
          el.detailTitle.textContent = poll.question;
          el.detailDesc.textContent = poll.desc || "Cast your vote to see results.";

          const yourOptionId = state.votesByPoll[poll.id] || null;
          el.voteHint.textContent = yourOptionId ? "You can change your vote anytime" : "Choose one option to vote";

          el.options.innerHTML = "";
          poll.options.forEach((opt, idx) => {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "opt";
            btn.dataset.optId = opt.id;
            btn.setAttribute("aria-pressed", String(opt.id === yourOptionId));
            btn.innerHTML = `
              <div class="label">
                <div class="main">${escapeHtml(opt.label)}</div>
                <div class="sub">${opt.id === yourOptionId ? "Your current vote" : "Tap to vote"}</div>
              </div>
              <div class="count" title="Votes for this option">
                <span class="spark" aria-hidden="true" style="background: ${idx % 2 ? "linear-gradient(135deg, var(--mint), var(--violet))" : "linear-gradient(135deg, var(--amber), var(--rose))"}"></span>
                <span data-count>${formatInt(opt.votes)}</span>
              </div>
            `;
            btn.addEventListener("click", (ev) => onVote(poll.id, opt.id, ev));
            el.options.appendChild(btn);
          });

          renderResults({ animate: false });
          renderStats({ animate: false });
        };

        const renderResults = ({ animate = true } = {}) => {
          const poll = getSelectedPoll();
          if (!poll) return;

          const total = Math.max(0, getTotalVotes(poll));
          el.results.innerHTML = "";
          poll.options.forEach((opt, i) => {
            const pct = total === 0 ? 0 : (opt.votes / total) * 100;
            const row = document.createElement("div");
            row.className = "resRow";
            row.innerHTML = `
              <div class="resTop">
                <div class="resName">${escapeHtml(opt.label)}</div>
                <div class="resNums"><span data-pct>${formatPct(round1(pct))}</span> · <span data-votes>${formatInt(opt.votes)}</span></div>
              </div>
              <div class="barTrack">
                <div class="bar" style="width:${pct}%; background:${COLORS[i % COLORS.length]}"></div>
              </div>
            `;
            el.results.appendChild(row);
          });

          if (!animate || matchMedia("(prefers-reduced-motion: reduce)").matches) return;
          el.results.classList.remove("pop");
          void el.results.offsetWidth;
          el.results.classList.add("pop");
        };

        const renderStats = ({ animate = true } = {}) => {
          const poll = getSelectedPoll();
          if (!poll) return;

          const total = getTotalVotes(poll);
          const yourOptionId = state.votesByPoll[poll.id] || null;
          const yourLabel = poll.options.find((o) => o.id === yourOptionId)?.label || "—";
          const leader = poll.options.reduce(
            (best, o) => (best == null || o.votes > best.votes ? o : best),
            null
          );
          const leaderText = leader ? `${leader.label}` : "—";

          const createdAgoMs = now() - poll.createdAt;
          const days = Math.max(0, Math.floor(createdAgoMs / (1000 * 60 * 60 * 24)));
          const age = days === 0 ? "Today" : days === 1 ? "1 day ago" : `${days} days ago`;

          const tie = leader ? poll.options.filter((o) => o.votes === leader.votes).length > 1 : false;
          const leadLabel = leader ? (tie ? "Tie at the top" : "Current leader") : "Current leader";

          el.stats.innerHTML = `
            <div class="stat">
              <div class="k">Total votes</div>
              <div class="v" id="statTotal">${formatInt(total)}</div>
              <div class="mini">Updated instantly (local-only)</div>
            </div>
            <div class="stat">
              <div class="k">Your vote</div>
              <div class="v" id="statYou">${escapeHtml(yourLabel)}</div>
              <div class="mini">You can change it anytime</div>
            </div>
            <div class="stat">
              <div class="k">${escapeHtml(leadLabel)}</div>
              <div class="v" id="statLead">${escapeHtml(leaderText)}</div>
              <div class="mini">Created: ${escapeHtml(age)}</div>
            </div>
          `;

          if (!animate) return;
          if (matchMedia("(prefers-reduced-motion: reduce)").matches) return;
          const node = $("#statTotal");
          if (node) node.classList.add("pop");
        };

        const updateOptionButtons = () => {
          const poll = getSelectedPoll();
          if (!poll) return;
          const yourOptionId = state.votesByPoll[poll.id] || null;
          $$(".opt", el.options).forEach((btn) => {
            const optId = btn.dataset.optId;
            btn.setAttribute("aria-pressed", String(optId === yourOptionId));
            const sub = btn.querySelector(".sub");
            if (sub) sub.textContent = optId === yourOptionId ? "Your current vote" : "Tap to vote";
          });
        };

        const updateCountsOnly = (pollId, { animate = true } = {}) => {
          const poll = state.polls.find((p) => p.id === pollId);
          if (!poll) return;

          // Options list counts
          $$(".opt", el.options).forEach((btn) => {
            const optId = btn.dataset.optId;
            const opt = poll.options.find((o) => o.id === optId);
            if (!opt) return;
            const countNode = btn.querySelector("[data-count]");
            if (!countNode) return;
            const prev = Number((countNode.textContent || "0").replace(/[^\d]/g, "")) || 0;
            const next = opt.votes;
            if (animate) animNumber(countNode, prev, next, 520);
            else countNode.textContent = formatInt(next);
          });

          // Results list counts + widths
          $$(".resRow", el.results).forEach((row, idx) => {
            const opt = poll.options[idx];
            if (!opt) return;
            const total = Math.max(1, getTotalVotes(poll));
            const pct = (opt.votes / total) * 100;
            const votesNode = row.querySelector("[data-votes]");
            const pctNode = row.querySelector("[data-pct]");
            const bar = row.querySelector(".bar");
            if (votesNode) {
              const prev = Number((votesNode.textContent || "0").replace(/[^\d]/g, "")) || 0;
              if (animate) animNumber(votesNode, prev, opt.votes, 520);
              else votesNode.textContent = formatInt(opt.votes);
            }
            if (pctNode) pctNode.textContent = formatPct(round1(pct));
            if (bar) bar.style.width = `${pct}%`;
          });

          // Stats total
          const statTotal = $("#statTotal");
          if (statTotal) {
            const prev = Number((statTotal.textContent || "0").replace(/[^\d]/g, "")) || 0;
            const next = getTotalVotes(poll);
            if (animate) animNumber(statTotal, prev, next, 560);
            else statTotal.textContent = formatInt(next);
          }
        };

        const onVote = (pollId, optionId, ev) => {
          const poll = state.polls.find((p) => p.id === pollId);
          if (!poll) return;
          const opt = poll.options.find((o) => o.id === optionId);
          if (!opt) return;

          const prevOptionId = state.votesByPoll[pollId] || null;
          if (prevOptionId === optionId) {
            toast("Already voted for that option.");
            announce(`You already voted: ${opt.label}.`);
            return;
          }

          // Update counts for a single user (change vote supported)
          if (prevOptionId) {
            const prevOpt = poll.options.find((o) => o.id === prevOptionId);
            if (prevOpt) prevOpt.votes = Math.max(0, prevOpt.votes - 1);
          }
          opt.votes += 1;
          state.votesByPoll[pollId] = optionId;
          state.voteLog.push({ at: now(), pollId, optionId });
          state.voteLog = state.voteLog.slice(-240);
          save();

          updateOptionButtons();

          // Animate just what changed
          const animate = state.live;
          updateCountsOnly(pollId, { animate });
          if (state.live) {
            el.results.classList.remove("pop");
            void el.results.offsetWidth;
            el.results.classList.add("pop");
          }
          renderStats({ animate: state.live });
          renderList();

          const label = opt.label;
          toast(`Vote counted: “${label}”`);
          announce(`Vote counted: ${label}.`);

          if (ev?.clientX != null && ev?.clientY != null) makeConfetti(ev.clientX, ev.clientY);
        };

        const onResetVote = () => {
          const poll = getSelectedPoll();
          if (!poll) return;
          const prevOptionId = state.votesByPoll[poll.id] || null;
          if (!prevOptionId) {
            toast("No vote to reset for this poll.");
            return;
          }
          const prevOpt = poll.options.find((o) => o.id === prevOptionId);
          if (prevOpt) prevOpt.votes = Math.max(0, prevOpt.votes - 1);
          delete state.votesByPoll[poll.id];
          state.voteLog.push({ at: now(), pollId: poll.id, optionId: null, type: "reset" });
          state.voteLog = state.voteLog.slice(-240);
          save();

          updateOptionButtons();
          updateCountsOnly(poll.id, { animate: state.live });
          renderStats({ animate: state.live });
          renderList();
          toast("Vote reset.");
          announce("Vote reset.");
        };

        const onShare = async () => {
          const poll = getSelectedPoll();
          if (!poll) return;
          const total = getTotalVotes(poll);
          const top = poll.options
            .slice()
            .sort((a, b) => b.votes - a.votes)
            .slice(0, 2)
            .map((o) => `${o.label} (${o.votes})`)
            .join(" · ");

          const base =
            location.origin && location.origin !== "null"
              ? `${location.origin}${location.pathname}`
              : (location.href || "").split("#")[0];
          const url = `${base}#${encodeURIComponent(poll.id)}`;
          const text = `Online Poll Board — ${poll.question}\nTop picks: ${top || "—"}\nTotal votes: ${total}\n${url}`;

          try {
            await navigator.clipboard.writeText(text);
            toast("Copied share snippet to clipboard.");
          } catch {
            // Fallback
            const ta = document.createElement("textarea");
            ta.value = text;
            ta.style.position = "fixed";
            ta.style.opacity = "0";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            ta.remove();
            toast("Copied share snippet.");
          }
          announce("Share snippet copied.");
        };

        const setLive = (v) => {
          state.live = !!v;
          el.liveSwitch.setAttribute("aria-checked", String(state.live));
          save();
          toast(state.live ? "Live results on." : "Live results paused.");
        };

        const focusSearch = () => {
          el.search.focus();
          el.search.select?.();
        };

        const onKeyDown = (e) => {
          const isMac = navigator.platform.toLowerCase().includes("mac");
          const modK = (isMac ? e.metaKey : e.ctrlKey) && e.key.toLowerCase() === "k";
          if (modK) {
            e.preventDefault();
            focusSearch();
            return;
          }

          // Poll list navigation with arrows + Enter
          const active = document.activeElement;
          const inInput = active && (active.tagName === "INPUT" || active.tagName === "TEXTAREA" || active.isContentEditable);
          if (inInput) return;

          const items = $$(".card", el.list);
          if (!items.length) return;
          const idx = items.findIndex((n) => n.dataset.id === state.selectedId);
          if (e.key === "ArrowDown") {
            e.preventDefault();
            const next = items[clamp((idx < 0 ? 0 : idx + 1), 0, items.length - 1)];
            if (next) selectPoll(next.dataset.id, { scrollList: true });
          } else if (e.key === "ArrowUp") {
            e.preventDefault();
            const prev = items[clamp((idx < 0 ? 0 : idx - 1), 0, items.length - 1)];
            if (prev) selectPoll(prev.dataset.id, { scrollList: true });
          } else if (e.key === "Enter") {
            if (state.selectedId) {
              // Focus first option for speedy voting
              el.options.querySelector(".opt")?.focus();
            } else {
              selectPoll(items[0].dataset.id, { scrollList: true });
            }
          }
        };

        const init = () => {
          load();
          const idFromHash = hashToId();
          state.selectedId = idFromHash || state.polls[0]?.id || null;
          if (state.selectedId) location.hash = encodeURIComponent(state.selectedId);

          renderList();
          renderDetail();

          el.search.addEventListener("input", () => {
            state.search = el.search.value;
            renderList();
          });
          el.sort.addEventListener("change", () => {
            state.sort = el.sort.value;
            save();
            renderList();
          });
          el.shareBtn.addEventListener("click", onShare);
          el.resetVoteBtn.addEventListener("click", onResetVote);
          el.liveSwitch.addEventListener("click", () => setLive(!state.live));
          el.focusSearch.addEventListener("click", focusSearch);
          window.addEventListener("hashchange", () => {
            const id = hashToId();
            if (id && id !== state.selectedId) selectPoll(id);
          });
          window.addEventListener("keydown", onKeyDown, { passive: false });

          toast("Welcome! Pick a poll and vote.");
        };

        init();
      })();
    </script>
  </body>
</html>
