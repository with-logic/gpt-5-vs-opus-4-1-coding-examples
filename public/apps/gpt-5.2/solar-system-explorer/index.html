<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="dark" />
    <title>Solar System Explorer</title>
    <style>
      :root {
        --bg0: #05070d;
        --bg1: #070a12;
        --panel: rgba(14, 18, 30, 0.72);
        --panel2: rgba(14, 18, 30, 0.52);
        --stroke: rgba(255, 255, 255, 0.14);
        --stroke2: rgba(255, 255, 255, 0.10);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.72);
        --muted2: rgba(255, 255, 255, 0.58);
        --accent: #7dd3fc;
        --accent2: #a78bfa;
        --good: #34d399;
        --warn: #fbbf24;
        --danger: #fb7185;
        --shadow: rgba(0, 0, 0, 0.45);
        --radius: 16px;
        --radius2: 20px;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
          "Segoe UI Emoji";
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        background: radial-gradient(1200px 900px at 50% 35%, #0b1230 0%, #060813 45%, var(--bg0) 100%);
        color: var(--text);
        font-family: var(--sans);
        overflow: hidden;
      }

      #app {
        position: relative;
        height: 100%;
        width: 100%;
      }

      canvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        display: block;
        background: transparent;
        outline: none;
        touch-action: none;
      }

      .hud {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .panel {
        pointer-events: auto;
        background: linear-gradient(180deg, rgba(18, 24, 40, 0.82) 0%, rgba(12, 16, 26, 0.64) 100%);
        border: 1px solid var(--stroke);
        box-shadow: 0 18px 50px var(--shadow);
        border-radius: var(--radius2);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .topbar {
        position: absolute;
        left: 16px;
        right: 16px;
        top: 16px;
        display: grid;
        grid-template-columns: 1.25fr 1fr;
        gap: 12px;
        align-items: start;
      }

      @media (max-width: 900px) {
        .topbar {
          grid-template-columns: 1fr;
        }
      }

      .brand {
        padding: 14px 14px 12px 14px;
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .mark {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: radial-gradient(circle at 30% 30%, rgba(255, 214, 102, 0.95), rgba(255, 123, 67, 0.18) 55%),
          radial-gradient(circle at 65% 70%, rgba(125, 211, 252, 0.18), rgba(167, 139, 250, 0.12) 60%),
          rgba(15, 18, 30, 0.55);
        box-shadow: 0 14px 34px rgba(0, 0, 0, 0.38);
        position: relative;
        overflow: hidden;
      }

      .mark::after {
        content: "";
        position: absolute;
        inset: -40% -50%;
        background: conic-gradient(
          from 90deg,
          rgba(125, 211, 252, 0.0),
          rgba(125, 211, 252, 0.28),
          rgba(167, 139, 250, 0.24),
          rgba(251, 113, 133, 0.18),
          rgba(125, 211, 252, 0.0)
        );
        filter: blur(8px);
        opacity: 0.75;
        animation: spin 7.5s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .brand h1 {
        margin: 0;
        font-size: 16px;
        font-weight: 720;
        letter-spacing: 0.2px;
        line-height: 1.15;
      }

      .brand .sub {
        margin-top: 3px;
        font-size: 12.5px;
        color: var(--muted);
        line-height: 1.15;
      }

      .controls {
        padding: 14px;
        display: grid;
        gap: 10px;
      }

      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .row label {
        font-size: 12.5px;
        color: var(--muted);
      }

      .kbd {
        font-family: var(--mono);
        font-size: 11px;
        color: rgba(255, 255, 255, 0.78);
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.14);
        padding: 2px 6px;
        border-radius: 8px;
      }

      .seg {
        display: inline-flex;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 999px;
        padding: 2px;
        gap: 2px;
      }

      button,
      input[type="range"] {
        pointer-events: auto;
      }

      button {
        appearance: none;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.14);
        color: var(--text);
        padding: 8px 10px;
        border-radius: 12px;
        font-size: 12.5px;
        line-height: 1;
        cursor: pointer;
        transition: transform 0.06s ease, background 0.16s ease, border-color 0.16s ease;
        user-select: none;
        white-space: nowrap;
      }

      button:hover {
        background: rgba(255, 255, 255, 0.11);
        border-color: rgba(255, 255, 255, 0.18);
      }

      button:active {
        transform: translateY(1px);
      }

      button.primary {
        background: linear-gradient(180deg, rgba(125, 211, 252, 0.22), rgba(167, 139, 250, 0.16));
        border-color: rgba(125, 211, 252, 0.35);
      }

      button.primary:hover {
        background: linear-gradient(180deg, rgba(125, 211, 252, 0.28), rgba(167, 139, 250, 0.20));
        border-color: rgba(125, 211, 252, 0.46);
      }

      button.danger {
        border-color: rgba(251, 113, 133, 0.44);
        background: rgba(251, 113, 133, 0.10);
      }

      button.small {
        padding: 7px 9px;
        border-radius: 11px;
      }

      .pill {
        font-family: var(--mono);
        font-size: 11px;
        color: rgba(255, 255, 255, 0.80);
        background: rgba(0, 0, 0, 0.18);
        border: 1px solid rgba(255, 255, 255, 0.12);
        padding: 4px 8px;
        border-radius: 999px;
      }

      .slider {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        gap: 10px;
      }

      input[type="range"] {
        width: 100%;
        accent-color: var(--accent);
      }

      .toggleRow {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: flex-end;
      }

      .info {
        position: absolute;
        left: 16px;
        bottom: 16px;
        width: min(420px, calc(100vw - 32px));
        padding: 14px;
      }

      .infoHeader {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 10px;
      }

      .infoTitle {
        display: grid;
        gap: 2px;
      }

      .infoTitle h2 {
        margin: 0;
        font-size: 14px;
        letter-spacing: 0.2px;
      }

      .infoTitle .hint {
        font-size: 12px;
        color: var(--muted);
      }

      .facts {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-top: 10px;
      }

      .fact {
        border: 1px solid var(--stroke2);
        background: rgba(0, 0, 0, 0.18);
        border-radius: 14px;
        padding: 10px;
        min-height: 58px;
      }

      .fact .k {
        font-size: 11px;
        color: var(--muted2);
        letter-spacing: 0.2px;
        margin-bottom: 4px;
      }

      .fact .v {
        font-family: var(--mono);
        font-size: 12px;
        color: rgba(255, 255, 255, 0.88);
      }

      .desc {
        font-size: 12.5px;
        color: var(--muted);
        line-height: 1.35;
      }

      .actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 10px;
      }

      .footerTip {
        margin-top: 10px;
        font-size: 11.5px;
        color: rgba(255, 255, 255, 0.55);
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      .labelLayer {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .label {
        position: absolute;
        left: 0;
        top: 0;
        transform: translate(-9999px, -9999px);
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(10, 12, 18, 0.45);
        color: rgba(255, 255, 255, 0.84);
        font-size: 12px;
        letter-spacing: 0.1px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 14px 34px rgba(0, 0, 0, 0.25);
        opacity: 0;
        transition: opacity 0.16s ease;
        white-space: nowrap;
      }

      .label.on {
        opacity: 1;
      }

      .toast {
        position: absolute;
        right: 16px;
        bottom: 16px;
        width: min(420px, calc(100vw - 32px));
        padding: 12px 14px;
        border-radius: var(--radius2);
        background: rgba(10, 12, 18, 0.52);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: rgba(255, 255, 255, 0.70);
        pointer-events: none;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 22px 60px rgba(0, 0, 0, 0.35);
        display: grid;
        gap: 6px;
      }

      .toast strong {
        color: rgba(255, 255, 255, 0.88);
        font-size: 12.5px;
      }

      .toast .tiny {
        font-size: 11.5px;
        color: rgba(255, 255, 255, 0.56);
      }

      .srOnly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <canvas id="c" tabindex="0" aria-label="3D solar system viewer"></canvas>

      <div class="hud" aria-hidden="false">
        <div class="topbar">
          <div class="panel brand">
            <div class="mark" aria-hidden="true"></div>
            <div>
              <h1>Solar System Explorer</h1>
              <div class="sub">Drag to rotate • Scroll to zoom • Click a planet for details</div>
            </div>
          </div>

          <div class="panel controls" aria-label="Controls">
            <div class="row">
              <label for="speed">Orbit speed</label>
              <span class="pill" id="speedVal">1.00×</span>
            </div>
            <div class="slider">
              <input id="speed" type="range" min="0" max="4" step="0.01" value="1" />
              <button id="pauseBtn" class="small">Pause</button>
            </div>
            <div class="row">
              <label>View</label>
              <div class="toggleRow">
                <button id="centerBtn" class="small">Center</button>
                <button id="resetBtn" class="small">Reset</button>
                <button id="orbitsBtn" class="small primary" aria-pressed="true">Orbits: On</button>
                <button id="labelsBtn" class="small" aria-pressed="true">Labels: On</button>
              </div>
            </div>
            <div class="row">
              <label>Zoom</label>
              <div class="toggleRow">
                <button id="zoomInBtn" class="small">+</button>
                <button id="zoomOutBtn" class="small">−</button>
              </div>
            </div>
            <div class="row">
              <label>Shortcuts</label>
              <div class="toggleRow">
                <span class="kbd">Click</span>
                <span class="kbd">Drag</span>
                <span class="kbd">Wheel</span>
                <span class="kbd">Space</span>
              </div>
            </div>
          </div>
        </div>

        <div class="panel info" id="info" aria-live="polite">
          <div class="infoHeader">
            <div class="infoTitle">
              <h2 id="infoName">Welcome</h2>
              <div class="hint" id="infoHint">Select a planet to explore.</div>
            </div>
            <button id="closeInfoBtn" class="small danger" title="Clear selection">Clear</button>
          </div>
          <div class="desc" id="infoDesc">
            This is a stylized, interactive model of the Solar System. Distances and sizes are scaled for clarity, not to
            real proportions.
          </div>
          <div class="facts" id="facts" aria-label="Facts">
            <div class="fact">
              <div class="k">Selected</div>
              <div class="v" id="factSelected">—</div>
            </div>
            <div class="fact">
              <div class="k">Distance (AU)</div>
              <div class="v" id="factAU">—</div>
            </div>
            <div class="fact">
              <div class="k">Year (Earth days)</div>
              <div class="v" id="factYear">—</div>
            </div>
            <div class="fact">
              <div class="k">Radius (km)</div>
              <div class="v" id="factRadius">—</div>
            </div>
          </div>
          <div class="actions">
            <button id="focusBtn" class="primary">Focus planet</button>
            <button id="overviewBtn">Overview</button>
          </div>
          <div class="footerTip">
            <span>Tip:</span>
            <span class="kbd">Space</span>
            <span>toggles pause</span>
            <span>•</span>
            <span class="kbd">Esc</span>
            <span>clears selection</span>
          </div>
        </div>

        <div class="labelLayer" id="labelLayer" aria-hidden="true"></div>

        <div class="toast" id="toast" aria-hidden="true">
          <strong>Click a planet</strong>
          <div>Then drag to orbit the camera around your focus point.</div>
          <div class="tiny">This demo runs entirely in one HTML file.</div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script>
      (() => {
        "use strict";

        if (!window.THREE) {
          const el = document.createElement("div");
          el.style.position = "fixed";
          el.style.inset = "16px";
          el.style.padding = "16px";
          el.style.borderRadius = "16px";
          el.style.border = "1px solid rgba(255,255,255,0.16)";
          el.style.background = "rgba(10,12,18,0.72)";
          el.style.backdropFilter = "blur(10px)";
          el.style.color = "rgba(255,255,255,0.92)";
          el.style.fontFamily =
            'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"';
          el.innerHTML =
            "<div style='font-weight:700;margin-bottom:6px'>Solar System Explorer</div><div style='opacity:.75;line-height:1.35'>Three.js failed to load from the CDN. Please check your network connection and refresh.</div>";
          document.body.appendChild(el);
          return;
        }

        const prefersReducedMotion = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches ?? false;

        const $ = (id) => document.getElementById(id);
        const canvas = $("c");
        const labelLayer = $("labelLayer");
        const toast = $("toast");

        const ui = {
          speed: $("speed"),
          speedVal: $("speedVal"),
          pauseBtn: $("pauseBtn"),
          resetBtn: $("resetBtn"),
          centerBtn: $("centerBtn"),
          orbitsBtn: $("orbitsBtn"),
          labelsBtn: $("labelsBtn"),
          zoomInBtn: $("zoomInBtn"),
          zoomOutBtn: $("zoomOutBtn"),
          infoName: $("infoName"),
          infoHint: $("infoHint"),
          infoDesc: $("infoDesc"),
          closeInfoBtn: $("closeInfoBtn"),
          factSelected: $("factSelected"),
          factAU: $("factAU"),
          factYear: $("factYear"),
          factRadius: $("factRadius"),
          focusBtn: $("focusBtn"),
          overviewBtn: $("overviewBtn")
        };

        const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
        const lerp = (a, b, t) => a + (b - a) * t;
        const damp = (a, b, lambda, dt) => lerp(a, b, 1 - Math.exp(-lambda * dt));

        function formatNumber(n) {
          const abs = Math.abs(n);
          if (abs >= 1e9) return `${(n / 1e9).toFixed(2)}B`;
          if (abs >= 1e6) return `${(n / 1e6).toFixed(2)}M`;
          if (abs >= 1e3) return `${(n / 1e3).toFixed(2)}k`;
          return `${n}`;
        }

        function makeRadialTexture({ size = 256, stops = [] } = {}) {
          const cnv = document.createElement("canvas");
          cnv.width = cnv.height = size;
          const ctx = cnv.getContext("2d");
          const g = ctx.createRadialGradient(size / 2, size / 2, 0, size / 2, size / 2, size / 2);
          for (const s of stops) g.addColorStop(s[0], s[1]);
          ctx.fillStyle = g;
          ctx.fillRect(0, 0, size, size);
          const tex = new THREE.CanvasTexture(cnv);
          tex.colorSpace = THREE.SRGBColorSpace ?? tex.colorSpace;
          tex.needsUpdate = true;
          return tex;
        }

        function deg(v) {
          return (v * Math.PI) / 180;
        }

        // --- Three.js setup
        const renderer = new THREE.WebGLRenderer({
          canvas,
          antialias: true,
          alpha: false,
          powerPreference: "high-performance"
        });

        renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
        renderer.setSize(window.innerWidth, window.innerHeight, false);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.05;
        if ("physicallyCorrectLights" in renderer) renderer.physicallyCorrectLights = true;
        if ("useLegacyLights" in renderer) renderer.useLegacyLights = false;
        if ("outputColorSpace" in renderer) renderer.outputColorSpace = THREE.SRGBColorSpace;

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x05070d);
        scene.fog = new THREE.FogExp2(0x05070d, 0.0032);

        const camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 1000);

        const focus = {
          current: new THREE.Vector3(0, 0, 0),
          desired: new THREE.Vector3(0, 0, 0)
        };

        const orbit = {
          theta: 0.95,
          phi: 1.10,
          radius: 135,
          dTheta: 0.95,
          dPhi: 1.10,
          dRadius: 135,
          minR: 28,
          maxR: 240
        };

        const up = new THREE.Vector3(0, 1, 0);
        const raycaster = new THREE.Raycaster();
        const pointer = new THREE.Vector2(999, 999);

        const root = new THREE.Group();
        scene.add(root);

        // Lights
        const ambient = new THREE.AmbientLight(0xb0c6ff, 0.09);
        scene.add(ambient);

        const sunLight = new THREE.PointLight(0xfff3c4, 1200, 0, 2);
        sunLight.position.set(0, 0, 0);
        scene.add(sunLight);

        // Sun
        const sunGeo = new THREE.SphereGeometry(6.2, 64, 40);
        const sunMat = new THREE.MeshStandardMaterial({
          color: 0xffb347,
          emissive: 0xffb347,
          emissiveIntensity: 2.4,
          roughness: 0.6,
          metalness: 0.0
        });
        const sun = new THREE.Mesh(sunGeo, sunMat);
        sun.name = "Sun";
        root.add(sun);

        const sunGlowTex = makeRadialTexture({
          size: 256,
          stops: [
            [0.0, "rgba(255,210,120,0.95)"],
            [0.22, "rgba(255,160,80,0.55)"],
            [0.55, "rgba(125,211,252,0.12)"],
            [1.0, "rgba(0,0,0,0.0)"]
          ]
        });
        const sunGlow = new THREE.Sprite(
          new THREE.SpriteMaterial({
            map: sunGlowTex,
            blending: THREE.AdditiveBlending,
            depthWrite: false,
            transparent: true,
            opacity: 0.85
          })
        );
        sunGlow.scale.set(42, 42, 1);
        root.add(sunGlow);

        // Stars
        function makeStarfield({ count = 3800, radius = 520 } = {}) {
          const positions = new Float32Array(count * 3);
          const colors = new Float32Array(count * 3);
          const color = new THREE.Color();
          for (let i = 0; i < count; i++) {
            const u = Math.random();
            const v = Math.random();
            const theta = 2 * Math.PI * u;
            const phi = Math.acos(2 * v - 1);
            const r = radius * (0.65 + Math.random() * 0.35);
            const sPhi = Math.sin(phi);
            const x = r * sPhi * Math.cos(theta);
            const y = r * Math.cos(phi);
            const z = r * sPhi * Math.sin(theta);
            positions[i * 3 + 0] = x;
            positions[i * 3 + 1] = y;
            positions[i * 3 + 2] = z;

            const t = Math.random();
            if (t < 0.7) color.setHSL(0.58 + Math.random() * 0.08, 0.35, 0.72);
            else if (t < 0.9) color.setHSL(0.10 + Math.random() * 0.06, 0.55, 0.75);
            else color.setHSL(0.80 + Math.random() * 0.05, 0.35, 0.78);
            const jitter = 0.9 + Math.random() * 0.22;
            colors[i * 3 + 0] = color.r * jitter;
            colors[i * 3 + 1] = color.g * jitter;
            colors[i * 3 + 2] = color.b * jitter;
          }

          const geom = new THREE.BufferGeometry();
          geom.setAttribute("position", new THREE.BufferAttribute(positions, 3));
          geom.setAttribute("color", new THREE.BufferAttribute(colors, 3));
          const mat = new THREE.PointsMaterial({
            size: 1.0,
            sizeAttenuation: true,
            vertexColors: true,
            transparent: true,
            opacity: 0.85,
            depthWrite: false
          });
          const pts = new THREE.Points(geom, mat);
          pts.frustumCulled = false;
          return pts;
        }
        const stars = makeStarfield();
        scene.add(stars);

        // Ecliptic guide plane
        const grid = new THREE.RingGeometry(18, 18.15, 128);
        const gridMat = new THREE.MeshBasicMaterial({
          color: 0x9fb7ff,
          transparent: true,
          opacity: 0.08,
          side: THREE.DoubleSide
        });
        const ecliptic = new THREE.Mesh(grid, gridMat);
        ecliptic.rotation.x = Math.PI / 2;
        root.add(ecliptic);

        const PLANETS = [
          {
            id: "mercury",
            name: "Mercury",
            color: 0xb2b2b2,
            radius: 0.95,
            radiusKm: 2439.7,
            au: 0.39,
            a: 12.5,
            e: 0.16,
            inclination: 7.0,
            yearDays: 88,
            dayHours: 1407.6,
            blurb: "Smallest planet. A heavily cratered, airless world that races around the Sun."
          },
          {
            id: "venus",
            name: "Venus",
            color: 0xe8c28b,
            radius: 1.35,
            radiusKm: 6051.8,
            au: 0.72,
            a: 17.8,
            e: 0.07,
            inclination: 3.4,
            yearDays: 225,
            dayHours: -5832.5,
            blurb: "Earth-sized, but with a crushing atmosphere and runaway greenhouse heat. Spins backward."
          },
          {
            id: "earth",
            name: "Earth",
            color: 0x4aa3ff,
            radius: 1.42,
            radiusKm: 6371.0,
            au: 1.0,
            a: 24.6,
            e: 0.02,
            inclination: 0.0,
            yearDays: 365.25,
            dayHours: 23.93,
            blurb: "Our home world—liquid oceans, dynamic weather, and the only known planet with life."
          },
          {
            id: "mars",
            name: "Mars",
            color: 0xff6d4a,
            radius: 1.10,
            radiusKm: 3389.5,
            au: 1.52,
            a: 32.8,
            e: 0.09,
            inclination: 1.85,
            yearDays: 687,
            dayHours: 24.62,
            blurb: "The Red Planet—cold deserts, giant volcanoes, and ancient signs of water."
          },
          {
            id: "jupiter",
            name: "Jupiter",
            color: 0xf2d0a7,
            radius: 3.25,
            radiusKm: 69911,
            au: 5.20,
            a: 52.0,
            e: 0.05,
            inclination: 1.3,
            yearDays: 4333,
            dayHours: 9.93,
            blurb: "Gas giant and king of planets, with fierce storms and dozens of moons."
          },
          {
            id: "saturn",
            name: "Saturn",
            color: 0xffe2a8,
            radius: 2.90,
            radiusKm: 58232,
            au: 9.58,
            a: 70.0,
            e: 0.06,
            inclination: 2.5,
            yearDays: 10759,
            dayHours: 10.7,
            rings: true,
            blurb: "Famous for its icy rings. A pale giant with a surprisingly low density."
          },
          {
            id: "uranus",
            name: "Uranus",
            color: 0xa6f0ff,
            radius: 2.18,
            radiusKm: 25362,
            au: 19.2,
            a: 88.0,
            e: 0.05,
            inclination: 0.8,
            yearDays: 30687,
            dayHours: -17.2,
            rings: "thin",
            blurb: "Ice giant tipped on its side—an extreme tilt makes its seasons wild and long."
          },
          {
            id: "neptune",
            name: "Neptune",
            color: 0x5a7dff,
            radius: 2.12,
            radiusKm: 24622,
            au: 30.05,
            a: 104.0,
            e: 0.01,
            inclination: 1.8,
            yearDays: 60190,
            dayHours: 16.1,
            blurb: "Deep-blue ice giant with supersonic winds and a stormy, dynamic atmosphere."
          }
        ];

        const clickable = [];
        const planetState = new Map();
        const labels = new Map();

        const shared = {
          sphereHi: new THREE.SphereGeometry(1, 48, 32),
          sphereLo: new THREE.SphereGeometry(1, 32, 22),
          orbitMat: new THREE.LineBasicMaterial({ color: 0x8aa3ff, transparent: true, opacity: 0.22 }),
          orbitMatDim: new THREE.LineBasicMaterial({ color: 0x8aa3ff, transparent: true, opacity: 0.08 })
        };

        function addPlanet(p) {
          const orbitGroup = new THREE.Group();
          orbitGroup.rotation.z = deg((Math.random() * 14 - 7) * 0.25);
          orbitGroup.rotation.x = deg(p.inclination);
          orbitGroup.name = `${p.name} OrbitGroup`;
          root.add(orbitGroup);

          const useGeo = p.radius >= 2.5 ? shared.sphereHi : shared.sphereLo;
          const mat = new THREE.MeshStandardMaterial({
            color: p.color,
            roughness: 0.92,
            metalness: 0.0,
            emissive: new THREE.Color(p.color).multiplyScalar(0.12),
            emissiveIntensity: 1.0
          });
          const mesh = new THREE.Mesh(useGeo, mat);
          mesh.scale.setScalar(p.radius);
          mesh.castShadow = false;
          mesh.receiveShadow = false;
          mesh.name = p.name;
          mesh.userData.planetId = p.id;
          orbitGroup.add(mesh);

          // Subtle atmosphere-ish rim for Earth/Venus/Neptune
          let rim = null;
          if (p.id === "earth" || p.id === "venus" || p.id === "neptune") {
            const rimTex = makeRadialTexture({
              size: 256,
              stops: [
                [0.0, "rgba(0,0,0,0.0)"],
                [0.55, "rgba(0,0,0,0.0)"],
                [0.78, "rgba(125,211,252,0.18)"],
                [1.0, "rgba(0,0,0,0.0)"]
              ]
            });
            rim = new THREE.Sprite(
              new THREE.SpriteMaterial({
                map: rimTex,
                transparent: true,
                opacity: 0.85,
                depthWrite: false,
                blending: THREE.AdditiveBlending
              })
            );
            rim.scale.set(7.0 * p.radius, 7.0 * p.radius, 1);
            mesh.add(rim);
          }

          // Rings
          let ringMesh = null;
          if (p.rings) {
            const inner = p.id === "saturn" ? p.radius * 1.25 : p.radius * 1.15;
            const outer = p.id === "saturn" ? p.radius * 2.35 : p.radius * 1.55;
            const ringGeo = new THREE.RingGeometry(inner, outer, 128, 1);
            const ringTex = makeRadialTexture({
              size: 512,
              stops:
                p.id === "saturn"
                  ? [
                      [0.0, "rgba(0,0,0,0.0)"],
                      [0.20, "rgba(0,0,0,0.0)"],
                      [0.28, "rgba(255,255,255,0.20)"],
                      [0.48, "rgba(255,220,170,0.18)"],
                      [0.65, "rgba(170,220,255,0.12)"],
                      [0.82, "rgba(255,255,255,0.10)"],
                      [1.0, "rgba(0,0,0,0.0)"]
                    ]
                  : [
                      [0.0, "rgba(0,0,0,0.0)"],
                      [0.40, "rgba(0,0,0,0.0)"],
                      [0.58, "rgba(255,255,255,0.10)"],
                      [0.84, "rgba(125,211,252,0.09)"],
                      [1.0, "rgba(0,0,0,0.0)"]
                    ]
            });

            const ringMat = new THREE.MeshBasicMaterial({
              map: ringTex,
              color: p.id === "saturn" ? 0xfff1c1 : 0xbfefff,
              transparent: true,
              opacity: p.id === "saturn" ? 0.7 : 0.45,
              side: THREE.DoubleSide,
              depthWrite: false
            });
            ringMesh = new THREE.Mesh(ringGeo, ringMat);
            ringMesh.rotation.x = Math.PI / 2;
            ringMesh.rotation.z = deg(p.id === "saturn" ? 12 : 18);
            ringMesh.userData.planetId = p.id;
            mesh.add(ringMesh);
            clickable.push(ringMesh);
          }

          // Orbit line
          const b = p.a * (1 - Math.min(0.55, p.e));
          const points = [];
          const steps = 320;
          for (let i = 0; i <= steps; i++) {
            const t = (i / steps) * Math.PI * 2;
            points.push(new THREE.Vector3(Math.cos(t) * p.a, 0, Math.sin(t) * b));
          }
          const orbitGeom = new THREE.BufferGeometry().setFromPoints(points);
          const orbitLine = new THREE.LineLoop(orbitGeom, shared.orbitMat);
          orbitLine.renderOrder = 0;
          orbitGroup.add(orbitLine);

          const highlight = new THREE.Mesh(
            new THREE.TorusGeometry(p.radius * 1.25, Math.max(0.08, p.radius * 0.14), 16, 64),
            new THREE.MeshBasicMaterial({
              color: 0x7dd3fc,
              transparent: true,
              opacity: 0.0,
              depthWrite: false
            })
          );
          highlight.rotation.x = Math.PI / 2;
          mesh.add(highlight);

          // A few moons (stylized)
          const moons = [];
          function addMoon({ name, radius, dist, color, speed }) {
            const pivot = new THREE.Group();
            const moonMat = new THREE.MeshStandardMaterial({
              color,
              roughness: 0.98,
              metalness: 0.0,
              emissive: new THREE.Color(color).multiplyScalar(0.05),
              emissiveIntensity: 1.0
            });
            const moonMesh = new THREE.Mesh(shared.sphereLo, moonMat);
            moonMesh.scale.setScalar(radius);
            pivot.add(moonMesh);
            mesh.add(pivot);
            moons.push({ name, pivot, moonMesh, dist, speed, angle: Math.random() * Math.PI * 2 });
          }

          if (p.id === "earth") {
            addMoon({ name: "Moon", radius: 0.38, dist: p.radius * 2.4, color: 0xd7d7df, speed: 1.0 });
          } else if (p.id === "jupiter") {
            addMoon({ name: "Io", radius: 0.34, dist: p.radius * 2.1, color: 0xffd28a, speed: 1.4 });
            addMoon({ name: "Europa", radius: 0.31, dist: p.radius * 2.8, color: 0xcfe6ff, speed: 1.1 });
          } else if (p.id === "saturn") {
            addMoon({ name: "Titan", radius: 0.40, dist: p.radius * 2.55, color: 0xffd7a6, speed: 0.95 });
          }

          clickable.push(mesh);

          // Label DOM element
          const label = document.createElement("div");
          label.className = "label";
          label.textContent = p.name;
          labelLayer.appendChild(label);
          labels.set(p.id, label);

          // Per-planet orbit parameters
          const baseAngular = (2 * Math.PI) / (p.yearDays || 365.25);
          const state = {
            p,
            orbitGroup,
            orbitLine,
            mesh,
            ringMesh,
            rim,
            highlight,
            moons,
            angle: Math.random() * Math.PI * 2,
            spin: (p.dayHours ? (2 * Math.PI) / Math.max(4, Math.abs(p.dayHours)) : 0.2) * (p.dayHours < 0 ? -1 : 1),
            angular: baseAngular,
            b,
            hover: false,
            selected: false
          };
          planetState.set(p.id, state);
        }

        for (const p of PLANETS) addPlanet(p);

        // Asteroid belt (stylized)
        (function addAsteroids() {
          const count = 1200;
          const geo = new THREE.SphereGeometry(0.13, 8, 8);
          const mat = new THREE.MeshStandardMaterial({ color: 0xa9a9b6, roughness: 1.0, metalness: 0.0 });
          const inst = new THREE.InstancedMesh(geo, mat, count);
          inst.instanceMatrix.setUsage(THREE.DynamicDrawUsage);
          const m = new THREE.Matrix4();
          const v = new THREE.Vector3();
          const q = new THREE.Quaternion();
          const s = new THREE.Vector3();
          for (let i = 0; i < count; i++) {
            const t = Math.random() * Math.PI * 2;
            const r = 41.5 + Math.random() * 9.5;
            const y = (Math.random() - 0.5) * 0.9;
            const jitter = (Math.random() - 0.5) * 1.1;
            v.set(Math.cos(t) * (r + jitter), y, Math.sin(t) * (r - jitter * 0.55));
            q.setFromEuler(new THREE.Euler(Math.random() * 2, Math.random() * 2, Math.random() * 2));
            const k = 0.6 + Math.random() * 1.2;
            s.setScalar(k);
            m.compose(v, q, s);
            inst.setMatrixAt(i, m);
          }
          inst.position.y = 0;
          root.add(inst);
        })();

        // --- Interaction state
        const input = {
          down: false,
          drag: false,
          startX: 0,
          startY: 0,
          lastX: 0,
          lastY: 0,
          startT: 0,
          pointerId: null
        };

        let isPaused = false;
        let showOrbits = true;
        let showLabels = true;
        let speedMultiplier = prefersReducedMotion ? 0.45 : 1.0;
        let selectedId = null;
        let hoveredId = null;
        let toastTimer = 0;

        function setToastVisible(v) {
          toast.style.opacity = v ? "1" : "0";
          toast.style.transition = "opacity 0.22s ease";
        }
        setToastVisible(true);
        toastTimer = 6.5;

        function updateInfo(id) {
          if (!id) {
            ui.infoName.textContent = "Welcome";
            ui.infoHint.textContent = "Select a planet to explore.";
            ui.infoDesc.textContent =
              "This is a stylized, interactive model of the Solar System. Distances and sizes are scaled for clarity, not to real proportions.";
            ui.factSelected.textContent = "—";
            ui.factAU.textContent = "—";
            ui.factYear.textContent = "—";
            ui.factRadius.textContent = "—";
            ui.focusBtn.disabled = true;
            return;
          }
          const s = planetState.get(id);
          if (!s) return;
          ui.infoName.textContent = s.p.name;
          ui.infoHint.textContent = "Click other planets to compare.";
          ui.infoDesc.textContent = s.p.blurb;
          ui.factSelected.textContent = s.p.name;
          ui.factAU.textContent = `${s.p.au.toFixed(2)} AU`;
          ui.factYear.textContent = `${formatNumber(Math.round(s.p.yearDays))} d`;
          ui.factRadius.textContent = `${formatNumber(Math.round(s.p.radiusKm))} km`;
          ui.focusBtn.disabled = false;
        }

        function clearSelection() {
          if (selectedId && planetState.has(selectedId)) {
            const prev = planetState.get(selectedId);
            prev.selected = false;
            prev.highlight.material.opacity = 0.0;
          }
          selectedId = null;
          updateInfo(null);
        }

        function selectPlanet(id) {
          if (!planetState.has(id)) return;
          if (selectedId === id) return;
          clearSelection();
          selectedId = id;
          const s = planetState.get(id);
          s.selected = true;
          s.highlight.material.opacity = 0.65;
          updateInfo(id);
          setToastVisible(false);
        }

        function setOrbitsVisible(on) {
          showOrbits = on;
          for (const s of planetState.values()) s.orbitLine.visible = on;
          ui.orbitsBtn.textContent = `Orbits: ${on ? "On" : "Off"}`;
          ui.orbitsBtn.setAttribute("aria-pressed", on ? "true" : "false");
        }

        function setLabelsVisible(on) {
          showLabels = on;
          ui.labelsBtn.textContent = `Labels: ${on ? "On" : "Off"}`;
          ui.labelsBtn.setAttribute("aria-pressed", on ? "true" : "false");
          if (!on) {
            for (const el of labels.values()) el.classList.remove("on");
          }
        }

        function focusOn(id) {
          if (!id || !planetState.has(id)) return;
          const s = planetState.get(id);
          const w = new THREE.Vector3();
          s.mesh.getWorldPosition(w);
          focus.desired.copy(w);
          orbit.dRadius = clamp(Math.max(28, orbit.dRadius * 0.55), orbit.minR, orbit.maxR);
        }

        function focusOverview() {
          focus.desired.set(0, 0, 0);
          orbit.dRadius = 135;
        }

        function resetView() {
          orbit.dTheta = 0.95;
          orbit.dPhi = 1.10;
          orbit.dRadius = 135;
          focusOverview();
        }

        function updateSpeedUI() {
          ui.speedVal.textContent = `${speedMultiplier.toFixed(2)}×`;
        }

        function togglePause() {
          isPaused = !isPaused;
          ui.pauseBtn.textContent = isPaused ? "Resume" : "Pause";
          ui.pauseBtn.classList.toggle("primary", isPaused);
        }

        // UI wiring
        ui.speed.value = String(speedMultiplier);
        updateSpeedUI();
        ui.speed.addEventListener("input", () => {
          speedMultiplier = Number(ui.speed.value);
          updateSpeedUI();
          if (speedMultiplier === 0) isPaused = true;
          if (speedMultiplier > 0 && isPaused) {
            isPaused = false;
            ui.pauseBtn.textContent = "Pause";
            ui.pauseBtn.classList.remove("primary");
          }
        });

        ui.pauseBtn.addEventListener("click", () => togglePause());
        ui.resetBtn.addEventListener("click", () => resetView());
        ui.centerBtn.addEventListener("click", () => focusOverview());
        ui.orbitsBtn.addEventListener("click", () => setOrbitsVisible(!showOrbits));
        ui.labelsBtn.addEventListener("click", () => setLabelsVisible(!showLabels));
        ui.closeInfoBtn.addEventListener("click", () => clearSelection());
        ui.focusBtn.addEventListener("click", () => selectedId && focusOn(selectedId));
        ui.overviewBtn.addEventListener("click", () => focusOverview());
        ui.zoomInBtn.addEventListener("click", () => (orbit.dRadius = clamp(orbit.dRadius * 0.88, orbit.minR, orbit.maxR)));
        ui.zoomOutBtn.addEventListener("click", () => (orbit.dRadius = clamp(orbit.dRadius * 1.14, orbit.minR, orbit.maxR)));

        window.addEventListener("keydown", (e) => {
          if (e.code === "Space") {
            e.preventDefault();
            togglePause();
          } else if (e.code === "Escape") {
            clearSelection();
          } else if (e.code === "KeyO") {
            setOrbitsVisible(!showOrbits);
          } else if (e.code === "KeyL") {
            setLabelsVisible(!showLabels);
          } else if (e.code === "KeyR") {
            resetView();
          }
        });

        // Canvas pointer interaction (drag rotate vs click select)
        function setPointerFromEvent(ev) {
          const rect = canvas.getBoundingClientRect();
          const x = (ev.clientX - rect.left) / rect.width;
          const y = (ev.clientY - rect.top) / rect.height;
          pointer.x = x * 2 - 1;
          pointer.y = -(y * 2 - 1);
        }

        function raycastPlanet(ev) {
          setPointerFromEvent(ev);
          raycaster.setFromCamera(pointer, camera);
          const hits = raycaster.intersectObjects(clickable, true);
          if (!hits.length) return null;
          for (const h of hits) {
            const id = h.object?.userData?.planetId;
            if (id && planetState.has(id)) return id;
          }
          return null;
        }

        canvas.addEventListener("pointerdown", (ev) => {
          canvas.focus({ preventScroll: true });
          input.down = true;
          input.drag = false;
          input.startX = input.lastX = ev.clientX;
          input.startY = input.lastY = ev.clientY;
          input.startT = performance.now();
          input.pointerId = ev.pointerId;
          canvas.setPointerCapture?.(ev.pointerId);
          setToastVisible(false);
        });

        canvas.addEventListener("pointermove", (ev) => {
          setPointerFromEvent(ev);
          if (!input.down || input.pointerId !== ev.pointerId) return;
          const dx = ev.clientX - input.lastX;
          const dy = ev.clientY - input.lastY;
          input.lastX = ev.clientX;
          input.lastY = ev.clientY;
          const moved = Math.hypot(ev.clientX - input.startX, ev.clientY - input.startY);
          if (moved > 5) input.drag = true;

          if (input.drag) {
            orbit.dTheta -= dx * 0.006;
            orbit.dPhi -= dy * 0.006;
            orbit.dPhi = clamp(orbit.dPhi, 0.18, 2.80);
          }
        });

        canvas.addEventListener("pointerup", (ev) => {
          if (input.pointerId !== ev.pointerId) return;
          const moved = Math.hypot(ev.clientX - input.startX, ev.clientY - input.startY);
          const dt = performance.now() - input.startT;
          input.down = false;
          canvas.releasePointerCapture?.(ev.pointerId);
          input.pointerId = null;
          if (moved < 6 && dt < 420) {
            const id = raycastPlanet(ev);
            if (id) selectPlanet(id);
          }
        });

        canvas.addEventListener(
          "wheel",
          (ev) => {
            ev.preventDefault();
            const delta = Math.sign(ev.deltaY);
            const mult = delta > 0 ? 1.08 : 0.92;
            orbit.dRadius = clamp(orbit.dRadius * mult, orbit.minR, orbit.maxR);
            setToastVisible(false);
          },
          { passive: false }
        );

        // Hover detection (for labels/highlight)
        let hoverCooldown = 0;
        function updateHover(dt) {
          if (input.down) return;
          hoverCooldown -= dt;
          if (hoverCooldown > 0) return;
          hoverCooldown = 0.05;
          raycaster.setFromCamera(pointer, camera);
          const hits = raycaster.intersectObjects(clickable, true);
          const next = hits.length ? hits[0].object?.userData?.planetId : null;
          hoveredId = next && planetState.has(next) ? next : null;
        }

        function updateCamera(dt) {
          focus.current.x = damp(focus.current.x, focus.desired.x, 6.5, dt);
          focus.current.y = damp(focus.current.y, focus.desired.y, 6.5, dt);
          focus.current.z = damp(focus.current.z, focus.desired.z, 6.5, dt);

          orbit.theta = damp(orbit.theta, orbit.dTheta, 10.0, dt);
          orbit.phi = damp(orbit.phi, orbit.dPhi, 10.0, dt);
          orbit.radius = damp(orbit.radius, orbit.dRadius, 10.0, dt);

          const r = orbit.radius;
          const sPhi = Math.sin(orbit.phi);
          const x = r * sPhi * Math.cos(orbit.theta);
          const y = r * Math.cos(orbit.phi);
          const z = r * sPhi * Math.sin(orbit.theta);

          camera.position.set(focus.current.x + x, focus.current.y + y, focus.current.z + z);
          camera.up.copy(up);
          camera.lookAt(focus.current);
        }

        function updatePlanets(dt) {
          const tScale = 10.0; // overall orbital time scaling
          const speed = isPaused ? 0 : speedMultiplier;

          // Sun subtle pulsing + rotation
          const glowPulse = 0.78 + 0.15 * Math.sin(performance.now() * 0.0012);
          sunGlow.material.opacity = glowPulse;
          sun.rotation.y += dt * 0.12;

          for (const s of planetState.values()) {
            const p = s.p;
            const b = s.b;

            // Orbital motion (stylized elliptical)
            s.angle += dt * tScale * speed * s.angular;
            const x = Math.cos(s.angle) * p.a;
            const z = Math.sin(s.angle) * b;
            s.mesh.position.set(x, 0, z);

            // Planet axial rotation
            s.mesh.rotation.y += dt * 0.8 * s.spin;

            // Moons
            if (s.moons && s.moons.length) {
              for (const m of s.moons) {
                m.angle += dt * 1.4 * speed * m.speed;
                m.moonMesh.position.set(Math.cos(m.angle) * m.dist, 0, Math.sin(m.angle) * m.dist);
                m.pivot.rotation.y += dt * 0.2;
              }
            }

            // Highlight response
            const hovering = hoveredId === p.id;
            if (hovering !== s.hover) s.hover = hovering;
            const targetAlpha = s.selected ? 0.65 : s.hover ? 0.32 : 0.0;
            s.highlight.material.opacity = damp(s.highlight.material.opacity, targetAlpha, 10, dt);

            if (s.rim) {
              s.rim.material.opacity = 0.55 + 0.15 * Math.sin(performance.now() * 0.001 + p.a * 0.1);
            }

            // Orbit line fade (de-emphasize when focused away from origin)
            s.orbitLine.material = showOrbits ? (focus.desired.length() > 0.1 ? shared.orbitMatDim : shared.orbitMat) : s.orbitLine.material;
          }
        }

        function updateLabels() {
          if (!showLabels) return;
          const w = window.innerWidth;
          const h = window.innerHeight;
          const v = new THREE.Vector3();
          for (const [id, s] of planetState) {
            const el = labels.get(id);
            if (!el) continue;

            // Only show hovered or selected labels for clarity
            const shouldShow = id === selectedId || id === hoveredId;
            if (!shouldShow) {
              el.classList.remove("on");
              continue;
            }

            s.mesh.getWorldPosition(v);
            v.project(camera);
            const onScreen = v.z > -1 && v.z < 1;
            if (!onScreen) {
              el.classList.remove("on");
              continue;
            }
            const x = (v.x * 0.5 + 0.5) * w;
            const y = (-v.y * 0.5 + 0.5) * h;

            // If too close to edges, fade out a bit
            const pad = 18;
            const visible = x > pad && x < w - pad && y > pad && y < h - pad;
            el.classList.toggle("on", visible);
            el.style.transform = `translate(${x}px, ${y - 18}px) translate(-50%, -100%)`;
          }
        }

        function resize() {
          const w = window.innerWidth;
          const h = window.innerHeight;
          renderer.setSize(w, h, false);
          camera.aspect = w / h;
          camera.updateProjectionMatrix();
        }
        window.addEventListener("resize", resize);

        // Initial
        setOrbitsVisible(true);
        setLabelsVisible(true);
        updateInfo(null);
        ui.focusBtn.disabled = true;
        if (prefersReducedMotion) {
          ui.speed.value = String(speedMultiplier);
          updateSpeedUI();
        }

        // Prevent context menu on long press/right click
        canvas.addEventListener("contextmenu", (e) => e.preventDefault());

        // Main loop
        let last = performance.now();
        function frame(now) {
          const dt = Math.min(0.033, Math.max(0.001, (now - last) / 1000));
          last = now;

          if (toastTimer > 0) {
            toastTimer -= dt;
            if (toastTimer <= 0) setToastVisible(false);
          }

          updateHover(dt);
          updateCamera(dt);
          updatePlanets(dt);
          updateLabels();

          // Subtle starfield drift (camera-relative illusion)
          stars.rotation.y += dt * 0.006;
          stars.rotation.x += dt * 0.0015;

          renderer.render(scene, camera);
          requestAnimationFrame(frame);
        }
        requestAnimationFrame(frame);
      })();
    </script>
  </body>
</html>
