<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>Tiny Kanban</title>
    <style>
      :root {
        --bg: #0b1220;
        --panel: rgba(255, 255, 255, 0.06);
        --panel2: rgba(255, 255, 255, 0.08);
        --stroke: rgba(255, 255, 255, 0.12);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.72);
        --faint: rgba(255, 255, 255, 0.55);
        --shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
        --shadow2: 0 10px 24px rgba(0, 0, 0, 0.28);
        --radius: 14px;
        --radius2: 12px;
        --radius3: 10px;
        --ring: 0 0 0 3px rgba(100, 180, 255, 0.28);
        --accent: #67e8f9;
        --accent2: #60a5fa;
        --good: #34d399;
        --warn: #fbbf24;
        --bad: #fb7185;
        --urgent: #a78bfa;
        --chip: rgba(255, 255, 255, 0.12);
        --chip2: rgba(255, 255, 255, 0.16);
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
          "Segoe UI Emoji";
        --card: rgba(255, 255, 255, 0.08);
        --cardHover: rgba(255, 255, 255, 0.11);
        --ghost: rgba(103, 232, 249, 0.12);
        --grid: rgba(255, 255, 255, 0.06);
        --danger: #fb7185;
        --ok: #34d399;
        --focus: rgba(103, 232, 249, 0.38);
        --kbd: rgba(255, 255, 255, 0.13);
        --gap: 14px;
        --standupScale: 1;
        --h1: 22px;
        --h2: 16px;
        --base: 14px;
        --cardTitle: 15px;
        --cardMeta: 12px;
      }

      [data-theme="light"] {
        --bg: #f4f7fb;
        --panel: rgba(10, 25, 47, 0.05);
        --panel2: rgba(10, 25, 47, 0.07);
        --stroke: rgba(10, 25, 47, 0.12);
        --text: rgba(10, 25, 47, 0.92);
        --muted: rgba(10, 25, 47, 0.72);
        --faint: rgba(10, 25, 47, 0.56);
        --shadow: 0 14px 34px rgba(13, 38, 76, 0.14);
        --shadow2: 0 10px 24px rgba(13, 38, 76, 0.12);
        --chip: rgba(10, 25, 47, 0.08);
        --chip2: rgba(10, 25, 47, 0.12);
        --card: rgba(255, 255, 255, 0.82);
        --cardHover: rgba(255, 255, 255, 0.95);
        --ghost: rgba(96, 165, 250, 0.12);
        --grid: rgba(10, 25, 47, 0.06);
        --kbd: rgba(10, 25, 47, 0.1);
      }

      [data-standup="true"] {
        --standupScale: 1.18;
        --h1: 26px;
        --h2: 18px;
        --base: 15px;
        --cardTitle: 16.5px;
        --cardMeta: 13px;
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: var(--sans);
        font-size: calc(var(--base) * var(--standupScale));
        line-height: 1.35;
        color: var(--text);
        background:
          radial-gradient(900px 500px at 10% 0%, rgba(103, 232, 249, 0.16), transparent 60%),
          radial-gradient(850px 450px at 85% 12%, rgba(167, 139, 250, 0.14), transparent 55%),
          radial-gradient(900px 500px at 60% 90%, rgba(96, 165, 250, 0.16), transparent 65%),
          linear-gradient(180deg, rgba(255, 255, 255, 0.04), transparent 28%),
          var(--bg);
      }

      a {
        color: inherit;
      }

      .wrap {
        max-width: 1300px;
        margin: 0 auto;
        padding: 18px 18px 26px;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 20;
        padding: 14px 0 14px;
        backdrop-filter: blur(10px);
        background: linear-gradient(180deg, rgba(11, 18, 32, 0.9), rgba(11, 18, 32, 0.55), transparent);
      }
      [data-theme="light"] header {
        background: linear-gradient(180deg, rgba(244, 247, 251, 0.95), rgba(244, 247, 251, 0.65), transparent);
      }

      .topbar {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .brandRow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
      }
      .logo {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        background:
          radial-gradient(14px 14px at 28% 30%, rgba(255, 255, 255, 0.6), transparent 60%),
          linear-gradient(135deg, rgba(103, 232, 249, 1), rgba(167, 139, 250, 1));
        box-shadow: 0 12px 26px rgba(96, 165, 250, 0.22);
        border: 1px solid rgba(255, 255, 255, 0.22);
      }
      [data-theme="light"] .logo {
        border: 1px solid rgba(10, 25, 47, 0.14);
      }

      .brandText {
        display: grid;
        gap: 2px;
        min-width: 0;
      }
      .title {
        font-size: calc(var(--h1) * var(--standupScale));
        font-weight: 820;
        letter-spacing: -0.02em;
        line-height: 1.05;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .subtitle {
        font-size: calc(12.5px * var(--standupScale));
        color: var(--muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
      }

      .toolbar {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
        padding: 12px;
        border-radius: var(--radius);
        background: linear-gradient(180deg, var(--panel), transparent 140%);
        border: 1px solid var(--stroke);
        box-shadow: var(--shadow2);
      }

      .toolbarRow {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 10px;
      }

      .search {
        flex: 1 1 300px;
        display: flex;
        align-items: center;
        gap: 8px;
        border-radius: 12px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.06);
        padding: 10px 12px;
        min-width: 240px;
      }
      [data-theme="light"] .search {
        background: rgba(255, 255, 255, 0.65);
      }
      .search svg {
        flex: 0 0 auto;
        opacity: 0.8;
      }
      .search input {
        width: 100%;
        border: none;
        outline: none;
        background: transparent;
        color: var(--text);
        font-size: 1em;
      }
      .search input::placeholder {
        color: var(--faint);
      }

      .chipRow {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: var(--chip);
        color: var(--muted);
        font-weight: 650;
        cursor: pointer;
        user-select: none;
        transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      }
      .chip:hover {
        transform: translateY(-1px);
        background: var(--chip2);
      }
      .chip[data-on="true"] {
        background: linear-gradient(135deg, rgba(103, 232, 249, 0.18), rgba(96, 165, 250, 0.16));
        border-color: rgba(103, 232, 249, 0.38);
        color: var(--text);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        font-weight: 720;
        cursor: pointer;
        user-select: none;
        transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      }
      [data-theme="light"] .btn {
        background: rgba(255, 255, 255, 0.6);
      }
      .btn:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.1);
      }
      [data-theme="light"] .btn:hover {
        background: rgba(255, 255, 255, 0.85);
      }
      .btn:active {
        transform: translateY(0px);
      }
      .btn.primary {
        background: linear-gradient(135deg, rgba(103, 232, 249, 0.22), rgba(167, 139, 250, 0.16));
        border-color: rgba(103, 232, 249, 0.42);
      }
      .btn.danger {
        border-color: rgba(251, 113, 133, 0.42);
        background: rgba(251, 113, 133, 0.08);
      }
      .btn.small {
        padding: 8px 10px;
        border-radius: 10px;
        font-weight: 700;
      }
      .btn.ghost {
        background: transparent;
      }

      .btn kbd {
        font-family: var(--mono);
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 8px;
        background: var(--kbd);
        border: 1px solid var(--stroke);
        color: var(--muted);
      }

      .btn:focus-visible,
      .chip:focus-visible,
      .cardBtn:focus-visible,
      input:focus-visible,
      select:focus-visible,
      textarea:focus-visible,
      dialog button:focus-visible {
        outline: none;
        box-shadow: var(--ring);
      }

      .metaRow {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        color: var(--muted);
        font-size: calc(12.5px * var(--standupScale));
      }
      .metaRow .left {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      .tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.05);
      }
      [data-theme="light"] .tag {
        background: rgba(255, 255, 255, 0.6);
      }

      main {
        padding-top: 6px;
      }

      .board {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--gap);
        align-items: start;
      }
      @media (max-width: 1020px) {
        .board {
          grid-template-columns: 1fr;
        }
        .controls {
          justify-content: flex-start;
        }
      }

      .col {
        border-radius: var(--radius);
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, var(--panel), transparent 130%);
        box-shadow: var(--shadow2);
        overflow: clip;
        min-height: 280px;
      }

      .colHeader {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 14px 14px 12px;
        border-bottom: 1px solid var(--stroke);
        background:
          radial-gradient(340px 60px at 20% 0%, rgba(103, 232, 249, 0.14), transparent 60%),
          linear-gradient(180deg, rgba(255, 255, 255, 0.04), transparent);
      }
      [data-theme="light"] .colHeader {
        background:
          radial-gradient(340px 60px at 20% 0%, rgba(96, 165, 250, 0.12), transparent 60%),
          linear-gradient(180deg, rgba(10, 25, 47, 0.03), transparent);
      }

      .colTitle {
        display: grid;
        gap: 2px;
        min-width: 0;
      }
      .colTitle strong {
        font-size: calc(var(--h2) * var(--standupScale));
        letter-spacing: -0.01em;
      }
      .colTitle span {
        font-size: calc(12px * var(--standupScale));
        color: var(--muted);
        font-variant-numeric: tabular-nums;
      }

      .limitPill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 7px 10px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.05);
        color: var(--muted);
        font-weight: 750;
        font-variant-numeric: tabular-nums;
      }
      [data-theme="light"] .limitPill {
        background: rgba(255, 255, 255, 0.65);
      }
      .limitPill[data-full="true"] {
        border-color: rgba(251, 113, 133, 0.5);
        color: var(--text);
        background: rgba(251, 113, 133, 0.1);
      }

      .list {
        padding: 12px;
        display: grid;
        gap: 10px;
        min-height: 220px;
      }
      .list:empty {
        display: grid;
        place-items: center;
        color: var(--faint);
        border-radius: 12px;
        border: 1px dashed var(--stroke);
        margin: 12px;
        padding: 18px;
        min-height: 180px;
      }
      .list:empty::before {
        content: attr(data-empty);
      }

      .card {
        position: relative;
        border-radius: var(--radius2);
        border: 1px solid var(--stroke);
        background: var(--card);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.18);
        padding: 12px 12px 11px;
        cursor: grab;
        user-select: none;
        transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      }
      .card:hover {
        transform: translateY(-1px);
        background: var(--cardHover);
      }
      .card:active {
        cursor: grabbing;
      }

      .cardTop {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 10px;
      }
      .cardTitle {
        font-weight: 820;
        letter-spacing: -0.01em;
        font-size: calc(var(--cardTitle) * var(--standupScale));
        line-height: 1.12;
        word-break: break-word;
      }
      .cardTitle mark {
        border-radius: 6px;
        padding: 0 3px;
        background: rgba(103, 232, 249, 0.22);
        color: inherit;
      }
      [data-theme="light"] .cardTitle mark {
        background: rgba(96, 165, 250, 0.2);
      }

      .cardActions {
        display: flex;
        gap: 6px;
        flex: 0 0 auto;
        opacity: 0.95;
      }
      .cardBtn {
        width: 34px;
        height: 34px;
        display: grid;
        place-items: center;
        border-radius: 10px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.05);
        cursor: pointer;
      }
      .cardBtn:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      [data-theme="light"] .cardBtn {
        background: rgba(10, 25, 47, 0.04);
      }
      [data-theme="light"] .cardBtn:hover {
        background: rgba(10, 25, 47, 0.06);
      }

      .cardMid {
        margin-top: 8px;
        color: var(--muted);
        font-size: calc(var(--cardMeta) * var(--standupScale));
        white-space: pre-wrap;
        word-break: break-word;
      }
      .cardMid mark {
        border-radius: 6px;
        padding: 0 3px;
        background: rgba(251, 191, 36, 0.22);
        color: inherit;
      }

      .cardBottom {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
      }
      .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .prio {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 8px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.05);
        color: var(--muted);
        font-weight: 750;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        font-size: calc(11px * var(--standupScale));
      }

      .dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: var(--muted);
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.04);
      }

      .prio[data-priority="low"] .dot {
        background: var(--good);
      }
      .prio[data-priority="med"] .dot {
        background: var(--warn);
      }
      .prio[data-priority="high"] .dot {
        background: var(--bad);
      }
      .prio[data-priority="urgent"] .dot {
        background: var(--urgent);
      }

      .assignee {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px 6px 8px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.05);
        color: var(--muted);
        font-weight: 730;
        font-size: calc(12px * var(--standupScale));
        max-width: 220px;
      }
      [data-theme="light"] .assignee {
        background: rgba(255, 255, 255, 0.62);
      }
      .avatar {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        font-weight: 850;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.92);
        background: linear-gradient(135deg, rgba(96, 165, 250, 0.9), rgba(167, 139, 250, 0.9));
        border: 1px solid rgba(255, 255, 255, 0.18);
      }
      [data-theme="light"] .avatar {
        border: 1px solid rgba(10, 25, 47, 0.12);
      }
      .assignee .name {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .card[data-priority="urgent"] {
        border-left: 6px solid rgba(167, 139, 250, 0.9);
      }
      .card[data-priority="high"] {
        border-left: 6px solid rgba(251, 113, 133, 0.95);
      }
      .card[data-priority="med"] {
        border-left: 6px solid rgba(251, 191, 36, 0.95);
      }
      .card[data-priority="low"] {
        border-left: 6px solid rgba(52, 211, 153, 0.95);
      }

      .sortable-ghost {
        background: var(--ghost) !important;
        border-color: rgba(103, 232, 249, 0.3) !important;
        box-shadow: none !important;
      }
      .sortable-chosen {
        transform: rotate(-0.2deg) scale(1.01);
      }
      .sortable-drag {
        box-shadow: var(--shadow);
      }

      .col[data-drop-blocked="true"] {
        outline: 2px solid rgba(251, 113, 133, 0.45);
        outline-offset: -2px;
      }

      footer {
        margin-top: 14px;
        color: var(--faint);
        font-size: calc(12px * var(--standupScale));
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
      }
      .footerLeft {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }

      .toastHost {
        position: fixed;
        right: 16px;
        bottom: 16px;
        z-index: 50;
        display: grid;
        gap: 10px;
        width: min(420px, calc(100vw - 32px));
      }
      .toast {
        border-radius: 14px;
        border: 1px solid var(--stroke);
        background: rgba(0, 0, 0, 0.52);
        backdrop-filter: blur(10px);
        color: var(--text);
        padding: 12px 12px;
        box-shadow: var(--shadow2);
        display: flex;
        gap: 10px;
        align-items: flex-start;
      }
      [data-theme="light"] .toast {
        background: rgba(255, 255, 255, 0.82);
      }
      .toast .bar {
        width: 10px;
        border-radius: 999px;
        background: rgba(103, 232, 249, 0.8);
        margin-top: 2px;
        flex: 0 0 auto;
      }
      .toast[data-kind="warn"] .bar {
        background: rgba(251, 191, 36, 0.9);
      }
      .toast[data-kind="error"] .bar {
        background: rgba(251, 113, 133, 0.95);
      }
      .toastTitle {
        font-weight: 820;
        letter-spacing: -0.01em;
      }
      .toastMsg {
        color: var(--muted);
        margin-top: 2px;
      }

      dialog {
        width: min(720px, calc(100vw - 28px));
        border: 1px solid var(--stroke);
        border-radius: 16px;
        background: rgba(8, 14, 26, 0.86);
        backdrop-filter: blur(14px);
        color: var(--text);
        box-shadow: var(--shadow);
        padding: 0;
      }
      [data-theme="light"] dialog {
        background: rgba(255, 255, 255, 0.92);
      }
      dialog::backdrop {
        background: rgba(0, 0, 0, 0.45);
      }
      [data-theme="light"] dialog::backdrop {
        background: rgba(10, 25, 47, 0.22);
      }

      .modal {
        padding: 14px;
      }
      .modalHeader {
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        padding: 14px 14px 10px;
        border-bottom: 1px solid var(--stroke);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), transparent);
      }
      .modalHeader strong {
        font-size: calc(16px * var(--standupScale));
        letter-spacing: -0.01em;
      }
      .modalHeader .hint {
        color: var(--muted);
        font-size: calc(12.5px * var(--standupScale));
      }
      .modalBody {
        padding: 14px;
        display: grid;
        gap: 12px;
      }
      .modalFooter {
        padding: 12px 14px 14px;
        border-top: 1px solid var(--stroke);
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: flex-end;
        align-items: center;
      }

      .grid2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      @media (max-width: 700px) {
        .grid2 {
          grid-template-columns: 1fr;
        }
      }

      .field {
        display: grid;
        gap: 6px;
      }
      .field label {
        color: var(--muted);
        font-weight: 700;
        font-size: calc(12.5px * var(--standupScale));
      }
      .field input,
      .field select,
      .field textarea {
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        font: inherit;
      }
      [data-theme="light"] .field input,
      [data-theme="light"] .field select,
      [data-theme="light"] .field textarea {
        background: rgba(255, 255, 255, 0.72);
      }
      .field textarea {
        min-height: 88px;
        resize: vertical;
      }
      .help {
        color: var(--faint);
        font-size: calc(12px * var(--standupScale));
      }

      .table {
        border: 1px solid var(--stroke);
        border-radius: 14px;
        overflow: clip;
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 140px;
        gap: 10px;
        align-items: center;
        padding: 10px 12px;
        border-top: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.03);
      }
      [data-theme="light"] .row {
        background: rgba(255, 255, 255, 0.55);
      }
      .row:first-child {
        border-top: none;
      }
      .row strong {
        letter-spacing: -0.01em;
      }
      .row input[type="number"] {
        width: 100%;
      }

      .srOnly {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        padding: 0 !important;
        margin: -1px !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        white-space: nowrap !important;
        border: 0 !important;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="wrap">
        <div class="topbar">
          <div class="brandRow">
            <div class="brand">
              <div class="logo" aria-hidden="true"></div>
              <div class="brandText">
                <div class="title">Tiny Kanban</div>
                <div class="subtitle">Todo ‚Üí Doing ‚Üí Done with WIP limits, priorities, and people</div>
              </div>
            </div>
            <div class="controls">
              <button class="btn small" id="btnTheme" type="button" aria-label="Toggle theme">
                <span aria-hidden="true" id="themeIcon">üåô</span>
                <span id="themeLabel">Dark</span>
              </button>
              <button class="btn small" id="btnStandup" type="button" aria-label="Toggle standup mode">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    fill="currentColor"
                    d="M3 19V5h2v14zm16 0v-7h2v7zM7 19V9h2v10zm4 0V7h2v12zm4 0v-4h2v4z"
                  />
                </svg>
                <span id="standupLabel">Standup</span>
              </button>
              <button class="btn primary" id="btnAdd" type="button">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                  <path fill="currentColor" d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" />
                </svg>
                Add card <kbd>‚åòK</kbd>
              </button>
            </div>
          </div>

          <div class="toolbar" role="region" aria-label="Board controls">
            <div class="toolbarRow">
              <div class="search" role="search">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    fill="currentColor"
                    d="M10 2a8 8 0 1 0 4.9 14.32l4.39 4.39l1.41-1.41l-4.39-4.39A8 8 0 0 0 10 2m0 2a6 6 0 1 1 0 12a6 6 0 0 1 0-12"
                  />
                </svg>
                <input id="searchInput" type="search" autocomplete="off" placeholder="Search cards (title, notes, assignee)..." />
              </div>
              <button class="btn" id="btnSettings" type="button" aria-label="Board settings">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    fill="currentColor"
                    d="M12 8a4 4 0 1 0 4 4a4 4 0 0 0-4-4m0 2a2 2 0 1 1-2 2a2 2 0 0 1 2-2m10 2a8.1 8.1 0 0 0-.12-1.39l2.03-1.58l-2-3.46l-2.45 1a8.2 8.2 0 0 0-2.4-1.39l-.37-2.6H9.31l-.37 2.6a8.2 8.2 0 0 0-2.4 1.39l-2.45-1l-2 3.46l2.03 1.58A8.1 8.1 0 0 0 2 12a8.1 8.1 0 0 0 .12 1.39L.09 14.97l2 3.46l2.45-1a8.2 8.2 0 0 0 2.4 1.39l.37 2.6h5.38l.37-2.6a8.2 8.2 0 0 0 2.4-1.39l2.45 1l2-3.46l-2.03-1.58A8.1 8.1 0 0 0 22 12"
                  />
                </svg>
                Settings
              </button>
              <button class="btn danger" id="btnReset" type="button" aria-label="Reset board">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    fill="currentColor"
                    d="M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6zm3.5-9h1v8h-1zm4 0h1v8h-1zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"
                  />
                </svg>
                Reset
              </button>
            </div>
            <div class="metaRow">
              <div class="left">
                <span class="tag" id="statsTag" aria-live="polite"></span>
                <span class="tag" id="wipTag"></span>
                <span class="tag" id="hintTag">
                  <span aria-hidden="true">‚Üï</span>
                  <span id="hintText">Drag cards between columns; WIP limits block overflow</span>
                </span>
              </div>
              <div class="chipRow" id="assigneeChips" aria-label="Assignee filter"></div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="wrap">
        <div class="board" id="board" aria-label="Kanban board"></div>
        <footer>
          <div class="footerLeft">
            <span>Tip: press <span class="tag"><span style="font-family: var(--mono)">‚åòK</span></span> to add a card</span>
          </div>
          <div>
            <a href="#" id="exportLink">Export JSON</a>
            <span aria-hidden="true"> ¬∑ </span>
            <a href="#" id="importLink">Import JSON</a>
          </div>
        </footer>
      </div>
    </main>

    <div class="toastHost" id="toastHost" aria-live="polite" aria-relevant="additions"></div>

    <dialog id="cardDialog" aria-labelledby="cardDialogTitle">
      <div class="modalHeader">
        <div>
          <strong id="cardDialogTitle">New card</strong>
          <div class="hint" id="cardDialogHint">Add something you can finish today</div>
        </div>
        <button class="btn small ghost" id="btnCloseCard" type="button" aria-label="Close">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor" d="M18.3 5.71L12 12l6.3 6.29l-1.41 1.42L12 13.41l-6.89 6.3l-1.41-1.42L10.59 12L3.7 5.71L5.11 4.29L12 10.59l6.89-6.3z"/>
          </svg>
        </button>
      </div>
      <form method="dialog" id="cardForm">
        <div class="modalBody">
          <input type="hidden" id="cardId" />
          <div class="grid2">
            <div class="field">
              <label for="cardTitle">Title</label>
              <input id="cardTitle" maxlength="120" required placeholder="e.g., Prep standup notes" />
            </div>
            <div class="field">
              <label for="cardColumn">Column</label>
              <select id="cardColumn" required></select>
            </div>
          </div>

          <div class="grid2">
            <div class="field">
              <label for="cardPriority">Priority</label>
              <select id="cardPriority" required>
                <option value="low">Low</option>
                <option value="med" selected>Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
              <div class="help">Priority sets color + ordering cue during standup.</div>
            </div>
            <div class="field">
              <label for="cardAssignee">Assignee</label>
              <select id="cardAssignee"></select>
              <div class="help">Pick a person or add a new one.</div>
            </div>
          </div>

          <div class="field" id="newPersonField" style="display: none">
            <label for="newPersonName">New person name</label>
            <input id="newPersonName" maxlength="28" placeholder="e.g., Casey" />
            <div class="help">Added to your People list when you save.</div>
          </div>

          <div class="field">
            <label for="cardNotes">Notes (optional)</label>
            <textarea id="cardNotes" maxlength="600" placeholder="Context, blockers, next step..."></textarea>
          </div>
        </div>
        <div class="modalFooter">
          <button class="btn danger" id="btnDeleteInDialog" type="button" style="display: none">
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
              <path
                fill="currentColor"
                d="M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6zm3.5-9h1v8h-1zm4 0h1v8h-1zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"
              />
            </svg>
            Delete
          </button>
          <button class="btn" id="btnCancelCard" value="cancel">Cancel</button>
          <button class="btn primary" id="btnSaveCard" value="default">Save</button>
        </div>
      </form>
    </dialog>

    <dialog id="settingsDialog" aria-labelledby="settingsTitle">
      <div class="modalHeader">
        <div>
          <strong id="settingsTitle">Settings</strong>
          <div class="hint">WIP limits + people list (saved to this browser)</div>
        </div>
        <button class="btn small ghost" id="btnCloseSettings" type="button" aria-label="Close">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor" d="M18.3 5.71L12 12l6.3 6.29l-1.41 1.42L12 13.41l-6.89 6.3l-1.41-1.42L10.59 12L3.7 5.71L5.11 4.29L12 10.59l6.89-6.3z"/>
          </svg>
        </button>
      </div>
      <form method="dialog" id="settingsForm">
        <div class="modalBody">
          <div class="field">
            <label>WIP limits</label>
            <div class="table" id="wipTable"></div>
            <div class="help">Set a limit to keep work focused. Use 0 for ‚Äúno cards allowed‚Äù, 99 for effectively unlimited.</div>
          </div>
          <div class="field">
            <label for="peopleInput">People</label>
            <input id="peopleInput" placeholder="Comma-separated names (e.g., Alex, Sam, Priya)" />
            <div class="help">Used for assignment + quick filtering chips.</div>
          </div>
        </div>
        <div class="modalFooter">
          <button class="btn" id="btnCancelSettings" value="cancel">Cancel</button>
          <button class="btn primary" id="btnSaveSettings" value="default">Save</button>
        </div>
      </form>
    </dialog>

    <dialog id="importDialog" aria-labelledby="importTitle">
      <div class="modalHeader">
        <div>
          <strong id="importTitle">Import JSON</strong>
          <div class="hint">Paste a Tiny Kanban export to replace the current board</div>
        </div>
        <button class="btn small ghost" id="btnCloseImport" type="button" aria-label="Close">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor" d="M18.3 5.71L12 12l6.3 6.29l-1.41 1.42L12 13.41l-6.89 6.3l-1.41-1.42L10.59 12L3.7 5.71L5.11 4.29L12 10.59l6.89-6.3z"/>
          </svg>
        </button>
      </div>
      <form method="dialog" id="importForm">
        <div class="modalBody">
          <div class="field">
            <label for="importText">JSON</label>
            <textarea id="importText" placeholder='{"version":1,"people":[...],...}'></textarea>
            <div class="help">Import replaces local board state.</div>
          </div>
        </div>
        <div class="modalFooter">
          <button class="btn" value="cancel">Cancel</button>
          <button class="btn primary" id="btnApplyImport" value="default">Import</button>
        </div>
      </form>
    </dialog>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    <script>
      (() => {
        "use strict";

        const STORAGE_KEY = "tiny-kanban.v1";
        const THEME_KEY = "tiny-kanban.theme";
        const STANDUP_KEY = "tiny-kanban.standup";

        const COLS = [
          { id: "todo", name: "Todo", subtitle: "Next up", defaultLimit: 99 },
          { id: "doing", name: "Doing", subtitle: "In progress", defaultLimit: 3 },
          { id: "done", name: "Done", subtitle: "Shipped", defaultLimit: 99 },
        ];

        const PRIORITIES = [
          { id: "low", label: "Low" },
          { id: "med", label: "Medium" },
          { id: "high", label: "High" },
          { id: "urgent", label: "Urgent" },
        ];

        const els = {
          root: document.documentElement,
          board: document.getElementById("board"),
          toastHost: document.getElementById("toastHost"),
          searchInput: document.getElementById("searchInput"),
          assigneeChips: document.getElementById("assigneeChips"),
          statsTag: document.getElementById("statsTag"),
          wipTag: document.getElementById("wipTag"),
          hintText: document.getElementById("hintText"),

          btnAdd: document.getElementById("btnAdd"),
          btnReset: document.getElementById("btnReset"),
          btnSettings: document.getElementById("btnSettings"),
          btnTheme: document.getElementById("btnTheme"),
          themeIcon: document.getElementById("themeIcon"),
          themeLabel: document.getElementById("themeLabel"),
          btnStandup: document.getElementById("btnStandup"),
          standupLabel: document.getElementById("standupLabel"),

          exportLink: document.getElementById("exportLink"),
          importLink: document.getElementById("importLink"),

          cardDialog: document.getElementById("cardDialog"),
          cardForm: document.getElementById("cardForm"),
          cardDialogTitle: document.getElementById("cardDialogTitle"),
          cardDialogHint: document.getElementById("cardDialogHint"),
          btnCloseCard: document.getElementById("btnCloseCard"),
          btnCancelCard: document.getElementById("btnCancelCard"),
          btnDeleteInDialog: document.getElementById("btnDeleteInDialog"),

          cardId: document.getElementById("cardId"),
          cardTitle: document.getElementById("cardTitle"),
          cardColumn: document.getElementById("cardColumn"),
          cardPriority: document.getElementById("cardPriority"),
          cardAssignee: document.getElementById("cardAssignee"),
          newPersonField: document.getElementById("newPersonField"),
          newPersonName: document.getElementById("newPersonName"),
          cardNotes: document.getElementById("cardNotes"),

          settingsDialog: document.getElementById("settingsDialog"),
          settingsForm: document.getElementById("settingsForm"),
          btnCloseSettings: document.getElementById("btnCloseSettings"),
          peopleInput: document.getElementById("peopleInput"),
          wipTable: document.getElementById("wipTable"),

          importDialog: document.getElementById("importDialog"),
          importForm: document.getElementById("importForm"),
          btnCloseImport: document.getElementById("btnCloseImport"),
          importText: document.getElementById("importText"),
          btnApplyImport: document.getElementById("btnApplyImport"),
        };

        const SortableRef = window.Sortable;

        /** @type {ReturnType<typeof makeDefaultState>} */
        let state = loadState();

        const ui = {
          search: "",
          assignee: "all",
          sortables: new Map(),
          lastFocused: null,
        };

        applyTheme(loadTheme());
        applyStandup(loadStandup());

        hydrateControls();
        render();

        // --------- Persistence ---------
        function makeDefaultState() {
          const now = Date.now();
          return {
            version: 1,
            updatedAt: now,
            people: ["Alex", "Sam", "Jordan", "Priya"],
            limits: Object.fromEntries(COLS.map((c) => [c.id, c.defaultLimit])),
            columns: {
              todo: [
                {
                  id: uid(),
                  title: "Review yesterday‚Äôs notes",
                  notes: "What did we ship? Any blockers to call out?",
                  priority: "med",
                  assignee: "Alex",
                  createdAt: now - 1000 * 60 * 60 * 14,
                },
                {
                  id: uid(),
                  title: "Triage new tickets",
                  notes: "Tag urgent, assign owners, set WIP consciously",
                  priority: "high",
                  assignee: "Priya",
                  createdAt: now - 1000 * 60 * 60 * 10,
                },
              ],
              doing: [
                {
                  id: uid(),
                  title: "Fix flaky CI job",
                  notes: "Re-run workflow with verbose logs; pinpoint nondeterminism",
                  priority: "urgent",
                  assignee: "Sam",
                  createdAt: now - 1000 * 60 * 60 * 5,
                },
              ],
              done: [
                {
                  id: uid(),
                  title: "Standup ready",
                  notes: "Board is clean and focused",
                  priority: "low",
                  assignee: "Jordan",
                  createdAt: now - 1000 * 60 * 40,
                },
              ],
            },
          };
        }

        function loadState() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return makeDefaultState();
            const parsed = JSON.parse(raw);
            return normalizeState(parsed);
          } catch {
            return makeDefaultState();
          }
        }

        function normalizeState(s) {
          const base = makeDefaultState();
          if (!s || typeof s !== "object") return base;
          const version = Number(s.version || 1);
          if (version !== 1) return base;
          const people = Array.isArray(s.people) ? s.people.map(cleanName).filter(Boolean) : base.people.slice();
          const limits = { ...base.limits, ...(s.limits || {}) };
          for (const c of COLS) {
            limits[c.id] = clampLimit(limits[c.id]);
          }
          const columns = { todo: [], doing: [], done: [] };
          for (const c of COLS) {
            const items = (s.columns && Array.isArray(s.columns[c.id]) ? s.columns[c.id] : []).map(normalizeCard).filter(Boolean);
            columns[c.id] = items;
          }
          const assignees = [];
          for (const c of COLS) {
            for (const card of columns[c.id]) {
              if (card.assignee) assignees.push(card.assignee);
            }
          }
          const mergedPeople = dedupe([...people, ...assignees].map(cleanName).filter(Boolean));
          return {
            version: 1,
            updatedAt: Number(s.updatedAt || Date.now()),
            people: mergedPeople.length ? mergedPeople : base.people.slice(),
            limits,
            columns,
          };
        }

        function normalizeCard(x) {
          if (!x || typeof x !== "object") return null;
          const id = String(x.id || "").trim() || uid();
          const title = String(x.title || "").trim();
          if (!title) return null;
          const notes = String(x.notes || "").trim();
          const priority = PRIORITIES.some((p) => p.id === x.priority) ? x.priority : "med";
          const assignee = cleanName(x.assignee || "");
          const createdAt = Number(x.createdAt || Date.now());
          return { id, title, notes, priority, assignee, createdAt };
        }

        let saveTimer = null;
        function scheduleSave() {
          if (saveTimer) clearTimeout(saveTimer);
          saveTimer = setTimeout(() => {
            state.updatedAt = Date.now();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
          }, 80);
        }

        // --------- Theme & standup mode ---------
        function loadTheme() {
          const saved = localStorage.getItem(THEME_KEY);
          if (saved === "light" || saved === "dark") return saved;
          const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
          return prefersDark ? "dark" : "light";
        }
        function applyTheme(theme) {
          els.root.setAttribute("data-theme", theme);
          const isDark = theme === "dark";
          els.themeIcon.textContent = isDark ? "üåô" : "‚òÄÔ∏è";
          els.themeLabel.textContent = isDark ? "Dark" : "Light";
        }
        function toggleTheme() {
          const current = els.root.getAttribute("data-theme") || "dark";
          const next = current === "dark" ? "light" : "dark";
          localStorage.setItem(THEME_KEY, next);
          applyTheme(next);
          toast({ title: "Theme", message: `${cap(next)} mode`, kind: "info", timeoutMs: 1400 });
        }

        function loadStandup() {
          return localStorage.getItem(STANDUP_KEY) === "true";
        }
        function applyStandup(on) {
          els.root.setAttribute("data-standup", on ? "true" : "false");
          els.standupLabel.textContent = on ? "Standup ‚úì" : "Standup";
        }
        function toggleStandup() {
          const on = els.root.getAttribute("data-standup") === "true";
          const next = !on;
          localStorage.setItem(STANDUP_KEY, String(next));
          applyStandup(next);
          toast({ title: "Standup mode", message: next ? "Bigger, easier to read" : "Normal size", kind: "info", timeoutMs: 1500 });
        }

        // --------- Rendering ---------
        function render() {
          renderAssigneeChips();
          renderColumnSelect();
          renderAssigneeSelect();
          renderStats();
          renderHints();
          renderBoard();
          initSortables();
        }

        function renderHints() {
          els.hintText.textContent = isFilterActive() ? "Clear filters to drag cards" : "Drag cards between columns; WIP limits block overflow";
        }

        function renderStats() {
          const total = COLS.reduce((n, c) => n + state.columns[c.id].length, 0);
          const doing = state.columns.doing.length;
          const doingLimit = state.limits.doing;
          const doingFull = doingLimit !== 99 && doing >= doingLimit;
          const updated = new Date(state.updatedAt).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
          els.statsTag.textContent = `${total} cards ¬∑ last saved ${updated}`;
          els.wipTag.textContent = `Doing WIP: ${doing}/${doingLimit === 99 ? "‚àû" : doingLimit}${doingFull ? " (full)" : ""}`;
        }

        function renderAssigneeChips() {
          const people = ["all", ...getPeopleForUI()];
          els.assigneeChips.innerHTML = "";
          for (const person of people) {
            const chip = document.createElement("button");
            chip.type = "button";
            chip.className = "chip";
            chip.dataset.on = String(ui.assignee === person);
            chip.textContent = person === "all" ? "All" : person;
            chip.addEventListener("click", () => {
              ui.assignee = person;
              render();
            });
            els.assigneeChips.appendChild(chip);
          }
        }

        function renderColumnSelect() {
          const prev = els.cardColumn.value || "todo";
          els.cardColumn.innerHTML = "";
          for (const c of COLS) {
            const opt = document.createElement("option");
            opt.value = c.id;
            opt.textContent = c.name;
            els.cardColumn.appendChild(opt);
          }
          els.cardColumn.value = prev;
        }

        function renderAssigneeSelect() {
          const value = els.cardAssignee.value || "unassigned";
          els.cardAssignee.innerHTML = "";
          const opt0 = document.createElement("option");
          opt0.value = "unassigned";
          opt0.textContent = "Unassigned";
          els.cardAssignee.appendChild(opt0);
          const people = getPeopleForUI();
          for (const p of people) {
            const opt = document.createElement("option");
            opt.value = p;
            opt.textContent = p;
            els.cardAssignee.appendChild(opt);
          }
          if (value && value !== "unassigned" && value !== "__new__" && !people.includes(value)) {
            const optOther = document.createElement("option");
            optOther.value = value;
            optOther.textContent = value;
            els.cardAssignee.appendChild(optOther);
          }
          const optNew = document.createElement("option");
          optNew.value = "__new__";
          optNew.textContent = "Add new person‚Ä¶";
          els.cardAssignee.appendChild(optNew);
          els.cardAssignee.value = value;
        }

        function renderBoard() {
          const search = ui.search.trim().toLowerCase();
          const assigneeFilter = ui.assignee;
          const filterActive = isFilterActive();

          const frag = document.createDocumentFragment();
          for (const col of COLS) {
            const colEl = document.createElement("section");
            colEl.className = "col";
            colEl.dataset.col = col.id;
            colEl.setAttribute("aria-label", `${col.name} column`);

            const header = document.createElement("div");
            header.className = "colHeader";

            const left = document.createElement("div");
            left.className = "colTitle";
            const strong = document.createElement("strong");
            strong.textContent = col.name;
            const subtitle = document.createElement("span");
            subtitle.textContent = col.subtitle;
            left.append(strong, subtitle);

            const count = state.columns[col.id].length;
            const limit = state.limits[col.id];
            const isFull = limit !== 99 && count >= limit;
            const pill = document.createElement("button");
            pill.type = "button";
            pill.className = "limitPill";
            pill.dataset.full = String(isFull);
            pill.title = "Edit WIP limits";
            pill.innerHTML = `
              <span aria-hidden="true">‚è±</span>
              <span>${count}/${limit === 99 ? "‚àû" : limit}</span>
            `;
            pill.addEventListener("click", openSettings);

            header.append(left, pill);

            const list = document.createElement("div");
            list.className = "list";
            list.dataset.list = col.id;
            list.dataset.empty = filterActive ? "No matches" : "Drop cards here";
            list.setAttribute("role", "list");

            const cards = state.columns[col.id].filter((card) => {
              if (assigneeFilter !== "all") {
                const a = (card.assignee || "").trim();
                if (a !== assigneeFilter) return false;
              }
              if (!search) return true;
              const hay = `${card.title} ${card.notes} ${card.assignee || ""}`.toLowerCase();
              return hay.includes(search);
            });

            for (const card of cards) {
              const cardEl = renderCard(card, search);
              list.appendChild(cardEl);
            }

            colEl.append(header, list);
            frag.appendChild(colEl);
          }
          els.board.innerHTML = "";
          els.board.appendChild(frag);
        }

        function renderCard(card, search) {
          const el = document.createElement("article");
          el.className = "card";
          el.dataset.id = card.id;
          el.dataset.priority = card.priority;
          el.setAttribute("role", "listitem");
          el.setAttribute("tabindex", "0");

          const actions = document.createElement("div");
          actions.className = "cardActions";

          const btnEdit = iconButton("Edit card", pencilIcon());
          btnEdit.addEventListener("click", (e) => {
            e.stopPropagation();
            openCardDialog(card.id);
          });

          const btnDel = iconButton("Delete card", trashIcon());
          btnDel.addEventListener("click", (e) => {
            e.stopPropagation();
            deleteCardFlow(card.id);
          });

          actions.append(btnEdit, btnDel);

          const top = document.createElement("div");
          top.className = "cardTop";

          const title = document.createElement("div");
          title.className = "cardTitle";
          title.innerHTML = highlight(card.title, search);

          top.append(title, actions);

          const mid = document.createElement("div");
          mid.className = "cardMid";
          mid.innerHTML = card.notes ? highlight(card.notes, search) : "";

          const bottom = document.createElement("div");
          bottom.className = "cardBottom";

          const meta = document.createElement("div");
          meta.className = "meta";

          const prio = document.createElement("span");
          prio.className = "prio";
          prio.dataset.priority = card.priority;
          const prioLabel = PRIORITIES.find((p) => p.id === card.priority)?.label || "Medium";
          prio.innerHTML = `<span class="dot" aria-hidden="true"></span><span>${prioLabel}</span>`;
          meta.appendChild(prio);

          if (card.assignee) {
            const pill = document.createElement("span");
            pill.className = "assignee";
            pill.title = `Assignee: ${card.assignee}`;
            pill.innerHTML = `<span class="avatar" aria-hidden="true">${initials(card.assignee)}</span><span class="name">${escapeHtml(
              card.assignee
            )}</span>`;
            meta.appendChild(pill);
          }

          bottom.append(meta);

          el.append(top, mid, bottom);
          el.addEventListener("dblclick", () => openCardDialog(card.id));
          el.addEventListener("keydown", (e) => {
            if (e.key === "Enter") openCardDialog(card.id);
            if (e.key === "Backspace" || e.key === "Delete") deleteCardFlow(card.id);
          });
          return el;
        }

        function initSortables() {
          // destroy
          for (const s of ui.sortables.values()) {
            try {
              s.destroy();
            } catch {}
          }
          ui.sortables.clear();

          if (!SortableRef) {
            toast({ title: "Drag & drop disabled", message: "SortableJS failed to load.", kind: "warn", timeoutMs: 5000 });
            return;
          }

          const disabled = isFilterActive();
          for (const col of COLS) {
            const list = els.board.querySelector(`[data-list="${col.id}"]`);
            if (!list) continue;
            const sortable = new SortableRef(list, {
              group: "kanban",
              disabled,
              animation: 140,
              easing: "cubic-bezier(0.2, 0.7, 0.2, 1)",
              ghostClass: "sortable-ghost",
              chosenClass: "sortable-chosen",
              dragClass: "sortable-drag",
              forceFallback: false,
              fallbackOnBody: true,
              swapThreshold: 0.62,
              onMove: (evt) => {
                for (const c of COLS) setDropBlocked(c.id, false);
                const toCol = evt.to?.dataset?.list;
                const fromCol = evt.from?.dataset?.list;
                if (!toCol || !fromCol) return true;
                if (toCol === fromCol) return true;

                const limit = state.limits[toCol];
                const count = state.columns[toCol].length;
                const wouldBe = count + 1;
                const ok = limit === 99 ? true : wouldBe <= limit;

                // visual feedback
                setDropBlocked(toCol, !ok);
                return ok;
              },
              onEnd: (evt) => {
                // Clear any blocked styling
                for (const c of COLS) setDropBlocked(c.id, false);
                if (evt.oldIndex == null || evt.newIndex == null) return;
                const fromCol = evt.from?.dataset?.list;
                const toCol = evt.to?.dataset?.list;
                const id = evt.item?.dataset?.id;
                if (!fromCol || !toCol || !id) return;
                if (fromCol === toCol && evt.oldIndex === evt.newIndex) return;
                moveCard(id, fromCol, toCol, evt.newIndex);
              },
            });
            if (typeof sortable.option === "function") sortable.option("disabled", disabled);
            ui.sortables.set(col.id, sortable);
          }
        }

        function setDropBlocked(colId, on) {
          const colEl = els.board.querySelector(`[data-col="${colId}"]`);
          if (!colEl) return;
          colEl.dataset.dropBlocked = on ? "true" : "false";
        }

        function moveCard(cardId, fromCol, toCol, toIndex) {
          const fromArr = state.columns[fromCol];
          const idx = fromArr.findIndex((c) => c.id === cardId);
          if (idx < 0) return;
          const [card] = fromArr.splice(idx, 1);

          const toArr = state.columns[toCol];
          const limit = state.limits[toCol];
          if (limit !== 99 && toArr.length >= limit) {
            // Put it back and re-render.
            fromArr.splice(idx, 0, card);
            toast({
              title: "WIP limit reached",
              message: `${cap(toCol)} is capped at ${limit}. Finish something first.`,
              kind: "warn",
              timeoutMs: 3200,
            });
            render();
            return;
          }
          const clamped = Math.max(0, Math.min(toIndex, toArr.length));
          toArr.splice(clamped, 0, card);
          scheduleSave();
          renderStats();
        }

        // --------- Card CRUD ---------
        function openCardDialog(cardId = null, defaultColumn = "todo") {
          ui.lastFocused = document.activeElement;
          const isEdit = Boolean(cardId);
          const card = isEdit ? findCard(cardId) : null;

          els.cardId.value = card?.id || "";
          els.cardTitle.value = card?.title || "";
          els.cardNotes.value = card?.notes || "";
          els.cardPriority.value = card?.priority || "med";
          els.cardColumn.value = locateCardColumn(cardId) || defaultColumn;

          const assignee = card?.assignee ? card.assignee : "unassigned";
          els.cardAssignee.value = state.people.includes(assignee) ? assignee : assignee ? assignee : "unassigned";

          els.cardDialogTitle.textContent = isEdit ? "Edit card" : "New card";
          els.cardDialogHint.textContent = isEdit ? "Press Enter on a card to edit during standup." : "Add something you can finish today";
          els.btnDeleteInDialog.style.display = isEdit ? "" : "none";
          els.newPersonField.style.display = "none";
          els.newPersonName.value = "";

          // Ensure selects are up to date
          renderAssigneeSelect();
          els.cardAssignee.value = assignee === "unassigned" ? "unassigned" : assignee;

          els.cardDialog.showModal();
          setTimeout(() => els.cardTitle.focus(), 0);
        }

        function closeCardDialog() {
          if (els.cardDialog.open) els.cardDialog.close();
          restoreFocus();
        }

        function restoreFocus() {
          const el = ui.lastFocused;
          ui.lastFocused = null;
          if (el && typeof el.focus === "function") {
            try {
              el.focus();
            } catch {}
          }
        }

        function saveCardFromDialog() {
          const id = els.cardId.value.trim();
          const title = els.cardTitle.value.trim();
          const notes = els.cardNotes.value.trim();
          const priority = els.cardPriority.value;
          const col = els.cardColumn.value;
          let assignee = els.cardAssignee.value;

          if (!title) {
            toast({ title: "Missing title", message: "Card title is required.", kind: "warn" });
            return false;
          }
          if (!COLS.some((c) => c.id === col)) return false;

          if (assignee === "__new__") {
            const cleaned = cleanName(els.newPersonName.value || "");
            if (cleaned) {
              state.people = dedupe([...state.people, cleaned]);
              assignee = cleaned;
            } else {
              assignee = "unassigned";
            }
          }
          if (assignee === "unassigned") assignee = "";

          const existing = id ? findCard(id) : null;
          if (existing) {
            existing.title = title;
            existing.notes = notes;
            existing.priority = priority;
            existing.assignee = assignee;

            const fromCol = locateCardColumn(id);
            if (fromCol && fromCol !== col) {
              // move to end of target by default
              const fromArr = state.columns[fromCol];
              state.columns[fromCol] = fromArr.filter((c) => c.id !== id);
              const toArr = state.columns[col];
              const limit = state.limits[col];
              if (limit !== 99 && toArr.length >= limit) {
                toast({
                  title: "WIP limit reached",
                  message: `${cap(col)} is capped at ${limit}.`,
                  kind: "warn",
                });
                // put back
                state.columns[fromCol].push(existing);
                return false;
              }
              toArr.push(existing);
            }
            scheduleSave();
            toast({ title: "Updated", message: "Card saved.", kind: "info", timeoutMs: 1400 });
          } else {
            const toArr = state.columns[col];
            const limit = state.limits[col];
            if (limit !== 99 && toArr.length >= limit) {
              toast({
                title: "WIP limit reached",
                message: `${cap(col)} is capped at ${limit}.`,
                kind: "warn",
              });
              return false;
            }
            const card = { id: uid(), title, notes, priority, assignee, createdAt: Date.now() };
            toArr.unshift(card);
            scheduleSave();
            toast({ title: "Added", message: "New card created.", kind: "info", timeoutMs: 1400 });
          }

          render();
          return true;
        }

        function deleteCardFlow(cardId) {
          const card = findCard(cardId);
          if (!card) return;
          const ok = confirm(`Delete "${card.title}"?`);
          if (!ok) return;
          deleteCard(cardId);
          toast({ title: "Deleted", message: "Card removed.", kind: "info", timeoutMs: 1400 });
          render();
        }

        function deleteCard(cardId) {
          for (const c of COLS) {
            const before = state.columns[c.id].length;
            state.columns[c.id] = state.columns[c.id].filter((x) => x.id !== cardId);
            if (state.columns[c.id].length !== before) break;
          }
          scheduleSave();
        }

        function findCard(cardId) {
          for (const c of COLS) {
            const hit = state.columns[c.id].find((x) => x.id === cardId);
            if (hit) return hit;
          }
          return null;
        }
        function locateCardColumn(cardId) {
          if (!cardId) return null;
          for (const c of COLS) if (state.columns[c.id].some((x) => x.id === cardId)) return c.id;
          return null;
        }

        // --------- Settings ---------
        function openSettings() {
          ui.lastFocused = document.activeElement;
          els.wipTable.innerHTML = "";
          for (const c of COLS) {
            const row = document.createElement("div");
            row.className = "row";
            const left = document.createElement("div");
            left.innerHTML = `<strong>${escapeHtml(c.name)}</strong><div class="help">${escapeHtml(c.subtitle)}</div>`;
            const input = document.createElement("input");
            input.type = "number";
            input.min = "0";
            input.max = "99";
            input.step = "1";
            input.value = String(clampLimit(state.limits[c.id]));
            input.dataset.col = c.id;
            row.append(left, input);
            els.wipTable.appendChild(row);
          }
          els.peopleInput.value = state.people.join(", ");
          els.settingsDialog.showModal();
          setTimeout(() => els.peopleInput.focus(), 0);
        }

        function closeSettings() {
          if (els.settingsDialog.open) els.settingsDialog.close();
          restoreFocus();
        }

        function saveSettingsFromDialog() {
          const inputs = Array.from(els.wipTable.querySelectorAll('input[type="number"][data-col]'));
          for (const inp of inputs) {
            const col = inp.dataset.col;
            state.limits[col] = clampLimit(inp.value);
          }

          const people = (els.peopleInput.value || "")
            .split(",")
            .map((s) => cleanName(s))
            .filter(Boolean);
          state.people = people.length ? dedupe(people) : state.people;

          // Clean up any assignees not in list? Keep as-is but ensure chips include them if present.
          for (const col of COLS) {
            for (const card of state.columns[col.id]) {
              card.assignee = cleanName(card.assignee || "");
            }
          }

          // Ensure filters remain valid
          if (ui.assignee !== "all" && !state.people.includes(ui.assignee)) ui.assignee = "all";

          scheduleSave();
          render();
          const over = [];
          for (const c of COLS) {
            const lim = state.limits[c.id];
            if (lim !== 99 && state.columns[c.id].length > lim) {
              over.push(`${c.name} ${state.columns[c.id].length}/${lim}`);
            }
          }
          toast({
            title: "Settings saved",
            message: over.length ? `Over WIP: ${over.join(", ")}` : "WIP limits and people updated.",
            kind: over.length ? "warn" : "info",
            timeoutMs: over.length ? 3200 : 1600,
          });
          return true;
        }

        // --------- Export / import ---------
        function exportJson() {
          const payload = JSON.stringify(state, null, 2);
          const blob = new Blob([payload], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "tiny-kanban.json";
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          toast({ title: "Exported", message: "Downloaded tiny-kanban.json", kind: "info", timeoutMs: 1600 });
        }

        function openImport() {
          ui.lastFocused = document.activeElement;
          els.importText.value = "";
          els.importDialog.showModal();
          setTimeout(() => els.importText.focus(), 0);
        }

        function closeImport() {
          if (els.importDialog.open) els.importDialog.close();
          restoreFocus();
        }

        function applyImport() {
          const raw = els.importText.value.trim();
          if (!raw) {
            toast({ title: "Nothing to import", message: "Paste JSON first.", kind: "warn" });
            return false;
          }
          try {
            const parsed = JSON.parse(raw);
            const next = normalizeState(parsed);
            state = next;
            scheduleSave();
            ui.assignee = "all";
            ui.search = "";
            els.searchInput.value = "";
            render();
            toast({ title: "Imported", message: "Board replaced successfully.", kind: "info", timeoutMs: 2000 });
            return true;
          } catch {
            toast({ title: "Invalid JSON", message: "Could not parse import.", kind: "error", timeoutMs: 2600 });
            return false;
          }
        }

        // --------- Controls & events ---------
        function hydrateControls() {
          els.searchInput.addEventListener("input", () => {
            ui.search = els.searchInput.value || "";
            render();
          });

          els.btnAdd.addEventListener("click", () => openCardDialog(null, "todo"));
          els.btnTheme.addEventListener("click", toggleTheme);
          els.btnStandup.addEventListener("click", toggleStandup);
          els.btnSettings.addEventListener("click", openSettings);

          els.btnReset.addEventListener("click", () => {
            const ok = confirm("Reset the board to the sample cards? This will replace local data.");
            if (!ok) return;
            state = makeDefaultState();
            ui.search = "";
            ui.assignee = "all";
            els.searchInput.value = "";
            scheduleSave();
            render();
            toast({ title: "Reset", message: "Back to defaults.", kind: "info", timeoutMs: 1800 });
          });

          els.exportLink.addEventListener("click", (e) => {
            e.preventDefault();
            exportJson();
          });
          els.importLink.addEventListener("click", (e) => {
            e.preventDefault();
            openImport();
          });

          els.btnCloseCard.addEventListener("click", closeCardDialog);
          els.btnCloseSettings.addEventListener("click", closeSettings);
          els.btnCloseImport.addEventListener("click", closeImport);

          els.cardDialog.addEventListener("close", restoreFocus);
          els.settingsDialog.addEventListener("close", restoreFocus);
          els.importDialog.addEventListener("close", restoreFocus);

          els.cardAssignee.addEventListener("change", () => {
            const on = els.cardAssignee.value === "__new__";
            els.newPersonField.style.display = on ? "" : "none";
            if (on) setTimeout(() => els.newPersonName.focus(), 0);
          });

          els.cardForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const ok = saveCardFromDialog();
            if (ok) closeCardDialog();
          });
          els.btnCancelCard.addEventListener("click", (e) => {
            e.preventDefault();
            closeCardDialog();
          });
          els.btnDeleteInDialog.addEventListener("click", () => {
            const id = els.cardId.value.trim();
            if (!id) return;
            deleteCardFlow(id);
            closeCardDialog();
          });

          els.settingsForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const ok = saveSettingsFromDialog();
            if (ok) closeSettings();
          });
          document.getElementById("btnCancelSettings").addEventListener("click", (e) => {
            e.preventDefault();
            closeSettings();
          });

          els.importForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const ok = applyImport();
            if (ok) closeImport();
          });

          // Keyboard shortcut: Cmd/Ctrl+K
          window.addEventListener("keydown", (e) => {
            const isMac = /Mac|iPhone|iPad|iPod/i.test(navigator.platform);
            const mod = isMac ? e.metaKey : e.ctrlKey;
            if (mod && (e.key === "k" || e.key === "K")) {
              e.preventDefault();
              openCardDialog(null, "todo");
              return;
            }
            if (e.key === "Escape") {
              if (els.cardDialog.open) closeCardDialog();
              else if (els.settingsDialog.open) closeSettings();
              else if (els.importDialog.open) closeImport();
            }
          });
        }

        // --------- UI helpers ---------
        function toast({ title, message = "", kind = "info", timeoutMs = 2400 }) {
          const el = document.createElement("div");
          el.className = "toast";
          el.dataset.kind = kind;
          el.innerHTML = `
            <div class="bar" aria-hidden="true"></div>
            <div>
              <div class="toastTitle">${escapeHtml(title)}</div>
              ${message ? `<div class="toastMsg">${escapeHtml(message)}</div>` : ""}
            </div>
          `;
          els.toastHost.appendChild(el);
          const t = setTimeout(() => {
            el.style.transition = "opacity 160ms ease, transform 160ms ease";
            el.style.opacity = "0";
            el.style.transform = "translateY(6px)";
            setTimeout(() => el.remove(), 180);
          }, timeoutMs);
          el.addEventListener("click", () => {
            clearTimeout(t);
            el.remove();
          });
        }

        function iconButton(label, svg) {
          const b = document.createElement("button");
          b.type = "button";
          b.className = "cardBtn";
          b.setAttribute("aria-label", label);
          b.innerHTML = svg;
          return b;
        }

        function pencilIcon() {
          return `
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M14.06 9l.94.94L5.92 19H5v-.92zM17.66 3c-.25 0-.51.1-.7.29L15.13 5.12l3.75 3.75l1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29M14.06 6.19L3 17.25V21h3.75L17.81 9.94z"/>
            </svg>
          `;
        }
        function trashIcon() {
          return `
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6zm3.5-9h1v8h-1zm4 0h1v8h-1zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"/>
            </svg>
          `;
        }

        function highlight(text, search) {
          const s = (search || "").trim();
          if (!s) return escapeHtml(text);
          const t = String(text || "");
          const idx = t.toLowerCase().indexOf(s.toLowerCase());
          if (idx < 0) return escapeHtml(t);
          const before = escapeHtml(t.slice(0, idx));
          const hit = escapeHtml(t.slice(idx, idx + s.length));
          const after = escapeHtml(t.slice(idx + s.length));
          return `${before}<mark>${hit}</mark>${after}`;
        }

        function escapeHtml(s) {
          return String(s)
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");
        }

        function initials(name) {
          const parts = cleanName(name).split(/\s+/).filter(Boolean);
          const a = parts[0]?.[0] || "?";
          const b = parts[1]?.[0] || "";
          return (a + b).toUpperCase();
        }

        // --------- Utils ---------
        function uid() {
          if (window.crypto && typeof window.crypto.randomUUID === "function") return window.crypto.randomUUID();
          return "id-" + Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
        }
        function cap(s) {
          return String(s || "").slice(0, 1).toUpperCase() + String(s || "").slice(1);
        }
        function clampLimit(n) {
          const x = Number(n);
          if (!Number.isFinite(x)) return 99;
          return Math.max(0, Math.min(99, Math.floor(x)));
        }
        function cleanName(s) {
          return String(s || "")
            .replace(/\s+/g, " ")
            .trim()
            .slice(0, 28);
        }
        function dedupe(arr) {
          const seen = new Set();
          const out = [];
          for (const v of arr) {
            const key = String(v).toLowerCase();
            if (seen.has(key)) continue;
            seen.add(key);
            out.push(v);
          }
          return out;
        }

        function isFilterActive() {
          return Boolean((ui.search || "").trim()) || ui.assignee !== "all";
        }

        function getPeopleForUI() {
          const assignees = [];
          for (const c of COLS) {
            for (const card of state.columns[c.id]) {
              const a = cleanName(card.assignee || "");
              if (a) assignees.push(a);
            }
          }
          return dedupe([...state.people, ...assignees].map(cleanName).filter(Boolean));
        }
      })();
    </script>
  </body>
</html>
