<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>Markdown → Slides</title>
    <style>
      :root {
        --bg0: #0b1020;
        --bg1: #0b1020;
        --panel: rgba(255, 255, 255, 0.06);
        --panel2: rgba(255, 255, 255, 0.08);
        --stroke: rgba(255, 255, 255, 0.12);
        --stroke2: rgba(255, 255, 255, 0.18);
        --text: rgba(255, 255, 255, 0.88);
        --muted: rgba(255, 255, 255, 0.62);
        --muted2: rgba(255, 255, 255, 0.46);
        --shadow: 0 30px 80px rgba(0, 0, 0, 0.55);
        --shadow2: 0 16px 40px rgba(0, 0, 0, 0.35);
        --brand: #7c5cff;
        --brand2: #2dd4bf;
        --warn: #f59e0b;
        --danger: #fb7185;
        --ok: #22c55e;
        --focus: rgba(124, 92, 255, 0.45);
        --radius-xl: 22px;
        --radius-lg: 18px;
        --radius-md: 14px;
        --radius-sm: 12px;
        --mono: ui-monospace, SFMono-Regular, SF Mono, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
          monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
          "Segoe UI Emoji";
        --slide-w: 1280;
        --slide-h: 720;
        --slide-pad-x: 104px;
        --slide-pad-y: 84px;
        --slide-surface: rgba(255, 255, 255, 0.06);
        --slide-stroke: rgba(255, 255, 255, 0.16);
        --slide-title: rgba(255, 255, 255, 0.93);
        --slide-text: rgba(255, 255, 255, 0.86);
        --slide-muted: rgba(255, 255, 255, 0.62);
        --slide-accent: linear-gradient(90deg, rgba(124, 92, 255, 0.9), rgba(45, 212, 191, 0.9));
      }

      html[data-theme="light"] {
        --bg0: #f7f8fb;
        --bg1: #eef1f7;
        --panel: rgba(255, 255, 255, 0.75);
        --panel2: rgba(255, 255, 255, 0.95);
        --stroke: rgba(2, 6, 23, 0.12);
        --stroke2: rgba(2, 6, 23, 0.2);
        --text: rgba(2, 6, 23, 0.9);
        --muted: rgba(2, 6, 23, 0.62);
        --muted2: rgba(2, 6, 23, 0.46);
        --shadow: 0 30px 80px rgba(2, 6, 23, 0.12);
        --shadow2: 0 16px 40px rgba(2, 6, 23, 0.08);
        --focus: rgba(124, 92, 255, 0.28);
        --slide-surface: rgba(255, 255, 255, 0.92);
        --slide-stroke: rgba(2, 6, 23, 0.12);
        --slide-title: rgba(2, 6, 23, 0.92);
        --slide-text: rgba(2, 6, 23, 0.86);
        --slide-muted: rgba(2, 6, 23, 0.55);
        --slide-accent: linear-gradient(90deg, rgba(124, 92, 255, 0.92), rgba(45, 212, 191, 0.92));
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: var(--sans);
        color: var(--text);
        background: radial-gradient(1200px 600px at 18% 12%, rgba(124, 92, 255, 0.22), transparent 55%),
          radial-gradient(1000px 520px at 82% 18%, rgba(45, 212, 191, 0.18), transparent 55%),
          radial-gradient(900px 520px at 70% 82%, rgba(245, 158, 11, 0.14), transparent 60%),
          linear-gradient(180deg, var(--bg0), var(--bg1));
        overflow: hidden;
      }

      a {
        color: inherit;
      }

      :focus-visible {
        outline: 2px solid var(--focus);
        outline-offset: 3px;
      }

      .app {
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 18px;
        gap: 12px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 220px;
      }
      .logo {
        width: 40px;
        height: 40px;
        border-radius: 14px;
        background: linear-gradient(135deg, rgba(124, 92, 255, 0.95), rgba(45, 212, 191, 0.9));
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.28);
        display: grid;
        place-items: center;
        position: relative;
        overflow: hidden;
      }
      .logo::after {
        content: "";
        position: absolute;
        inset: -40%;
        background: conic-gradient(from 110deg, rgba(255, 255, 255, 0.0), rgba(255, 255, 255, 0.36), rgba(255, 255, 255, 0.0));
        transform: rotate(18deg);
        filter: blur(0.2px);
        animation: shimmer 4.8s linear infinite;
        opacity: 0.8;
      }
      @keyframes shimmer {
        0% {
          transform: rotate(18deg) translateX(-40%);
        }
        100% {
          transform: rotate(18deg) translateX(40%);
        }
      }
      .brand h1 {
        margin: 0;
        font-size: 15px;
        line-height: 1.1;
        letter-spacing: 0.2px;
      }
      .brand .sub {
        margin: 0;
        font-size: 12px;
        line-height: 1.1;
        color: var(--muted);
      }

      .actions {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 9px 12px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, var(--panel2), var(--panel));
        box-shadow: var(--shadow2);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, var(--panel2), var(--panel));
        padding: 10px 12px;
        border-radius: 14px;
        color: var(--text);
        cursor: pointer;
        box-shadow: var(--shadow2);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: transform 120ms ease, border-color 120ms ease, background 120ms ease, opacity 120ms ease;
        user-select: none;
      }
      .btn:hover {
        transform: translateY(-1px);
        border-color: var(--stroke2);
      }
      .btn:active {
        transform: translateY(0);
      }
      .btn.secondary {
        box-shadow: none;
        background: transparent;
      }
      .btn.secondary:hover {
        background: rgba(255, 255, 255, 0.06);
      }
      html[data-theme="light"] .btn.secondary:hover {
        background: rgba(2, 6, 23, 0.04);
      }
      .btn .kbd {
        font-family: var(--mono);
        font-size: 11px;
        padding: 2px 7px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        color: var(--muted);
      }

      .toggle {
        position: relative;
        width: 44px;
        height: 28px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, var(--panel2), var(--panel));
        box-shadow: var(--shadow2);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        padding: 3px;
      }
      .toggle .dot {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.55));
        transform: translateX(0);
        transition: transform 160ms ease, background 160ms ease;
      }
      html[data-theme="light"] .toggle .dot {
        background: linear-gradient(180deg, rgba(2, 6, 23, 0.88), rgba(2, 6, 23, 0.55));
      }
      html[data-theme="light"] .toggle {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.65));
      }
      .toggle[aria-checked="true"] .dot {
        transform: translateX(16px);
      }

      .content {
        flex: 1;
        min-height: 0;
        display: grid;
        grid-template-columns: 440px 1fr;
        gap: 14px;
        padding: 0 14px 14px;
      }

      .panel {
        border: 1px solid var(--stroke);
        border-radius: var(--radius-xl);
        background: linear-gradient(180deg, var(--panel2), var(--panel));
        box-shadow: var(--shadow);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        overflow: hidden;
        min-height: 0;
      }

      .panelHeader {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 14px 14px 10px;
        border-bottom: 1px solid var(--stroke);
      }
      .panelHeader .title {
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 0;
      }
      .panelHeader .title strong {
        font-size: 13px;
        letter-spacing: 0.2px;
      }
      .panelHeader .title span {
        font-size: 12px;
        color: var(--muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .panelHeader .right {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .editor {
        display: flex;
        flex-direction: column;
      }

      textarea {
        flex: 1;
        min-height: 0;
        resize: none;
        border: 0;
        outline: 0;
        padding: 14px;
        background: transparent;
        color: var(--text);
        font-family: var(--mono);
        font-size: 13px;
        line-height: 1.45;
      }

      .hintRow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 10px 14px 14px;
        border-top: 1px solid var(--stroke);
        color: var(--muted);
        font-size: 12px;
      }
      .hintRow code {
        font-family: var(--mono);
        font-size: 11px;
        padding: 2px 7px;
        border: 1px solid var(--stroke);
        border-radius: 999px;
        color: var(--muted);
      }
      .statusPill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.04);
        color: var(--muted);
        font-size: 12px;
      }
      html[data-theme="light"] .statusPill {
        background: rgba(2, 6, 23, 0.03);
      }

      .preview {
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .stage {
        position: relative;
        flex: 1;
        min-height: 0;
        padding: 14px;
        display: grid;
        place-items: center;
      }

      .stageInner {
        width: 100%;
        height: 100%;
        border-radius: var(--radius-xl);
        border: 1px solid var(--stroke);
        background: radial-gradient(900px 460px at 30% 18%, rgba(124, 92, 255, 0.14), transparent 62%),
          radial-gradient(820px 520px at 76% 22%, rgba(45, 212, 191, 0.12), transparent 60%),
          radial-gradient(700px 480px at 62% 86%, rgba(245, 158, 11, 0.09), transparent 65%),
          rgba(255, 255, 255, 0.03);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
        position: relative;
        overflow: hidden;
        display: grid;
        place-items: center;
      }
      html[data-theme="light"] .stageInner {
        background: radial-gradient(900px 460px at 30% 18%, rgba(124, 92, 255, 0.09), transparent 62%),
          radial-gradient(820px 520px at 76% 22%, rgba(45, 212, 191, 0.08), transparent 60%),
          radial-gradient(700px 480px at 62% 86%, rgba(245, 158, 11, 0.06), transparent 65%),
          rgba(255, 255, 255, 0.55);
      }

      .slideWrap {
        width: calc(var(--slide-w) * 1px);
        height: calc(var(--slide-h) * 1px);
        transform-origin: center center;
        transform: scale(var(--scale, 0.75));
        will-change: transform;
        border-radius: 26px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 24px 80px rgba(0, 0, 0, 0.35);
      }

      .slide {
        width: 100%;
        height: 100%;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.02));
        position: relative;
      }
      html[data-theme="light"] .slide {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.9));
      }

      .slide::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(900px 380px at 28% 18%, rgba(124, 92, 255, 0.22), transparent 62%),
          radial-gradient(860px 480px at 76% 22%, rgba(45, 212, 191, 0.16), transparent 62%),
          radial-gradient(760px 500px at 62% 86%, rgba(245, 158, 11, 0.12), transparent 68%);
        opacity: 0.85;
        pointer-events: none;
      }
      html[data-theme="light"] .slide::before {
        opacity: 0.55;
      }

      .slide::after {
        content: "";
        position: absolute;
        inset: 0;
        background-image: linear-gradient(rgba(255, 255, 255, 0.08) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255, 255, 255, 0.06) 1px, transparent 1px);
        background-size: 44px 44px;
        opacity: 0.12;
        pointer-events: none;
        mask-image: radial-gradient(circle at 30% 30%, rgba(0, 0, 0, 0.9), transparent 60%);
      }
      html[data-theme="light"] .slide::after {
        background-image: linear-gradient(rgba(2, 6, 23, 0.08) 1px, transparent 1px),
          linear-gradient(90deg, rgba(2, 6, 23, 0.07) 1px, transparent 1px);
        opacity: 0.08;
      }

      .slideSurface {
        position: absolute;
        inset: 20px;
        border-radius: 22px;
        border: 1px solid var(--slide-stroke);
        background: var(--slide-surface);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
        overflow: hidden;
      }
      html[data-theme="light"] .slideSurface {
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55);
      }
      .slideAccent {
        height: 7px;
        background: var(--slide-accent);
      }
      .slideInner {
        height: calc(100% - 7px);
        padding: var(--slide-pad-y) var(--slide-pad-x);
        position: relative;
      }
      .slideFooter {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 20px var(--slide-pad-x);
        color: var(--slide-muted);
        font-size: 14px;
        letter-spacing: 0.2px;
        pointer-events: none;
      }
      .slideFooter .right {
        font-variant-numeric: tabular-nums;
      }
      .slideFooter .left {
        min-width: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .deckControls {
        position: absolute;
        left: 18px;
        right: 18px;
        bottom: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        pointer-events: none;
      }
      .deckControls .cluster {
        display: flex;
        gap: 10px;
        align-items: center;
        pointer-events: auto;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.18), rgba(0, 0, 0, 0.08));
        color: var(--text);
        box-shadow: 0 14px 44px rgba(0, 0, 0, 0.28);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }
      html[data-theme="light"] .pill {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.82), rgba(255, 255, 255, 0.62));
        box-shadow: 0 14px 44px rgba(2, 6, 23, 0.12);
      }
      .pill .meta {
        font-size: 12px;
        color: var(--muted);
      }
      .pill .num {
        font-variant-numeric: tabular-nums;
        font-size: 12px;
        color: var(--muted);
      }

      .iconBtn {
        width: 44px;
        height: 44px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.16), rgba(0, 0, 0, 0.06));
        color: var(--text);
        display: grid;
        place-items: center;
        cursor: pointer;
        transition: transform 120ms ease, border-color 120ms ease, opacity 120ms ease;
      }
      html[data-theme="light"] .iconBtn {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.65));
      }
      .iconBtn:hover {
        transform: translateY(-1px);
        border-color: var(--stroke2);
      }
      .iconBtn:active {
        transform: translateY(0);
      }
      .iconBtn[disabled] {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .progress {
        width: min(520px, 42vw);
        height: 10px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        overflow: hidden;
        background: rgba(255, 255, 255, 0.06);
        position: relative;
      }
      html[data-theme="light"] .progress {
        background: rgba(2, 6, 23, 0.04);
      }
      .progress > span {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 0%;
        background: linear-gradient(90deg, rgba(124, 92, 255, 0.95), rgba(45, 212, 191, 0.92));
        border-radius: 999px;
        transition: width 160ms ease;
      }

      .thumbs {
        border-top: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.03);
        padding: 10px 10px 12px;
        overflow: auto;
      }
      html[data-theme="light"] .thumbs {
        background: rgba(2, 6, 23, 0.03);
      }
      .thumbsRow {
        display: flex;
        gap: 10px;
        align-items: stretch;
        min-width: max-content;
      }
      .thumb {
        width: 260px;
        border-radius: 16px;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.04);
        padding: 12px;
        cursor: pointer;
        transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
        text-align: left;
        color: var(--text);
        position: relative;
      }
      html[data-theme="light"] .thumb {
        background: rgba(255, 255, 255, 0.78);
      }
      .thumb:hover {
        transform: translateY(-1px);
        border-color: var(--stroke2);
      }
      .thumb[aria-current="true"] {
        border-color: rgba(124, 92, 255, 0.7);
        box-shadow: 0 10px 30px rgba(124, 92, 255, 0.18);
        background: rgba(124, 92, 255, 0.08);
      }
      html[data-theme="light"] .thumb[aria-current="true"] {
        background: rgba(124, 92, 255, 0.1);
      }
      .thumb .tTop {
        display: flex;
        gap: 10px;
        align-items: baseline;
        justify-content: space-between;
        margin-bottom: 8px;
      }
      .thumb .tNum {
        font-family: var(--mono);
        font-size: 11px;
        color: var(--muted);
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--stroke);
        border-radius: 999px;
        padding: 2px 7px;
      }
      html[data-theme="light"] .thumb .tNum {
        background: rgba(2, 6, 23, 0.04);
      }
      .thumb .tTitle {
        font-size: 13px;
        font-weight: 650;
        letter-spacing: 0.2px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }
      .thumb .tBody {
        font-size: 12px;
        color: var(--muted);
        line-height: 1.35;
        max-height: 50px;
        overflow: hidden;
      }

      /* Slide content typography */
      .md {
        height: 100%;
        color: var(--slide-text);
        position: relative;
      }
      .md h1,
      .md h2,
      .md h3 {
        margin: 0 0 16px;
        color: var(--slide-title);
        letter-spacing: 0.2px;
      }
      .md h1 {
        font-size: 56px;
        line-height: 1.05;
      }
      .md h2 {
        font-size: 40px;
        line-height: 1.12;
      }
      .md h3 {
        font-size: 28px;
        line-height: 1.18;
      }
      .md p {
        margin: 0 0 16px;
        font-size: 22px;
        line-height: 1.42;
        color: var(--slide-text);
      }
      .md ul,
      .md ol {
        margin: 10px 0 16px;
        padding-left: 28px;
        font-size: 22px;
        line-height: 1.42;
      }
      .md li {
        margin: 10px 0;
      }
      .md strong {
        color: var(--slide-title);
      }
      .md a {
        color: inherit;
        text-decoration: underline;
        text-decoration-color: rgba(45, 212, 191, 0.65);
        text-underline-offset: 4px;
      }
      .md hr {
        border: 0;
        height: 1px;
        background: rgba(255, 255, 255, 0.16);
        margin: 24px 0;
      }
      html[data-theme="light"] .md hr {
        background: rgba(2, 6, 23, 0.12);
      }
      .md blockquote {
        margin: 18px 0;
        padding: 16px 18px;
        border-radius: 18px;
        border: 1px solid rgba(124, 92, 255, 0.35);
        background: rgba(124, 92, 255, 0.08);
        color: var(--slide-text);
      }
      .md blockquote p {
        margin: 0;
      }
      .md code {
        font-family: var(--mono);
        font-size: 0.92em;
        padding: 2px 8px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(0, 0, 0, 0.22);
      }
      html[data-theme="light"] .md code {
        border: 1px solid rgba(2, 6, 23, 0.12);
        background: rgba(2, 6, 23, 0.04);
      }
      .md pre {
        margin: 16px 0 18px;
        padding: 16px 16px 14px;
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(0, 0, 0, 0.26);
        position: relative;
        overflow: auto;
      }
      html[data-theme="light"] .md pre {
        border: 1px solid rgba(2, 6, 23, 0.12);
        background: rgba(2, 6, 23, 0.045);
      }
      .md pre code {
        border: 0;
        padding: 0;
        background: transparent;
        display: block;
        font-size: 16px;
        line-height: 1.45;
      }
      .copyBtn {
        position: absolute;
        top: 12px;
        right: 12px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        font-family: var(--sans);
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(0, 0, 0, 0.22);
        color: rgba(255, 255, 255, 0.86);
        cursor: pointer;
        user-select: none;
        transition: transform 120ms ease, opacity 120ms ease;
      }
      html[data-theme="light"] .copyBtn {
        border: 1px solid rgba(2, 6, 23, 0.12);
        background: rgba(255, 255, 255, 0.78);
        color: rgba(2, 6, 23, 0.78);
      }
      .copyBtn:hover {
        transform: translateY(-1px);
      }

      /* Lightweight “syntax” accents (no external CSS) */
      .md pre code .tok-k {
        color: #a78bfa;
      }
      .md pre code .tok-s {
        color: #34d399;
      }
      .md pre code .tok-n {
        color: #60a5fa;
      }
      .md pre code .tok-c {
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
      }
      html[data-theme="light"] .md pre code .tok-c {
        color: rgba(2, 6, 23, 0.45);
      }

      /* Fullscreen / presentation mode */
      body.presentation .topbar,
      body.presentation .editorPanel,
      body.presentation .thumbs {
        display: none !important;
      }
      body.presentation .content {
        grid-template-columns: 1fr !important;
        padding: 0;
        gap: 0;
      }
      body.presentation .panel.previewPanel {
        border-radius: 0;
        border: 0;
        box-shadow: none;
      }
      body.presentation .stage {
        padding: 0;
      }
      body.presentation .stageInner {
        border-radius: 0;
        border: 0;
      }
      body.presentation .deckControls {
        bottom: 26px;
      }

      /* Small screens: tabbed view */
      .tabs {
        display: none;
        gap: 10px;
        align-items: center;
        justify-content: center;
        padding: 8px 14px 0;
      }
      .tabBtn {
        border: 1px solid var(--stroke);
        border-radius: 999px;
        padding: 10px 14px;
        background: rgba(255, 255, 255, 0.03);
        color: var(--text);
        cursor: pointer;
        font-size: 13px;
        box-shadow: var(--shadow2);
      }
      html[data-theme="light"] .tabBtn {
        background: rgba(255, 255, 255, 0.72);
      }
      .tabBtn[aria-selected="true"] {
        border-color: rgba(124, 92, 255, 0.6);
        background: rgba(124, 92, 255, 0.12);
      }

      @media (max-width: 980px) {
        body {
          overflow: auto;
        }
        .content {
          grid-template-columns: 1fr;
          grid-template-rows: 1fr;
          padding-bottom: 12px;
          overflow: visible;
        }
        .tabs {
          display: flex;
        }
        .panel.editorPanel,
        .panel.previewPanel {
          min-height: 0;
          height: calc(100vh - 148px);
        }
        body[data-mobile-view="preview"] .panel.editorPanel {
          display: none;
        }
        body[data-mobile-view="editor"] .panel.previewPanel {
          display: none;
        }
      }

      /* Modal */
      .modalBackdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 22px;
        z-index: 50;
      }
      .modalBackdrop[data-open="true"] {
        display: flex;
      }
      .modal {
        width: min(760px, 100%);
        border-radius: 22px;
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, var(--panel2), var(--panel));
        box-shadow: var(--shadow);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        overflow: hidden;
      }
      .modalHeader {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 14px 12px;
        border-bottom: 1px solid var(--stroke);
      }
      .modalHeader strong {
        font-size: 14px;
        letter-spacing: 0.2px;
      }
      .modalBody {
        padding: 14px;
        color: var(--text);
      }
      .grid2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      @media (max-width: 700px) {
        .grid2 {
          grid-template-columns: 1fr;
        }
      }
      .card {
        border: 1px solid var(--stroke);
        border-radius: 18px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.03);
      }
      html[data-theme="light"] .card {
        background: rgba(255, 255, 255, 0.78);
      }
      .card h3 {
        margin: 0 0 8px;
        font-size: 13px;
        letter-spacing: 0.2px;
      }
      .card ul {
        margin: 0;
        padding-left: 18px;
        color: var(--muted);
        font-size: 12px;
        line-height: 1.5;
      }
      .card li {
        margin: 6px 0;
      }
      .hr {
        height: 1px;
        background: var(--stroke);
        margin: 12px 0;
      }
      .tiny {
        font-size: 12px;
        color: var(--muted);
        line-height: 1.5;
      }
      .toast {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.18), rgba(0, 0, 0, 0.08));
        box-shadow: 0 16px 50px rgba(0, 0, 0, 0.3);
        color: var(--text);
        z-index: 60;
        display: none;
      }
      html[data-theme="light"] .toast {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        box-shadow: 0 16px 50px rgba(2, 6, 23, 0.12);
      }
      .toast[data-show="true"] {
        display: block;
        animation: toastIn 180ms ease-out;
      }
      @keyframes toastIn {
        from {
          transform: translateX(-50%) translateY(8px);
          opacity: 0;
        }
        to {
          transform: translateX(-50%) translateY(0);
          opacity: 1;
        }
      }

      /* SVG icon colors */
      svg {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="app" id="app">
      <div class="topbar" role="banner">
        <div class="brand" aria-label="Markdown to Slides">
          <div class="logo" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path
                d="M5.5 6.8c0-1.1.9-2 2-2h9c1.1 0 2 .9 2 2v10.4c0 1.1-.9 2-2 2h-9c-1.1 0-2-.9-2-2V6.8Z"
                stroke="rgba(255,255,255,.92)"
                stroke-width="1.6"
              />
              <path
                d="M8 9.2h8M8 12h6.2M8 14.8h7.2"
                stroke="rgba(255,255,255,.92)"
                stroke-linecap="round"
                stroke-width="1.6"
              />
            </svg>
          </div>
          <div>
            <h1>Markdown → Slides</h1>
            <p class="sub" id="deckSubtitle">Live deck builder · <span id="slideCountText">0 slides</span></p>
          </div>
        </div>

        <div class="actions" aria-label="Actions">
          <div class="chip" aria-label="Theme">
            <span style="font-size: 12px; color: var(--muted); letter-spacing: 0.2px">Theme</span>
            <button class="toggle" id="themeToggle" type="button" role="switch" aria-checked="false" aria-label="Toggle theme">
              <span class="dot" aria-hidden="true"></span>
            </button>
          </div>
          <button class="btn" id="loadSampleBtn" type="button" title="Load sample deck">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M8 6h10a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z"
                stroke="currentColor"
                stroke-width="1.6"
              />
              <path
                d="M4 10V6a2 2 0 0 1 2-2h8"
                stroke="currentColor"
                stroke-width="1.6"
                stroke-linecap="round"
              />
            </svg>
            Sample
          </button>
          <button class="btn" id="helpBtn" type="button" title="Keyboard shortcuts">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z"
                stroke="currentColor"
                stroke-width="1.6"
              />
              <path
                d="M9.7 9.4A2.4 2.4 0 1 1 12 12v1"
                stroke="currentColor"
                stroke-width="1.6"
                stroke-linecap="round"
              />
              <path d="M12 17h.01" stroke="currentColor" stroke-width="2.6" stroke-linecap="round" />
            </svg>
            Help
            <span class="kbd">?</span>
          </button>
          <button class="btn" id="fullscreenBtn" type="button" title="Fullscreen presentation">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M9 4H6a2 2 0 0 0-2 2v3M15 4h3a2 2 0 0 1 2 2v3M9 20H6a2 2 0 0 1-2-2v-3M15 20h3a2 2 0 0 0 2-2v-3"
                stroke="currentColor"
                stroke-width="1.6"
                stroke-linecap="round"
              />
            </svg>
            Present
            <span class="kbd">F</span>
          </button>
        </div>
      </div>

      <div class="tabs" aria-label="Mobile tabs">
        <button class="tabBtn" id="tabEditor" type="button" aria-selected="true">Editor</button>
        <button class="tabBtn" id="tabPreview" type="button" aria-selected="false">Preview</button>
      </div>

      <div class="content" role="main">
        <section class="panel editorPanel editor" aria-label="Markdown editor">
          <div class="panelHeader">
            <div class="title">
              <strong>Markdown</strong>
              <span>Use <code>---</code> on its own line to start a new slide</span>
            </div>
            <div class="right">
              <button class="btn secondary" id="copyMdBtn" type="button" title="Copy markdown">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path
                    d="M8 8h10a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2Z"
                    stroke="currentColor"
                    stroke-width="1.6"
                  />
                  <path
                    d="M6 16H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
                    stroke="currentColor"
                    stroke-width="1.6"
                    stroke-linecap="round"
                  />
                </svg>
                Copy
              </button>
            </div>
          </div>
          <textarea id="mdInput" spellcheck="false" aria-label="Markdown input"></textarea>
          <div class="hintRow">
            <div class="statusPill" id="deckMeta">
              <span id="deckTitleText">Deck</span>
              <span style="opacity: 0.55">·</span>
              <span id="wordsText">0 words</span>
            </div>
            <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end">
              <span>Navigate:</span>
              <code>←</code><code>→</code><code>Space</code><code>Home</code><code>End</code>
              <span style="opacity: 0.7">·</span>
              <span>Fullscreen:</span>
              <code>F</code><code>Esc</code>
            </div>
          </div>
        </section>

        <section class="panel previewPanel preview" aria-label="Slides preview">
          <div class="panelHeader">
            <div class="title">
              <strong>Preview</strong>
              <span id="slideHint">Slide 1 of 1</span>
            </div>
            <div class="right">
              <button class="btn secondary" id="overviewBtn" type="button" title="Toggle thumbnails">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path
                    d="M4 6a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Z"
                    stroke="currentColor"
                    stroke-width="1.6"
                  />
                  <path
                    d="M14 6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2V6Z"
                    stroke="currentColor"
                    stroke-width="1.6"
                  />
                  <path
                    d="M4 16a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2Z"
                    stroke="currentColor"
                    stroke-width="1.6"
                  />
                  <path
                    d="M14 16a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-2Z"
                    stroke="currentColor"
                    stroke-width="1.6"
                  />
                </svg>
                Thumbnails
              </button>
              <button class="btn secondary" id="resetViewBtn" type="button" title="Go to first slide">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path
                    d="M7 4v16"
                    stroke="currentColor"
                    stroke-width="1.6"
                    stroke-linecap="round"
                  />
                  <path
                    d="M18 6l-8 6 8 6V6Z"
                    stroke="currentColor"
                    stroke-width="1.6"
                    stroke-linejoin="round"
                  />
                </svg>
                Start
              </button>
            </div>
          </div>

          <div class="stage" id="stage">
            <div class="stageInner" id="stageInner" aria-label="Slide stage">
              <div class="slideWrap" id="slideWrap" aria-live="polite">
                <div class="slide" id="slide">
                  <div class="slideSurface">
                    <div class="slideAccent" aria-hidden="true"></div>
                    <div class="slideInner">
                      <div class="md" id="slideContent"></div>
                      <div class="slideFooter" aria-hidden="true">
                        <div class="left" id="footerLeft">—</div>
                        <div class="right" id="footerRight">1 / 1</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="deckControls" aria-label="Deck controls">
                <div class="cluster">
                  <button class="iconBtn" id="prevBtn" type="button" aria-label="Previous slide" title="Previous (←)">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                      <path
                        d="M15 6l-6 6 6 6"
                        stroke="currentColor"
                        stroke-width="1.8"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                  <button class="iconBtn" id="nextBtn" type="button" aria-label="Next slide" title="Next (→ / Space)">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                      <path
                        d="M9 6l6 6-6 6"
                        stroke="currentColor"
                        stroke-width="1.8"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                </div>

                <div class="pill" aria-label="Slide status">
                  <div class="num" id="pillNum">1 / 1</div>
                  <div class="meta" id="pillTitle">—</div>
                </div>

                <div class="cluster" aria-label="Progress">
                  <div class="progress" aria-label="Progress bar"><span id="progressBar"></span></div>
                </div>
              </div>
            </div>
          </div>

          <div class="thumbs" id="thumbs" aria-label="Thumbnails">
            <div class="thumbsRow" id="thumbsRow"></div>
          </div>
        </section>
      </div>
    </div>

    <div class="modalBackdrop" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpTitle" data-open="false">
      <div class="modal">
        <div class="modalHeader">
          <strong id="helpTitle">Keyboard shortcuts</strong>
          <button class="btn secondary" id="helpCloseBtn" type="button" aria-label="Close help">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M18 6L6 18M6 6l12 12"
                stroke="currentColor"
                stroke-width="1.8"
                stroke-linecap="round"
              />
            </svg>
          </button>
        </div>
        <div class="modalBody">
          <div class="grid2">
            <div class="card">
              <h3>Navigation</h3>
              <ul>
                <li><span style="color: var(--text)">Next:</span> <code>→</code> <code>Space</code> <code>PgDn</code> <code>N</code></li>
                <li><span style="color: var(--text)">Previous:</span> <code>←</code> <code>PgUp</code> <code>P</code></li>
                <li><span style="color: var(--text)">First/Last:</span> <code>Home</code> / <code>End</code></li>
                <li><span style="color: var(--text)">Thumbnails:</span> <code>O</code></li>
              </ul>
            </div>
            <div class="card">
              <h3>Presentation</h3>
              <ul>
                <li><span style="color: var(--text)">Fullscreen:</span> <code>F</code></li>
                <li><span style="color: var(--text)">Exit:</span> <code>Esc</code></li>
                <li><span style="color: var(--text)">Theme:</span> <code>T</code></li>
                <li><span style="color: var(--text)">Help:</span> <code>?</code></li>
              </ul>
            </div>
          </div>
          <div class="hr"></div>
          <div class="tiny">
            Tips: Use <code>---</code> on its own line to start a new slide. Your draft is saved automatically to local
            storage. Links in slides open in a new tab.
          </div>
        </div>
      </div>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite" data-show="false">Copied</div>

    <!-- Libraries (CDN): allowed; app logic + CSS are fully inlined -->
    <script src="https://cdn.jsdelivr.net/npm/marked@14.0.0/marked.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js" crossorigin="anonymous"></script>

    <script>
      (() => {
        "use strict";

        const SAMPLE_MD = `# Q1 Business Review
### Momentum, focus, and measurable outcomes

**Prepared for:** Executive Leadership · **Owner:** Strategy & Ops · **Date:** ${new Date().toLocaleDateString()}

---

## Agenda

- Why we’re here (the decision we need to make)
- Performance snapshot (KPIs + drivers)
- Priorities for Q2 (what we will do, and what we will stop)
- Risks & mitigations
- Ask / next steps

---

## Executive summary

> We’re growing efficiently. The next unlock is **pipeline quality** and **time-to-value**—not volume.

- Revenue is tracking above plan with healthy margin.
- Conversion improved after onboarding changes; churn is stable.
- We’ll concentrate Q2 spend on 3 initiatives with clear owners and dates.

---

## KPI snapshot

- **ARR:** $18.4M (**+22% YoY**)
- **Gross margin:** 78% (**+2 pts**)
- **Net retention:** 114% (stable)
- **Sales cycle:** 41 days (**-6 days**)

### KPI trend (illustrative)

\`\`\`
ARR   ████████████████▊  +22%
NRR   ███████████████▍   114%
Cycle ███████████▊       -6d
\`\`\`

---

## What changed (drivers)

1. **Onboarding v2** reduced friction in week 1.
2. Better qualification: fewer low-fit demos.
3. Customer education moved from reactive → proactive.

---

## Q2 priorities (do fewer, better)

### 1) Pipeline quality
- Tighten ICP with 5 “must-have” signals
- Move to **two-stage** qualification
- Add a weekly deal review with objective criteria

### 2) Time-to-value
- “First value” checklist in product
- 3 guided templates for core workflows

### 3) Expansion motion
- Usage-based triggers
- Renewal playbook for top 30 accounts

---

## Timeline

- **Week 1–2:** ICP refinement + enablement
- **Week 3–5:** Onboarding templates + in-product checklist
- **Week 6–8:** Expansion triggers + renewal playbook pilot

---

## Risks & mitigations

- **Risk:** Too many changes at once  
  **Mitigation:** Ship in small increments; keep a single weekly release theme

- **Risk:** Over-optimizing for current segment  
  **Mitigation:** Maintain a “test lane” for new verticals

- **Risk:** Slower top-of-funnel  
  **Mitigation:** Protect brand campaigns; optimize conversion first

---

## Ask / next steps

- Approve Q2 focus (3 initiatives) and owners
- Confirm metrics: **time-to-value**, **NRR**, **sales cycle**
- Align on decision date: **next Friday**

---

# Thank you

**Questions?**`;

        const STORAGE = {
          markdown: "md2slides.markdown.v1",
          theme: "md2slides.theme.v1",
          slideIndex: "md2slides.slideIndex.v1",
          thumbsOpen: "md2slides.thumbsOpen.v1",
          mobileView: "md2slides.mobileView.v1",
        };

        const $ = (sel) => document.querySelector(sel);

        const els = {
          mdInput: $("#mdInput"),
          slideCountText: $("#slideCountText"),
          slideHint: $("#slideHint"),
          deckSubtitle: $("#deckSubtitle"),
          deckTitleText: $("#deckTitleText"),
          wordsText: $("#wordsText"),
          slideContent: $("#slideContent"),
          footerLeft: $("#footerLeft"),
          footerRight: $("#footerRight"),
          pillNum: $("#pillNum"),
          pillTitle: $("#pillTitle"),
          progressBar: $("#progressBar"),
          thumbs: $("#thumbs"),
          thumbsRow: $("#thumbsRow"),
          prevBtn: $("#prevBtn"),
          nextBtn: $("#nextBtn"),
          overviewBtn: $("#overviewBtn"),
          resetViewBtn: $("#resetViewBtn"),
          loadSampleBtn: $("#loadSampleBtn"),
          fullscreenBtn: $("#fullscreenBtn"),
          themeToggle: $("#themeToggle"),
          copyMdBtn: $("#copyMdBtn"),
          stage: $("#stage"),
          stageInner: $("#stageInner"),
          slideWrap: $("#slideWrap"),
          helpBtn: $("#helpBtn"),
          helpModal: $("#helpModal"),
          helpCloseBtn: $("#helpCloseBtn"),
          toast: $("#toast"),
          tabEditor: $("#tabEditor"),
          tabPreview: $("#tabPreview"),
        };

        const state = {
          slides: [],
          slideTitles: [],
          slideExcerpts: [],
          deckTitle: "Deck",
          index: 0,
          thumbsOpen: true,
          theme: "dark",
          mobileView: "editor",
          toastTimer: null,
          lastTouchX: null,
          lastTouchY: null,
        };

        function safeText(text) {
          return String(text || "").replace(/\s+/g, " ").trim();
        }

        function splitSlides(md) {
          const normalized = String(md || "").replace(/\r\n/g, "\n");
          const parts = normalized
            .split(/^\s*---\s*$/m)
            .map((s) => s.replace(/^\n+|\n+$/g, ""))
            .filter((s) => s.length > 0);
          return parts.length ? parts : [""];
        }

        function wordCount(md) {
          const text = String(md || "")
            .replace(/```[\s\S]*?```/g, " ")
            .replace(/`[^`]*`/g, " ")
            .replace(/[#>*_\-\[\]\(\)!]/g, " ")
            .replace(/\s+/g, " ")
            .trim();
          if (!text) return 0;
          return text.split(" ").length;
        }

        function setupMarked() {
          if (!window.marked) return;
          marked.setOptions({
            gfm: true,
            breaks: false,
            mangle: false,
            headerIds: false,
          });

          const renderer = new marked.Renderer();
          const defaultLink = renderer.link.bind(renderer);
          renderer.link = (href, title, text) => {
            const html = defaultLink(href, title, text);
            // Ensure links open in a new tab (post-sanitize safety also applied).
            return html.replace("<a ", '<a target="_blank" rel="noopener noreferrer" ');
          };
          marked.use({ renderer });
        }

        function tokenizeTitle(md) {
          if (!window.marked) return null;
          try {
            const tokens = marked.lexer(md || "");
            for (const t of tokens) {
              if (t.type === "heading" && t.depth <= 2) return safeText(t.text);
            }
          } catch {
            // Ignore.
          }
          return null;
        }

        function stripHtml(html) {
          const tmp = document.createElement("div");
          tmp.innerHTML = html;
          return safeText(tmp.textContent || tmp.innerText || "");
        }

        function sanitizeHtml(html) {
          if (window.DOMPurify) {
            return DOMPurify.sanitize(html, {
              USE_PROFILES: { html: true },
              ADD_ATTR: ["target", "rel"],
            });
          }
          // Fallback: naive pass-through.
          return html;
        }

        function tinyTokenizeCode(el) {
          // Very lightweight accenting for readability (not a full highlighter).
          // Safe: operates on textContent and writes spans.
          const raw = el.textContent || "";
          const escaped = raw
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;");

          // Comments
          let out = escaped.replace(/(^|\n)\s*(#.*)$/g, '$1<span class="tok-c">$2</span>');
          out = out.replace(/(\/\/.*)$/gm, '<span class="tok-c">$1</span>');

          // Strings (simple)
          out = out.replace(/(&quot;.*?&quot;)/g, '<span class="tok-s">$1</span>');
          out = out.replace(/(".*?")/g, '<span class="tok-s">$1</span>');
          out = out.replace(/('.*?')/g, '<span class="tok-s">$1</span>');

          // Numbers
          out = out.replace(/\b(\d+(\.\d+)?)\b/g, '<span class="tok-n">$1</span>');

          // Keywords (small set)
          out = out.replace(
            /\b(const|let|var|function|return|if|else|for|while|class|new|try|catch|throw|import|from|export|async|await)\b/g,
            '<span class="tok-k">$1</span>',
          );

          el.innerHTML = out;
        }

        function enhanceCodeBlocks(container) {
          const pres = Array.from(container.querySelectorAll("pre"));
          for (const pre of pres) {
            const code = pre.querySelector("code");
            if (!code) continue;
            if (pre.querySelector(".copyBtn")) continue;
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "copyBtn";
            btn.innerHTML = `
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 9h10a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.6"/>
                <path d="M6 15H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
              Copy`;
            btn.addEventListener("click", async () => {
              try {
                await navigator.clipboard.writeText(code.textContent || "");
                showToast("Code copied");
              } catch {
                showToast("Copy failed");
              }
            });
            pre.appendChild(btn);
            // Tiny “syntax” accents
            tinyTokenizeCode(code);
          }
        }

        function computeDeckTitle(parts) {
          for (const p of parts) {
            const t = tokenizeTitle(p);
            if (t) return t;
          }
          return "Deck";
        }

        function buildDeckFromMarkdown(md) {
          const parts = splitSlides(md);
          const deckTitle = computeDeckTitle(parts);

          const slides = [];
          const titles = [];
          const excerpts = [];

          for (let i = 0; i < parts.length; i++) {
            const slideMd = parts[i];
            let html = "";
            if (window.marked) {
              html = marked.parse(slideMd);
            } else {
              html = `<pre>${slideMd.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")}</pre>`;
            }

            html = sanitizeHtml(html);
            slides.push(html);

            const title = tokenizeTitle(slideMd) || `Slide ${i + 1}`;
            titles.push(title);

            const plain = stripHtml(html);
            const excerpt = plain.length > 110 ? plain.slice(0, 110).trim() + "…" : plain;
            excerpts.push(excerpt || "—");
          }

          return { slides, titles, excerpts, deckTitle };
        }

        function clamp(n, a, b) {
          return Math.max(a, Math.min(b, n));
        }

        function setIndex(nextIndex, { fromHash = false } = {}) {
          const total = state.slides.length || 1;
          state.index = clamp(nextIndex, 0, total - 1);
          try {
            localStorage.setItem(STORAGE.slideIndex, String(state.index));
          } catch {
            // ignore
          }
          renderSlide();
          renderThumbs();
          if (!fromHash) {
            const hash = `#${state.index + 1}`;
            if (location.hash !== hash) history.replaceState(null, "", hash);
          }
        }

        function updateMeta(md) {
          const total = state.slides.length || 1;
          els.slideCountText.textContent = `${total} slide${total === 1 ? "" : "s"}`;
          els.slideHint.textContent = `Slide ${state.index + 1} of ${total}`;
          els.wordsText.textContent = `${wordCount(md)} words`;
          els.deckTitleText.textContent = state.deckTitle;
        }

        function renderSlide() {
          const total = state.slides.length || 1;
          const idx = clamp(state.index, 0, total - 1);

          const html = state.slides[idx] || "";
          els.slideContent.innerHTML = html;
          enhanceCodeBlocks(els.slideContent);

          const title = state.slideTitles[idx] || `Slide ${idx + 1}`;
          const deckTitle = state.deckTitle || "Deck";
          els.pillTitle.textContent = title;
          els.pillNum.textContent = `${idx + 1} / ${total}`;
          els.footerLeft.textContent = deckTitle;
          els.footerRight.textContent = `${idx + 1} / ${total}`;
          els.slideHint.textContent = `Slide ${idx + 1} of ${total}`;

          const pct = total <= 1 ? 0 : (idx / (total - 1)) * 100;
          els.progressBar.style.width = `${pct}%`;

          els.prevBtn.disabled = idx <= 0;
          els.nextBtn.disabled = idx >= total - 1;

          updateScale();
        }

        function renderThumbs() {
          const total = state.slides.length || 1;
          const frag = document.createDocumentFragment();
          for (let i = 0; i < total; i++) {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "thumb";
            btn.setAttribute("aria-current", String(i === state.index));
            btn.innerHTML = `
              <div class="tTop">
                <div class="tTitle">${escapeHtml(state.slideTitles[i] || `Slide ${i + 1}`)}</div>
                <div class="tNum">${i + 1}</div>
              </div>
              <div class="tBody">${escapeHtml(state.slideExcerpts[i] || "—")}</div>
            `;
            btn.addEventListener("click", () => setIndex(i));
            frag.appendChild(btn);
          }
          els.thumbsRow.innerHTML = "";
          els.thumbsRow.appendChild(frag);
        }

        function escapeHtml(s) {
          return String(s || "")
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#39;");
        }

        function updateScale() {
          // Fit the 16:9 slide within the stage, leaving room for controls.
          const stage = els.stageInner.getBoundingClientRect();
          const pad = 26; // inner breathing room
          const controlsSpace = 96;
          const availableW = Math.max(280, stage.width - pad * 2);
          const availableH = Math.max(220, stage.height - pad * 2 - controlsSpace);
          const baseW = Number(getComputedStyle(document.documentElement).getPropertyValue("--slide-w")) || 1280;
          const baseH = Number(getComputedStyle(document.documentElement).getPropertyValue("--slide-h")) || 720;
          const scale = Math.min(availableW / baseW, availableH / baseH);
          document.documentElement.style.setProperty("--scale", String(clamp(scale, 0.25, 1.15)));
        }

        function showToast(message) {
          els.toast.textContent = message;
          els.toast.setAttribute("data-show", "true");
          if (state.toastTimer) window.clearTimeout(state.toastTimer);
          state.toastTimer = window.setTimeout(() => {
            els.toast.setAttribute("data-show", "false");
          }, 1200);
        }

        function applyTheme(nextTheme) {
          state.theme = nextTheme === "light" ? "light" : "dark";
          document.documentElement.setAttribute("data-theme", state.theme);
          els.themeToggle.setAttribute("aria-checked", String(state.theme === "light"));
          try {
            localStorage.setItem(STORAGE.theme, state.theme);
          } catch {
            // ignore
          }
        }

        function setThumbsOpen(open) {
          state.thumbsOpen = !!open;
          els.thumbs.style.display = state.thumbsOpen ? "block" : "none";
          try {
            localStorage.setItem(STORAGE.thumbsOpen, state.thumbsOpen ? "1" : "0");
          } catch {
            // ignore
          }
          updateScale();
        }

        function isFullscreen() {
          return !!document.fullscreenElement;
        }

        function enterPresentation() {
          document.body.classList.add("presentation");
          updateScale();
        }

        function exitPresentation() {
          document.body.classList.remove("presentation");
          updateScale();
        }

        async function toggleFullscreen() {
          try {
            if (!isFullscreen()) {
              await els.stage.requestFullscreen();
            } else {
              await document.exitFullscreen();
            }
          } catch {
            showToast("Fullscreen unavailable");
          }
        }

        function openHelp(open) {
          els.helpModal.setAttribute("data-open", open ? "true" : "false");
          if (open) {
            els.helpCloseBtn.focus();
          }
        }

        function setMobileView(view) {
          const next = view === "preview" ? "preview" : "editor";
          state.mobileView = next;
          document.body.setAttribute("data-mobile-view", next);
          els.tabEditor.setAttribute("aria-selected", String(next === "editor"));
          els.tabPreview.setAttribute("aria-selected", String(next === "preview"));
          try {
            localStorage.setItem(STORAGE.mobileView, next);
          } catch {
            // ignore
          }
          updateScale();
        }

        function applyDeckFromInput({ keepIndex = true } = {}) {
          const md = els.mdInput.value || "";
          const deck = buildDeckFromMarkdown(md);
          state.slides = deck.slides;
          state.slideTitles = deck.titles;
          state.slideExcerpts = deck.excerpts;
          state.deckTitle = deck.deckTitle;
          updateMeta(md);

          const total = state.slides.length || 1;
          if (!keepIndex) {
            state.index = 0;
          } else {
            state.index = clamp(state.index, 0, total - 1);
          }
          renderSlide();
          renderThumbs();
        }

        function persistMarkdown(md) {
          try {
            localStorage.setItem(STORAGE.markdown, md);
          } catch {
            // ignore
          }
        }

        function readPersisted() {
          let md = null;
          let theme = null;
          let slideIndex = null;
          let thumbsOpen = null;
          let mobileView = null;
          try {
            md = localStorage.getItem(STORAGE.markdown);
            theme = localStorage.getItem(STORAGE.theme);
            slideIndex = localStorage.getItem(STORAGE.slideIndex);
            thumbsOpen = localStorage.getItem(STORAGE.thumbsOpen);
            mobileView = localStorage.getItem(STORAGE.mobileView);
          } catch {
            // ignore
          }
          return { md, theme, slideIndex, thumbsOpen, mobileView };
        }

        function initFromUrlHash() {
          const m = (location.hash || "").match(/^#(\d+)$/);
          if (!m) return null;
          const n = Number(m[1]);
          if (!Number.isFinite(n) || n <= 0) return null;
          return n - 1;
        }

        function isTypingTarget(ev) {
          const t = ev.target;
          if (!t) return false;
          const tag = (t.tagName || "").toLowerCase();
          return tag === "textarea" || tag === "input" || tag === "select" || t.isContentEditable;
        }

        function handleKeydown(ev) {
          const key = ev.key;
          const typing = isTypingTarget(ev);

          // Global toggles (do not disrupt typing much)
          if (key === "?" && !ev.ctrlKey && !ev.metaKey && !ev.altKey) {
            if (typing) return;
            ev.preventDefault();
            openHelp(true);
            return;
          }
          if (key === "Escape") {
            if (els.helpModal.getAttribute("data-open") === "true") {
              ev.preventDefault();
              openHelp(false);
              return;
            }
            if (isFullscreen()) {
              // Let browser exit fullscreen; our listener updates UI.
              return;
            }
          }
          if ((key === "f" || key === "F") && !ev.ctrlKey && !ev.metaKey && !ev.altKey) {
            if (typing) return;
            ev.preventDefault();
            toggleFullscreen();
            return;
          }
          if ((key === "t" || key === "T") && !ev.ctrlKey && !ev.metaKey && !ev.altKey) {
            if (typing) return;
            ev.preventDefault();
            applyTheme(state.theme === "light" ? "dark" : "light");
            return;
          }
          if ((key === "o" || key === "O") && !ev.ctrlKey && !ev.metaKey && !ev.altKey) {
            if (typing) return;
            ev.preventDefault();
            setThumbsOpen(!state.thumbsOpen);
            return;
          }

          // Navigation: only capture when not typing OR in fullscreen.
          if (typing && !isFullscreen()) return;

          const navNext = key === "ArrowRight" || key === "PageDown" || key === " " || key === "n" || key === "N";
          const navPrev = key === "ArrowLeft" || key === "PageUp" || key === "p" || key === "P" || key === "Backspace";
          if (navNext) {
            ev.preventDefault();
            setIndex(state.index + 1);
            return;
          }
          if (navPrev) {
            ev.preventDefault();
            setIndex(state.index - 1);
            return;
          }
          if (key === "Home") {
            ev.preventDefault();
            setIndex(0);
            return;
          }
          if (key === "End") {
            ev.preventDefault();
            setIndex((state.slides.length || 1) - 1);
          }
        }

        function bindEvents() {
          // Editor input: debounced rebuild + persist.
          let t = null;
          els.mdInput.addEventListener("input", () => {
            const md = els.mdInput.value || "";
            persistMarkdown(md);
            if (t) window.clearTimeout(t);
            t = window.setTimeout(() => applyDeckFromInput({ keepIndex: true }), 140);
          });

          els.prevBtn.addEventListener("click", () => setIndex(state.index - 1));
          els.nextBtn.addEventListener("click", () => setIndex(state.index + 1));

          els.overviewBtn.addEventListener("click", () => setThumbsOpen(!state.thumbsOpen));
          els.resetViewBtn.addEventListener("click", () => setIndex(0));

          els.loadSampleBtn.addEventListener("click", () => {
            els.mdInput.value = SAMPLE_MD;
            persistMarkdown(SAMPLE_MD);
            applyDeckFromInput({ keepIndex: false });
            showToast("Sample loaded");
            setMobileView("preview");
          });

          els.fullscreenBtn.addEventListener("click", () => toggleFullscreen());

          els.themeToggle.addEventListener("click", () => applyTheme(state.theme === "light" ? "dark" : "light"));

          els.copyMdBtn.addEventListener("click", async () => {
            try {
              await navigator.clipboard.writeText(els.mdInput.value || "");
              showToast("Markdown copied");
            } catch {
              showToast("Copy failed");
            }
          });

          els.helpBtn.addEventListener("click", () => openHelp(true));
          els.helpCloseBtn.addEventListener("click", () => openHelp(false));
          els.helpModal.addEventListener("click", (ev) => {
            if (ev.target === els.helpModal) openHelp(false);
          });

          els.tabEditor.addEventListener("click", () => setMobileView("editor"));
          els.tabPreview.addEventListener("click", () => setMobileView("preview"));

          window.addEventListener("keydown", handleKeydown, { passive: false });
          window.addEventListener("resize", () => updateScale());

          document.addEventListener("fullscreenchange", () => {
            if (isFullscreen()) enterPresentation();
            else exitPresentation();
          });

          // Basic swipe navigation on fullscreen / stage
          els.stageInner.addEventListener(
            "pointerdown",
            (ev) => {
              state.lastTouchX = ev.clientX;
              state.lastTouchY = ev.clientY;
            },
            { passive: true },
          );
          els.stageInner.addEventListener(
            "pointerup",
            (ev) => {
              if (state.lastTouchX == null || state.lastTouchY == null) return;
              const dx = ev.clientX - state.lastTouchX;
              const dy = ev.clientY - state.lastTouchY;
              state.lastTouchX = null;
              state.lastTouchY = null;
              if (Math.abs(dx) < 60 || Math.abs(dx) < Math.abs(dy) * 1.4) return;
              if (dx < 0) setIndex(state.index + 1);
              else setIndex(state.index - 1);
            },
            { passive: true },
          );
        }

        function init() {
          setupMarked();

          const persisted = readPersisted();

          // Theme default: persisted > system > dark
          const systemPrefersLight =
            window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches ? true : false;
          const theme = persisted.theme || (systemPrefersLight ? "light" : "dark");
          applyTheme(theme);

          const thumbsOpen = persisted.thumbsOpen == null ? "1" : persisted.thumbsOpen;
          setThumbsOpen(thumbsOpen !== "0");

          const mobileView = persisted.mobileView || "editor";
          setMobileView(mobileView);

          const md = persisted.md && persisted.md.trim().length ? persisted.md : SAMPLE_MD;
          els.mdInput.value = md;
          applyDeckFromInput({ keepIndex: false });

          // Slide index: URL hash wins, then persisted
          const hashIndex = initFromUrlHash();
          const persistedIndex = persisted.slideIndex != null ? Number(persisted.slideIndex) : 0;
          if (hashIndex != null) setIndex(hashIndex, { fromHash: true });
          else if (Number.isFinite(persistedIndex)) setIndex(persistedIndex, { fromHash: false });

          bindEvents();
          updateScale();
        }

        init();
      })();
    </script>
  </body>
</html>
