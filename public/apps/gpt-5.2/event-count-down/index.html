<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="A polished, self-contained event countdown with a parallax background and calendar export."
    />
    <title>Event Countdown</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;750;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"%3E%3Cdefs%3E%3CradialGradient id="g" cx="30%25" cy="30%25" r="80%25"%3E%3Cstop offset="0%25" stop-color="%23a78bfa"/%3E%3Cstop offset="45%25" stop-color="%236366f1"/%3E%3Cstop offset="100%25" stop-color="%230b1020"/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width="64" height="64" rx="14" fill="url(%23g)"/%3E%3Cpath d="M18 20h28v4H18zM18 30h22v4H18zM18 40h16v4H18z" fill="white" opacity=".9"/%3E%3Ccircle cx="45" cy="42" r="6" fill="%23ffffff" opacity=".25"/%3E%3C/svg%3E'
    />
    <style>
      :root {
        --bg0: #070a14;
        --bg1: #0b1020;
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.68);
        --faint: rgba(255, 255, 255, 0.12);
        --card: rgba(255, 255, 255, 0.06);
        --card2: rgba(255, 255, 255, 0.08);
        --stroke: rgba(255, 255, 255, 0.14);
        --shadow: rgba(0, 0, 0, 0.55);
        --accent: #a78bfa;
        --accent2: #60a5fa;
        --good: #34d399;
        --warn: #fbbf24;
        --danger: #fb7185;
        --radius-lg: 22px;
        --radius-md: 16px;
        --radius-sm: 12px;
        --glow: 0 0 0.6rem rgba(167, 139, 250, 0.25), 0 0 1.6rem rgba(96, 165, 250, 0.16);
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
          monospace;
        --font: "Manrope", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          "Apple Color Emoji", "Segoe UI Emoji";
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: var(--font);
        color: var(--text);
        background: radial-gradient(1200px 900px at 20% 10%, rgba(167, 139, 250, 0.22), transparent 55%),
          radial-gradient(1000px 900px at 85% 25%, rgba(96, 165, 250, 0.16), transparent 58%),
          radial-gradient(900px 700px at 60% 90%, rgba(52, 211, 153, 0.09), transparent 60%),
          linear-gradient(180deg, var(--bg0), var(--bg1));
        overflow-x: hidden;
      }

      a {
        color: inherit;
      }

      .bg {
        position: fixed;
        inset: 0;
        z-index: -3;
        overflow: hidden;
      }

      .bg__image {
        position: absolute;
        inset: -8%;
        background-size: cover;
        background-position: center;
        filter: saturate(1.1) contrast(1.05);
        transform: translate3d(var(--px, 0px), var(--py, 0px), 0) scale(1.08);
        transition: background-image 400ms ease;
        will-change: transform;
      }

      .bg__mesh {
        position: absolute;
        inset: 0;
        opacity: 0.95;
        background:
          radial-gradient(600px 420px at 12% 18%, rgba(167, 139, 250, 0.26), transparent 68%),
          radial-gradient(700px 520px at 86% 22%, rgba(96, 165, 250, 0.18), transparent 65%),
          radial-gradient(900px 760px at 52% 92%, rgba(52, 211, 153, 0.11), transparent 62%),
          radial-gradient(900px 600px at 44% 42%, rgba(236, 72, 153, 0.08), transparent 68%);
        mix-blend-mode: screen;
        filter: blur(0px);
        animation: meshDrift 18s ease-in-out infinite alternate;
      }

      .bg__vignette {
        position: absolute;
        inset: 0;
        background:
          radial-gradient(900px 600px at 20% 10%, rgba(255, 255, 255, 0.08), transparent 60%),
          radial-gradient(900px 720px at 70% 10%, rgba(255, 255, 255, 0.06), transparent 60%),
          radial-gradient(1200px 900px at 50% 110%, rgba(0, 0, 0, 0.72), transparent 60%),
          linear-gradient(180deg, rgba(0, 0, 0, 0.12), rgba(0, 0, 0, 0.55));
        pointer-events: none;
      }

      .bg__noise {
        position: absolute;
        inset: 0;
        pointer-events: none;
        opacity: 0.12;
        background-image: repeating-linear-gradient(
            0deg,
            rgba(255, 255, 255, 0.06) 0px,
            rgba(255, 255, 255, 0.06) 1px,
            transparent 2px,
            transparent 4px
          ),
          repeating-linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.04) 0px,
            rgba(255, 255, 255, 0.04) 1px,
            transparent 2px,
            transparent 6px
          );
        mix-blend-mode: overlay;
        filter: blur(0.2px);
      }

      @keyframes meshDrift {
        0% {
          transform: translate3d(-1.5%, -1%, 0) scale(1.02);
          opacity: 0.88;
        }
        100% {
          transform: translate3d(1.5%, 1%, 0) scale(1.03);
          opacity: 1;
        }
      }

      .shell {
        max-width: 1180px;
        margin: 0 auto;
        padding: clamp(18px, 3.2vw, 40px);
      }

      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: clamp(18px, 2.8vw, 28px);
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 0;
      }

      .brand__mark {
        width: 42px;
        height: 42px;
        border-radius: 14px;
        background: radial-gradient(90% 90% at 25% 20%, rgba(167, 139, 250, 0.9), rgba(96, 165, 250, 0.25)),
          linear-gradient(180deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.06));
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 16px 30px rgba(0, 0, 0, 0.25);
        position: relative;
        overflow: hidden;
      }
      .brand__mark::after {
        content: "";
        position: absolute;
        inset: -40%;
        background: radial-gradient(circle at 35% 30%, rgba(255, 255, 255, 0.62), transparent 58%);
        transform: rotate(12deg);
        opacity: 0.35;
      }

      .brand__title {
        line-height: 1.1;
        min-width: 0;
      }
      .brand__title strong {
        display: block;
        font-weight: 800;
        letter-spacing: -0.02em;
        font-size: 16px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .brand__title span {
        display: block;
        font-size: 12.5px;
        color: var(--muted);
      }

      .chiprow {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        color: var(--muted);
        font-size: 12.5px;
      }
      .chip code {
        font-family: var(--mono);
        font-size: 12px;
        color: rgba(255, 255, 255, 0.78);
      }

      .layout {
        display: grid;
        grid-template-columns: 400px 1fr;
        gap: clamp(14px, 2.6vw, 24px);
        align-items: start;
      }

      @media (max-width: 980px) {
        .layout {
          grid-template-columns: 1fr;
        }
        .chiprow {
          justify-content: flex-start;
        }
      }

      .card {
        border-radius: var(--radius-lg);
        border: 1px solid var(--stroke);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.085), rgba(255, 255, 255, 0.04));
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.42);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        overflow: hidden;
      }

      .card__inner {
        padding: clamp(16px, 2.3vw, 22px);
      }

      .settings h2 {
        margin: 0 0 6px 0;
        font-size: 18px;
        letter-spacing: -0.02em;
      }

      .settings p {
        margin: 0 0 16px 0;
        color: var(--muted);
        font-size: 13.5px;
        line-height: 1.45;
      }

      .form {
        display: grid;
        gap: 12px;
      }

      .field {
        display: grid;
        gap: 8px;
      }
      .field label {
        font-size: 12.5px;
        color: rgba(255, 255, 255, 0.8);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .hint {
        font-size: 11.5px;
        color: rgba(255, 255, 255, 0.58);
      }
      .control {
        width: 100%;
        appearance: none;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(8, 12, 28, 0.35);
        color: var(--text);
        padding: 11px 12px;
        font-size: 14px;
        outline: none;
        transition: border-color 180ms ease, box-shadow 180ms ease, background 180ms ease;
      }
      .control::placeholder {
        color: rgba(255, 255, 255, 0.42);
      }
      .control:focus {
        border-color: rgba(167, 139, 250, 0.6);
        box-shadow: 0 0 0 4px rgba(167, 139, 250, 0.16);
        background: rgba(10, 14, 34, 0.42);
      }

      input[type="file"].control {
        padding: 10px 12px;
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
      }

      .btn {
        appearance: none;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(255, 255, 255, 0.06);
        color: rgba(255, 255, 255, 0.9);
        border-radius: 999px;
        padding: 10px 12px;
        font-size: 13.5px;
        font-weight: 700;
        letter-spacing: 0.01em;
        cursor: pointer;
        transition: transform 140ms ease, background 140ms ease, border-color 140ms ease, box-shadow 140ms ease;
        user-select: none;
      }
      .btn:hover {
        background: rgba(255, 255, 255, 0.085);
        border-color: rgba(255, 255, 255, 0.22);
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.18);
      }

      .btn--primary {
        border-color: rgba(167, 139, 250, 0.55);
        background: radial-gradient(120% 120% at 30% 20%, rgba(167, 139, 250, 0.55), rgba(96, 165, 250, 0.16))
          rgba(255, 255, 255, 0.06);
        box-shadow: var(--glow);
      }
      .btn--primary:hover {
        border-color: rgba(167, 139, 250, 0.72);
        background: radial-gradient(120% 120% at 30% 20%, rgba(167, 139, 250, 0.65), rgba(96, 165, 250, 0.18))
          rgba(255, 255, 255, 0.08);
      }

      .btn--ghost {
        background: rgba(0, 0, 0, 0.12);
        border-color: rgba(255, 255, 255, 0.14);
      }

      .divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.12);
        margin: 14px 0;
      }

      .drop {
        border-radius: var(--radius-md);
        border: 1px dashed rgba(255, 255, 255, 0.22);
        background: rgba(255, 255, 255, 0.03);
        padding: 12px;
      }

      .drop__row {
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      .drop strong {
        font-size: 13.5px;
        letter-spacing: -0.01em;
      }
      .drop span {
        color: var(--muted);
        font-size: 12.5px;
      }

      .count {
        position: relative;
      }

      .hero {
        display: grid;
        gap: 12px;
      }

      .eventline {
        display: grid;
        gap: 4px;
      }
      .eventline__title {
        font-weight: 800;
        letter-spacing: -0.03em;
        font-size: clamp(18px, 2.3vw, 24px);
        line-height: 1.15;
        text-shadow: 0 10px 22px rgba(0, 0, 0, 0.45);
      }
      .eventline__meta {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        color: var(--muted);
        font-size: 13.5px;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }
      .pill svg {
        width: 16px;
        height: 16px;
        opacity: 0.9;
      }

      .countdown {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: clamp(10px, 1.8vw, 14px);
        align-items: stretch;
      }

      @media (max-width: 560px) {
        .countdown {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      .unit {
        border-radius: var(--radius-lg);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.11), rgba(255, 255, 255, 0.04));
        border: 1px solid rgba(255, 255, 255, 0.14);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.35);
        padding: clamp(12px, 2.2vw, 16px);
        position: relative;
        overflow: hidden;
        transform: translateZ(0);
      }
      .unit::before {
        content: "";
        position: absolute;
        inset: -60%;
        background: radial-gradient(circle at 30% 20%, rgba(167, 139, 250, 0.26), transparent 60%),
          radial-gradient(circle at 65% 70%, rgba(96, 165, 250, 0.18), transparent 58%);
        filter: blur(10px);
        opacity: 0.55;
        transform: translate3d(0, 0, 0);
      }
      .unit::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), transparent 42%);
        opacity: 0.85;
        pointer-events: none;
      }
      .unit__value {
        position: relative;
        font-family: var(--mono);
        font-weight: 800;
        letter-spacing: -0.05em;
        font-variant-numeric: tabular-nums;
        font-size: clamp(30px, 4.2vw, 56px);
        line-height: 1;
        text-shadow: 0 20px 40px rgba(0, 0, 0, 0.55);
      }
      .unit__label {
        position: relative;
        margin-top: 10px;
        color: rgba(255, 255, 255, 0.72);
        font-size: 12px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
      }

      .unit.is-ticking .unit__value {
        animation: tickPop 520ms cubic-bezier(0.2, 0.9, 0.2, 1);
      }
      .unit.is-ticking::before {
        animation: tickGlow 520ms ease-out;
      }

      @keyframes tickPop {
        0% {
          transform: translate3d(0, 0, 0) scale(1);
          filter: blur(0px);
        }
        35% {
          transform: translate3d(0, -2px, 0) scale(1.04);
          filter: blur(0px);
        }
        100% {
          transform: translate3d(0, 0, 0) scale(1);
          filter: blur(0px);
        }
      }
      @keyframes tickGlow {
        0% {
          opacity: 0.35;
        }
        40% {
          opacity: 0.95;
        }
        100% {
          opacity: 0.55;
        }
      }

      .statusline {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
        align-items: baseline;
        margin-top: 2px;
      }
      .statusline__big {
        font-weight: 750;
        letter-spacing: -0.02em;
        font-size: 14px;
        color: rgba(255, 255, 255, 0.86);
      }
      .statusline__small {
        color: rgba(255, 255, 255, 0.6);
        font-size: 12.5px;
      }

      .actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 14px;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.72);
        font-size: 12.5px;
      }
      .badge b {
        color: rgba(255, 255, 255, 0.9);
      }

      .footerhint {
        margin-top: 14px;
        color: rgba(255, 255, 255, 0.58);
        font-size: 12.5px;
        line-height: 1.45;
      }
      .kbd {
        font-family: var(--mono);
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.07);
        border: 1px solid rgba(255, 255, 255, 0.12);
      }

      .toast {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        z-index: 50;
        display: grid;
        gap: 10px;
        width: min(560px, calc(100vw - 26px));
        pointer-events: none;
      }
      .toast__item {
        pointer-events: none;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(10, 14, 34, 0.65);
        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        padding: 12px 14px;
        display: flex;
        gap: 10px;
        align-items: flex-start;
        animation: toastIn 220ms ease-out, toastOut 260ms ease-in forwards;
        animation-delay: 0ms, var(--toast-life, 2400ms);
      }
      .toast__dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        margin-top: 4px;
        background: rgba(96, 165, 250, 0.95);
        box-shadow: 0 0 0.9rem rgba(96, 165, 250, 0.28);
      }
      .toast__dot.warn {
        background: rgba(251, 191, 36, 0.95);
        box-shadow: 0 0 0.9rem rgba(251, 191, 36, 0.24);
      }
      .toast__dot.danger {
        background: rgba(251, 113, 133, 0.95);
        box-shadow: 0 0 0.9rem rgba(251, 113, 133, 0.24);
      }
      .toast__msg {
        color: rgba(255, 255, 255, 0.86);
        font-size: 13.5px;
        line-height: 1.35;
      }

      @keyframes toastIn {
        from {
          opacity: 0;
          transform: translateY(12px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      @keyframes toastOut {
        to {
          opacity: 0;
          transform: translateY(12px) scale(0.99);
        }
      }

      dialog {
        border: none;
        padding: 0;
        background: transparent;
      }
      dialog::backdrop {
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }
      .modal {
        width: min(560px, calc(100vw - 26px));
      }
      .modal__card {
        border-radius: var(--radius-lg);
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        box-shadow: 0 30px 100px rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        overflow: hidden;
      }
      .modal__inner {
        padding: 16px 16px 14px 16px;
      }
      .modal__head {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 10px;
      }
      .modal__head h3 {
        margin: 0;
        font-size: 16px;
        letter-spacing: -0.02em;
      }
      .modal__head p {
        margin: 4px 0 0 0;
        color: var(--muted);
        font-size: 12.5px;
        line-height: 1.35;
      }
      .iconbtn {
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.86);
        border-radius: 12px;
        width: 38px;
        height: 38px;
        display: inline-grid;
        place-items: center;
        cursor: pointer;
      }
      .iconbtn:hover {
        background: rgba(255, 255, 255, 0.08);
      }
      .modal__list {
        display: grid;
        gap: 10px;
        margin-top: 10px;
      }
      .modal__item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 12px 12px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(0, 0, 0, 0.14);
      }
      .modal__item strong {
        display: block;
        font-size: 13.5px;
      }
      .modal__item span {
        display: block;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.6);
        margin-top: 2px;
      }
      .modal__actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation: none !important;
          transition: none !important;
          scroll-behavior: auto !important;
        }
        .bg__image {
          transform: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg" aria-hidden="true">
      <div class="bg__image" id="bgImage"></div>
      <div class="bg__mesh"></div>
      <div class="bg__noise"></div>
      <div class="bg__vignette"></div>
    </div>

    <div class="shell">
      <header class="topbar">
        <div class="brand">
          <div class="brand__mark" aria-hidden="true"></div>
          <div class="brand__title">
            <strong>Event Countdown</strong>
            <span>Live timer • parallax background • calendar export</span>
          </div>
        </div>
        <div class="chiprow" aria-label="Status">
          <div class="chip" title="Your local time zone">
            <span>Timezone</span>
            <code id="tzLabel">—</code>
          </div>
          <div class="chip" title="Settings are saved locally in your browser">
            <span>Autosave</span>
            <code>on</code>
          </div>
        </div>
      </header>

      <main class="layout">
        <section class="card settings" aria-label="Event details">
          <div class="card__inner">
            <h2>Set your event</h2>
            <p>Pick a date/time, add a location, and upload a background. The countdown updates live and can be exported to your calendar.</p>

            <form class="form" id="form" autocomplete="on">
              <div class="field">
                <label for="eventName">Event name <span class="hint" id="nameHint">Used for title</span></label>
                <input
                  class="control"
                  id="eventName"
                  name="eventName"
                  type="text"
                  placeholder="e.g., Product Launch"
                  maxlength="80"
                  spellcheck="false"
                />
              </div>

              <div class="field">
                <label for="eventDate">Date &amp; time <span class="hint" id="dateHint">Local time</span></label>
                <input class="control" id="eventDate" name="eventDate" type="datetime-local" />
              </div>

              <div class="field">
                <label for="eventLocation">Location <span class="hint">Optional</span></label>
                <input
                  class="control"
                  id="eventLocation"
                  name="eventLocation"
                  type="text"
                  placeholder="e.g., Main Hall, San Francisco"
                  maxlength="120"
                />
              </div>

              <div class="field">
                <label for="bgUpload">Background image <span class="hint">JPG/PNG/WebP</span></label>
                <div class="drop" id="dropZone" tabindex="0" role="button" aria-label="Upload background image (or drag and drop)">
                  <div class="drop__row">
                    <div>
                      <strong>Drop an image</strong>
                      <span>or use the picker</span>
                    </div>
                    <button class="btn btn--ghost" type="button" id="chooseBgBtn">Choose</button>
                  </div>
                  <div style="margin-top: 10px">
                    <input
                      class="control"
                      id="bgUpload"
                      name="bgUpload"
                      type="file"
                      accept="image/*"
                    />
                  </div>
                </div>
              </div>

              <div class="row">
                <button class="btn btn--ghost" type="button" id="demoBtn" title="Fill with a sample event">
                  Use demo
                </button>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end">
                  <button class="btn btn--ghost" type="button" id="clearBgBtn" title="Remove uploaded background">
                    Clear background
                  </button>
                  <button class="btn btn--ghost" type="button" id="resetBtn" title="Clear all saved settings">
                    Reset
                  </button>
                </div>
              </div>
            </form>

            <div class="divider"></div>

            <div class="row">
              <span class="badge" title="Preview of what will be exported">
                <b>Calendar</b> includes title + location
              </span>
              <span class="badge" title="Tip">
                Press <span class="kbd">Esc</span> to close dialogs
              </span>
            </div>

            <div class="footerhint">
              Tip: drag anywhere on the page to feel the subtle parallax. If motion bothers you, enable “Reduce motion” in your system accessibility settings.
            </div>
          </div>
        </section>

        <section class="card count" aria-label="Countdown display">
          <div class="card__inner">
            <div class="hero">
              <div class="eventline">
                <div class="eventline__title" id="previewTitle">Your Event</div>
                <div class="eventline__meta">
                  <span class="pill" id="previewWhen">
                    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                      <path
                        d="M7 3v2M17 3v2M4.5 8.2h15M6.6 5.2h10.8c1.2 0 2.1 1 2.1 2.2v11.1c0 1.2-.9 2.2-2.1 2.2H6.6c-1.2 0-2.1-1-2.1-2.2V7.4c0-1.2.9-2.2 2.1-2.2Z"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                      />
                    </svg>
                    <span id="previewWhenText">Choose a date &amp; time</span>
                  </span>
                  <span class="pill" id="previewWhere" style="display: none">
                    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                      <path
                        d="M12 21s6-5.2 6-11a6 6 0 1 0-12 0c0 5.8 6 11 6 11Z"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M12 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                        stroke="currentColor"
                        stroke-width="1.6"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                    <span id="previewWhereText">Location</span>
                  </span>
                </div>
              </div>

              <div class="statusline" aria-live="polite">
                <div class="statusline__big" id="statusBig">Set a date to start the countdown.</div>
                <div class="statusline__small" id="statusSmall">—</div>
              </div>

              <div class="countdown" id="countdown" aria-label="Countdown">
                <div class="unit" data-unit="days">
                  <div class="unit__value" id="uDays">00</div>
                  <div class="unit__label">Days</div>
                </div>
                <div class="unit" data-unit="hours">
                  <div class="unit__value" id="uHours">00</div>
                  <div class="unit__label">Hours</div>
                </div>
                <div class="unit" data-unit="minutes">
                  <div class="unit__value" id="uMinutes">00</div>
                  <div class="unit__label">Minutes</div>
                </div>
                <div class="unit" data-unit="seconds">
                  <div class="unit__value" id="uSeconds">00</div>
                  <div class="unit__label">Seconds</div>
                </div>
              </div>

              <div class="actions">
                <button class="btn btn--primary" type="button" id="saveCalBtn">
                  Save to Calendar
                </button>
                <span class="badge" title="Updates live every second">
                  <b>Live</b> auto-refresh
                </span>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <dialog id="calendarDialog" aria-labelledby="calTitle">
      <div class="modal">
        <div class="modal__card">
          <div class="modal__inner">
            <div class="modal__head">
              <div>
                <h3 id="calTitle">Save to Calendar</h3>
                <p id="calSubtitle">Export a 1-hour event at the selected time.</p>
              </div>
              <button class="iconbtn" type="button" id="closeDialogBtn" aria-label="Close">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path
                    d="M6 6l12 12M18 6L6 18"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
            </div>

            <div class="modal__list">
              <div class="modal__item">
                <div>
                  <strong>Download .ics</strong>
                  <span>Works with Apple Calendar, Outlook, Google Calendar import</span>
                </div>
                <div class="modal__actions">
                  <button class="btn btn--primary" type="button" id="downloadIcsBtn">Download</button>
                </div>
              </div>
              <div class="modal__item">
                <div>
                  <strong>Google Calendar</strong>
                  <span>Opens a pre-filled event template</span>
                </div>
                <div class="modal__actions">
                  <a class="btn btn--ghost" id="googleLink" href="#" target="_blank" rel="noreferrer">Open</a>
                </div>
              </div>
            </div>
            <div class="footerhint" style="margin-top: 12px">
              Event: <span class="kbd" id="calPreviewTitle">—</span> • When: <span class="kbd" id="calPreviewWhen">—</span>
            </div>
          </div>
        </div>
      </div>
    </dialog>

    <div class="toast" id="toast" aria-live="polite" aria-atomic="true"></div>

    <script>
      (() => {
        "use strict";

        const STORAGE_KEY = "eventCountdown.v1";
        const MAX_BG_PERSIST_BYTES = 1_500_000; // ~1.5MB safety for localStorage
        const DEFAULT_EVENT_NAME = "Your Event";

        const $ = (sel) => document.querySelector(sel);
        const els = {
          bgImage: $("#bgImage"),
          tzLabel: $("#tzLabel"),
          form: $("#form"),
          eventName: $("#eventName"),
          eventDate: $("#eventDate"),
          eventLocation: $("#eventLocation"),
          bgUpload: $("#bgUpload"),
          dropZone: $("#dropZone"),
          chooseBgBtn: $("#chooseBgBtn"),
          clearBgBtn: $("#clearBgBtn"),
          resetBtn: $("#resetBtn"),
          demoBtn: $("#demoBtn"),

          previewTitle: $("#previewTitle"),
          previewWhen: $("#previewWhen"),
          previewWhenText: $("#previewWhenText"),
          previewWhere: $("#previewWhere"),
          previewWhereText: $("#previewWhereText"),

          statusBig: $("#statusBig"),
          statusSmall: $("#statusSmall"),
          uDays: $("#uDays"),
          uHours: $("#uHours"),
          uMinutes: $("#uMinutes"),
          uSeconds: $("#uSeconds"),
          countdownUnits: Array.from(document.querySelectorAll(".unit")),

          saveCalBtn: $("#saveCalBtn"),
          calendarDialog: $("#calendarDialog"),
          closeDialogBtn: $("#closeDialogBtn"),
          downloadIcsBtn: $("#downloadIcsBtn"),
          googleLink: $("#googleLink"),
          calPreviewTitle: $("#calPreviewTitle"),
          calPreviewWhen: $("#calPreviewWhen"),

          toast: $("#toast"),
        };

        const state = {
          name: "",
          dateTimeLocal: "",
          location: "",
          bgDataUrl: "",
          bgPersisted: false,
        };

        const motionOK = !window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;

        function safeJsonParse(value) {
          try {
            return JSON.parse(value);
          } catch {
            return null;
          }
        }

        function pad2(n) {
          return String(n).padStart(2, "0");
        }

        function clamp(n, min, max) {
          return Math.max(min, Math.min(max, n));
        }

        function formatZone() {
          try {
            const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "Local";
            return tz;
          } catch {
            return "Local";
          }
        }

        function parseDateTimeLocal(value) {
          // Supports "YYYY-MM-DDTHH:mm" or "YYYY-MM-DDTHH:mm:ss"
          if (!value || typeof value !== "string") return null;
          const [d, t] = value.split("T");
          if (!d || !t) return null;
          const [yy, mm, dd] = d.split("-").map((x) => Number(x));
          const parts = t.split(":").map((x) => Number(x));
          const hh = parts[0];
          const min = parts[1];
          const ss = parts[2] ?? 0;
          if ([yy, mm, dd, hh, min, ss].some((n) => !Number.isFinite(n))) return null;
          const dt = new Date(yy, mm - 1, dd, hh, min, ss, 0);
          if (Number.isNaN(dt.getTime())) return null;
          return dt;
        }

        function formatLocalDateTime(dt) {
          if (!dt) return "—";
          try {
            const fmt = new Intl.DateTimeFormat(undefined, {
              weekday: "short",
              year: "numeric",
              month: "short",
              day: "2-digit",
              hour: "numeric",
              minute: "2-digit",
              timeZoneName: "short",
            });
            return fmt.format(dt);
          } catch {
            return dt.toLocaleString();
          }
        }

        function msToParts(ms) {
          const totalSeconds = Math.max(0, Math.floor(ms / 1000));
          const days = Math.floor(totalSeconds / 86400);
          const hours = Math.floor((totalSeconds % 86400) / 3600);
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;
          return { days, hours, minutes, seconds };
        }

        function prettyDelta(ms) {
          const abs = Math.abs(ms);
          const parts = msToParts(abs);
          if (parts.days > 0) return `${parts.days}d ${pad2(parts.hours)}h`;
          if (parts.hours > 0) return `${parts.hours}h ${pad2(parts.minutes)}m`;
          if (parts.minutes > 0) return `${parts.minutes}m ${pad2(parts.seconds)}s`;
          return `${parts.seconds}s`;
        }

        function escapeIcsText(text) {
          return String(text || "")
            .replace(/\\/g, "\\\\")
            .replace(/\n/g, "\\n")
            .replace(/,/g, "\\,")
            .replace(/;/g, "\\;");
        }

        function formatIcsUtc(dt) {
          const y = dt.getUTCFullYear();
          const m = pad2(dt.getUTCMonth() + 1);
          const d = pad2(dt.getUTCDate());
          const hh = pad2(dt.getUTCHours());
          const mm = pad2(dt.getUTCMinutes());
          const ss = pad2(dt.getUTCSeconds());
          return `${y}${m}${d}T${hh}${mm}${ss}Z`;
        }

        function randomUid() {
          try {
            const bytes = new Uint8Array(12);
            crypto.getRandomValues(bytes);
            const hex = Array.from(bytes, (b) => b.toString(16).padStart(2, "0")).join("");
            return `${hex}@event-countdown.local`;
          } catch {
            return `${Math.random().toString(16).slice(2)}@event-countdown.local`;
          }
        }

        function buildIcs({ title, start, end, location }) {
          const now = new Date();
          const lines = [
            "BEGIN:VCALENDAR",
            "VERSION:2.0",
            "PRODID:-//Event Countdown//EN",
            "CALSCALE:GREGORIAN",
            "METHOD:PUBLISH",
            "BEGIN:VEVENT",
            `UID:${randomUid()}`,
            `DTSTAMP:${formatIcsUtc(now)}`,
            `DTSTART:${formatIcsUtc(start)}`,
            `DTEND:${formatIcsUtc(end)}`,
            `SUMMARY:${escapeIcsText(title)}`,
            location ? `LOCATION:${escapeIcsText(location)}` : null,
            `DESCRIPTION:${escapeIcsText("Created with Event Countdown.")}`,
            "END:VEVENT",
            "END:VCALENDAR",
          ].filter(Boolean);

          // RFC5545 recommends CRLF
          return lines.join("\r\n") + "\r\n";
        }

        function buildGoogleCalendarUrl({ title, start, end, location }) {
          const base = "https://calendar.google.com/calendar/render?action=TEMPLATE";
          const dates = `${formatIcsUtc(start)}/${formatIcsUtc(end)}`;
          const params = new URLSearchParams({
            text: title,
            dates,
          });
          if (location) params.set("location", location);
          params.set("details", "Created with Event Countdown.");
          return `${base}&${params.toString()}`;
        }

        function toast(message, level = "info", lifeMs = 2600) {
          const item = document.createElement("div");
          item.className = "toast__item";
          item.style.setProperty("--toast-life", `${lifeMs}ms`);

          const dot = document.createElement("div");
          dot.className = `toast__dot${level === "warn" ? " warn" : level === "danger" ? " danger" : ""}`;
          const msg = document.createElement("div");
          msg.className = "toast__msg";
          msg.textContent = message;

          item.append(dot, msg);
          els.toast.appendChild(item);

          window.setTimeout(() => item.remove(), lifeMs + 400);
        }

        function applyBackground(dataUrl) {
          if (dataUrl) {
            els.bgImage.style.backgroundImage = `url(${dataUrl})`;
          } else {
            els.bgImage.style.backgroundImage =
              "radial-gradient(1200px 900px at 20% 10%, rgba(167, 139, 250, 0.18), transparent 55%)," +
              "radial-gradient(1000px 900px at 85% 25%, rgba(96, 165, 250, 0.14), transparent 58%)," +
              "radial-gradient(900px 700px at 60% 90%, rgba(52, 211, 153, 0.08), transparent 60%)," +
              "linear-gradient(180deg, #070a14, #0b1020)";
          }
        }

        function sanitizeFilename(name) {
          const base = String(name || "event").trim() || "event";
          return base
            .replace(/[\u0000-\u001f\u007f]/g, "")
            .replace(/[\/\\?%*:|"<>]/g, "-")
            .replace(/\s+/g, " ")
            .trim()
            .slice(0, 60);
        }

        function readFileAsDataUrl(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onerror = () => reject(new Error("Failed to read file"));
            reader.onload = () => resolve(String(reader.result || ""));
            reader.readAsDataURL(file);
          });
        }

        let saveTimer = 0;
        function scheduleSave() {
          window.clearTimeout(saveTimer);
          saveTimer = window.setTimeout(() => {
            try {
              const payload = {
                name: state.name,
                dateTimeLocal: state.dateTimeLocal,
                location: state.location,
                bgDataUrl: state.bgPersisted ? state.bgDataUrl : "",
              };
              localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
            } catch {
              // ignore
            }
          }, 220);
        }

        function loadSaved() {
          let raw = null;
          try {
            raw = localStorage.getItem(STORAGE_KEY);
          } catch {
            raw = null;
          }
          const parsed = safeJsonParse(raw);
          if (!parsed || typeof parsed !== "object") return;
          state.name = typeof parsed.name === "string" ? parsed.name : "";
          state.dateTimeLocal = typeof parsed.dateTimeLocal === "string" ? parsed.dateTimeLocal : "";
          state.location = typeof parsed.location === "string" ? parsed.location : "";
          state.bgDataUrl = typeof parsed.bgDataUrl === "string" ? parsed.bgDataUrl : "";
          state.bgPersisted = Boolean(state.bgDataUrl);
        }

        function syncInputsFromState() {
          els.eventName.value = state.name;
          els.eventDate.value = state.dateTimeLocal;
          els.eventLocation.value = state.location;
        }

        function syncPreview() {
          const title = state.name.trim() || DEFAULT_EVENT_NAME;
          els.previewTitle.textContent = title;

          const dt = parseDateTimeLocal(state.dateTimeLocal);
          if (dt) {
            els.previewWhenText.textContent = formatLocalDateTime(dt);
          } else {
            els.previewWhenText.textContent = "Choose a date & time";
          }

          const loc = state.location.trim();
          if (loc) {
            els.previewWhere.style.display = "";
            els.previewWhereText.textContent = loc;
          } else {
            els.previewWhere.style.display = "none";
          }

          applyBackground(state.bgDataUrl);
        }

        const lastRendered = { days: null, hours: null, minutes: null, seconds: null };
        function setUnit(unit, value) {
          const idMap = { days: els.uDays, hours: els.uHours, minutes: els.uMinutes, seconds: els.uSeconds };
          const el = idMap[unit];
          const unitCard = els.countdownUnits.find((x) => x.dataset.unit === unit);
          const rendered = unit === "days" ? String(value) : pad2(value);
          const prev = lastRendered[unit];
          if (rendered !== prev) {
            el.textContent = rendered;
            lastRendered[unit] = rendered;
            if (motionOK && unitCard) {
              unitCard.classList.remove("is-ticking");
              // Force reflow
              void unitCard.offsetWidth;
              unitCard.classList.add("is-ticking");
              window.setTimeout(() => unitCard.classList.remove("is-ticking"), 560);
            }
          }
        }

        function setStatus(dt, diffMs) {
          if (!dt) {
            els.statusBig.textContent = "Set a date to start the countdown.";
            els.statusSmall.textContent = "Your countdown updates live as you type.";
            return;
          }

          if (diffMs > 0) {
            const soon = diffMs < 60 * 60 * 1000;
            els.statusBig.textContent = soon ? "Almost time." : "Counting down.";
            els.statusSmall.textContent = `Starts in ${prettyDelta(diffMs)} • ${formatLocalDateTime(dt)}`;
          } else {
            const since = -diffMs;
            els.statusBig.textContent = since < 90 * 1000 ? "Happening now." : "Started.";
            els.statusSmall.textContent = `Started ${prettyDelta(since)} ago • ${formatLocalDateTime(dt)}`;
          }
        }

        let timer = 0;
        function startTicker() {
          window.clearTimeout(timer);
          const tick = () => {
            const dt = parseDateTimeLocal(state.dateTimeLocal);
            if (!dt) {
              setUnit("days", 0);
              setUnit("hours", 0);
              setUnit("minutes", 0);
              setUnit("seconds", 0);
              setStatus(null, 0);
              timer = window.setTimeout(tick, 600);
              return;
            }

            const now = new Date();
            const diff = dt.getTime() - now.getTime();
            const parts = msToParts(diff);
            setUnit("days", parts.days);
            setUnit("hours", parts.hours);
            setUnit("minutes", parts.minutes);
            setUnit("seconds", parts.seconds);
            setStatus(dt, diff);

            const next = 1000 - (now.getTime() % 1000) + 5;
            timer = window.setTimeout(tick, clamp(next, 120, 1100));
          };
          tick();
        }

        function openCalendarDialog() {
          const dt = parseDateTimeLocal(state.dateTimeLocal);
          if (!dt) {
            toast("Pick a date & time first.", "warn");
            els.eventDate.focus();
            return;
          }
          const title = state.name.trim() || "Event";
          const start = dt;
          const end = new Date(start.getTime() + 60 * 60 * 1000);
          const loc = state.location.trim();

          els.calPreviewTitle.textContent = title;
          els.calPreviewWhen.textContent = formatLocalDateTime(start);
          els.googleLink.href = buildGoogleCalendarUrl({ title, start, end, location: loc });

          try {
            if (typeof els.calendarDialog.showModal === "function") {
              els.calendarDialog.showModal();
            } else {
              els.calendarDialog.setAttribute("open", "");
            }
            els.downloadIcsBtn.focus();
          } catch {
            // fallback: download directly
            downloadIcs();
          }
        }

        function closeCalendarDialog() {
          try {
            els.calendarDialog.close();
          } catch {
            els.calendarDialog.removeAttribute("open");
          }
        }

        function downloadIcs() {
          const dt = parseDateTimeLocal(state.dateTimeLocal);
          if (!dt) {
            toast("Pick a date & time first.", "warn");
            return;
          }
          const title = state.name.trim() || "Event";
          const location = state.location.trim();
          const start = dt;
          const end = new Date(start.getTime() + 60 * 60 * 1000);

          const ics = buildIcs({ title, start, end, location });
          const blob = new Blob([ics], { type: "text/calendar;charset=utf-8" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `${sanitizeFilename(title)}.ics`;
          document.body.appendChild(a);
          a.click();
          a.remove();
          window.setTimeout(() => URL.revokeObjectURL(url), 1500);
          toast("Downloaded calendar file (.ics).", "info");
        }

        function setDemo() {
          const now = new Date();
          const demo = new Date(now.getTime() + 3 * 24 * 60 * 60 * 1000 + 5 * 60 * 60 * 1000 + 12 * 60 * 1000);
          const yyyy = demo.getFullYear();
          const mm = pad2(demo.getMonth() + 1);
          const dd = pad2(demo.getDate());
          const hh = pad2(demo.getHours());
          const min = pad2(demo.getMinutes());
          state.name = "Studio Night Market";
          state.location = "Rooftop Atrium";
          state.dateTimeLocal = `${yyyy}-${mm}-${dd}T${hh}:${min}`;
          syncInputsFromState();
          syncPreview();
          scheduleSave();
          toast("Loaded a demo event.", "info");
        }

        function resetAll() {
          state.name = "";
          state.dateTimeLocal = "";
          state.location = "";
          state.bgDataUrl = "";
          state.bgPersisted = false;
          syncInputsFromState();
          syncPreview();
          try {
            localStorage.removeItem(STORAGE_KEY);
          } catch {
            // ignore
          }
          toast("Reset complete.", "info");
        }

        async function handleBgFile(file) {
          if (!file) return;
          if (!file.type || !file.type.startsWith("image/")) {
            toast("Please choose an image file.", "warn");
            return;
          }

          if (file.size > 8_000_000) {
            toast("That image is large. Try a smaller one for smoother performance.", "warn", 3400);
          }

          try {
            const dataUrl = await readFileAsDataUrl(file);
            state.bgDataUrl = dataUrl;
            state.bgPersisted = dataUrl.length < MAX_BG_PERSIST_BYTES;
            applyBackground(state.bgDataUrl);
            scheduleSave();
            if (!state.bgPersisted) {
              toast("Background applied (not persisted — image is large).", "warn", 3600);
            } else {
              toast("Background applied.", "info");
            }
          } catch {
            toast("Couldn't load that image.", "danger");
          }
        }

        function clearBackground() {
          state.bgDataUrl = "";
          state.bgPersisted = false;
          applyBackground("");
          scheduleSave();
          toast("Background cleared.", "info");
        }

        function wireForm() {
          els.form.addEventListener("submit", (e) => e.preventDefault());
          els.eventName.addEventListener("input", () => {
            state.name = els.eventName.value;
            syncPreview();
            scheduleSave();
          });
          els.eventDate.addEventListener("input", () => {
            state.dateTimeLocal = els.eventDate.value;
            syncPreview();
            scheduleSave();
          });
          els.eventLocation.addEventListener("input", () => {
            state.location = els.eventLocation.value;
            syncPreview();
            scheduleSave();
          });

          els.bgUpload.addEventListener("change", async () => {
            const file = els.bgUpload.files?.[0];
            await handleBgFile(file);
            els.bgUpload.value = "";
          });

          els.chooseBgBtn.addEventListener("click", () => els.bgUpload.click());
          els.clearBgBtn.addEventListener("click", clearBackground);
          els.resetBtn.addEventListener("click", resetAll);
          els.demoBtn.addEventListener("click", setDemo);
        }

        function wireDropZone() {
          const prevent = (e) => {
            e.preventDefault();
            e.stopPropagation();
          };
          ["dragenter", "dragover", "dragleave", "drop"].forEach((evt) => {
            els.dropZone.addEventListener(evt, prevent);
          });

          els.dropZone.addEventListener("dragover", () => {
            els.dropZone.style.borderColor = "rgba(167, 139, 250, 0.55)";
          });
          els.dropZone.addEventListener("dragleave", () => {
            els.dropZone.style.borderColor = "";
          });
          els.dropZone.addEventListener("drop", async (e) => {
            els.dropZone.style.borderColor = "";
            const file = e.dataTransfer?.files?.[0];
            await handleBgFile(file);
          });

          els.dropZone.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              els.bgUpload.click();
            }
          });
        }

        function wireCalendar() {
          els.saveCalBtn.addEventListener("click", openCalendarDialog);
          els.downloadIcsBtn.addEventListener("click", () => {
            downloadIcs();
          });
          els.closeDialogBtn.addEventListener("click", closeCalendarDialog);
          els.calendarDialog.addEventListener("click", (e) => {
            const rect = e.currentTarget.getBoundingClientRect?.();
            // Click outside the dialog card closes
            if (e.target === els.calendarDialog && rect) closeCalendarDialog();
          });
          window.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && els.calendarDialog.open) closeCalendarDialog();
          });
        }

        function wireParallax() {
          if (!motionOK) return;
          let targetX = 0;
          let targetY = 0;
          let curX = 0;
          let curY = 0;
          const strength = 22; // px

          const setTarget = (clientX, clientY) => {
            const w = window.innerWidth || 1;
            const h = window.innerHeight || 1;
            const nx = (clientX / w - 0.5) * 2;
            const ny = (clientY / h - 0.5) * 2;
            targetX = nx * strength;
            targetY = ny * strength;
          };

          window.addEventListener(
            "mousemove",
            (e) => {
              setTarget(e.clientX, e.clientY);
            },
            { passive: true }
          );
          window.addEventListener(
            "touchmove",
            (e) => {
              const t = e.touches && e.touches[0];
              if (t) setTarget(t.clientX, t.clientY);
            },
            { passive: true }
          );

          const raf = () => {
            curX += (targetX - curX) * 0.06;
            curY += (targetY - curY) * 0.06;
            els.bgImage.style.setProperty("--px", `${curX}px`);
            els.bgImage.style.setProperty("--py", `${curY}px`);
            window.requestAnimationFrame(raf);
          };
          window.requestAnimationFrame(raf);
        }

        function init() {
          els.tzLabel.textContent = formatZone();
          loadSaved();
          syncInputsFromState();
          syncPreview();
          wireForm();
          wireDropZone();
          wireCalendar();
          wireParallax();
          startTicker();
          toast("Ready. Set an event to begin.", "info", 2200);
        }

        init();
      })();
    </script>
  </body>
</html>
