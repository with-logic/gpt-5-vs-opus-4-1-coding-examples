<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="dark light" />
    <meta name="theme-color" content="#0b1220" />
    <title>USA Basics Trivia Quiz</title>
    <style>
      :root {
        --bg0: #070a12;
        --bg1: #0b1220;
        --card: rgba(255, 255, 255, 0.08);
        --card2: rgba(255, 255, 255, 0.06);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.7);
        --muted2: rgba(255, 255, 255, 0.55);
        --line: rgba(255, 255, 255, 0.14);
        --shadow: rgba(0, 0, 0, 0.35);
        --accent: #60a5fa;
        --accent2: #a78bfa;
        --good: #22c55e;
        --bad: #ef4444;
        --warn: #f59e0b;
        --focus: rgba(96, 165, 250, 0.7);
        --radius: 18px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
          "Segoe UI Emoji";
        color: var(--text);
        background: radial-gradient(1200px 700px at 15% 10%, rgba(96, 165, 250, 0.24), transparent 55%),
          radial-gradient(900px 650px at 85% 20%, rgba(167, 139, 250, 0.22), transparent 55%),
          radial-gradient(1100px 700px at 50% 100%, rgba(34, 197, 94, 0.14), transparent 60%),
          linear-gradient(180deg, var(--bg0), var(--bg1));
        overflow-x: hidden;
      }

      a {
        color: inherit;
      }

      .sr-only {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        padding: 0 !important;
        margin: -1px !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        white-space: nowrap !important;
        border: 0 !important;
      }

      .wrap {
        min-height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      header {
        width: min(980px, calc(100% - 28px));
        padding: 18px 0 10px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .brand {
        display: flex;
        flex-direction: column;
        gap: 2px;
        line-height: 1.1;
      }
      .brand h1 {
        margin: 0;
        font-size: clamp(18px, 2.1vw, 22px);
        letter-spacing: -0.02em;
      }
      .brand p {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
      }

      .actions {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 10px;
        flex-wrap: wrap;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 16px 40px var(--shadow);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        user-select: none;
      }

      .pill strong {
        font-size: 13px;
      }
      .pill span {
        font-size: 12px;
        color: var(--muted);
      }

      .btn {
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.06));
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        font-weight: 650;
        letter-spacing: -0.01em;
        box-shadow: 0 16px 40px var(--shadow);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: transform 140ms ease, border-color 140ms ease, background 140ms ease, opacity 140ms ease;
      }
      .btn:hover {
        transform: translateY(-1px);
        border-color: rgba(255, 255, 255, 0.22);
      }
      .btn:active {
        transform: translateY(0px);
      }
      .btn:focus-visible {
        outline: 3px solid var(--focus);
        outline-offset: 2px;
      }
      .btn.secondary {
        font-weight: 600;
        opacity: 0.92;
      }
      .btn.primary {
        border-color: rgba(96, 165, 250, 0.5);
        background: linear-gradient(180deg, rgba(96, 165, 250, 0.22), rgba(96, 165, 250, 0.08));
      }
      .btn.ghost {
        background: rgba(255, 255, 255, 0.06);
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .progress-wrap {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .progress {
        position: relative;
        flex: 1;
        height: 12px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        overflow: hidden;
      }

      .progress > .bar {
        height: 100%;
        width: 0%;
        border-radius: 999px;
        background: linear-gradient(90deg, rgba(96, 165, 250, 0.9), rgba(167, 139, 250, 0.95), rgba(34, 197, 94, 0.9));
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.08) inset, 0 12px 32px rgba(96, 165, 250, 0.25);
        transition: width 520ms cubic-bezier(0.2, 0.8, 0.2, 1);
      }

      .progress-meta {
        min-width: 150px;
        text-align: right;
        color: var(--muted);
        font-size: 12px;
      }

      main {
        width: min(980px, calc(100% - 28px));
        flex: 1;
        display: grid;
        place-items: center;
        padding: 14px 0 28px;
      }

      .card {
        width: 100%;
        border-radius: var(--radius);
        background: linear-gradient(180deg, var(--card), var(--card2));
        border: 1px solid rgba(255, 255, 255, 0.14);
        box-shadow: 0 30px 80px var(--shadow);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        overflow: hidden;
        position: relative;
      }

      .card::before {
        content: "";
        position: absolute;
        inset: -1px;
        background: radial-gradient(700px 300px at 20% 0%, rgba(96, 165, 250, 0.18), transparent 55%),
          radial-gradient(800px 320px at 85% 20%, rgba(167, 139, 250, 0.16), transparent 55%);
        pointer-events: none;
      }

      .card-inner {
        position: relative;
        padding: clamp(18px, 2.3vw, 28px);
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .tagrow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 7px 10px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: var(--muted);
        font-size: 12px;
      }

      .kbd {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.14);
        border-bottom-color: rgba(255, 255, 255, 0.24);
        padding: 2px 6px;
        border-radius: 8px;
        color: rgba(255, 255, 255, 0.88);
        font-size: 11px;
      }

      .q {
        margin: 6px 0 0;
        font-size: clamp(20px, 3.2vw, 32px);
        line-height: 1.16;
        letter-spacing: -0.03em;
        text-wrap: balance;
      }

      .sub {
        margin: 0;
        color: var(--muted);
        font-size: 14px;
        line-height: 1.4;
      }

      .answers {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
        margin-top: 6px;
      }

      @media (min-width: 760px) {
        .answers {
          grid-template-columns: 1fr 1fr;
        }
      }

      .choice {
        cursor: pointer;
        text-align: left;
        width: 100%;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 14px 14px;
        transition: transform 140ms ease, border-color 140ms ease, background 140ms ease;
        display: flex;
        align-items: flex-start;
        gap: 12px;
        position: relative;
        overflow: hidden;
        min-height: 58px;
      }
      .choice:hover {
        transform: translateY(-1px);
        border-color: rgba(255, 255, 255, 0.22);
        background: rgba(255, 255, 255, 0.075);
      }
      .choice:active {
        transform: translateY(0px);
      }
      .choice:focus-visible {
        outline: 3px solid var(--focus);
        outline-offset: 2px;
      }

      .badge {
        width: 34px;
        height: 34px;
        flex: 0 0 34px;
        border-radius: 12px;
        display: grid;
        place-items: center;
        background: rgba(96, 165, 250, 0.18);
        border: 1px solid rgba(96, 165, 250, 0.28);
        color: rgba(255, 255, 255, 0.92);
        font-weight: 800;
      }

      .choice .text {
        font-size: 16px;
        line-height: 1.3;
        letter-spacing: -0.01em;
      }

      .choice.correct {
        border-color: rgba(34, 197, 94, 0.5);
        background: rgba(34, 197, 94, 0.12);
      }

      .choice.wrong {
        border-color: rgba(239, 68, 68, 0.5);
        background: rgba(239, 68, 68, 0.11);
        animation: shake 420ms ease-in-out;
      }

      @keyframes shake {
        0% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-3px);
        }
        50% {
          transform: translateX(3px);
        }
        75% {
          transform: translateX(-2px);
        }
        100% {
          transform: translateX(0);
        }
      }

      .choice.disabled {
        cursor: default;
        opacity: 0.9;
      }
      .choice.disabled:hover {
        transform: none;
      }

      .feedback {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-top: 8px;
        padding-top: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.12);
        min-height: 40px;
      }

      .feedback .msg {
        color: var(--muted);
        font-size: 14px;
        line-height: 1.35;
      }

      .feedback .msg strong {
        color: rgba(255, 255, 255, 0.92);
      }

      .right-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .iconBurst {
        width: 38px;
        height: 38px;
        border-radius: 14px;
        display: grid;
        place-items: center;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        position: relative;
        overflow: hidden;
      }

      .iconBurst svg {
        width: 22px;
        height: 22px;
        opacity: 0;
        transform: scale(0.7);
      }

      .iconBurst.on svg {
        opacity: 1;
        transform: scale(1);
        transition: opacity 220ms ease, transform 220ms cubic-bezier(0.2, 0.9, 0.2, 1);
      }

      .iconBurst.good {
        border-color: rgba(34, 197, 94, 0.5);
        background: rgba(34, 197, 94, 0.13);
      }

      .iconBurst.bad {
        border-color: rgba(239, 68, 68, 0.5);
        background: rgba(239, 68, 68, 0.12);
      }

      .spark {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }
      .spark::before,
      .spark::after {
        content: "";
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.4);
      }
      .iconBurst.on .spark::before {
        top: 16%;
        left: 18%;
        opacity: 1;
        background: rgba(255, 255, 255, 0.85);
        animation: pop 420ms ease-out forwards;
      }
      .iconBurst.on .spark::after {
        top: 82%;
        left: 76%;
        opacity: 1;
        background: rgba(255, 255, 255, 0.7);
        animation: pop 420ms 60ms ease-out forwards;
      }

      @keyframes pop {
        0% {
          transform: translate(-50%, -50%) scale(0.4);
          opacity: 0;
        }
        35% {
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(1.15);
          opacity: 0;
        }
      }

      .modal {
        position: fixed;
        inset: 0;
        display: none;
        z-index: 50;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        padding: 16px;
      }
      .modal.open {
        display: grid;
        place-items: center;
        animation: fadeIn 180ms ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .modal-panel {
        width: min(760px, 100%);
        border-radius: 18px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.06));
        border: 1px solid rgba(255, 255, 255, 0.16);
        box-shadow: 0 40px 120px rgba(0, 0, 0, 0.6);
        overflow: hidden;
      }
      .modal-head {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.12);
      }
      .modal-head h2 {
        margin: 0;
        font-size: 16px;
        letter-spacing: -0.02em;
      }
      .modal-body {
        padding: 16px;
        display: grid;
        gap: 12px;
      }
      .grid2 {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }
      @media (min-width: 740px) {
        .grid2 {
          grid-template-columns: 1fr 1fr;
        }
      }
      label {
        display: grid;
        gap: 6px;
        color: var(--muted);
        font-size: 12px;
      }
      input[type="text"],
      textarea,
      select {
        width: 100%;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(0, 0, 0, 0.25);
        color: var(--text);
        padding: 10px 12px;
        outline: none;
      }
      textarea {
        resize: vertical;
        min-height: 92px;
      }
      input[type="text"]:focus,
      textarea:focus,
      select:focus {
        outline: 3px solid var(--focus);
        outline-offset: 2px;
      }
      .help {
        color: var(--muted2);
        font-size: 12px;
        line-height: 1.35;
      }
      .toast {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(0, 0, 0, 0.45);
        box-shadow: 0 20px 70px rgba(0, 0, 0, 0.6);
        color: rgba(255, 255, 255, 0.9);
        display: none;
        z-index: 80;
        max-width: min(720px, calc(100% - 26px));
      }
      .toast.show {
        display: inline-flex;
        animation: toastIn 220ms ease;
      }
      @keyframes toastIn {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }

      .scoreGrid {
        display: grid;
        gap: 14px;
      }
      .scoreRow {
        display: flex;
        gap: 14px;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      .meter {
        --p: 0;
        width: 92px;
        height: 92px;
        border-radius: 50%;
        background: conic-gradient(
          rgba(34, 197, 94, 0.92) calc(var(--p) * 1%),
          rgba(255, 255, 255, 0.12) 0
        );
        display: grid;
        place-items: center;
        border: 1px solid rgba(255, 255, 255, 0.14);
        box-shadow: 0 18px 60px rgba(0, 0, 0, 0.45);
      }
      .meter > div {
        width: 72px;
        height: 72px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.25);
        border: 1px solid rgba(255, 255, 255, 0.14);
        display: grid;
        place-items: center;
        text-align: center;
      }
      .meter .big {
        font-size: 18px;
        font-weight: 900;
        letter-spacing: -0.03em;
        line-height: 1.05;
      }
      .meter .small {
        font-size: 11px;
        color: var(--muted);
        margin-top: 2px;
      }
      .review {
        margin-top: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.12);
        padding-top: 10px;
        display: grid;
        gap: 10px;
      }
      details {
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.05);
        overflow: hidden;
      }
      summary {
        cursor: pointer;
        padding: 12px 14px;
        color: rgba(255, 255, 255, 0.9);
        font-weight: 750;
        letter-spacing: -0.02em;
        list-style: none;
      }
      summary::-webkit-details-marker {
        display: none;
      }
      .reviewItem {
        padding: 0 14px 12px;
        color: var(--muted);
        font-size: 13px;
        display: grid;
        gap: 8px;
      }
      .pill2 {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(0, 0, 0, 0.22);
        width: fit-content;
      }
      .pill2.good {
        border-color: rgba(34, 197, 94, 0.4);
      }
      .pill2.bad {
        border-color: rgba(239, 68, 68, 0.4);
      }

      .footerHint {
        width: min(980px, calc(100% - 28px));
        padding: 0 0 18px;
        color: rgba(255, 255, 255, 0.48);
        font-size: 12px;
        display: flex;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.001ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.001ms !important;
          scroll-behavior: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="topbar">
          <div class="brand" aria-label="Quiz title">
            <h1>USA Basics Trivia</h1>
            <p>10 quick civics questions • pick an answer • get instant feedback</p>
          </div>
          <div class="actions">
            <div class="pill" aria-live="polite" aria-atomic="true">
              <strong id="scoreMini">Score: 0</strong>
              <span id="streakMini">Streak: 0</span>
            </div>
            <button class="btn ghost" id="soundBtn" type="button" aria-pressed="true" title="Toggle sound">
              Sound: On
            </button>
            <button class="btn secondary" id="customBtn" type="button" title="Add your own question">
              Add Question
            </button>
          </div>
        </div>

        <div class="progress-wrap" aria-label="Progress">
          <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="10" aria-valuenow="0">
            <div class="bar" id="progressBar"></div>
          </div>
          <div class="progress-meta" id="progressText">Ready • 0 / 10</div>
        </div>
      </header>

      <main>
        <section class="card" aria-label="Quiz card">
          <div class="card-inner">
            <div class="tagrow">
              <div class="tag" id="tagLeft">
                <span>Tip:</span>
                <span class="kbd">1–4</span>
                <span>to answer</span>
              </div>
              <div class="tag" id="tagRight">Basic civics • randomized</div>
            </div>

            <h2 class="q" id="question">Welcome!</h2>
            <p class="sub" id="subtitle">
              Test your everyday U.S. civics knowledge. You’ll see one question at a time, and get instant feedback.
            </p>

            <div class="answers" id="answers" role="group" aria-label="Answer choices"></div>

            <div class="feedback" aria-live="polite" aria-atomic="true">
              <div class="msg" id="feedbackMsg">
                Press <span class="kbd">Start</span> when you’re ready.
              </div>
              <div class="right-controls">
                <div class="iconBurst" id="iconBurst" aria-hidden="true">
                  <span class="spark"></span>
                  <svg id="iconSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path
                      id="iconPath"
                      d=""
                      stroke="currentColor"
                      stroke-width="2.8"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
                <button class="btn primary" id="primaryBtn" type="button">Start</button>
              </div>
            </div>
          </div>
        </section>
      </main>

      <div class="footerHint">
        <span>Accessibility: Tab to choices, Enter to select. Motion respects system settings.</span>
        <span id="storageHint">Custom questions save locally in this browser.</span>
      </div>
    </div>

    <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-panel">
        <div class="modal-head">
          <h2 id="modalTitle">Add a custom question</h2>
          <button class="btn ghost" id="closeModal" type="button" aria-label="Close">Close</button>
        </div>
        <form class="modal-body" id="customForm">
          <label>
            Question
            <textarea id="cq" placeholder="Example: How many states are in the United States?" required></textarea>
          </label>
          <div class="grid2" aria-label="Answer options">
            <label>
              Choice A
              <input id="c1" type="text" placeholder="Option 1" required />
            </label>
            <label>
              Choice B
              <input id="c2" type="text" placeholder="Option 2" required />
            </label>
            <label>
              Choice C
              <input id="c3" type="text" placeholder="Option 3" required />
            </label>
            <label>
              Choice D
              <input id="c4" type="text" placeholder="Option 4" required />
            </label>
          </div>
          <label>
            Correct answer
            <select id="correctSelect" required>
              <option value="0">Choice A</option>
              <option value="1">Choice B</option>
              <option value="2">Choice C</option>
              <option value="3">Choice D</option>
            </select>
          </label>
          <div class="help">
            This is optional. The quiz always includes the built-in 10 civics questions, shown in random order.
          </div>
          <div class="right-controls">
            <button class="btn secondary" id="clearCustom" type="button">Clear Saved</button>
            <button class="btn primary" type="submit">Save Question</button>
          </div>
        </form>
      </div>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <script>
      (() => {
        "use strict";

        const $ = (sel, root = document) => root.querySelector(sel);
        const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

        const el = {
          scoreMini: $("#scoreMini"),
          streakMini: $("#streakMini"),
          soundBtn: $("#soundBtn"),
          customBtn: $("#customBtn"),
          question: $("#question"),
          subtitle: $("#subtitle"),
          answers: $("#answers"),
          feedbackMsg: $("#feedbackMsg"),
          primaryBtn: $("#primaryBtn"),
          progressBar: $("#progressBar"),
          progressText: $("#progressText"),
          progressWrap: $(".progress"),
          iconBurst: $("#iconBurst"),
          iconSvg: $("#iconSvg"),
          iconPath: $("#iconPath"),
          tagLeft: $("#tagLeft"),
          tagRight: $("#tagRight"),
          rightControls: $(".right-controls"),
          modal: $("#modal"),
          closeModal: $("#closeModal"),
          customForm: $("#customForm"),
          clearCustom: $("#clearCustom"),
          toast: $("#toast"),
          storageHint: $("#storageHint"),
          cq: $("#cq"),
          c1: $("#c1"),
          c2: $("#c2"),
          c3: $("#c3"),
          c4: $("#c4"),
          correctSelect: $("#correctSelect"),
        };

        const BUILTIN = [
          {
            question: "What is the supreme law of the land?",
            choices: ["The Constitution", "The Bill of Rights", "The Declaration of Independence", "A presidential order"],
            correctIndex: 0,
          },
          {
            question: "How many U.S. Senators are there?",
            choices: ["50", "100", "435", "9"],
            correctIndex: 1,
          },
          {
            question: "What is the capital of the United States?",
            choices: ["New York City", "Philadelphia", "Washington, D.C.", "Boston"],
            correctIndex: 2,
          },
          {
            question: "Which branch of government makes federal laws?",
            choices: ["Legislative (Congress)", "Executive (President)", "Judicial (Courts)", "State governments"],
            correctIndex: 0,
          },
          {
            question: "What do we call the first ten amendments to the Constitution?",
            choices: ["The Articles of Confederation", "The Bill of Rights", "The Preamble", "The Federalist Papers"],
            correctIndex: 1,
          },
          {
            question: "Who signs bills to become laws?",
            choices: ["The Speaker of the House", "The President", "The Supreme Court", "The Vice President"],
            correctIndex: 1,
          },
          {
            question: "In what month do we vote for President (in a general election)?",
            choices: ["March", "July", "November", "January"],
            correctIndex: 2,
          },
          {
            question: "Which is one right protected by the First Amendment?",
            choices: ["Freedom of speech", "Right to a jury trial", "Right to bear arms", "No quartering of soldiers"],
            correctIndex: 0,
          },
          {
            question: "When was the Declaration of Independence adopted?",
            choices: ["July 4, 1776", "December 15, 1791", "April 19, 1775", "November 11, 1918"],
            correctIndex: 0,
          },
          {
            question: "How many stars are on the U.S. flag?",
            choices: ["13", "48", "50", "52"],
            correctIndex: 2,
          },
        ];

        const STORAGE_KEY = "usa-trivia.customQuestions.v1";

        function safeParse(json) {
          try {
            return JSON.parse(json);
          } catch {
            return null;
          }
        }

        function loadCustom() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            const parsed = safeParse(raw);
            if (!Array.isArray(parsed)) return [];
            return parsed
              .map((q) => {
                if (!q || typeof q !== "object") return null;
                if (typeof q.question !== "string") return null;
                if (!Array.isArray(q.choices) || q.choices.length !== 4) return null;
                if (!Number.isInteger(q.correctIndex) || q.correctIndex < 0 || q.correctIndex > 3) return null;
                const question = q.question.trim();
                const choices = q.choices.map((c) => String(c).trim()).filter(Boolean);
                if (!question || choices.length !== 4) return null;
                return { question, choices, correctIndex: q.correctIndex };
              })
              .filter(Boolean);
          } catch {
            return [];
          }
        }

        function saveCustom(questions) {
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(questions));
          } catch {
            // Ignore storage failures (e.g., private mode / blocked storage).
          }
        }

        function toast(msg, ms = 1800) {
          el.toast.textContent = msg;
          el.toast.classList.add("show");
          window.clearTimeout(toast._t);
          toast._t = window.setTimeout(() => el.toast.classList.remove("show"), ms);
        }

        function shuffleInPlace(arr) {
          for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
          }
          return arr;
        }

        function uid() {
          return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
        }

        function deriveBuiltinRound() {
          const round = BUILTIN.map((q) => ({ ...q, _source: "built-in", _id: uid() }));
          shuffleInPlace(round);
          return round;
        }

        function randomizeChoices(question) {
          const zipped = question.choices.map((text, idx) => ({ text, idx }));
          shuffleInPlace(zipped);
          const choices = zipped.map((z) => z.text);
          const correctIndex = zipped.findIndex((z) => z.idx === question.correctIndex);
          return { ...question, choices, correctIndex };
        }

        const audio = (() => {
          let ctx = null;
          let enabled = true;
          const state = { enabled };

          function ensure() {
            if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
            return ctx;
          }

          function beep({ freq = 440, dur = 0.08, type = "sine", gain = 0.03 } = {}) {
            if (!state.enabled) return;
            try {
              const c = ensure();
              const osc = c.createOscillator();
              const g = c.createGain();
              osc.type = type;
              osc.frequency.value = freq;
              g.gain.value = gain;
              osc.connect(g);
              g.connect(c.destination);
              const t = c.currentTime;
              osc.start(t);
              osc.stop(t + dur);
            } catch {
              // Ignore audio errors.
            }
          }

          function ok() {
            beep({ freq: 740, type: "triangle", dur: 0.07, gain: 0.028 });
            beep({ freq: 880, type: "triangle", dur: 0.08, gain: 0.028 });
          }

          function nope() {
            beep({ freq: 220, type: "sawtooth", dur: 0.09, gain: 0.022 });
            beep({ freq: 180, type: "sawtooth", dur: 0.08, gain: 0.02 });
          }

          function finish() {
            beep({ freq: 523.25, type: "sine", dur: 0.07, gain: 0.03 });
            beep({ freq: 659.25, type: "sine", dur: 0.08, gain: 0.03 });
            beep({ freq: 783.99, type: "sine", dur: 0.09, gain: 0.03 });
          }

          function toggle() {
            state.enabled = !state.enabled;
            return state.enabled;
          }

          return { ok, nope, finish, toggle, get enabled() { return state.enabled; } };
        })();

        const state = {
          phase: "intro", // intro | question | result | done
          round: [],
          current: 0,
          score: 0,
          streak: 0,
          locked: false,
          lastChoiceIndex: null,
          history: [],
        };

        function setIcon(kind) {
          el.iconBurst.classList.remove("good", "bad", "on");
          el.iconPath.setAttribute("d", "");
          if (!kind) return;
          if (kind === "good") {
            el.iconBurst.classList.add("good", "on");
            el.iconPath.setAttribute("d", "M20 7L10 17l-5-5");
          } else {
            el.iconBurst.classList.add("bad", "on");
            el.iconPath.setAttribute("d", "M7 7l10 10M17 7L7 17");
          }
        }

        function updateTop() {
          el.scoreMini.textContent = `Score: ${state.score}`;
          el.streakMini.textContent = `Streak: ${state.streak}`;

          const total = state.round.length || BUILTIN.length;
          const answered =
            state.phase === "intro" ? 0 : state.phase === "done" ? total : state.locked ? Math.min(state.current + 1, total) : state.current;
          const pct = total === 0 ? 0 : Math.round((answered / total) * 100);
          el.progressBar.style.width = `${pct}%`;
          el.progressWrap.setAttribute("aria-valuemax", String(total));
          el.progressWrap.setAttribute("aria-valuenow", String(answered));

          if (state.phase === "intro") {
            el.progressText.textContent = `Ready • 0 / ${total}`;
          } else if (state.phase === "done") {
            el.progressText.textContent = `Complete • ${total} / ${total}`;
          } else {
            el.progressText.textContent = `Question ${state.current + 1} of ${total} • ${answered} / ${total}`;
          }
        }

        function clearAnswers() {
          el.answers.innerHTML = "";
        }

        function renderIntro() {
          state.phase = "intro";
          state.locked = false;
          setIcon(null);
          clearAnswers();
          el.question.textContent = "Welcome!";
          el.subtitle.textContent =
            "Test your everyday U.S. civics knowledge. You’ll see one question at a time, and get instant feedback.";
          el.feedbackMsg.innerHTML = `Press <span class="kbd">Start</span> when you’re ready.`;
          el.primaryBtn.textContent = "Start";
          el.primaryBtn.disabled = false;
          el.tagLeft.innerHTML = `<span>Tip:</span> <span class="kbd">1–4</span> <span>to answer</span>`;
          el.tagRight.textContent = "Basic civics • randomized";
          removeShareButton();
          updateTop();
        }

        function renderQuestion() {
          state.phase = "question";
          state.locked = false;
          state.lastChoiceIndex = null;
          setIcon(null);
          clearAnswers();

          const q = state.round[state.current];
          el.question.textContent = q.question;
          el.subtitle.textContent = q._source === "custom" ? "Custom question (saved locally)." : "Built-in civics question.";
          el.feedbackMsg.textContent = "Choose the best answer.";
          el.primaryBtn.textContent = "Next";
          el.primaryBtn.disabled = true;
          el.tagRight.textContent = `Question ${state.current + 1} of ${state.round.length}`;
          el.tagLeft.innerHTML = `<span>Keys:</span> <span class="kbd">1</span><span class="kbd">2</span><span class="kbd">3</span><span class="kbd">4</span>`;
          removeShareButton();

          q.choices.forEach((choiceText, idx) => {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "choice";
            btn.dataset.index = String(idx);
            btn.setAttribute("aria-label", `Choice ${idx + 1}: ${choiceText}`);
            btn.innerHTML = `<div class="badge">${idx + 1}</div><div class="text">${escapeHtml(choiceText)}</div>`;
            btn.addEventListener("click", () => answer(idx));
            el.answers.appendChild(btn);
          });

          updateTop();
          focusFirstChoiceSoon();
        }

        function focusFirstChoiceSoon() {
          window.setTimeout(() => {
            const first = el.answers.querySelector(".choice");
            if (first) first.focus({ preventScroll: true });
          }, 0);
        }

        function lockChoices() {
          $$(".choice", el.answers).forEach((b) => {
            b.classList.add("disabled");
            b.disabled = true;
          });
        }

        function answer(chosenIndex) {
          if (state.phase !== "question" || state.locked) return;
          state.locked = true;
          state.lastChoiceIndex = chosenIndex;

          const q = state.round[state.current];
          const correctIndex = q.correctIndex;
          const isCorrect = chosenIndex === correctIndex;

          const buttons = $$(".choice", el.answers);
          const chosenBtn = buttons[chosenIndex];
          const correctBtn = buttons[correctIndex];

          if (chosenBtn) chosenBtn.classList.add(isCorrect ? "correct" : "wrong");
          if (!isCorrect && correctBtn) correctBtn.classList.add("correct");

          lockChoices();
          el.primaryBtn.disabled = false;

          if (isCorrect) {
            state.score += 1;
            state.streak += 1;
            setIcon("good");
            el.feedbackMsg.innerHTML = `<strong>Correct.</strong> Nice!`;
            audio.ok();
          } else {
            state.streak = 0;
            setIcon("bad");
            el.feedbackMsg.innerHTML = `<strong>Not quite.</strong> The correct answer is <strong>${escapeHtml(
              q.choices[correctIndex]
            )}</strong>.`;
            audio.nope();
          }

          state.history.push({
            id: q._id,
            question: q.question,
            choices: q.choices.slice(),
            correctIndex,
            chosenIndex,
            source: q._source,
          });

          updateTop();
        }

        function renderDone() {
          state.phase = "done";
          state.locked = true;
          setIcon(null);
          clearAnswers();

          const total = state.round.length || 10;
          const pct = total === 0 ? 0 : Math.round((state.score / total) * 100);
          const verdict =
            pct >= 90 ? "Outstanding!" : pct >= 70 ? "Great job!" : pct >= 50 ? "Nice start!" : "Keep going!";

          el.question.textContent = "Final score";
          el.subtitle.textContent = `${verdict} You got ${state.score} out of ${total}.`;

          const container = document.createElement("div");
          container.className = "scoreGrid";

          const row = document.createElement("div");
          row.className = "scoreRow";
          row.innerHTML = `
            <div class="meter" style="--p:${pct}">
              <div>
                <div class="big">${pct}%</div>
                <div class="small">accuracy</div>
              </div>
            </div>
            <div style="display:grid;gap:10px;min-width:min(460px, 100%);">
              <div class="tag" style="justify-content:space-between;gap:12px;">
                <span>Questions answered</span>
                <span style="color:rgba(255,255,255,.9);font-weight:800;">${total}</span>
              </div>
              <div class="tag" style="justify-content:space-between;gap:12px;">
                <span>Correct</span>
                <span style="color:rgba(255,255,255,.9);font-weight:800;">${state.score}</span>
              </div>
              <div class="tag" style="justify-content:space-between;gap:12px;">
                <span>Best streak</span>
                <span style="color:rgba(255,255,255,.9);font-weight:800;">${bestStreak(state.history)}</span>
              </div>
            </div>
          `;

          const review = document.createElement("div");
          review.className = "review";

          const details = document.createElement("details");
          details.open = false;
          const wrongCount = state.history.filter((h) => h.chosenIndex !== h.correctIndex).length;
          details.innerHTML = `
            <summary>Review answers (${wrongCount === 0 ? "perfect run" : `${wrongCount} missed`})</summary>
            <div class="reviewItem" id="reviewList"></div>
          `;
          review.appendChild(details);

          container.appendChild(row);
          container.appendChild(review);
          el.answers.appendChild(container);

          const list = $("#reviewList");
          state.history.forEach((h, i) => {
            const ok = h.chosenIndex === h.correctIndex;
            const item = document.createElement("div");
            item.innerHTML = `
              <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;">
                <div style="font-weight:800;color:rgba(255,255,255,.9);letter-spacing:-0.02em;">${i + 1}. ${escapeHtml(
                  h.question
                )}</div>
                <span class="pill2 ${ok ? "good" : "bad"}">${ok ? "✓ Correct" : "✕ Missed"}</span>
              </div>
              <div style="display:grid;gap:6px;">
                <div><span style="color:rgba(255,255,255,.78);font-weight:750;">Your answer:</span> ${escapeHtml(
                  h.choices[h.chosenIndex] ?? "(none)"
                )}</div>
                <div><span style="color:rgba(255,255,255,.78);font-weight:750;">Correct:</span> ${escapeHtml(
                  h.choices[h.correctIndex]
                )}</div>
              </div>
            `;
            list.appendChild(item);
          });

          el.feedbackMsg.textContent = "Play again or share your score.";
          el.primaryBtn.textContent = "Play again";
          el.primaryBtn.disabled = false;
          el.tagRight.textContent = "Complete";
          el.tagLeft.innerHTML = `<span>Tip:</span> <span class="kbd">Copy score</span> shares to clipboard`;
          ensureShareButton();

          updateTop();
          audio.finish();
        }

        function bestStreak(history) {
          let best = 0;
          let cur = 0;
          for (const h of history) {
            if (h.chosenIndex === h.correctIndex) {
              cur += 1;
              if (cur > best) best = cur;
            } else {
              cur = 0;
            }
          }
          return best;
        }

        function startRound() {
          const all = deriveBuiltinRound().map(randomizeChoices);
          state.round = all; // Exactly the 10 built-in questions, randomized.
          state.current = 0;
          state.score = 0;
          state.streak = 0;
          state.history = [];
          updateTop();
          renderQuestion();
        }

        function next() {
          if (state.phase === "intro") {
            startRound();
            return;
          }
          if (state.phase === "question") {
            if (!state.locked) return;
            state.current += 1;
            if (state.current >= state.round.length) {
              renderDone();
            } else {
              renderQuestion();
            }
            return;
          }
          if (state.phase === "done") {
            startRound();
            return;
          }
        }

        function escapeHtml(str) {
          return String(str)
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");
        }

        function openModal() {
          el.modal.classList.add("open");
          el.modal.addEventListener("click", onModalBackdropClick);
          window.setTimeout(() => el.cq.focus({ preventScroll: true }), 0);
        }

        function closeModal() {
          el.modal.classList.remove("open");
          el.modal.removeEventListener("click", onModalBackdropClick);
          el.customBtn.focus({ preventScroll: true });
        }

        function onModalBackdropClick(e) {
          if (e.target === el.modal) closeModal();
        }

        function updateStorageHint() {
          try {
            const count = loadCustom().length;
            el.storageHint.textContent = count ? `Custom questions saved: ${count}` : "Custom questions save locally in this browser.";
          } catch {
            el.storageHint.textContent = "Local saving unavailable in this browser.";
          }
        }

        function onKeyDown(e) {
          if (e.key === "Escape") {
            if (el.modal.classList.contains("open")) closeModal();
            return;
          }

          if (el.modal.classList.contains("open")) return;

          if (e.key === "Enter") {
            const active = document.activeElement;
            if (active && active.classList && active.classList.contains("choice")) return; // click handles it
            // Otherwise, Enter can act like Next/Start/Play again
            if (el.primaryBtn && !el.primaryBtn.disabled) {
              e.preventDefault();
              next();
            }
            return;
          }

          if (state.phase === "question" && !state.locked) {
            const n = Number(e.key);
            if (n >= 1 && n <= 4) {
              e.preventDefault();
              answer(n - 1);
            }
          }
        }

        async function shareScore() {
          const total = state.round.length || 10;
          const pct = total === 0 ? 0 : Math.round((state.score / total) * 100);
          const text = `USA Basics Trivia — ${state.score}/${total} (${pct}%)`;
          try {
            await navigator.clipboard.writeText(text);
            toast("Copied score to clipboard.");
          } catch {
            toast(text, 2600);
          }
        }

        function ensureShareButton() {
          if ($("#shareBtn")) return;
          const btn = document.createElement("button");
          btn.type = "button";
          btn.id = "shareBtn";
          btn.className = "btn secondary";
          btn.textContent = "Copy score";
          btn.addEventListener("click", shareScore);
          el.rightControls.insertBefore(btn, el.primaryBtn);
        }

        function removeShareButton() {
          const b = $("#shareBtn");
          if (b) b.remove();
        }

        function wireUI() {
          el.primaryBtn.addEventListener("click", () => {
            next();
          });

          el.soundBtn.addEventListener("click", () => {
            const enabled = audio.toggle();
            el.soundBtn.setAttribute("aria-pressed", String(enabled));
            el.soundBtn.textContent = `Sound: ${enabled ? "On" : "Off"}`;
            toast(enabled ? "Sound on." : "Sound off.");
          });

          el.customBtn.addEventListener("click", () => openModal());
          el.closeModal.addEventListener("click", () => closeModal());

          el.customForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const question = el.cq.value.trim();
            const choices = [el.c1.value, el.c2.value, el.c3.value, el.c4.value].map((s) => s.trim());
            const correctIndex = Number(el.correctSelect.value);
            if (!question) return toast("Please enter a question.");
            if (choices.some((c) => !c)) return toast("Please fill all four choices.");
            if (!(correctIndex >= 0 && correctIndex <= 3)) return toast("Please pick the correct answer.");

            const custom = loadCustom();
            custom.push({ question, choices, correctIndex });
            saveCustom(custom);
            updateStorageHint();
            toast("Saved custom question (stored locally).");
            el.customForm.reset();
            el.correctSelect.value = "0";
            closeModal();
          });

          el.clearCustom.addEventListener("click", () => {
            localStorage.removeItem(STORAGE_KEY);
            updateStorageHint();
            toast("Cleared saved custom questions.");
          });

          el.scoreMini.addEventListener("click", () => {
            if (state.phase === "done") shareScore();
          });

          window.addEventListener("keydown", onKeyDown);
        }

        function boot() {
          updateStorageHint();
          wireUI();
          renderIntro();
        }

        boot();
      })();
    </script>
  </body>
</html>
