<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light" />
    <title>Farewell Message Board</title>
    <style>
      :root {
        --bg0: #fff7f0;
        --bg1: #fff;
        --ink: #1c1b1f;
        --muted: rgba(28, 27, 31, 0.68);
        --muted2: rgba(28, 27, 31, 0.5);
        --line: rgba(28, 27, 31, 0.14);
        --shadow: 0 18px 55px rgba(23, 20, 36, 0.14);
        --shadow2: 0 10px 30px rgba(23, 20, 36, 0.12);
        --radius-lg: 22px;
        --radius-md: 16px;
        --radius-sm: 12px;
        --btn-h: 44px;
        --focus: 0 0 0 4px rgba(111, 101, 255, 0.22);
        --brand1: #ff6b6b;
        --brand2: #7c5cff;
        --brand3: #20c997;
        --grid: rgba(28, 27, 31, 0.06);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--ink);
        background: radial-gradient(1100px 680px at 18% 5%, #ffe2e2 0%, rgba(255, 226, 226, 0) 55%),
          radial-gradient(900px 540px at 88% 12%, #e8e3ff 0%, rgba(232, 227, 255, 0) 62%),
          radial-gradient(1100px 700px at 30% 96%, #dff7f0 0%, rgba(223, 247, 240, 0) 58%),
          linear-gradient(180deg, var(--bg0), var(--bg1));
        overflow-x: hidden;
      }

      .bg-grid {
        position: fixed;
        inset: 0;
        pointer-events: none;
        opacity: 0.75;
        background-image: linear-gradient(to right, var(--grid) 1px, transparent 1px),
          linear-gradient(to bottom, var(--grid) 1px, transparent 1px);
        background-size: 56px 56px;
        mask-image: radial-gradient(900px 640px at 50% 20%, #000 52%, transparent 80%);
      }

      .blob {
        position: fixed;
        inset: auto;
        width: 540px;
        height: 540px;
        filter: blur(38px) saturate(1.15);
        opacity: 0.42;
        pointer-events: none;
        border-radius: 999px;
        transform: translate3d(0, 0, 0);
        animation: floaty 16s ease-in-out infinite;
      }

      .blob.b1 {
        left: -140px;
        top: -220px;
        background: radial-gradient(circle at 30% 30%, #ff7eb3, rgba(255, 126, 179, 0) 62%),
          radial-gradient(circle at 70% 60%, #ffd36e, rgba(255, 211, 110, 0) 56%);
        animation-duration: 20s;
      }

      .blob.b2 {
        right: -220px;
        top: 40px;
        background: radial-gradient(circle at 30% 30%, #7c5cff, rgba(124, 92, 255, 0) 62%),
          radial-gradient(circle at 70% 70%, #4dd6ff, rgba(77, 214, 255, 0) 52%);
        animation-duration: 22s;
        animation-delay: -4s;
      }

      .blob.b3 {
        left: 18%;
        bottom: -260px;
        width: 620px;
        height: 620px;
        background: radial-gradient(circle at 40% 35%, #20c997, rgba(32, 201, 151, 0) 60%),
          radial-gradient(circle at 76% 72%, #a7ff83, rgba(167, 255, 131, 0) 54%);
        animation-duration: 24s;
        animation-delay: -9s;
      }

      @keyframes floaty {
        0% {
          transform: translate3d(0, 0, 0) scale(1);
        }
        50% {
          transform: translate3d(18px, 22px, 0) scale(1.03);
        }
        100% {
          transform: translate3d(0, 0, 0) scale(1);
        }
      }

      .container {
        width: min(1120px, calc(100% - 40px));
        margin: 0 auto;
      }

      .topbar {
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        background: rgba(255, 255, 255, 0.72);
        background: color-mix(in oklab, #ffffff 70%, transparent);
        border-bottom: 1px solid rgba(28, 27, 31, 0.12);
        border-bottom: 1px solid color-mix(in oklab, var(--line) 80%, transparent);
      }

      .topbar__inner {
        display: flex;
        gap: 14px;
        align-items: center;
        justify-content: space-between;
        padding: 14px 0;
      }

      .brand {
        display: grid;
        grid-template-columns: auto 1fr;
        grid-template-rows: auto auto;
        column-gap: 12px;
        row-gap: 2px;
        align-items: center;
        min-width: 220px;
      }

      .mark {
        width: 42px;
        height: 42px;
        border-radius: 14px;
        display: grid;
        place-items: center;
        box-shadow: var(--shadow2);
        background: linear-gradient(135deg, rgba(255, 107, 107, 0.95), rgba(124, 92, 255, 0.9));
        border: 1px solid rgba(255, 255, 255, 0.5);
      }

      .mark svg {
        width: 22px;
        height: 22px;
        color: rgba(255, 255, 255, 0.95);
      }

      .brand__title {
        font-weight: 780;
        letter-spacing: -0.02em;
        font-size: 16px;
        line-height: 1.2;
      }

      .brand__sub {
        grid-column: 2;
        font-size: 12.5px;
        color: var(--muted);
        line-height: 1.25;
      }

      .actions {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .btn {
        height: var(--btn-h);
        padding: 0 16px;
        border-radius: 14px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 95%, transparent);
        background: rgba(255, 255, 255, 0.86);
        background: color-mix(in oklab, #ffffff 85%, transparent);
        color: var(--ink);
        display: inline-flex;
        gap: 10px;
        align-items: center;
        justify-content: center;
        font-weight: 650;
        letter-spacing: -0.01em;
        cursor: pointer;
        box-shadow: 0 10px 24px rgba(22, 18, 40, 0.06);
        transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease,
          border-color 160ms ease;
        user-select: none;
      }

      .btn svg {
        width: 18px;
        height: 18px;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 32px rgba(22, 18, 40, 0.1);
      }

      .btn:active {
        transform: translateY(0);
        box-shadow: 0 10px 24px rgba(22, 18, 40, 0.08);
      }

      .btn:focus-visible {
        outline: none;
        box-shadow: var(--focus), 0 14px 32px rgba(22, 18, 40, 0.1);
      }

      .btn--primary {
        border-color: transparent;
        color: #0c0920;
        background: linear-gradient(135deg, #ff7a7a, #8a6bff);
        background: linear-gradient(
          135deg,
          color-mix(in oklab, var(--brand1) 78%, white),
          color-mix(in oklab, var(--brand2) 78%, white)
        );
      }

      .btn--primary:hover {
        background: linear-gradient(135deg, #ff8a8a, #9a7bff);
        background: linear-gradient(
          135deg,
          color-mix(in oklab, var(--brand1) 86%, white),
          color-mix(in oklab, var(--brand2) 86%, white)
        );
      }

      .btn--ghost {
        background: rgba(255, 255, 255, 0.56);
        background: color-mix(in oklab, #ffffff 55%, transparent);
      }

      .btn--ghost:hover {
        background: rgba(255, 255, 255, 0.78);
        background: color-mix(in oklab, #ffffff 75%, transparent);
      }

      .avatar-pill {
        display: inline-flex;
        gap: 10px;
        align-items: center;
        max-width: 240px;
      }

      .pill-dot {
        width: 28px;
        height: 28px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        font-size: 15px;
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0)),
          linear-gradient(135deg, var(--pillA, #ffd36e), var(--pillB, #ff6b6b));
        border: 1px solid rgba(255, 255, 255, 0.65);
        box-shadow: 0 10px 18px rgba(22, 18, 40, 0.1);
      }

      main {
        padding: 18px 0 88px;
      }

      .hero {
        display: grid;
        gap: 14px;
        padding: 14px;
        border-radius: var(--radius-lg);
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 90%, transparent);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.82), rgba(255, 255, 255, 0.64)),
          radial-gradient(860px 380px at 15% 10%, rgba(255, 211, 110, 0.25), transparent 60%),
          radial-gradient(700px 340px at 92% 15%, rgba(124, 92, 255, 0.22), transparent 60%);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .hero__row {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 14px;
      }

      .hero h1 {
        margin: 0;
        font-size: clamp(22px, 3.2vw, 32px);
        letter-spacing: -0.03em;
        line-height: 1.1;
      }

      .hero p {
        margin: 6px 0 0;
        color: var(--muted);
        line-height: 1.45;
        max-width: 64ch;
      }

      .stats {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
        align-self: center;
      }

      .stat {
        min-width: 156px;
        padding: 10px 12px;
        border-radius: 16px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 85%, transparent);
        background: rgba(255, 255, 255, 0.74);
        background: color-mix(in oklab, #ffffff 70%, transparent);
        box-shadow: 0 10px 20px rgba(22, 18, 40, 0.06);
      }

      .stat__label {
        color: var(--muted2);
        font-size: 12px;
        letter-spacing: -0.01em;
      }

      .stat__value {
        margin-top: 2px;
        font-weight: 760;
        font-size: 16px;
        letter-spacing: -0.02em;
      }

      .toolbar {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        margin-top: 4px;
      }

      .search {
        flex: 1;
        min-width: min(440px, 100%);
        display: flex;
        align-items: center;
        gap: 10px;
        height: var(--btn-h);
        padding: 0 14px;
        border-radius: 14px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 95%, transparent);
        background: rgba(255, 255, 255, 0.84);
        background: color-mix(in oklab, #ffffff 80%, transparent);
        box-shadow: 0 10px 24px rgba(22, 18, 40, 0.06);
      }

      .search svg {
        width: 18px;
        height: 18px;
        color: rgba(28, 27, 31, 0.62);
      }

      .search input {
        border: 0;
        background: transparent;
        outline: none;
        width: 100%;
        font-size: 14px;
        color: var(--ink);
      }

      .segmented {
        display: inline-flex;
        gap: 6px;
        padding: 6px;
        border-radius: 16px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 80%, transparent);
        background: rgba(255, 255, 255, 0.68);
        background: color-mix(in oklab, #ffffff 65%, transparent);
        box-shadow: 0 10px 22px rgba(22, 18, 40, 0.06);
      }

      .chip {
        height: calc(var(--btn-h) - 12px);
        padding: 0 12px;
        border-radius: 14px;
        border: 1px solid transparent;
        background: transparent;
        color: var(--muted);
        font-weight: 660;
        letter-spacing: -0.01em;
        cursor: pointer;
        transition: background 140ms ease, color 140ms ease, transform 140ms ease, border-color 140ms ease;
      }

      .chip:hover {
        background: rgba(255, 255, 255, 0.86);
        background: color-mix(in oklab, #ffffff 85%, transparent);
        color: rgba(28, 27, 31, 0.86);
        color: color-mix(in oklab, var(--ink) 80%, #000);
      }

      .chip[aria-pressed="true"] {
        background: linear-gradient(135deg, rgba(32, 201, 151, 0.26), rgba(124, 92, 255, 0.18));
        background: linear-gradient(
          135deg,
          color-mix(in oklab, var(--brand3) 25%, white),
          color-mix(in oklab, var(--brand2) 16%, white)
        );
        border-color: rgba(28, 27, 31, 0.14);
        border-color: color-mix(in oklab, var(--line) 70%, transparent);
        color: var(--ink);
      }

      .chip:focus-visible {
        outline: none;
        box-shadow: var(--focus);
      }

      .grid {
        margin-top: 16px;
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 14px;
      }

      .card {
        grid-column: span 6;
        border-radius: var(--radius-lg);
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 90%, transparent);
        background: rgba(255, 255, 255, 0.78);
        background: color-mix(in oklab, #ffffff 75%, transparent);
        box-shadow: 0 14px 34px rgba(22, 18, 40, 0.08);
        overflow: hidden;
        position: relative;
        isolation: isolate;
        transform: translateZ(0);
      }

      .card::before {
        content: "";
        position: absolute;
        inset: -70px -70px auto auto;
        width: 180px;
        height: 180px;
        background: radial-gradient(circle at 30% 30%, var(--accent), transparent 62%);
        opacity: 0.22;
        filter: blur(6px);
        z-index: -1;
      }

      .card__pad {
        padding: 14px;
      }

      .card__top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .who {
        display: flex;
        gap: 12px;
        align-items: center;
        min-width: 0;
      }

      .avatar {
        width: 38px;
        height: 38px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0)),
          linear-gradient(135deg, var(--accent), #5e5bff);
        border: 1px solid rgba(255, 255, 255, 0.65);
        box-shadow: 0 12px 22px rgba(22, 18, 40, 0.1);
        font-size: 18px;
      }

      .meta {
        min-width: 0;
      }

      .name {
        font-weight: 760;
        letter-spacing: -0.02em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .sub {
        font-size: 12.5px;
        color: var(--muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .icon-btn {
        width: var(--btn-h);
        height: var(--btn-h);
        border-radius: 14px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 95%, transparent);
        background: rgba(255, 255, 255, 0.8);
        background: color-mix(in oklab, #ffffff 78%, transparent);
        color: var(--muted);
        display: grid;
        place-items: center;
        cursor: pointer;
        transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease, color 160ms ease;
        box-shadow: 0 10px 22px rgba(22, 18, 40, 0.06);
      }

      .icon-btn svg {
        width: 18px;
        height: 18px;
      }

      .icon-btn:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.92);
        background: color-mix(in oklab, #ffffff 90%, transparent);
        color: rgba(28, 27, 31, 0.8);
        color: color-mix(in oklab, var(--ink) 70%, #000);
        box-shadow: 0 14px 30px rgba(22, 18, 40, 0.1);
      }

      .icon-btn:active {
        transform: translateY(0);
      }

      .icon-btn:focus-visible {
        outline: none;
        box-shadow: var(--focus), 0 14px 30px rgba(22, 18, 40, 0.1);
      }

      .msg {
        margin: 12px 0 0;
        font-size: 14.5px;
        line-height: 1.55;
        color: rgba(28, 27, 31, 0.92);
        display: -webkit-box;
        -webkit-line-clamp: 6;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .card__bottom {
        margin-top: 12px;
        display: flex;
        gap: 12px;
        align-items: flex-end;
        justify-content: space-between;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        height: 30px;
        padding: 0 10px;
        border-radius: 999px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 86%, transparent);
        background: rgba(255, 255, 255, 0.7);
        background: color-mix(in oklab, #ffffff 68%, transparent);
        color: var(--muted);
        font-size: 12.5px;
        font-weight: 640;
        letter-spacing: -0.01em;
      }

      .thumb {
        width: 132px;
        height: 86px;
        border-radius: 16px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 84%, transparent);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.5));
        overflow: hidden;
        box-shadow: 0 14px 32px rgba(22, 18, 40, 0.08);
        flex: none;
      }

      .thumb svg {
        width: 100%;
        height: 100%;
        display: block;
      }

      .empty {
        grid-column: 1 / -1;
        padding: 22px;
        border-radius: var(--radius-lg);
        border: 1px dashed rgba(28, 27, 31, 0.18);
        border: 1px dashed color-mix(in oklab, var(--line) 88%, transparent);
        background: rgba(255, 255, 255, 0.7);
        background: color-mix(in oklab, #ffffff 65%, transparent);
        color: var(--muted);
        box-shadow: 0 12px 28px rgba(22, 18, 40, 0.06);
      }

      .empty strong {
        color: var(--ink);
      }

      .fab {
        position: fixed;
        right: 18px;
        bottom: 18px;
        z-index: 11;
        padding: 0 18px;
        border-radius: 999px;
      }

      dialog.dialog {
        width: min(720px, calc(100% - 24px));
        border: 0;
        padding: 0;
        border-radius: 22px;
        box-shadow: 0 28px 90px rgba(12, 9, 32, 0.28);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.78)),
          radial-gradient(820px 360px at 12% 8%, rgba(255, 211, 110, 0.24), transparent 62%),
          radial-gradient(700px 340px at 92% 10%, rgba(124, 92, 255, 0.22), transparent 64%);
        overflow: hidden;
      }

      dialog.dialog::backdrop {
        background: rgba(15, 12, 28, 0.35);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      .dialog__head {
        padding: 16px 16px 12px;
        display: flex;
        gap: 12px;
        align-items: flex-start;
        justify-content: space-between;
        border-bottom: 1px solid rgba(28, 27, 31, 0.12);
        border-bottom: 1px solid color-mix(in oklab, var(--line) 85%, transparent);
      }

      .dialog__title {
        margin: 0;
        font-size: 18px;
        letter-spacing: -0.02em;
        line-height: 1.25;
      }

      .dialog__hint {
        margin: 4px 0 0;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.35;
      }

      .dialog__body {
        padding: 14px 16px 16px;
        display: grid;
        gap: 12px;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      @media (max-width: 780px) {
        .card {
          grid-column: 1 / -1;
        }

        .hero__row {
          flex-direction: column;
        }

        .stats {
          justify-content: flex-start;
        }

        .row {
          grid-template-columns: 1fr;
        }
      }

      .field {
        display: grid;
        gap: 6px;
      }

      label {
        font-size: 12.5px;
        color: var(--muted);
        font-weight: 650;
        letter-spacing: -0.01em;
      }

      input[type="text"],
      textarea,
      select {
        width: 100%;
        border-radius: 14px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 95%, transparent);
        background: rgba(255, 255, 255, 0.84);
        background: color-mix(in oklab, #ffffff 82%, transparent);
        box-shadow: 0 10px 22px rgba(22, 18, 40, 0.06);
        padding: 12px 12px;
        font-size: 14px;
        color: var(--ink);
        outline: none;
        transition: box-shadow 160ms ease, border-color 160ms ease, background 160ms ease;
      }

      textarea {
        min-height: 132px;
        resize: vertical;
        line-height: 1.45;
      }

      input[type="text"]:focus,
      textarea:focus,
      select:focus {
        border-color: rgba(124, 92, 255, 0.52);
        box-shadow: var(--focus), 0 12px 24px rgba(22, 18, 40, 0.08);
        background: rgba(255, 255, 255, 0.96);
        background: color-mix(in oklab, #ffffff 92%, transparent);
      }

      .helper {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        font-size: 12.5px;
        color: var(--muted);
      }

      .dialog__foot {
        padding: 12px 16px 16px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
        border-top: 1px solid rgba(28, 27, 31, 0.12);
        border-top: 1px solid color-mix(in oklab, var(--line) 85%, transparent);
        background: rgba(255, 255, 255, 0.46);
        background: color-mix(in oklab, #ffffff 40%, transparent);
      }

      .btn--danger {
        background: linear-gradient(135deg, #ff7a7a, #ff9a7a);
        background: linear-gradient(135deg, color-mix(in oklab, #ff6b6b 86%, white), color-mix(in oklab, #ff8c6b 80%, white));
        border-color: transparent;
        color: #1b0b0b;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .toasts {
        position: fixed;
        left: 16px;
        bottom: 16px;
        z-index: 12;
        display: grid;
        gap: 10px;
        width: min(360px, calc(100% - 32px));
        pointer-events: none;
      }

      .toast {
        pointer-events: auto;
        padding: 12px 12px;
        border-radius: 18px;
        border: 1px solid rgba(28, 27, 31, 0.14);
        border: 1px solid color-mix(in oklab, var(--line) 90%, transparent);
        background: rgba(255, 255, 255, 0.88);
        background: color-mix(in oklab, #ffffff 84%, transparent);
        box-shadow: 0 18px 44px rgba(12, 9, 32, 0.18);
        display: flex;
        gap: 10px;
        align-items: flex-start;
      }

      .toast__dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: linear-gradient(135deg, var(--brand3), var(--brand2));
        margin-top: 4px;
        flex: none;
      }

      .toast__text {
        font-size: 13.5px;
        line-height: 1.35;
        color: rgba(28, 27, 31, 0.92);
        color: color-mix(in oklab, var(--ink) 92%, #000);
      }

      .sparkle {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 999;
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 14px;
        border-radius: 4px;
        transform: translate(-50%, -50%);
        will-change: transform, opacity;
        box-shadow: 0 10px 18px rgba(0, 0, 0, 0.08);
      }

      @media (prefers-reduced-motion: reduce) {
        .blob,
        .btn,
        .icon-btn,
        .card {
          transition: none !important;
          animation: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-grid" aria-hidden="true"></div>
    <div class="blob b1" aria-hidden="true"></div>
    <div class="blob b2" aria-hidden="true"></div>
    <div class="blob b3" aria-hidden="true"></div>

    <header class="topbar">
      <div class="container">
        <div class="topbar__inner">
          <div class="brand">
            <div class="mark" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path
                  d="M7.25 11.2c2.9-2.6 6.6-4.1 9.5-4.1 1.3 0 2.3.3 3 .8-.9 3.5-3.3 7.2-7.3 10.2-4 3-7.8 3.6-10.4 2.6 1.8-1.4 3.7-4.1 5.2-7.3z"
                  stroke="currentColor"
                  stroke-width="1.7"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M10.4 13.1l-3.7 3.2M12.8 8.7l2.5 2.8"
                  stroke="currentColor"
                  stroke-width="1.7"
                  stroke-linecap="round"
                />
              </svg>
            </div>
            <div class="brand__title">Farewell Message Board</div>
            <div class="brand__sub">A cozy corner for kind words, memories, and ‚Äúyou‚Äôve got this!‚Äù energy.</div>
          </div>

          <div class="actions">
            <button class="btn btn--ghost" id="loginBtn" type="button">
              <span class="avatar-pill" id="loginPill">
                <span class="pill-dot" id="loginDot" aria-hidden="true" style="--pillA: #ffd36e; --pillB: #ff6b6b;">‚ú®</span>
                <span id="loginLabel">Pseudo login</span>
              </span>
            </button>

            <button class="btn btn--primary" id="writeBtn" type="button">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path
                  d="M12.2 6.2h-6.2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-6.2"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M19.6 4.4a2 2 0 0 1 0 2.8l-8.8 8.8-3.6.8.8-3.6 8.8-8.8a2 2 0 0 1 2.8 0z"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Write
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="hero" aria-label="Board controls">
        <div class="hero__row">
          <div>
            <h1>Leave something lovely behind.</h1>
            <p>
              Share a memory, a thank‚Äëyou, or a small piece of encouragement. Each note becomes a little keepsake to take into the next adventure.
            </p>
          </div>
          <div class="stats" aria-label="Board stats">
            <div class="stat">
              <div class="stat__label">Messages</div>
              <div class="stat__value" id="statCount">‚Äî</div>
            </div>
            <div class="stat">
              <div class="stat__label">Signed in as</div>
              <div class="stat__value" id="statUser">Guest</div>
            </div>
          </div>
        </div>

        <div class="toolbar" role="group" aria-label="Search and filter">
          <div class="search" role="search">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M10.6 18.2a7.6 7.6 0 1 1 0-15.2 7.6 7.6 0 0 1 0 15.2z"
                stroke="currentColor"
                stroke-width="1.8"
              />
              <path
                d="M20.6 20.2l-4.1-4.1"
                stroke="currentColor"
                stroke-width="1.8"
                stroke-linecap="round"
              />
            </svg>
            <input id="searchInput" type="text" inputmode="search" placeholder="Search by name or message‚Ä¶" autocomplete="off" />
          </div>

          <div class="segmented" aria-label="Category filter">
            <button class="chip" type="button" data-filter="all" aria-pressed="true">All</button>
            <button class="chip" type="button" data-filter="team" aria-pressed="false">Team</button>
            <button class="chip" type="button" data-filter="friends" aria-pressed="false">Friends</button>
            <button class="chip" type="button" data-filter="mentors" aria-pressed="false">Mentors</button>
          </div>
        </div>
      </section>

      <section aria-label="Messages">
        <div class="grid" id="grid" aria-live="polite"></div>
      </section>
    </main>

    <button class="btn btn--primary fab" id="fabWriteBtn" type="button" aria-label="Write a new message">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" />
      </svg>
      Write
    </button>

    <dialog class="dialog" id="authDialog" aria-labelledby="authTitle">
      <div class="dialog__head">
        <div>
          <h2 class="dialog__title" id="authTitle">Pseudo login</h2>
          <p class="dialog__hint">No passwords. Just pick a name so your messages have a friendly signature.</p>
        </div>
        <button class="icon-btn" type="button" data-close-dialog aria-label="Close">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6.8 6.8l10.4 10.4M17.2 6.8L6.8 17.2" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" />
          </svg>
        </button>
      </div>
      <form class="dialog__body" id="authForm" method="dialog">
        <div class="row">
          <div class="field">
            <label for="authName">Display name</label>
            <input id="authName" type="text" placeholder="e.g., Alex" maxlength="32" />
          </div>
          <div class="field">
            <label for="authEmoji">Avatar</label>
            <select id="authEmoji">
              <option>‚ú®</option>
              <option>üåü</option>
              <option>ü´∂</option>
              <option>üòä</option>
              <option>üßã</option>
              <option>üß†</option>
              <option>üê£</option>
              <option>üêô</option>
              <option>ü¶ä</option>
              <option>ü¶Ñ</option>
            </select>
          </div>
        </div>
        <div class="field">
          <label for="authColor">Accent</label>
          <select id="authColor">
            <option value="#ff6b6b">Warm Coral</option>
            <option value="#7c5cff">Electric Purple</option>
            <option value="#20c997">Mint Glow</option>
            <option value="#ffb703">Sunrise Gold</option>
            <option value="#4dd6ff">Sky Blue</option>
            <option value="#ff7eb3">Berry Pink</option>
          </select>
        </div>
        <div class="helper">
          <span id="authPreview">Preview: Guest</span>
          <span>Stored only in your browser.</span>
        </div>
      </form>
      <div class="dialog__foot">
        <button class="btn btn--ghost" type="button" id="signOutBtn" hidden>Sign out</button>
        <button class="btn btn--ghost" type="button" data-close-dialog>Cancel</button>
        <button class="btn btn--primary" type="button" id="saveAuthBtn">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M19.6 7.7l-8.9 8.9-4.3-4.3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          Save
        </button>
      </div>
    </dialog>

    <dialog class="dialog" id="writeDialog" aria-labelledby="writeTitle">
      <div class="dialog__head">
        <div>
          <h2 class="dialog__title" id="writeTitle">Write a farewell message</h2>
          <p class="dialog__hint">Keep it heartfelt, keep it you. (Tip: one specific memory makes a note unforgettable.)</p>
        </div>
        <button class="icon-btn" type="button" data-close-dialog aria-label="Close">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6.8 6.8l10.4 10.4M17.2 6.8L6.8 17.2" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" />
          </svg>
        </button>
      </div>
      <form class="dialog__body" id="writeForm" method="dialog">
        <div class="row">
          <div class="field">
            <label for="fromName">From</label>
            <input id="fromName" type="text" placeholder="Your name" maxlength="32" />
          </div>
          <div class="field">
            <label for="category">Category</label>
            <select id="category">
              <option value="team">Team</option>
              <option value="friends">Friends</option>
              <option value="mentors">Mentors</option>
            </select>
          </div>
        </div>
        <div class="field">
          <label for="message">Message</label>
          <textarea id="message" placeholder="Write something kind‚Ä¶ (10‚Äì400 characters)"></textarea>
          <div class="helper">
            <span id="msgHelper">Be warm. Be specific. Be proud.</span>
            <span id="charCount">0 / 400</span>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label for="illustration">Picture vibe</label>
            <select id="illustration">
              <option value="balloon">Balloons</option>
              <option value="paperplane">Paper plane</option>
              <option value="suitcase">Suitcase</option>
              <option value="rocket">Rocket</option>
              <option value="mountains">New horizons</option>
              <option value="coffee">Coffee break</option>
              <option value="camera">Snapshots</option>
              <option value="book">Storybook</option>
              <option value="star">Shining star</option>
              <option value="heart">Big heart</option>
            </select>
          </div>
          <div class="field">
            <label for="signature">Signature emoji</label>
            <select id="signature">
              <option>ü´∂</option>
              <option>‚ú®</option>
              <option>üåà</option>
              <option>ü•≥</option>
              <option>üöÄ</option>
              <option>üåü</option>
              <option>‚òï</option>
              <option>üì∏</option>
              <option>üìö</option>
              <option>üßã</option>
            </select>
          </div>
        </div>
      </form>
      <div class="dialog__foot">
        <button class="btn btn--ghost" type="button" data-close-dialog>Cancel</button>
        <button class="btn btn--primary" type="button" id="postBtn">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M4.4 12.4l7.2 1.5 1.5 7.2 7.2-16-16 7.3z"
              stroke="currentColor"
              stroke-width="1.9"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path d="M11.6 13.9l1.9-1.9" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" />
          </svg>
          Post
        </button>
      </div>
    </dialog>

    <div class="toasts" id="toasts" aria-live="polite" aria-relevant="additions text"></div>
    <div class="sparkle" id="sparkle" aria-hidden="true"></div>

    <script>
      (() => {
        const STORAGE_USER = "fmb_user_v1";
        const STORAGE_CUSTOM = "fmb_custom_messages_v1";

        const $ = (sel, root = document) => root.querySelector(sel);
        const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

        const fmtDate = (d) =>
          new Intl.DateTimeFormat(undefined, { month: "short", day: "2-digit", year: "numeric" }).format(d);

        const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

        function hexToRgb(hex) {
          const raw = String(hex || "").trim();
          const m3 = /^#([0-9a-f]{3})$/i.exec(raw);
          if (m3) {
            const h = m3[1];
            return {
              r: parseInt(h[0] + h[0], 16),
              g: parseInt(h[1] + h[1], 16),
              b: parseInt(h[2] + h[2], 16)
            };
          }
          const m6 = /^#([0-9a-f]{6})$/i.exec(raw);
          if (m6) {
            const h = m6[1];
            return {
              r: parseInt(h.slice(0, 2), 16),
              g: parseInt(h.slice(2, 4), 16),
              b: parseInt(h.slice(4, 6), 16)
            };
          }
          return null;
        }

        function rgbToHex({ r, g, b }) {
          const to = (n) => clamp(Math.round(n), 0, 255).toString(16).padStart(2, "0");
          return `#${to(r)}${to(g)}${to(b)}`;
        }

        function mixHex(a, b, aWeight) {
          const A = hexToRgb(a);
          const B = hexToRgb(b);
          if (!A || !B) return A ? a : B ? b : "#7c5cff";
          const t0 = Number(aWeight);
          const t = Number.isFinite(t0) ? clamp(t0, 0, 1) : 0.5;
          return rgbToHex({
            r: A.r * t + B.r * (1 - t),
            g: A.g * t + B.g * (1 - t),
            b: A.b * t + B.b * (1 - t)
          });
        }

        const escapeHtml = (str) =>
          String(str)
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");

        const normalize = (str) => String(str || "").trim().toLowerCase();

        const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

        const palette = [
          "#ff6b6b",
          "#7c5cff",
          "#20c997",
          "#ffb703",
          "#4dd6ff",
          "#ff7eb3",
          "#a78bfa",
          "#34d399"
        ];

        const BASE_MESSAGES = [
          {
            id: "m1",
            author: "Nina",
            emoji: "üåü",
            category: "team",
            accent: "#7c5cff",
            createdAt: "2026-01-09",
            illustration: "rocket",
            tag: "new beginnings",
            body:
              "You have this rare superpower: you make hard things feel doable. Thank you for the calm energy, the thoughtful questions, and the way you always left the project (and people) better than you found them."
          },
          {
            id: "m2",
            author: "Marco",
            emoji: "‚òï",
            category: "team",
            accent: "#20c997",
            createdAt: "2026-01-11",
            illustration: "coffee",
            tag: "daily wins",
            body:
              "I‚Äôm going to miss our ‚Äúquick‚Äù coffee chats that accidentally turned into strategy sessions. Thanks for being the kind of teammate who celebrates progress and never forgets the humans behind the work."
          },
          {
            id: "m3",
            author: "Aisha",
            emoji: "ü´∂",
            category: "friends",
            accent: "#ff6b6b",
            createdAt: "2026-01-12",
            illustration: "heart",
            tag: "big heart",
            body:
              "You showed up with kindness like it was a default setting. Your laugh, your empathy, your ‚Äúwe can fix it‚Äù attitude ‚Äî all of it made the days brighter. Can‚Äôt wait to see what you do next."
          },
          {
            id: "m4",
            author: "Sam",
            emoji: "üì∏",
            category: "friends",
            accent: "#4dd6ff",
            createdAt: "2026-01-13",
            illustration: "camera",
            tag: "memories",
            body:
              "Remember that day everything broke‚Ä¶ and you still somehow found the funny in it? That‚Äôs your gift. Thanks for turning chaos into a story we‚Äôll laugh about for years."
          },
          {
            id: "m5",
            author: "Dr. Chen",
            emoji: "üìö",
            category: "mentors",
            accent: "#ffb703",
            createdAt: "2026-01-14",
            illustration: "book",
            tag: "growth",
            body:
              "Watching you grow has been a privilege. You ask the right questions, listen deeply, and move with purpose. Wherever you go next, you‚Äôll create momentum ‚Äî and bring people with you."
          },
          {
            id: "m6",
            author: "Priya",
            emoji: "üéà",
            category: "team",
            accent: "#ff7eb3",
            createdAt: "2026-01-15",
            illustration: "balloon",
            tag: "celebrate",
            body:
              "You made meetings feel lighter and launches feel possible. Thank you for the quiet encouragement and the loud celebrations ‚Äî you were the best kind of steady."
          },
          {
            id: "m7",
            author: "Jordan",
            emoji: "üß†",
            category: "team",
            accent: "#a78bfa",
            createdAt: "2026-01-16",
            illustration: "paperplane",
            tag: "clarity",
            body:
              "Your notes were basically tiny masterpieces ‚Äî clear, kind, and actually actionable. Thank you for bringing structure without stress. The bar is now unfairly high."
          },
          {
            id: "m8",
            author: "Lena",
            emoji: "üßã",
            category: "friends",
            accent: "#34d399",
            createdAt: "2026-01-17",
            illustration: "suitcase",
            tag: "adventure",
            body:
              "This isn‚Äôt goodbye ‚Äî it‚Äôs ‚Äòsee you on the next side quest.‚Äô You deserve a path that‚Äôs as bold as your ideas. Save me a postcard (or at least a meme)."
          },
          {
            id: "m9",
            author: "Mina",
            emoji: "üèîÔ∏è",
            category: "mentors",
            accent: "#20c997",
            createdAt: "2026-01-18",
            illustration: "mountains",
            tag: "horizons",
            body:
              "You never took the easy route ‚Äî you took the meaningful one. That‚Äôs courage. Keep choosing the work that matters, and the rest will follow."
          },
          {
            id: "m10",
            author: "Tomas",
            emoji: "‚ú®",
            category: "friends",
            accent: "#7c5cff",
            createdAt: "2026-01-19",
            illustration: "star",
            tag: "shine",
            body:
              "Your presence made this place feel like a community, not just a calendar invite. Thank you for the warmth, the jokes, and the ‚Äòwe‚Äôve got you‚Äô energy you gave everyone."
          }
        ];

        const ICONS = {
          copy: `<svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8.2 8.2h9.2a2 2 0 0 1 2 2v9.2a2 2 0 0 1-2 2H8.2a2 2 0 0 1-2-2v-9.2a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.8"/><path d="M6.2 15.8H5.6a2 2 0 0 1-2-2V5.6a2 2 0 0 1 2-2h8.2a2 2 0 0 1 2 2v.6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>`
        };

        function safeParse(json, fallback) {
          try {
            return JSON.parse(json);
          } catch {
            return fallback;
          }
        }

        function loadUser() {
          const raw = localStorage.getItem(STORAGE_USER);
          const u = raw ? safeParse(raw, null) : null;
          if (!u || typeof u !== "object") return null;
          const name = String(u.name || "").trim();
          if (!name) return null;
          return {
            name: name.slice(0, 32),
            emoji: String(u.emoji || "‚ú®").slice(0, 4),
            accent: String(u.accent || "#7c5cff")
          };
        }

        function saveUser(user) {
          localStorage.setItem(STORAGE_USER, JSON.stringify(user));
        }

        function clearUser() {
          localStorage.removeItem(STORAGE_USER);
        }

        function loadCustomMessages() {
          const raw = localStorage.getItem(STORAGE_CUSTOM);
          const arr = raw ? safeParse(raw, []) : [];
          if (!Array.isArray(arr)) return [];
              return arr
            .filter((m) => m && typeof m === "object")
            .map((m) => ({
              id: String(m.id || globalThis.crypto?.randomUUID?.() || `c_${Math.random().toString(16).slice(2)}`),
              author: String(m.author || "Someone").slice(0, 32),
              emoji: String(m.emoji || "ü´∂").slice(0, 4),
              category: String(m.category || "friends"),
              accent: String(m.accent || pick(palette)),
              createdAt: String(m.createdAt || new Date().toISOString()),
              illustration: String(m.illustration || "star"),
              tag: String(m.tag || "from the heart").slice(0, 22),
              body: String(m.body || "").slice(0, 800)
            }));
        }

        function saveCustomMessages(messages) {
          localStorage.setItem(STORAGE_CUSTOM, JSON.stringify(messages));
        }

        function illustrationSvg(kind, accent, seed) {
          const a = hexToRgb(accent) ? accent : "#7c5cff";
          const a2 = mixHex(a, "#ffffff", 0.72);
          const a3 = mixHex(a, "#000000", 0.35);
          const uid = "i_" + String(seed || `${kind}_${a}`).replace(/[^a-z0-9_-]/gi, "_").slice(0, 40);
          const gid = `g_${uid}`;
          const rid = `r_${uid}`;
          const sid = `s_${uid}`;
          const shadow = `url(#${sid})`;

          const base = (inner, title) => `
            <svg viewBox="0 0 132 86" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="${escapeHtml(title)}">
              <defs>
                <linearGradient id="${gid}" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="${a2}"/>
                  <stop offset="1" stop-color="white" stop-opacity="0.65"/>
                </linearGradient>
                <radialGradient id="${rid}" cx="35%" cy="25%" r="70%">
                  <stop offset="0" stop-color="white" stop-opacity="0.88"/>
                  <stop offset="1" stop-color="white" stop-opacity="0"/>
                </radialGradient>
                <filter id="${sid}" x="-20%" y="-20%" width="140%" height="140%">
                  <feDropShadow dx="0" dy="8" stdDeviation="6" flood-color="rgba(22,18,40,0.14)"/>
                </filter>
              </defs>
              <rect x="0.8" y="0.8" width="130.4" height="84.4" rx="16" fill="url(#${gid})" stroke="rgba(28,27,31,0.12)"/>
              <circle cx="30" cy="18" r="22" fill="url(#${rid})"/>
              ${inner}
            </svg>
          `;

          switch (kind) {
            case "balloon":
              return base(
                `
                <g filter="${shadow}">
                  <path d="M44 28c0-8 6.5-14 14.5-14S73 20 73 28c0 10-7 20-14.5 20S44 38 44 28z" fill="${a2}" stroke="${a3}" stroke-opacity="0.25"/>
                  <path d="M58.5 48c-1.5 6-4 9-8.5 13" stroke="${a3}" stroke-opacity="0.35" stroke-width="2" stroke-linecap="round"/>
                  <path d="M68 32c0-8 6.2-14.5 14-14.5S96 24 96 32c0 10-6.8 20-14 20S68 42 68 32z" fill="white" fill-opacity="0.78" stroke="${a3}" stroke-opacity="0.22"/>
                  <path d="M82 52c.3 4.4 2 7.4 5.6 10.8" stroke="${a3}" stroke-opacity="0.35" stroke-width="2" stroke-linecap="round"/>
                </g>
                <path d="M12 70c22-16 36-6 52-12s28-20 56-10" stroke="${a}" stroke-opacity="0.25" stroke-width="3" fill="none" stroke-linecap="round"/>
              `,
                "Two balloons drifting"
              );
            case "paperplane":
              return base(
                `
                <path d="M22 40l86-28-36 64-16-22-34-14z" fill="white" fill-opacity="0.8" stroke="${a3}" stroke-opacity="0.22" />
                <path d="M44 42l24 10 40-40" stroke="${a}" stroke-opacity="0.5" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M18 62c16-10 28-6 44-10 18-4 28-18 54-14" stroke="${a}" stroke-opacity="0.22" stroke-width="3" fill="none" stroke-linecap="round"/>
              `,
                "A paper plane in motion"
              );
            case "suitcase":
              return base(
                `
                <g filter="${shadow}">
                  <rect x="36" y="26" width="60" height="44" rx="12" fill="white" fill-opacity="0.76" stroke="${a3}" stroke-opacity="0.22"/>
                  <path d="M52 26v-5a6 6 0 0 1 6-6h16a6 6 0 0 1 6 6v5" stroke="${a}" stroke-opacity="0.55" stroke-width="3" stroke-linecap="round"/>
                  <path d="M36 46h60" stroke="${a}" stroke-opacity="0.3" stroke-width="3" stroke-linecap="round"/>
                  <circle cx="52" cy="70" r="3.2" fill="${a}" fill-opacity="0.55"/>
                  <circle cx="80" cy="70" r="3.2" fill="${a}" fill-opacity="0.55"/>
                </g>
                <path d="M16 72c16-7 26-1 42-5 24-6 28-20 60-12" stroke="${a}" stroke-opacity="0.22" stroke-width="3" fill="none" stroke-linecap="round"/>
              `,
                "A suitcase for the next adventure"
              );
            case "rocket":
              return base(
                `
                <g filter="${shadow}">
                  <path d="M76 18c14 10 18 28 10 44-15-2-32-14-42-28 9-9 22-16 32-16z" fill="${a2}" stroke="${a3}" stroke-opacity="0.22"/>
                  <path d="M50 34l-10 18 18-10" fill="white" fill-opacity="0.75" stroke="${a3}" stroke-opacity="0.18"/>
                  <circle cx="72" cy="36" r="7" fill="white" fill-opacity="0.8" stroke="${a3}" stroke-opacity="0.2"/>
                </g>
                <path d="M28 66c10-2 18-8 24-16" stroke="${a}" stroke-opacity="0.5" stroke-width="3" stroke-linecap="round"/>
                <path d="M22 72c8-2 16-6 22-12" stroke="${a}" stroke-opacity="0.3" stroke-width="3" stroke-linecap="round"/>
              `,
                "A rocket lifting off"
              );
            case "mountains":
              return base(
                `
                <path d="M18 70l26-30 18 20 16-22 36 32H18z" fill="white" fill-opacity="0.7" stroke="${a3}" stroke-opacity="0.14"/>
                <path d="M44 40l5 6 6-9" stroke="${a}" stroke-opacity="0.55" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="100" cy="24" r="9" fill="${a2}" stroke="${a3}" stroke-opacity="0.12"/>
                <path d="M20 72c22-8 42 6 62-2 12-5 16-12 30-12" stroke="${a}" stroke-opacity="0.22" stroke-width="3" fill="none" stroke-linecap="round"/>
              `,
                "Mountains and new horizons"
              );
            case "coffee":
              return base(
                `
                <g filter="${shadow}">
                  <path d="M42 34h42v18a18 18 0 0 1-18 18H60a18 18 0 0 1-18-18V34z" fill="white" fill-opacity="0.76" stroke="${a3}" stroke-opacity="0.2"/>
                  <path d="M84 40h6a8 8 0 0 1 0 16h-6" stroke="${a}" stroke-opacity="0.55" stroke-width="3" stroke-linecap="round"/>
                  <path d="M52 30c0-6 5-6 5-12M64 30c0-6 5-6 5-12M76 30c0-6 5-6 5-12" stroke="${a}" stroke-opacity="0.35" stroke-width="3" stroke-linecap="round"/>
                </g>
                <path d="M34 72h58" stroke="${a3}" stroke-opacity="0.16" stroke-width="4" stroke-linecap="round"/>
              `,
                "A cozy coffee cup"
              );
            case "camera":
              return base(
                `
                <g filter="${shadow}">
                  <rect x="30" y="30" width="72" height="44" rx="14" fill="white" fill-opacity="0.78" stroke="${a3}" stroke-opacity="0.2"/>
                  <path d="M46 30l6-8h28l6 8" fill="${a2}" fill-opacity="0.8" stroke="${a3}" stroke-opacity="0.16"/>
                  <circle cx="66" cy="52" r="14" fill="${a2}" fill-opacity="0.65" stroke="${a3}" stroke-opacity="0.18"/>
                  <circle cx="66" cy="52" r="6" fill="white" fill-opacity="0.75" />
                  <circle cx="92" cy="40" r="3.2" fill="${a}" fill-opacity="0.6"/>
                </g>
              `,
                "A camera snapshot"
              );
            case "book":
              return base(
                `
                <g filter="${shadow}">
                  <path d="M34 28c10-6 22-6 32 0v50c-10-6-22-6-32 0V28z" fill="white" fill-opacity="0.78" stroke="${a3}" stroke-opacity="0.2"/>
                  <path d="M66 28c10-6 22-6 32 0v50c-10-6-22-6-32 0V28z" fill="${a2}" fill-opacity="0.7" stroke="${a3}" stroke-opacity="0.2"/>
                  <path d="M66 28v50" stroke="${a}" stroke-opacity="0.35" stroke-width="3" stroke-linecap="round"/>
                  <path d="M44 40h14M44 50h14M44 60h14" stroke="${a3}" stroke-opacity="0.18" stroke-width="3" stroke-linecap="round"/>
                </g>
              `,
                "An open book"
              );
            case "heart":
              return base(
                `
                <g filter="${shadow}">
                  <path d="M66 72s-26-16-34-30c-6-12 2-24 15-24 8 0 14 4 19 10 5-6 11-10 19-10 13 0 21 12 15 24-8 14-34 30-34 30z"
                    fill="${a2}" stroke="${a3}" stroke-opacity="0.2"/>
                </g>
                <path d="M20 72c18-6 26 2 40-2s20-14 52-10" stroke="${a}" stroke-opacity="0.22" stroke-width="3" fill="none" stroke-linecap="round"/>
              `,
                "A big heart"
              );
            case "star":
            default:
              return base(
                `
                <g filter="${shadow}">
                  <path d="M66 18l7.5 16.4 18 2.1-13.5 12 3.8 17.6-15.8-9-15.8 9 3.8-17.6-13.5-12 18-2.1L66 18z"
                    fill="white" fill-opacity="0.78" stroke="${a3}" stroke-opacity="0.18"/>
                  <circle cx="96" cy="22" r="4.2" fill="${a2}" fill-opacity="0.9"/>
                  <circle cx="36" cy="26" r="3.2" fill="${a2}" fill-opacity="0.8"/>
                </g>
              `,
                "A shining star"
              );
          }
        }

        function cardHtml(m) {
          const date = fmtDate(new Date(m.createdAt));
          const catLabel = m.category === "team" ? "Team" : m.category === "mentors" ? "Mentors" : "Friends";
          const author = escapeHtml(m.author || "Someone");
          const emoji = escapeHtml(m.emoji || "‚ú®");
          const tag = escapeHtml(m.tag || "from the heart");
          const body = escapeHtml(m.body || "");
          const illustration = illustrationSvg(m.illustration, m.accent, m.id);

          return `
            <article class="card" style="--accent:${escapeHtml(m.accent || "#7c5cff")}" data-id="${escapeHtml(m.id)}">
              <div class="card__pad">
                <div class="card__top">
                  <div class="who">
                    <div class="avatar" aria-hidden="true">${emoji}</div>
                    <div class="meta">
                      <div class="name">${author}</div>
                      <div class="sub">${catLabel} ‚Ä¢ ${date}</div>
                    </div>
                  </div>
                  <button class="icon-btn" type="button" data-action="copy" aria-label="Copy message">
                    ${ICONS.copy}
                  </button>
                </div>
                <p class="msg">${body}</p>
                <div class="card__bottom">
                  <div class="tag">#${tag}</div>
                  <div class="thumb">${illustration}</div>
                </div>
              </div>
            </article>
          `;
        }

        function toast(message) {
          const el = document.createElement("div");
          el.className = "toast";
          el.innerHTML = `<span class="toast__dot" aria-hidden="true"></span><div class="toast__text">${escapeHtml(
            message
          )}</div>`;
          $("#toasts").appendChild(el);
          const t0 = performance.now();
          const duration = 2600;

          const tick = () => {
            const p = (performance.now() - t0) / duration;
            if (p >= 1) {
              el.remove();
              return;
            }
            el.style.opacity = String(clamp(1 - Math.max(0, p - 0.75) / 0.25, 0, 1));
            requestAnimationFrame(tick);
          };
          requestAnimationFrame(tick);
        }

        function confettiBurst(x, y) {
          if (window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;
          const root = $("#sparkle");
          const colors = ["#ff6b6b", "#ffb703", "#20c997", "#7c5cff", "#4dd6ff", "#ff7eb3"];
          const count = 26;
          const now = performance.now();
          for (let i = 0; i < count; i++) {
            const p = document.createElement("div");
            p.className = "confetti";
            p.style.left = `${x}px`;
            p.style.top = `${y}px`;
            p.style.background = pick(colors);
            p.style.rotate = `${Math.random() * 180}deg`;
            root.appendChild(p);
            const vx = (Math.random() * 2 - 1) * 240;
            const vy = -240 - Math.random() * 260;
            const g = 860;
            const spin = (Math.random() * 2 - 1) * 720;
            const life = 920 + Math.random() * 420;
            const startX = x;
            const startY = y;

            const animate = () => {
              const t = performance.now() - now;
              const tt = clamp(t / life, 0, 1);
              const px = startX + vx * (t / 1000);
              const py = startY + vy * (t / 1000) + 0.5 * g * Math.pow(t / 1000, 2);
              p.style.transform = `translate(${px - startX}px, ${py - startY}px) rotate(${spin * tt}deg)`;
              p.style.opacity = String(1 - tt);
              if (tt >= 1) {
                p.remove();
                return;
              }
              requestAnimationFrame(animate);
            };
            requestAnimationFrame(animate);
          }
        }

        function openDialog(d) {
          try {
            d.showModal();
          } catch {
            d.setAttribute("open", "");
          }
        }

        function closeDialog(d) {
          try {
            d.close();
          } catch {
            d.removeAttribute("open");
          }
        }

        const state = {
          user: loadUser(),
          custom: loadCustomMessages(),
          filter: "all",
          search: ""
        };

        function updateHeaderUser() {
          const user = state.user;
          const label = $("#loginLabel");
          const dot = $("#loginDot");
          const statUser = $("#statUser");
          const signOutBtn = $("#signOutBtn");
          if (user) {
            label.textContent = user.name;
            dot.textContent = user.emoji || "‚ú®";
            dot.style.setProperty("--pillA", user.accent || "#7c5cff");
            dot.style.setProperty("--pillB", mixHex(user.accent || "#7c5cff", "#ff6b6b", 0.55));
            statUser.textContent = user.name;
            signOutBtn.hidden = false;
          } else {
            label.textContent = "Pseudo login";
            dot.textContent = "‚ú®";
            dot.style.setProperty("--pillA", "#ffd36e");
            dot.style.setProperty("--pillB", "#ff6b6b");
            statUser.textContent = "Guest";
            signOutBtn.hidden = true;
          }
        }

        function allMessages() {
          // Newest first: custom messages come in newest-first order if we sort by date.
          const merged = [...BASE_MESSAGES, ...state.custom];
          return merged
            .slice()
            .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());
        }

        function filteredMessages() {
          const q = normalize(state.search);
          return allMessages().filter((m) => {
            const catOk = state.filter === "all" ? true : m.category === state.filter;
            if (!catOk) return false;
            if (!q) return true;
            const hay = normalize(`${m.author} ${m.body} ${m.tag}`);
            return hay.includes(q);
          });
        }

        function render() {
          const items = filteredMessages();
          $("#statCount").textContent = String(allMessages().length);
          const grid = $("#grid");
          if (!items.length) {
            grid.innerHTML = `
              <div class="empty">
                <strong>No matches.</strong> Try a shorter search, switch categories, or write a fresh message.
              </div>
            `;
            return;
          }
          grid.innerHTML = items.map(cardHtml).join("");
        }

        function syncAuthPreview() {
          const name = String($("#authName").value || "").trim() || "Guest";
          const emoji = $("#authEmoji").value || "‚ú®";
          const accent = $("#authColor").value || "#7c5cff";
          $("#authPreview").textContent = `Preview: ${emoji} ${name}`;
          $("#loginDot").style.setProperty("--pillA", accent);
          $("#loginDot").style.setProperty("--pillB", mixHex(accent, "#ff6b6b", 0.55));
        }

        function syncCharCount() {
          const n = String($("#message").value || "").length;
          $("#charCount").textContent = `${n} / 400`;
          $("#msgHelper").textContent = n < 10 ? "Add a little more ‚Äî a specific memory is magic." : "Perfect. Warm and specific wins.";
        }

        function openAuth() {
          const user = state.user;
          $("#authName").value = user?.name || "";
          $("#authEmoji").value = user?.emoji || "‚ú®";
          $("#authColor").value = user?.accent || "#7c5cff";
          syncAuthPreview();
          openDialog($("#authDialog"));
          setTimeout(() => $("#authName").focus(), 0);
        }

        function openWrite() {
          const user = state.user;
          $("#fromName").value = user?.name || "";
          $("#category").value = "team";
          $("#message").value = "";
          $("#illustration").value = pick([
            "balloon",
            "paperplane",
            "suitcase",
            "rocket",
            "mountains",
            "coffee",
            "camera",
            "book",
            "star",
            "heart"
          ]);
          $("#signature").value = user?.emoji || "ü´∂";
          syncCharCount();
          openDialog($("#writeDialog"));
          setTimeout(() => $("#fromName").focus(), 0);
        }

        function postMessage() {
          const author = String($("#fromName").value || "").trim().slice(0, 32);
          const category = $("#category").value || "friends";
          const body = String($("#message").value || "").trim();
          const illustration = $("#illustration").value || "star";
          const emoji = $("#signature").value || "ü´∂";

          const len = body.length;
          if (len < 10) {
            toast("Add a bit more so it feels complete (10+ characters).");
            $("#message").focus();
            return;
          }
          if (len > 400) {
            toast("A touch shorter ‚Äî keep it under 400 characters.");
            $("#message").focus();
            return;
          }
          if (!author) {
            toast("Add your name so they know who to thank.");
            $("#fromName").focus();
            return;
          }

          const accent = state.user?.accent || pick(palette);
          const tagByCat = category === "team" ? "thanks" : category === "mentors" ? "wisdom" : "friendship";
          const m = {
            id: globalThis.crypto?.randomUUID?.() || `c_${Math.random().toString(16).slice(2)}`,
            author,
            emoji,
            category,
            accent,
            createdAt: new Date().toISOString(),
            illustration,
            tag: tagByCat,
            body
          };

          state.custom.unshift(m);
          saveCustomMessages(state.custom);
          closeDialog($("#writeDialog"));
          render();
          toast("Posted. Your message is now part of the board.");

          const btn = $("#fabWriteBtn");
          const r = btn.getBoundingClientRect();
          confettiBurst(Math.round(r.left + r.width * 0.55), Math.round(r.top + r.height * 0.2));
        }

        async function copyMessage(cardEl) {
          const bodyEl = $(".msg", cardEl);
          const nameEl = $(".name", cardEl);
          const subEl = $(".sub", cardEl);
          const text = `${nameEl?.textContent || "Someone"} (${subEl?.textContent || ""})\n\n${bodyEl?.textContent || ""}`.trim();
          try {
            await navigator.clipboard.writeText(text);
            toast("Copied message to clipboard.");
          } catch {
            toast("Copy wasn‚Äôt allowed here ‚Äî select text and copy manually.");
          }
        }

        function wireDialogs() {
          $$("[data-close-dialog]").forEach((btn) => {
            btn.addEventListener("click", () => {
              const d = btn.closest("dialog");
              if (d) closeDialog(d);
            });
          });

          $("#loginBtn").addEventListener("click", openAuth);
          $("#writeBtn").addEventListener("click", openWrite);
          $("#fabWriteBtn").addEventListener("click", openWrite);

          $("#authName").addEventListener("input", syncAuthPreview);
          $("#authEmoji").addEventListener("change", syncAuthPreview);
          $("#authColor").addEventListener("change", syncAuthPreview);

          $("#saveAuthBtn").addEventListener("click", () => {
            const name = String($("#authName").value || "").trim().slice(0, 32);
            if (!name) {
              toast("Pick a name to sign your notes.");
              $("#authName").focus();
              return;
            }
            const user = {
              name,
              emoji: ($("#authEmoji").value || "‚ú®").slice(0, 4),
              accent: $("#authColor").value || "#7c5cff"
            };
            state.user = user;
            saveUser(user);
            updateHeaderUser();
            closeDialog($("#authDialog"));
            toast(`Signed in as ${user.name}.`);
          });

          $("#signOutBtn").addEventListener("click", () => {
            state.user = null;
            clearUser();
            updateHeaderUser();
            closeDialog($("#authDialog"));
            toast("Signed out. You‚Äôre browsing as Guest.");
          });

          $("#message").addEventListener("input", syncCharCount);
          $("#postBtn").addEventListener("click", postMessage);

          // Click outside to close (dialog already supports ESC; this adds a friendly click-away).
          $$("dialog.dialog").forEach((d) => {
            d.addEventListener("click", (e) => {
              const rect = d.getBoundingClientRect();
              const inDialog =
                rect.top <= e.clientY && e.clientY <= rect.bottom && rect.left <= e.clientX && e.clientX <= rect.right;
              if (!inDialog) closeDialog(d);
            });
          });
        }

        function wireFilters() {
          $("#searchInput").addEventListener("input", (e) => {
            state.search = e.target.value || "";
            render();
          });

          $$(".chip").forEach((chip) => {
            chip.addEventListener("click", () => {
              const next = chip.getAttribute("data-filter") || "all";
              state.filter = next;
              $$(".chip").forEach((c) => c.setAttribute("aria-pressed", c === chip ? "true" : "false"));
              render();
            });
          });
        }

        function wireGridActions() {
          $("#grid").addEventListener("click", (e) => {
            const btn = e.target.closest("[data-action]");
            if (!btn) return;
            const action = btn.getAttribute("data-action");
            const card = e.target.closest(".card");
            if (!card) return;
            if (action === "copy") copyMessage(card);
          });
        }

        updateHeaderUser();
        wireDialogs();
        wireFilters();
        wireGridActions();
        render();

        // Tiny welcome toast (once per session).
        setTimeout(() => {
          toast("Tip: hit ‚ÄúWrite‚Äù to add your own note. Messages you post stay in your browser.");
        }, 520);
      })();
    </script>
  </body>
</html>
