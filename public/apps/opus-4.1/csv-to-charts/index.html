<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Visualization Playground</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Papa Parse for CSV parsing -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.5);
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        .chart-type-btn {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .chart-type-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .chart-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .color-picker-wrapper {
            position: relative;
            display: inline-block;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid #e2e8f0;
            transition: transform 0.2s;
        }

        .color-preview:hover {
            transform: scale(1.1);
        }

        input[type="color"] {
            position: absolute;
            visibility: hidden;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .data-table {
            max-height: 300px;
            overflow-y: auto;
        }

        .data-table::-webkit-scrollbar {
            width: 8px;
        }

        .data-table::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .data-table::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="min-h-screen p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-8 fade-in">
            <h1 class="text-5xl font-bold text-white mb-2">
                <i class="fas fa-chart-line mr-3"></i>Data Visualization Playground
            </h1>
            <p class="text-xl text-white/90">Transform your CSV data into beautiful, interactive charts</p>
        </header>

        <!-- Main Container -->
        <div class="max-w-7xl mx-auto">
            <!-- Upload Section -->
            <div id="uploadSection" class="glass-morphism p-8 mb-8 fade-in">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-upload mr-2"></i>Upload CSV File
                </h2>

                <div id="dropZone" class="upload-area">
                    <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-4"></i>
                    <p class="text-xl font-semibold text-gray-700 mb-2">Drop your CSV file here</p>
                    <p class="text-gray-600 mb-4">or</p>
                    <label for="csvFile" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg cursor-pointer hover:from-purple-600 hover:to-pink-600 transition-all inline-block">
                        <i class="fas fa-folder-open mr-2"></i>Browse Files
                    </label>
                    <input type="file" id="csvFile" accept=".csv" class="hidden">
                    <p class="text-sm text-gray-500 mt-4">Supported format: CSV</p>
                </div>

                <!-- Sample Data Button -->
                <div class="mt-4 text-center">
                    <button id="loadSampleData" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all">
                        <i class="fas fa-database mr-2"></i>Load Sample Data
                    </button>
                </div>
            </div>

            <!-- Visualization Section (Initially Hidden) -->
            <div id="vizSection" class="hidden">
                <!-- Data Preview -->
                <div class="glass-morphism p-6 mb-6 fade-in">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-table mr-2"></i>Data Preview
                    </h3>
                    <div class="data-table overflow-x-auto">
                        <table id="dataTable" class="w-full text-sm">
                            <thead id="tableHead" class="bg-gray-100 text-gray-700 font-semibold"></thead>
                            <tbody id="tableBody" class="text-gray-600"></tbody>
                        </table>
                    </div>
                    <p id="dataInfo" class="text-sm text-gray-500 mt-2"></p>
                </div>

                <!-- Controls Section -->
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <!-- Chart Type Selection -->
                    <div class="glass-morphism p-6 fade-in">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-chart-pie mr-2"></i>Chart Type
                        </h3>
                        <div class="grid grid-cols-3 gap-3">
                            <button data-chart="line" class="chart-type-btn p-3 rounded-lg bg-white hover:bg-gray-50 text-center">
                                <i class="fas fa-chart-line text-2xl mb-1"></i>
                                <p class="text-xs">Line</p>
                            </button>
                            <button data-chart="bar" class="chart-type-btn p-3 rounded-lg bg-white hover:bg-gray-50 text-center active">
                                <i class="fas fa-chart-bar text-2xl mb-1"></i>
                                <p class="text-xs">Bar</p>
                            </button>
                            <button data-chart="pie" class="chart-type-btn p-3 rounded-lg bg-white hover:bg-gray-50 text-center">
                                <i class="fas fa-chart-pie text-2xl mb-1"></i>
                                <p class="text-xs">Pie</p>
                            </button>
                            <button data-chart="doughnut" class="chart-type-btn p-3 rounded-lg bg-white hover:bg-gray-50 text-center">
                                <i class="fas fa-circle-notch text-2xl mb-1"></i>
                                <p class="text-xs">Doughnut</p>
                            </button>
                            <button data-chart="radar" class="chart-type-btn p-3 rounded-lg bg-white hover:bg-gray-50 text-center">
                                <i class="fas fa-spider text-2xl mb-1"></i>
                                <p class="text-xs">Radar</p>
                            </button>
                            <button data-chart="polarArea" class="chart-type-btn p-3 rounded-lg bg-white hover:bg-gray-50 text-center">
                                <i class="fas fa-bullseye text-2xl mb-1"></i>
                                <p class="text-xs">Polar</p>
                            </button>
                        </div>
                    </div>

                    <!-- Customization Options -->
                    <div class="glass-morphism p-6 fade-in">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-palette mr-2"></i>Customization
                        </h3>

                        <!-- Color Scheme -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Color Scheme</label>
                            <div class="flex gap-3">
                                <button data-scheme="default" class="px-3 py-1 rounded bg-gradient-to-r from-blue-500 to-purple-500 text-white text-sm">Default</button>
                                <button data-scheme="warm" class="px-3 py-1 rounded bg-gradient-to-r from-orange-500 to-red-500 text-white text-sm">Warm</button>
                                <button data-scheme="cool" class="px-3 py-1 rounded bg-gradient-to-r from-cyan-500 to-blue-500 text-white text-sm">Cool</button>
                                <button data-scheme="custom" class="px-3 py-1 rounded bg-gray-200 text-gray-700 text-sm">Custom</button>
                            </div>
                        </div>

                        <!-- Custom Colors -->
                        <div id="customColors" class="mb-4 hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Custom Colors</label>
                            <div class="flex gap-2" id="colorPickers"></div>
                        </div>

                        <!-- Axis Selection -->
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">X-Axis</label>
                                <select id="xAxis" class="w-full p-2 border border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"></select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Y-Axis</label>
                                <select id="yAxis" class="w-full p-2 border border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" multiple></select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chart Display -->
                <div class="glass-morphism p-6 mb-6 fade-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-chart-area mr-2"></i>Visualization
                        </h3>
                        <div class="flex gap-2">
                            <button id="refreshChart" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all tooltip">
                                <i class="fas fa-sync-alt"></i>
                                <span class="tooltiptext">Refresh Chart</span>
                            </button>
                            <button id="saveChart" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all tooltip">
                                <i class="fas fa-download"></i>
                                <span class="tooltiptext">Save as Image</span>
                            </button>
                            <button id="newData" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-all">
                                <i class="fas fa-plus mr-2"></i>New Data
                            </button>
                        </div>
                    </div>

                    <div class="relative bg-white p-4 rounded-lg" style="height: 500px;">
                        <canvas id="chartCanvas"></canvas>
                    </div>
                </div>

                <!-- Statistics Panel -->
                <div class="glass-morphism p-6 fade-in">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-calculator mr-2"></i>Quick Statistics
                    </h3>
                    <div id="statsPanel" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-8 text-white/80">
            <p>Built with <i class="fas fa-heart text-red-400"></i> for data enthusiasts</p>
        </footer>
    </div>

    <script>
        // Global variables
        let currentChart = null;
        let csvData = [];
        let headers = [];
        let currentChartType = 'bar';
        let currentColorScheme = 'default';

        // Color schemes
        const colorSchemes = {
            default: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b', '#38f9d7'],
            warm: ['#ff6b6b', '#feca57', '#ff9ff3', '#ff6348', '#ffa502', '#ff4757', '#ff6348', '#ff9ff3'],
            cool: ['#4834d4', '#686de0', '#30336b', '#22a6b3', '#0097e6', '#00d2d3', '#48dbfb', '#54a0ff'],
            custom: []
        };

        // Sample data
        const sampleData = `Month,Sales,Expenses,Profit,Customers
January,45000,32000,13000,120
February,52000,35000,17000,145
March,48000,31000,17000,132
April,61000,38000,23000,178
May,58000,36000,22000,165
June,67000,40000,27000,195
July,72000,42000,30000,210
August,69000,41000,28000,198
September,64000,39000,25000,185
October,71000,43000,28000,205
November,75000,44000,31000,220
December,82000,48000,34000,245`;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // File upload
            const fileInput = document.getElementById('csvFile');
            const dropZone = document.getElementById('dropZone');

            fileInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');

                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'text/csv') {
                    processFile(files[0]);
                }
            });

            // Sample data button
            document.getElementById('loadSampleData').addEventListener('click', () => {
                processCsvData(sampleData);
            });

            // Chart type buttons
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentChartType = this.dataset.chart;
                    updateChart();
                });
            });

            // Color scheme buttons
            document.querySelectorAll('[data-scheme]').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentColorScheme = this.dataset.scheme;
                    if (currentColorScheme === 'custom') {
                        document.getElementById('customColors').classList.remove('hidden');
                        setupColorPickers();
                    } else {
                        document.getElementById('customColors').classList.add('hidden');
                        updateChart();
                    }
                });
            });

            // Axis selectors
            document.getElementById('xAxis').addEventListener('change', updateChart);
            document.getElementById('yAxis').addEventListener('change', updateChart);

            // Action buttons
            document.getElementById('refreshChart').addEventListener('click', updateChart);
            document.getElementById('saveChart').addEventListener('click', saveChartAsImage);
            document.getElementById('newData').addEventListener('click', () => {
                document.getElementById('vizSection').classList.add('hidden');
                document.getElementById('uploadSection').classList.remove('hidden');
                if (currentChart) {
                    currentChart.destroy();
                    currentChart = null;
                }
            });
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file && file.type === 'text/csv') {
                processFile(file);
            }
        }

        function processFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                processCsvData(e.target.result);
            };
            reader.readAsText(file);
        }

        function processCsvData(csvText) {
            Papa.parse(csvText, {
                complete: function(results) {
                    if (results.data && results.data.length > 0) {
                        headers = results.data[0];
                        csvData = results.data.slice(1).filter(row => row.some(cell => cell !== ''));

                        displayDataPreview();
                        setupAxisSelectors();
                        showVisualizationSection();
                        updateChart();
                        displayStatistics();
                    }
                },
                skipEmptyLines: true
            });
        }

        function displayDataPreview() {
            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');

            // Clear existing content
            tableHead.innerHTML = '';
            tableBody.innerHTML = '';

            // Create header row
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.className = 'px-4 py-2 text-left';
                th.textContent = header;
                headerRow.appendChild(th);
            });
            tableHead.appendChild(headerRow);

            // Display first 5 rows
            const previewRows = csvData.slice(0, 5);
            previewRows.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-t border-gray-200';
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.className = 'px-4 py-2';
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });

            // Update data info
            document.getElementById('dataInfo').textContent =
                `Showing 5 of ${csvData.length} rows â€¢ ${headers.length} columns`;
        }

        function setupAxisSelectors() {
            const xAxisSelect = document.getElementById('xAxis');
            const yAxisSelect = document.getElementById('yAxis');

            // Clear existing options
            xAxisSelect.innerHTML = '';
            yAxisSelect.innerHTML = '';

            headers.forEach((header, index) => {
                // X-axis options
                const xOption = document.createElement('option');
                xOption.value = index;
                xOption.textContent = header;
                xAxisSelect.appendChild(xOption);

                // Y-axis options
                const yOption = document.createElement('option');
                yOption.value = index;
                yOption.textContent = header;

                // Auto-select numeric columns for Y-axis
                const isNumeric = csvData.some(row => !isNaN(parseFloat(row[index])));
                if (isNumeric && index > 0) {
                    yOption.selected = true;
                }

                yAxisSelect.appendChild(yOption);
            });
        }

        function setupColorPickers() {
            const colorPickersDiv = document.getElementById('colorPickers');
            colorPickersDiv.innerHTML = '';

            const selectedYIndices = Array.from(document.getElementById('yAxis').selectedOptions)
                .map(option => parseInt(option.value));

            selectedYIndices.forEach((index, i) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'color-picker-wrapper';

                const preview = document.createElement('div');
                preview.className = 'color-preview';
                preview.style.backgroundColor = colorSchemes.default[i % colorSchemes.default.length];

                const input = document.createElement('input');
                input.type = 'color';
                input.value = colorSchemes.default[i % colorSchemes.default.length];
                input.addEventListener('change', function() {
                    preview.style.backgroundColor = this.value;
                    updateCustomColors();
                });

                preview.addEventListener('click', () => input.click());

                wrapper.appendChild(preview);
                wrapper.appendChild(input);
                colorPickersDiv.appendChild(wrapper);
            });
        }

        function updateCustomColors() {
            const colorInputs = document.querySelectorAll('#colorPickers input[type="color"]');
            colorSchemes.custom = Array.from(colorInputs).map(input => input.value);
            updateChart();
        }

        function showVisualizationSection() {
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('vizSection').classList.remove('hidden');
        }

        function updateChart() {
            const xAxisIndex = parseInt(document.getElementById('xAxis').value);
            const selectedYIndices = Array.from(document.getElementById('yAxis').selectedOptions)
                .map(option => parseInt(option.value));

            if (selectedYIndices.length === 0) return;

            const labels = csvData.map(row => row[xAxisIndex]);
            const datasets = selectedYIndices.map((yIndex, i) => {
                const data = csvData.map(row => {
                    const value = parseFloat(row[yIndex]);
                    return isNaN(value) ? 0 : value;
                });

                const colors = colorSchemes[currentColorScheme];
                const color = colors[i % colors.length];

                return {
                    label: headers[yIndex],
                    data: data,
                    backgroundColor: currentChartType === 'line' || currentChartType === 'radar'
                        ? color + '33'
                        : color,
                    borderColor: color,
                    borderWidth: 2,
                    tension: 0.4
                };
            });

            const ctx = document.getElementById('chartCanvas').getContext('2d');

            if (currentChart) {
                currentChart.destroy();
            }

            const config = {
                type: currentChartType,
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Data Visualization',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            cornerRadius: 8,
                            titleFont: {
                                size: 14
                            },
                            bodyFont: {
                                size: 13
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            };

            // Adjust options for specific chart types
            if (currentChartType === 'pie' || currentChartType === 'doughnut' || currentChartType === 'polarArea') {
                config.options.scales = {};
            } else if (currentChartType !== 'radar') {
                config.options.scales = {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                };
            }

            currentChart = new Chart(ctx, config);
        }

        function displayStatistics() {
            const statsPanel = document.getElementById('statsPanel');
            statsPanel.innerHTML = '';

            const selectedYIndices = Array.from(document.getElementById('yAxis').selectedOptions)
                .map(option => parseInt(option.value));

            selectedYIndices.forEach(index => {
                const values = csvData.map(row => parseFloat(row[index])).filter(v => !isNaN(v));

                if (values.length > 0) {
                    const stats = {
                        name: headers[index],
                        min: Math.min(...values),
                        max: Math.max(...values),
                        avg: values.reduce((a, b) => a + b, 0) / values.length,
                        sum: values.reduce((a, b) => a + b, 0)
                    };

                    const statCard = document.createElement('div');
                    statCard.className = 'bg-white p-4 rounded-lg border border-gray-200';
                    statCard.innerHTML = `
                        <h4 class="font-semibold text-gray-700 mb-2">${stats.name}</h4>
                        <div class="space-y-1 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-500">Min:</span>
                                <span class="font-medium">${stats.min.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Max:</span>
                                <span class="font-medium">${stats.max.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Avg:</span>
                                <span class="font-medium">${stats.avg.toFixed(2).toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Sum:</span>
                                <span class="font-medium">${stats.sum.toLocaleString()}</span>
                            </div>
                        </div>
                    `;
                    statsPanel.appendChild(statCard);
                }
            });
        }

        function saveChartAsImage() {
            if (!currentChart) return;

            const link = document.createElement('a');
            link.download = `chart_${new Date().getTime()}.png`;
            link.href = currentChart.toBase64Image();
            link.click();
        }
    </script>
</body>
</html>