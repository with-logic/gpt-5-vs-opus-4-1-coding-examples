<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro - Focus & Energy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --accent: #ef4444;
            --accent-hover: #dc2626;
            --border: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #f87171;
            --accent-hover: #ef4444;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse-ring {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.5);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .bounce-in {
            animation: bounce-in 0.5s ease-out;
        }

        @keyframes bounce-in {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .slide-up {
            animation: slide-up 0.3s ease-out;
        }

        @keyframes slide-up {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .timer-progress {
            transition: stroke-dashoffset 1s linear;
        }

        .glow {
            filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.5));
        }

        .energy-bg {
            background: linear-gradient(135deg, var(--accent) 0%, rgba(239, 68, 68, 0.7) 100%);
        }

        .chart-bar {
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--accent-hover);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <div id="app" class="flex-1 flex flex-col">
        <!-- Header -->
        <header class="border-b border-gray-200 dark:border-gray-700 px-6 py-4">
            <div class="max-w-6xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-red-400 to-red-600 rounded-lg flex items-center justify-center shadow-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">
                        Pomodoro
                    </h1>
                </div>

                <div class="flex items-center space-x-4">
                    <button id="statsBtn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </button>
                    <button id="settingsBtn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </button>
                    <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 flex items-center justify-center p-6">
            <div class="w-full max-w-4xl">
                <!-- Timer Display -->
                <div class="text-center mb-8">
                    <div class="relative inline-block">
                        <svg class="w-64 h-64 transform -rotate-90">
                            <circle
                                cx="128"
                                cy="128"
                                r="120"
                                stroke="currentColor"
                                stroke-width="8"
                                fill="none"
                                class="text-gray-200 dark:text-gray-700"
                            />
                            <circle
                                id="progressCircle"
                                cx="128"
                                cy="128"
                                r="120"
                                stroke="url(#gradient)"
                                stroke-width="8"
                                fill="none"
                                stroke-linecap="round"
                                class="timer-progress"
                                style="stroke-dasharray: 753.982; stroke-dashoffset: 753.982;"
                            />
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#f97316;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <div id="timerDisplay" class="text-6xl font-bold tabular-nums">25:00</div>
                            <div id="sessionType" class="text-lg font-medium text-gray-500 dark:text-gray-400 mt-2">Focus Time</div>
                        </div>
                    </div>
                </div>

                <!-- Control Buttons -->
                <div class="flex items-center justify-center space-x-4 mb-8">
                    <button id="startBtn" class="px-8 py-4 bg-gradient-to-r from-red-500 to-orange-500 text-white rounded-full font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center space-x-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Start</span>
                    </button>

                    <button id="pauseBtn" class="hidden px-8 py-4 bg-gray-600 text-white rounded-full font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center space-x-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Pause</span>
                    </button>

                    <button id="resetBtn" class="px-6 py-4 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                    </button>

                    <button id="skipBtn" class="px-6 py-4 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>

                <!-- Quick Timer Presets -->
                <div class="flex items-center justify-center space-x-2 mb-6">
                    <button class="preset-btn px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-red-100 dark:hover:bg-red-900 transition-colors" data-minutes="25" data-type="focus">
                        Focus 25m
                    </button>
                    <button class="preset-btn px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-green-100 dark:hover:bg-green-900 transition-colors" data-minutes="5" data-type="short">
                        Short 5m
                    </button>
                    <button class="preset-btn px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors" data-minutes="15" data-type="long">
                        Long 15m
                    </button>
                </div>

                <!-- Session Info -->
                <div class="flex items-center justify-center space-x-8 text-sm">
                    <div class="flex items-center space-x-2">
                        <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"></path>
                        </svg>
                        <span>Today: <strong id="todayCount">0</strong> sessions</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"></path>
                        </svg>
                        <span>Streak: <strong id="streakCount">0</strong> days</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Settings Modal -->
        <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-6 slide-up">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">Settings</h2>
                    <button id="closeSettings" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Focus Duration (minutes)</label>
                        <input type="number" id="focusDuration" min="1" max="60" value="25" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Short Break (minutes)</label>
                        <input type="number" id="shortBreakDuration" min="1" max="30" value="5" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Long Break (minutes)</label>
                        <input type="number" id="longBreakDuration" min="1" max="60" value="15" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>

                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Auto-start next session</label>
                        <button id="autoStartToggle" class="relative inline-flex items-center h-6 rounded-full w-11 bg-gray-200 dark:bg-gray-700 transition-colors">
                            <span class="sr-only">Enable auto-start</span>
                            <span class="translate-x-1 inline-block w-4 h-4 transform bg-white rounded-full transition-transform"></span>
                        </button>
                    </div>

                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Sound alerts</label>
                        <button id="soundToggle" class="relative inline-flex items-center h-6 rounded-full w-11 bg-red-500 transition-colors">
                            <span class="sr-only">Enable sounds</span>
                            <span class="translate-x-6 inline-block w-4 h-4 transform bg-white rounded-full transition-transform"></span>
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Alert Volume</label>
                        <input type="range" id="volumeSlider" min="0" max="100" value="50" class="w-full">
                    </div>
                </div>

                <button id="saveSettings" class="mt-6 w-full px-4 py-3 bg-gradient-to-r from-red-500 to-orange-500 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200">
                    Save Settings
                </button>
            </div>
        </div>

        <!-- Statistics Modal -->
        <div id="statsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full p-6 slide-up max-h-[80vh] overflow-auto custom-scrollbar">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">Statistics</h2>
                    <button id="closeStats" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-red-500 to-orange-500 p-4 rounded-xl text-white">
                        <div class="text-3xl font-bold" id="totalSessions">0</div>
                        <div class="text-sm opacity-90">Total Sessions</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-purple-500 p-4 rounded-xl text-white">
                        <div class="text-3xl font-bold" id="totalHours">0h</div>
                        <div class="text-sm opacity-90">Total Focus Time</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-teal-500 p-4 rounded-xl text-white">
                        <div class="text-3xl font-bold" id="avgFocus">0m</div>
                        <div class="text-sm opacity-90">Average Session</div>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">Weekly Overview</h3>
                    <div class="bg-gray-50 dark:bg-gray-900 p-4 rounded-xl">
                        <svg id="weekChart" width="100%" height="200" viewBox="0 0 700 200">
                            <!-- Chart will be drawn here -->
                        </svg>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold mb-3">Recent Sessions</h3>
                    <div id="sessionsList" class="space-y-2">
                        <!-- Sessions will be listed here -->
                    </div>
                </div>

                <button id="clearData" class="mt-6 px-4 py-2 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 rounded-lg font-medium hover:bg-red-200 dark:hover:bg-red-800 transition-colors">
                    Clear All Data
                </button>
            </div>
        </div>
    </div>

    <script>
        // App State
        const app = {
            timer: null,
            timeLeft: 25 * 60,
            totalTime: 25 * 60,
            isRunning: false,
            isPaused: false,
            currentSession: 'focus',
            sessionCount: 0,
            settings: {
                focusDuration: 25,
                shortBreakDuration: 5,
                longBreakDuration: 15,
                autoStart: false,
                soundEnabled: true,
                volume: 50
            },
            sessions: [],
            audioContext: null
        };

        // Load settings and sessions from localStorage
        function loadData() {
            const savedSettings = localStorage.getItem('pomodoroSettings');
            if (savedSettings) {
                app.settings = JSON.parse(savedSettings);
                updateSettingsUI();
            }

            const savedSessions = localStorage.getItem('pomodoroSessions');
            if (savedSessions) {
                app.sessions = JSON.parse(savedSessions);
            }

            updateStats();
        }

        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('pomodoroSettings', JSON.stringify(app.settings));
        }

        // Save sessions to localStorage
        function saveSessions() {
            localStorage.setItem('pomodoroSessions', JSON.stringify(app.sessions));
            updateStats();
        }

        // Update settings UI
        function updateSettingsUI() {
            document.getElementById('focusDuration').value = app.settings.focusDuration;
            document.getElementById('shortBreakDuration').value = app.settings.shortBreakDuration;
            document.getElementById('longBreakDuration').value = app.settings.longBreakDuration;
            document.getElementById('volumeSlider').value = app.settings.volume;

            const autoStartToggle = document.getElementById('autoStartToggle');
            const autoStartSpan = autoStartToggle.querySelector('span:last-child');
            if (app.settings.autoStart) {
                autoStartToggle.classList.add('bg-red-500');
                autoStartToggle.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                autoStartSpan.classList.add('translate-x-6');
                autoStartSpan.classList.remove('translate-x-1');
            }

            const soundToggle = document.getElementById('soundToggle');
            const soundSpan = soundToggle.querySelector('span:last-child');
            if (!app.settings.soundEnabled) {
                soundToggle.classList.remove('bg-red-500');
                soundToggle.classList.add('bg-gray-200', 'dark:bg-gray-700');
                soundSpan.classList.remove('translate-x-6');
                soundSpan.classList.add('translate-x-1');
            }
        }

        // Format time display
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Update timer display
        function updateDisplay() {
            document.getElementById('timerDisplay').textContent = formatTime(app.timeLeft);

            // Update progress circle
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 120;
            const progress = (app.totalTime - app.timeLeft) / app.totalTime;
            const offset = circumference - (progress * circumference);
            circle.style.strokeDashoffset = offset;

            // Update session type display
            const sessionType = document.getElementById('sessionType');
            if (app.currentSession === 'focus') {
                sessionType.textContent = 'Focus Time';
                sessionType.className = 'text-lg font-medium text-red-500';
            } else if (app.currentSession === 'short') {
                sessionType.textContent = 'Short Break';
                sessionType.className = 'text-lg font-medium text-green-500';
            } else {
                sessionType.textContent = 'Long Break';
                sessionType.className = 'text-lg font-medium text-blue-500';
            }
        }

        // Play sound alert
        function playSound() {
            if (!app.settings.soundEnabled) return;

            if (!app.audioContext) {
                app.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            const volume = app.settings.volume / 100;
            const duration = 0.3;
            const frequency = 800;

            const oscillator = app.audioContext.createOscillator();
            const gainNode = app.audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(app.audioContext.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0, app.audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume * 0.3, app.audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, app.audioContext.currentTime + duration);

            oscillator.start(app.audioContext.currentTime);
            oscillator.stop(app.audioContext.currentTime + duration);

            // Play three beeps
            setTimeout(() => {
                const osc2 = app.audioContext.createOscillator();
                const gain2 = app.audioContext.createGain();
                osc2.connect(gain2);
                gain2.connect(app.audioContext.destination);
                osc2.frequency.value = frequency;
                osc2.type = 'sine';
                gain2.gain.setValueAtTime(0, app.audioContext.currentTime);
                gain2.gain.linearRampToValueAtTime(volume * 0.3, app.audioContext.currentTime + 0.01);
                gain2.gain.exponentialRampToValueAtTime(0.01, app.audioContext.currentTime + duration);
                osc2.start(app.audioContext.currentTime);
                osc2.stop(app.audioContext.currentTime + duration);
            }, 400);

            setTimeout(() => {
                const osc3 = app.audioContext.createOscillator();
                const gain3 = app.audioContext.createGain();
                osc3.connect(gain3);
                gain3.connect(app.audioContext.destination);
                osc3.frequency.value = frequency * 1.25;
                osc3.type = 'sine';
                gain3.gain.setValueAtTime(0, app.audioContext.currentTime);
                gain3.gain.linearRampToValueAtTime(volume * 0.4, app.audioContext.currentTime + 0.01);
                gain3.gain.exponentialRampToValueAtTime(0.01, app.audioContext.currentTime + duration * 1.5);
                osc3.start(app.audioContext.currentTime);
                osc3.stop(app.audioContext.currentTime + duration * 1.5);
            }, 800);
        }

        // Start timer
        function startTimer() {
            if (app.isRunning && !app.isPaused) return;

            app.isRunning = true;
            app.isPaused = false;

            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('pauseBtn').classList.remove('hidden');

            app.timer = setInterval(() => {
                if (app.timeLeft > 0) {
                    app.timeLeft--;
                    updateDisplay();
                } else {
                    completeSession();
                }
            }, 1000);
        }

        // Pause timer
        function pauseTimer() {
            if (!app.isRunning) return;

            app.isPaused = true;
            clearInterval(app.timer);

            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
        }

        // Reset timer
        function resetTimer() {
            clearInterval(app.timer);
            app.isRunning = false;
            app.isPaused = false;

            if (app.currentSession === 'focus') {
                app.timeLeft = app.settings.focusDuration * 60;
                app.totalTime = app.settings.focusDuration * 60;
            } else if (app.currentSession === 'short') {
                app.timeLeft = app.settings.shortBreakDuration * 60;
                app.totalTime = app.settings.shortBreakDuration * 60;
            } else {
                app.timeLeft = app.settings.longBreakDuration * 60;
                app.totalTime = app.settings.longBreakDuration * 60;
            }

            updateDisplay();

            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
        }

        // Skip current session
        function skipSession() {
            clearInterval(app.timer);
            completeSession();
        }

        // Complete session
        function completeSession() {
            clearInterval(app.timer);
            app.isRunning = false;
            app.isPaused = false;

            playSound();

            // Save session
            if (app.currentSession === 'focus') {
                const session = {
                    type: 'focus',
                    duration: app.settings.focusDuration,
                    completedAt: new Date().toISOString()
                };
                app.sessions.push(session);
                saveSessions();
                app.sessionCount++;

                // Show notification
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('Focus session complete!', {
                        body: 'Great work! Time for a break.',
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23ef4444"/></svg>'
                    });
                }
            }

            // Switch session type
            if (app.currentSession === 'focus') {
                if (app.sessionCount % 4 === 0) {
                    app.currentSession = 'long';
                    app.timeLeft = app.settings.longBreakDuration * 60;
                    app.totalTime = app.settings.longBreakDuration * 60;
                } else {
                    app.currentSession = 'short';
                    app.timeLeft = app.settings.shortBreakDuration * 60;
                    app.totalTime = app.settings.shortBreakDuration * 60;
                }
            } else {
                app.currentSession = 'focus';
                app.timeLeft = app.settings.focusDuration * 60;
                app.totalTime = app.settings.focusDuration * 60;
            }

            updateDisplay();
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');

            // Auto-start next session if enabled
            if (app.settings.autoStart) {
                setTimeout(() => startTimer(), 1000);
            }
        }

        // Update statistics
        function updateStats() {
            const today = new Date().toDateString();
            const todaySessions = app.sessions.filter(s =>
                new Date(s.completedAt).toDateString() === today
            );
            document.getElementById('todayCount').textContent = todaySessions.length;

            // Calculate streak
            let streak = 0;
            const days = {};
            app.sessions.forEach(s => {
                const day = new Date(s.completedAt).toDateString();
                days[day] = true;
            });

            const sortedDays = Object.keys(days).sort((a, b) => new Date(b) - new Date(a));
            const currentDate = new Date();

            for (let i = 0; i < sortedDays.length; i++) {
                const checkDate = new Date(currentDate);
                checkDate.setDate(checkDate.getDate() - i);
                if (days[checkDate.toDateString()]) {
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }

            document.getElementById('streakCount').textContent = streak;

            // Update modal stats
            document.getElementById('totalSessions').textContent = app.sessions.filter(s => s.type === 'focus').length;

            const totalMinutes = app.sessions
                .filter(s => s.type === 'focus')
                .reduce((acc, s) => acc + s.duration, 0);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            document.getElementById('totalHours').textContent = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;

            const avgMinutes = app.sessions.length > 0
                ? Math.round(totalMinutes / app.sessions.filter(s => s.type === 'focus').length)
                : 0;
            document.getElementById('avgFocus').textContent = `${avgMinutes}m`;

            // Update weekly chart
            updateWeekChart();

            // Update sessions list
            updateSessionsList();
        }

        // Update weekly chart
        function updateWeekChart() {
            const chart = document.getElementById('weekChart');
            chart.innerHTML = '';

            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const weekData = new Array(7).fill(0);

            const today = new Date();
            const currentDay = today.getDay();

            app.sessions.forEach(s => {
                const sessionDate = new Date(s.completedAt);
                const daysDiff = Math.floor((today - sessionDate) / (1000 * 60 * 60 * 24));

                if (daysDiff < 7 && s.type === 'focus') {
                    const dayIndex = sessionDate.getDay();
                    weekData[dayIndex]++;
                }
            });

            const maxValue = Math.max(...weekData, 1);
            const barWidth = 80;
            const barSpacing = 20;

            days.forEach((day, i) => {
                const x = i * (barWidth + barSpacing) + 50;
                const height = (weekData[i] / maxValue) * 140;
                const y = 160 - height;

                // Bar
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', barWidth);
                rect.setAttribute('height', height);
                rect.setAttribute('rx', '8');
                rect.setAttribute('class', 'chart-bar');

                if (i === currentDay) {
                    rect.setAttribute('fill', 'url(#barGradient)');
                } else {
                    rect.setAttribute('fill', '#e5e7eb');
                    rect.setAttribute('class', 'chart-bar hover:fill-gray-400 dark:fill-gray-600 dark:hover:fill-gray-500');
                }

                chart.appendChild(rect);

                // Day label
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x + barWidth / 2);
                text.setAttribute('y', '185');
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('class', 'fill-current text-xs');
                text.textContent = day;
                chart.appendChild(text);

                // Value label
                if (weekData[i] > 0) {
                    const valueText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    valueText.setAttribute('x', x + barWidth / 2);
                    valueText.setAttribute('y', y - 5);
                    valueText.setAttribute('text-anchor', 'middle');
                    valueText.setAttribute('class', 'fill-current text-xs font-semibold');
                    valueText.textContent = weekData[i];
                    chart.appendChild(valueText);
                }
            });

            // Add gradient definition
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            gradient.setAttribute('id', 'barGradient');
            gradient.setAttribute('x1', '0%');
            gradient.setAttribute('y1', '0%');
            gradient.setAttribute('x2', '0%');
            gradient.setAttribute('y2', '100%');

            const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop1.setAttribute('offset', '0%');
            stop1.setAttribute('style', 'stop-color:#ef4444;stop-opacity:1');

            const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop2.setAttribute('offset', '100%');
            stop2.setAttribute('style', 'stop-color:#f97316;stop-opacity:1');

            gradient.appendChild(stop1);
            gradient.appendChild(stop2);
            defs.appendChild(gradient);
            chart.appendChild(defs);
        }

        // Update sessions list
        function updateSessionsList() {
            const list = document.getElementById('sessionsList');
            list.innerHTML = '';

            const recentSessions = app.sessions
                .filter(s => s.type === 'focus')
                .slice(-10)
                .reverse();

            if (recentSessions.length === 0) {
                list.innerHTML = '<div class="text-gray-500 dark:text-gray-400 text-center py-4">No sessions yet. Start focusing!</div>';
                return;
            }

            recentSessions.forEach(session => {
                const date = new Date(session.completedAt);
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900 rounded-lg';

                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                        <div>
                            <div class="font-medium">${session.duration} minutes</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">
                                ${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                            </div>
                        </div>
                    </div>
                `;

                list.appendChild(div);
            });
        }

        // Event Listeners
        document.getElementById('startBtn').addEventListener('click', startTimer);
        document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
        document.getElementById('resetBtn').addEventListener('click', resetTimer);
        document.getElementById('skipBtn').addEventListener('click', skipSession);

        // Preset buttons
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const minutes = parseInt(e.target.dataset.minutes);
                const type = e.target.dataset.type;

                clearInterval(app.timer);
                app.isRunning = false;
                app.isPaused = false;

                app.currentSession = type;
                app.timeLeft = minutes * 60;
                app.totalTime = minutes * 60;

                updateDisplay();

                document.getElementById('startBtn').classList.remove('hidden');
                document.getElementById('pauseBtn').classList.add('hidden');
            });
        });

        // Settings modal
        document.getElementById('settingsBtn').addEventListener('click', () => {
            document.getElementById('settingsModal').classList.remove('hidden');
        });

        document.getElementById('closeSettings').addEventListener('click', () => {
            document.getElementById('settingsModal').classList.add('hidden');
        });

        document.getElementById('saveSettings').addEventListener('click', () => {
            app.settings.focusDuration = parseInt(document.getElementById('focusDuration').value);
            app.settings.shortBreakDuration = parseInt(document.getElementById('shortBreakDuration').value);
            app.settings.longBreakDuration = parseInt(document.getElementById('longBreakDuration').value);
            app.settings.volume = parseInt(document.getElementById('volumeSlider').value);

            saveSettings();
            resetTimer();

            document.getElementById('settingsModal').classList.add('hidden');
        });

        // Toggle switches
        document.getElementById('autoStartToggle').addEventListener('click', (e) => {
            app.settings.autoStart = !app.settings.autoStart;
            const span = e.currentTarget.querySelector('span:last-child');

            if (app.settings.autoStart) {
                e.currentTarget.classList.add('bg-red-500');
                e.currentTarget.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                span.classList.add('translate-x-6');
                span.classList.remove('translate-x-1');
            } else {
                e.currentTarget.classList.remove('bg-red-500');
                e.currentTarget.classList.add('bg-gray-200', 'dark:bg-gray-700');
                span.classList.remove('translate-x-6');
                span.classList.add('translate-x-1');
            }
        });

        document.getElementById('soundToggle').addEventListener('click', (e) => {
            app.settings.soundEnabled = !app.settings.soundEnabled;
            const span = e.currentTarget.querySelector('span:last-child');

            if (app.settings.soundEnabled) {
                e.currentTarget.classList.add('bg-red-500');
                e.currentTarget.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                span.classList.add('translate-x-6');
                span.classList.remove('translate-x-1');
            } else {
                e.currentTarget.classList.remove('bg-red-500');
                e.currentTarget.classList.add('bg-gray-200', 'dark:bg-gray-700');
                span.classList.remove('translate-x-6');
                span.classList.add('translate-x-1');
            }
        });

        // Stats modal
        document.getElementById('statsBtn').addEventListener('click', () => {
            updateStats();
            document.getElementById('statsModal').classList.remove('hidden');
        });

        document.getElementById('closeStats').addEventListener('click', () => {
            document.getElementById('statsModal').classList.add('hidden');
        });

        document.getElementById('clearData').addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all session data? This cannot be undone.')) {
                app.sessions = [];
                saveSessions();
                updateStats();
            }
        });

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            const html = document.documentElement;
            if (html.hasAttribute('data-theme')) {
                html.removeAttribute('data-theme');
                localStorage.removeItem('theme');
            } else {
                html.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                e.preventDefault();
                if (app.isRunning && !app.isPaused) {
                    pauseTimer();
                } else {
                    startTimer();
                }
            } else if (e.code === 'KeyR' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                resetTimer();
            } else if (e.code === 'KeyS' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                skipSession();
            }
        });

        // Initialize
        window.addEventListener('load', () => {
            // Check for saved theme
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }

            // Load data
            loadData();

            // Set initial timer
            resetTimer();

            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });

        // Close modals when clicking outside
        document.getElementById('settingsModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                e.currentTarget.classList.add('hidden');
            }
        });

        document.getElementById('statsModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                e.currentTarget.classList.add('hidden');
            }
        });
    </script>
</body>
</html>