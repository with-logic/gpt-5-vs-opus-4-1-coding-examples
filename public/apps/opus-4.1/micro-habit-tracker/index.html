<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Habit Tracker - Build Your Best Self</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f97316;
            --bg: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --gradient-start: #6366f1;
            --gradient-end: #8b5cf6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, #1a1f3a 100%);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(236, 72, 153, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            position: relative;
        }

        h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 800;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .tagline {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 300;
        }

        .quote {
            margin-top: 20px;
            padding: 20px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            font-style: italic;
            color: var(--text);
            backdrop-filter: blur(10px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
        }

        button.secondary {
            background: var(--bg-tertiary);
        }

        button.danger {
            background: var(--danger);
        }

        .habits-container {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .habit-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .habit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .habit-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .habit-emoji {
            font-size: 1.5rem;
        }

        .habit-streak {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 20px;
            font-weight: 600;
        }

        .streak-fire {
            font-size: 1.2rem;
            animation: flame 1s ease-in-out infinite;
        }

        @keyframes flame {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(-5deg); }
            75% { transform: scale(1.05) rotate(5deg); }
        }

        .habit-actions {
            display: flex;
            gap: 10px;
        }

        .habit-actions button {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .day-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .day-cell::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .day-cell:hover::before {
            width: 100%;
            height: 100%;
        }

        .day-cell.completed {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-color: var(--primary);
            animation: pulse 0.5s ease;
        }

        .day-cell.skipped {
            background: rgba(249, 115, 22, 0.2);
            border-color: var(--warning);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .day-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .day-date {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .day-cell.completed .day-date {
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal h2 {
            margin-bottom: 20px;
            color: var(--text);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .emoji-option {
            font-size: 1.5rem;
            padding: 10px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .emoji-option:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .emoji-option.selected {
            background: var(--primary);
            border-color: var(--primary-light);
        }

        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
        }

        .chart-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text);
        }

        .progress-bars {
            display: grid;
            gap: 15px;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .progress-label {
            min-width: 150px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-bar {
            flex: 1;
            height: 30px;
            background: var(--bg);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .days-grid {
                gap: 5px;
            }

            .day-cell {
                font-size: 0.8rem;
            }

            .habit-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .modal-content {
                padding: 20px;
            }

            .emoji-picker {
                grid-template-columns: repeat(6, 1fr);
            }

            .progress-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .progress-label {
                min-width: auto;
            }
        }

        .sparkle {
            position: fixed;
            pointer-events: none;
            animation: sparkle 1s ease-out forwards;
            z-index: 9999;
        }

        @keyframes sparkle {
            0% {
                transform: translate(0, 0) scale(0);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(1);
                opacity: 0;
            }
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            animation: celebrate 1s ease-out forwards;
            z-index: 9999;
            pointer-events: none;
        }

        @keyframes celebrate {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Micro Habit Tracker</h1>
            <p class="tagline">Small steps, extraordinary results</p>
            <div class="quote" id="dailyQuote"></div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalHabits">0</div>
                <div class="stat-label">Active Habits</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completedToday">0</div>
                <div class="stat-label">Completed Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-label">Best Streak üî•</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completionRate">0%</div>
                <div class="stat-label">This Week</div>
            </div>
        </div>

        <div class="controls">
            <button onclick="openAddHabitModal()">‚ûï Add New Habit</button>
            <button class="secondary" onclick="exportData()">üì• Export Data</button>
            <button class="secondary" onclick="document.getElementById('importFile').click()">üì§ Import Data</button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        </div>

        <div class="habits-container" id="habitsContainer"></div>

        <div class="chart-container">
            <h3 class="chart-title">üìä Weekly Progress</h3>
            <div class="progress-bars" id="progressBars"></div>
        </div>
    </div>

    <div class="modal" id="habitModal">
        <div class="modal-content">
            <h2 id="modalTitle">Add New Habit</h2>
            <form id="habitForm" onsubmit="saveHabit(event)">
                <div class="form-group">
                    <label for="habitName">Habit Name</label>
                    <input type="text" id="habitName" required maxlength="50" placeholder="e.g., Drink 8 glasses of water">
                </div>
                <div class="form-group">
                    <label for="habitEmoji">Choose an Emoji</label>
                    <div class="emoji-picker" id="emojiPicker"></div>
                    <input type="hidden" id="selectedEmoji" value="‚ú®">
                </div>
                <div class="form-group">
                    <label for="habitGoal">Daily Goal (optional)</label>
                    <input type="text" id="habitGoal" placeholder="e.g., 30 minutes, 10 pages">
                </div>
                <div class="form-group">
                    <label for="habitColor">Color Theme</label>
                    <select id="habitColor">
                        <option value="gradient">Purple Gradient (Default)</option>
                        <option value="blue">Ocean Blue</option>
                        <option value="green">Forest Green</option>
                        <option value="orange">Sunset Orange</option>
                        <option value="pink">Rose Pink</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit">Save Habit</button>
                    <button type="button" class="secondary" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Inspirational quotes
        const quotes = [
            "The secret of getting ahead is getting started. - Mark Twain",
            "Success is the sum of small efforts repeated day in and day out. - Robert Collier",
            "Excellence is not a singular act, but a habit. - Aristotle",
            "We are what we repeatedly do. - Will Durant",
            "The journey of a thousand miles begins with one step. - Lao Tzu",
            "Don't watch the clock; do what it does. Keep going. - Sam Levenson",
            "The only way to do great work is to love what you do. - Steve Jobs",
            "Believe you can and you're halfway there. - Theodore Roosevelt",
            "Success is not final, failure is not fatal: It is the courage to continue that counts. - Winston Churchill",
            "Your limitation‚Äîit's only your imagination.",
            "Great things never come from comfort zones.",
            "Dream it. Wish it. Do it.",
            "Success doesn't just find you. You have to go out and get it.",
            "The harder you work for something, the greater you'll feel when you achieve it.",
            "Dream bigger. Do bigger.",
            "Don't stop when you're tired. Stop when you're done.",
            "Little things make big days.",
            "It's going to be hard, but hard does not mean impossible.",
            "Don't wait for opportunity. Create it.",
            "Sometimes we're tested not to show our weaknesses, but to discover our strengths."
        ];

        // Emojis for habit selection
        const availableEmojis = ['üí™', 'üìö', 'üèÉ', 'üíß', 'üßò', '‚úçÔ∏è', 'üéØ', 'üå±', 'üé®', 'üéµ', 'üíª', 'üçé', 'üò¥', 'üö∂', 'üìñ', 'üß†', '‚ù§Ô∏è', '‚òÄÔ∏è', 'üåô', '‚≠ê', 'üî•', 'üíé', 'üöÄ', 'üåü'];

        // App state
        let habits = [];
        let currentEditId = null;

        // Initialize app
        function init() {
            loadData();
            updateDailyQuote();
            renderHabits();
            updateStats();
            renderProgressChart();
            setupEmojiPicker();

            // Add sparkle effect on click
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('day-cell')) {
                    createSparkle(e.pageX, e.pageY);
                }
            });
        }

        // Load data from localStorage or use demo data
        function loadData() {
            const savedData = localStorage.getItem('microHabits');
            if (savedData) {
                habits = JSON.parse(savedData);
            } else {
                // Demo data
                const today = new Date();
                habits = [
                    {
                        id: Date.now() - 10000,
                        name: 'Drink Water',
                        emoji: 'üíß',
                        goal: '8 glasses',
                        color: 'blue',
                        createdAt: new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                        completedDates: generateDemoCompletions(7, 0.8),
                        skippedDates: []
                    },
                    {
                        id: Date.now() - 5000,
                        name: 'Morning Meditation',
                        emoji: 'üßò',
                        goal: '10 minutes',
                        color: 'gradient',
                        createdAt: new Date(today.getTime() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                        completedDates: generateDemoCompletions(5, 0.6),
                        skippedDates: [formatDate(new Date(today.getTime() - 2 * 24 * 60 * 60 * 1000))]
                    },
                    {
                        id: Date.now(),
                        name: 'Read Before Bed',
                        emoji: 'üìö',
                        goal: '20 pages',
                        color: 'green',
                        createdAt: new Date(today.getTime() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                        completedDates: generateDemoCompletions(3, 0.7),
                        skippedDates: []
                    }
                ];
                saveData();
            }
        }

        // Generate demo completion data
        function generateDemoCompletions(days, probability) {
            const completions = [];
            const today = new Date();
            for (let i = days - 1; i >= 0; i--) {
                if (Math.random() < probability) {
                    const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                    completions.push(formatDate(date));
                }
            }
            return completions;
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('microHabits', JSON.stringify(habits));
        }

        // Format date as YYYY-MM-DD
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        // Update daily quote
        function updateDailyQuote() {
            const quoteEl = document.getElementById('dailyQuote');
            const today = new Date().getDate();
            const quoteIndex = today % quotes.length;
            quoteEl.textContent = `"${quotes[quoteIndex]}"`;
        }

        // Setup emoji picker
        function setupEmojiPicker() {
            const picker = document.getElementById('emojiPicker');
            picker.innerHTML = '';
            availableEmojis.forEach(emoji => {
                const option = document.createElement('div');
                option.className = 'emoji-option';
                option.textContent = emoji;
                option.onclick = () => selectEmoji(emoji);
                picker.appendChild(option);
            });
        }

        // Select emoji
        function selectEmoji(emoji) {
            document.getElementById('selectedEmoji').value = emoji;
            document.querySelectorAll('.emoji-option').forEach(opt => {
                opt.classList.toggle('selected', opt.textContent === emoji);
            });
        }

        // Open add habit modal
        function openAddHabitModal() {
            if (habits.length >= 7) {
                alert('You can track up to 7 habits at a time. Consider removing a habit first.');
                return;
            }
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Add New Habit';
            document.getElementById('habitForm').reset();
            document.getElementById('selectedEmoji').value = '‚ú®';
            setupEmojiPicker();
            selectEmoji('‚ú®');
            document.getElementById('habitModal').classList.add('active');
        }

        // Open edit habit modal
        function editHabit(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;

            currentEditId = id;
            document.getElementById('modalTitle').textContent = 'Edit Habit';
            document.getElementById('habitName').value = habit.name;
            document.getElementById('habitGoal').value = habit.goal || '';
            document.getElementById('habitColor').value = habit.color || 'gradient';
            document.getElementById('selectedEmoji').value = habit.emoji;
            setupEmojiPicker();
            selectEmoji(habit.emoji);
            document.getElementById('habitModal').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('habitModal').classList.remove('active');
            currentEditId = null;
        }

        // Save habit
        function saveHabit(event) {
            event.preventDefault();

            const name = document.getElementById('habitName').value.trim();
            const emoji = document.getElementById('selectedEmoji').value;
            const goal = document.getElementById('habitGoal').value.trim();
            const color = document.getElementById('habitColor').value;

            if (currentEditId) {
                const habit = habits.find(h => h.id === currentEditId);
                habit.name = name;
                habit.emoji = emoji;
                habit.goal = goal;
                habit.color = color;
            } else {
                habits.push({
                    id: Date.now(),
                    name,
                    emoji,
                    goal,
                    color,
                    createdAt: new Date().toISOString(),
                    completedDates: [],
                    skippedDates: []
                });
            }

            saveData();
            renderHabits();
            updateStats();
            renderProgressChart();
            closeModal();
        }

        // Delete habit
        function deleteHabit(id) {
            if (confirm('Are you sure you want to delete this habit? This action cannot be undone.')) {
                habits = habits.filter(h => h.id !== id);
                saveData();
                renderHabits();
                updateStats();
                renderProgressChart();
            }
        }

        // Toggle day completion
        function toggleDay(habitId, date) {
            const habit = habits.find(h => h.id === habitId);
            if (!habit) return;

            const dateStr = formatDate(date);
            const completedIndex = habit.completedDates.indexOf(dateStr);
            const skippedIndex = habit.skippedDates.indexOf(dateStr);

            if (completedIndex > -1) {
                // Currently completed -> mark as skipped
                habit.completedDates.splice(completedIndex, 1);
                habit.skippedDates.push(dateStr);
            } else if (skippedIndex > -1) {
                // Currently skipped -> mark as not done
                habit.skippedDates.splice(skippedIndex, 1);
            } else {
                // Not done -> mark as completed
                habit.completedDates.push(dateStr);

                // Check if this completes all habits for today
                const today = formatDate(new Date());
                if (dateStr === today) {
                    const allCompleted = habits.every(h =>
                        h.completedDates.includes(today) || h.skippedDates.includes(today)
                    );
                    if (allCompleted) {
                        celebrate();
                    }
                }
            }

            saveData();
            renderHabits();
            updateStats();
            renderProgressChart();
        }

        // Skip a day
        function skipDay(habitId, date) {
            const habit = habits.find(h => h.id === habitId);
            if (!habit) return;

            const dateStr = formatDate(date);
            if (!habit.skippedDates.includes(dateStr)) {
                habit.skippedDates.push(dateStr);
                // Remove from completed if present
                const completedIndex = habit.completedDates.indexOf(dateStr);
                if (completedIndex > -1) {
                    habit.completedDates.splice(completedIndex, 1);
                }
            }

            saveData();
            renderHabits();
            updateStats();
        }

        // Calculate streak
        function calculateStreak(habit) {
            if (!habit.completedDates.length) return 0;

            const sortedDates = [...habit.completedDates].sort();
            let currentStreak = 0;
            let maxStreak = 0;
            let lastDate = null;

            sortedDates.forEach(dateStr => {
                const date = new Date(dateStr);
                if (lastDate) {
                    const daysDiff = Math.floor((date - lastDate) / (24 * 60 * 60 * 1000));

                    // Check for skipped days in between
                    let hasSkippedDays = false;
                    for (let i = 1; i < daysDiff; i++) {
                        const checkDate = new Date(lastDate);
                        checkDate.setDate(checkDate.getDate() + i);
                        const checkDateStr = formatDate(checkDate);
                        if (!habit.skippedDates.includes(checkDateStr)) {
                            hasSkippedDays = false;
                            break;
                        }
                    }

                    if (daysDiff === 1 || (daysDiff > 1 && !hasSkippedDays)) {
                        currentStreak++;
                    } else {
                        currentStreak = 1;
                    }
                } else {
                    currentStreak = 1;
                }
                maxStreak = Math.max(maxStreak, currentStreak);
                lastDate = date;
            });

            // Check if streak is still active (includes today or yesterday, accounting for skips)
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const todayStr = formatDate(today);
            const yesterdayStr = formatDate(yesterday);

            if (!habit.completedDates.includes(todayStr) &&
                !habit.completedDates.includes(yesterdayStr) &&
                !habit.skippedDates.includes(todayStr)) {
                return 0; // Streak broken
            }

            return currentStreak;
        }

        // Get color styles based on habit color
        function getColorStyles(color) {
            const colors = {
                gradient: { bg: 'linear-gradient(135deg, #6366f1, #8b5cf6)', border: '#6366f1' },
                blue: { bg: 'linear-gradient(135deg, #3b82f6, #06b6d4)', border: '#3b82f6' },
                green: { bg: 'linear-gradient(135deg, #10b981, #22c55e)', border: '#10b981' },
                orange: { bg: 'linear-gradient(135deg, #f97316, #f59e0b)', border: '#f97316' },
                pink: { bg: 'linear-gradient(135deg, #ec4899, #f43f5e)', border: '#ec4899' }
            };
            return colors[color] || colors.gradient;
        }

        // Render habits
        function renderHabits() {
            const container = document.getElementById('habitsContainer');
            container.innerHTML = '';

            habits.forEach(habit => {
                const card = document.createElement('div');
                card.className = 'habit-card';

                const streak = calculateStreak(habit);
                const colorStyles = getColorStyles(habit.color);

                // Generate last 7 days
                const days = [];
                const today = new Date();
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    days.push(date);
                }

                card.innerHTML = `
                    <div class="habit-header">
                        <div class="habit-title">
                            <span class="habit-emoji">${habit.emoji}</span>
                            <span>${habit.name}</span>
                            ${habit.goal ? `<span style="color: var(--text-secondary); font-size: 0.9rem;">(${habit.goal})</span>` : ''}
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            ${streak > 0 ? `<div class="habit-streak"><span class="streak-fire">üî•</span> ${streak} days</div>` : ''}
                            <div class="habit-actions">
                                <button onclick="editHabit(${habit.id})">‚úèÔ∏è</button>
                                <button class="danger" onclick="deleteHabit(${habit.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    <div class="days-grid">
                        ${days.map(date => {
                            const dateStr = formatDate(date);
                            const isCompleted = habit.completedDates.includes(dateStr);
                            const isSkipped = habit.skippedDates.includes(dateStr);
                            const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                            const dayNum = date.getDate();

                            return `
                                <div class="day-cell ${isCompleted ? 'completed' : ''} ${isSkipped ? 'skipped' : ''}"
                                     onclick="toggleDay(${habit.id}, new Date('${dateStr}'))"
                                     style="${isCompleted ? `background: ${colorStyles.bg}; border-color: ${colorStyles.border};` : ''}">
                                    <div class="day-label">${dayName}</div>
                                    <div class="day-date">${isCompleted ? '‚úì' : isSkipped ? '‚àí' : dayNum}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Update statistics
        function updateStats() {
            const today = formatDate(new Date());

            // Total habits
            document.getElementById('totalHabits').textContent = habits.length;

            // Completed today
            const completedToday = habits.filter(h =>
                h.completedDates.includes(today)
            ).length;
            document.getElementById('completedToday').textContent = completedToday;

            // Best streak
            const bestStreak = Math.max(0, ...habits.map(h => calculateStreak(h)));
            document.getElementById('currentStreak').textContent = bestStreak;

            // Weekly completion rate
            const weekDates = [];
            const todayDate = new Date();
            for (let i = 6; i >= 0; i--) {
                const date = new Date(todayDate);
                date.setDate(date.getDate() - i);
                weekDates.push(formatDate(date));
            }

            let totalPossible = 0;
            let totalCompleted = 0;

            habits.forEach(habit => {
                const createdDate = new Date(habit.createdAt);
                weekDates.forEach(dateStr => {
                    const date = new Date(dateStr);
                    if (date >= createdDate) {
                        totalPossible++;
                        if (habit.completedDates.includes(dateStr) || habit.skippedDates.includes(dateStr)) {
                            totalCompleted++;
                        }
                    }
                });
            });

            const completionRate = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
        }

        // Render progress chart
        function renderProgressChart() {
            const container = document.getElementById('progressBars');
            container.innerHTML = '';

            habits.forEach(habit => {
                const weekDates = [];
                const today = new Date();
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    weekDates.push(formatDate(date));
                }

                const completed = weekDates.filter(date => habit.completedDates.includes(date)).length;
                const percentage = Math.round((completed / 7) * 100);
                const colorStyles = getColorStyles(habit.color);

                const item = document.createElement('div');
                item.className = 'progress-item';
                item.innerHTML = `
                    <div class="progress-label">
                        <span>${habit.emoji}</span>
                        <span>${habit.name}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%; background: ${colorStyles.bg};">
                            ${completed}/7 days
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(habits, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `micro-habits-${formatDate(new Date())}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Import data
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedHabits = JSON.parse(e.target.result);
                    if (Array.isArray(importedHabits)) {
                        habits = importedHabits;
                        saveData();
                        renderHabits();
                        updateStats();
                        renderProgressChart();
                        alert('Data imported successfully!');
                    } else {
                        alert('Invalid data format. Please select a valid JSON file.');
                    }
                } catch (error) {
                    alert('Error importing data. Please check the file format.');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Reset file input
        }

        // Create sparkle effect
        function createSparkle(x, y) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.innerHTML = '‚ú®';
            sparkle.style.left = x + 'px';
            sparkle.style.top = y + 'px';

            const tx = (Math.random() - 0.5) * 100;
            const ty = (Math.random() - 0.5) * 100;
            sparkle.style.setProperty('--tx', tx + 'px');
            sparkle.style.setProperty('--ty', ty + 'px');

            document.body.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 1000);
        }

        // Celebration animation
        function celebrate() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.innerHTML = 'üéâ';
            document.body.appendChild(celebration);

            // Create multiple sparkles
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const x = window.innerWidth * Math.random();
                    const y = window.innerHeight * Math.random();
                    createSparkle(x, y);
                }, i * 50);
            }

            setTimeout(() => celebration.remove(), 1000);
        }

        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>