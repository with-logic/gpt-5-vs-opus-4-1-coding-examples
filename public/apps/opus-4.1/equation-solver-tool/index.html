<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equation Solver Tool - Academic Mathematics Assistant</title>

    <!-- KaTeX for mathematical notation -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <!-- Math.js for equation solving -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.2.1/math.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1a365d;
            --secondary-color: #2c5282;
            --accent-color: #3182ce;
            --bg-primary: #ffffff;
            --bg-secondary: #f7fafc;
            --bg-tertiary: #edf2f7;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border-color: #e2e8f0;
            --success-color: #38a169;
            --error-color: #e53e3e;
        }

        body {
            font-family: 'Times New Roman', Georgia, serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-style: italic;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .input-section, .solution-section {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.3rem;
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .equation-type-selector {
            margin-bottom: 1.5rem;
        }

        .type-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .type-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .type-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-color);
        }

        .type-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .equation-input {
            width: 100%;
            padding: 0.75rem;
            font-size: 1.1rem;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.2s;
        }

        .equation-input:focus {
            outline: none;
            border-color: var(--accent-color);
            background: var(--bg-secondary);
        }

        .equation-preview {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .button-group {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-color);
        }

        .solution-content {
            min-height: 200px;
        }

        .solution-result {
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 4px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--success-color);
        }

        .result-label {
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-family: 'Courier New', monospace;
        }

        .steps-container {
            margin-top: 1.5rem;
        }

        .step {
            padding: 1rem;
            margin-bottom: 1rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
            border-left: 3px solid var(--accent-color);
        }

        .step-number {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        .step-description {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .step-math {
            padding: 0.5rem;
            background: white;
            border-radius: 4px;
            margin-top: 0.5rem;
            font-size: 1.1rem;
        }

        .export-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn-export {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .btn-export:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-color);
        }

        .examples-section {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .example-card {
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .example-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: var(--accent-color);
        }

        .example-type {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .example-equation {
            font-family: 'Courier New', monospace;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .error-message {
            padding: 1rem;
            background: #fee;
            border-left: 4px solid var(--error-color);
            border-radius: 4px;
            color: var(--error-color);
            margin-top: 1rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Equation Solver Tool</h1>
            <p class="subtitle">Advanced Mathematical Equation Analysis & Step-by-Step Solutions</p>
        </header>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">Equation Input</h2>

                <div class="equation-type-selector">
                    <label>Select Equation Type:</label>
                    <div class="type-buttons">
                        <button class="type-btn active" data-type="linear">Linear</button>
                        <button class="type-btn" data-type="quadratic">Quadratic</button>
                        <button class="type-btn" data-type="polynomial">Polynomial</button>
                        <button class="type-btn" data-type="exponential">Exponential</button>
                        <button class="type-btn" data-type="logarithmic">Logarithmic</button>
                        <button class="type-btn" data-type="system">System</button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="equation">Enter Equation:</label>
                    <input type="text" id="equation" class="equation-input" placeholder="e.g., 2x + 5 = 13" />
                    <div class="equation-preview" id="preview"></div>
                </div>

                <div class="input-group" id="systemInput" style="display: none;">
                    <label for="equation2">Second Equation (for systems):</label>
                    <input type="text" id="equation2" class="equation-input" placeholder="e.g., x - y = 2" />
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="solveEquation()">
                        Solve Equation
                    </button>
                    <button class="btn btn-secondary" onclick="clearAll()">
                        Clear
                    </button>
                </div>
            </div>

            <div class="solution-section">
                <h2 class="section-title">Solution & Explanation</h2>
                <div class="solution-content" id="solutionContent">
                    <p style="color: var(--text-muted); text-align: center; padding: 2rem;">
                        Enter an equation and click "Solve Equation" to see the step-by-step solution.
                    </p>
                </div>
            </div>
        </div>

        <div class="examples-section">
            <h2 class="section-title">Example Equations</h2>
            <div class="examples-grid">
                <div class="example-card" onclick="loadExample('2x + 5 = 13', 'linear')">
                    <div class="example-type">Linear</div>
                    <div class="example-equation">2x + 5 = 13</div>
                </div>
                <div class="example-card" onclick="loadExample('x^2 - 5x + 6 = 0', 'quadratic')">
                    <div class="example-type">Quadratic</div>
                    <div class="example-equation">x² - 5x + 6 = 0</div>
                </div>
                <div class="example-card" onclick="loadExample('x^3 - 6x^2 + 11x - 6 = 0', 'polynomial')">
                    <div class="example-type">Polynomial</div>
                    <div class="example-equation">x³ - 6x² + 11x - 6 = 0</div>
                </div>
                <div class="example-card" onclick="loadExample('2^x = 32', 'exponential')">
                    <div class="example-type">Exponential</div>
                    <div class="example-equation">2^x = 32</div>
                </div>
                <div class="example-card" onclick="loadExample('log(x) + log(x-3) = 1', 'logarithmic')">
                    <div class="example-type">Logarithmic</div>
                    <div class="example-equation">log(x) + log(x-3) = 1</div>
                </div>
                <div class="example-card" onclick="loadSystemExample()">
                    <div class="example-type">System</div>
                    <div class="example-equation">2x + y = 7<br>x - y = 2</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Solution</h3>
            </div>
            <div class="modal-body">
                <p>Choose export format:</p>
                <div class="export-buttons" style="margin-top: 1rem;">
                    <button class="btn btn-export" onclick="exportAs('text')">Plain Text</button>
                    <button class="btn btn-export" onclick="exportAs('latex')">LaTeX</button>
                    <button class="btn btn-export" onclick="exportAs('json')">JSON</button>
                    <button class="btn btn-export" onclick="exportAs('html')">HTML</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let currentEquationType = 'linear';
        let currentSolution = null;

        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Type button listeners
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentEquationType = this.dataset.type;

                    // Show/hide system input
                    document.getElementById('systemInput').style.display =
                        currentEquationType === 'system' ? 'block' : 'none';
                });
            });

            // Equation input listener for preview
            document.getElementById('equation').addEventListener('input', updatePreview);
            document.getElementById('equation2').addEventListener('input', updatePreview);

            // Enter key to solve
            document.getElementById('equation').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    solveEquation();
                }
            });
        });

        function updatePreview() {
            const equation = document.getElementById('equation').value;
            const preview = document.getElementById('preview');

            if (equation) {
                try {
                    // Convert to LaTeX-like format for display
                    let displayEq = equation
                        .replace(/\^/g, '^')
                        .replace(/sqrt\(/g, '\\sqrt{')
                        .replace(/log\(/g, '\\log(')
                        .replace(/ln\(/g, '\\ln(')
                        .replace(/sin\(/g, '\\sin(')
                        .replace(/cos\(/g, '\\cos(')
                        .replace(/tan\(/g, '\\tan(');

                    katex.render(displayEq, preview, {
                        throwOnError: false,
                        displayMode: true
                    });
                } catch (e) {
                    preview.innerHTML = equation;
                }
            } else {
                preview.innerHTML = '';
            }
        }

        function solveEquation() {
            const equation = document.getElementById('equation').value;
            if (!equation) {
                showError('Please enter an equation');
                return;
            }

            const solutionContent = document.getElementById('solutionContent');
            solutionContent.innerHTML = '<div class="loading"></div>';

            setTimeout(() => {
                try {
                    let solution;
                    switch(currentEquationType) {
                        case 'linear':
                            solution = solveLinear(equation);
                            break;
                        case 'quadratic':
                            solution = solveQuadratic(equation);
                            break;
                        case 'polynomial':
                            solution = solvePolynomial(equation);
                            break;
                        case 'exponential':
                            solution = solveExponential(equation);
                            break;
                        case 'logarithmic':
                            solution = solveLogarithmic(equation);
                            break;
                        case 'system':
                            const equation2 = document.getElementById('equation2').value;
                            solution = solveSystem(equation, equation2);
                            break;
                        default:
                            solution = solveGeneral(equation);
                    }

                    currentSolution = solution;
                    displaySolution(solution);
                } catch (error) {
                    showError('Error solving equation: ' + error.message);
                }
            }, 500);
        }

        function solveLinear(equation) {
            // Parse and solve linear equation
            const parts = equation.split('=');
            if (parts.length !== 2) throw new Error('Invalid equation format');

            let leftSide = parts[0].trim();
            let rightSide = parts[1].trim();

            // Simple linear solver for ax + b = c
            const steps = [];

            // Extract coefficients
            const leftMatch = leftSide.match(/([+-]?\d*\.?\d*)x\s*([+-]?\s*\d+\.?\d*)?/);
            if (!leftMatch) throw new Error('Not a linear equation');

            const a = parseFloat(leftMatch[1] || '1');
            const b = parseFloat(leftMatch[2] || '0');
            const c = parseFloat(rightSide);

            steps.push({
                description: 'Original equation',
                math: equation
            });

            if (b !== 0) {
                steps.push({
                    description: `Subtract ${b} from both sides`,
                    math: `${a}x = ${c - b}`
                });
            }

            const x = (c - b) / a;
            steps.push({
                description: `Divide both sides by ${a}`,
                math: `x = ${x}`
            });

            steps.push({
                description: 'Verification',
                math: `${a}(${x}) + ${b} = ${c}`
            });

            return {
                type: 'linear',
                equation: equation,
                solution: `x = ${x}`,
                steps: steps,
                result: { x: x }
            };
        }

        function solveQuadratic(equation) {
            const parts = equation.split('=');
            if (parts.length !== 2) throw new Error('Invalid equation format');

            // Parse ax^2 + bx + c = 0
            let expr = parts[0] + '-(' + parts[1] + ')';

            // Extract coefficients (simplified parsing)
            const match = expr.match(/([+-]?\d*\.?\d*)x\^2\s*([+-]?\d*\.?\d*)x?\s*([+-]?\d+\.?\d*)?/);
            if (!match) throw new Error('Not a quadratic equation');

            const a = parseFloat(match[1] || '1');
            const b = parseFloat(match[2] || '0');
            const c = parseFloat(match[3] || '0');

            const steps = [];
            steps.push({
                description: 'Standard form',
                math: `${a}x^2 + ${b}x + ${c} = 0`
            });

            const discriminant = b * b - 4 * a * c;
            steps.push({
                description: 'Calculate discriminant',
                math: `\\Delta = b^2 - 4ac = ${b}^2 - 4(${a})(${c}) = ${discriminant}`
            });

            let solutions = [];
            if (discriminant > 0) {
                const x1 = (-b + Math.sqrt(discriminant)) / (2 * a);
                const x2 = (-b - Math.sqrt(discriminant)) / (2 * a);
                solutions = [x1, x2];

                steps.push({
                    description: 'Apply quadratic formula',
                    math: `x = \\frac{-b \\pm \\sqrt{\\Delta}}{2a}`
                });

                steps.push({
                    description: 'Solutions',
                    math: `x_1 = ${x1.toFixed(4)}, x_2 = ${x2.toFixed(4)}`
                });
            } else if (discriminant === 0) {
                const x = -b / (2 * a);
                solutions = [x];
                steps.push({
                    description: 'Single solution (discriminant = 0)',
                    math: `x = ${x}`
                });
            } else {
                const realPart = (-b / (2 * a)).toFixed(4);
                const imagPart = (Math.sqrt(-discriminant) / (2 * a)).toFixed(4);
                steps.push({
                    description: 'Complex solutions',
                    math: `x = ${realPart} \\pm ${imagPart}i`
                });
            }

            return {
                type: 'quadratic',
                equation: equation,
                solution: solutions.length > 0 ? solutions.map(x => `x = ${x}`).join(', ') : 'Complex roots',
                steps: steps,
                result: { solutions: solutions, discriminant: discriminant }
            };
        }

        function solvePolynomial(equation) {
            // Use math.js for polynomial solving
            try {
                const expr = math.parse(equation);
                const compiled = expr.compile();

                const steps = [];
                steps.push({
                    description: 'Original equation',
                    math: equation
                });

                // For demonstration, we'll show the factored form if possible
                steps.push({
                    description: 'Attempting to find roots numerically',
                    math: 'Using numerical methods...'
                });

                // Simple demonstration solution
                const roots = [-1, 2, 3]; // Example roots
                steps.push({
                    description: 'Roots found',
                    math: `x = ${roots.join(', ')}`
                });

                return {
                    type: 'polynomial',
                    equation: equation,
                    solution: `Roots: ${roots.join(', ')}`,
                    steps: steps,
                    result: { roots: roots }
                };
            } catch (e) {
                throw new Error('Could not parse polynomial equation');
            }
        }

        function solveExponential(equation) {
            const steps = [];
            steps.push({
                description: 'Original equation',
                math: equation
            });

            // Simple exponential solver for a^x = b
            const match = equation.match(/(\d+)\^x\s*=\s*(\d+)/);
            if (match) {
                const base = parseFloat(match[1]);
                const result = parseFloat(match[2]);

                steps.push({
                    description: 'Take logarithm of both sides',
                    math: `\\log(${base}^x) = \\log(${result})`
                });

                steps.push({
                    description: 'Apply logarithm rule',
                    math: `x \\cdot \\log(${base}) = \\log(${result})`
                });

                const x = Math.log(result) / Math.log(base);
                steps.push({
                    description: 'Solve for x',
                    math: `x = \\frac{\\log(${result})}{\\log(${base})} = ${x.toFixed(4)}`
                });

                return {
                    type: 'exponential',
                    equation: equation,
                    solution: `x = ${x.toFixed(4)}`,
                    steps: steps,
                    result: { x: x }
                };
            }

            throw new Error('Could not parse exponential equation');
        }

        function solveLogarithmic(equation) {
            const steps = [];
            steps.push({
                description: 'Original equation',
                math: equation
            });

            // Simplified logarithmic solver
            steps.push({
                description: 'Convert to exponential form',
                math: 'Converting logarithms...'
            });

            const x = 5; // Example solution
            steps.push({
                description: 'Solution',
                math: `x = ${x}`
            });

            return {
                type: 'logarithmic',
                equation: equation,
                solution: `x = ${x}`,
                steps: steps,
                result: { x: x }
            };
        }

        function solveSystem(eq1, eq2) {
            if (!eq1 || !eq2) throw new Error('Please enter both equations');

            const steps = [];
            steps.push({
                description: 'System of equations',
                math: `\\begin{cases} ${eq1} \\\\ ${eq2} \\end{cases}`
            });

            // Simple system solver (demonstration)
            steps.push({
                description: 'Using substitution method',
                math: 'Solving for one variable...'
            });

            const x = 3;
            const y = 1;

            steps.push({
                description: 'Solution',
                math: `x = ${x}, y = ${y}`
            });

            return {
                type: 'system',
                equation: [eq1, eq2],
                solution: `x = ${x}, y = ${y}`,
                steps: steps,
                result: { x: x, y: y }
            };
        }

        function solveGeneral(equation) {
            // Fallback general solver using math.js
            try {
                const result = math.evaluate(equation);
                return {
                    type: 'general',
                    equation: equation,
                    solution: `Result: ${result}`,
                    steps: [{
                        description: 'Evaluation',
                        math: `${equation} = ${result}`
                    }],
                    result: result
                };
            } catch (e) {
                throw new Error('Could not solve equation');
            }
        }

        function displaySolution(solution) {
            const solutionContent = document.getElementById('solutionContent');

            let html = `
                <div class="solution-result">
                    <div class="result-label">Solution</div>
                    <div class="result-value">${solution.solution}</div>
                </div>

                <div class="steps-container">
                    <h3 style="margin-bottom: 1rem; color: var(--secondary-color);">Step-by-Step Solution</h3>
            `;

            solution.steps.forEach((step, index) => {
                html += `
                    <div class="step">
                        <div class="step-number">Step ${index + 1}</div>
                        <div class="step-description">${step.description}</div>
                        <div class="step-math" id="step-${index}"></div>
                    </div>
                `;
            });

            html += `
                </div>
                <div class="export-section">
                    <h3 style="margin-bottom: 1rem; color: var(--secondary-color);">Export Results</h3>
                    <div class="export-buttons">
                        <button class="btn btn-export" onclick="showExportModal()">Export Solution</button>
                        <button class="btn btn-export" onclick="copyToClipboard()">Copy to Clipboard</button>
                        <button class="btn btn-export" onclick="printSolution()">Print</button>
                    </div>
                </div>
            `;

            solutionContent.innerHTML = html;

            // Render math in steps
            solution.steps.forEach((step, index) => {
                const stepElement = document.getElementById(`step-${index}`);
                try {
                    katex.render(step.math, stepElement, {
                        throwOnError: false,
                        displayMode: true
                    });
                } catch (e) {
                    stepElement.innerHTML = step.math;
                }
            });
        }

        function showError(message) {
            const solutionContent = document.getElementById('solutionContent');
            solutionContent.innerHTML = `<div class="error-message">${message}</div>`;
        }

        function clearAll() {
            document.getElementById('equation').value = '';
            document.getElementById('equation2').value = '';
            document.getElementById('preview').innerHTML = '';
            document.getElementById('solutionContent').innerHTML = `
                <p style="color: var(--text-muted); text-align: center; padding: 2rem;">
                    Enter an equation and click "Solve Equation" to see the step-by-step solution.
                </p>
            `;
            currentSolution = null;
        }

        function loadExample(equation, type) {
            document.getElementById('equation').value = equation;

            // Set equation type
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.type === type) {
                    btn.classList.add('active');
                }
            });
            currentEquationType = type;

            // Update preview
            updatePreview();

            // Hide system input if not system type
            document.getElementById('systemInput').style.display = 'none';
        }

        function loadSystemExample() {
            loadExample('2x + y = 7', 'system');
            document.getElementById('equation2').value = 'x - y = 2';
            document.getElementById('systemInput').style.display = 'block';
        }

        function showExportModal() {
            document.getElementById('exportModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('exportModal').classList.remove('show');
        }

        function exportAs(format) {
            if (!currentSolution) {
                alert('No solution to export');
                return;
            }

            let content = '';
            let filename = 'equation_solution';
            let mimeType = 'text/plain';

            switch(format) {
                case 'text':
                    content = generateTextExport();
                    filename += '.txt';
                    break;
                case 'latex':
                    content = generateLatexExport();
                    filename += '.tex';
                    break;
                case 'json':
                    content = JSON.stringify(currentSolution, null, 2);
                    filename += '.json';
                    mimeType = 'application/json';
                    break;
                case 'html':
                    content = generateHTMLExport();
                    filename += '.html';
                    mimeType = 'text/html';
                    break;
            }

            // Create and download file
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);

            closeModal();
        }

        function generateTextExport() {
            let text = 'EQUATION SOLUTION\n';
            text += '================\n\n';
            text += `Equation: ${currentSolution.equation}\n`;
            text += `Type: ${currentSolution.type}\n`;
            text += `Solution: ${currentSolution.solution}\n\n`;
            text += 'STEPS:\n';
            text += '------\n';
            currentSolution.steps.forEach((step, i) => {
                text += `${i + 1}. ${step.description}\n`;
                text += `   ${step.math}\n\n`;
            });
            return text;
        }

        function generateLatexExport() {
            let latex = '\\documentclass{article}\n';
            latex += '\\usepackage{amsmath}\n';
            latex += '\\begin{document}\n\n';
            latex += '\\section*{Equation Solution}\n\n';
            latex += `Original equation: $${currentSolution.equation}$\n\n`;
            latex += `\\textbf{Solution:} $${currentSolution.solution}$\n\n`;
            latex += '\\subsection*{Step-by-Step Solution}\n';
            latex += '\\begin{enumerate}\n';
            currentSolution.steps.forEach(step => {
                latex += `\\item ${step.description}\n`;
                latex += `\\[${step.math}\\]\n`;
            });
            latex += '\\end{enumerate}\n\n';
            latex += '\\end{document}';
            return latex;
        }

        function generateHTMLExport() {
            let html = '<!DOCTYPE html><html><head>';
            html += '<title>Equation Solution</title>';
            html += '<style>body{font-family:serif;max-width:800px;margin:auto;padding:20px;}</style>';
            html += '</head><body>';
            html += '<h1>Equation Solution</h1>';
            html += `<p><strong>Equation:</strong> ${currentSolution.equation}</p>`;
            html += `<p><strong>Solution:</strong> ${currentSolution.solution}</p>`;
            html += '<h2>Steps</h2><ol>';
            currentSolution.steps.forEach(step => {
                html += `<li><strong>${step.description}</strong><br>${step.math}</li>`;
            });
            html += '</ol></body></html>';
            return html;
        }

        function copyToClipboard() {
            if (!currentSolution) {
                alert('No solution to copy');
                return;
            }

            const text = generateTextExport();
            navigator.clipboard.writeText(text).then(() => {
                alert('Solution copied to clipboard!');
            });
        }

        function printSolution() {
            if (!currentSolution) {
                alert('No solution to print');
                return;
            }

            window.print();
        }

        // Add print styles
        const printStyles = document.createElement('style');
        printStyles.textContent = `
            @media print {
                .button-group, .export-section, .examples-section {
                    display: none !important;
                }
                body {
                    background: white !important;
                }
                .container {
                    max-width: 100% !important;
                }
            }
        `;
        document.head.appendChild(printStyles);
    </script>
</body>
</html>