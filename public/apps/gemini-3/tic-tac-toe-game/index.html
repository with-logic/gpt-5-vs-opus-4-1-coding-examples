<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPQR Tac Toe</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --marble: #f0e6d2;
            --marble-dark: #d4c5a9;
            --gold: #c5a009;
            --gold-dim: #8a7006;
            --roman-red: #8b0000;
            --text: #2c1810;
            --shadow: rgba(0,0,0,0.2);
        }

        body.theme-night {
            --marble: #1a1a1a;
            --marble-dark: #2d2d2d;
            --gold: #ffd700;
            --roman-red: #ff3333;
            --text: #f0e6d2;
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            margin: 0;
            font-family: 'Cinzel', serif;
            background-color: var(--marble);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Background Texture (CSS Pattern) */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            opacity: 0.5;
            pointer-events: none;
            z-index: -1;
        }

        /* Top Bar */
        header {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            z-index: 10;
        }

        h1 {
            font-size: 1.5rem;
            margin: 0;
            letter-spacing: 2px;
            text-shadow: 1px 1px 0 var(--gold-dim);
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            background: var(--marble-dark);
            border: 2px solid var(--gold);
            color: var(--text);
            font-family: 'Cinzel', serif;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        button:hover {
            background: var(--gold);
            color: white;
            box-shadow: 0 2px 5px var(--shadow);
        }

        /* Board */
        .game-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .status {
            font-size: 1.2rem;
            margin-bottom: 20px;
            height: 1.5em;
            color: var(--roman-red);
            font-weight: bold;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: var(--gold);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 10px 30px var(--shadow);
            width: 80vmin;
            height: 80vmin;
            max-width: 500px;
            max-height: 500px;
        }

        .cell {
            background: var(--marble);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            position: relative;
        }

        .cell:hover {
            background: var(--marble-dark);
        }

        .cell.win {
            background: #ffd700; /* Bright gold for win */
            color: #000;
        }

        .glyph {
            display: block;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Scoreboard */
        .scores {
            display: flex;
            gap: 30px;
            margin-top: 30px;
            font-size: 1.2rem;
        }

        .score-box {
            text-align: center;
        }

        .score-val {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--gold-dim);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(2px);
        }

        .modal {
            background: var(--marble);
            padding: 30px;
            border: 4px double var(--gold);
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            color: var(--text);
        }

        .modal h2 { margin-top: 0; border-bottom: 1px solid var(--gold); padding-bottom: 10px; }

        .setting-row {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        select {
            padding: 5px;
            font-family: inherit;
            background: var(--marble-dark);
            border: 1px solid var(--gold);
            color: var(--text);
        }

        /* Canvas */
        #confetti {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        @media (prefers-reduced-motion) {
            #confetti { display: none; }
        }

    </style>
</head>
<body>

    <canvas id="confetti"></canvas>

    <header>
        <h1>SPQR</h1>
        <div class="controls">
            <button onclick="resetBoard()">New Round</button>
            <button onclick="openModal()">Customize</button>
            <button onclick="resetScores()">Reset Scores</button>
        </div>
    </header>

    <div class="game-container">
        <div class="status" id="status" role="status">Player X's Turn</div>
        
        <div class="board" id="board">
            <!-- Cells -->
            <div class="cell" onclick="cellClick(0)" role="button" aria-label="Top Left"></div>
            <div class="cell" onclick="cellClick(1)" role="button" aria-label="Top Center"></div>
            <div class="cell" onclick="cellClick(2)" role="button" aria-label="Top Right"></div>
            <div class="cell" onclick="cellClick(3)" role="button" aria-label="Middle Left"></div>
            <div class="cell" onclick="cellClick(4)" role="button" aria-label="Center"></div>
            <div class="cell" onclick="cellClick(5)" role="button" aria-label="Middle Right"></div>
            <div class="cell" onclick="cellClick(6)" role="button" aria-label="Bottom Left"></div>
            <div class="cell" onclick="cellClick(7)" role="button" aria-label="Bottom Center"></div>
            <div class="cell" onclick="cellClick(8)" role="button" aria-label="Bottom Right"></div>
        </div>

        <div class="scores">
            <div class="score-box">X: <span id="scoreX" class="score-val">0</span></div>
            <div class="score-box">Draws: <span id="scoreD" class="score-val">0</span></div>
            <div class="score-box">O: <span id="scoreO" class="score-val">0</span></div>
        </div>
    </div>

    <!-- Customize Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <h2>Legion Settings</h2>
            
            <div class="setting-row">
                <label>Theme</label>
                <select id="themeSelect" onchange="updateSettings()">
                    <option value="day">Marble Day</option>
                    <option value="night">Night Legion</option>
                </select>
            </div>

            <div class="setting-row">
                <label>Glyphs</label>
                <select id="glyphSelect" onchange="updateSettings()">
                    <option value="standard">X / O</option>
                    <option value="roman">Gladius / Laurel</option>
                </select>
            </div>

            <div class="setting-row">
                <label>Mode</label>
                <select id="modeSelect" onchange="resetBoard()">
                    <option value="pvp">2-Player</option>
                    <option value="ai">Vs AI</option>
                </select>
            </div>

            <div class="setting-row">
                <label>AI Level</label>
                <select id="aiSelect">
                    <option value="easy">Reckless (Easy)</option>
                    <option value="medium">Pragmatic (Med)</option>
                    <option value="hard">Perfect (Hard)</option>
                </select>
            </div>

            <button onclick="closeModal()" style="width:100%; margin-top:10px;">Return to Arena</button>
        </div>
    </div>

    <script>
        // State
        let board = Array(9).fill(null);
        let currentPlayer = 'X'; // 'X' or 'O'
        let gameActive = true;
        let scores = { X: 0, O: 0, D: 0 };
        
        // Settings
        let settings = {
            theme: 'day',
            glyphs: 'standard',
            mode: 'pvp',
            aiLevel: 'easy'
        };

        // DOM
        const cells = document.querySelectorAll('.cell');
        const statusEl = document.getElementById('status');
        const modal = document.getElementById('modal');

        // Init
        function init() {
            updateSettings();
        }

        function updateSettings() {
            // Theme
            settings.theme = document.getElementById('themeSelect').value;
            document.body.className = settings.theme === 'night' ? 'theme-night' : '';
            
            // Glyphs
            settings.glyphs = document.getElementById('glyphSelect').value;
            renderBoard();
            
            // Mode/AI
            settings.mode = document.getElementById('modeSelect').value;
            settings.aiLevel = document.getElementById('aiSelect').value;
        }

        function cellClick(index) {
            if (!gameActive || board[index] !== null) return;

            makeMove(index, currentPlayer);

            if (gameActive && settings.mode === 'ai' && currentPlayer === 'O') {
                setTimeout(aiMove, 300);
            }
        }

        function makeMove(index, player) {
            board[index] = player;
            renderBoard();
            
            if (checkWin(player)) {
                endGame(player);
            } else if (board.every(c => c !== null)) {
                endGame('draw');
            } else {
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                statusEl.textContent = `Player ${currentPlayer}'s Turn`;
            }
        }

        function getGlyph(player) {
            if (settings.glyphs === 'roman') {
                return player === 'X' ? 'âš”ï¸' : 'ðŸŒ¿'; // Gladius / Laurel
            }
            return player;
        }

        function renderBoard() {
            cells.forEach((cell, i) => {
                cell.textContent = board[i] ? getGlyph(board[i]) : '';
                cell.classList.remove('win');
            });
        }

        function checkWin(player, currentBoard = board) {
            const wins = [
                [0,1,2], [3,4,5], [6,7,8], // Rows
                [0,3,6], [1,4,7], [2,5,8], // Cols
                [0,4,8], [2,4,6]           // Diagonals
            ];
            return wins.find(combo => combo.every(i => currentBoard[i] === player));
        }

        function endGame(winner) {
            gameActive = false;
            if (winner === 'draw') {
                statusEl.textContent = "Draw!";
                scores.D++;
                document.getElementById('scoreD').textContent = scores.D;
            } else {
                statusEl.textContent = `Player ${winner} Wins!`;
                scores[winner]++;
                document.getElementById(`score${winner}`).textContent = scores[winner];
                
                // Highlight
                const combo = checkWin(winner);
                combo.forEach(i => cells[i].classList.add('win'));
                
                fireConfetti();
            }
        }

        function resetBoard() {
            board = Array(9).fill(null);
            gameActive = true;
            currentPlayer = 'X';
            statusEl.textContent = "Player X's Turn";
            renderBoard();
            
            // Clear confetti
            const ctx = document.getElementById('confetti').getContext('2d');
            ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
        }

        function resetScores() {
            scores = { X: 0, O: 0, D: 0 };
            document.getElementById('scoreX').textContent = 0;
            document.getElementById('scoreO').textContent = 0;
            document.getElementById('scoreD').textContent = 0;
            resetBoard();
        }

        // AI Logic (Minimax)
        function aiMove() {
            if (!gameActive) return;
            
            let idx;
            // Difficulty
            const rand = Math.random();
            
            if (settings.aiLevel === 'easy') {
                // Reckless: 70% random
                if (rand < 0.7) idx = getRandomMove();
                else idx = getBestMove();
            } else if (settings.aiLevel === 'medium') {
                // Pragmatic: 30% random
                if (rand < 0.3) idx = getRandomMove();
                else idx = getBestMove();
            } else {
                // Perfect
                idx = getBestMove();
            }
            
            makeMove(idx, 'O');
        }

        function getRandomMove() {
            const avail = board.map((v, i) => v === null ? i : null).filter(v => v !== null);
            return avail[Math.floor(Math.random() * avail.length)];
        }

        function getBestMove() {
            let bestScore = -Infinity;
            let move;
            
            for (let i = 0; i < 9; i++) {
                if (board[i] === null) {
                    board[i] = 'O';
                    let score = minimax(board, 0, false);
                    board[i] = null;
                    if (score > bestScore) {
                        bestScore = score;
                        move = i;
                    }
                }
            }
            return move;
        }

        function minimax(b, depth, isMaximizing) {
            if (checkWin('O', b)) return 10 - depth;
            if (checkWin('X', b)) return depth - 10;
            if (b.every(c => c !== null)) return 0;

            if (isMaximizing) {
                let bestScore = -Infinity;
                for (let i = 0; i < 9; i++) {
                    if (b[i] === null) {
                        b[i] = 'O';
                        let score = minimax(b, depth + 1, false);
                        b[i] = null;
                        bestScore = Math.max(score, bestScore);
                    }
                }
                return bestScore;
            } else {
                let bestScore = Infinity;
                for (let i = 0; i < 9; i++) {
                    if (b[i] === null) {
                        b[i] = 'X';
                        let score = minimax(b, depth + 1, true);
                        b[i] = null;
                        bestScore = Math.min(score, bestScore);
                    }
                }
                return bestScore;
            }
        }

        // UI
        function openModal() { modal.style.display = 'flex'; }
        function closeModal() { modal.style.display = 'none'; }

        // Confetti
        function fireConfetti() {
            const canvas = document.getElementById('confetti');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            for(let i=0; i<100; i++) {
                particles.push({
                    x: canvas.width/2,
                    y: canvas.height/2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`,
                    life: 100
                });
            }
            
            function animate() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                let active = false;
                particles.forEach(p => {
                    if(p.life > 0) {
                        p.x += p.vx;
                        p.y += p.vy;
                        p.life--;
                        ctx.fillStyle = p.color;
                        ctx.fillRect(p.x, p.y, 5, 5);
                        active = true;
                    }
                });
                if(active) requestAnimationFrame(animate);
            }
            animate();
        }

        init();

    </script>
</body>
</html>
