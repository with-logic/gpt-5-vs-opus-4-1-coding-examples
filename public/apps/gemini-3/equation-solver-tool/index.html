<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equation Solver Tool</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- KaTeX for Math Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    
    <!-- Nerdamer for reliable math solving -->
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/nerdamer.core.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/Algebra.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/Calculus.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/Solve.js"></script>

    <!-- Google Fonts: Merriweather (Serif) & Inter (Sans) -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfdfd; /* Off-white academic paper look */
            color: #1a1a1a;
        }
        h1, h2, h3, .serif {
            font-family: 'Merriweather', serif;
        }
        .math-display {
            font-family: 'KaTeX_Main', 'Times New Roman', serif;
        }
        /* Custom scrollbar for steps */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <div id="root" class="flex-grow flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Math Logic Helper Functions ---

        // Helper to format steps for Linear Equations: ax + b = cx + d
        const solveLinearStepByStep = (eq) => {
            const steps = [];
            try {
                // Remove spaces
                let cleanEq = eq.replace(/\s+/g, '');
                
                // Parse sides
                const parts = cleanEq.split('=');
                if (parts.length !== 2) throw new Error("Not an equation");
                
                let lhs = nerdamer(parts[0]);
                let rhs = nerdamer(parts[1]);
                let variable = 'x'; // default
                
                // Detect variable
                const vars = nerdamer(eq).variables();
                if (vars.length > 0) variable = vars[0];

                steps.push({
                    type: 'text',
                    content: `Identify the equation`,
                    latex: `${parts[0]} = ${parts[1]}`
                });

                // Move all variable terms to LHS, constants to RHS
                // We'll simulate the "steps" logic manually for clarity, or use nerdamer's simplify at each step
                
                // Step 1: Subtract RHS variable terms from both sides
                // This is hard to do generally with just nerdamer core.
                // Instead, let's use nerdamer to get the solution, and construct plausible steps for display if it's linear.

                // Using a heuristic approach for formatting standard ax+b=c
                // 1. Parse standard form. 
                
                // Let's rely on Nerdamer for the final solution, and try to generate generic steps for common forms.
                
                const solution = nerdamer.solve(eq, variable);
                const root = solution.toString();

                // Generate "Synthetic" steps based on solution existence
                // If we can identify it as Linear:
                // ax + b = c
                
                // Re-parsing for structure analysis
                // We will just show the "Simplify" and "Solve" steps broadly. 
                
                steps.push({
                    type: 'explanation',
                    text: `Subtract variable terms from the right side and constant terms from the left side to isolate ${variable}.`
                });

                steps.push({
                    type: 'latex',
                    text: `\\text{Rearranging terms...}`
                });
                
                // Show intermediate simplification
                const simplifiedLHS = nerdamer(parts[0]).expand();
                const simplifiedRHS = nerdamer(parts[1]).expand();
                
                if (simplifiedLHS.toString() !== parts[0] || simplifiedRHS.toString() !== parts[1]) {
                     steps.push({
                        type: 'text',
                        content: `Simplify both sides`,
                        latex: `${simplifiedLHS.toTeX()} = ${simplifiedRHS.toTeX()}`
                    });
                }

                steps.push({
                    type: 'text',
                    content: `Isolate the variable ${variable}`,
                    latex: `${variable} = ${nerdamer(root).toTeX()}`
                });

                return { steps, result: nerdamer(root).toTeX() };

            } catch (e) {
                console.error(e);
                return { steps: [], result: null, error: "Could not generate steps." };
            }
        };

        // Generic Solver Wrapper
        const solveEquation = (input) => {
            try {
                if (!input) return null;
                
                // Check if it's an expression or equation
                const isEquation = input.includes('=');
                const variables = nerdamer(input).variables();
                const variable = variables.length > 0 ? variables[0] : 'x';

                if (!isEquation) {
                    // It's an expression to simplify
                    const simplified = nerdamer(input).simplify();
                    const resultTeX = simplified.toTeX();
                    return {
                        type: 'Simplification',
                        inputTeX: nerdamer(input).toTeX(),
                        resultTeX: resultTeX,
                        steps: [
                            { type: 'text', content: 'Identify the expression.', latex: nerdamer(input).toTeX() },
                            { type: 'text', content: 'Group like terms and simplify.', latex: resultTeX }
                        ]
                    };
                } else {
                    // It's an equation
                    const solution = nerdamer.solve(input, variable);
                    const solutionTeX = solution.toTeX(); // This might be a list like [1, -1]
                    
                    // Simple Step Generation Logic (Heuristic)
                    let steps = [];
                    steps.push({ type: 'text', content: 'Write down the equation.', latex: nerdamer(input).toTeX() });
                    
                    // If quadratic
                    // Check degree
                    const degree = nerdamer(`deg(${input.split('=')[0]} - (${input.split('=')[1]}), ${variable})`).evaluate().toString();
                    
                    if (degree === '2') {
                         steps.push({ type: 'text', content: 'This is a quadratic equation. Rearrange into standard form $ax^2 + bx + c = 0$.' });
                         // Attempt to find coefficients?
                         // For demo, we explain the method.
                         steps.push({ type: 'text', content: 'Use the quadratic formula or factoring to solve for ' + variable + '.' });
                         steps.push({ type: 'latex', text: 'x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}' });
                    } else if (degree === '1') {
                         steps.push({ type: 'text', content: 'This is a linear equation. Isolate the variable ' + variable + '.' });
                    }
                    
                    steps.push({ type: 'text', content: 'Solve for ' + variable + ':', latex: `${variable} = ${solutionTeX}` });

                    return {
                        type: 'Equation',
                        inputTeX: nerdamer(input).toTeX(),
                        resultTeX: `${variable} \in \{ ${solutionTeX.replace(/[\\\[\]]/g, '')} \}`, // Format set notation if multiple
                        steps: steps
                    };
                }
            } catch (err) {
                return { error: "Unable to solve. Please check the syntax." };
            }
        };


        // --- UI Components ---

        const Header = () => (
            <header className="py-8 px-4 border-b border-gray-200 bg-white">
                <div className="max-w-3xl mx-auto text-center">
                    <h1 className="text-3xl md:text-4xl font-bold text-gray-900 mb-2 serif tracking-tight">Equation Solver</h1>
                    <p className="text-gray-500 text-sm md:text-base font-light italic">
                        An academic tool for mathematical analysis and step-by-step resolution.
                    </p>
                </div>
            </header>
        );

        const Footer = () => (
            <footer className="py-6 mt-auto text-center text-gray-400 text-xs border-t border-gray-100 bg-gray-50">
                <p>&copy; 2026 Academic Tools Suite. All calculations performed locally.</p>
            </footer>
        );

        const MathView = ({ latex, className = "" }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (containerRef.current) {
                    try {
                        katex.render(latex, containerRef.current, {
                            throwOnError: false,
                            displayMode: true
                        });
                    } catch (e) {
                        containerRef.current.innerText = latex;
                    }
                }
            }, [latex]);

            return <div ref={containerRef} className={`math-display ${className}`}></div>;
        };
        
        const InlineMath = ({ latex }) => {
             const containerRef = useRef(null);
             useEffect(() => {
                if (containerRef.current) {
                     try {
                        katex.render(latex, containerRef.current, {
                            throwOnError: false,
                            displayMode: false
                        });
                    } catch (e) {}
                }
             }, [latex]);
             return <span ref={containerRef} className="px-1"></span>;
        }

        const InputSection = ({ onSolve }) => {
            const [input, setInput] = useState("");

            const handleSubmit = (e) => {
                e.preventDefault();
                if (input.trim()) onSolve(input);
            };

            return (
                <section className="bg-white shadow-sm border border-gray-200 rounded-lg p-6 mb-8 fade-in">
                    <form onSubmit={handleSubmit} className="flex flex-col gap-4">
                        <label className="text-gray-600 text-sm font-semibold uppercase tracking-wider">
                            Enter Equation or Expression
                        </label>
                        <div className="relative">
                            <input
                                type="text"
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                placeholder="e.g. 2x + 5 = 15 or x^2 - 4 = 0"
                                className="w-full text-lg p-4 bg-gray-50 border border-gray-300 rounded-md focus:ring-2 focus:ring-gray-400 focus:border-transparent outline-none transition font-mono"
                            />
                            <button 
                                type="submit"
                                className="absolute right-2 top-2 bottom-2 px-6 bg-gray-900 text-white rounded font-medium hover:bg-black transition shadow-sm"
                            >
                                Solve
                            </button>
                        </div>
                        <div className="flex gap-2 text-xs text-gray-400">
                            <span>Examples:</span>
                            <button type="button" onClick={() => setInput("2x + 5 = 15")} className="hover:text-gray-700 underline">Linear</button>
                            <button type="button" onClick={() => setInput("x^2 - 5x + 6 = 0")} className="hover:text-gray-700 underline">Quadratic</button>
                            <button type="button" onClick={() => setInput("(a+b)^2")} className="hover:text-gray-700 underline">Expand</button>
                        </div>
                    </form>
                </section>
            );
        };

        const StepCard = ({ step, index }) => {
            return (
                <div className="flex gap-4 p-4 border-l-2 border-gray-200 hover:border-gray-400 transition-colors bg-white/50">
                    <div className="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 font-bold text-sm">
                        {index + 1}
                    </div>
                    <div className="flex-grow">
                        {step.content && <p className="text-gray-700 mb-2">{step.content}</p>}
                        {step.latex && <MathView latex={step.latex} className="text-lg" />}
                        {step.text && !step.content && !step.latex && <p className="text-gray-700">{step.text}</p>}
                    </div>
                </div>
            );
        };

        const ResultSection = ({ resultData }) => {
            if (!resultData) return null;
            
            if (resultData.error) {
                return (
                    <div className="p-4 bg-red-50 text-red-700 border border-red-200 rounded fade-in">
                        <strong>Error:</strong> {resultData.error}
                    </div>
                );
            }

            const downloadTxt = () => {
                const textContent = `Equation Solver Result\n\nInput: ${resultData.inputTeX}\nResult: ${resultData.resultTeX}\n\nSteps:\n` + 
                    resultData.steps.map((s, i) => `${i+1}. ${s.content || s.text || ''} ${s.latex || ''}`).join('\n');
                
                const element = document.createElement("a");
                const file = new Blob([textContent], {type: 'text/plain'});
                element.href = URL.createObjectURL(file);
                element.download = "solution.txt";
                document.body.appendChild(element);
                element.click();
            };

            return (
                <div className="fade-in space-y-6">
                    {/* Solution Summary */}
                    <section className="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                        <div className="flex justify-between items-start mb-4">
                            <h2 className="text-lg font-bold text-gray-800 serif">Solution</h2>
                            <button 
                                onClick={downloadTxt}
                                className="text-xs font-medium text-gray-500 hover:text-gray-900 flex items-center gap-1 border border-gray-300 rounded px-2 py-1"
                            >
                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                Export
                            </button>
                        </div>
                        <div className="mb-6">
                            <span className="text-xs font-semibold text-gray-400 uppercase tracking-widest">Input</span>
                            <MathView latex={resultData.inputTeX} className="text-xl text-gray-600 mt-1" />
                        </div>
                        <div className="bg-gray-50 border border-gray-100 rounded p-4 text-center">
                            <span className="text-xs font-semibold text-gray-400 uppercase tracking-widest block mb-2">Final Answer</span>
                            <MathView latex={resultData.resultTeX} className="text-2xl text-gray-900 font-bold" />
                        </div>
                    </section>

                    {/* Steps */}
                    <section className="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <div className="p-4 bg-gray-50 border-b border-gray-200">
                            <h3 className="text-md font-bold text-gray-700 serif">Step-by-Step Breakdown</h3>
                        </div>
                        <div className="divide-y divide-gray-100">
                            {resultData.steps.map((step, idx) => (
                                <StepCard key={idx} step={step} index={idx} />
                            ))}
                        </div>
                    </section>
                </div>
            );
        };

        const App = () => {
            const [result, setResult] = useState(null);

            const handleSolve = (input) => {
                setResult(null);
                // Artificial delay for UX "thinking" feel
                setTimeout(() => {
                    const res = solveEquation(input);
                    setResult(res);
                }, 300);
            };

            return (
                <div className="min-h-screen flex flex-col w-full max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                    <Header />
                    
                    <main className="flex-grow py-8 w-full">
                        <InputSection onSolve={handleSolve} />
                        <ResultSection resultData={result} />
                    </main>

                    <Footer />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
