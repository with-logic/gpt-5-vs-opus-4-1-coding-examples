<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Countdown</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom Styles & Transitions */
        [v-cloak] { display: none; }

        body {
            background-color: #0f172a;
            color: #f8fafc;
            overflow-x: hidden;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Input Styling */
        .custom-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        .custom-input:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: #6366f1;
            outline: none;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        /* Number Animation Transition */
        .slide-up-enter-active,
        .slide-up-leave-active {
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            position: absolute;
        }
        .slide-up-enter-from {
            transform: translateY(100%);
            opacity: 0;
        }
        .slide-up-leave-to {
            transform: translateY(-100%);
            opacity: 0;
        }
        
        /* Fade Transition */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.5s ease;
        }
        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        /* Parallax Background Container */
        .parallax-container {
            position: fixed;
            top: -5%;
            left: -5%;
            width: 110%;
            height: 110%;
            background-size: cover;
            background-position: center;
            z-index: -1;
            transition: transform 0.1s ease-out;
            will-change: transform;
        }

        .parallax-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.8) 100%);
            z-index: -1;
        }

        /* Custom File Upload */
        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .file-upload-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
    </style>
</head>

<body>

<div id="app" v-cloak class="min-h-screen flex items-center justify-center relative">

    <!-- SETUP VIEW -->
    <transition name="fade" mode="out-in">
        <div v-if="state === 'setup'" class="w-full max-w-lg p-8 mx-4 glass rounded-2xl relative z-10 animate-float">
            <h1 class="text-3xl font-serif font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-300">Create Event</h1>
            <p class="text-slate-400 mb-8 text-sm">Design your perfect countdown.</p>

            <form @submit.prevent="startCountdown" class="space-y-6">
                <!-- Event Name -->
                <div>
                    <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Event Name</label>
                    <input type="text" v-model="form.name" required placeholder="e.g. New Year's Eve Party" class="custom-input w-full px-4 py-3 rounded-lg text-lg placeholder-slate-600">
                </div>

                <!-- Date & Time -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Date</label>
                        <input type="date" v-model="form.date" required class="custom-input w-full px-4 py-3 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Time</label>
                        <input type="time" v-model="form.time" required class="custom-input w-full px-4 py-3 rounded-lg">
                    </div>
                </div>

                <!-- Location -->
                <div>
                    <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Location</label>
                    <div class="relative">
                        <i class="fas fa-map-marker-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
                        <input type="text" v-model="form.location" placeholder="Add a location" class="custom-input w-full pl-10 pr-4 py-3 rounded-lg">
                    </div>
                </div>

                <!-- Background Image -->
                <div>
                    <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Background Image</label>
                    <div class="file-upload-wrapper w-full h-32 border-2 border-dashed border-slate-600 rounded-lg flex flex-col items-center justify-center text-slate-400 hover:border-indigo-400 hover:text-indigo-400 transition-colors bg-slate-800/30">
                        <input type="file" @change="handleImageUpload" accept="image/*">
                        <template v-if="form.bgImagePreview">
                             <img :src="form.bgImagePreview" class="absolute inset-0 w-full h-full object-cover rounded-lg opacity-60">
                             <div class="relative z-10 flex flex-col items-center bg-black/40 p-2 rounded">
                                <i class="fas fa-sync-alt mb-1"></i>
                                <span class="text-xs">Change Image</span>
                             </div>
                        </template>
                        <template v-else>
                            <i class="fas fa-cloud-upload-alt text-2xl mb-2"></i>
                            <span class="text-sm">Click or Drag Image</span>
                        </template>
                    </div>
                </div>

                <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-cyan-500 hover:from-indigo-500 hover:to-cyan-400 text-white font-bold py-4 rounded-lg shadow-lg shadow-indigo-500/30 transition-all transform hover:scale-[1.02] mt-4">
                    Start Countdown <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </form>
        </div>

        <!-- COUNTDOWN VIEW -->
        <div v-else class="w-full h-full absolute inset-0 flex flex-col items-center justify-center overflow-hidden" @mousemove="handleMouseMove">
            
            <!-- Parallax Background -->
            <div class="parallax-container" :style="{ 
                backgroundImage: `url(${finalEvent.image})`,
                transform: `translate(${parallax.x}px, ${parallax.y}px)` 
            }"></div>
            <div class="parallax-overlay"></div>

            <!-- Main Content -->
            <div class="relative z-10 text-center px-4 w-full max-w-6xl">
                
                <!-- Header -->
                <div class="mb-12 animate-fade-in-down">
                    <h2 class="text-xl md:text-2xl font-light tracking-[0.2em] uppercase text-slate-300 mb-2">{{ finalEvent.location }}</h2>
                    <h1 class="text-5xl md:text-7xl lg:text-8xl font-serif font-bold text-white drop-shadow-2xl leading-tight">{{ finalEvent.name }}</h1>
                    <div class="mt-4 inline-block px-4 py-1 rounded-full glass-dark text-sm text-slate-200">
                        {{ formattedDate }}
                    </div>
                </div>

                <!-- Timer Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8 mb-16">
                    <div v-for="(value, label) in timeLeft" :key="label" class="flex flex-col items-center">
                        <div class="relative w-24 h-24 md:w-40 md:h-40 glass rounded-2xl flex items-center justify-center overflow-hidden shadow-2xl">
                            <!-- Animated Numbers -->
                            <transition-group name="slide-up">
                                <span :key="value" class="absolute text-5xl md:text-7xl font-bold bg-clip-text text-transparent bg-gradient-to-br from-white to-slate-400 font-sans">
                                    {{ formatNumber(value) }}
                                </span>
                            </transition-group>
                        </div>
                        <span class="mt-4 text-xs md:text-sm font-bold tracking-widest uppercase text-slate-400">{{ label }}</span>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-col md:flex-row gap-4 justify-center items-center">
                    <button @click="addToCalendar" class="group relative px-8 py-3 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 rounded-full text-white font-medium transition-all hover:shadow-[0_0_20px_rgba(255,255,255,0.3)] flex items-center gap-2">
                        <i class="far fa-calendar-alt"></i>
                        <span>Save to Calendar</span>
                        <div class="absolute inset-0 rounded-full bg-white opacity-0 group-hover:opacity-10 transition-opacity"></div>
                    </button>
                    
                    <button @click="reset" class="text-slate-400 hover:text-white text-sm underline underline-offset-4 transition-colors">
                        Edit Event
                    </button>
                </div>

            </div>
            
            <!-- Footer/Credit -->
            <div class="absolute bottom-6 text-slate-500 text-xs tracking-widest opacity-60">
                LIVE EVENT COUNTDOWN
            </div>
        </div>
    </transition>

</div>

<script>
    const {createApp, ref, computed, onMounted, onUnmounted, reactive} = Vue;

    createApp({
        setup() {
            // --- State ---
            const state = ref('setup'); // 'setup' or 'countdown'
            const timerInterval = ref(null);
            
            const form = reactive({
                name: '',
                date: '',
                time: '',
                location: '',
                bgImagePreview: null
            });

            const finalEvent = reactive({
                name: '',
                dateObj: null,
                location: '',
                image: ''
            });

            const timeLeft = reactive({
                Days: 0,
                Hours: 0,
                Minutes: 0,
                Seconds: 0
            });

            const parallax = reactive({ x: 0, y: 0 });

            // --- Default Image (Abstract Geometric) ---
            const defaultImage = "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=2940&auto=format&fit=crop"; 

            // --- Computed ---
            const formattedDate = computed(() => {
                if (!finalEvent.dateObj) return '';
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                return finalEvent.dateObj.toLocaleDateString(undefined, options);
            });

            // --- Methods ---

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        form.bgImagePreview = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const formatNumber = (num) => {
                return num < 10 ? `0${num}` : num;
            };

            const calculateTimeLeft = () => {
                const now = new Date().getTime();
                const distance = finalEvent.dateObj.getTime() - now;

                if (distance < 0) {
                    // Event Passed
                    timeLeft.Days = 0;
                    timeLeft.Hours = 0;
                    timeLeft.Minutes = 0;
                    timeLeft.Seconds = 0;
                    clearInterval(timerInterval.value);
                    return;
                }

                timeLeft.Days = Math.floor(distance / (1000 * 60 * 60 * 24));
                timeLeft.Hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                timeLeft.Minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                timeLeft.Seconds = Math.floor((distance % (1000 * 60)) / 1000);
            };

            const startCountdown = () => {
                if (!form.name || !form.date || !form.time) return;

                finalEvent.name = form.name;
                finalEvent.location = form.location;
                // Combine date and time
                finalEvent.dateObj = new Date(`${form.date}T${form.time}`);
                finalEvent.image = form.bgImagePreview || defaultImage;

                state.value = 'countdown';
                
                calculateTimeLeft(); // Initial call
                timerInterval.value = setInterval(calculateTimeLeft, 1000);
            };

            const reset = () => {
                clearInterval(timerInterval.value);
                state.value = 'setup';
            };

            const handleMouseMove = (e) => {
                const x = (window.innerWidth - e.pageX * 2) / 50;
                const y = (window.innerHeight - e.pageY * 2) / 50;
                parallax.x = x;
                parallax.y = y;
            };

            const addToCalendar = () => {
                if (!finalEvent.dateObj) return;

                const startDate = finalEvent.dateObj;
                const endDate = new Date(startDate.getTime() + (60 * 60 * 1000)); // Default 1 hour duration

                const formatDate = (date) => {
                    return date.toISOString().replace(/-|:|"\.\d\d\d/g, "");
                };

                const icsContent = [
                    'BEGIN:VCALENDAR',
                    'VERSION:2.0',
                    'BEGIN:VEVENT',
                    `DTSTART:${formatDate(startDate)}`,
                    `DTEND:${formatDate(endDate)}`,
                    `SUMMARY:${finalEvent.name}`,
                    `LOCATION:${finalEvent.location}`,
                    'DESCRIPTION:Countdown Event',
                    'END:VEVENT',
                    'END:VCALENDAR'
                ].join('\n');

                const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
                const link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.setAttribute('download', `${finalEvent.name.replace(/\s+/g, '_')}.ics`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            // Pre-fill for demo purposes if empty
            onMounted(() => {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 3);
                tomorrow.setHours(20, 0, 0, 0);
                
                form.date = tomorrow.toISOString().split('T')[0];
                form.time = "20:00";
            });

            onUnmounted(() => {
                if (timerInterval.value) clearInterval(timerInterval.value);
            });

            return {
                state,
                form,
                finalEvent,
                timeLeft,
                parallax,
                formattedDate,
                handleImageUpload,
                startCountdown,
                handleMouseMove,
                addToCalendar,
                reset,
                formatNumber
            };
        }
    }).mount('#app');
</script>
</body>
</html>