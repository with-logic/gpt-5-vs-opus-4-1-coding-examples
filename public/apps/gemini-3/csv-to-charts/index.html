<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Visualization Playground</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }

        .drop-zone {
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
        .drop-zone.active {
            background-color: #f0f9ff;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%230EA5E9FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Icons ---
        const IconUpload = () => <i className="fa-solid fa-cloud-arrow-up text-3xl mb-3 text-gray-400"></i>;
        const IconChart = () => <i className="fa-solid fa-chart-simple mr-2"></i>;
        const IconSettings = () => <i className="fa-solid fa-sliders mr-2"></i>;
        const IconDownload = () => <i className="fa-solid fa-download mr-2"></i>;
        const IconTable = () => <i className="fa-solid fa-table mr-2"></i>;
        const IconTrash = () => <i className="fa-solid fa-trash mr-2"></i>;

        // --- Sample Data for Demo ---
        const SAMPLE_DATA = [
            { Month: 'Jan', Sales: 150, Profit: 50, Users: 1200 },
            { Month: 'Feb', Sales: 230, Profit: 80, Users: 1400 },
            { Month: 'Mar', Sales: 180, Profit: 60, Users: 1100 },
            { Month: 'Apr', Sales: 320, Profit: 120, Users: 1800 },
            { Month: 'May', Sales: 290, Profit: 100, Users: 1700 },
            { Month: 'Jun', Sales: 350, Profit: 140, Users: 2100 },
        ];

        // --- Helper Components ---
        
        const Button = ({ children, onClick, variant = 'primary', className = '', ...props }) => {
            const baseClass = "px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-offset-2";
            const variants = {
                primary: "bg-primary-600 hover:bg-primary-700 text-white focus:ring-primary-500 shadow-sm",
                secondary: "bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 focus:ring-gray-200 shadow-sm",
                danger: "bg-red-50 hover:bg-red-100 text-red-600 border border-red-200 focus:ring-red-200",
                ghost: "bg-transparent hover:bg-gray-100 text-gray-600"
            };
            return (
                <button 
                    className={`${baseClass} ${variants[variant]} ${className}`} 
                    onClick={onClick}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        const Label = ({ children, htmlFor }) => (
            <label htmlFor={htmlFor} className="block text-sm font-medium text-gray-700 mb-1">
                {children}
            </label>
        );

        const Select = ({ id, value, onChange, options, label }) => (
            <div className="mb-4">
                {label && <Label htmlFor={id}>{label}</Label>}
                <div className="relative">
                    <select
                        id={id}
                        value={value}
                        onChange={onChange}
                        className="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md shadow-sm border appearance-none bg-white"
                    >
                        {options.map(opt => (
                            <option key={opt.value} value={opt.value}>{opt.label}</option>
                        ))}
                    </select>
                    <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                        <i className="fa-solid fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>
        );

        const ColorPicker = ({ label, color, onChange }) => (
            <div className="mb-4">
                {label && <Label>{label}</Label>}
                <div className="flex items-center space-x-3">
                    <input 
                        type="color" 
                        value={color} 
                        onChange={(e) => onChange(e.target.value)}
                        className="h-10 w-10 p-1 rounded border border-gray-300 cursor-pointer shadow-sm"
                    />
                    <input 
                        type="text" 
                        value={color} 
                        onChange={(e) => onChange(e.target.value)}
                        className="flex-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2"
                    />
                </div>
            </div>
        );

        // --- Main Application ---

        const App = () => {
            const [data, setData] = useState(null);
            const [columns, setColumns] = useState([]);
            const [filename, setFilename] = useState("");
            
            // Chart Configuration State
            const [config, setConfig] = useState({
                type: 'bar',
                xKey: '',
                yKey: '',
                yKey2: '', // Optional second dataset
                title: 'My Awesome Chart',
                color: '#0ea5e9',
                color2: '#8b5cf6',
                gridLines: true,
                fill: false,
                tension: 0.4
            });

            // Refs
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            const fileInputRef = useRef(null);

            // Load Sample Data on Init
            useEffect(() => {
               loadData(SAMPLE_DATA, "Sample Data.csv"); 
            }, []);

            const loadData = (parsedData, name) => {
                if (!parsedData || parsedData.length === 0) return;
                
                const cols = Object.keys(parsedData[0]);
                setData(parsedData);
                setColumns(cols);
                setFilename(name);

                // Smart defaults
                let potentialX = cols.find(c => c.toLowerCase().includes('date') || c.toLowerCase().includes('month') || c.toLowerCase().includes('year') || c.toLowerCase().includes('name')) || cols[0];
                let potentialY = cols.find(c => c !== potentialX && typeof parsedData[0][c] === 'number') || cols[1];
                
                setConfig(prev => ({
                    ...prev,
                    xKey: potentialX,
                    yKey: potentialY || cols[1],
                    yKey2: '', // Reset second series
                    title: name.replace('.csv', '')
                }));
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                parseFile(file);
            };

            const parseFile = (file) => {
                Papa.parse(file, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        loadData(results.data, file.name);
                    },
                    error: (err) => {
                        alert("Error parsing CSV: " + err.message);
                    }
                });
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                e.currentTarget.classList.add('active');
            };

            const handleDragLeave = (e) => {
                e.currentTarget.classList.remove('active');
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.currentTarget.classList.remove('active');
                const file = e.dataTransfer.files[0];
                if (file && file.type === "text/csv" || file.name.endsWith('.csv')) {
                    parseFile(file);
                } else {
                    alert("Please drop a CSV file.");
                }
            };

            // Chart Rendering Logic
            useEffect(() => {
                if (!data || !chartRef.current) return;

                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const ctx = chartRef.current.getContext('2d');
                
                // Prepare Datasets
                const labels = data.map(row => row[config.xKey]);
                
                const datasets = [{
                    label: config.yKey,
                    data: data.map(row => row[config.yKey]),
                    backgroundColor: config.type === 'pie' || config.type === 'doughnut' 
                        ? [config.color, config.color2, '#f59e0b', '#10b981', '#ef4444', '#6366f1'] // Multiple colors for pie
                        : (config.type === 'line' || config.type === 'radar' ? config.color + '20' : config.color), // Transparent fill for line
                    borderColor: config.color,
                    borderWidth: 2,
                    fill: config.fill,
                    tension: config.tension,
                    pointBackgroundColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }];

                if (config.yKey2 && config.type !== 'pie' && config.type !== 'doughnut') {
                    datasets.push({
                        label: config.yKey2,
                        data: data.map(row => row[config.yKey2]),
                        backgroundColor: config.type === 'line' ? config.color2 + '20' : config.color2,
                        borderColor: config.color2,
                        borderWidth: 2,
                        fill: config.fill,
                        tension: config.tension,
                        pointBackgroundColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    });
                }

                chartInstance.current = new Chart(ctx, {
                    type: config.type,
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: { family: "'Inter', sans-serif", size: 12 }
                                }
                            },
                            title: {
                                display: true,
                                text: config.title,
                                font: { family: "'Inter', sans-serif", size: 18, weight: 'bold' },
                                padding: { bottom: 20 },
                                color: '#1f2937'
                            },
                            tooltip: {
                                backgroundColor: 'rgba(255, 255, 255, 0.95)',
                                titleColor: '#1f2937',
                                bodyColor: '#4b5563',
                                borderColor: '#e5e7eb',
                                borderWidth: 1,
                                padding: 12,
                                cornerRadius: 8,
                                displayColors: true,
                                boxPadding: 6
                            }
                        },
                        scales: (config.type === 'pie' || config.type === 'doughnut' || config.type === 'radar') ? {} : {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    display: config.gridLines,
                                    color: '#f3f4f6'
                                },
                                ticks: { font: { family: "'Inter', sans-serif" } }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: { font: { family: "'Inter', sans-serif" } }
                            }
                        }
                    }
                });

                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };

            }, [data, config]);

            const downloadChart = () => {
                if (!chartInstance.current) return;
                const link = document.createElement('a');
                link.download = `chart-${Date.now()}.png`;
                link.href = chartInstance.current.toBase64Image();
                link.click();
            };

            const clearData = () => {
                setData(null);
                setFilename("");
                if (fileInputRef.current) fileInputRef.current.value = "";
            };

            return (
                <div className="flex h-screen flex-col md:flex-row overflow-hidden">
                    
                    {/* Sidebar */}
                    <aside className="w-full md:w-80 bg-white border-r border-gray-200 flex flex-col h-full z-10 shadow-lg overflow-y-auto">
                        <div className="p-6 border-b border-gray-200 bg-white sticky top-0 z-20">
                            <h1 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <span className="bg-primary-600 text-white p-1.5 rounded-lg text-sm"><i className="fa-solid fa-chart-line"></i></span>
                                DataViz
                            </h1>
                            <p className="text-xs text-gray-500 mt-1">Playground</p>
                        </div>

                        <div className="p-6 space-y-8 flex-1">
                            {/* Upload Section */}
                            <section>
                                <h2 className="text-xs uppercase tracking-wider text-gray-400 font-bold mb-4">Data Source</h2>
                                <div 
                                    className="drop-zone border-2 border-dashed border-gray-300 rounded-xl p-6 text-center cursor-pointer hover:border-primary-400 group"
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                    onClick={() => fileInputRef.current?.click()}
                                >
                                    <input 
                                        type="file" 
                                        ref={fileInputRef}
                                        onChange={handleFileUpload}
                                        accept=".csv"
                                        className="hidden"
                                    />
                                    <IconUpload />
                                    <p className="text-sm font-medium text-gray-700 group-hover:text-primary-600">
                                        Click or Drop CSV
                                    </p>
                                    <p className="text-xs text-gray-400 mt-1">max 5MB</p>
                                </div>
                                {filename && (
                                    <div className="mt-3 flex items-center justify-between bg-gray-50 p-2 rounded border border-gray-200">
                                        <div className="flex items-center truncate">
                                            <i className="fa-solid fa-file-csv text-green-600 mr-2"></i>
                                            <span className="text-sm text-gray-600 truncate max-w-[120px]" title={filename}>{filename}</span>
                                        </div>
                                        <button onClick={clearData} className="text-gray-400 hover:text-red-500 p-1">
                                            <i className="fa-solid fa-xmark"></i>
                                        </button>
                                    </div>
                                )}
                            </section>

                            {/* Config Section */}
                            {data && (
                                <section className="animate-fade-in">
                                    <h2 className="text-xs uppercase tracking-wider text-gray-400 font-bold mb-4 flex items-center">
                                        <IconSettings /> Chart Settings
                                    </h2>
                                    
                                    <Select 
                                        id="chartType"
                                        label="Chart Type"
                                        value={config.type}
                                        onChange={(e) => setConfig({...config, type: e.target.value})}
                                        options={[
                                            { value: 'bar', label: 'Bar Chart' },
                                            { value: 'line', label: 'Line Chart' },
                                            { value: 'pie', label: 'Pie Chart' },
                                            { value: 'doughnut', label: 'Doughnut Chart' },
                                            { value: 'radar', label: 'Radar Chart' },
                                            { value: 'scatter', label: 'Scatter Plot' },
                                        ]}
                                    />

                                    <Select 
                                        id="xKey"
                                        label="X Axis (Labels)"
                                        value={config.xKey}
                                        onChange={(e) => setConfig({...config, xKey: e.target.value})}
                                        options={columns.map(c => ({ value: c, label: c }))}
                                    />

                                    <Select 
                                        id="yKey"
                                        label="Y Axis (Data Series 1)"
                                        value={config.yKey}
                                        onChange={(e) => setConfig({...config, yKey: e.target.value})}
                                        options={columns.map(c => ({ value: c, label: c }))}
                                    />

                                    <Select 
                                        id="yKey2"
                                        label="Y Axis (Data Series 2 - Optional)"
                                        value={config.yKey2}
                                        onChange={(e) => setConfig({...config, yKey2: e.target.value})}
                                        options={[{value: '', label: 'None'}, ...columns.map(c => ({ value: c, label: c }))]}
                                    />

                                    <div className="pt-4 border-t border-gray-100">
                                        <h3 className="text-sm font-medium text-gray-700 mb-3">Appearance</h3>
                                        <div className="mb-4">
                                            <Label htmlFor="chartTitle">Chart Title</Label>
                                            <input 
                                                type="text" 
                                                id="chartTitle"
                                                value={config.title} 
                                                onChange={(e) => setConfig({...config, title: e.target.value})}
                                                className="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2"
                                            />
                                        </div>
                                        
                                        <ColorPicker 
                                            label="Primary Color" 
                                            color={config.color} 
                                            onChange={(val) => setConfig({...config, color: val})} 
                                        />

                                        {config.yKey2 && (
                                            <ColorPicker 
                                                label="Secondary Color" 
                                                color={config.color2} 
                                                onChange={(val) => setConfig({...config, color2: val})} 
                                            />
                                        )}

                                        <div className="flex items-center gap-4 mt-4">
                                            <label className="flex items-center text-sm text-gray-600 cursor-pointer">
                                                <input 
                                                    type="checkbox" 
                                                    checked={config.gridLines}
                                                    onChange={(e) => setConfig({...config, gridLines: e.target.checked})}
                                                    className="rounded border-gray-300 text-primary-600 focus:ring-primary-500 mr-2"
                                                />
                                                Grid Lines
                                            </label>
                                            
                                            {(config.type === 'line' || config.type === 'radar') && (
                                                <label className="flex items-center text-sm text-gray-600 cursor-pointer">
                                                    <input 
                                                        type="checkbox" 
                                                        checked={config.fill}
                                                        onChange={(e) => setConfig({...config, fill: e.target.checked})}
                                                        className="rounded border-gray-300 text-primary-600 focus:ring-primary-500 mr-2"
                                                    />
                                                    Fill Area
                                                </label>
                                            )}
                                        </div>
                                    </div>
                                </section>
                            )}
                        </div>
                        
                        <div className="p-4 border-t border-gray-200 text-center text-xs text-gray-400">
                            &copy; 2026 DataViz Playground
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col h-full overflow-hidden bg-gray-50 relative">
                        {/* Toolbar */}
                        <header className="bg-white border-b border-gray-200 px-8 py-4 flex justify-between items-center shadow-sm z-10">
                            <div className="flex items-center text-gray-500 text-sm">
                                <span className="mr-2"><IconTable /></span>
                                {data ? (
                                    <span>Loaded {data.length} rows, {columns.length} columns</span>
                                ) : (
                                    <span>Waiting for data...</span>
                                )}
                            </div>
                            <div className="flex gap-3">
                                {data && (
                                    <>
                                        <Button variant="secondary" onClick={() => loadData(SAMPLE_DATA, "Sample Data.csv")}>
                                            Reset Sample
                                        </Button>
                                        <Button onClick={downloadChart}>
                                            <IconDownload /> Export PNG
                                        </Button>
                                    </>
                                )}
                            </div>
                        </header>

                        {/* Visualization Area */}
                        <div className="flex-1 p-4 md:p-8 overflow-y-auto">
                            {!data ? (
                                <div className="h-full flex flex-col items-center justify-center text-gray-400 space-y-4">
                                    <div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center">
                                        <i className="fa-solid fa-chart-pie text-4xl text-gray-300"></i>
                                    </div>
                                    <p className="text-lg">Upload a CSV file to get started</p>
                                    <Button variant="ghost" onClick={() => loadData(SAMPLE_DATA, "Sample Data.csv")}>
                                        Load Sample Data
                                    </Button>
                                </div>
                            ) : (
                                <div className="space-y-6">
                                    {/* Chart Container */}
                                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 h-[500px] relative">
                                        <canvas ref={chartRef}></canvas>
                                    </div>

                                    {/* Data Table Preview (First 10 rows) */}
                                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                        <div className="px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
                                            <h3 className="font-semibold text-gray-700">Data Preview</h3>
                                            <span className="text-xs text-gray-500">Showing first 10 rows</span>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="min-w-full divide-y divide-gray-200">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        {columns.map((col, idx) => (
                                                            <th key={idx} scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">
                                                                {col}
                                                            </th>
                                                        ))}
                                                    </tr>
                                                </thead>
                                                <tbody className="bg-white divide-y divide-gray-200">
                                                    {data.slice(0, 10).map((row, rIdx) => (
                                                        <tr key={rIdx} className="hover:bg-gray-50 transition-colors">
                                                            {columns.map((col, cIdx) => (
                                                                <td key={cIdx} className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                                    {row[col]}
                                                                </td>
                                                            ))}
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
