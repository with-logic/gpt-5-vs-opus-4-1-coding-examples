<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tea Dunkability Simulator</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
        }

        /* Custom Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        @keyframes steam {
            0% { transform: translateY(0) scale(1); opacity: 0.6; }
            50% { opacity: 0.3; }
            100% { transform: translateY(-40px) scale(1.5); opacity: 0; }
        }

        @keyframes dunk {
            0% { transform: translateY(0); }
            40% { transform: translateY(60px); } /* Into the tea */
            60% { transform: translateY(60px); } /* Hold */
            100% { transform: translateY(0); }
        }

        @keyframes crumbleFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(200px) rotate(360deg); opacity: 0; }
        }

        .steam-particle {
            animation: steam 3s infinite linear;
        }
        
        .dunk-action {
            animation: dunk 2s ease-in-out forwards;
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        /* Range Input Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #d97706;
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 0 2px rgba(255,255,255,0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(128, 128, 128, 0.3);
            border-radius: 2px;
        }

        input[type=range]:focus {
            outline: none;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        tea: {
                            100: '#fef3c7',
                            300: '#fcd34d',
                            500: '#d97706',
                            700: '#b45309',
                            900: '#78350f',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 dark:from-slate-900 dark:to-slate-800 text-slate-800 dark:text-slate-100 transition-colors duration-500 min-h-screen flex items-center justify-center">

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useMemo, useCallback } = React;

    // --- Data & Constants ---
    
    const BISCUITS = [
        { id: 'digestive', name: 'Digestive', integrity: 60, absorbency: 1.2, color: '#D2B48C', texture: 'dots' },
        { id: 'hobnob', name: 'Oaty Nob', integrity: 85, absorbency: 0.8, color: '#C19A6B', texture: 'rough' },
        { id: 'rich-tea', name: 'Rich Tea', integrity: 35, absorbency: 1.5, color: '#F4D0A4', texture: 'smooth' },
        { id: 'ginger-nut', name: 'Ginger Snap', integrity: 95, absorbency: 0.5, color: '#A0522D', texture: 'cracked' },
        { id: 'shortbread', name: 'Shortbread', integrity: 50, absorbency: 1.8, color: '#FFF8DC', texture: 'buttery' },
    ];

    const STATUS = {
        DRY: { label: 'Dry as a Bone', color: 'text-slate-500' },
        MOIST: { label: 'Pleasantly Moist', color: 'text-blue-500' },
        PERFECT: { label: 'Dunking Nirvana', color: 'text-green-500' },
        SOGGY: { label: 'Dangerously Soggy', color: 'text-orange-500' },
        CRUMBLED: { label: 'Structural Failure', color: 'text-red-600' },
    };

    // --- Components ---

    const Icon = ({ path, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            {path}
        </svg>
    );

    const Icons = {
        Sun: <Icon path={<><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></>} className="w-5 h-5" />,
        Moon: <Icon path={<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>} className="w-5 h-5" />,
        Thermometer: <Icon path={<path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/>} className="w-5 h-5" />,
        Clock: <Icon path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} className="w-5 h-5" />,
        Shield: <Icon path={<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>} className="w-5 h-5" />,
        Refresh: <Icon path={<path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>} className="w-5 h-5" />,
        Play: <Icon path={<polygon points="5 3 19 12 5 21 5 3"/>} className="w-5 h-5" />
    };

    const Slider = ({ label, icon, value, min, max, onChange, unit, disabled }) => (
        <div className="mb-4">
            <div className="flex justify-between items-center mb-1">
                <div className="flex items-center gap-2 text-sm font-medium opacity-80">
                    {icon}
                    {label}
                </div>
                <span className="text-sm font-bold font-mono">{value}{unit}</span>
            </div>
            <input 
                type="range" 
                min={min} 
                max={max} 
                value={value} 
                onChange={(e) => onChange(Number(e.target.value))}
                disabled={disabled}
                className={`w-full h-2 rounded-lg appearance-none cursor-pointer bg-slate-200 dark:bg-slate-700 accent-tea-500 ${disabled ? 'opacity-50 cursor-not-allowed' : ''}`}
            />
        </div>
    );

    const CrumbleMeter = ({ score, threshold, isDunking }) => {
        let percentage = Math.min((score / threshold) * 100, 100);
        let colorClass = 'bg-blue-400';
        
        if (percentage > 25) colorClass = 'bg-blue-500';
        if (percentage > 50) colorClass = 'bg-green-500'; // Optimal
        if (percentage > 85) colorClass = 'bg-orange-500'; // Danger
        if (score >= threshold) colorClass = 'bg-red-600'; // Dead

        // When dunking, we animate slowly (2s) to match the dunk. Otherwise snap (300ms).
        const transitionClass = isDunking ? 'duration-[2000ms] ease-in-out' : 'duration-300 ease-out';

        return (
            <div className="mt-6 p-4 rounded-xl glass dark:glass-dark">
                <h3 className="text-sm font-semibold uppercase tracking-wider opacity-70 mb-2">Crumble-o-meter</h3>
                <div className="relative h-6 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                    <div 
                        className={`absolute top-0 left-0 h-full transition-all ${transitionClass} ${colorClass}`} 
                        style={{ width: `${percentage}%` }}
                    ></div>
                    {/* Tick marks */}
                    <div className="absolute top-0 left-[50%] h-full w-0.5 bg-white/30"></div>
                    <div className="absolute top-0 left-[85%] h-full w-0.5 bg-red-500/50"></div>
                </div>
                <div className="flex justify-between text-xs mt-1 opacity-60">
                    <span>Dry</span>
                    <span>Perfect</span>
                    <span>Danger</span>
                    <span>Mush</span>
                </div>
            </div>
        );
    };

    const TeaCup = ({ temp, dunking, crumbled, biscuitColor }) => {
        const steamOpacity = Math.max(0, (temp - 50) / 50);

        return (
            <div className="relative w-48 h-48 mx-auto mt-10">
                {/* Steam */}
                <div className="absolute -top-10 left-10 w-4 h-4 bg-white rounded-full blur-xl steam-particle" style={{ opacity: steamOpacity, animationDelay: '0s' }}></div>
                <div className="absolute -top-16 left-20 w-5 h-5 bg-white rounded-full blur-xl steam-particle" style={{ opacity: steamOpacity, animationDelay: '1s' }}></div>
                <div className="absolute -top-8 left-28 w-3 h-3 bg-white rounded-full blur-xl steam-particle" style={{ opacity: steamOpacity, animationDelay: '0.5s' }}></div>

                {/* Cup Handle */}
                <div className="absolute top-8 -right-4 w-12 h-20 border-4 border-slate-200 dark:border-slate-600 rounded-r-2xl transform rotate-12"></div>

                {/* Cup Body */}
                <div className="relative z-10 w-full h-full bg-white dark:bg-slate-800 rounded-b-[40%] rounded-t-sm shadow-xl border-t-0 overflow-hidden flex items-end justify-center">
                    {/* Tea Liquid */}
                    <div className="w-full h-[85%] bg-tea-700 opacity-90 relative overflow-hidden transition-colors duration-1000">
                        <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-tea-900/20 to-transparent"></div>
                        
                        {/* Ripples */}
                        {dunking && (
                             <div className="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-4 border-2 border-white/20 rounded-[100%] animate-ping"></div>
                        )}

                        {/* Debris if crumbled */}
                        {crumbled && (
                            <div className="absolute bottom-0 w-full h-12 bg-tea-900/40 blur-sm flex justify-center items-center">
                                <span className="text-xs text-white/50">Mushy Sadness</span>
                            </div>
                        )}
                    </div>
                </div>

                {/* Biscuit Animation Container */}
                <div className={`absolute -top-20 left-1/2 -translate-x-1/2 z-0 ${dunking ? 'dunk-action' : ''} transition-transform duration-300`}>
                     {!crumbled ? (
                        <div 
                            className="w-20 h-20 rounded-full shadow-lg border-4 border-black/5 flex items-center justify-center relative overflow-hidden"
                            style={{ backgroundColor: biscuitColor }}
                        >
                            <div className="opacity-20 text-[8px] leading-3 text-center w-full select-none text-black font-serif">
                                . . . : : . .<br/>: . : . : :<br/>. : . . : .
                            </div>
                        </div>
                     ) : (
                         <div className="relative"></div>
                     )}
                </div>
            </div>
        );
    };

    const Particles = ({ active, color }) => {
        if (!active) return null;
        
        const particles = useMemo(() => {
            return Array.from({ length: 20 }).map((_, i) => ({
                id: i,
                delay: Math.random() * 0.5 + 's',
                size: Math.random() * 6 + 4 + 'px',
                xOffset: Math.random() * 200 - 100 // -100 to 100
            }));
        }, [active]);

        return (
            <div className="absolute inset-0 pointer-events-none overflow-hidden z-50">
                {particles.map(p => (
                    <div 
                        key={p.id}
                        className="absolute rounded-full"
                        style={{
                            width: p.size,
                            height: p.size,
                            backgroundColor: color,
                            left: `calc(50% + ${p.xOffset}px)`,
                            top: '30%',
                            animation: `crumbleFall 1.5s ease-in forwards`,
                            animationDelay: p.delay
                        }}
                    ></div>
                ))}
            </div>
        );
    };

    const App = () => {
        const [darkMode, setDarkMode] = useState(true);
        const [temp, setTemp] = useState(85);
        const [time, setTime] = useState(3);
        const [integrityMod, setIntegrityMod] = useState(0);
        const [selectedBiscuitId, setSelectedBiscuitId] = useState('digestive');
        
        const [dunking, setDunking] = useState(false);
        const [simResult, setSimResult] = useState(null);
        const [crumbs, setCrumbs] = useState(false);

        const biscuit = BISCUITS.find(b => b.id === selectedBiscuitId) || BISCUITS[0];
        const totalIntegrity = Math.max(10, Math.min(100, biscuit.integrity + integrityMod));

        // Physics Logic
        const calculateDamage = useCallback(() => {
            const heatFactor = Math.pow((temp - 20) / 80, 2) * 20 + 2; 
            const damage = time * heatFactor * biscuit.absorbency * 3.5;
            const threshold = totalIntegrity * 10;
            return { damage, threshold };
        }, [temp, time, biscuit, totalIntegrity]);

        // Current 'live' damage (used for prediction on meter)
        const currentStats = calculateDamage();

        useEffect(() => {
            if (darkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }, [darkMode]);

        useEffect(() => {
            const handleKeyDown = (e) => {
                if (dunking) return;
                
                if (e.key === ' ' || e.key.toLowerCase() === 'd') {
                    e.preventDefault(); // Prevent scrolling
                    handleDunk();
                }
                if (e.key.toLowerCase() === 'r') resetSim();
                if (e.key === 'ArrowUp') setTime(p => Math.min(20, p + 1));
                if (e.key === 'ArrowDown') setTime(p => Math.max(1, p - 1));
                if (e.key === 'ArrowRight') setTemp(p => Math.min(100, p + 5));
                if (e.key === 'ArrowLeft') setTemp(p => Math.max(20, p - 5));
            };
            window.addEventListener('keydown', handleKeyDown);
            return () => window.removeEventListener('keydown', handleKeyDown);
        }, [dunking, temp, time, selectedBiscuitId, integrityMod]);

        const resetSim = () => {
            setDunking(false);
            setSimResult(null);
            setCrumbs(false);
        };

        const handleDunk = () => {
            if (dunking) return;
            resetSim();
            setDunking(true);

            const { damage, threshold } = calculateDamage();
            
            setTimeout(() => {
                let status = STATUS.DRY;
                const ratio = damage / threshold;

                if (ratio < 0.3) status = STATUS.DRY;
                else if (ratio < 0.6) status = STATUS.MOIST;
                else if (ratio < 0.85) status = STATUS.PERFECT;
                else if (ratio < 1.0) status = STATUS.SOGGY;
                else status = STATUS.CRUMBLED;

                setSimResult({ status, score: damage, threshold });
                setDunking(false);

                if (status === STATUS.CRUMBLED) {
                    setCrumbs(true);
                }
            }, 2000); 
        };

        // If a result exists, show that. Otherwise, if dunking or just waiting, show calculated potential damage.
        // We want the meter to start at 0 when dunking starts and fill up.
        // But since we can't easily animate the value 'up' via React state without a timer loop,
        // we use CSS transition. We need to toggle from 0 to 'Damage' when dunking starts.
        
        // State for the meter visualization
        const [meterValue, setMeterValue] = useState(0);
        
        useEffect(() => {
            if (dunking) {
                // Trigger animation up to target
                // Small delay to allow '0' to be set if it was reset
                requestAnimationFrame(() => setMeterValue(currentStats.damage));
            } else if (simResult) {
                setMeterValue(simResult.score);
            } else {
                setMeterValue(0);
            }
        }, [dunking, simResult, currentStats.damage]);

        return (
            <div className="relative w-full max-w-4xl p-4 md:p-8 flex flex-col md:flex-row gap-8 items-start justify-center">
                
                <button 
                    onClick={() => setDarkMode(!darkMode)}
                    className="fixed top-4 right-4 p-2 rounded-full glass dark:glass-dark hover:scale-110 transition-transform z-50 text-slate-800 dark:text-white"
                >
                    {darkMode ? Icons.Sun : Icons.Moon}
                </button>

                {/* Left Panel: Controls */}
                <div className="w-full md:w-1/3 flex flex-col gap-6 animate-[float_6s_ease-in-out_infinite]">
                    <div className="glass dark:glass-dark p-6 rounded-2xl shadow-xl backdrop-blur-xl">
                        <h1 className="text-2xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-tea-500 to-orange-600 dark:from-tea-300 dark:to-orange-400">
                            Tea Dunkability<br/><span className="text-lg font-normal text-slate-600 dark:text-slate-300">Simulator 2026</span>
                        </h1>

                        <div className="mb-6">
                            <label className="block text-sm font-medium mb-2 opacity-80">Biscuit Selection</label>
                            <div className="grid grid-cols-2 gap-2">
                                {BISCUITS.map(b => (
                                    <button
                                        key={b.id}
                                        onClick={() => { resetSim(); setSelectedBiscuitId(b.id); }}
                                        disabled={dunking}
                                        className={`p-2 text-xs rounded-lg border transition-all ${
                                            selectedBiscuitId === b.id 
                                            ? 'bg-tea-500 text-white border-tea-600 shadow-md transform scale-105' 
                                            : 'bg-white/50 dark:bg-slate-700/50 border-transparent hover:border-tea-300'
                                        } ${dunking ? 'opacity-50 cursor-not-allowed' : ''}`}
                                    >
                                        {b.name}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <Slider 
                            label="Tea Temperature" 
                            icon={Icons.Thermometer} 
                            value={temp} 
                            min={20} 
                            max={100} 
                            unit="Â°C" 
                            onChange={setTemp}
                            disabled={dunking}
                        />
                        
                        <Slider 
                            label="Dunk Time" 
                            icon={Icons.Clock} 
                            value={time} 
                            min={1} 
                            max={20} 
                            unit="s" 
                            onChange={setTime}
                            disabled={dunking}
                        />
                        
                        <Slider 
                            label="Structural Integrity" 
                            icon={Icons.Shield} 
                            value={totalIntegrity} 
                            min={10} 
                            max={100} 
                            unit="%" 
                            onChange={(val) => setIntegrityMod(val - biscuit.integrity)}
                            disabled={dunking}
                        />

                        <div className="mt-8 flex gap-3">
                            <button 
                                onClick={handleDunk}
                                disabled={dunking}
                                className={`flex-1 py-3 rounded-xl font-bold text-white shadow-lg flex items-center justify-center gap-2 transition-all
                                    ${dunking ? 'bg-slate-400 cursor-not-allowed' : 'bg-gradient-to-r from-tea-500 to-orange-600 hover:shadow-orange-500/20 hover:scale-105 active:scale-95'}
                                `}
                            >
                                {dunking ? 'Dunking...' : <>{Icons.Play} DUNK</>}
                            </button>
                            
                            <button 
                                onClick={resetSim}
                                className="p-3 rounded-xl glass dark:glass-dark hover:bg-white/20 active:scale-95 transition-all"
                                title="Reset (R)"
                            >
                                {Icons.Refresh}
                            </button>
                        </div>
                         <div className="mt-2 text-center text-xs opacity-50">
                            Press 'Space' to Dunk, 'R' to Reset
                        </div>
                    </div>
                </div>

                {/* Right Panel: Simulation & Results */}
                <div className="w-full md:w-1/2 flex flex-col gap-6">
                    
                    {/* Visualizer Card */}
                    <div className="relative h-80 glass dark:glass-dark rounded-3xl flex items-center justify-center overflow-hidden shadow-2xl border-t border-white/20">
                        <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-blue-50/20 to-purple-50/20 dark:from-blue-900/10 dark:to-purple-900/10"></div>
                        
                        <TeaCup 
                            temp={temp} 
                            dunking={dunking} 
                            crumbled={crumbs}
                            biscuitColor={biscuit.color}
                        />
                        
                        <Particles active={crumbs} color={biscuit.color} />

                        {/* Result Overlay */}
                        {simResult && !dunking && (
                            <div className="absolute inset-0 bg-white/60 dark:bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center z-50 animate-in fade-in duration-300">
                                <h2 className={`text-3xl font-bold mb-2 ${simResult.status.color}`}>
                                    {simResult.status.label}
                                </h2>
                                <p className="text-sm opacity-75">
                                    Integrity Remaining: {Math.max(0, Math.round((1 - simResult.score/simResult.threshold)*100))}%
                                </p>
                                <button 
                                    onClick={resetSim}
                                    className="mt-6 px-6 py-2 bg-white dark:bg-slate-800 rounded-full shadow-lg text-sm font-semibold hover:scale-105 transition-transform"
                                >
                                    Try Again
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Stats Card */}
                    <CrumbleMeter 
                        score={meterValue}
                        threshold={totalIntegrity * 10} 
                        isDunking={dunking}
                    />

                    <div className="grid grid-cols-2 gap-4">
                         <div className="glass dark:glass-dark p-4 rounded-xl">
                            <h4 className="text-xs uppercase tracking-wide opacity-50 mb-1">Risk Factor</h4>
                            <p className="text-xl font-bold text-tea-500">
                                {Math.round((temp * time) / totalIntegrity * 10) / 10}x
                            </p>
                         </div>
                         <div className="glass dark:glass-dark p-4 rounded-xl">
                            <h4 className="text-xs uppercase tracking-wide opacity-50 mb-1">Biscuit Class</h4>
                            <p className="text-xl font-bold truncate">{biscuit.name}</p>
                         </div>
                    </div>

                </div>

            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>