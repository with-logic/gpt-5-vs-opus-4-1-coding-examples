<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrekPack - Camping Gear Checklist</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        forest: {
                            50: '#f2fcf5',
                            100: '#e1f8e8',
                            200: '#c3eed0',
                            300: '#94deb0',
                            400: '#5cc48a',
                            500: '#34a868',
                            600: '#258852',
                            700: '#206d43',
                            800: '#1d5639',
                            900: '#194731',
                        },
                        earth: {
                            50: '#faf7f5',
                            100: '#f3ede9',
                            200: '#e6dcd4',
                            300: '#d3c2b4',
                            400: '#bc9f8c',
                            500: '#a8836d',
                            600: '#9a6f5b',
                            700: '#80594a',
                            800: '#6a4a3f',
                            900: '#563d35',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Patua One', 'serif'],
                    }
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Patua+One&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3ede9; /* earth-100 */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23bc9f8c' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .font-display {
            font-family: 'Patua One', serif;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        .slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Icons ---
        const Icons = {
            Tent: () => <i className="fa-solid fa-campground"></i>,
            Fire: () => <i className="fa-solid fa-fire-burner"></i>,
            Snowflake: () => <i className="fa-regular fa-snowflake"></i>,
            Shirt: () => <i className="fa-solid fa-shirt"></i>,
            Kit: () => <i className="fa-solid fa-kit-medical"></i>,
            Utensils: () => <i className="fa-solid fa-utensils"></i>,
            Map: () => <i className="fa-solid fa-map-location-dot"></i>,
            Bed: () => <i className="fa-solid fa-bed"></i>,
            Trash: () => <i className="fa-solid fa-trash-can"></i>,
            Plus: () => <i className="fa-solid fa-plus"></i>,
            Check: () => <i className="fa-solid fa-check"></i>,
            Weight: () => <i className="fa-solid fa-scale-balanced"></i>,
            List: () => <i className="fa-solid fa-list-ul"></i>,
            Moon: () => <i className="fa-solid fa-moon"></i>,
            Sun: () => <i className="fa-solid fa-sun"></i>,
            Backpack: () => <i className="fa-solid fa-person-hiking"></i>,
            Save: () => <i className="fa-solid fa-floppy-disk"></i>,
            ChevronDown: () => <i className="fa-solid fa-chevron-down"></i>,
            Ellipsis: () => <i className="fa-solid fa-ellipsis-vertical"></i>,
            Grip: () => <i className="fa-solid fa-grip-lines text-gray-300"></i>,
        };

        // --- Constants & Helpers ---
        const UNITS = {
            g: { label: 'g', factor: 1 },
            kg: { label: 'kg', factor: 1000 },
            oz: { label: 'oz', factor: 28.3495 },
            lb: { label: 'lb', factor: 453.592 },
        };

        const CATEGORIES = [
            { id: 'shelter', name: 'Shelter & Sleeping', icon: 'Bed', color: 'bg-indigo-100 text-indigo-700' },
            { id: 'kitchen', name: 'Kitchen & Water', icon: 'Utensils', color: 'bg-orange-100 text-orange-700' },
            { id: 'clothing', name: 'Clothing', icon: 'Shirt', color: 'bg-blue-100 text-blue-700' },
            { id: 'electronics', name: 'Electronics & Nav', icon: 'Map', color: 'bg-purple-100 text-purple-700' },
            { id: 'hygiene', name: 'First Aid & Hygiene', icon: 'Kit', color: 'bg-red-100 text-red-700' },
            { id: 'misc', name: 'Miscellaneous', icon: 'Backpack', color: 'bg-gray-100 text-gray-700' },
        ];

        const generateId = () => Math.random().toString(36).substr(2, 9);

        const DEFAULT_ITEMS = [
            { id: '1', name: 'Tent (2-person)', weight: 1500, unit: 'g', quantity: 1, category: 'shelter', checked: false },
            { id: '2', name: 'Sleeping Bag', weight: 800, unit: 'g', quantity: 1, category: 'shelter', checked: false },
            { id: '3', name: 'Sleeping Pad', weight: 400, unit: 'g', quantity: 1, category: 'shelter', checked: false },
            { id: '4', name: 'Stove', weight: 100, unit: 'g', quantity: 1, category: 'kitchen', checked: false },
            { id: '5', name: 'Fuel Canister', weight: 220, unit: 'g', quantity: 1, category: 'kitchen', checked: false },
            { id: '6', name: 'Pot (700ml)', weight: 120, unit: 'g', quantity: 1, category: 'kitchen', checked: false },
            { id: '7', name: 'Spork', weight: 15, unit: 'g', quantity: 1, category: 'kitchen', checked: false },
            { id: '8', name: 'Rain Jacket', weight: 300, unit: 'g', quantity: 1, category: 'clothing', checked: false },
            { id: '9', name: 'Down Jacket', weight: 350, unit: 'g', quantity: 1, category: 'clothing', checked: false },
            { id: '10', name: 'First Aid Kit', weight: 250, unit: 'g', quantity: 1, category: 'hygiene', checked: false },
            { id: '11', name: 'Headlamp', weight: 80, unit: 'g', quantity: 1, category: 'electronics', checked: false },
            { id: '12', name: 'Power Bank', weight: 200, unit: 'g', quantity: 1, category: 'electronics', checked: false },
        ];

        // --- Components ---

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-fade-in">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden slide-in">
                        <div className="flex justify-between items-center p-4 border-b border-gray-100">
                            <h3 className="text-lg font-bold text-gray-800 font-display">{title}</h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600 transition-colors">
                                <i className="fa-solid fa-xmark text-xl"></i>
                            </button>
                        </div>
                        <div className="p-4">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const ProgressBar = ({ total, current, colorClass = "bg-forest-500" }) => {
            const percentage = total === 0 ? 0 : Math.min(100, (current / total) * 100);
            return (
                <div className="h-2 w-full bg-gray-200 rounded-full overflow-hidden">
                    <div 
                        className={`h-full ${colorClass} transition-all duration-500 ease-out`} 
                        style={{ width: `${percentage}%` }}
                    />
                </div>
            );
        };

        const CategoryGroup = ({ category, items, onToggle, onDelete, onUpdate }) => {
            const catDef = CATEGORIES.find(c => c.id === category) || { name: category, icon: 'List', color: 'bg-gray-100 text-gray-600' };
            const IconComp = Icons[catDef.icon];
            
            const totalWeight = items.reduce((sum, item) => sum + (item.weight * item.quantity), 0);
            const checkedWeight = items.filter(i => i.checked).reduce((sum, i) => sum + (i.weight * i.quantity), 0);
            const isAllChecked = items.length > 0 && items.every(i => i.checked);

            const formatWeight = (g) => {
                if (g >= 1000) return `${(g/1000).toFixed(2)} kg`;
                return `${Math.round(g)} g`;
            };

            return (
                <div className="mb-6 bg-white rounded-xl shadow-sm border border-earth-200 overflow-hidden">
                    <div className="flex items-center justify-between p-4 bg-earth-50/50 border-b border-earth-100">
                        <div className="flex items-center gap-3">
                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${catDef.color}`}>
                                <IconComp />
                            </div>
                            <h3 className="font-semibold text-gray-800">{catDef.name}</h3>
                            <span className="text-xs font-medium px-2 py-0.5 rounded-full bg-gray-100 text-gray-500">
                                {items.length}
                            </span>
                        </div>
                        <div className="text-right">
                            <div className="text-sm font-bold text-gray-700">{formatWeight(checkedWeight)} <span className="text-gray-400 font-normal">/ {formatWeight(totalWeight)}</span></div>
                        </div>
                    </div>
                    
                    <div className="divide-y divide-gray-50">
                        {items.map(item => (
                            <div key={item.id} className={`group flex items-center gap-3 p-3 hover:bg-gray-50 transition-colors ${item.checked ? 'bg-forest-50/30' : ''}`}>
                                <button 
                                    onClick={() => onToggle(item.id)}
                                    className={`flex-shrink-0 w-6 h-6 rounded border transition-all duration-200 flex items-center justify-center
                                        ${item.checked 
                                            ? 'bg-forest-500 border-forest-500 text-white' 
                                            : 'border-gray-300 text-transparent hover:border-forest-400'}`}
                                >
                                    <i className="fa-solid fa-check text-xs"></i>
                                </button>
                                
                                <div className="flex-grow min-w-0">
                                    <div className="flex items-center gap-2">
                                        <input 
                                            type="text" 
                                            value={item.name}
                                            onChange={(e) => onUpdate(item.id, { name: e.target.value })}
                                            className={`w-full bg-transparent border-none focus:ring-0 p-0 text-sm font-medium text-gray-800 placeholder-gray-400 truncate
                                                ${item.checked ? 'line-through text-gray-400' : ''}`}
                                        />
                                    </div>
                                    <div className="flex items-center gap-3 mt-1">
                                        <div className="flex items-center gap-1 text-xs text-gray-500 bg-gray-100 rounded px-1.5 py-0.5">
                                            <input
                                                type="number"
                                                min="0"
                                                value={item.weight}
                                                onChange={(e) => onUpdate(item.id, { weight: parseFloat(e.target.value) || 0 })}
                                                className="w-12 bg-transparent border-none p-0 text-right focus:ring-0"
                                            />
                                            <span className="text-gray-400">g</span>
                                        </div>
                                        {item.quantity > 1 && (
                                            <span className="text-xs font-medium text-earth-600 bg-earth-100 px-1.5 py-0.5 rounded">
                                                x{item.quantity}
                                            </span>
                                        )}
                                    </div>
                                </div>

                                <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button 
                                        onClick={() => onUpdate(item.id, { quantity: Math.max(1, item.quantity - 1) })}
                                        className="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"
                                        title="Decrease Qty"
                                    >
                                        <i className="fa-solid fa-minus text-xs"></i>
                                    </button>
                                    <span className="text-xs w-4 text-center text-gray-600">{item.quantity}</span>
                                    <button 
                                        onClick={() => onUpdate(item.id, { quantity: item.quantity + 1 })}
                                        className="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded"
                                        title="Increase Qty"
                                    >
                                        <i className="fa-solid fa-plus text-xs"></i>
                                    </button>
                                    <div className="w-px h-4 bg-gray-200 mx-1"></div>
                                    <button 
                                        onClick={() => onDelete(item.id)}
                                        className="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-red-500 hover:bg-red-50 rounded"
                                        title="Delete Item"
                                    >
                                        <Icons.Trash />
                                    </button>
                                </div>
                            </div>
                        ))}
                        {items.length === 0 && (
                            <div className="p-4 text-center text-sm text-gray-400 italic">
                                No items in this category.
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const AddItemModal = ({ isOpen, onClose, onAdd }) => {
            const [name, setName] = useState('');
            const [weight, setWeight] = useState('');
            const [category, setCategory] = useState('misc');
            const [quantity, setQuantity] = useState(1);
            const nameInputRef = useRef(null);

            useEffect(() => {
                if (isOpen && nameInputRef.current) {
                    nameInputRef.current.focus();
                }
            }, [isOpen]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!name.trim()) return;
                onAdd({
                    name,
                    weight: parseFloat(weight) || 0,
                    category,
                    quantity: parseInt(quantity) || 1
                });
                setName('');
                setWeight('');
                setQuantity(1);
                // Don't close immediately to allow rapid entry
                // onClose(); 
                nameInputRef.current.focus();
            };

            return (
                <Modal isOpen={isOpen} onClose={onClose} title="Add New Gear">
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                            <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">Item Name</label>
                            <input 
                                ref={nameInputRef}
                                type="text" 
                                className="w-full rounded-lg border-gray-300 focus:border-forest-500 focus:ring-forest-500 transition-colors"
                                placeholder="e.g. Titanium Mug"
                                value={name}
                                onChange={e => setName(e.target.value)}
                            />
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">Weight (g)</label>
                                <input 
                                    type="number" 
                                    className="w-full rounded-lg border-gray-300 focus:border-forest-500 focus:ring-forest-500"
                                    placeholder="0"
                                    value={weight}
                                    onChange={e => setWeight(e.target.value)}
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">Quantity</label>
                                <input 
                                    type="number" 
                                    min="1"
                                    className="w-full rounded-lg border-gray-300 focus:border-forest-500 focus:ring-forest-500"
                                    value={quantity}
                                    onChange={e => setQuantity(e.target.value)}
                                />
                            </div>
                        </div>
                        <div>
                            <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">Category</label>
                            <div className="grid grid-cols-3 gap-2">
                                {CATEGORIES.map(cat => (
                                    <button
                                        key={cat.id}
                                        type="button"
                                        onClick={() => setCategory(cat.id)}
                                        className={`p-2 rounded-lg border text-xs font-medium flex flex-col items-center gap-1 transition-all
                                            ${category === cat.id 
                                                ? 'bg-forest-50 border-forest-500 text-forest-700 ring-1 ring-forest-500' 
                                                : 'bg-white border-gray-200 text-gray-600 hover:border-forest-300'}`}
                                    >
                                        <i className={`fa-solid ${cat.icon === 'Shirt' ? 'fa-shirt' : cat.icon === 'Utensils' ? 'fa-utensils' : cat.icon === 'Bed' ? 'fa-bed' : cat.icon === 'Map' ? 'fa-map' : cat.icon === 'Kit' ? 'fa-kit-medical' : 'fa-person-hiking'}`}></i>
                                        {cat.name.split(' ')[0]}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="pt-2 flex justify-end gap-3">
                            <button 
                                type="button" 
                                onClick={onClose}
                                className="px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors"
                            >
                                Done
                            </button>
                            <button 
                                type="submit"
                                className="px-6 py-2 bg-forest-600 hover:bg-forest-700 text-white text-sm font-medium rounded-lg shadow-sm shadow-forest-200 transition-all transform active:scale-95"
                            >
                                Add Item
                            </button>
                        </div>
                    </form>
                </Modal>
            );
        };

        const DonutChart = ({ items, totalWeight }) => {
            if (totalWeight === 0) return (
                <div className="w-32 h-32 rounded-full border-4 border-gray-100 flex items-center justify-center text-xs text-gray-400">
                    Empty
                </div>
            );

            let cumulativePercent = 0;
            const slices = CATEGORIES.map(cat => {
                const catWeight = items.filter(i => i.category === cat.id).reduce((sum, i) => sum + (i.weight * i.quantity), 0);
                if (catWeight === 0) return null;
                const percent = (catWeight / totalWeight) * 100;
                const prev = cumulativePercent;
                cumulativePercent += percent;
                
                // Color mapping
                const colors = {
                    shelter: '#6366f1', // Indigo
                    kitchen: '#f97316', // Orange
                    clothing: '#3b82f6', // Blue
                    electronics: '#a855f7', // Purple
                    hygiene: '#ef4444', // Red
                    misc: '#6b7280' // Gray
                };

                return (
                    <circle 
                        key={cat.id}
                        r="15.9155" 
                        cx="50%" 
                        cy="50%" 
                        fill="transparent" 
                        stroke={colors[cat.id]} 
                        strokeWidth="5" 
                        strokeDasharray={`${percent} ${100 - percent}`} 
                        strokeDashoffset={25 - prev} 
                    />
                );
            });

            return (
                <div className="relative w-32 h-32 group">
                    <svg viewBox="0 0 42 42" className="w-full h-full block transform -rotate-90">
                        <circle r="15.9155" cx="50%" cy="50%" fill="transparent" stroke="#f3f4f6" strokeWidth="5"></circle>
                        {slices}
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                        <span className="text-[10px] uppercase font-bold text-gray-400">Total</span>
                        <span className="text-sm font-bold text-gray-800">{(totalWeight/1000).toFixed(1)}kg</span>
                    </div>
                </div>
            );
        };

        const App = () => {
            // --- State ---
            const [lists, setLists] = useState(() => {
                const saved = localStorage.getItem('trekpack_lists');
                return saved ? JSON.parse(saved) : [{ id: 'default', name: 'Weekend Trip', items: DEFAULT_ITEMS }];
            });
            const [activeListId, setActiveListId] = useState(() => {
                return localStorage.getItem('trekpack_active_id') || 'default';
            });
            const [isAddModalOpen, setIsAddModalOpen] = useState(false);
            const [showMenu, setShowMenu] = useState(false);
            const [showUnit, setShowUnit] = useState('kg'); // 'kg' or 'lb'

            // --- Effects ---
            useEffect(() => {
                localStorage.setItem('trekpack_lists', JSON.stringify(lists));
            }, [lists]);

            useEffect(() => {
                localStorage.setItem('trekpack_active_id', activeListId);
            }, [activeListId]);

            // --- Derived State ---
            const activeList = lists.find(l => l.id === activeListId) || lists[0];
            const items = activeList.items;

            const totalWeightGrams = items.reduce((sum, i) => sum + (i.weight * i.quantity), 0);
            const packedWeightGrams = items.filter(i => i.checked).reduce((sum, i) => sum + (i.weight * i.quantity), 0);
            
            // --- Handlers ---
            const toggleItem = (itemId) => {
                const newItems = items.map(i => i.id === itemId ? { ...i, checked: !i.checked } : i);
                updateListItems(newItems);
            };

            const addItem = (newItem) => {
                const item = { ...newItem, id: generateId(), unit: 'g', checked: false };
                updateListItems([...items, item]);
            };

            const updateItem = (itemId, updates) => {
                const newItems = items.map(i => i.id === itemId ? { ...i, ...updates } : i);
                updateListItems(newItems);
            };

            const deleteItem = (itemId) => {
                const newItems = items.filter(i => i.id !== itemId);
                updateListItems(newItems);
            };

            const updateListItems = (newItems) => {
                setLists(lists.map(l => l.id === activeListId ? { ...l, items: newItems } : l));
            };

            const createNewList = () => {
                const name = prompt("Enter list name:", "New Adventure");
                if (name) {
                    const newList = { id: generateId(), name, items: [] };
                    setLists([...lists, newList]);
                    setActiveListId(newList.id);
                    setShowMenu(false);
                }
            };

            const deleteList = (id) => {
                if (lists.length <= 1) {
                    alert("You must have at least one list.");
                    return;
                }
                if (confirm("Are you sure you want to delete this list?")) {
                    const newLists = lists.filter(l => l.id !== id);
                    setLists(newLists);
                    if (activeListId === id) setActiveListId(newLists[0].id);
                }
            };

            const resetList = () => {
                if (confirm("Uncheck all items?")) {
                    const newItems = items.map(i => ({...i, checked: false}));
                    updateListItems(newItems);
                }
            }

            // --- Render Helpers ---
            const displayWeight = (grams) => {
                if (showUnit === 'lb') {
                    return `${(grams * 0.00220462).toFixed(2)} lb`;
                }
                if (grams >= 1000) return `${(grams / 1000).toFixed(2)} kg`;
                return `${Math.round(grams)} g`;
            };

            const itemsByCategory = useMemo(() => {
                const grouped = {};
                CATEGORIES.forEach(cat => grouped[cat.id] = []);
                items.forEach(item => {
                    if (!grouped[item.category]) grouped[item.category] = []; // Fallback
                    grouped[item.category].push(item);
                });
                return grouped;
            }, [items]);

            return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <header className="bg-white shadow-sm sticky top-0 z-30">
                        <div className="max-w-3xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-forest-600 text-white w-9 h-9 rounded-lg flex items-center justify-center shadow-forest-200 shadow-lg transform -rotate-3">
                                    <i className="fa-solid fa-mountain text-lg"></i>
                                </div>
                                <h1 className="font-display text-2xl text-gray-800 tracking-wide">TrekPack</h1>
                            </div>

                            <div className="relative">
                                <button 
                                    onClick={() => setShowMenu(!showMenu)}
                                    className="flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-forest-600 bg-gray-50 hover:bg-forest-50 px-3 py-1.5 rounded-full border border-gray-200 transition-colors"
                                >
                                    <span>{activeList.name}</span>
                                    <Icons.ChevronDown />
                                </button>
                                
                                {showMenu && (
                                    <>
                                        <div className="fixed inset-0 z-10" onClick={() => setShowMenu(false)}></div>
                                        <div className="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-100 z-20 py-2 animate-fade-in origin-top-right">
                                            <div className="px-3 py-2 text-xs font-semibold text-gray-400 uppercase">My Lists</div>
                                            {lists.map(list => (
                                                <button 
                                                    key={list.id}
                                                    onClick={() => { setActiveListId(list.id); setShowMenu(false); }}
                                                    className={`w-full text-left px-4 py-2 text-sm flex items-center justify-between
                                                        ${list.id === activeListId ? 'bg-forest-50 text-forest-700 font-medium' : 'text-gray-600 hover:bg-gray-50'}`}
                                                >
                                                    <span className="truncate">{list.name}</span>
                                                    {list.id === activeListId && <i className="fa-solid fa-check text-forest-500 text-xs"></i>}
                                                </button>
                                            ))}
                                            <div className="border-t border-gray-100 my-1"></div>
                                            <button 
                                                onClick={createNewList}
                                                className="w-full text-left px-4 py-2 text-sm text-forest-600 hover:bg-gray-50 flex items-center gap-2"
                                            >
                                                <i className="fa-solid fa-plus-circle"></i> New List
                                            </button>
                                            {lists.length > 1 && (
                                                 <button 
                                                    onClick={() => deleteList(activeListId)}
                                                    className="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 flex items-center gap-2"
                                                >
                                                    <i className="fa-solid fa-trash-can"></i> Delete Current
                                                </button>
                                            )}
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    </header>

                    <main className="max-w-3xl mx-auto px-4 sm:px-6 py-6 space-y-6">
                        
                        {/* Dashboard Card */}
                        <div className="bg-white rounded-2xl shadow-lg border border-earth-100 p-6 relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-32 h-32 bg-forest-50 rounded-full mix-blend-multiply filter blur-3xl opacity-50 transform translate-x-1/2 -translate-y-1/2"></div>
                            
                            <div className="flex flex-col sm:flex-row items-center gap-8 relative z-10">
                                {/* Chart */}
                                <div className="flex-shrink-0">
                                    <DonutChart items={items} totalWeight={totalWeightGrams} />
                                </div>
                                
                                {/* Stats */}
                                <div className="flex-grow w-full space-y-4">
                                    <div className="flex justify-between items-end">
                                        <div>
                                            <h2 className="text-gray-500 text-sm font-medium uppercase tracking-wider">Pack Weight</h2>
                                            <div className="flex items-baseline gap-2">
                                                <span className="text-4xl font-bold text-gray-800 font-display">
                                                    {displayWeight(packedWeightGrams)}
                                                </span>
                                                <span className="text-gray-400 font-medium">
                                                    / {displayWeight(totalWeightGrams)}
                                                </span>
                                            </div>
                                        </div>
                                        <button 
                                            onClick={() => setShowUnit(showUnit === 'kg' ? 'lb' : 'kg')}
                                            className="text-xs font-bold text-forest-600 bg-forest-50 px-2 py-1 rounded hover:bg-forest-100 transition-colors uppercase"
                                        >
                                            {showUnit}
                                        </button>
                                    </div>

                                    <div className="space-y-1">
                                        <div className="flex justify-between text-xs font-medium text-gray-500">
                                            <span>Progress</span>
                                            <span>{Math.round((packedWeightGrams / (totalWeightGrams || 1)) * 100)}% packed</span>
                                        </div>
                                        <ProgressBar total={totalWeightGrams} current={packedWeightGrams} />
                                    </div>

                                    <div className="flex gap-2">
                                        <button 
                                            onClick={resetList}
                                            className="text-xs text-gray-500 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded-full transition-colors flex items-center gap-1.5"
                                        >
                                            <i className="fa-solid fa-rotate-left"></i> Reset Checks
                                        </button>
                                        <div className="flex-grow"></div>
                                        {/* Tag summary */}
                                        <div className="hidden sm:flex items-center gap-2">
                                            <span className="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full">
                                                <i className="fa-solid fa-fire mr-1"></i>
                                                {items.filter(i => i.category === 'kitchen').length}
                                            </span>
                                            <span className="text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full">
                                                <i className="fa-solid fa-bed mr-1"></i>
                                                {items.filter(i => i.category === 'shelter').length}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Category Lists */}
                        <div className="space-y-6">
                            {CATEGORIES.map(cat => (
                                <CategoryGroup 
                                    key={cat.id}
                                    category={cat.id}
                                    items={itemsByCategory[cat.id]}
                                    onToggle={toggleItem}
                                    onDelete={deleteItem}
                                    onUpdate={updateItem}
                                />
                            ))}
                        </div>

                        {/* Empty State Help */}
                        {items.length === 0 && (
                            <div className="text-center py-12">
                                <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-300 text-2xl">
                                    <i className="fa-solid fa-compass"></i>
                                </div>
                                <h3 className="text-lg font-medium text-gray-800 mb-1">Your pack is empty</h3>
                                <p className="text-gray-500 text-sm mb-4">Start adding gear to prepare for your trip.</p>
                                <button 
                                    onClick={() => setIsAddModalOpen(true)}
                                    className="bg-forest-600 text-white px-6 py-2 rounded-full font-medium hover:bg-forest-700 transition-colors shadow-lg shadow-forest-200"
                                >
                                    Add First Item
                                </button>
                            </div>
                        )}
                        
                        {/* Bottom Spacer for FAB */}
                        <div className="h-20"></div>
                    </main>

                    {/* FAB (Floating Action Button) */}
                    <button 
                        onClick={() => setIsAddModalOpen(true)}
                        className="fixed bottom-6 right-6 md:bottom-10 md:right-10 w-14 h-14 bg-forest-600 text-white rounded-full shadow-lg shadow-forest-900/20 flex items-center justify-center text-2xl hover:bg-forest-700 hover:scale-110 transition-all duration-200 z-40"
                    >
                        <i className="fa-solid fa-plus"></i>
                    </button>

                    {/* Modals */}
                    <AddItemModal 
                        isOpen={isAddModalOpen} 
                        onClose={() => setIsAddModalOpen(false)}
                        onAdd={addItem}
                    />

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
