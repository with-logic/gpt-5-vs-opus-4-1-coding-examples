<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloud Painter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            overflow: hidden;
            touch-action: none; /* Prevent scrolling on mobile */
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 100%);
        }
        
        /* Custom cursor styles */
        .cursor-brush { cursor: crosshair; }
        .cursor-plane { cursor: alias; }
        
        /* Tooltip animation */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .tool-btn {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .tool-btn:active {
            transform: scale(0.9);
        }
        .tool-btn.active {
            transform: translateY(-8px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: white;
            border-width: 4px;
        }

        /* Plane fly animation for UI decoration */
        @keyframes fly {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        .animate-fly {
            animation: fly 3s ease-in-out infinite;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #bg-canvas { z-index: 0; pointer-events: none; }
        #paint-canvas { z-index: 10; }
        #ui-layer { z-index: 20; pointer-events: none; }
        .interactive { pointer-events: auto; }
    </style>
</head>
<body class="h-screen w-screen relative select-none">

    <!-- Canvas Layers -->
    <canvas id="bg-canvas"></canvas>
    <canvas id="paint-canvas"></canvas>

    <!-- UI Overlay -->
    <div id="ui-layer" class="absolute inset-0 flex flex-col justify-between p-4 sm:p-6">
        
        <!-- Header -->
        <div class="flex justify-between items-start interactive">
            <div class="bg-white/80 backdrop-blur-md rounded-3xl p-3 shadow-lg border-2 border-white/50 animate-fly">
                <h1 class="text-2xl sm:text-3xl font-bold text-sky-600 flex items-center gap-2">
                    ☁️ Cloud Painter
                </h1>
            </div>
            
            <div class="flex gap-2">
                <button id="btn-save" class="bg-green-400 hover:bg-green-500 text-white p-3 rounded-full shadow-lg border-4 border-white transition-colors" title="Save Picture">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                </button>
                <button id="btn-clear" class="bg-red-400 hover:bg-red-500 text-white p-3 rounded-full shadow-lg border-4 border-white transition-colors" title="Clear Sky">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Controls Bottom -->
        <div class="flex flex-col items-center gap-4 interactive mb-2">
            
            <!-- Size Slider Panel -->
            <div class="bg-white/80 backdrop-blur-md px-6 py-2 rounded-2xl shadow-lg border-2 border-white/50 w-64 max-w-full">
                <div class="flex items-center gap-3">
                    <span class="text-sky-600 text-xs font-bold uppercase">Size</span>
                    <input type="range" id="size-slider" min="10" max="80" value="40" class="w-full h-2 bg-sky-200 rounded-lg appearance-none cursor-pointer accent-sky-500">
                </div>
            </div>

            <!-- Toolbar -->
            <div class="bg-white/90 backdrop-blur-xl p-2 rounded-3xl shadow-xl border-4 border-sky-100 flex gap-2 sm:gap-4 overflow-x-auto max-w-full">
                
                <!-- Brush: Fluffy -->
                <button class="tool-btn active w-14 h-14 sm:w-16 sm:h-16 bg-sky-100 rounded-2xl flex flex-col items-center justify-center gap-1 text-sky-600" data-tool="brush" data-shape="fluffy">
                    <div class="w-6 h-6 bg-white rounded-full shadow-sm border border-sky-200"></div>
                    <span class="text-[10px] font-bold">Fluffy</span>
                </button>

                <!-- Brush: Wispy -->
                <button class="tool-btn w-14 h-14 sm:w-16 sm:h-16 bg-sky-100 rounded-2xl flex flex-col items-center justify-center gap-1 text-sky-600" data-tool="brush" data-shape="wispy">
                    <div class="w-8 h-2 bg-white rounded-full shadow-sm border border-sky-200"></div>
                    <span class="text-[10px] font-bold">Wispy</span>
                </button>

                <!-- Brush: Cumulus -->
                <button class="tool-btn w-14 h-14 sm:w-16 sm:h-16 bg-sky-100 rounded-2xl flex flex-col items-center justify-center gap-1 text-sky-600" data-tool="brush" data-shape="cumulus">
                    <div class="flex -space-x-1">
                        <div class="w-3 h-3 bg-white rounded-full border border-sky-200"></div>
                        <div class="w-4 h-4 bg-white rounded-full border border-sky-200 -mt-1"></div>
                        <div class="w-3 h-3 bg-white rounded-full border border-sky-200"></div>
                    </div>
                    <span class="text-[10px] font-bold">Puffy</span>
                </button>
                
                <div class="w-px h-12 bg-sky-200 mx-1"></div>

                <!-- Plane Tool -->
                <button class="tool-btn w-14 h-14 sm:w-16 sm:h-16 bg-orange-100 rounded-2xl flex flex-col items-center justify-center gap-1 text-orange-600" data-tool="plane">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform rotate-45" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                    <span class="text-[10px] font-bold">Plane</span>
                </button>

                <!-- Eraser -->
                <button class="tool-btn w-14 h-14 sm:w-16 sm:h-16 bg-pink-100 rounded-2xl flex flex-col items-center justify-center gap-1 text-pink-500" data-tool="eraser">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    <span class="text-[10px] font-bold">Eraser</span>
                </button>

            </div>
        </div>
    </div>

    <script>
        // --- Setup ---
        const bgCanvas = document.getElementById('bg-canvas');
        const paintCanvas = document.getElementById('paint-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        const ctx = paintCanvas.getContext('2d');
        
        let width, height;
        
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            
            // Create temporary canvas to preserve content
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = paintCanvas.width;
            tempCanvas.height = paintCanvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(paintCanvas, 0, 0);

            bgCanvas.width = width;
            bgCanvas.height = height;
            paintCanvas.width = width;
            paintCanvas.height = height;

            // Restore content
            ctx.drawImage(tempCanvas, 0, 0, tempCanvas.width, tempCanvas.height, 0, 0, width, height);
            
            // Redraw background immediately
            drawBackgroundLayer();
        }
        
        window.addEventListener('resize', resize);
        
        // --- State ---
        const state = {
            tool: 'brush', // brush, plane, eraser
            brushShape: 'fluffy', // fluffy, wispy, cumulus
            size: 40,
            isDrawing: false,
            lastPoint: null,
            ambientPlanes: [], // Array of plane objects for background layer
            bgClouds: [], // Array of floating background clouds
            color: 'rgba(255, 255, 255, 0.6)'
        };

        // --- Initialization ---
        
        function initBackgroundClouds() {
            // Create some random clouds for the background
            for(let i=0; i<8; i++) {
                state.bgClouds.push({
                    x: Math.random() * window.innerWidth,
                    y: Math.random() * (window.innerHeight * 0.6), // Upper 60% of screen
                    speed: 0.2 + Math.random() * 0.3,
                    scale: 0.5 + Math.random() * 1.5,
                    opacity: 0.3 + Math.random() * 0.4
                });
            }
        }

        // --- Drawing Logic ---

        function getDistance(p1, p2) {
            return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
        }

        function getAngle(p1, p2) {
            return Math.atan2(p2.y - p1.y, p2.x - p1.x);
        }

        function drawCloudPuff(x, y, radius, opacity) {
            ctx.save();
            ctx.beginPath();
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
            gradient.addColorStop(0, `rgba(255, 255, 255, ${opacity})`);
            gradient.addColorStop(0.4, `rgba(255, 255, 255, ${opacity * 0.8})`);
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            
            ctx.fillStyle = gradient;
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        function drawBrushStroke(start, end) {
            if (state.tool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.lineWidth = state.size;
                ctx.lineCap = 'round';
                ctx.moveTo(start.x, start.y);
                ctx.lineTo(end.x, end.y);
                ctx.stroke();
                ctx.globalCompositeOperation = 'source-over';
                return;
            }

            const dist = getDistance(start, end);
            const angle = getAngle(start, end);
            
            // Interpolate points between start and end to make stroke smooth
            const stepSize = state.size * 0.2; // Density of puffs
            
            for (let i = 0; i < dist; i += stepSize) {
                const px = start.x + (Math.cos(angle) * i);
                const py = start.y + (Math.sin(angle) * i);
                
                // Jitter for natural look
                const jitter = state.size * 0.2;
                const jx = px + (Math.random() - 0.5) * jitter;
                const jy = py + (Math.random() - 0.5) * jitter;
                
                let radius = state.size;
                let opacity = 0.2; // Low opacity for layering

                if (state.brushShape === 'wispy') {
                    // Wispy: Varied sizes, spread out
                    radius = state.size * (0.5 + Math.random());
                    opacity = 0.1;
                } else if (state.brushShape === 'cumulus') {
                    // Cumulus: Tight, larger
                    radius = state.size * 1.2;
                    opacity = 0.3;
                } else {
                    // Fluffy: Standard
                    radius = state.size * (0.8 + Math.random() * 0.4);
                }

                drawCloudPuff(jx, jy, radius, opacity);
            }
        }

        function drawPlane(targetCtx, x, y, scale = 1, color = '#FF9900') {
            // Draw an SVG-style plane on the target canvas
            targetCtx.save();
            targetCtx.translate(x, y);
            targetCtx.scale(scale, scale);
            targetCtx.rotate(Math.PI / -6); // Tilt up slightly

            // Plane Body
            targetCtx.fillStyle = color; // Body color
            targetCtx.beginPath();
            targetCtx.moveTo(-20, 0);
            targetCtx.quadraticCurveTo(0, -10, 20, 0); // Top
            targetCtx.quadraticCurveTo(0, 10, -20, 0); // Bottom
            targetCtx.fill();

            // Wings
            targetCtx.fillStyle = color === '#FF9900' ? '#FFAA33' : '#ddd'; // Slight variation
            targetCtx.beginPath();
            targetCtx.moveTo(0, -5);
            targetCtx.lineTo(-5, -25);
            targetCtx.lineTo(10, -5);
            targetCtx.fill();
            
            targetCtx.beginPath();
            targetCtx.moveTo(0, 5);
            targetCtx.lineTo(-5, 25);
            targetCtx.lineTo(10, 5);
            targetCtx.fill();

            // Tail
            targetCtx.fillStyle = color === '#FF9900' ? '#CC7700' : '#bbb';
            targetCtx.beginPath();
            targetCtx.moveTo(-15, 0);
            targetCtx.lineTo(-25, -10);
            targetCtx.lineTo(-20, 0);
            targetCtx.fill();

            // Propeller (simple circle for speed)
            targetCtx.fillStyle = '#EEEEEE';
            targetCtx.globalAlpha = 0.5;
            targetCtx.beginPath();
            targetCtx.arc(20, 0, 8, 0, Math.PI * 2);
            targetCtx.fill();
            targetCtx.globalAlpha = 1.0;

            targetCtx.restore();
        }

        // --- Loop for Background Animations ---

        function drawCloudShape(ctx, x, y, scale, opacity) {
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);
            ctx.globalAlpha = opacity;
            ctx.fillStyle = 'white';
            
            // Simple cloud shape drawing
            ctx.beginPath();
            ctx.arc(0, 0, 50, 0, Math.PI * 2);
            ctx.arc(-40, 20, 35, 0, Math.PI * 2);
            ctx.arc(40, 20, 35, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
        }

        function drawBackgroundLayer() {
            // Clear entire background canvas
            bgCtx.clearRect(0, 0, width, height);
            
            // Draw floating background clouds
            state.bgClouds.forEach(cloud => {
                drawCloudShape(bgCtx, cloud.x, cloud.y, cloud.scale, cloud.opacity);
                
                // Update position
                cloud.x += cloud.speed;
                if (cloud.x > width + 100) {
                    cloud.x = -100; // Loop
                    cloud.y = Math.random() * (height * 0.6);
                }
            });

            // Ambient Planes Logic
            // Spawn new plane occasionally
            if (Math.random() < 0.005) { // 0.5% chance per frame
                state.ambientPlanes.push({
                    x: -50,
                    y: 50 + Math.random() * (height * 0.5),
                    speed: 2 + Math.random() * 2,
                    scale: 0.5 + Math.random() * 0.5,
                    color: Math.random() > 0.5 ? '#FF5555' : '#5555FF' // Red or Blue ambient planes
                });
            }

            // Draw and update ambient planes
            for (let i = state.ambientPlanes.length - 1; i >= 0; i--) {
                const plane = state.ambientPlanes[i];
                drawPlane(bgCtx, plane.x, plane.y, plane.scale, plane.color);
                
                plane.x += plane.speed;
                
                // Remove if off screen
                if (plane.x > width + 50) {
                    state.ambientPlanes.splice(i, 1);
                }
            }
        }
        
        function loop() {
            drawBackgroundLayer();
            requestAnimationFrame(loop);
        }

        // --- Interaction Handlers ---

        function startPaint(e) {
            if (e.target.closest('.interactive')) return; // Don't paint through UI

            const x = e.touches ? e.touches[0].clientX : e.clientX;
            const y = e.touches ? e.touches[0].clientY : e.clientY;

            if (state.tool === 'plane') {
                // Stamp a plane
                drawPlane(ctx, x, y, state.size / 20); // Scale plane based on size
            } else {
                state.isDrawing = true;
                state.lastPoint = { x, y };
                // Draw initial dot
                drawBrushStroke({x, y}, {x: x+0.1, y: y+0.1});
            }
        }

        function movePaint(e) {
            if (!state.isDrawing) return;
            e.preventDefault(); // Stop scrolling

            const x = e.touches ? e.touches[0].clientX : e.clientX;
            const y = e.touches ? e.touches[0].clientY : e.clientY;
            
            const currentPoint = { x, y };
            drawBrushStroke(state.lastPoint, currentPoint);
            state.lastPoint = currentPoint;
        }

        function endPaint() {
            state.isDrawing = false;
            state.lastPoint = null;
        }

        // --- Event Listeners ---
        
        // Mouse
        window.addEventListener('mousedown', startPaint);
        window.addEventListener('mousemove', movePaint);
        window.addEventListener('mouseup', endPaint);
        
        // Touch
        window.addEventListener('touchstart', startPaint, { passive: false });
        window.addEventListener('touchmove', movePaint, { passive: false });
        window.addEventListener('touchend', endPaint);

        // UI Controls
        const tools = document.querySelectorAll('.tool-btn');
        tools.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const toolType = btn.dataset.tool;
                const shapeType = btn.dataset.shape;

                // Update UI
                tools.forEach(t => t.classList.remove('active', 'border-white', 'border-width-4'));
                btn.classList.add('active');

                // Update State
                state.tool = toolType;
                if (shapeType) state.brushShape = shapeType;
            });
        });

        document.getElementById('size-slider').addEventListener('input', (e) => {
            state.size = parseInt(e.target.value);
        });

        document.getElementById('btn-clear').addEventListener('click', () => {
            if(confirm("Are you sure you want to clear your beautiful sky?")) {
                ctx.clearRect(0, 0, width, height);
            }
        });

        document.getElementById('btn-save').addEventListener('click', () => {
            // Combine canvases
            const combinedCanvas = document.createElement('canvas');
            combinedCanvas.width = width;
            combinedCanvas.height = height;
            const cCtx = combinedCanvas.getContext('2d');
            
            // Fill Background gradient
            const grad = cCtx.createLinearGradient(0, 0, 0, height);
            grad.addColorStop(0, '#87CEEB');
            grad.addColorStop(1, '#E0F6FF');
            cCtx.fillStyle = grad;
            cCtx.fillRect(0, 0, width, height);

            // Draw layers
            cCtx.drawImage(bgCanvas, 0, 0);
            cCtx.drawImage(paintCanvas, 0, 0);

            // Download
            const link = document.createElement('a');
            link.download = 'my-cloud-painting.png';
            link.href = combinedCanvas.toDataURL();
            link.click();
        });

        // Start
        resize();
        initBackgroundClouds();
        loop();

    </script>
</body>
</html>