<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival Lights Show</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 3em;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
            text-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .subtitle {
            color: #aaa;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .stage-container {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .stage {
            width: 100%;
            aspect-ratio: 16/9;
            background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.8);
        }

        .light-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 8px;
            padding: 20px;
            height: 100%;
            position: relative;
            z-index: 1;
        }

        .light {
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px currentColor;
            position: relative;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        .glow-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        button {
            background: linear-gradient(135deg, #6b21a8 0%, #9333ea 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(147, 51, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(147, 51, 234, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        button.active {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5);
        }

        .color-picker-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-btn {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 10px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-btn:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .slider-container {
            margin-bottom: 20px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #aaa;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }

        .music-controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .music-controls h3 {
            color: #ff00ff;
        }

        .waveform {
            display: flex;
            align-items: center;
            justify-content: space-around;
            height: 80px;
            margin: 15px 0;
            gap: 3px;
        }

        .bar {
            flex: 1;
            background: linear-gradient(to top, #ff00ff, #00ffff);
            border-radius: 3px;
            transition: height 0.1s ease;
            min-height: 5px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.8em;
            color: #aaa;
            margin-top: 5px;
            text-transform: uppercase;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2em;
            }

            .light-grid {
                grid-template-columns: repeat(10, 1fr);
                grid-template-rows: repeat(5, 1fr);
            }
        }

        @media (max-width: 640px) {
            .light-grid {
                grid-template-columns: repeat(8, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }

            .button-group {
                grid-template-columns: 1fr;
            }
        }

        .pattern-info {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.9em;
            color: #00ffff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÜ Festival Lights Show üéÜ</h1>
            <p class="subtitle">Control Your Virtual Light Show</p>
        </header>

        <div class="main-content">
            <div class="stage-container">
                <div class="stage">
                    <canvas class="glow-effect" id="glowCanvas"></canvas>
                    <div class="light-grid" id="lightGrid"></div>
                </div>
                <div class="pattern-info" id="patternInfo">Pattern: Rainbow Wave</div>
            </div>

            <div class="control-panel">
                <div class="control-section">
                    <h3>üé® Color Palette</h3>
                    <div class="color-picker-group">
                        <div class="color-btn" style="background: #ff0000;" data-color="#ff0000"></div>
                        <div class="color-btn" style="background: #00ff00;" data-color="#00ff00"></div>
                        <div class="color-btn" style="background: #0000ff;" data-color="#0000ff"></div>
                        <div class="color-btn" style="background: #ffff00;" data-color="#ffff00"></div>
                        <div class="color-btn" style="background: #ff00ff;" data-color="#ff00ff"></div>
                        <div class="color-btn" style="background: #00ffff;" data-color="#00ffff"></div>
                        <div class="color-btn" style="background: #ff8800;" data-color="#ff8800"></div>
                        <div class="color-btn" style="background: #ffffff;" data-color="#ffffff"></div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>‚ú® Patterns</h3>
                    <div class="button-group">
                        <button class="pattern-btn active" data-pattern="rainbow">Rainbow</button>
                        <button class="pattern-btn" data-pattern="wave">Wave</button>
                        <button class="pattern-btn" data-pattern="pulse">Pulse</button>
                        <button class="pattern-btn" data-pattern="strobe">Strobe</button>
                        <button class="pattern-btn" data-pattern="spiral">Spiral</button>
                        <button class="pattern-btn" data-pattern="fireworks">Fireworks</button>
                        <button class="pattern-btn" data-pattern="chase">Chase</button>
                        <button class="pattern-btn" data-pattern="random">Random</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>‚öôÔ∏è Controls</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Speed</span>
                            <span id="speedValue">50</span>
                        </div>
                        <input type="range" id="speedSlider" min="1" max="100" value="50">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Brightness</span>
                            <span id="brightnessValue">100</span>
                        </div>
                        <input type="range" id="brightnessSlider" min="0" max="100" value="100">
                    </div>
                </div>

                <div class="music-controls">
                    <h3>üéµ Music Sync</h3>
                    <button id="musicToggle" style="width: 100%; margin-bottom: 15px;">Start Music Sync</button>
                    <div class="waveform" id="waveform">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="lightCount">72</div>
                        <div class="stat-label">Lights Active</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="fps">60</div>
                        <div class="stat-label">FPS</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const GRID_COLS = 12;
        const GRID_ROWS = 6;
        const TOTAL_LIGHTS = GRID_COLS * GRID_ROWS;

        // State
        let currentPattern = 'rainbow';
        let currentColor = '#ff00ff';
        let speed = 50;
        let brightness = 100;
        let animationFrame = 0;
        let isAnimating = true;
        let musicSync = false;
        let audioContext = null;
        let analyser = null;
        let dataArray = null;

        // Initialize
        const lightGrid = document.getElementById('lightGrid');
        const glowCanvas = document.getElementById('glowCanvas');
        const glowCtx = glowCanvas.getContext('2d');
        const lights = [];

        // Create lights
        for (let i = 0; i < TOTAL_LIGHTS; i++) {
            const light = document.createElement('div');
            light.className = 'light';
            light.style.backgroundColor = '#333';
            lightGrid.appendChild(light);
            lights.push(light);
        }

        // Setup canvas
        function resizeCanvas() {
            const stage = document.querySelector('.stage');
            glowCanvas.width = stage.offsetWidth;
            glowCanvas.height = stage.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Color utilities
        function hslToHex(h, s, l) {
            l /= 100;
            const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }

        function adjustBrightness(color, brightness) {
            const r = parseInt(color.slice(1, 3), 16);
            const g = parseInt(color.slice(3, 5), 16);
            const b = parseInt(color.slice(5, 7), 16);
            const factor = brightness / 100;
            return `rgb(${Math.round(r * factor)}, ${Math.round(g * factor)}, ${Math.round(b * factor)})`;
        }

        // Pattern functions
        const patterns = {
            rainbow: (index, frame) => {
                const hue = (frame * 2 + index * 10) % 360;
                return hslToHex(hue, 100, 50);
            },
            wave: (index, frame) => {
                const col = index % GRID_COLS;
                const row = Math.floor(index / GRID_COLS);
                const wave = Math.sin((col + frame / 10) * 0.5) * 0.5 + 0.5;
                const hue = (wave * 360 + row * 30) % 360;
                return hslToHex(hue, 100, 50);
            },
            pulse: (index, frame) => {
                const pulse = Math.sin(frame / 10) * 0.5 + 0.5;
                const hue = (frame * 2) % 360;
                const lightness = 30 + pulse * 40;
                return hslToHex(hue, 100, lightness);
            },
            strobe: (index, frame) => {
                const on = Math.floor(frame / 5) % 2 === 0;
                return on ? '#ffffff' : '#000000';
            },
            spiral: (index, frame) => {
                const col = index % GRID_COLS;
                const row = Math.floor(index / GRID_COLS);
                const centerX = GRID_COLS / 2;
                const centerY = GRID_ROWS / 2;
                const angle = Math.atan2(row - centerY, col - centerX);
                const distance = Math.sqrt(Math.pow(col - centerX, 2) + Math.pow(row - centerY, 2));
                const hue = ((angle * 180 / Math.PI) + frame * 5 + distance * 20) % 360;
                return hslToHex(hue, 100, 50);
            },
            fireworks: (index, frame) => {
                const col = index % GRID_COLS;
                const row = Math.floor(index / GRID_COLS);
                const burstFrame = frame % 50;
                if (burstFrame < 30) {
                    const centerX = ((frame / 50) * GRID_COLS) % GRID_COLS;
                    const centerY = ((frame / 50) * GRID_ROWS) % GRID_ROWS;
                    const distance = Math.sqrt(Math.pow(col - centerX, 2) + Math.pow(row - centerY, 2));
                    if (Math.abs(distance - burstFrame / 3) < 1) {
                        const hue = (frame * 10) % 360;
                        return hslToHex(hue, 100, 50);
                    }
                }
                return '#000000';
            },
            chase: (index, frame) => {
                const active = (index + Math.floor(frame / 2)) % TOTAL_LIGHTS < GRID_COLS;
                if (active) {
                    const hue = (frame * 5) % 360;
                    return hslToHex(hue, 100, 50);
                }
                return '#111111';
            },
            random: (index, frame) => {
                if (frame % 5 === 0) {
                    const hue = Math.random() * 360;
                    return hslToHex(hue, 100, 50);
                }
                return lights[index].style.backgroundColor;
            },
            music: (index, frame, audioData) => {
                if (!audioData) return '#000000';
                const dataIndex = Math.floor((index / TOTAL_LIGHTS) * audioData.length);
                const value = audioData[dataIndex] / 255;
                const hue = (value * 360) % 360;
                const lightness = 20 + value * 40;
                return hslToHex(hue, 100, lightness);
            }
        };

        // Animation loop
        function animate() {
            if (!isAnimating) return;

            const actualSpeed = speed / 50;
            animationFrame += actualSpeed;

            // Clear canvas
            glowCtx.clearRect(0, 0, glowCanvas.width, glowCanvas.height);

            // Get audio data if music sync is active
            let audioData = null;
            if (musicSync && analyser) {
                analyser.getByteFrequencyData(dataArray);
                audioData = dataArray;
                updateWaveform(audioData);
            }

            // Update lights
            lights.forEach((light, index) => {
                let color;
                if (musicSync && audioData) {
                    color = patterns.music(index, animationFrame, audioData);
                } else if (patterns[currentPattern]) {
                    color = patterns[currentPattern](index, animationFrame);
                } else {
                    color = currentColor;
                }

                const adjustedColor = adjustBrightness(color, brightness);
                light.style.backgroundColor = adjustedColor;

                // Add glow effect to canvas
                if (brightness > 20) {
                    const col = index % GRID_COLS;
                    const row = Math.floor(index / GRID_COLS);
                    const x = (col / GRID_COLS) * glowCanvas.width;
                    const y = (row / GRID_ROWS) * glowCanvas.height;
                    const gradient = glowCtx.createRadialGradient(x, y, 0, x, y, 40);
                    gradient.addColorStop(0, adjustedColor.replace(')', ', 0.3)').replace('rgb', 'rgba'));
                    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                    glowCtx.fillStyle = gradient;
                    glowCtx.fillRect(x - 40, y - 40, 80, 80);
                }
            });

            // Update FPS counter
            if (Math.floor(animationFrame) % 30 === 0) {
                document.getElementById('fps').textContent = '60';
            }

            requestAnimationFrame(animate);
        }

        // Waveform visualization
        function updateWaveform(audioData) {
            const bars = document.querySelectorAll('.waveform .bar');
            bars.forEach((bar, index) => {
                const dataIndex = Math.floor((index / bars.length) * audioData.length);
                const value = audioData[dataIndex];
                const height = (value / 255) * 100;
                bar.style.height = `${Math.max(height, 5)}%`;
            });
        }

        function simulateAudioData() {
            if (!musicSync) return;
            const bars = document.querySelectorAll('.waveform .bar');
            bars.forEach((bar) => {
                const height = Math.random() * 80 + 20;
                bar.style.height = `${height}%`;
            });
        }

        // Event listeners
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentColor = btn.dataset.color;
                currentPattern = 'solid';
                document.getElementById('patternInfo').textContent = 'Pattern: Solid Color';
            });
        });

        document.querySelectorAll('.pattern-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.pattern-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPattern = btn.dataset.pattern;
                const patternName = btn.textContent;
                document.getElementById('patternInfo').textContent = `Pattern: ${patternName}`;
                if (musicSync) {
                    musicSync = false;
                    document.getElementById('musicToggle').textContent = 'Start Music Sync';
                    document.getElementById('musicToggle').classList.remove('active');
                }
            });
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = speed;
        });

        document.getElementById('brightnessSlider').addEventListener('input', (e) => {
            brightness = parseInt(e.target.value);
            document.getElementById('brightnessValue').textContent = brightness;
        });

        document.getElementById('musicToggle').addEventListener('click', function() {
            musicSync = !musicSync;
            if (musicSync) {
                this.textContent = 'Stop Music Sync';
                this.classList.add('active');
                document.getElementById('patternInfo').textContent = 'Pattern: Music Reactive';

                // Try to start audio context with microphone
                if (!audioContext) {
                    navigator.mediaDevices.getUserMedia({ audio: true })
                        .then(stream => {
                            audioContext = new (window.AudioContext || window.webkitAudioContext)();
                            const source = audioContext.createMediaStreamSource(stream);
                            analyser = audioContext.createAnalyser();
                            analyser.fftSize = 256;
                            source.connect(analyser);
                            dataArray = new Uint8Array(analyser.frequencyBinCount);
                        })
                        .catch(err => {
                            console.log('Microphone access denied, using simulation');
                            // Simulate audio data
                            setInterval(simulateAudioData, 50);
                        });
                } else {
                    audioContext.resume();
                }

                // Fallback to simulation
                if (!analyser) {
                    setInterval(simulateAudioData, 50);
                }
            } else {
                this.textContent = 'Start Music Sync';
                this.classList.remove('active');
                if (audioContext) {
                    audioContext.suspend();
                }
                // Reset to previous pattern
                const activePattern = document.querySelector('.pattern-btn.active');
                if (activePattern) {
                    currentPattern = activePattern.dataset.pattern;
                    document.getElementById('patternInfo').textContent = `Pattern: ${activePattern.textContent}`;
                }
            }
        });

        // Start animation
        animate();

        // Initial waveform animation
        setInterval(() => {
            if (!musicSync) {
                const bars = document.querySelectorAll('.waveform .bar');
                bars.forEach((bar) => {
                    bar.style.height = '20%';
                });
            }
        }, 100);
    </script>
</body>
</html>
