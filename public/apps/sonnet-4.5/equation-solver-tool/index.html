<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equation Solver Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --success: #27ae60;
            --background: #ecf0f1;
            --surface: #ffffff;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --border: #bdc3c7;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.05rem;
        }

        .card {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px var(--shadow), 0 1px 3px var(--shadow);
        }

        .input-section {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-group {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        input[type="text"] {
            flex: 1;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1.05rem;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
            background: #fafafa;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            background: white;
        }

        button {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: var(--success);
            color: white;
        }

        .btn-secondary:hover {
            background: #229954;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
        }

        .btn-secondary:disabled {
            background: var(--border);
            cursor: not-allowed;
            transform: none;
        }

        .examples {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .example-btn {
            padding: 0.5rem 0.875rem;
            background: #ecf0f1;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.875rem;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .result-section {
            display: none;
        }

        .result-section.visible {
            display: block;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .result-header h2 {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .equation-display {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-family: 'Courier New', monospace;
            text-align: center;
        }

        .solution-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .solution-display h3 {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            opacity: 0.9;
        }

        .solution-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .steps-container h3 {
            color: var(--primary);
            font-size: 1.25rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .step {
            background: #f8f9fa;
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--success);
            transition: all 0.2s;
        }

        .step:hover {
            box-shadow: 0 2px 8px var(--shadow);
            transform: translateX(4px);
        }

        .step-number {
            display: inline-block;
            background: var(--success);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-weight: 700;
            margin-right: 0.75rem;
            font-size: 0.875rem;
        }

        .step-content {
            display: inline;
            font-size: 1.05rem;
        }

        .step-math {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            border: 1px solid var(--border);
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #c33;
            margin-bottom: 1rem;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid var(--accent);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            color: var(--secondary);
        }

        .info-box strong {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        @media (max-width: 640px) {
            body {
                padding: 1rem 0.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            .card {
                padding: 1.25rem;
            }

            .input-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }

        .mjx-math {
            font-size: 1.1em !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Equation Solver</h1>
            <p class="subtitle">Solve mathematical equations with step-by-step explanations</p>
        </header>

        <div class="card">
            <div class="input-section">
                <label for="equation">Enter Equation</label>
                <div class="input-group">
                    <input
                        type="text"
                        id="equation"
                        placeholder="e.g., 2x + 5 = 13 or x^2 - 4x + 4 = 0"
                        autocomplete="off"
                    >
                    <button class="btn-primary" onclick="solveEquation()">Solve</button>
                </div>
                <div class="examples">
                    <span style="font-size: 0.875rem; color: var(--text-light); margin-right: 0.5rem;">Examples:</span>
                    <button class="example-btn" onclick="loadExample('2x + 5 = 13')">2x + 5 = 13</button>
                    <button class="example-btn" onclick="loadExample('x^2 - 4x + 4 = 0')">x² - 4x + 4 = 0</button>
                    <button class="example-btn" onclick="loadExample('3x - 7 = 2x + 8')">3x - 7 = 2x + 8</button>
                    <button class="example-btn" onclick="loadExample('x^2 - 5x + 6 = 0')">x² - 5x + 6 = 0</button>
                </div>
            </div>

            <div class="info-box">
                <strong>Supported Formats:</strong>
                Linear equations (e.g., 2x + 5 = 13), Quadratic equations (e.g., x^2 - 4x + 4 = 0),
                Variables: x, y, z. Use ^ for exponents, * for multiplication.
            </div>
        </div>

        <div id="resultSection" class="card result-section">
            <div class="result-header">
                <h2>Solution</h2>
                <button class="btn-secondary" id="exportBtn" onclick="exportResults()">Export Results</button>
            </div>

            <div id="errorDisplay"></div>

            <div id="equationDisplay" class="equation-display"></div>

            <div id="solutionDisplay" class="solution-display"></div>

            <div id="stepsContainer" class="steps-container">
                <h3>Step-by-Step Solution</h3>
                <div id="steps"></div>
            </div>
        </div>
    </div>

    <script>
        let currentEquation = '';
        let currentSolution = null;
        let currentSteps = [];

        function loadExample(equation) {
            document.getElementById('equation').value = equation;
        }

        function solveEquation() {
            const input = document.getElementById('equation').value.trim();

            if (!input) {
                showError('Please enter an equation');
                return;
            }

            try {
                currentEquation = input;
                const result = parseAndSolve(input);
                displayResults(result);
            } catch (error) {
                showError(error.message || 'Unable to solve equation. Please check your input.');
            }
        }

        function parseAndSolve(equation) {
            // Split by equals sign
            const parts = equation.split('=');
            if (parts.length !== 2) {
                throw new Error('Equation must contain exactly one "=" sign');
            }

            const leftSide = parts[0].trim();
            const rightSide = parts[1].trim();

            // Detect variable (assume x, y, or z)
            let variable = 'x';
            if (equation.includes('y') && !equation.includes('x')) variable = 'y';
            if (equation.includes('z') && !equation.includes('x') && !equation.includes('y')) variable = 'z';

            // Move everything to left side: leftSide - rightSide = 0
            const expression = `(${leftSide}) - (${rightSide})`;

            // Determine equation type
            const degree = getPolynomialDegree(expression, variable);

            if (degree === 1) {
                return solveLinear(leftSide, rightSide, variable);
            } else if (degree === 2) {
                return solveQuadratic(expression, variable, leftSide, rightSide);
            } else if (degree === 0) {
                // Check if it's a valid identity
                const left = math.evaluate(leftSide);
                const right = math.evaluate(rightSide);
                if (Math.abs(left - right) < 1e-10) {
                    return {
                        type: 'identity',
                        solution: 'True for all values',
                        steps: [
                            { description: 'Evaluate both sides', math: `${leftSide} = ${left}` },
                            { description: 'Compare values', math: `${rightSide} = ${right}` },
                            { description: 'Conclusion', math: 'The equation is an identity (always true)' }
                        ]
                    };
                } else {
                    throw new Error('No solution exists (contradiction)');
                }
            } else {
                return solveNumerically(expression, variable, leftSide, rightSide);
            }
        }

        function getPolynomialDegree(expression, variable) {
            try {
                const parsed = math.parse(expression);
                const simplified = math.simplify(parsed);
                const str = simplified.toString();

                // Check for quadratic terms
                if (str.includes(`${variable}^2`) || str.includes(`${variable} ^ 2`)) {
                    return 2;
                }
                // Check for linear terms
                if (str.includes(variable)) {
                    return 1;
                }
                return 0;
            } catch (e) {
                return -1;
            }
        }

        function solveLinear(leftSide, rightSide, variable) {
            const steps = [];

            steps.push({
                description: 'Original equation',
                math: `${leftSide} = ${rightSide}`
            });

            try {
                // Parse both sides
                const left = math.parse(leftSide);
                const right = math.parse(rightSide);

                // Simplify
                const leftSimplified = math.simplify(left);
                const rightSimplified = math.simplify(right);

                steps.push({
                    description: 'Simplify both sides',
                    math: `${leftSimplified.toString()} = ${rightSimplified.toString()}`
                });

                // Move all terms to left side
                const equation = `${leftSimplified.toString()} - (${rightSimplified.toString()})`;
                const combined = math.simplify(equation);

                steps.push({
                    description: `Subtract right side from both sides`,
                    math: `${combined.toString()} = 0`
                });

                // Solve for variable
                const solution = math.evaluate(`solve(${leftSide} = ${rightSide}, ${variable})`);
                const solutionValue = Array.isArray(solution) ? solution[0] : solution;

                steps.push({
                    description: `Solve for ${variable}`,
                    math: `${variable} = ${formatNumber(solutionValue)}`
                });

                // Verify
                const scope = {};
                scope[variable] = solutionValue;
                const leftCheck = math.evaluate(leftSide, scope);
                const rightCheck = math.evaluate(rightSide, scope);

                steps.push({
                    description: 'Verify solution',
                    math: `${formatNumber(leftCheck)} = ${formatNumber(rightCheck)} ✓`
                });

                return {
                    type: 'linear',
                    solution: formatNumber(solutionValue),
                    variable: variable,
                    steps: steps
                };
            } catch (e) {
                throw new Error('Unable to solve linear equation');
            }
        }

        function solveQuadratic(expression, variable, leftSide, rightSide) {
            const steps = [];

            steps.push({
                description: 'Original equation',
                math: `${leftSide} = ${rightSide}`
            });

            try {
                // Rearrange to standard form ax^2 + bx + c = 0
                const simplified = math.simplify(expression);

                steps.push({
                    description: 'Rearrange to standard form',
                    math: `${simplified.toString()} = 0`
                });

                // Extract coefficients
                const coeffs = extractQuadraticCoeffs(simplified.toString(), variable);
                const { a, b, c } = coeffs;

                steps.push({
                    description: 'Identify coefficients',
                    math: `a = ${formatNumber(a)}, b = ${formatNumber(b)}, c = ${formatNumber(c)}`
                });

                // Calculate discriminant
                const discriminant = b * b - 4 * a * c;

                steps.push({
                    description: 'Calculate discriminant (b² - 4ac)',
                    math: `Δ = ${formatNumber(b)}² - 4(${formatNumber(a)})(${formatNumber(c)}) = ${formatNumber(discriminant)}`
                });

                let solutions = [];

                if (discriminant > 0) {
                    const x1 = (-b + Math.sqrt(discriminant)) / (2 * a);
                    const x2 = (-b - Math.sqrt(discriminant)) / (2 * a);
                    solutions = [x1, x2];

                    steps.push({
                        description: 'Apply quadratic formula (two solutions)',
                        math: `${variable} = (-b ± √Δ) / (2a)`
                    });

                    steps.push({
                        description: 'Calculate solutions',
                        math: `${variable}₁ = ${formatNumber(x1)}, ${variable}₂ = ${formatNumber(x2)}`
                    });
                } else if (discriminant === 0) {
                    const x = -b / (2 * a);
                    solutions = [x];

                    steps.push({
                        description: 'Apply quadratic formula (one solution)',
                        math: `${variable} = -b / (2a)`
                    });

                    steps.push({
                        description: 'Calculate solution',
                        math: `${variable} = ${formatNumber(x)}`
                    });
                } else {
                    const real = -b / (2 * a);
                    const imag = Math.sqrt(-discriminant) / (2 * a);

                    steps.push({
                        description: 'Complex solutions (discriminant < 0)',
                        math: `${variable} = ${formatNumber(real)} ± ${formatNumber(imag)}i`
                    });

                    return {
                        type: 'quadratic',
                        solution: `${formatNumber(real)} ± ${formatNumber(imag)}i`,
                        variable: variable,
                        steps: steps
                    };
                }

                return {
                    type: 'quadratic',
                    solution: solutions.map(s => formatNumber(s)).join(', '),
                    variable: variable,
                    steps: steps
                };
            } catch (e) {
                throw new Error('Unable to solve quadratic equation');
            }
        }

        function extractQuadraticCoeffs(expression, variable) {
            let a = 0, b = 0, c = 0;

            try {
                const scope = {};
                scope[variable] = 0;
                c = math.evaluate(expression, scope);

                scope[variable] = 1;
                const y1 = math.evaluate(expression, scope);

                scope[variable] = 2;
                const y2 = math.evaluate(expression, scope);

                // System: a + b + c = y1, 4a + 2b + c = y2
                // We have c already
                // a + b = y1 - c
                // 4a + 2b = y2 - c
                // 2(a + b) = 2(y1 - c)
                // 4a + 2b = y2 - c
                // Subtract: 2a = y2 - c - 2(y1 - c) = y2 - c - 2y1 + 2c = y2 - 2y1 + c
                a = (y2 - 2 * y1 + c) / 2;
                b = y1 - c - a;

            } catch (e) {
                // Fallback
                a = 1;
                b = 0;
                c = 0;
            }

            return { a, b, c };
        }

        function solveNumerically(expression, variable, leftSide, rightSide) {
            const steps = [];

            steps.push({
                description: 'Original equation',
                math: `${leftSide} = ${rightSide}`
            });

            steps.push({
                description: 'Using numerical methods to find solution',
                math: 'Newton-Raphson method'
            });

            try {
                // Try Newton-Raphson method
                const f = math.parse(expression);
                const df = math.derivative(f, variable);

                let x = 1; // Initial guess
                let iterations = 0;
                const maxIterations = 50;
                const tolerance = 1e-10;

                steps.push({
                    description: 'Start with initial guess',
                    math: `${variable}₀ = ${x}`
                });

                while (iterations < maxIterations) {
                    const scope = {};
                    scope[variable] = x;

                    const fx = f.evaluate(scope);
                    const dfx = df.evaluate(scope);

                    if (Math.abs(dfx) < 1e-15) break;

                    const xNew = x - fx / dfx;

                    if (Math.abs(xNew - x) < tolerance) {
                        x = xNew;
                        break;
                    }

                    x = xNew;
                    iterations++;

                    if (iterations <= 3 || iterations === maxIterations - 1) {
                        steps.push({
                            description: `Iteration ${iterations}`,
                            math: `${variable} ≈ ${formatNumber(x)}`
                        });
                    }
                }

                if (iterations < maxIterations) {
                    steps.push({
                        description: 'Solution converged',
                        math: `${variable} = ${formatNumber(x)}`
                    });

                    return {
                        type: 'numerical',
                        solution: formatNumber(x),
                        variable: variable,
                        steps: steps
                    };
                } else {
                    throw new Error('Solution did not converge');
                }
            } catch (e) {
                throw new Error('Unable to solve equation numerically');
            }
        }

        function formatNumber(num) {
            if (typeof num !== 'number') return String(num);
            if (Number.isInteger(num)) return String(num);
            if (Math.abs(num) < 1e-10) return '0';
            return num.toFixed(6).replace(/\.?0+$/, '');
        }

        function displayResults(result) {
            currentSolution = result;
            currentSteps = result.steps;

            // Clear error
            document.getElementById('errorDisplay').innerHTML = '';

            // Show result section
            document.getElementById('resultSection').classList.add('visible');

            // Display equation
            document.getElementById('equationDisplay').innerHTML =
                `<strong>Equation:</strong> ${escapeHtml(currentEquation)}`;

            // Display solution
            let solutionHTML = '<h3>Solution</h3>';
            if (result.variable) {
                solutionHTML += `<div class="solution-value">${result.variable} = ${escapeHtml(result.solution)}</div>`;
            } else {
                solutionHTML += `<div class="solution-value">${escapeHtml(result.solution)}</div>`;
            }
            document.getElementById('solutionDisplay').innerHTML = solutionHTML;

            // Display steps
            const stepsHTML = result.steps.map((step, index) => `
                <div class="step">
                    <span class="step-number">${index + 1}</span>
                    <div class="step-content">
                        <strong>${escapeHtml(step.description)}</strong>
                        <div class="step-math">${escapeHtml(step.math)}</div>
                    </div>
                </div>
            `).join('');

            document.getElementById('steps').innerHTML = stepsHTML;

            // Scroll to results
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function showError(message) {
            document.getElementById('resultSection').classList.add('visible');
            document.getElementById('errorDisplay').innerHTML =
                `<div class="error"><strong>Error:</strong> ${escapeHtml(message)}</div>`;
            document.getElementById('equationDisplay').innerHTML = '';
            document.getElementById('solutionDisplay').innerHTML = '';
            document.getElementById('steps').innerHTML = '';
        }

        function exportResults() {
            if (!currentSolution) return;

            let text = '='.repeat(50) + '\n';
            text += 'EQUATION SOLVER RESULTS\n';
            text += '='.repeat(50) + '\n\n';
            text += `Equation: ${currentEquation}\n\n`;

            if (currentSolution.variable) {
                text += `Solution: ${currentSolution.variable} = ${currentSolution.solution}\n\n`;
            } else {
                text += `Solution: ${currentSolution.solution}\n\n`;
            }

            text += 'STEP-BY-STEP SOLUTION\n';
            text += '-'.repeat(50) + '\n\n';

            currentSteps.forEach((step, index) => {
                text += `Step ${index + 1}: ${step.description}\n`;
                text += `${step.math}\n\n`;
            });

            text += '='.repeat(50) + '\n';
            text += `Generated: ${new Date().toLocaleString()}\n`;

            // Create download
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'equation-solution.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Allow Enter key to solve
        document.getElementById('equation').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                solveEquation();
            }
        });
    </script>
</body>
</html>
