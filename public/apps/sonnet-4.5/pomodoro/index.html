<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro - Stay Energized & Productive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .light-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #1a202c;
        }

        .dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #f7fafc;
        }

        .timer-circle {
            transition: stroke-dashoffset 1s linear;
        }

        .session-card {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark-mode .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-bar {
            transition: height 0.5s ease, fill 0.3s ease;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        input[type="number"] {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .dark-mode input[type="number"] {
            background: rgba(45, 55, 72, 0.9);
            color: #f7fafc;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: #cbd5e0;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active::after {
            left: 26px;
        }

        .energy-text {
            text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            font-weight: 700;
        }
    </style>
</head>
<body class="light-mode min-h-screen">
    <div id="app" class="min-h-screen p-4 md:p-8">
        <!-- Header -->
        <header class="max-w-6xl mx-auto mb-8">
            <div class="flex justify-between items-center glass-effect rounded-2xl p-4 md:p-6">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold energy-text">üçÖ Pomodoro</h1>
                    <p class="text-sm md:text-base opacity-90 mt-1">Stay energized & productive!</p>
                </div>
                <button id="darkModeToggle" class="p-3 rounded-full glass-effect hover:scale-110 transition-transform">
                    <span id="darkModeIcon" class="text-2xl">üåô</span>
                </button>
            </div>
        </header>

        <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Timer Section -->
            <div class="lg:col-span-2">
                <div class="glass-effect rounded-2xl p-6 md:p-8 mb-6">
                    <!-- Timer Display -->
                    <div class="flex justify-center mb-8">
                        <svg width="280" height="280" class="transform -rotate-90">
                            <circle
                                cx="140"
                                cy="140"
                                r="120"
                                stroke="rgba(255, 255, 255, 0.2)"
                                stroke-width="12"
                                fill="none"
                            />
                            <circle
                                id="timerCircle"
                                cx="140"
                                cy="140"
                                r="120"
                                stroke="url(#gradient)"
                                stroke-width="12"
                                fill="none"
                                stroke-linecap="round"
                                class="timer-circle"
                                style="stroke-dasharray: 754; stroke-dashoffset: 0;"
                            />
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <text x="140" y="130" text-anchor="middle" class="transform rotate-90" style="transform-origin: 140px 140px;">
                                <tspan id="timerDisplay" class="text-5xl font-bold fill-current">25:00</tspan>
                            </text>
                            <text x="140" y="165" text-anchor="middle" class="transform rotate-90" style="transform-origin: 140px 140px;">
                                <tspan id="timerStatus" class="text-lg fill-current opacity-80">Ready to focus</tspan>
                            </text>
                        </svg>
                    </div>

                    <!-- Controls -->
                    <div class="flex justify-center gap-4 mb-6">
                        <button id="startBtn" class="btn-primary text-white px-8 py-3 rounded-full font-semibold text-lg shadow-lg">
                            Start
                        </button>
                        <button id="pauseBtn" class="glass-effect px-8 py-3 rounded-full font-semibold text-lg hidden">
                            Pause
                        </button>
                        <button id="resetBtn" class="glass-effect px-6 py-3 rounded-full font-semibold text-lg">
                            Reset
                        </button>
                    </div>

                    <!-- Settings -->
                    <div class="glass-effect rounded-xl p-4 md:p-6">
                        <h3 class="text-xl font-bold mb-4">‚öôÔ∏è Settings</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Focus Duration (min)</label>
                                <input type="number" id="focusDuration" value="25" min="1" max="60" class="w-full px-4 py-2 rounded-lg font-semibold">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Short Break (min)</label>
                                <input type="number" id="shortBreak" value="5" min="1" max="30" class="w-full px-4 py-2 rounded-lg font-semibold">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Long Break (min)</label>
                                <input type="number" id="longBreak" value="15" min="1" max="60" class="w-full px-4 py-2 rounded-lg font-semibold">
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <label class="text-sm font-medium">üîÑ Auto-start next session</label>
                            <div id="autoStartToggle" class="toggle-switch"></div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Chart -->
                <div class="glass-effect rounded-2xl p-6 md:p-8">
                    <h3 class="text-xl font-bold mb-4">üìä Session Statistics</h3>
                    <div class="mb-4">
                        <div class="flex gap-4 text-center">
                            <div class="flex-1 glass-effect rounded-lg p-3">
                                <div class="text-2xl font-bold" id="totalSessions">0</div>
                                <div class="text-sm opacity-80">Total Sessions</div>
                            </div>
                            <div class="flex-1 glass-effect rounded-lg p-3">
                                <div class="text-2xl font-bold" id="totalMinutes">0</div>
                                <div class="text-sm opacity-80">Total Minutes</div>
                            </div>
                            <div class="flex-1 glass-effect rounded-lg p-3">
                                <div class="text-2xl font-bold" id="todaySessions">0</div>
                                <div class="text-sm opacity-80">Today</div>
                            </div>
                        </div>
                    </div>
                    <svg id="chartSvg" width="100%" height="200" class="mt-4"></svg>
                </div>
            </div>

            <!-- Session Log -->
            <div class="lg:col-span-1">
                <div class="glass-effect rounded-2xl p-6 sticky top-4">
                    <h3 class="text-xl font-bold mb-4">üìù Session Log</h3>
                    <div id="sessionLog" class="space-y-3 max-h-[600px] overflow-y-auto">
                        <p class="text-center opacity-60 py-8">No sessions yet. Start your first Pomodoro! üöÄ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let state = {
            isRunning: false,
            isPaused: false,
            timeLeft: 25 * 60,
            totalTime: 25 * 60,
            currentSession: 'focus', // focus, shortBreak, longBreak
            focusCount: 0,
            sessions: [],
            autoStart: false,
            isDarkMode: false,
            intervalId: null,
            startTime: null
        };

        // Audio Context for beep
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playBeep() {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // DOM Elements
        const elements = {
            timerDisplay: document.getElementById('timerDisplay'),
            timerStatus: document.getElementById('timerStatus'),
            timerCircle: document.getElementById('timerCircle'),
            startBtn: document.getElementById('startBtn'),
            pauseBtn: document.getElementById('pauseBtn'),
            resetBtn: document.getElementById('resetBtn'),
            focusDuration: document.getElementById('focusDuration'),
            shortBreak: document.getElementById('shortBreak'),
            longBreak: document.getElementById('longBreak'),
            autoStartToggle: document.getElementById('autoStartToggle'),
            darkModeToggle: document.getElementById('darkModeToggle'),
            darkModeIcon: document.getElementById('darkModeIcon'),
            sessionLog: document.getElementById('sessionLog'),
            totalSessions: document.getElementById('totalSessions'),
            totalMinutes: document.getElementById('totalMinutes'),
            todaySessions: document.getElementById('todaySessions'),
            chartSvg: document.getElementById('chartSvg')
        };

        // Load from localStorage
        function loadState() {
            const saved = localStorage.getItem('pomodoroState');
            if (saved) {
                const parsed = JSON.parse(saved);
                state.sessions = parsed.sessions || [];
                state.autoStart = parsed.autoStart || false;
                state.isDarkMode = parsed.isDarkMode || false;
                state.focusCount = parsed.focusCount || 0;

                if (parsed.focusDuration) elements.focusDuration.value = parsed.focusDuration;
                if (parsed.shortBreak) elements.shortBreak.value = parsed.shortBreak;
                if (parsed.longBreak) elements.longBreak.value = parsed.longBreak;
            }

            // Apply dark mode
            if (state.isDarkMode) {
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
                elements.darkModeIcon.textContent = '‚òÄÔ∏è';
            }

            // Apply auto-start toggle
            if (state.autoStart) {
                elements.autoStartToggle.classList.add('active');
            }

            updateStats();
            renderChart();
            renderSessionLog();
        }

        // Save to localStorage
        function saveState() {
            localStorage.setItem('pomodoroState', JSON.stringify({
                sessions: state.sessions,
                autoStart: state.autoStart,
                isDarkMode: state.isDarkMode,
                focusCount: state.focusCount,
                focusDuration: elements.focusDuration.value,
                shortBreak: elements.shortBreak.value,
                longBreak: elements.longBreak.value
            }));
        }

        // Format time
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Update display
        function updateDisplay() {
            elements.timerDisplay.textContent = formatTime(state.timeLeft);

            const statusTexts = {
                focus: state.isRunning ? 'üî• Stay focused!' : 'Ready to focus',
                shortBreak: state.isRunning ? '‚òï Short break' : 'Break time',
                longBreak: state.isRunning ? 'üéâ Long break' : 'Break time'
            };
            elements.timerStatus.textContent = statusTexts[state.currentSession];

            // Update circle
            const circumference = 2 * Math.PI * 120;
            const progress = 1 - (state.timeLeft / state.totalTime);
            const offset = circumference * progress;
            elements.timerCircle.style.strokeDashoffset = offset;

            // Update document title
            document.title = `${formatTime(state.timeLeft)} - Pomodoro`;
        }

        // Timer logic
        function tick() {
            if (state.timeLeft > 0) {
                state.timeLeft--;
                updateDisplay();
            } else {
                completeSession();
            }
        }

        function startTimer() {
            if (!state.isRunning) {
                initAudio(); // Initialize audio on user interaction
                state.isRunning = true;
                state.isPaused = false;
                state.startTime = Date.now() - ((state.totalTime - state.timeLeft) * 1000);
                state.intervalId = setInterval(tick, 1000);
                elements.startBtn.classList.add('hidden');
                elements.pauseBtn.classList.remove('hidden');
                updateDisplay();
            }
        }

        function pauseTimer() {
            if (state.isRunning) {
                state.isRunning = false;
                state.isPaused = true;
                clearInterval(state.intervalId);
                elements.startBtn.classList.remove('hidden');
                elements.startBtn.textContent = 'Resume';
                elements.pauseBtn.classList.add('hidden');
            }
        }

        function resetTimer() {
            state.isRunning = false;
            state.isPaused = false;
            clearInterval(state.intervalId);

            const durations = {
                focus: parseInt(elements.focusDuration.value) * 60,
                shortBreak: parseInt(elements.shortBreak.value) * 60,
                longBreak: parseInt(elements.longBreak.value) * 60
            };

            state.timeLeft = durations[state.currentSession];
            state.totalTime = state.timeLeft;

            elements.startBtn.classList.remove('hidden');
            elements.startBtn.textContent = 'Start';
            elements.pauseBtn.classList.add('hidden');
            updateDisplay();
        }

        function completeSession() {
            state.isRunning = false;
            clearInterval(state.intervalId);

            // Play beep
            playBeep();

            // Log session
            const session = {
                type: state.currentSession,
                duration: Math.floor(state.totalTime / 60),
                timestamp: new Date().toISOString(),
                completed: true
            };
            state.sessions.unshift(session);

            // Keep only last 50 sessions
            if (state.sessions.length > 50) {
                state.sessions = state.sessions.slice(0, 50);
            }

            if (state.currentSession === 'focus') {
                state.focusCount++;
            }

            saveState();
            updateStats();
            renderChart();
            renderSessionLog();

            // Move to next session
            if (state.currentSession === 'focus') {
                if (state.focusCount % 4 === 0) {
                    state.currentSession = 'longBreak';
                } else {
                    state.currentSession = 'shortBreak';
                }
            } else {
                state.currentSession = 'focus';
            }

            resetTimer();

            // Auto-start if enabled
            if (state.autoStart) {
                setTimeout(() => startTimer(), 2000);
            }

            // Notification
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Pomodoro Complete! üéâ', {
                    body: `Time for a ${state.currentSession === 'focus' ? 'focus session' : 'break'}!`,
                    icon: 'üçÖ'
                });
            }
        }

        // Update stats
        function updateStats() {
            const totalSessions = state.sessions.filter(s => s.type === 'focus').length;
            const totalMinutes = state.sessions.reduce((sum, s) => sum + s.duration, 0);

            const today = new Date().toDateString();
            const todaySessions = state.sessions.filter(s => {
                return new Date(s.timestamp).toDateString() === today && s.type === 'focus';
            }).length;

            elements.totalSessions.textContent = totalSessions;
            elements.totalMinutes.textContent = totalMinutes;
            elements.todaySessions.textContent = todaySessions;
        }

        // Render chart
        function renderChart() {
            const svg = elements.chartSvg;
            const width = svg.clientWidth;
            const height = 200;
            const padding = 40;

            // Clear previous chart
            svg.innerHTML = '';

            // Get last 7 days
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                days.push(date.toDateString());
            }

            // Count sessions per day
            const counts = days.map(day => {
                return state.sessions.filter(s => {
                    return new Date(s.timestamp).toDateString() === day && s.type === 'focus';
                }).length;
            });

            const maxCount = Math.max(...counts, 1);
            const barWidth = (width - padding * 2) / days.length - 10;
            const maxBarHeight = height - padding * 2;

            // Draw bars
            counts.forEach((count, i) => {
                const x = padding + i * (barWidth + 10);
                const barHeight = (count / maxCount) * maxBarHeight;
                const y = height - padding - barHeight;

                // Bar
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', barWidth);
                rect.setAttribute('height', barHeight);
                rect.setAttribute('fill', 'url(#gradient)');
                rect.setAttribute('rx', '4');
                rect.classList.add('chart-bar');
                svg.appendChild(rect);

                // Count label
                if (count > 0) {
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', x + barWidth / 2);
                    text.setAttribute('y', y - 5);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('class', 'text-sm font-bold fill-current');
                    text.textContent = count;
                    svg.appendChild(text);
                }

                // Day label
                const dayLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                dayLabel.setAttribute('x', x + barWidth / 2);
                dayLabel.setAttribute('y', height - 10);
                dayLabel.setAttribute('text-anchor', 'middle');
                dayLabel.setAttribute('class', 'text-xs fill-current opacity-70');
                dayLabel.textContent = new Date(days[i]).toLocaleDateString('en', { weekday: 'short' });
                svg.appendChild(dayLabel);
            });
        }

        // Render session log
        function renderSessionLog() {
            if (state.sessions.length === 0) {
                elements.sessionLog.innerHTML = '<p class="text-center opacity-60 py-8">No sessions yet. Start your first Pomodoro! üöÄ</p>';
                return;
            }

            const html = state.sessions.slice(0, 20).map(session => {
                const time = new Date(session.timestamp).toLocaleTimeString('en', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const date = new Date(session.timestamp).toLocaleDateString('en', {
                    month: 'short',
                    day: 'numeric'
                });

                const icons = {
                    focus: 'üçÖ',
                    shortBreak: '‚òï',
                    longBreak: 'üéâ'
                };

                const labels = {
                    focus: 'Focus',
                    shortBreak: 'Short Break',
                    longBreak: 'Long Break'
                };

                return `
                    <div class="session-card glass-effect rounded-lg p-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">${icons[session.type]}</span>
                                <div>
                                    <div class="font-semibold">${labels[session.type]}</div>
                                    <div class="text-xs opacity-70">${session.duration} min</div>
                                </div>
                            </div>
                            <div class="text-right text-xs opacity-70">
                                <div>${date}</div>
                                <div>${time}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            elements.sessionLog.innerHTML = html;
        }

        // Event listeners
        elements.startBtn.addEventListener('click', startTimer);
        elements.pauseBtn.addEventListener('click', pauseTimer);
        elements.resetBtn.addEventListener('click', resetTimer);

        elements.autoStartToggle.addEventListener('click', () => {
            state.autoStart = !state.autoStart;
            elements.autoStartToggle.classList.toggle('active');
            saveState();
        });

        elements.darkModeToggle.addEventListener('click', () => {
            state.isDarkMode = !state.isDarkMode;
            document.body.classList.toggle('light-mode');
            document.body.classList.toggle('dark-mode');
            elements.darkModeIcon.textContent = state.isDarkMode ? '‚òÄÔ∏è' : 'üåô';
            saveState();
            renderChart();
        });

        // Duration changes
        [elements.focusDuration, elements.shortBreak, elements.longBreak].forEach(input => {
            input.addEventListener('change', () => {
                if (!state.isRunning && !state.isPaused) {
                    resetTimer();
                }
                saveState();
            });
        });

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            setTimeout(() => {
                Notification.requestPermission();
            }, 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                if (state.isRunning) {
                    pauseTimer();
                } else {
                    startTimer();
                }
            } else if (e.code === 'KeyR' && e.target.tagName !== 'INPUT') {
                resetTimer();
            }
        });

        // Initialize
        loadState();
        updateDisplay();

        // Update chart on resize
        window.addEventListener('resize', () => {
            renderChart();
        });
    </script>
</body>
</html>
