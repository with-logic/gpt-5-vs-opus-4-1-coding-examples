<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Theory Trainer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .piano-container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 2rem;
        }

        .piano {
            display: flex;
            justify-content: center;
            position: relative;
            height: 200px;
            margin: 2rem auto;
            max-width: 800px;
        }

        .key {
            cursor: pointer;
            transition: all 0.1s;
            user-select: none;
        }

        .white-key {
            width: 60px;
            height: 200px;
            background: white;
            border: 2px solid #333;
            border-radius: 0 0 5px 5px;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .white-key:active,
        .white-key.active {
            background: #e0e0e0;
            transform: translateY(2px);
        }

        .black-key {
            width: 40px;
            height: 120px;
            background: linear-gradient(180deg, #2c2c2c 0%, #000 100%);
            border: 1px solid #000;
            border-radius: 0 0 3px 3px;
            position: absolute;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }

        .black-key:active,
        .black-key.active {
            background: linear-gradient(180deg, #1a1a1a 0%, #000 100%);
            transform: translateY(2px);
        }

        .key-label {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }

        .exercises {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 2rem;
        }

        .exercise-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 1rem 2rem;
            background: #f3f4f6;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .exercise-content {
            display: none;
        }

        .exercise-content.active {
            display: block;
        }

        .question {
            text-align: center;
            padding: 2rem;
            background: #f9fafb;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .note-display {
            font-size: 4rem;
            font-weight: bold;
            color: #667eea;
        }

        .answer-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
        }

        .answer-btn {
            padding: 1rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .answer-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .answer-btn.correct {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .answer-btn.incorrect {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .score {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: #667eea;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .piano {
                transform: scale(0.7);
                transform-origin: center;
            }

            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽµ Music Theory Trainer</h1>
            <p class="subtitle">Learn notes, scales, and chords interactively</p>
        </div>

        <div class="piano-container">
            <h2 style="text-align: center; margin-bottom: 1rem; color: #333;">Interactive Piano</h2>
            <p style="text-align: center; color: #666; margin-bottom: 1rem;">Click keys to hear notes</p>
            <div class="piano" id="piano"></div>
        </div>

        <div class="exercises">
            <div class="exercise-tabs">
                <button class="tab-btn active" data-tab="notes">Note Recognition</button>
                <button class="tab-btn" data-tab="intervals">Intervals</button>
                <button class="tab-btn" data-tab="chords">Chords</button>
            </div>

            <div class="exercise-content active" data-content="notes">
                <div class="question">
                    <div class="question-text">What note is this?</div>
                    <div class="note-display" id="noteDisplay">C</div>
                </div>
                <div class="answer-buttons" id="noteAnswers"></div>
                <div class="score">Score: <span id="noteScore">0/0</span></div>
            </div>

            <div class="exercise-content" data-content="intervals">
                <div class="question">
                    <div class="question-text">What interval is this?</div>
                    <div class="note-display" id="intervalDisplay">C - E</div>
                </div>
                <div class="answer-buttons" id="intervalAnswers"></div>
                <div class="score">Score: <span id="intervalScore">0/0</span></div>
            </div>

            <div class="exercise-content" data-content="chords">
                <div class="question">
                    <div class="question-text">What chord is this?</div>
                    <div class="note-display" id="chordDisplay">C - E - G</div>
                </div>
                <div class="answer-buttons" id="chordAnswers"></div>
                <div class="score">Score: <span id="chordScore">0/0</span></div>
            </div>
        </div>
    </div>

    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
        const blackKeys = ['C#', 'D#', null, 'F#', 'G#', 'A#'];

        const frequencyMap = {
            'C': 261.63, 'C#': 277.18, 'D': 293.66, 'D#': 311.13,
            'E': 329.63, 'F': 349.23, 'F#': 369.99, 'G': 392.00,
            'G#': 415.30, 'A': 440.00, 'A#': 466.16, 'B': 493.88
        };

        let exercises = {
            notes: { correct: 0, total: 0, current: null },
            intervals: { correct: 0, total: 0, current: null },
            chords: { correct: 0, total: 0, current: null }
        };

        function playNote(note, duration = 0.5) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = frequencyMap[note];
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function createPiano() {
            const piano = document.getElementById('piano');
            piano.innerHTML = '';

            whiteKeys.forEach((note, index) => {
                const key = document.createElement('div');
                key.className = 'key white-key';
                key.innerHTML = `<div class="key-label">${note}</div>`;
                key.onclick = () => {
                    key.classList.add('active');
                    playNote(note);
                    setTimeout(() => key.classList.remove('active'), 200);
                };
                key.style.left = `${index * 60}px`;
                piano.appendChild(key);
            });

            blackKeys.forEach((note, index) => {
                if (note) {
                    const key = document.createElement('div');
                    key.className = 'key black-key';
                    key.onclick = () => {
                        key.classList.add('active');
                        playNote(note);
                        setTimeout(() => key.classList.remove('active'), 200);
                    };
                    key.style.left = `${index * 60 + 40}px`;
                    piano.appendChild(key);
                }
            });
        }

        function setupTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const tab = btn.dataset.tab;
                    document.querySelectorAll('.exercise-content').forEach(c => c.classList.remove('active'));
                    document.querySelector(`[data-content="${tab}"]`).classList.add('active');
                });
            });
        }

        function generateNoteQuestion() {
            const note = notes[Math.floor(Math.random() * notes.length)];
            exercises.notes.current = note;

            document.getElementById('noteDisplay').textContent = note;
            playNote(note);

            const answers = [note];
            while (answers.length < 4) {
                const randomNote = notes[Math.floor(Math.random() * notes.length)];
                if (!answers.includes(randomNote)) {
                    answers.push(randomNote);
                }
            }

            answers.sort(() => Math.random() - 0.5);

            const container = document.getElementById('noteAnswers');
            container.innerHTML = '';

            answers.forEach(answer => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer;
                btn.onclick = () => checkAnswer('notes', answer, note);
                container.appendChild(btn);
            });
        }

        function generateIntervalQuestion() {
            const intervals = {
                'Minor 2nd': 1, 'Major 2nd': 2, 'Minor 3rd': 3, 'Major 3rd': 4,
                'Perfect 4th': 5, 'Perfect 5th': 7, 'Minor 6th': 8, 'Major 6th': 9, 'Octave': 12
            };

            const intervalNames = Object.keys(intervals);
            const correctInterval = intervalNames[Math.floor(Math.random() * intervalNames.length)];
            const baseNoteIndex = Math.floor(Math.random() * 5);
            const baseNote = notes[baseNoteIndex];
            const secondNote = notes[baseNoteIndex + intervals[correctInterval]];

            exercises.intervals.current = correctInterval;

            document.getElementById('intervalDisplay').textContent = `${baseNote} - ${secondNote}`;
            playNote(baseNote);
            setTimeout(() => playNote(secondNote), 500);

            const answers = [correctInterval];
            while (answers.length < 4) {
                const randomInterval = intervalNames[Math.floor(Math.random() * intervalNames.length)];
                if (!answers.includes(randomInterval)) {
                    answers.push(randomInterval);
                }
            }

            answers.sort(() => Math.random() - 0.5);

            const container = document.getElementById('intervalAnswers');
            container.innerHTML = '';

            answers.forEach(answer => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer;
                btn.onclick = () => checkAnswer('intervals', answer, correctInterval);
                container.appendChild(btn);
            });
        }

        function generateChordQuestion() {
            const chords = ['Major', 'Minor', 'Diminished', 'Augmented'];
            const correctChord = chords[Math.floor(Math.random() * chords.length)];
            const baseNoteIndex = Math.floor(Math.random() * 5);
            const baseNote = notes[baseNoteIndex];

            let chord = [baseNote];
            switch(correctChord) {
                case 'Major':
                    chord.push(notes[baseNoteIndex + 4], notes[baseNoteIndex + 7]);
                    break;
                case 'Minor':
                    chord.push(notes[baseNoteIndex + 3], notes[baseNoteIndex + 7]);
                    break;
                case 'Diminished':
                    chord.push(notes[baseNoteIndex + 3], notes[baseNoteIndex + 6]);
                    break;
                case 'Augmented':
                    chord.push(notes[baseNoteIndex + 4], notes[baseNoteIndex + 8]);
                    break;
            }

            exercises.chords.current = correctChord;

            document.getElementById('chordDisplay').textContent = chord.join(' - ');
            chord.forEach((note, i) => setTimeout(() => playNote(note, 1), i * 300));

            const container = document.getElementById('chordAnswers');
            container.innerHTML = '';

            chords.forEach(answer => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer;
                btn.onclick = () => checkAnswer('chords', answer, correctChord);
                container.appendChild(btn);
            });
        }

        function checkAnswer(type, answer, correct) {
            exercises[type].total++;

            const buttons = document.querySelectorAll(`#${type}Answers .answer-btn`);
            buttons.forEach(btn => btn.disabled = true);

            if (answer === correct) {
                exercises[type].correct++;
                event.target.classList.add('correct');
                playNote('E', 0.2);
                setTimeout(() => playNote('G', 0.2), 100);
            } else {
                event.target.classList.add('incorrect');
                buttons.forEach(btn => {
                    if (btn.textContent === correct) {
                        btn.classList.add('correct');
                    }
                });
                playNote('G', 0.2);
                setTimeout(() => playNote('E', 0.2), 100);
            }

            document.getElementById(`${type}Score`).textContent =
                `${exercises[type].correct}/${exercises[type].total}`;

            setTimeout(() => {
                if (type === 'notes') generateNoteQuestion();
                else if (type === 'intervals') generateIntervalQuestion();
                else if (type === 'chords') generateChordQuestion();
            }, 1500);
        }

        createPiano();
        setupTabs();
        generateNoteQuestion();
        generateIntervalQuestion();
        generateChordQuestion();
    </script>
</body>
</html>