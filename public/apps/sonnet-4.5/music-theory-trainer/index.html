<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Theory Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        * {
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .piano-key {
            transition: all 0.1s ease;
            cursor: pointer;
            user-select: none;
        }

        .piano-key.white {
            background: linear-gradient(to bottom, #ffffff 0%, #f0f0f0 100%);
            border: 2px solid #333;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .piano-key.white:hover {
            background: linear-gradient(to bottom, #f0f0f0 0%, #e0e0e0 100%);
        }

        .piano-key.white:active, .piano-key.white.playing {
            background: linear-gradient(to bottom, #d0d0d0 0%, #c0c0c0 100%);
            transform: translateY(2px);
            box-shadow: 0 2px 3px rgba(0,0,0,0.3);
        }

        .piano-key.black {
            background: linear-gradient(to bottom, #222 0%, #000 100%);
            border: 2px solid #000;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .piano-key.black:hover {
            background: linear-gradient(to bottom, #333 0%, #111 100%);
        }

        .piano-key.black:active, .piano-key.black.playing {
            background: linear-gradient(to bottom, #111 0%, #000 100%);
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .note-label {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: 600;
            pointer-events: none;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            animation: fadeInUp 0.6s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .btn {
            transition: all 0.3s ease;
            font-weight: 600;
            border-radius: 12px;
            padding: 12px 24px;
            cursor: pointer;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .tab {
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 12px 24px;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.95);
            color: #667eea;
        }

        .tab:not(.active) {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .tab:not(.active):hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .score-animation {
            animation: scorePopIn 0.5s ease;
        }

        @keyframes scorePopIn {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .correct-flash {
            animation: correctFlash 0.5s ease;
        }

        @keyframes correctFlash {
            0%, 100% { background: rgba(255, 255, 255, 0.95); }
            50% { background: rgba(74, 222, 128, 0.3); }
        }

        .wrong-flash {
            animation: wrongFlash 0.5s ease;
        }

        @keyframes wrongFlash {
            0%, 100% { background: rgba(255, 255, 255, 0.95); }
            50% { background: rgba(239, 68, 68, 0.3); }
        }

        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .progress-bar {
            transition: width 0.5s ease;
        }

        .note-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .note-circle:hover {
            transform: scale(1.1);
        }

        .staff-line {
            height: 2px;
            background: #333;
            margin: 8px 0;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8 floating">
            <h1 class="text-5xl md:text-6xl font-bold text-white mb-2 drop-shadow-lg">üéµ Music Theory Trainer</h1>
            <p class="text-xl text-white/90">Master notes, scales, and chords with interactive exercises</p>
        </div>

        <!-- Tabs -->
        <div class="flex flex-wrap gap-2 mb-0">
            <div class="tab active" onclick="switchTab('piano')">üéπ Piano</div>
            <div class="tab" onclick="switchTab('scales')">üéº Scales</div>
            <div class="tab" onclick="switchTab('chords')">üé∏ Chords</div>
            <div class="tab" onclick="switchTab('ear')">üëÇ Ear Training</div>
        </div>

        <!-- Main Content Card -->
        <div class="card">
            <!-- Piano Tab -->
            <div id="piano-tab" class="tab-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Interactive Piano</h2>
                <p class="text-gray-600 mb-6">Click keys or use your keyboard (A-L for white keys, W,E,T,Y,U for black keys)</p>

                <!-- Piano Container -->
                <div class="relative bg-gradient-to-b from-gray-800 to-gray-900 p-8 rounded-xl mb-6">
                    <div id="piano" class="flex justify-center items-end relative" style="height: 220px;">
                        <!-- Piano keys will be generated here -->
                    </div>
                </div>

                <!-- Piano Controls -->
                <div class="flex flex-wrap gap-4 justify-center">
                    <button class="btn bg-blue-500 text-white hover:bg-blue-600" onclick="playScale('major')">Play C Major Scale</button>
                    <button class="btn bg-purple-500 text-white hover:bg-purple-600" onclick="playScale('minor')">Play C Minor Scale</button>
                    <button class="btn bg-green-500 text-white hover:bg-green-600" onclick="playChord('major')">Play C Major Chord</button>
                    <button class="btn bg-pink-500 text-white hover:bg-pink-600" onclick="playChord('minor')">Play C Minor Chord</button>
                </div>
            </div>

            <!-- Scales Tab -->
            <div id="scales-tab" class="tab-content hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Scale Learning</h2>
                <p class="text-gray-600 mb-6">Learn and practice different scales</p>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-blue-800 mb-4">Major Scales</h3>
                        <p class="text-gray-700 mb-4">Pattern: W-W-H-W-W-W-H</p>
                        <p class="text-sm text-gray-600 mb-4">(W = Whole step, H = Half step)</p>
                        <div class="space-y-2">
                            <button class="btn bg-blue-500 text-white w-full hover:bg-blue-600" onclick="demonstrateScale('C', 'major')">C Major</button>
                            <button class="btn bg-blue-500 text-white w-full hover:bg-blue-600" onclick="demonstrateScale('G', 'major')">G Major</button>
                            <button class="btn bg-blue-500 text-white w-full hover:bg-blue-600" onclick="demonstrateScale('D', 'major')">D Major</button>
                            <button class="btn bg-blue-500 text-white w-full hover:bg-blue-600" onclick="demonstrateScale('F', 'major')">F Major</button>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-purple-800 mb-4">Minor Scales</h3>
                        <p class="text-gray-700 mb-4">Pattern: W-H-W-W-H-W-W</p>
                        <p class="text-sm text-gray-600 mb-4">Natural Minor Scale</p>
                        <div class="space-y-2">
                            <button class="btn bg-purple-500 text-white w-full hover:bg-purple-600" onclick="demonstrateScale('A', 'minor')">A Minor</button>
                            <button class="btn bg-purple-500 text-white w-full hover:bg-purple-600" onclick="demonstrateScale('E', 'minor')">E Minor</button>
                            <button class="btn bg-purple-500 text-white w-full hover:bg-purple-600" onclick="demonstrateScale('D', 'minor')">D Minor</button>
                            <button class="btn bg-purple-500 text-white w-full hover:bg-purple-600" onclick="demonstrateScale('C', 'minor')">C Minor</button>
                        </div>
                    </div>
                </div>

                <div class="mt-6 bg-gradient-to-br from-yellow-50 to-yellow-100 p-6 rounded-xl">
                    <h3 class="text-2xl font-bold text-yellow-800 mb-4">üìù Scale Quiz</h3>
                    <p class="text-gray-700 mb-4">Listen to the scale and identify if it's major or minor!</p>
                    <div class="flex gap-4 mb-4">
                        <button class="btn bg-yellow-500 text-white hover:bg-yellow-600" onclick="startScaleQuiz()">Start Quiz</button>
                        <div class="flex-1 bg-white rounded-xl p-4 flex items-center justify-center">
                            <span id="scale-score" class="text-2xl font-bold text-gray-800">Score: 0 / 0</span>
                        </div>
                    </div>
                    <div id="scale-quiz-area" class="hidden space-y-4">
                        <button class="btn bg-green-500 text-white w-full hover:bg-green-600 text-xl" onclick="answerScaleQuiz('major')">Major</button>
                        <button class="btn bg-blue-500 text-white w-full hover:bg-blue-600 text-xl" onclick="answerScaleQuiz('minor')">Minor</button>
                    </div>
                </div>
            </div>

            <!-- Chords Tab -->
            <div id="chords-tab" class="tab-content hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Chord Learning</h2>
                <p class="text-gray-600 mb-6">Learn and practice different chords</p>

                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-green-800 mb-4">Major Chords</h3>
                        <p class="text-gray-700 mb-4">Happy, bright sound</p>
                        <p class="text-sm text-gray-600 mb-4">Root + Major 3rd + Perfect 5th</p>
                        <div class="space-y-2">
                            <button class="btn bg-green-500 text-white w-full hover:bg-green-600" onclick="demonstrateChord('C', 'major')">C Major</button>
                            <button class="btn bg-green-500 text-white w-full hover:bg-green-600" onclick="demonstrateChord('G', 'major')">G Major</button>
                            <button class="btn bg-green-500 text-white w-full hover:bg-green-600" onclick="demonstrateChord('D', 'major')">D Major</button>
                            <button class="btn bg-green-500 text-white w-full hover:bg-green-600" onclick="demonstrateChord('F', 'major')">F Major</button>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-indigo-800 mb-4">Minor Chords</h3>
                        <p class="text-gray-700 mb-4">Sad, melancholic sound</p>
                        <p class="text-sm text-gray-600 mb-4">Root + Minor 3rd + Perfect 5th</p>
                        <div class="space-y-2">
                            <button class="btn bg-indigo-500 text-white w-full hover:bg-indigo-600" onclick="demonstrateChord('A', 'minor')">A Minor</button>
                            <button class="btn bg-indigo-500 text-white w-full hover:bg-indigo-600" onclick="demonstrateChord('E', 'minor')">E Minor</button>
                            <button class="btn bg-indigo-500 text-white w-full hover:bg-indigo-600" onclick="demonstrateChord('D', 'minor')">D Minor</button>
                            <button class="btn bg-indigo-500 text-white w-full hover:bg-indigo-600" onclick="demonstrateChord('C', 'minor')">C Minor</button>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-pink-50 to-pink-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-pink-800 mb-4">Seventh Chords</h3>
                        <p class="text-gray-700 mb-4">Rich, jazzy sound</p>
                        <p class="text-sm text-gray-600 mb-4">Adds a 7th note</p>
                        <div class="space-y-2">
                            <button class="btn bg-pink-500 text-white w-full hover:bg-pink-600" onclick="demonstrateChord('C', 'dominant7')">C7</button>
                            <button class="btn bg-pink-500 text-white w-full hover:bg-pink-600" onclick="demonstrateChord('G', 'dominant7')">G7</button>
                            <button class="btn bg-pink-500 text-white w-full hover:bg-pink-600" onclick="demonstrateChord('D', 'major7')">Dmaj7</button>
                            <button class="btn bg-pink-500 text-white w-full hover:bg-pink-600" onclick="demonstrateChord('A', 'minor7')">Am7</button>
                        </div>
                    </div>
                </div>

                <div class="mt-6 bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-xl">
                    <h3 class="text-2xl font-bold text-orange-800 mb-4">üéØ Chord Quiz</h3>
                    <p class="text-gray-700 mb-4">Listen to the chord and identify if it's major or minor!</p>
                    <div class="flex gap-4 mb-4">
                        <button class="btn bg-orange-500 text-white hover:bg-orange-600" onclick="startChordQuiz()">Start Quiz</button>
                        <div class="flex-1 bg-white rounded-xl p-4 flex items-center justify-center">
                            <span id="chord-score" class="text-2xl font-bold text-gray-800">Score: 0 / 0</span>
                        </div>
                    </div>
                    <div id="chord-quiz-area" class="hidden space-y-4">
                        <button class="btn bg-green-500 text-white w-full hover:bg-green-600 text-xl" onclick="answerChordQuiz('major')">Major Chord</button>
                        <button class="btn bg-blue-500 text-white w-full hover:bg-blue-600 text-xl" onclick="answerChordQuiz('minor')">Minor Chord</button>
                    </div>
                </div>
            </div>

            <!-- Ear Training Tab -->
            <div id="ear-tab" class="tab-content hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Ear Training</h2>
                <p class="text-gray-600 mb-6">Develop your musical ear with these exercises</p>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Note Identification -->
                    <div class="bg-gradient-to-br from-teal-50 to-teal-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-teal-800 mb-4">üéµ Note Identification</h3>
                        <p class="text-gray-700 mb-4">Listen and identify the note!</p>
                        <button class="btn bg-teal-500 text-white w-full hover:bg-teal-600 mb-4" onclick="startNoteQuiz()">Play Note</button>
                        <div id="note-score" class="text-xl font-bold text-center mb-4 text-gray-800">Score: 0 / 0</div>
                        <div id="note-options" class="grid grid-cols-4 gap-2"></div>
                    </div>

                    <!-- Interval Training -->
                    <div class="bg-gradient-to-br from-rose-50 to-rose-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-rose-800 mb-4">üéº Interval Training</h3>
                        <p class="text-gray-700 mb-4">Identify the interval between two notes!</p>
                        <button class="btn bg-rose-500 text-white w-full hover:bg-rose-600 mb-4" onclick="startIntervalQuiz()">Play Interval</button>
                        <div id="interval-score" class="text-xl font-bold text-center mb-4 text-gray-800">Score: 0 / 0</div>
                        <div id="interval-options" class="grid grid-cols-2 gap-2"></div>
                    </div>

                    <!-- Rhythm Training -->
                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-amber-800 mb-4">ü•Å Rhythm Training</h3>
                        <p class="text-gray-700 mb-4">Listen and repeat the rhythm!</p>
                        <button class="btn bg-amber-500 text-white w-full hover:bg-amber-600 mb-4" onclick="startRhythmQuiz()">Play Rhythm</button>
                        <div id="rhythm-score" class="text-xl font-bold text-center mb-4 text-gray-800">Score: 0 / 0</div>
                        <div id="rhythm-input" class="flex justify-center gap-2 mb-4">
                            <button class="btn bg-gray-600 text-white hover:bg-gray-700" onclick="rhythmTap()">Tap Beat ü•Å</button>
                            <button class="btn bg-green-600 text-white hover:bg-green-700" onclick="checkRhythm()">Check</button>
                            <button class="btn bg-red-600 text-white hover:bg-red-700" onclick="resetRhythm()">Reset</button>
                        </div>
                        <div id="rhythm-display" class="text-center text-gray-700"></div>
                    </div>

                    <!-- Perfect Pitch Challenge -->
                    <div class="bg-gradient-to-br from-violet-50 to-violet-100 p-6 rounded-xl">
                        <h3 class="text-2xl font-bold text-violet-800 mb-4">üåü Perfect Pitch Challenge</h3>
                        <p class="text-gray-700 mb-4">Can you identify notes without reference?</p>
                        <button class="btn bg-violet-500 text-white w-full hover:bg-violet-600 mb-4" onclick="startPerfectPitchQuiz()">Start Challenge</button>
                        <div id="perfect-pitch-score" class="text-xl font-bold text-center mb-4 text-gray-800">Score: 0 / 0</div>
                        <div class="mb-4">
                            <div class="bg-white rounded-lg p-4">
                                <div class="flex justify-between mb-2">
                                    <span class="text-sm font-semibold text-gray-700">Progress</span>
                                    <span class="text-sm font-semibold text-gray-700" id="perfect-pitch-progress">0%</span>
                                </div>
                                <div class="bg-gray-200 rounded-full h-3">
                                    <div id="perfect-pitch-bar" class="progress-bar bg-violet-500 h-3 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div id="perfect-pitch-options" class="grid grid-cols-3 gap-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-white/80">
            <p>üéº Practice daily to improve your musical ear! üéµ</p>
        </div>
    </div>

    <script>
        // Audio Context
        let audioContext;
        let masterGain;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioContext.createGain();
                masterGain.connect(audioContext.destination);
                masterGain.gain.value = 0.3;
            }
        }

        // Note frequencies (A4 = 440Hz)
        const noteFrequencies = {
            'C': 261.63, 'C#': 277.18, 'D': 293.66, 'D#': 311.13,
            'E': 329.63, 'F': 349.23, 'F#': 369.99, 'G': 392.00,
            'G#': 415.30, 'A': 440.00, 'A#': 466.16, 'B': 493.88,
            'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25,
            'E5': 659.25, 'F5': 698.46, 'F#5': 739.99, 'G5': 783.99
        };

        // Play a note
        function playNote(frequency, duration = 0.5, startTime = 0) {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(masterGain);

            oscillator.type = 'sine';
            oscillator.frequency.value = frequency;

            const now = audioContext.currentTime + startTime;
            gainNode.gain.setValueAtTime(0, now);
            gainNode.gain.linearRampToValueAtTime(0.3, now + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);

            oscillator.start(now);
            oscillator.stop(now + duration);

            return duration;
        }

        // Generate piano keys
        const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B', 'C5', 'D5', 'E5'];
        const blackKeys = [
            {note: 'C#', position: 0.7},
            {note: 'D#', position: 1.7},
            {note: 'F#', position: 3.7},
            {note: 'G#', position: 4.7},
            {note: 'A#', position: 5.7},
            {note: 'C#5', position: 7.7},
            {note: 'D#5', position: 8.7}
        ];

        const keyboardMap = {
            'a': 'C', 's': 'D', 'd': 'E', 'f': 'F', 'g': 'G', 'h': 'A', 'j': 'B', 'k': 'C5', 'l': 'D5',
            'w': 'C#', 'e': 'D#', 't': 'F#', 'y': 'G#', 'u': 'A#'
        };

        function createPiano() {
            const piano = document.getElementById('piano');
            piano.innerHTML = '';

            // Create white keys
            whiteKeys.forEach((note, index) => {
                const key = document.createElement('div');
                key.className = 'piano-key white';
                key.style.cssText = `
                    width: 60px;
                    height: 200px;
                    position: relative;
                    margin: 0 1px;
                `;
                key.onclick = () => playNoteAndHighlight(note, key);

                const label = document.createElement('div');
                label.className = 'note-label text-gray-700';
                label.textContent = note;
                key.appendChild(label);

                piano.appendChild(key);
            });

            // Create black keys
            blackKeys.forEach(({note, position}) => {
                const key = document.createElement('div');
                key.className = 'piano-key black';
                key.style.cssText = `
                    width: 40px;
                    height: 120px;
                    position: absolute;
                    left: ${position * 61}px;
                    top: 0;
                `;
                key.onclick = () => playNoteAndHighlight(note, key);

                const label = document.createElement('div');
                label.className = 'note-label text-white';
                label.textContent = note;
                key.appendChild(label);

                piano.appendChild(key);
            });
        }

        function playNoteAndHighlight(note, keyElement) {
            playNote(noteFrequencies[note]);
            keyElement.classList.add('playing');
            setTimeout(() => keyElement.classList.remove('playing'), 200);
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            const note = keyboardMap[e.key.toLowerCase()];
            if (note && noteFrequencies[note]) {
                const keys = document.querySelectorAll('.piano-key');
                keys.forEach(key => {
                    if (key.querySelector('.note-label').textContent === note) {
                        playNoteAndHighlight(note, key);
                    }
                });
            }
        });

        // Scale and Chord functions
        const scaleIntervals = {
            major: [0, 2, 4, 5, 7, 9, 11, 12],
            minor: [0, 2, 3, 5, 7, 8, 10, 12]
        };

        const chordIntervals = {
            major: [0, 4, 7],
            minor: [0, 3, 7],
            dominant7: [0, 4, 7, 10],
            major7: [0, 4, 7, 11],
            minor7: [0, 3, 7, 10]
        };

        function getNoteByInterval(baseNote, interval) {
            const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            const baseIndex = notes.indexOf(baseNote);
            const newIndex = (baseIndex + interval) % 12;
            const octave = Math.floor((baseIndex + interval) / 12);
            return notes[newIndex] + (octave > 0 ? '5' : '');
        }

        function playScale(type) {
            const intervals = scaleIntervals[type];
            let time = 0;
            intervals.forEach(interval => {
                const note = getNoteByInterval('C', interval);
                setTimeout(() => playNote(noteFrequencies[note], 0.5), time * 300);
                time++;
            });
        }

        function playChord(type) {
            const intervals = chordIntervals[type];
            intervals.forEach(interval => {
                const note = getNoteByInterval('C', interval);
                playNote(noteFrequencies[note], 1.5);
            });
        }

        function demonstrateScale(root, type) {
            const intervals = scaleIntervals[type];
            let time = 0;
            intervals.forEach(interval => {
                const note = getNoteByInterval(root, interval);
                setTimeout(() => playNote(noteFrequencies[note] || noteFrequencies[note.replace('5', '')], 0.5), time * 300);
                time++;
            });
        }

        function demonstrateChord(root, type) {
            const intervals = chordIntervals[type];
            intervals.forEach(interval => {
                const note = getNoteByInterval(root, interval);
                playNote(noteFrequencies[note] || noteFrequencies[note.replace('5', '')], 1.5);
            });
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Quiz variables
        let scaleQuizCorrect = 0;
        let scaleQuizTotal = 0;
        let currentScaleAnswer = '';

        let chordQuizCorrect = 0;
        let chordQuizTotal = 0;
        let currentChordAnswer = '';

        function startScaleQuiz() {
            const types = ['major', 'minor'];
            currentScaleAnswer = types[Math.floor(Math.random() * types.length)];

            const roots = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
            const root = roots[Math.floor(Math.random() * roots.length)];

            demonstrateScale(root, currentScaleAnswer);

            document.getElementById('scale-quiz-area').classList.remove('hidden');
        }

        function answerScaleQuiz(answer) {
            scaleQuizTotal++;
            const card = document.querySelector('#scales-tab .card, #scales-tab').closest('.card');

            if (answer === currentScaleAnswer) {
                scaleQuizCorrect++;
                card.classList.add('correct-flash');
                setTimeout(() => card.classList.remove('correct-flash'), 500);
            } else {
                card.classList.add('wrong-flash');
                setTimeout(() => card.classList.remove('wrong-flash'), 500);
            }

            document.getElementById('scale-score').textContent = `Score: ${scaleQuizCorrect} / ${scaleQuizTotal}`;
            document.getElementById('scale-score').classList.add('score-animation');
            setTimeout(() => document.getElementById('scale-score').classList.remove('score-animation'), 500);

            document.getElementById('scale-quiz-area').classList.add('hidden');
        }

        function startChordQuiz() {
            const types = ['major', 'minor'];
            currentChordAnswer = types[Math.floor(Math.random() * types.length)];

            const roots = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
            const root = roots[Math.floor(Math.random() * roots.length)];

            demonstrateChord(root, currentChordAnswer);

            document.getElementById('chord-quiz-area').classList.remove('hidden');
        }

        function answerChordQuiz(answer) {
            chordQuizTotal++;
            const card = document.querySelector('#chords-tab').closest('.card');

            if (answer === currentChordAnswer) {
                chordQuizCorrect++;
                card.classList.add('correct-flash');
                setTimeout(() => card.classList.remove('correct-flash'), 500);
            } else {
                card.classList.add('wrong-flash');
                setTimeout(() => card.classList.remove('wrong-flash'), 500);
            }

            document.getElementById('chord-score').textContent = `Score: ${chordQuizCorrect} / ${chordQuizTotal}`;
            document.getElementById('chord-score').classList.add('score-animation');
            setTimeout(() => document.getElementById('chord-score').classList.remove('score-animation'), 500);

            document.getElementById('chord-quiz-area').classList.add('hidden');
        }

        // Ear training quizzes
        let noteQuizCorrect = 0;
        let noteQuizTotal = 0;
        let currentNote = '';

        function startNoteQuiz() {
            const notes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
            currentNote = notes[Math.floor(Math.random() * notes.length)];
            playNote(noteFrequencies[currentNote], 1);

            const optionsDiv = document.getElementById('note-options');
            optionsDiv.innerHTML = '';
            notes.forEach(note => {
                const btn = document.createElement('button');
                btn.className = 'note-circle bg-gradient-to-br from-teal-400 to-teal-600 text-white';
                btn.textContent = note;
                btn.onclick = () => answerNoteQuiz(note);
                optionsDiv.appendChild(btn);
            });
        }

        function answerNoteQuiz(answer) {
            noteQuizTotal++;
            if (answer === currentNote) {
                noteQuizCorrect++;
            }
            document.getElementById('note-score').textContent = `Score: ${noteQuizCorrect} / ${noteQuizTotal}`;
            startNoteQuiz();
        }

        let intervalQuizCorrect = 0;
        let intervalQuizTotal = 0;
        let currentInterval = '';

        const intervals = [
            {name: 'Minor 2nd', semitones: 1},
            {name: 'Major 2nd', semitones: 2},
            {name: 'Minor 3rd', semitones: 3},
            {name: 'Major 3rd', semitones: 4},
            {name: 'Perfect 4th', semitones: 5},
            {name: 'Perfect 5th', semitones: 7},
            {name: 'Octave', semitones: 12}
        ];

        function startIntervalQuiz() {
            const interval = intervals[Math.floor(Math.random() * intervals.length)];
            currentInterval = interval.name;

            const notes = ['C', 'D', 'E', 'F', 'G'];
            const baseNote = notes[Math.floor(Math.random() * notes.length)];
            const secondNote = getNoteByInterval(baseNote, interval.semitones);

            playNote(noteFrequencies[baseNote], 0.5);
            setTimeout(() => playNote(noteFrequencies[secondNote], 0.5), 600);

            const optionsDiv = document.getElementById('interval-options');
            optionsDiv.innerHTML = '';
            intervals.forEach(int => {
                const btn = document.createElement('button');
                btn.className = 'btn bg-rose-500 text-white hover:bg-rose-600';
                btn.textContent = int.name;
                btn.onclick = () => answerIntervalQuiz(int.name);
                optionsDiv.appendChild(btn);
            });
        }

        function answerIntervalQuiz(answer) {
            intervalQuizTotal++;
            if (answer === currentInterval) {
                intervalQuizCorrect++;
            }
            document.getElementById('interval-score').textContent = `Score: ${intervalQuizCorrect} / ${intervalQuizTotal}`;
        }

        // Rhythm training
        let rhythmPattern = [];
        let userRhythm = [];
        let lastTap = 0;
        let rhythmCorrect = 0;
        let rhythmTotal = 0;

        function startRhythmQuiz() {
            rhythmPattern = [];
            userRhythm = [];
            const length = Math.floor(Math.random() * 3) + 3; // 3-5 beats

            for (let i = 0; i < length; i++) {
                rhythmPattern.push(Math.random() > 0.5 ? 500 : 250);
            }

            let time = 0;
            rhythmPattern.forEach((duration, index) => {
                setTimeout(() => {
                    playNote(440, 0.2);
                }, time);
                time += duration;
            });

            document.getElementById('rhythm-display').textContent = `Beats: ${rhythmPattern.length}`;
            lastTap = 0;
        }

        function rhythmTap() {
            const now = Date.now();
            if (lastTap > 0) {
                userRhythm.push(now - lastTap);
            }
            lastTap = now;
            playNote(440, 0.2);

            document.getElementById('rhythm-display').textContent = `Tapped: ${userRhythm.length} / ${rhythmPattern.length}`;
        }

        function checkRhythm() {
            if (userRhythm.length !== rhythmPattern.length) {
                alert('Wrong number of beats!');
                return;
            }

            rhythmTotal++;
            let correct = true;
            for (let i = 0; i < rhythmPattern.length; i++) {
                const diff = Math.abs(userRhythm[i] - rhythmPattern[i]);
                if (diff > 150) {
                    correct = false;
                    break;
                }
            }

            if (correct) {
                rhythmCorrect++;
                alert('Correct! üéâ');
            } else {
                alert('Not quite right. Try again!');
            }

            document.getElementById('rhythm-score').textContent = `Score: ${rhythmCorrect} / ${rhythmTotal}`;
            resetRhythm();
        }

        function resetRhythm() {
            userRhythm = [];
            lastTap = 0;
            document.getElementById('rhythm-display').textContent = '';
        }

        // Perfect Pitch Challenge
        let perfectPitchCorrect = 0;
        let perfectPitchTotal = 0;
        let currentPerfectPitchNote = '';

        function startPerfectPitchQuiz() {
            const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            currentPerfectPitchNote = notes[Math.floor(Math.random() * notes.length)];
            playNote(noteFrequencies[currentPerfectPitchNote], 1);

            const optionsDiv = document.getElementById('perfect-pitch-options');
            optionsDiv.innerHTML = '';
            notes.forEach(note => {
                const btn = document.createElement('button');
                btn.className = 'note-circle bg-gradient-to-br from-violet-400 to-violet-600 text-white text-sm';
                btn.textContent = note;
                btn.onclick = () => answerPerfectPitchQuiz(note);
                optionsDiv.appendChild(btn);
            });
        }

        function answerPerfectPitchQuiz(answer) {
            perfectPitchTotal++;
            const card = document.querySelector('#ear-tab').closest('.card');

            if (answer === currentPerfectPitchNote) {
                perfectPitchCorrect++;
                card.classList.add('correct-flash');
                setTimeout(() => card.classList.remove('correct-flash'), 500);
            } else {
                card.classList.add('wrong-flash');
                setTimeout(() => card.classList.remove('wrong-flash'), 500);
            }

            const percentage = perfectPitchTotal > 0 ? Math.round((perfectPitchCorrect / perfectPitchTotal) * 100) : 0;
            document.getElementById('perfect-pitch-score').textContent = `Score: ${perfectPitchCorrect} / ${perfectPitchTotal}`;
            document.getElementById('perfect-pitch-progress').textContent = `${percentage}%`;
            document.getElementById('perfect-pitch-bar').style.width = `${percentage}%`;

            startPerfectPitchQuiz();
        }

        // Initialize
        createPiano();
    </script>
</body>
</html>