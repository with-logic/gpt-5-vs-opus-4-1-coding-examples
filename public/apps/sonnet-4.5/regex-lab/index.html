<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regex Lab - Interactive Regular Expression Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1e1e1e;
            --bg-secondary: #252526;
            --bg-tertiary: #2d2d30;
            --bg-input: #3c3c3c;
            --text-primary: #d4d4d4;
            --text-secondary: #858585;
            --border: #3e3e42;
            --accent: #007acc;
            --accent-hover: #1a8cd8;
            --error: #f48771;
            --success: #4ec9b0;
            --match-bg: rgba(255, 213, 79, 0.3);
            --match-border: #ffd54f;
            --group-1: #ce9178;
            --group-2: #4ec9b0;
            --group-3: #569cd6;
            --group-4: #c586c0;
            --group-5: #dcdcaa;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        .light-theme {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f3f3;
            --bg-tertiary: #e8e8e8;
            --bg-input: #ffffff;
            --text-primary: #333333;
            --text-secondary: #6b6b6b;
            --border: #d4d4d4;
            --accent: #0066cc;
            --accent-hover: #0052a3;
            --error: #e51400;
            --success: #16825d;
            --match-bg: rgba(255, 213, 79, 0.4);
            --match-border: #e6a700;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 20px;
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px 8px 0 0;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        .window-btn.close { background: #ff5f56; }
        .window-btn.minimize { background: #ffbd2e; }
        .window-btn.maximize { background: #27c93f; }

        .title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .icon-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
        }

        .main-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 20px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pattern-input-group {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .pattern-wrapper {
            flex: 1;
            position: relative;
        }

        .pattern-input {
            width: 100%;
            background: var(--bg-input);
            border: 2px solid var(--border);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .pattern-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .pattern-input.error {
            border-color: var(--error);
        }

        .flags-group {
            display: flex;
            gap: 8px;
            background: var(--bg-input);
            padding: 8px;
            border-radius: 6px;
            border: 2px solid var(--border);
        }

        .flag-checkbox {
            display: none;
        }

        .flag-label {
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            user-select: none;
        }

        .flag-checkbox:checked + .flag-label {
            background: var(--accent);
            color: white;
        }

        .flag-label:hover {
            background: var(--accent-hover);
            color: white;
        }

        .error-message {
            background: rgba(244, 135, 113, 0.15);
            border-left: 3px solid var(--error);
            padding: 10px 12px;
            margin-top: 8px;
            border-radius: 4px;
            font-size: 13px;
            color: var(--error);
        }

        .quick-insert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
            margin-bottom: 12px;
        }

        .quick-insert-btn {
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .quick-insert-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .quick-insert-pattern {
            font-weight: 600;
        }

        .quick-insert-desc {
            font-size: 11px;
            opacity: 0.7;
        }

        .text-input {
            width: 100%;
            min-height: 150px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            line-height: 1.5;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .output-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .output-pane {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 16px;
            min-height: 200px;
        }

        .output-pane.full-width {
            grid-column: 1 / -1;
        }

        .highlighted-text {
            font-family: inherit;
            font-size: 14px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .match-highlight {
            background: var(--match-bg);
            border-bottom: 2px solid var(--match-border);
            padding: 2px 0;
            font-weight: 600;
        }

        .group-1 { color: var(--group-1); border-bottom-color: var(--group-1); }
        .group-2 { color: var(--group-2); border-bottom-color: var(--group-2); }
        .group-3 { color: var(--group-3); border-bottom-color: var(--group-3); }
        .group-4 { color: var(--group-4); border-bottom-color: var(--group-4); }
        .group-5 { color: var(--group-5); border-bottom-color: var(--group-5); }

        .matches-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .matches-table th {
            background: var(--bg-tertiary);
            padding: 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
            color: var(--text-secondary);
        }

        .matches-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border);
        }

        .matches-table tr:hover {
            background: var(--bg-tertiary);
        }

        .match-text {
            font-weight: 600;
            color: var(--success);
        }

        .explanation-list {
            list-style: none;
            padding: 0;
        }

        .explanation-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .explanation-item:last-child {
            border-bottom: none;
        }

        .explanation-token {
            display: inline-block;
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: 600;
            margin-right: 8px;
            color: var(--accent);
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-value {
            font-weight: 600;
            color: var(--success);
        }

        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px 20px;
            font-size: 14px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-input);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px var(--shadow);
            font-size: 14px;
            font-weight: 600;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            pointer-events: none;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .output-grid {
                grid-template-columns: 1fr;
            }

            .pattern-input-group {
                flex-direction: column;
            }

            .flags-group {
                flex-wrap: wrap;
            }

            .quick-insert-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="window-controls">
                    <button class="window-btn close"></button>
                    <button class="window-btn minimize"></button>
                    <button class="window-btn maximize"></button>
                </div>
                <span class="title">Regex Lab</span>
            </div>
            <div class="header-right">
                <button class="icon-btn" id="themeToggle">‚òÄÔ∏è Light</button>
                <button class="icon-btn" id="clearBtn">üóëÔ∏è Clear</button>
                <button class="icon-btn" id="shareBtn">üîó Share</button>
            </div>
        </div>

        <div class="main-content">
            <!-- Pattern Input Section -->
            <div class="section">
                <div class="section-title">Regular Expression Pattern</div>
                <div class="pattern-input-group">
                    <div class="pattern-wrapper">
                        <input
                            type="text"
                            class="pattern-input"
                            id="patternInput"
                            placeholder="Enter your regex pattern..."
                            spellcheck="false"
                        >
                        <div id="errorMessage" class="error-message" style="display: none;"></div>
                    </div>
                    <div class="flags-group">
                        <input type="checkbox" id="flag-g" class="flag-checkbox" checked>
                        <label for="flag-g" class="flag-label" title="Global - find all matches">g</label>

                        <input type="checkbox" id="flag-i" class="flag-checkbox">
                        <label for="flag-i" class="flag-label" title="Case insensitive">i</label>

                        <input type="checkbox" id="flag-m" class="flag-checkbox">
                        <label for="flag-m" class="flag-label" title="Multiline - ^ and $ match line breaks">m</label>

                        <input type="checkbox" id="flag-s" class="flag-checkbox">
                        <label for="flag-s" class="flag-label" title="Dotall - . matches newlines">s</label>

                        <input type="checkbox" id="flag-u" class="flag-checkbox">
                        <label for="flag-u" class="flag-label" title="Unicode">u</label>

                        <input type="checkbox" id="flag-y" class="flag-checkbox">
                        <label for="flag-y" class="flag-label" title="Sticky - match from lastIndex">y</label>
                    </div>
                </div>

                <!-- Quick Insert Tokens -->
                <div class="section-title" style="margin-top: 16px;">Quick Insert Tokens</div>
                <div class="quick-insert-grid" id="quickInserts"></div>
            </div>

            <!-- Test Text Section -->
            <div class="section">
                <div class="section-title">Test Text</div>
                <textarea
                    class="text-input"
                    id="testText"
                    placeholder="Enter text to test your regex pattern..."
                    spellcheck="false"
                ></textarea>
            </div>

            <!-- Output Section -->
            <div class="section">
                <div class="section-title">Results</div>
                <div id="stats" class="stats"></div>
                <div class="output-grid">
                    <div class="output-pane">
                        <div class="section-title">Highlighted Matches</div>
                        <div id="highlightedOutput" class="highlighted-text"></div>
                    </div>
                    <div class="output-pane">
                        <div class="section-title">Match Details</div>
                        <div id="matchesTable"></div>
                    </div>
                    <div class="output-pane full-width">
                        <div class="section-title">Pattern Explanation</div>
                        <div id="explanation"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Quick insert tokens data
        const quickInsertTokens = [
            { pattern: '\\d', desc: 'Any digit (0-9)' },
            { pattern: '\\D', desc: 'Any non-digit' },
            { pattern: '\\w', desc: 'Word character (a-z, A-Z, 0-9, _)' },
            { pattern: '\\W', desc: 'Non-word character' },
            { pattern: '\\s', desc: 'Whitespace (space, tab, newline)' },
            { pattern: '\\S', desc: 'Non-whitespace' },
            { pattern: '[A-Z]', desc: 'Uppercase letter' },
            { pattern: '[a-z]', desc: 'Lowercase letter' },
            { pattern: '[0-9]', desc: 'Any digit' },
            { pattern: '.', desc: 'Any character (except newline)' },
            { pattern: '^', desc: 'Start of line' },
            { pattern: '$', desc: 'End of line' },
            { pattern: '\\b', desc: 'Word boundary' },
            { pattern: '\\B', desc: 'Not a word boundary' },
            { pattern: '*', desc: 'Zero or more' },
            { pattern: '+', desc: 'One or more' },
            { pattern: '?', desc: 'Zero or one (optional)' },
            { pattern: '{n}', desc: 'Exactly n times' },
            { pattern: '{n,}', desc: 'n or more times' },
            { pattern: '{n,m}', desc: 'Between n and m times' },
            { pattern: '()', desc: 'Capture group' },
            { pattern: '(?:)', desc: 'Non-capturing group' },
            { pattern: '(?=)', desc: 'Positive lookahead' },
            { pattern: '(?!)', desc: 'Negative lookahead' },
            { pattern: '(?<=)', desc: 'Positive lookbehind' },
            { pattern: '(?<!)', desc: 'Negative lookbehind' },
            { pattern: '|', desc: 'Alternation (OR)' },
            { pattern: '[]', desc: 'Character class' },
        ];

        // DOM elements
        const patternInput = document.getElementById('patternInput');
        const testText = document.getElementById('testText');
        const highlightedOutput = document.getElementById('highlightedOutput');
        const matchesTable = document.getElementById('matchesTable');
        const explanation = document.getElementById('explanation');
        const errorMessage = document.getElementById('errorMessage');
        const stats = document.getElementById('stats');
        const quickInsertsContainer = document.getElementById('quickInserts');
        const themeToggle = document.getElementById('themeToggle');
        const clearBtn = document.getElementById('clearBtn');
        const shareBtn = document.getElementById('shareBtn');
        const toast = document.getElementById('toast');

        // State
        let currentTheme = 'dark';

        // Initialize quick insert buttons
        function initQuickInserts() {
            quickInsertTokens.forEach(token => {
                const btn = document.createElement('button');
                btn.className = 'quick-insert-btn';
                btn.innerHTML = `
                    <span class="quick-insert-pattern">${escapeHtml(token.pattern)}</span>
                    <span class="quick-insert-desc">${token.desc}</span>
                `;
                btn.onclick = () => insertToken(token.pattern);
                quickInsertsContainer.appendChild(btn);
            });
        }

        // Insert token at cursor position
        function insertToken(token) {
            const start = patternInput.selectionStart;
            const end = patternInput.selectionEnd;
            const text = patternInput.value;
            const before = text.substring(0, start);
            const after = text.substring(end);

            patternInput.value = before + token + after;
            patternInput.focus();

            // Set cursor position after inserted token
            const newPos = start + token.length;
            patternInput.setSelectionRange(newPos, newPos);

            updateResults();
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Get selected flags
        function getFlags() {
            let flags = '';
            ['g', 'i', 'm', 's', 'u', 'y'].forEach(flag => {
                if (document.getElementById(`flag-${flag}`).checked) {
                    flags += flag;
                }
            });
            return flags;
        }

        // Update results
        function updateResults() {
            const pattern = patternInput.value;
            const text = testText.value;
            const flags = getFlags();

            // Clear error
            errorMessage.style.display = 'none';
            patternInput.classList.remove('error');

            if (!pattern) {
                showEmptyState();
                return;
            }

            try {
                const regex = new RegExp(pattern, flags);
                const matches = [];
                let match;

                // Collect all matches
                if (flags.includes('g')) {
                    while ((match = regex.exec(text)) !== null) {
                        matches.push({
                            match: match[0],
                            index: match.index,
                            groups: match.slice(1),
                            fullMatch: match
                        });
                        // Prevent infinite loop for zero-width matches
                        if (match.index === regex.lastIndex) {
                            regex.lastIndex++;
                        }
                    }
                } else {
                    match = regex.exec(text);
                    if (match) {
                        matches.push({
                            match: match[0],
                            index: match.index,
                            groups: match.slice(1),
                            fullMatch: match
                        });
                    }
                }

                displayHighlightedText(text, matches, regex, flags);
                displayMatchesTable(matches);
                displayExplanation(pattern);
                displayStats(matches, text);

            } catch (e) {
                showError(e.message);
                showEmptyState();
            }
        }

        // Display highlighted text with matches
        function displayHighlightedText(text, matches, regex, flags) {
            if (matches.length === 0) {
                highlightedOutput.innerHTML = `<div class="empty-state">No matches found</div>`;
                return;
            }

            let result = '';
            let lastIndex = 0;

            matches.forEach((matchData, matchIndex) => {
                // Add text before match
                result += escapeHtml(text.substring(lastIndex, matchData.index));

                // Add matched text with highlight
                const matchText = matchData.match;
                result += `<span class="match-highlight">${escapeHtml(matchText)}</span>`;

                lastIndex = matchData.index + matchText.length;
            });

            // Add remaining text
            result += escapeHtml(text.substring(lastIndex));

            highlightedOutput.innerHTML = result || '<div class="empty-state">Enter test text to see matches</div>';
        }

        // Display matches table
        function displayMatchesTable(matches) {
            if (matches.length === 0) {
                matchesTable.innerHTML = `<div class="empty-state">No matches to display</div>`;
                return;
            }

            let html = '<table class="matches-table"><thead><tr>';
            html += '<th>#</th><th>Match</th><th>Index</th><th>Length</th>';

            // Check if there are any capture groups
            const maxGroups = Math.max(...matches.map(m => m.groups.length));
            for (let i = 0; i < maxGroups; i++) {
                html += `<th>Group ${i + 1}</th>`;
            }

            html += '</tr></thead><tbody>';

            matches.forEach((matchData, index) => {
                html += '<tr>';
                html += `<td>${index + 1}</td>`;
                html += `<td class="match-text">${escapeHtml(matchData.match)}</td>`;
                html += `<td>${matchData.index}</td>`;
                html += `<td>${matchData.match.length}</td>`;

                for (let i = 0; i < maxGroups; i++) {
                    const group = matchData.groups[i];
                    const groupClass = `group-${(i % 5) + 1}`;
                    html += `<td><span class="${groupClass}">${group !== undefined ? escapeHtml(group) : '-'}</span></td>`;
                }

                html += '</tr>';
            });

            html += '</tbody></table>';
            matchesTable.innerHTML = html;
        }

        // Display pattern explanation
        function displayExplanation(pattern) {
            const explanations = [];

            // Analyze pattern and provide explanations
            const tokens = [
                { regex: /\\d/g, desc: 'Matches any digit (0-9)' },
                { regex: /\\D/g, desc: 'Matches any non-digit character' },
                { regex: /\\w/g, desc: 'Matches any word character (letters, digits, underscore)' },
                { regex: /\\W/g, desc: 'Matches any non-word character' },
                { regex: /\\s/g, desc: 'Matches any whitespace character' },
                { regex: /\\S/g, desc: 'Matches any non-whitespace character' },
                { regex: /\\b/g, desc: 'Matches a word boundary' },
                { regex: /\\B/g, desc: 'Matches a non-word boundary' },
                { regex: /\^/g, desc: 'Matches the start of a line' },
                { regex: /\$/g, desc: 'Matches the end of a line' },
                { regex: /\./g, desc: 'Matches any character except newline' },
                { regex: /\*/g, desc: 'Matches zero or more of the preceding element' },
                { regex: /\+/g, desc: 'Matches one or more of the preceding element' },
                { regex: /\?/g, desc: 'Matches zero or one of the preceding element (makes it optional)' },
                { regex: /\{(\d+)\}/g, desc: 'Matches exactly n occurrences' },
                { regex: /\{(\d+),\}/g, desc: 'Matches n or more occurrences' },
                { regex: /\{(\d+),(\d+)\}/g, desc: 'Matches between n and m occurrences' },
                { regex: /\[([^\]]+)\]/g, desc: 'Character class - matches any character in the set' },
                { regex: /\((?!\?)/g, desc: 'Capturing group - stores the matched text' },
                { regex: /\(\?:/g, desc: 'Non-capturing group - groups without storing' },
                { regex: /\(\?=/g, desc: 'Positive lookahead - matches if followed by pattern' },
                { regex: /\(\?!/g, desc: 'Negative lookahead - matches if not followed by pattern' },
                { regex: /\(\?<=/g, desc: 'Positive lookbehind - matches if preceded by pattern' },
                { regex: /\(\?<!/g, desc: 'Negative lookbehind - matches if not preceded by pattern' },
                { regex: /\|/g, desc: 'Alternation - matches either the left or right side' },
            ];

            tokens.forEach(token => {
                if (token.regex.test(pattern)) {
                    explanations.push({ token: token.regex.source.replace(/\\\\/g, '\\'), desc: token.desc });
                }
            });

            if (explanations.length === 0) {
                explanation.innerHTML = `<div class="empty-state">Enter a pattern to see explanation</div>`;
                return;
            }

            let html = '<ul class="explanation-list">';
            explanations.forEach(exp => {
                html += `<li class="explanation-item">
                    <span class="explanation-token">${escapeHtml(exp.token)}</span>
                    ${escapeHtml(exp.desc)}
                </li>`;
            });
            html += '</ul>';

            explanation.innerHTML = html;
        }

        // Display statistics
        function displayStats(matches, text) {
            if (matches.length === 0) {
                stats.innerHTML = '';
                return;
            }

            const totalChars = matches.reduce((sum, m) => sum + m.match.length, 0);
            const html = `
                <div class="stat-item">
                    <span>Total Matches:</span>
                    <span class="stat-value">${matches.length}</span>
                </div>
                <div class="stat-item">
                    <span>Characters Matched:</span>
                    <span class="stat-value">${totalChars}</span>
                </div>
                <div class="stat-item">
                    <span>Text Length:</span>
                    <span class="stat-value">${text.length}</span>
                </div>
            `;
            stats.innerHTML = html;
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = `Error: ${message}`;
            errorMessage.style.display = 'block';
            patternInput.classList.add('error');
        }

        // Show empty state
        function showEmptyState() {
            highlightedOutput.innerHTML = `<div class="empty-state">Enter a pattern and test text to see results</div>`;
            matchesTable.innerHTML = `<div class="empty-state">No matches to display</div>`;
            explanation.innerHTML = `<div class="empty-state">Enter a pattern to see explanation</div>`;
            stats.innerHTML = '';
        }

        // Theme toggle
        function toggleTheme() {
            if (currentTheme === 'dark') {
                document.body.classList.add('light-theme');
                themeToggle.textContent = 'üåô Dark';
                currentTheme = 'light';
            } else {
                document.body.classList.remove('light-theme');
                themeToggle.textContent = '‚òÄÔ∏è Light';
                currentTheme = 'dark';
            }
            localStorage.setItem('theme', currentTheme);
        }

        // Clear all
        function clearAll() {
            patternInput.value = '';
            testText.value = '';
            document.querySelectorAll('.flag-checkbox').forEach(cb => {
                if (cb.id === 'flag-g') {
                    cb.checked = true;
                } else {
                    cb.checked = false;
                }
            });
            updateResults();
            showToast('All fields cleared');
        }

        // Share permalink
        function sharePermalink() {
            const pattern = patternInput.value;
            const flags = getFlags();
            const text = testText.value;

            const data = {
                p: pattern,
                f: flags,
                t: text
            };

            const hash = btoa(JSON.stringify(data));
            const url = `${window.location.origin}${window.location.pathname}#${hash}`;

            navigator.clipboard.writeText(url).then(() => {
                showToast('Link copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy link');
            });
        }

        // Show toast notification
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Load from URL hash
        function loadFromHash() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                try {
                    const data = JSON.parse(atob(hash));
                    if (data.p) patternInput.value = data.p;
                    if (data.t) testText.value = data.t;
                    if (data.f) {
                        document.querySelectorAll('.flag-checkbox').forEach(cb => {
                            const flag = cb.id.replace('flag-', '');
                            cb.checked = data.f.includes(flag);
                        });
                    }
                    updateResults();
                } catch (e) {
                    console.error('Failed to load from hash:', e);
                }
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                toggleTheme();
            }
        }

        // Event listeners
        patternInput.addEventListener('input', updateResults);
        testText.addEventListener('input', updateResults);
        document.querySelectorAll('.flag-checkbox').forEach(cb => {
            cb.addEventListener('change', updateResults);
        });
        themeToggle.addEventListener('click', toggleTheme);
        clearBtn.addEventListener('click', clearAll);
        shareBtn.addEventListener('click', sharePermalink);

        // Initialize
        initQuickInserts();
        loadTheme();
        loadFromHash();
        showEmptyState();

        // Add default example
        if (!window.location.hash) {
            patternInput.value = '(\\w+)@(\\w+\\.\\w+)';
            testText.value = 'Contact us at support@example.com or sales@company.org for more information.';
            updateResults();
        }
    </script>
</body>
</html>
