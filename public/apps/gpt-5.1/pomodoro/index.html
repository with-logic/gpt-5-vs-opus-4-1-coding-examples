<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pomodoro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #050816;
      --bg-elevated: rgba(15,23,42,0.9);
      --bg-elevated-soft: rgba(15,23,42,0.7);
      --accent: #f97316;
      --accent-soft: rgba(248, 113, 113, 0.18);
      --accent-alt: #22d3ee;
      --accent-alt-soft: rgba(56, 189, 248, 0.2);
      --accent-soft-strong: rgba(248, 113, 113, 0.55);
      --accent-alt-soft-strong: rgba(56, 189, 248, 0.6);
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.35);
      --shadow-soft: 0 22px 45px rgba(15,23,42,0.9);
      --radius-lg: 20px;
      --radius-pill: 999px;
      --timer-size: min(320px, 70vw);
    }
    [data-theme="light"] {
      --bg: #f8fafc;
      --bg-elevated: rgba(255,255,255,0.96);
      --bg-elevated-soft: rgba(255,255,255,0.9);
      --accent: #ea580c;
      --accent-alt: #0891b2;
      --accent-soft: rgba(248, 113, 113, 0.1);
      --accent-alt-soft: rgba(56, 189, 248, 0.12);
      --accent-soft-strong: rgba(248, 113, 113, 0.35);
      --accent-alt-soft-strong: rgba(56, 189, 248, 0.4);
      --text: #020617;
      --text-muted: #6b7280;
      --border-subtle: rgba(148, 163, 184, 0.5);
      --shadow-soft: 0 20px 40px rgba(15,23,42,0.2);
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      background: radial-gradient(circle at top left, #0ea5e9 0, transparent 50%), radial-gradient(circle at bottom right, #f97316 0, transparent 55%), var(--bg);
      background-attachment: fixed;
    }
    body {
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 18px;
    }
    .shell {
      width: 100%;
      max-width: 1120px;
      border-radius: 26px;
      border: 1px solid rgba(148,163,184,0.25);
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.82));
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }
    [data-theme="light"] .shell {
      background: linear-gradient(145deg, rgba(255,255,255,0.96), rgba(241,245,249,0.9));
    }
    .shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 10% 0%, rgba(56,189,248,0.22) 0, transparent 55%), radial-gradient(circle at 90% 100%, rgba(248,113,113,0.24) 0, transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }
    .shell-inner {
      position: relative;
      z-index: 1;
      padding: 18px 22px 20px;
    }
    @media (min-width: 900px) {
      .shell-inner {
        padding: 20px 24px 22px;
      }
    }
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }
    .app-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo-mark {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 20%, #fefce8 0, #f97316 30%, #ea580c 55%, #0f172a 100%);
      box-shadow: 0 10px 25px rgba(248,113,113,0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .logo-mark span {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-weight: 700;
      font-size: 18px;
      color: #0b1120;
      letter-spacing: 0.03em;
    }
    .title-text-main {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: 22px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .title-text-sub {
      font-size: 13px;
      color: var(--text-muted);
    }
    .title-text-sub strong {
      color: var(--accent-alt);
      font-weight: 500;
    }
    .top-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .chip {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.7);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    [data-theme="light"] .chip {
      background: rgba(255,255,255,0.8);
    }
    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fef9c3 0, #f97316 40%, #b91c1c 100%);
      box-shadow: 0 0 14px rgba(248,113,113,0.8);
    }
    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.7);
      border: 1px solid rgba(148,163,184,0.4);
      cursor: pointer;
      user-select: none;
      transition: background 0.18s ease, border-color 0.18s ease, color 0.18s ease, transform 0.08s ease;
    }
    [data-theme="light"] .toggle {
      background: rgba(255,255,255,0.85);
    }
    .toggle:hover {
      transform: translateY(-0.5px);
      border-color: rgba(248,113,113,0.9);
    }
    .toggle-label {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .toggle-pill {
      width: 34px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.85);
      background: radial-gradient(circle at 0% 50%, rgba(15,23,42,0.9) 0, rgba(15,23,42,0.9) 30%, rgba(30,64,175,0.7) 100%);
      position: relative;
      padding: 1px;
      display: flex;
      align-items: center;
    }
    [data-theme="light"] .toggle-pill {
      background: radial-gradient(circle at 0% 50%, #e5e7eb 0, #e5e7eb 30%, #38bdf8 100%);
    }
    .toggle-knob {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #f9fafb;
      box-shadow: 0 7px 12px rgba(15,23,42,0.65);
      transform: translateX(0);
      transition: transform 0.18s ease;
    }
    .toggle[data-on="true"] .toggle-knob {
      transform: translateX(14px);
    }
    .toggle[data-on="true"] {
      color: #fde68a;
      border-color: rgba(245,158,11,0.9);
      background: rgba(30,64,175,0.85);
    }
    [data-theme="light"] .toggle[data-on="true"] {
      color: #ea580c;
      background: rgba(255,247,237,0.98);
    }
    .toggle-icon {
      font-size: 13px;
    }
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 18px;
    }
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .card {
      border-radius: var(--radius-lg);
      background: var(--bg-elevated);
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow: 0 18px 35px rgba(15,23,42,0.85);
      padding: 16px 16px 18px;
      backdrop-filter: blur(18px);
      position: relative;
      overflow: hidden;
    }
    [data-theme="light"] .card {
      box-shadow: 0 16px 30px rgba(15,23,42,0.12);
    }
    .card::before {
      content: "";
      position: absolute;
      inset: -60%;
      background: conic-gradient(from 240deg, rgba(56,189,248,0.08), transparent, rgba(248,113,113,0.12), transparent);
      opacity: 0.7;
      filter: blur(12px);
      transform: translate3d(0,0,0);
    }
    .card-inner {
      position: relative;
      z-index: 1;
    }
    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 12px;
    }
    .card-title {
      font-size: 14px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-muted);
    }
    .card-kicker {
      font-size: 11px;
      color: var(--text-muted);
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.8);
      color: var(--text-muted);
    }
    [data-theme="light"] .badge {
      background: rgba(255,255,255,0.9);
    }
    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fef9c3 0, #a3e635 40%, #16a34a 100%);
      box-shadow: 0 0 12px rgba(190,242,100,0.9);
    }
    .timer-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
    }
    .mode-tabs {
      display: inline-flex;
      background: rgba(15,23,42,0.85);
      border-radius: 999px;
      padding: 4px;
      border: 1px solid rgba(148,163,184,0.65);
      box-shadow: 0 12px 25px rgba(15,23,42,0.9);
    }
    [data-theme="light"] .mode-tabs {
      background: rgba(255,255,255,0.9);
      box-shadow: 0 12px 25px rgba(148,163,184,0.35);
    }
    .mode-tab {
      position: relative;
      border-radius: 999px;
      padding: 6px 15px;
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      border: none;
      color: var(--text-muted);
      background: transparent;
      cursor: pointer;
      transition: color 0.18s ease;
      min-width: 0;
    }
    .mode-tab-label {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }
    .mode-tab-indicator {
      position: absolute;
      inset: 2px;
      border-radius: 999px;
      background: radial-gradient(circle at 0 50%, rgba(250,250,250,0.48), rgba(249,115,22,0.95));
      opacity: 0;
      transform: scale(0.94);
      transition: opacity 0.18s ease, transform 0.18s ease;
      z-index: -1;
    }
    [data-theme="light"] .mode-tab-indicator {
      background: radial-gradient(circle at 0 50%, #fef9c3, #fb923c);
    }
    .mode-tab[data-active="true"] {
      color: #0b1120;
      font-weight: 600;
    }
    .mode-tab[data-active="true"] .mode-tab-indicator {
      opacity: 1;
      transform: scale(1);
    }
    .mode-pill {
      font-size: 10px;
      text-transform: uppercase;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      color: #f97316;
      border: 1px solid rgba(248,113,113,0.6);
    }
    [data-theme="light"] .mode-pill {
      background: rgba(255,247,237,0.98);
    }
    .timer-visual {
      position: relative;
      width: var(--timer-size);
      height: var(--timer-size);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .timer-glow {
      position: absolute;
      inset: 14%;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(56,189,248,0.22), transparent 60%);
      filter: blur(8px);
      opacity: 0.8;
    }
    .timer-glow-secondary {
      position: absolute;
      inset: 20%;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(248,113,113,0.28), transparent 60%);
      filter: blur(14px);
      opacity: 0.75;
    }
    .timer-ring {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .timer-ring svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
      overflow: visible;
    }
    .timer-ring-bg {
      stroke: rgba(15,23,42,0.85);
      stroke-width: 16;
      fill: none;
    }
    [data-theme="light"] .timer-ring-bg {
      stroke: rgba(226,232,240,0.95);
    }
    .timer-ring-progress {
      stroke: url(#timerGradient);
      stroke-width: 16;
      fill: none;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.4s cubic-bezier(0.33, 1, 0.68, 1);
      filter: drop-shadow(0 0 22px rgba(248,113,113,0.7));
    }
    .timer-core {
      position: absolute;
      inset: 21%;
      border-radius: 999px;
      background: radial-gradient(circle at 50% 0%, rgba(248,250,252,0.16), transparent 60%), radial-gradient(circle at 50% 120%, rgba(15,23,42,0.9), rgba(15,23,42,0.9));
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow: 0 22px 55px rgba(15,23,42,1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px;
      text-align: center;
    }
    [data-theme="light"] .timer-core {
      background: radial-gradient(circle at 50% 0%, rgba(255,255,255,0.85), transparent 60%), radial-gradient(circle at 50% 120%, rgba(248,250,252,1), rgba(226,232,240,1));
      box-shadow: 0 18px 45px rgba(148,163,184,0.55);
    }
    .timer-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }
    .timer-time {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: clamp(42px, 7vw, 52px);
      font-weight: 600;
      letter-spacing: 0.12em;
    }
    .timer-mode {
      font-size: 12px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--accent-alt);
    }
    .timer-sub {
      font-size: 11px;
      color: var(--text-muted);
    }
    .timer-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .btn {
      border-radius: 999px;
      border: none;
      padding: 9px 22px;
      font-size: 13px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.15s ease, color 0.15s ease, border-color 0.15s ease;
      white-space: nowrap;
    }
    .btn-primary {
      background: radial-gradient(circle at 0 0, #f97316, #ea580c);
      color: #0b1120;
      box-shadow: 0 16px 24px rgba(248,113,113,0.7);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 20px 32px rgba(248,113,113,0.9);
    }
    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 12px 18px rgba(248,113,113,0.65);
    }
    .btn-ghost {
      background: rgba(15,23,42,0.88);
      color: var(--text-muted);
      border: 1px solid rgba(148,163,184,0.6);
    }
    [data-theme="light"] .btn-ghost {
      background: rgba(255,255,255,0.96);
    }
    .btn-ghost:hover {
      color: var(--accent-alt);
      border-color: rgba(56,189,248,0.9);
      transform: translateY(-1px);
      box-shadow: 0 12px 22px rgba(15,23,42,0.85);
    }
    .btn-ghost:active {
      transform: translateY(0);
      box-shadow: 0 8px 14px rgba(15,23,42,0.75);
    }
    .btn-icon {
      font-size: 15px;
    }
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 14px;
    }
    .stat {
      border-radius: 14px;
      background: rgba(15,23,42,0.88);
      border: 1px solid rgba(148,163,184,0.6);
      padding: 7px 9px;
      position: relative;
      overflow: hidden;
    }
    [data-theme="light"] .stat {
      background: rgba(255,255,255,0.96);
    }
    .stat::before {
      content: "";
      position: absolute;
      inset: -50%;
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.16), transparent 56%);
      opacity: 0.85;
    }
    .stat-inner {
      position: relative;
      z-index: 1;
    }
    .stat-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      margin-bottom: 2px;
    }
    .stat-value {
      font-size: 16px;
      font-weight: 600;
      font-family: "Space Grotesk", system-ui, sans-serif;
    }
    .stat-pill {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      color: var(--accent-alt);
      border: 1px solid rgba(56,189,248,0.8);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 2px;
    }
    [data-theme="light"] .stat-pill {
      background: rgba(240,249,255,0.98);
    }
    .stat-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #16a34a);
    }
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 4px;
    }
    .field-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }
    .field-label span {
      color: var(--accent-alt);
      font-weight: 500;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .input-shell {
      position: relative;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.9);
      padding: 4px 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    [data-theme="light"] .input-shell {
      background: rgba(255,255,255,0.96);
    }
    .input-shell input {
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      font-size: 13px;
      width: 100%;
      font-variant-numeric: tabular-nums;
    }
    .input-shell input::-webkit-outer-spin-button,
    .input-shell input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .input-shell input[type="number"] {
      -moz-appearance: textfield;
    }
    .input-suffix {
      font-size: 11px;
      color: var(--text-muted);
    }
    .input-icon {
      font-size: 13px;
      color: var(--accent-alt);
    }
    .settings-row-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .settings-note {
      font-size: 11px;
      color: var(--text-muted);
    }
    .pill-inline {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(56,189,248,0.55);
      background: rgba(15,23,42,0.8);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent-alt);
    }
    [data-theme="light"] .pill-inline {
      background: rgba(240,249,255,0.96);
    }
    .pill-inline-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #0ea5e9, #0284c7);
    }
    .settings-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-xs {
      padding: 5px 12px;
      font-size: 11px;
      letter-spacing: 0.14em;
    }
    .btn-outline {
      background: transparent;
      color: var(--text-muted);
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      padding: 5px 12px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease, transform 0.08s ease;
    }
    .btn-outline:hover {
      background: rgba(15,23,42,0.9);
      color: var(--accent-alt);
      border-color: rgba(56,189,248,0.9);
      transform: translateY(-1px);
    }
    [data-theme="light"] .btn-outline:hover {
      background: rgba(248,250,252,0.98);
    }
    .btn-outline:active {
      transform: translateY(0);
    }
    .sections-split {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 10px;
    }
    @media (max-width: 900px) {
      .sections-split {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .chart-shell {
      border-radius: 14px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.55);
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 140px;
    }
    [data-theme="light"] .chart-shell {
      background: rgba(255,255,255,0.96);
    }
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
      gap: 8px;
    }
    .chart-legend {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }
    .legend-swatch {
      width: 20px;
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent-soft-strong), var(--accent-alt-soft-strong));
      box-shadow: 0 0 10px rgba(56,189,248,0.55);
    }
    .chart-body {
      flex: 1;
      display: flex;
      align-items: stretch;
      gap: 4px;
      margin-top: 4px;
    }
    .chart-svg {
      width: 100%;
      height: 120px;
    }
    .chart-empty {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    .chart-footer {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .chip-small {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: rgba(15,23,42,0.9);
    }
    [data-theme="light"] .chip-small {
      background: rgba(248,250,252,0.98);
    }
    .sessions-list {
      margin-top: 6px;
      border-radius: 14px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.55);
      max-height: 165px;
      overflow: auto;
    }
    [data-theme="light"] .sessions-list {
      background: rgba(255,255,255,0.96);
    }
    .sessions-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      min-width: 100%;
    }
    .sessions-table thead {
      position: sticky;
      top: 0;
      background: rgba(15,23,42,0.98);
      z-index: 1;
    }
    [data-theme="light"] .sessions-table thead {
      background: rgba(248,250,252,0.98);
    }
    .sessions-table th,
    .sessions-table td {
      padding: 6px 8px;
      text-align: left;
      white-space: nowrap;
    }
    .sessions-table th {
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 10px;
      border-bottom: 1px solid rgba(148,163,184,0.5);
    }
    .sessions-table td {
      border-bottom: 1px solid rgba(15,23,42,0.9);
    }
    [data-theme="light"] .sessions-table td {
      border-bottom: 1px solid rgba(226,232,240,0.95);
    }
    .session-type {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      border: 1px solid rgba(148,163,184,0.7);
    }
    .session-type-focus {
      background: rgba(248,113,113,0.12);
      border-color: rgba(248,113,113,0.75);
      color: #fecaca;
    }
    .session-type-break {
      background: rgba(56,189,248,0.12);
      border-color: rgba(56,189,248,0.75);
      color: #bae6fd;
    }
    [data-theme="light"] .session-type-focus {
      background: rgba(254,242,242,0.96);
      color: #b91c1c;
    }
    [data-theme="light"] .session-type-break {
      background: rgba(240,249,255,0.96);
      color: #0369a1;
    }
    .session-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fecaca, #b91c1c);
    }
    .session-dot-break {
      background: radial-gradient(circle at 30% 20%, #bae6fd, #0369a1);
    }
    .session-empty {
      padding: 10px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
    }
    .footnote {
      margin-top: 10px;
      font-size: 10px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .footnote span strong {
      color: var(--accent);
      font-weight: 500;
    }
    .footnote a {
      color: var(--accent-alt);
      text-decoration: none;
    }
    .footnote a:hover {
      text-decoration: underline;
    }
    @media (max-width: 640px) {
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      .top-actions {
        width: 100%;
        justify-content: space-between;
      }
      .timer-controls {
        gap: 6px;
      }
      .btn {
        padding-inline: 16px;
      }
      .sections-split {
        gap: 8px;
      }
    }
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.7);
      border-radius: 999px;
    }
    .pulse {
      animation: pulse 1s ease-out 1;
    }
    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(248,113,113,0.9);
      }
      70% {
        transform: scale(1.02);
        box-shadow: 0 0 0 18px rgba(248,113,113,0);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(248,113,113,0);
      }
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <div class="shell" aria-label="Pomodoro focus timer">
    <div class="shell-inner">
      <header class="top-bar">
        <div class="app-title" aria-label="Pomodoro">
          <div class="logo-mark" aria-hidden="true">
            <span>P</span>
          </div>
          <div>
            <div class="title-text-main">Pomodoro</div>
            <div class="title-text-sub">
              Rhythm your deep work. <strong>Focus ¬∑ Break ¬∑ Repeat</strong>
            </div>
          </div>
        </div>
        <div class="top-actions">
          <div class="chip">
            <span class="chip-dot"></span>
            <span>Streak-ready focus dashboard</span>
          </div>
          <button class="toggle" id="autoStartToggle" type="button" aria-pressed="false">
            <div class="toggle-label">
              <span class="toggle-icon">‚Üª</span>
              <span>Auto-start next</span>
            </div>
            <div class="toggle-pill" aria-hidden="true">
              <div class="toggle-knob"></div>
            </div>
          </button>
          <button class="toggle" id="themeToggle" type="button" aria-pressed="true">
            <div class="toggle-label">
              <span class="toggle-icon" id="themeToggleIcon">üåô</span>
              <span id="themeToggleLabel">Dark</span>
            </div>
            <div class="toggle-pill" aria-hidden="true">
              <div class="toggle-knob"></div>
            </div>
          </button>
        </div>
      </header>

      <main class="layout">
        <section class="card" aria-label="Timer panel">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <div class="card-title">Session Timer</div>
                <div class="card-kicker">Dial in, breathe, and let the clock carry you.</div>
              </div>
              <div class="badge">
                <span class="badge-dot"></span>
                <span id="streakSummary">Today ¬∑ 0 rounds</span>
              </div>
            </div>

            <div class="timer-wrapper">
              <div class="mode-tabs" role="tablist" aria-label="Timer mode">
                <button class="mode-tab" type="button" data-mode="focus" data-active="true" role="tab" aria-selected="true">
                  <div class="mode-tab-indicator"></div>
                  <span class="mode-tab-label">
                    <span>Focus</span>
                    <span class="mode-pill">Deep</span>
                  </span>
                </button>
                <button class="mode-tab" type="button" data-mode="short-break" data-active="false" role="tab" aria-selected="false">
                  <div class="mode-tab-indicator"></div>
                  <span class="mode-tab-label">
                    <span>Short</span>
                    <span class="mode-pill">Reset</span>
                  </span>
                </button>
                <button class="mode-tab" type="button" data-mode="long-break" data-active="false" role="tab" aria-selected="false">
                  <div class="mode-tab-indicator"></div>
                  <span class="mode-tab-label">
                    <span>Long</span>
                    <span class="mode-pill">Recharge</span>
                  </span>
                </button>
              </div>

              <div class="timer-visual" aria-live="polite">
                <div class="timer-glow" aria-hidden="true"></div>
                <div class="timer-glow-secondary" aria-hidden="true"></div>

                <div class="timer-ring">
                  <svg viewBox="0 0 120 120" aria-hidden="true">
                    <defs>
                      <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#22d3ee"></stop>
                        <stop offset="40%" stop-color="#38bdf8"></stop>
                        <stop offset="100%" stop-color="#f97316"></stop>
                      </linearGradient>
                    </defs>
                    <circle class="timer-ring-bg" cx="60" cy="60" r="46"></circle>
                    <circle class="timer-ring-progress" cx="60" cy="60" r="46" stroke-dasharray="289" stroke-dashoffset="0"></circle>
                  </svg>
                </div>

                <div class="timer-core" id="timerCore">
                  <div class="timer-label">Remaining</div>
                  <div class="timer-time" id="timeDisplay">25:00</div>
                  <div class="timer-mode" id="modeLabel">Focus</div>
                  <div class="timer-sub">
                    <span id="sessionIndexLabel">Round 1</span>
                    <span aria-hidden="true">¬∑</span>
                    <span id="autoStartLabel">Auto-start off</span>
                  </div>
                </div>
              </div>

              <div class="timer-controls" aria-label="Timer controls">
                <button class="btn btn-primary" id="startPauseButton" type="button">
                  <span class="btn-icon" id="startPauseIcon">‚ñ∂</span>
                  <span id="startPauseLabel">Start</span>
                </button>
                <button class="btn btn-ghost" id="resetButton" type="button">
                  <span class="btn-icon">‚Ü∫</span>
                  <span>Reset</span>
                </button>
                <button class="btn btn-ghost" id="skipButton" type="button">
                  <span class="btn-icon">‚á•</span>
                  <span>Skip</span>
                </button>
              </div>

              <div class="stats-row" aria-label="Today focus stats">
                <div class="stat">
                  <div class="stat-inner">
                    <div class="stat-label">Today Focus</div>
                    <div class="stat-value" id="statMinutes">0 min</div>
                    <div class="stat-pill">
                      <span class="stat-pill-dot"></span>
                      <span id="statRounds">0 rounds</span>
                    </div>
                  </div>
                </div>
                <div class="stat">
                  <div class="stat-inner">
                    <div class="stat-label">Current Streak</div>
                    <div class="stat-value" id="statStreak">0 days</div>
                    <div class="stat-pill">
                      <span class="stat-pill-dot"></span>
                      <span id="statLastDay">No sessions</span>
                    </div>
                  </div>
                </div>
                <div class="stat">
                  <div class="stat-inner">
                    <div class="stat-label">All-time Focus</div>
                    <div class="stat-value" id="statAllTime">0 h</div>
                    <div class="stat-pill">
                      <span class="stat-pill-dot"></span>
                      <span id="statAllSessions">0 sessions</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="right-column" aria-label="Settings and history">
          <section class="card" aria-label="Timer settings">
            <div class="card-inner">
              <div class="card-header">
                <div>
                  <div class="card-title">Rhythm Settings</div>
                  <div class="card-kicker">Tune your focus and break lengths.</div>
                </div>
              </div>

              <div class="settings-grid">
                <div class="field">
                  <div class="field-label">
                    Focus <span>min</span>
                  </div>
                  <div class="input-shell">
                    <span class="input-icon">üî•</span>
                    <input id="focusInput" type="number" min="5" max="90" step="1" value="25" aria-label="Focus duration in minutes" />
                    <span class="input-suffix">min</span>
                  </div>
                </div>
                <div class="field">
                  <div class="field-label">
                    Short Break <span>min</span>
                  </div>
                  <div class="input-shell">
                    <span class="input-icon">‚ú®</span>
                    <input id="shortBreakInput" type="number" min="1" max="30" step="1" value="5" aria-label="Short break duration in minutes" />
                    <span class="input-suffix">min</span>
                  </div>
                </div>
                <div class="field">
                  <div class="field-label">
                    Long Break <span>min</span>
                  </div>
                  <div class="input-shell">
                    <span class="input-icon">üåä</span>
                    <input id="longBreakInput" type="number" min="5" max="45" step="1" value="15" aria-label="Long break duration in minutes" />
                    <span class="input-suffix">min</span>
                  </div>
                </div>
              </div>

              <div class="settings-grid" style="margin-top: 8px;">
                <div class="field">
                  <div class="field-label">
                    Long break every <span>focus</span>
                  </div>
                  <div class="input-shell">
                    <span class="input-icon">‚è±</span>
                    <input id="longIntervalInput" type="number" min="2" max="8" step="1" value="4" aria-label="Number of focus rounds before long break" />
                    <span class="input-suffix">rounds</span>
                  </div>
                </div>
                <div class="field">
                  <div class="field-label">
                    Sound <span>beep</span>
                  </div>
                  <div class="input-shell">
                    <span class="input-icon">üîî</span>
                    <span class="input-suffix" id="soundStatusLabel">On completion</span>
                  </div>
                </div>
                <div class="field">
                  <div class="field-label">
                    Theme <span>vibe</span>
                  </div>
                  <div class="input-shell">
                    <span class="input-icon">üé®</span>
                    <span class="input-suffix" id="themeStatusLabel">Dark mode</span>
                  </div>
                </div>
              </div>

              <div class="settings-row-footer">
                <div class="settings-note">
                  <span class="pill-inline">
                    <span class="pill-inline-dot"></span>
                    <span>25 + 5 √ó 4 = Flow</span>
                  </span>
                </div>
                <div class="settings-actions">
                  <button class="btn-outline" id="resetSettingsButton" type="button">
                    <span>Reset defaults</span>
                  </button>
                  <button class="btn-outline" id="clearHistoryButton" type="button">
                    <span>Clear history</span>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <section class="card" aria-label="Sessions and charts">
            <div class="card-inner">
              <div class="card-header">
                <div>
                  <div class="card-title">Sessions Log</div>
                  <div class="card-kicker">Watch your practice stack into momentum.</div>
                </div>
              </div>

              <div class="sections-split">
                <div class="chart-shell" aria-label="Focus minutes chart">
                  <div class="chart-header">
                    <span>Last 7 days ¬∑ Focus minutes</span>
                    <span class="chart-legend">
                      <span class="legend-swatch"></span>
                      <span>Deep work</span>
                    </span>
                  </div>
                  <div class="chart-body">
                    <div id="chartContainer" class="chart-svg" role="img" aria-label="Bar chart of focus minutes"></div>
                    <div id="chartEmpty" class="chart-empty" hidden>No data yet ‚Äî your streak starts today.</div>
                  </div>
                  <div class="chart-footer">
                    <span id="chartHighlight">0 min best day</span>
                    <span class="chip-small">
                      <span>Goal: 100 min / day</span>
                    </span>
                  </div>
                </div>

                <div>
                  <div class="sessions-list" aria-label="Completed sessions">
                    <table class="sessions-table">
                      <thead>
                        <tr>
                          <th scope="col">Type</th>
                          <th scope="col">Duration</th>
                          <th scope="col">When</th>
                        </tr>
                      </thead>
                      <tbody id="sessionsBody">
                        <tr id="sessionsEmptyRow">
                          <td colspan="3" class="session-empty">
                            No sessions yet. Press <strong>Start</strong> to begin your first round.
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </section>
      </main>

      <footer class="footnote">
        <span>
          Built for daily focus. Sessions are stored locally in your browser.
        </span>
        <span>
          Keyboard: <strong>Space</strong> to start/pause ¬∑ <strong>R</strong> to reset ¬∑ <strong>S</strong> to skip.
        </span>
      </footer>
    </div>
  </div>

  <script>
    (function () {
      var storageKeys = {
        settings: "pomodoroSettings_v1",
        sessions: "pomodoroSessions_v1",
        theme: "pomodoroTheme_v1"
      };

      var defaultSettings = {
        focusMinutes: 25,
        shortBreakMinutes: 5,
        longBreakMinutes: 15,
        longBreakInterval: 4,
        autoStartNext: false
      };

      var modeConfig = {
        "focus": {
          label: "Focus",
          type: "focus"
        },
        "short-break": {
          label: "Short Break",
          type: "break"
        },
        "long-break": {
          label: "Long Break",
          type: "break"
        }
      };

      var elements = {
        autoStartToggle: document.getElementById("autoStartToggle"),
        themeToggle: document.getElementById("themeToggle"),
        themeToggleLabel: document.getElementById("themeToggleLabel"),
        themeToggleIcon: document.getElementById("themeToggleIcon"),
        timerCore: document.getElementById("timerCore"),
        timeDisplay: document.getElementById("timeDisplay"),
        modeLabel: document.getElementById("modeLabel"),
        sessionIndexLabel: document.getElementById("sessionIndexLabel"),
        autoStartLabel: document.getElementById("autoStartLabel"),
        startPauseButton: document.getElementById("startPauseButton"),
        startPauseLabel: document.getElementById("startPauseLabel"),
        startPauseIcon: document.getElementById("startPauseIcon"),
        resetButton: document.getElementById("resetButton"),
        skipButton: document.getElementById("skipButton"),
        focusInput: document.getElementById("focusInput"),
        shortBreakInput: document.getElementById("shortBreakInput"),
        longBreakInput: document.getElementById("longBreakInput"),
        longIntervalInput: document.getElementById("longIntervalInput"),
        soundStatusLabel: document.getElementById("soundStatusLabel"),
        themeStatusLabel: document.getElementById("themeStatusLabel"),
        resetSettingsButton: document.getElementById("resetSettingsButton"),
        clearHistoryButton: document.getElementById("clearHistoryButton"),
        sessionsBody: document.getElementById("sessionsBody"),
        sessionsEmptyRow: document.getElementById("sessionsEmptyRow"),
        chartContainer: document.getElementById("chartContainer"),
        chartEmpty: document.getElementById("chartEmpty"),
        chartHighlight: document.getElementById("chartHighlight"),
        statMinutes: document.getElementById("statMinutes"),
        statRounds: document.getElementById("statRounds"),
        statStreak: document.getElementById("statStreak"),
        statLastDay: document.getElementById("statLastDay"),
        statAllTime: document.getElementById("statAllTime"),
        statAllSessions: document.getElementById("statAllSessions"),
        streakSummary: document.getElementById("streakSummary")
      };

      var timerState = {
        mode: "focus",
        remainingSeconds: defaultSettings.focusMinutes * 60,
        initialSeconds: defaultSettings.focusMinutes * 60,
        isRunning: false,
        intervalId: null,
        startedAt: null,
        focusRoundsCompleted: 0,
        sessionCounter: 1
      };

      var settings = loadSettings();
      applySettingsToInputs(settings);

      var sessions = loadSessions();

      initializeTheme();
      applySettingsToState();
      renderTimer();
      renderSessions();
      renderStatsAndChart();
      updateAutoStartToggleVisual();

      attachEventListeners();

      function loadSettings() {
        try {
          var raw = localStorage.getItem(storageKeys.settings);
          if (!raw) {
            return Object.assign({}, defaultSettings);
          }
          var parsed = JSON.parse(raw);
          return Object.assign({}, defaultSettings, parsed);
        } catch (error) {
          return Object.assign({}, defaultSettings);
        }
      }

      function saveSettings(newSettings) {
        settings = Object.assign({}, settings, newSettings);
        try {
          localStorage.setItem(storageKeys.settings, JSON.stringify(settings));
        } catch (error) {
        }
      }

      function loadSessions() {
        try {
          var raw = localStorage.getItem(storageKeys.sessions);
          if (!raw) {
            return [];
          }
          var parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) {
            return [];
          }
          return parsed;
        } catch (error) {
          return [];
        }
      }

      function saveSessions() {
        try {
          localStorage.setItem(storageKeys.sessions, JSON.stringify(sessions));
        } catch (error) {
        }
      }

      function initializeTheme() {
        var root = document.documentElement;
        var storedTheme = null;
        try {
          storedTheme = localStorage.getItem(storageKeys.theme);
        } catch (error) {
        }
        var theme = storedTheme;
        if (theme !== "light" && theme !== "dark") {
          if (window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches) {
            theme = "light";
          } else {
            theme = "dark";
          }
        }
        root.setAttribute("data-theme", theme);
        var isDark = theme === "dark";
        elements.themeToggle.setAttribute("data-on", isDark ? "true" : "false");
        elements.themeToggle.setAttribute("aria-pressed", isDark ? "true" : "false");
        elements.themeToggleLabel.textContent = isDark ? "Dark" : "Light";
        elements.themeToggleIcon.textContent = isDark ? "üåô" : "‚òÄÔ∏è";
        elements.themeStatusLabel.textContent = isDark ? "Dark mode" : "Light mode";
      }

      function toggleTheme() {
        var root = document.documentElement;
        var current = root.getAttribute("data-theme") || "dark";
        var next = current === "dark" ? "light" : "dark";
        root.setAttribute("data-theme", next);
        try {
          localStorage.setItem(storageKeys.theme, next);
        } catch (error) {
        }
        var isDark = next === "dark";
        elements.themeToggle.setAttribute("data-on", isDark ? "true" : "false");
        elements.themeToggle.setAttribute("aria-pressed", isDark ? "true" : "false");
        elements.themeToggleLabel.textContent = isDark ? "Dark" : "Light";
        elements.themeToggleIcon.textContent = isDark ? "üåô" : "‚òÄÔ∏è";
        elements.themeStatusLabel.textContent = isDark ? "Dark mode" : "Light mode";
      }

      function applySettingsToInputs(currentSettings) {
        elements.focusInput.value = currentSettings.focusMinutes;
        elements.shortBreakInput.value = currentSettings.shortBreakMinutes;
        elements.longBreakInput.value = currentSettings.longBreakMinutes;
        elements.longIntervalInput.value = currentSettings.longBreakInterval;
      }

      function applySettingsToState() {
        var seconds = getModeDurationSeconds(timerState.mode, settings);
        timerState.initialSeconds = seconds;
        timerState.remainingSeconds = seconds;
      }

      function getModeDurationSeconds(mode, currentSettings) {
        if (mode === "focus") {
          return Math.max(1, currentSettings.focusMinutes) * 60;
        }
        if (mode === "short-break") {
          return Math.max(1, currentSettings.shortBreakMinutes) * 60;
        }
        if (mode === "long-break") {
          return Math.max(1, currentSettings.longBreakMinutes) * 60;
        }
        return Math.max(1, currentSettings.focusMinutes) * 60;
      }

      function updateAutoStartToggleVisual() {
        var isOn = settings.autoStartNext;
        elements.autoStartToggle.setAttribute("data-on", isOn ? "true" : "false");
        elements.autoStartToggle.setAttribute("aria-pressed", isOn ? "true" : "false");
        elements.autoStartLabel.textContent = isOn ? "Auto-start on" : "Auto-start off";
      }

      function formatSeconds(totalSeconds) {
        var safeSeconds = totalSeconds;
        if (!Number.isFinite(safeSeconds) || safeSeconds < 0) {
          safeSeconds = 0;
        }
        var minutes = Math.floor(safeSeconds / 60);
        var seconds = safeSeconds % 60;
        var minuteText = minutes < 10 ? "0" + minutes : String(minutes);
        var secondText = seconds < 10 ? "0" + seconds : String(seconds);
        return minuteText + ":" + secondText;
      }

      function renderTimer() {
        elements.timeDisplay.textContent = formatSeconds(timerState.remainingSeconds);
        var config = modeConfig[timerState.mode] || modeConfig["focus"];
        elements.modeLabel.textContent = config.label;
        elements.sessionIndexLabel.textContent = "Round " + timerState.sessionCounter;
        elements.autoStartLabel.textContent = settings.autoStartNext ? "Auto-start on" : "Auto-start off";
        elements.startPauseLabel.textContent = timerState.isRunning ? "Pause" : "Start";
        elements.startPauseIcon.textContent = timerState.isRunning ? "‚è∏" : "‚ñ∂";
        updateProgressRing();
        updateModeTabs();
      }

      function updateProgressRing() {
        var progressCircle = document.querySelector(".timer-ring-progress");
        if (!progressCircle) {
          return;
        }
        var radius = 46;
        var circumference = 2 * Math.PI * radius;
        var ratio = timerState.initialSeconds === 0 ? 0 : timerState.remainingSeconds / timerState.initialSeconds;
        var offset = circumference * (1 - ratio);
        progressCircle.setAttribute("stroke-dasharray", String(circumference.toFixed(1)));
        progressCircle.setAttribute("stroke-dashoffset", String(offset.toFixed(1)));
      }

      function updateModeTabs() {
        var tabs = document.querySelectorAll(".mode-tab");
        var activeMode = timerState.mode;
        tabs.forEach(function (tab) {
          var mode = tab.getAttribute("data-mode");
          var isActive = mode === activeMode;
          tab.setAttribute("data-active", isActive ? "true" : "false");
          tab.setAttribute("aria-selected", isActive ? "true" : "false");
          tab.setAttribute("tabindex", isActive ? "0" : "-1");
        });
      }

      function startTimer() {
        if (timerState.isRunning) {
          return;
        }
        if (timerState.remainingSeconds <= 0) {
          timerState.remainingSeconds = timerState.initialSeconds;
        }
        timerState.isRunning = true;
        timerState.startedAt = Date.now();
        var intervalId = setInterval(function () {
          tick();
        }, 1000);
        timerState.intervalId = intervalId;
        renderTimer();
      }

      function pauseTimer() {
        if (!timerState.isRunning) {
          return;
        }
        timerState.isRunning = false;
        clearInterval(timerState.intervalId);
        timerState.intervalId = null;
        timerState.startedAt = null;
        renderTimer();
      }

      function resetTimer() {
        pauseTimer();
        timerState.remainingSeconds = timerState.initialSeconds;
        renderTimer();
      }

      function tick() {
        if (!timerState.isRunning) {
          return;
        }
        if (timerState.remainingSeconds <= 1) {
          timerState.remainingSeconds = 0;
          renderTimer();
          handleTimerComplete();
          return;
        }
        timerState.remainingSeconds -= 1;
        renderTimer();
      }

      function handleTimerComplete() {
        pauseTimer();
        recordCompletedSession();
        playBeep();
        elements.timerCore.classList.remove("pulse");
        void elements.timerCore.offsetWidth;
        elements.timerCore.classList.add("pulse");
        var nextMode = determineNextMode(timerState.mode);
        switchMode(nextMode, true);
        if (settings.autoStartNext) {
          setTimeout(function () {
            startTimer();
          }, 800);
        }
      }

      function determineNextMode(currentMode) {
        if (currentMode === "focus") {
          timerState.focusRoundsCompleted += 1;
          var interval = Math.max(2, settings.longBreakInterval || defaultSettings.longBreakInterval);
          if (timerState.focusRoundsCompleted % interval === 0) {
            return "long-break";
          }
          return "short-break";
        }
        return "focus";
      }

      function switchMode(nextMode, fromAutoAdvance) {
        if (!modeConfig[nextMode]) {
          nextMode = "focus";
        }
        timerState.mode = nextMode;
        timerState.initialSeconds = getModeDurationSeconds(nextMode, settings);
        timerState.remainingSeconds = timerState.initialSeconds;
        timerState.isRunning = false;
        clearInterval(timerState.intervalId);
        timerState.intervalId = null;
        timerState.startedAt = null;
        if (!fromAutoAdvance && nextMode === "focus") {
          timerState.sessionCounter = 1;
          timerState.focusRoundsCompleted = 0;
        }
        if (!fromAutoAdvance && nextMode === "short-break") {
          timerState.sessionCounter = 1;
        }
        if (!fromAutoAdvance && nextMode === "long-break") {
          timerState.sessionCounter = 1;
        }
        renderTimer();
      }

      function recordCompletedSession() {
        var config = modeConfig[timerState.mode] || modeConfig["focus"];
        var totalSeconds = timerState.initialSeconds;
        var now = new Date();
        var startTime = new Date(now.getTime() - totalSeconds * 1000);
        var entry = {
          id: "s_" + now.getTime() + "_" + Math.random().toString(36).slice(2),
          mode: timerState.mode,
          type: config.type,
          startedAt: startTime.toISOString(),
          endedAt: now.toISOString(),
          durationSeconds: totalSeconds
        };
        sessions.unshift(entry);
        if (sessions.length > 2000) {
          sessions = sessions.slice(0, 2000);
        }
        timerState.sessionCounter += timerState.mode === "focus" ? 1 : 0;
        saveSessions();
        renderSessions();
        renderStatsAndChart();
      }

      function renderSessions() {
        var body = elements.sessionsBody;
        while (body.firstChild) {
          body.removeChild(body.firstChild);
        }
        if (!sessions.length) {
          var emptyRow = document.createElement("tr");
          var emptyCell = document.createElement("td");
          emptyCell.colSpan = 3;
          emptyCell.className = "session-empty";
          emptyCell.innerHTML = 'No sessions yet. Press <strong>Start</strong> to begin your first round.';
          emptyRow.appendChild(emptyCell);
          body.appendChild(emptyRow);
          return;
        }
        var maxRows = 18;
        sessions.slice(0, maxRows).forEach(function (sessionEntry) {
          var row = document.createElement("tr");

          var typeCell = document.createElement("td");
          var typeBadge = document.createElement("span");
          var isFocus = sessionEntry.type === "focus";
          typeBadge.className = "session-type " + (isFocus ? "session-type-focus" : "session-type-break");
          var dot = document.createElement("span");
          dot.className = "session-dot" + (isFocus ? "" : " session-dot-break");
          var label = document.createElement("span");
          label.textContent = isFocus ? "Focus" : (sessionEntry.mode === "long-break" ? "Long break" : "Short break");
          typeBadge.appendChild(dot);
          typeBadge.appendChild(label);
          typeCell.appendChild(typeBadge);

          var durationCell = document.createElement("td");
          var minutes = Math.round(sessionEntry.durationSeconds / 60);
          if (minutes < 1) {
            minutes = 1;
          }
          durationCell.textContent = minutes + " min";

          var whenCell = document.createElement("td");
          var ended = new Date(sessionEntry.endedAt);
          if (!isNaN(ended.getTime())) {
            var now = new Date();
            var isToday = ended.toDateString() === now.toDateString();
            if (isToday) {
              var hours = ended.getHours();
              var minutesPart = ended.getMinutes();
              var hourText = hours % 12 === 0 ? "12" : String(hours % 12);
              var minuteText = minutesPart < 10 ? "0" + minutesPart : String(minutesPart);
              var suffix = hours >= 12 ? "PM" : "AM";
              whenCell.textContent = hourText + ":" + minuteText + " " + suffix;
            } else {
              var month = ended.getMonth() + 1;
              var date = ended.getDate();
              whenCell.textContent = month + "/" + date;
            }
          } else {
            whenCell.textContent = "‚Äî";
          }

          row.appendChild(typeCell);
          row.appendChild(durationCell);
          row.appendChild(whenCell);
          body.appendChild(row);
        });
      }

      function renderStatsAndChart() {
        var now = new Date();
        var todayKey = dateKey(now);
        var todayFocusMinutes = 0;
        var todayRounds = 0;
        var totalFocusMinutes = 0;
        var totalSessionsCount = sessions.length;
        var dayFocusMap = {};

        sessions.forEach(function (entry) {
          if (entry.type !== "focus") {
            return;
          }
          var ended = new Date(entry.endedAt);
          if (isNaN(ended.getTime())) {
            return;
          }
          var key = dateKey(ended);
          var minutes = entry.durationSeconds / 60;
          if (!Number.isFinite(minutes) || minutes <= 0) {
            minutes = 1;
          }
          totalFocusMinutes += minutes;
          if (!dayFocusMap[key]) {
            dayFocusMap[key] = 0;
          }
          dayFocusMap[key] += minutes;
          if (key === todayKey) {
            todayFocusMinutes += minutes;
            todayRounds += 1;
          }
        });

        var streakData = computeStreak(dayFocusMap, now);

        elements.statMinutes.textContent = Math.round(todayFocusMinutes) + " min";
        elements.statRounds.textContent = todayRounds + (todayRounds === 1 ? " round" : " rounds");
        var streakDays = streakData.currentStreak;
        elements.statStreak.textContent = streakDays + (streakDays === 1 ? " day" : " days");
        elements.statLastDay.textContent = streakData.lastActive ? formatDisplayDate(streakData.lastActive) : "No sessions";
        var totalHours = totalFocusMinutes / 60;
        elements.statAllTime.textContent = totalHours.toFixed(1) + " h";
        elements.statAllSessions.textContent = totalSessionsCount + (totalSessionsCount === 1 ? " session" : " sessions");
        elements.streakSummary.textContent = "Today ¬∑ " + todayRounds + (todayRounds === 1 ? " round" : " rounds");

        renderChart(dayFocusMap, now);
      }

      function dateKey(date) {
        return date.getFullYear() + "-" + String(date.getMonth() + 1).padStart(2, "0") + "-" + String(date.getDate()).padStart(2, "0");
      }

      function formatDisplayDate(key) {
        if (!key) {
          return "";
        }
        var parts = key.split("-");
        if (parts.length !== 3) {
          return key;
        }
        var month = Number(parts[1]);
        var dateNumber = Number(parts[2]);
        return month + "/" + dateNumber;
      }

      function computeStreak(dayFocusMap, now) {
        var currentKey = dateKey(now);
        var hasToday = !!dayFocusMap[currentKey];
        var streak = 0;
        var indexOffset = 0;
        if (!hasToday) {
          indexOffset = 1;
        }
        for (var offset = indexOffset; offset < 365; offset++) {
          var date = new Date(now);
          date.setDate(date.getDate() - offset);
          var key = dateKey(date);
          if (dayFocusMap[key]) {
            streak += 1;
          } else {
            break;
          }
        }
        var lastActiveKey = null;
        var dayKeys = Object.keys(dayFocusMap);
        if (dayKeys.length) {
          dayKeys.sort();
          lastActiveKey = dayKeys[dayKeys.length - 1];
        }
        return {
          currentStreak: streak,
          lastActive: lastActiveKey
        };
      }

      function renderChart(dayFocusMap, now) {
        var container = elements.chartContainer;
        while (container.firstChild) {
          container.removeChild(container.firstChild);
        }
        var lastSeven = [];
        var maxMinutes = 0;
        for (var offset = 6; offset >= 0; offset--) {
          var date = new Date(now);
          date.setDate(date.getDate() - offset);
          var key = dateKey(date);
          var totalMinutes = dayFocusMap[key] || 0;
          var label = weekdayLabel(date);
          if (totalMinutes > maxMinutes) {
            maxMinutes = totalMinutes;
          }
          lastSeven.push({
            key: key,
            label: label,
            minutes: totalMinutes
          });
        }
        if (maxMinutes <= 0) {
          elements.chartEmpty.hidden = false;
          elements.chartHighlight.textContent = "0 min best day";
          return;
        }
        elements.chartEmpty.hidden = true;
        var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("viewBox", "0 0 100 100");
        svg.setAttribute("role", "img");
        svg.setAttribute("aria-label", "Focus minutes over the last week");
        var barWidth = 8;
        var gap = (100 - barWidth * lastSeven.length) / (lastSeven.length + 1);

        var gradientId = "chartGradient";
        var defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        var linearGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
        linearGradient.setAttribute("id", gradientId);
        linearGradient.setAttribute("x1", "0%");
        linearGradient.setAttribute("y1", "0%");
        linearGradient.setAttribute("x2", "0%");
        linearGradient.setAttribute("y2", "100%");
        var stopOne = document.createElementNS("http://www.w3.org/2000/svg", "stop");
        stopOne.setAttribute("offset", "0%");
        stopOne.setAttribute("stop-color", "#22d3ee");
        var stopTwo = document.createElementNS("http://www.w3.org/2000/svg", "stop");
        stopTwo.setAttribute("offset", "100%");
        stopTwo.setAttribute("stop-color", "#f97316");
        linearGradient.appendChild(stopOne);
        linearGradient.appendChild(stopTwo);
        defs.appendChild(linearGradient);
        svg.appendChild(defs);

        var bestMinutes = 0;
        var bestLabel = "";
        lastSeven.forEach(function (day, index) {
          var normalized = day.minutes / maxMinutes;
          var height = Math.max(3, normalized * 75);
          var x = gap + index * (barWidth + gap);
          var y = 90 - height;
          var bar = document.createElementNS("http://www.w3.org/2000/svg", "rect");
          bar.setAttribute("x", String(x.toFixed(2)));
          bar.setAttribute("y", String(y.toFixed(2)));
          bar.setAttribute("width", String(barWidth));
          bar.setAttribute("height", String(height.toFixed(2)));
          bar.setAttribute("rx", "2.5");
          bar.setAttribute("fill", "url(#" + gradientId + ")");
          bar.setAttribute("opacity", day.minutes > 0 ? "0.98" : "0.28");
          svg.appendChild(bar);

          var label = document.createElementNS("http://www.w3.org/2000/svg", "text");
          label.setAttribute("x", String(x + barWidth / 2));
          label.setAttribute("y", "96");
          label.setAttribute("text-anchor", "middle");
          label.setAttribute("fill", "currentColor");
          label.setAttribute("font-size", "5.2");
          label.setAttribute("opacity", "0.8");
          label.textContent = day.label;
          svg.appendChild(label);

          if (day.minutes >= bestMinutes) {
            bestMinutes = day.minutes;
            bestLabel = day.label;
          }
        });
        container.appendChild(svg);
        elements.chartHighlight.textContent = Math.round(bestMinutes) + " min best day (" + bestLabel + ")";
      }

      function weekdayLabel(date) {
        var labels = ["S", "M", "T", "W", "T", "F", "S"];
        return labels[date.getDay()];
      }

      function playBeep() {
        if (!window.AudioContext && !window.webkitAudioContext) {
          return;
        }
        var AudioContextConstructor = window.AudioContext || window.webkitAudioContext;
        var context = new AudioContextConstructor();
        var durationSeconds = 0.24;
        var oscillator = context.createOscillator();
        var gainNode = context.createGain();
        oscillator.type = "triangle";
        oscillator.frequency.value = 880;
        oscillator.connect(gainNode);
        gainNode.connect(context.destination);
        gainNode.gain.setValueAtTime(0.0, context.currentTime);
        gainNode.gain.linearRampToValueAtTime(0.4, context.currentTime + 0.02);
        gainNode.gain.exponentialRampToValueAtTime(0.001, context.currentTime + durationSeconds);
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + durationSeconds + 0.02);
      }

      function handleSettingsChange() {
        var focusMinutes = clampNumber(parseInt(elements.focusInput.value, 10), 5, 90, defaultSettings.focusMinutes);
        var shortBreakMinutes = clampNumber(parseInt(elements.shortBreakInput.value, 10), 1, 30, defaultSettings.shortBreakMinutes);
        var longBreakMinutes = clampNumber(parseInt(elements.longBreakInput.value, 10), 5, 45, defaultSettings.longBreakMinutes);
        var longBreakInterval = clampNumber(parseInt(elements.longIntervalInput.value, 10), 2, 8, defaultSettings.longBreakInterval);
        var updated = {
          focusMinutes: focusMinutes,
          shortBreakMinutes: shortBreakMinutes,
          longBreakMinutes: longBreakMinutes,
          longBreakInterval: longBreakInterval
        };
        saveSettings(updated);
        if (!timerState.isRunning) {
          applySettingsToState();
          renderTimer();
        }
      }

      function clampNumber(value, min, max, fallback) {
        if (!Number.isFinite(value)) {
          return fallback;
        }
        if (value < min) {
          return min;
        }
        if (value > max) {
          return max;
        }
        return value;
      }

      function resetSettings() {
        saveSettings(Object.assign({}, defaultSettings));
        applySettingsToInputs(settings);
        applySettingsToState();
        timerState.focusRoundsCompleted = 0;
        timerState.sessionCounter = 1;
        renderTimer();
        updateAutoStartToggleVisual();
      }

      function clearHistory() {
        if (!sessions.length) {
          return;
        }
        if (!window.confirm("Clear all saved sessions? This cannot be undone.")) {
          return;
        }
        sessions = [];
        saveSessions();
        renderSessions();
        renderStatsAndChart();
      }

      function attachEventListeners() {
        elements.startPauseButton.addEventListener("click", function () {
          if (timerState.isRunning) {
            pauseTimer();
          } else {
            startTimer();
          }
        });
        elements.resetButton.addEventListener("click", function () {
          resetTimer();
        });
        elements.skipButton.addEventListener("click", function () {
          var nextMode = determineNextMode(timerState.mode);
          switchMode(nextMode, false);
        });

        var inputs = [elements.focusInput, elements.shortBreakInput, elements.longBreakInput, elements.longIntervalInput];
        inputs.forEach(function (inputElement) {
          inputElement.addEventListener("change", handleSettingsChange);
          inputElement.addEventListener("blur", handleSettingsChange);
          inputElement.addEventListener("keyup", function (event) {
            if (event.key === "Enter") {
              handleSettingsChange();
            }
          });
        });

        elements.autoStartToggle.addEventListener("click", function () {
          var next = !settings.autoStartNext;
          saveSettings({ autoStartNext: next });
          updateAutoStartToggleVisual();
        });

        elements.themeToggle.addEventListener("click", function () {
          toggleTheme();
        });

        var tabs = document.querySelectorAll(".mode-tab");
        tabs.forEach(function (tab) {
          tab.addEventListener("click", function () {
            var mode = tab.getAttribute("data-mode");
            switchMode(mode, false);
          });
          tab.addEventListener("keydown", function (event) {
            if (event.key === " " || event.key === "Enter") {
              event.preventDefault();
              var mode = tab.getAttribute("data-mode");
              switchMode(mode, false);
            }
          });
        });

        elements.resetSettingsButton.addEventListener("click", function () {
          resetSettings();
        });

        elements.clearHistoryButton.addEventListener("click", function () {
          clearHistory();
        });

        document.addEventListener("keydown", function (event) {
          if (event.target && (event.target.tagName === "INPUT" || event.target.tagName === "TEXTAREA")) {
            return;
          }
          if (event.code === "Space") {
            event.preventDefault();
            if (timerState.isRunning) {
              pauseTimer();
            } else {
              startTimer();
            }
          }
          if (event.key === "r" || event.key === "R") {
            event.preventDefault();
            resetTimer();
          }
          if (event.key === "s" || event.key === "S") {
            event.preventDefault();
            var nextMode = determineNextMode(timerState.mode);
            switchMode(nextMode, false);
          }
        });
      }
    })();
  </script>
</body>
</html>

