<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Festival Lights Show</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #05010a;
        --panel: rgba(255, 255, 255, 0.08);
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Space Grotesk", system-ui;
        background: radial-gradient(circle at top, #1a0033, #05010a 70%);
        color: #fefefe;
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 2rem;
      }
      .app {
        width: min(1000px, 100%);
        background: rgba(255, 255, 255, 0.03);
        border-radius: 2rem;
        padding: 2rem;
        box-shadow: 0 40px 120px rgba(0, 0, 0, 0.5);
      }
      header {
        text-align: center;
        margin-bottom: 2rem;
      }
      .stage {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
      }
      .light {
        padding-top: 100%;
        border-radius: 1rem;
        position: relative;
        overflow: hidden;
        background: #222;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.6) inset;
        transition: transform 0.3s ease;
      }
      .light::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), transparent);
        mix-blend-mode: screen;
      }
      .controls {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }
      .panel {
        background: var(--panel);
        border-radius: 1rem;
        padding: 1rem;
      }
      label {
        display: block;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
      }
      select,
      input,
      button {
        width: 100%;
        border: none;
        border-radius: 0.75rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font: inherit;
      }
      button {
        cursor: pointer;
        background: linear-gradient(120deg, #ff00c3, #00d1ff);
      }
      .bars {
        margin-top: 1rem;
        display: flex;
        gap: 0.3rem;
        height: 60px;
      }
      .bar {
        flex: 1;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header>
        <h1>Festival Lights Show</h1>
        <p>Blend color waves, patterns, and beats in real time.</p>
      </header>
      <div class="stage" id="stage"></div>
      <div class="controls">
        <div class="panel">
          <label for="color">Color palette</label>
          <input type="color" id="color" value="#ff00c3" />
        </div>
        <div class="panel">
          <label for="pattern">Pattern</label>
          <select id="pattern">
            <option value="pulse">Pulse</option>
            <option value="wave">Wave</option>
            <option value="spark">Spark</option>
          </select>
        </div>
        <div class="panel">
          <label>Music sync</label>
          <button id="music">Play beat</button>
          <div class="bars" id="bars"></div>
        </div>
      </div>
    </div>

    <script>
      const stage = document.getElementById("stage");
      const colorInput = document.getElementById("color");
      const patternSelect = document.getElementById("pattern");
      const musicBtn = document.getElementById("music");
      const bars = document.getElementById("bars");
      const lights = [];
      for (let i = 0; i < 30; i++) {
        const light = document.createElement("div");
        light.className = "light";
        stage.appendChild(light);
        lights.push(light);
      }
      for (let i = 0; i < 12; i++) {
        const bar = document.createElement("div");
        bar.className = "bar";
        bars.appendChild(bar);
      }

      let tick = 0;
      function animate() {
        lights.forEach((light, index) => {
          const hue = colorInput.value;
          let intensity = 0;
          const mode = patternSelect.value;
          if (mode === "pulse") {
            intensity = (Math.sin(tick / 10 + index) + 1) / 2;
          } else if (mode === "wave") {
            intensity = (Math.sin((index % 6) + tick / 5) + 1) / 2;
          } else {
            intensity = Math.random();
          }
          light.style.background = `radial-gradient(circle, ${hexToRgba(hue, 0.9)} ${intensity * 80}%, rgba(0,0,0,0.5))`;
          light.style.transform = `scale(${0.9 + intensity * 0.3})`;
        });
        tick++;
        requestAnimationFrame(animate);
      }
      animate();

      function hexToRgba(hex, alpha) {
        const bigint = parseInt(hex.slice(1), 16);
        const r = (bigint >> 16) & 255;
        const g = (bigint >> 8) & 255;
        const b = bigint & 255;
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      }

      let ctxAudio;
      let analyser;
      let dataArray;
      let beatInterval;
      function initAudio() {
        ctxAudio = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = ctxAudio.createOscillator();
        const gain = ctxAudio.createGain();
        analyser = ctxAudio.createAnalyser();
        analyser.fftSize = 64;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        oscillator.type = "sawtooth";
        oscillator.frequency.setValueAtTime(120, ctxAudio.currentTime);
        oscillator.connect(gain);
        gain.connect(analyser);
        analyser.connect(ctxAudio.destination);
        oscillator.start();
        beatInterval = setInterval(() => {
          gain.gain.value = 0.0001;
          gain.gain.exponentialRampToValueAtTime(0.4, ctxAudio.currentTime + 0.05);
          gain.gain.exponentialRampToValueAtTime(0.0001, ctxAudio.currentTime + 0.1);
        }, 400);
      }

      let playing = false;
      musicBtn.addEventListener("click", () => {
        if (!playing) {
          initAudio();
          playing = true;
          musicBtn.textContent = "Stop beat";
          visualize();
        } else {
          if (ctxAudio) ctxAudio.close();
          clearInterval(beatInterval);
          playing = false;
          ctxAudio = null;
          analyser = null;
          dataArray = null;
          musicBtn.textContent = "Play beat";
          visualize();
        }
      });

      function visualize() {
        if (!playing || !analyser) {
          bars.querySelectorAll(".bar").forEach((bar) => (bar.style.height = "20px"));
          return;
        }
        analyser.getByteFrequencyData(dataArray);
        bars.querySelectorAll(".bar").forEach((bar, index) => {
          const value = dataArray[index] / 255;
          bar.style.height = `${value * 100}%`;
          bar.style.background = `linear-gradient(180deg, ${colorInput.value}, rgba(255,255,255,0))`;
        });
        requestAnimationFrame(visualize);
      }
    </script>
  </body>
</html>
