<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Typing Rain</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: dark;
        --bg: #020617;
        --bg-elevated: #020617;
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.18);
        --accent-strong: #0ea5e9;
        --accent-stronger: #0284c7;
        --success: #22c55e;
        --danger: #ef4444;
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
        --border-subtle: rgba(148, 163, 184, 0.35);
        --input-bg: rgba(15, 23, 42, 0.9);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        background:
          radial-gradient(circle at top, #1d3557 0, rgba(15, 23, 42, 0.9) 40%),
          radial-gradient(
            circle at bottom,
            rgba(8, 47, 73, 0.95) 0,
            #020617 55%
          );
        color: var(--text-main);
        display: flex;
        align-items: stretch;
        justify-content: center;
      }

      .app-shell {
        flex: 1 1 auto;
        max-width: 1040px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .app-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        padding: 8px 12px 6px;
      }

      .app-title {
        font-size: clamp(1.6rem, 2.4vw, 1.9rem);
        font-weight: 700;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        background: linear-gradient(
          120deg,
          #e5e7eb,
          #38bdf8,
          #a855f7,
          #f97316
        );
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .app-title-mark {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        background: radial-gradient(
          circle at 30% 0,
          #e0f2fe 0,
          #38bdf8 40%,
          #0f172a 100%
        );
        box-shadow:
          0 0 18px rgba(56, 189, 248, 0.85),
          0 0 42px rgba(59, 130, 246, 0.7);
      }

      .app-subtitle {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: var(--text-muted);
        opacity: 0.88;
      }

      .hud {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 14px;
        flex-wrap: wrap;
        font-size: 0.78rem;
      }

      .hud-group {
        display: flex;
        align-items: center;
        gap: 14px;
        flex-wrap: wrap;
      }

      .stat {
        min-width: 72px;
        padding: 6px 9px;
        border-radius: 999px;
        border: 1px solid rgba(30, 64, 175, 0.65);
        background: radial-gradient(
            circle at top,
            rgba(37, 99, 235, 0.42),
            transparent 58%
          ),
          radial-gradient(
            circle at bottom,
            rgba(15, 23, 42, 0.95),
            rgba(15, 23, 42, 0.98)
          );
        box-shadow: 0 8px 18px rgba(15, 23, 42, 0.9);
        display: inline-flex;
        flex-direction: column;
        gap: 1px;
      }

      .stat-label {
        font-size: 0.63rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--text-muted);
      }

      .stat-value {
        font-size: 0.86rem;
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      .stat-value.accent {
        color: var(--accent);
      }

      .stat-value.good {
        color: var(--success);
      }

      .stat-value.bad {
        color: var(--danger);
      }

      .game-shell {
        position: relative;
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 10px 10px 12px;
        border-radius: 20px;
        background:
          radial-gradient(
            circle at top,
            rgba(30, 64, 175, 0.75),
            transparent 50%
          ),
          linear-gradient(to bottom, rgba(15, 23, 42, 0.98), #020617);
        box-shadow:
          0 18px 45px rgba(15, 23, 42, 0.98),
          0 0 42px rgba(56, 189, 248, 0.25) inset;
        border: 1px solid rgba(30, 64, 175, 0.85);
        overflow: hidden;
      }

      .game-screen {
        position: relative;
        flex: 1 1 auto;
        min-height: 360px;
        border-radius: 16px;
        background:
          radial-gradient(circle at top, rgba(15, 118, 110, 0.35), transparent),
          radial-gradient(circle at 20% 90%, rgba(30, 64, 175, 0.5), transparent),
          linear-gradient(to bottom, #020617, #020617);
        overflow: hidden;
        isolation: isolate;
      }

      .sky-glow {
        position: absolute;
        inset: 0;
        background:
          radial-gradient(
            circle at 25% top,
            rgba(52, 211, 153, 0.4),
            transparent 50%
          ),
          radial-gradient(
            circle at right top,
            rgba(59, 130, 246, 0.6),
            transparent 55%
          );
        mix-blend-mode: screen;
        opacity: 0.45;
        pointer-events: none;
      }

      .city-horizon {
        position: absolute;
        inset: 0;
        overflow: hidden;
        z-index: 0;
      }

      .city-layer {
        position: absolute;
        left: -4%;
        right: -4%;
        bottom: 0;
        height: 56%;
        pointer-events: none;
      }

      .city-layer.back {
        filter: blur(1.2px) saturate(0.85);
        opacity: 0.68;
        transform: scaleX(1.03);
      }

      .city-layer.front {
        opacity: 0.96;
      }

      .city-layer .building {
        position: absolute;
        bottom: 0;
        background: linear-gradient(
          to top,
          rgba(15, 23, 42, 0.98),
          rgba(15, 23, 42, 0.9) 35%,
          rgba(30, 64, 175, 0.95) 80%,
          rgba(30, 64, 175, 0.6)
        );
        border-radius: 4px 4px 0 0;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 -4px 12px rgba(59, 130, 246, 0.3) inset;
        overflow: hidden;
      }

      .city-layer.back .building {
        background: linear-gradient(
          to top,
          rgba(15, 23, 42, 0.98),
          rgba(15, 23, 42, 0.9) 30%,
          rgba(17, 24, 39, 0.9)
        );
      }

      .city-layer .building::before {
        content: "";
        position: absolute;
        inset: 8px 6px;
        background-image: radial-gradient(
          circle at 2px 2px,
          rgba(252, 211, 77, 0.95) 0,
          rgba(252, 211, 77, 0.95) 1px,
          transparent 1px
        );
        background-size: 16px 20px;
        opacity: 0.65;
        mix-blend-mode: screen;
      }

      .city-layer.front .building::before {
        animation: windowsGlow 3s ease-in-out infinite alternate;
      }

      @keyframes windowsGlow {
        from {
          opacity: 0.35;
        }
        to {
          opacity: 0.95;
        }
      }

      .play-area {
        position: absolute;
        inset: 0;
        padding: 16px 14px 48px;
        overflow: hidden;
        z-index: 2;
      }

      .play-area::before {
        content: "";
        position: absolute;
        inset: -40px;
        background-image: linear-gradient(
          115deg,
          rgba(148, 163, 184, 0.0) 0,
          rgba(148, 163, 184, 0.15) 10%,
          rgba(148, 163, 184, 0.6) 35%,
          rgba(148, 163, 184, 0.2) 60%,
          transparent 80%
        );
        background-size: 14px 52px;
        opacity: 0.32;
        animation: rainStreaks 800ms linear infinite;
        pointer-events: none;
      }

      @keyframes rainStreaks {
        to {
          background-position: -36px 36px;
        }
      }

      .ground-line {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 30px;
        height: 3px;
        background: linear-gradient(
          90deg,
          rgba(15, 23, 42, 0.9),
          rgba(56, 189, 248, 0.85),
          rgba(59, 130, 246, 0.9),
          rgba(15, 23, 42, 0.95)
        );
        box-shadow:
          0 0 14px rgba(56, 189, 248, 0.9),
          0 0 40px rgba(30, 64, 175, 0.9);
      }

      .raindrop {
        position: absolute;
        padding: 6px 10px;
        border-radius: 999px;
        background:
          radial-gradient(
            circle at 30% 0,
            rgba(248, 250, 252, 0.98),
            rgba(148, 163, 184, 0.9)
          );
        color: #020617;
        font-weight: 600;
        font-size: 0.9rem;
        letter-spacing: 0.03em;
        white-space: nowrap;
        box-shadow:
          0 6px 18px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(148, 163, 184, 0.9);
        transform: translate3d(0, 0, 0);
        transform-origin: center;
        will-change: transform;
        pointer-events: none;
      }

      .raindrop::after {
        content: "";
        position: absolute;
        left: 50%;
        top: 100%;
        width: 2px;
        height: 16px;
        transform: translateX(-50%);
        background: linear-gradient(
          to bottom,
          rgba(148, 163, 184, 0.95),
          transparent
        );
        opacity: 0.9;
      }

      .raindrop.target {
        outline: 2px solid rgba(56, 189, 248, 0.9);
        box-shadow:
          0 0 0 1px rgba(56, 189, 248, 0.85),
          0 0 0 6px rgba(56, 189, 248, 0.35),
          0 12px 26px rgba(37, 99, 235, 0.95);
      }

      .raindrop.hit {
        animation: raindropPop 190ms ease-out forwards;
      }

      @keyframes raindropPop {
        to {
          transform: translate3d(0, -12px, 0) scale(1.22);
          opacity: 0;
        }
      }

      .splash {
        position: absolute;
        width: 42px;
        height: 14px;
        border-radius: 999px;
        border: 2px solid rgba(56, 189, 248, 0.9);
        border-top: none;
        opacity: 0.85;
        transform-origin: center bottom;
        pointer-events: none;
        box-shadow: 0 0 16px rgba(56, 189, 248, 0.7);
        animation: splash 260ms ease-out forwards;
      }

      @keyframes splash {
        from {
          transform: scaleX(0.35) translateY(0);
          opacity: 0.9;
        }
        to {
          transform: scaleX(1.4) translateY(8px);
          opacity: 0;
        }
      }

      .bottom-panel {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 4px;
      }

      .primary-button {
        padding: 9px 16px;
        border-radius: 999px;
        border: 1px solid rgba(52, 211, 153, 0.6);
        background:
          radial-gradient(circle at top, rgba(52, 211, 153, 0.8), transparent 55%),
          radial-gradient(circle at bottom, rgba(5, 150, 105, 0.9), #052e16);
        color: #ecfdf5;
        font-size: 0.86rem;
        font-weight: 600;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow:
          0 14px 38px rgba(5, 46, 22, 0.9),
          0 0 0 1px rgba(34, 197, 94, 0.8);
        transition:
          transform 140ms ease-out,
          box-shadow 140ms ease-out,
          background 160ms ease-out,
          opacity 120ms;
        white-space: nowrap;
      }

      .primary-button:hover {
        transform: translateY(-1px);
        box-shadow:
          0 18px 44px rgba(5, 46, 22, 0.95),
          0 0 0 1px rgba(134, 239, 172, 0.9);
      }

      .primary-button:active {
        transform: translateY(0);
        box-shadow:
          0 6px 18px rgba(5, 46, 22, 0.95),
          0 0 0 1px rgba(22, 163, 74, 0.9);
      }

      .primary-button:disabled {
        opacity: 0.7;
        cursor: default;
        box-shadow:
          0 8px 18px rgba(15, 23, 42, 0.8),
          0 0 0 1px rgba(51, 65, 85, 0.9);
      }

      .input-region {
        flex: 1 1 auto;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 0;
      }

      .input-wrapper {
        position: relative;
        flex: 1 1 auto;
        min-width: 0;
        border-radius: 999px;
        border: 1px solid rgba(15, 23, 42, 0.95);
        background: radial-gradient(
            circle at top left,
            rgba(56, 189, 248, 0.26),
            transparent 55%
          ),
          radial-gradient(
            circle at bottom,
            rgba(15, 23, 42, 1),
            rgba(15, 23, 42, 0.98)
          );
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 16px 35px rgba(15, 23, 42, 0.95) inset;
        padding: 6px 12px 6px 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .input-wrapper::before {
        content: "›";
        font-size: 0.9rem;
        color: rgba(148, 163, 184, 0.95);
        opacity: 0.8;
      }

      .input-hint {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--text-muted);
        margin-left: 2px;
        display: none;
      }

      .input-field {
        border: none;
        outline: none;
        flex: 1 1 auto;
        min-width: 0;
        background: transparent;
        color: var(--text-main);
        font-size: 0.95rem;
        padding: 2px 0;
      }

      .input-field::placeholder {
        color: rgba(148, 163, 184, 0.8);
      }

      .input-wrapper.error {
        animation: shake 220ms ease-out;
        box-shadow:
          0 0 0 1px rgba(127, 29, 29, 0.95),
          0 0 22px rgba(239, 68, 68, 0.9);
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        20%,
        60% {
          transform: translateX(-3px);
        }
        40%,
        80% {
          transform: translateX(3px);
        }
      }

      .intensity-wrapper {
        width: 150px;
        display: flex;
        flex-direction: column;
        gap: 4px;
        font-size: 0.7rem;
      }

      .intensity-label {
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: var(--text-muted);
      }

      .intensity-bar {
        position: relative;
        height: 7px;
        border-radius: 999px;
        background: radial-gradient(
          circle at 0 0,
          rgba(15, 23, 42, 0.95),
          rgba(15, 23, 42, 1)
        );
        overflow: hidden;
        border: 1px solid rgba(15, 23, 42, 0.95);
        box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.95);
      }

      .intensity-fill {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 0%;
        border-radius: inherit;
        background: linear-gradient(
          90deg,
          #22c55e,
          #38bdf8,
          #f97316,
          #ef4444
        );
        box-shadow: 0 0 18px rgba(56, 189, 248, 0.8);
        transition: width 220ms ease-out;
      }

      .overlay {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(
            circle at top,
            rgba(15, 23, 42, 0.86),
            rgba(15, 23, 42, 0.97)
          ),
          rgba(15, 23, 42, 0.96);
        opacity: 0;
        pointer-events: none;
        transition: opacity 200ms ease-out;
        z-index: 40;
      }

      .overlay.is-visible {
        opacity: 1;
        pointer-events: auto;
      }

      .overlay-dialog {
        max-width: 360px;
        width: min(360px, calc(100% - 40px));
        border-radius: 18px;
        border: 1px solid rgba(30, 64, 175, 0.9);
        background:
          radial-gradient(
            circle at top left,
            rgba(56, 189, 248, 0.42),
            transparent 60%
          ),
          linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.98),
            rgba(15, 23, 42, 0.98)
          );
        box-shadow:
          0 22px 55px rgba(15, 23, 42, 0.98),
          0 0 40px rgba(37, 99, 235, 0.7);
        padding: 18px 18px 16px;
      }

      .overlay-title {
        margin: 0 0 6px;
        font-size: 1.25rem;
        letter-spacing: 0.06em;
        text-transform: uppercase;
      }

      .overlay-body {
        font-size: 0.88rem;
        color: var(--text-muted);
        margin-bottom: 12px;
      }

      .overlay-stats {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
        margin-bottom: 12px;
      }

      .overlay-stat {
        padding: 8px 9px;
        border-radius: 10px;
        border: 1px solid var(--border-subtle);
        background: radial-gradient(
            circle at top,
            rgba(30, 64, 175, 0.7),
            transparent 70%
          ),
          radial-gradient(
            circle at bottom,
            rgba(15, 23, 42, 1),
            rgba(15, 23, 42, 0.98)
          );
      }

      .overlay-stat-label {
        font-size: 0.68rem;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: var(--text-muted);
      }

      .overlay-stat-value {
        font-size: 0.98rem;
        font-weight: 600;
      }

      .overlay-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      .secondary-note {
        font-size: 0.68rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.14em;
      }

      .secondary-note strong {
        color: var(--accent);
      }

      .secondary-button {
        padding: 7px 12px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: radial-gradient(
            circle at top,
            rgba(30, 64, 175, 0.8),
            transparent 60%
          ),
          rgba(15, 23, 42, 1);
        color: var(--text-main);
        font-size: 0.8rem;
        font-weight: 500;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow:
          0 10px 26px rgba(15, 23, 42, 0.95),
          0 0 0 1px rgba(15, 23, 42, 0.95);
        transition:
          transform 140ms ease-out,
          box-shadow 140ms ease-out,
          background 160ms ease-out;
      }

      .secondary-button:hover {
        transform: translateY(-1px);
        box-shadow:
          0 14px 32px rgba(15, 23, 42, 0.98),
          0 0 0 1px rgba(148, 163, 184, 0.9);
      }

      .secondary-button:active {
        transform: translateY(0);
        box-shadow:
          0 6px 18px rgba(15, 23, 42, 0.98),
          0 0 0 1px rgba(71, 85, 105, 0.95);
      }

      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }

      @media (max-width: 900px) {
        .hud {
          justify-content: flex-start;
        }
      }

      @media (max-width: 780px) {
        .app-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .hud {
          justify-content: flex-start;
        }
      }

      @media (max-width: 720px) {
        .bottom-panel {
          flex-direction: column;
          align-items: stretch;
        }

        .intensity-wrapper {
          width: 100%;
        }

        .input-hint {
          display: inline-block;
        }

        .primary-button {
          width: 100%;
          justify-content: center;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div>
          <div class="app-title">
            <span class="app-title-mark" aria-hidden="true"></span>
            <span>Typing Rain</span>
          </div>
          <div class="app-subtitle">
            Catch every word before it hits the city line.
          </div>
        </div>
        <div class="hud" aria-label="Game statistics">
          <div class="hud-group">
            <div class="stat">
              <span class="stat-label">Score</span>
              <span id="stat-score" class="stat-value accent">0</span>
            </div>
            <div class="stat">
              <span class="stat-label">Accuracy</span>
              <span id="stat-accuracy" class="stat-value good">100%</span>
            </div>
          </div>
          <div class="hud-group">
            <div class="stat">
              <span class="stat-label">Level</span>
              <span id="stat-level" class="stat-value">1</span>
            </div>
            <div class="stat">
              <span class="stat-label">Lives</span>
              <span id="stat-lives" class="stat-value">5</span>
            </div>
          </div>
        </div>
      </header>

      <main class="game-shell" aria-label="Typing Rain game">
        <section class="game-screen" aria-live="polite">
          <div class="sky-glow" aria-hidden="true"></div>

          <div class="city-horizon" aria-hidden="true">
            <div id="city-back" class="city-layer back"></div>
            <div id="city-front" class="city-layer front"></div>
          </div>

          <div id="play-area" class="play-area" aria-hidden="true">
            <div class="ground-line"></div>
          </div>
        </section>

        <section class="bottom-panel" aria-label="Typing controls and intensity">
          <button
            id="start-btn"
            type="button"
            class="primary-button"
            aria-pressed="false"
          >
            Start Game
          </button>

          <div class="input-region">
            <label class="visually-hidden" for="typing-input">
              Type falling words
            </label>
            <div class="input-wrapper" id="input-wrapper">
              <input
                id="typing-input"
                class="input-field"
                type="text"
                spellcheck="false"
                autocomplete="off"
                autocapitalize="off"
                autocorrect="off"
                placeholder="Type a word and hit space or Enter to send a raindrop back to the clouds."
                disabled
              />
            </div>
          </div>

          <div class="intensity-wrapper" aria-hidden="true">
            <div class="intensity-label">Rain intensity</div>
            <div class="intensity-bar">
              <div id="intensity-fill" class="intensity-fill"></div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div
      id="overlay"
      class="overlay"
      role="dialog"
      aria-modal="true"
      aria-labelledby="overlay-title"
      aria-describedby="overlay-body"
    >
      <div class="overlay-dialog">
        <h2 id="overlay-title" class="overlay-title">Storm Complete</h2>
        <p id="overlay-body" class="overlay-body">
          The clouds have cleared for now. Here’s how you handled the storm.
        </p>
        <div class="overlay-stats">
          <div class="overlay-stat">
            <div class="overlay-stat-label">Final Score</div>
            <div id="overlay-score" class="overlay-stat-value">0</div>
          </div>
          <div class="overlay-stat">
            <div class="overlay-stat-label">Best Level</div>
            <div id="overlay-level" class="overlay-stat-value">1</div>
          </div>
          <div class="overlay-stat">
            <div class="overlay-stat-label">Accuracy</div>
            <div id="overlay-accuracy" class="overlay-stat-value">100%</div>
          </div>
          <div class="overlay-stat">
            <div class="overlay-stat-label">Words Saved</div>
            <div id="overlay-words" class="overlay-stat-value">0</div>
          </div>
        </div>
        <div class="overlay-actions">
          <span class="secondary-note">
            <strong>Tip</strong>: Focus closest to the ground.
          </span>
          <button id="restart-btn" type="button" class="secondary-button">
            Play again
          </button>
        </div>
      </div>
    </div>

    <script>
      (function () {
        "use strict";

        const WORDS = [
          "rain",
          "city",
          "storm",
          "neon",
          "typing",
          "cloud",
          "light",
          "shadow",
          "skyscraper",
          "thunder",
          "velocity",
          "keyboard",
          "signal",
          "electric",
          "plasma",
          "midnight",
          "tempo",
          "arcade",
          "reflex",
          "horizon",
          "cascade",
          "network",
          "packet",
          "syntax",
          "promise",
          "rocket",
          "pixel",
          "vector",
          "gravity",
          "echo",
          "cipher",
          "magnet",
          "quantum",
          "galaxy",
          "glimmer",
          "breeze",
          "monsoon",
          "drizzle",
          "torrent",
          "umbrella",
          "lantern",
          "window",
          "signal",
          "uplink",
          "current",
          "dynamic",
          "agile",
          "reactive",
          "spark",
          "fusion",
          "cobalt",
          "azure",
          "river",
          "harbor",
          "subway",
          "engine",
          "plaza",
          "parallel",
          "density",
          "momentum",
          "spectrum",
          "origin",
          "switch",
          "funnel",
          "cyclone",
          "carrier",
          "vertex",
          "matrix",
          "ocean",
          "signal",
          "tunnel",
          "luminous",
          "hologram",
          "pattern",
          "cascade",
          "aurora",
          "satellite",
          "serenity",
          "velocity",
          "battery",
          "charged",
          "feedback",
          "iterate",
          "optimize",
          "compile",
          "execute",
          "function",
          "variable",
          "constant",
          "upgrade",
          "focus",
          "precision",
          "rhythm"
        ];

        const MAX_LIVES = 5;

        const state = {
          activeDrops: [],
          score: 0,
          lives: MAX_LIVES,
          totalTypedChars: 0,
          correctTypedChars: 0,
          wordsCleared: 0,
          misses: 0,
          level: 1,
          maxLevelReached: 1,
          intensity: 0,
          gameRunning: false,
          lastFrameTime: 0,
          lastSpawnTime: 0,
          spawnInterval: 1500,
          baseSpeed: 80,
          playAreaHeight: 0
        };

        let playAreaEl;
        let startBtnEl;
        let restartBtnEl;
        let inputEl;
        let inputWrapperEl;
        let overlayEl;
        let overlayScoreEl;
        let overlayLevelEl;
        let overlayAccuracyEl;
        let overlayWordsEl;
        let statScoreEl;
        let statAccuracyEl;
        let statLevelEl;
        let statLivesEl;
        let intensityFillEl;

        function init() {
          playAreaEl = document.getElementById("play-area");
          startBtnEl = document.getElementById("start-btn");
          restartBtnEl = document.getElementById("restart-btn");
          inputEl = document.getElementById("typing-input");
          inputWrapperEl = document.getElementById("input-wrapper");
          overlayEl = document.getElementById("overlay");
          overlayScoreEl = document.getElementById("overlay-score");
          overlayLevelEl = document.getElementById("overlay-level");
          overlayAccuracyEl = document.getElementById("overlay-accuracy");
          overlayWordsEl = document.getElementById("overlay-words");
          statScoreEl = document.getElementById("stat-score");
          statAccuracyEl = document.getElementById("stat-accuracy");
          statLevelEl = document.getElementById("stat-level");
          statLivesEl = document.getElementById("stat-lives");
          intensityFillEl = document.getElementById("intensity-fill");

          measurePlayArea();
          generateCityLayer(
            document.getElementById("city-back"),
            16,
            0.32,
            0.66
          );
          generateCityLayer(
            document.getElementById("city-front"),
            20,
            0.5,
            0.95
          );

          attachEvents();
          updateStats();
          updateIntensityVisual();
        }

        function measurePlayArea() {
          if (!playAreaEl) return;
          const rect = playAreaEl.getBoundingClientRect();
          state.playAreaHeight = rect.height || playAreaEl.offsetHeight || 0;
        }

        function generateCityLayer(container, count, minHeight, maxHeight) {
          if (!container) return;
          const width = container.clientWidth || window.innerWidth || 800;
          const baseWidth = width / count;
          for (let i = 0; i < count; i++) {
            const building = document.createElement("div");
            building.className = "building";
            const heightFactor =
              minHeight + Math.random() * (maxHeight - minHeight);
            const w =
              baseWidth * (0.7 + Math.random() * 0.6) +
              (i % 3 === 0 ? 8 : 0);
            const left = i * baseWidth + Math.random() * 6 - 3;
            building.style.width = Math.max(28, Math.round(w)) + "px";
            building.style.left = Math.round(left) + "px";
            building.style.height = Math.round(heightFactor * 100) + "%";
            container.appendChild(building);
          }
        }

        function attachEvents() {
          window.addEventListener("resize", function () {
            measurePlayArea();
          });

          startBtnEl.addEventListener("click", function () {
            if (!state.gameRunning) {
              resetGame();
              startGame();
            } else {
              resetGame();
              startGame();
            }
          });

          restartBtnEl.addEventListener("click", function () {
            hideOverlay();
            resetGame();
            startGame();
          });

          inputEl.addEventListener("keydown", function (event) {
            const key = event.key;
            if (key === "Enter" || key === " ") {
              event.preventDefault();
              submitCurrentInput();
            }
          });

          inputEl.addEventListener("input", function () {
            handleInputPreview();
          });

          document.addEventListener("click", function () {
            if (state.gameRunning && document.activeElement !== inputEl) {
              inputEl.focus();
            }
          });

          window.addEventListener("blur", function () {
            if (state.gameRunning) {
              state.gameRunning = false;
            }
          });

          window.addEventListener("focus", function () {
            if (!overlayEl.classList.contains("is-visible") && !state.gameRunning && state.lives > 0) {
              state.gameRunning = true;
              state.lastFrameTime = performance.now();
              requestAnimationFrame(gameLoop);
              if (document.activeElement !== inputEl) {
                inputEl.focus();
              }
            }
          });
        }

        function resetGame() {
          state.activeDrops.forEach(function (drop) {
            if (drop.element && drop.element.parentNode) {
              drop.element.parentNode.removeChild(drop.element);
            }
          });
          state.activeDrops.length = 0;
          state.score = 0;
          state.lives = MAX_LIVES;
          state.totalTypedChars = 0;
          state.correctTypedChars = 0;
          state.wordsCleared = 0;
          state.misses = 0;
          state.level = 1;
          state.maxLevelReached = 1;
          state.intensity = 0;
          state.gameRunning = false;
          state.spawnInterval = 1500;
          state.baseSpeed = 80;
          state.lastFrameTime = performance.now();
          state.lastSpawnTime = state.lastFrameTime;
          inputEl.value = "";
          clearTargetHighlights();
          updateStats();
          updateIntensityVisual();
        }

        function startGame() {
          state.gameRunning = true;
          startBtnEl.textContent = "Restart";
          startBtnEl.setAttribute("aria-pressed", "true");
          inputEl.disabled = false;
          inputEl.focus();
          measurePlayArea();
          state.lastFrameTime = performance.now();
          state.lastSpawnTime = state.lastFrameTime;
          requestAnimationFrame(gameLoop);
        }

        function gameLoop(timestamp) {
          if (!state.gameRunning) {
            return;
          }

          if (!state.lastFrameTime) {
            state.lastFrameTime = timestamp;
          }

          const deltaMs = timestamp - state.lastFrameTime;
          const dt = deltaMs / 1000;
          state.lastFrameTime = timestamp;

          moveDrops(dt);
          maybeSpawnDrop(timestamp);

          requestAnimationFrame(gameLoop);
        }

        function moveDrops(dt) {
          if (!playAreaEl) return;
          if (!state.playAreaHeight) {
            measurePlayArea();
          }
          const groundY = Math.max(state.playAreaHeight - 72, 40);
          for (let i = state.activeDrops.length - 1; i >= 0; i -= 1) {
            const drop = state.activeDrops[i];
            drop.y += drop.speed * dt;
            if (drop.y >= groundY) {
              handleMiss(i);
            } else if (drop.element) {
              drop.element.style.transform =
                "translate3d(" + drop.x + "px, " + drop.y + "px, 0)";
            }
          }
        }

        function maybeSpawnDrop(now) {
          if (!state.gameRunning) return;
          if (now - state.lastSpawnTime < state.spawnInterval) {
            return;
          }

          state.lastSpawnTime = now;
          spawnDrop();

          if (state.level >= 4 && Math.random() < 0.3) {
            spawnDrop();
          }
        }

        function spawnDrop() {
          if (!playAreaEl) return;
          const width = playAreaEl.clientWidth || 600;
          const word =
            WORDS[Math.floor(Math.random() * WORDS.length)] || "cloud";
          const element = document.createElement("div");
          element.className = "raindrop";
          element.textContent = word;
          playAreaEl.appendChild(element);

          const approxWidth = Math.max(60, element.offsetWidth || 60);
          const minX = 8;
          const maxX = Math.max(minX, width - approxWidth - 8);
          const x = minX + Math.random() * (maxX - minX);

          const base = state.baseSpeed;
          const variance = 40 + state.level * 6;
          const speed = base + Math.random() * variance;
          const yStart = -40 - Math.random() * 40;

          element.style.transform =
            "translate3d(" + x + "px, " + yStart + "px, 0)";

          state.activeDrops.push({
            word: word,
            x: x,
            y: yStart,
            speed: speed,
            element: element
          });
        }

        function submitCurrentInput() {
          const raw = inputEl.value;
          const value = raw.trim().toLowerCase();
          if (!value) return;

          state.totalTypedChars += value.length;

          let matchedIndex = -1;
          let candidateY = -Infinity;

          for (let i = 0; i < state.activeDrops.length; i += 1) {
            const drop = state.activeDrops[i];
            if (drop.word.toLowerCase() === value && drop.y > candidateY) {
              matchedIndex = i;
              candidateY = drop.y;
            }
          }

          if (matchedIndex >= 0) {
            const drop = state.activeDrops[matchedIndex];
            if (drop && drop.element) {
              drop.element.classList.add("hit");
            }
            state.correctTypedChars += drop.word.length;
            state.wordsCleared += 1;
            const levelBonus = 2 + Math.floor(state.level / 2);
            state.score += 10 + drop.word.length * levelBonus;
            if (drop && drop.element) {
              const element = drop.element;
              setTimeout(function () {
                if (element.parentNode) {
                  element.parentNode.removeChild(element);
                }
              }, 190);
            }
            state.activeDrops.splice(matchedIndex, 1);
            clearTargetHighlights();
            recalculateLevel();
          } else {
            state.score = Math.max(0, state.score - 5);
            flashInputError();
          }

          updateStats();
          inputEl.value = "";
        }

        function handleInputPreview() {
          const value = inputEl.value.trim().toLowerCase();
          clearTargetHighlights();
          if (!value) return;

          let target = null;
          let candidateY = -Infinity;

          for (let i = 0; i < state.activeDrops.length; i += 1) {
            const drop = state.activeDrops[i];
            if (drop.word.toLowerCase().indexOf(value) === 0) {
              if (drop.y > candidateY) {
                candidateY = drop.y;
                target = drop;
              }
            }
          }

          if (target && target.element) {
            target.element.classList.add("target");
          }
        }

        function clearTargetHighlights() {
          for (let i = 0; i < state.activeDrops.length; i += 1) {
            const drop = state.activeDrops[i];
            if (drop.element) {
              drop.element.classList.remove("target");
            }
          }
        }

        function flashInputError() {
          if (!inputWrapperEl) return;
          inputWrapperEl.classList.remove("error");
          void inputWrapperEl.offsetWidth;
          inputWrapperEl.classList.add("error");
          setTimeout(function () {
            inputWrapperEl.classList.remove("error");
          }, 220);
        }

        function handleMiss(index) {
          const drop = state.activeDrops[index];
          if (drop && drop.element && drop.element.parentNode) {
            createSplash(drop.x, state.playAreaHeight - 40);
            drop.element.parentNode.removeChild(drop.element);
          }
          state.activeDrops.splice(index, 1);
          state.misses += 1;
          state.lives = Math.max(0, MAX_LIVES - state.misses);
          state.score = Math.max(0, state.score - 15);
          updateStats();
          if (state.lives <= 0) {
            triggerGameOver();
          }
        }

        function createSplash(x, baselineY) {
          if (!playAreaEl) return;
          const splash = document.createElement("div");
          splash.className = "splash";
          const y = Math.max(baselineY, 20);
          splash.style.transform =
            "translate3d(" + x + "px, " + y + "px, 0)";
          playAreaEl.appendChild(splash);
          setTimeout(function () {
            if (splash.parentNode) {
              splash.parentNode.removeChild(splash);
            }
          }, 320);
        }

        function recalculateLevel() {
          const newLevel = 1 + Math.floor(state.wordsCleared / 10);
          if (newLevel !== state.level) {
            state.level = newLevel;
          }
          if (state.level > state.maxLevelReached) {
            state.maxLevelReached = state.level;
          }
          const normalized = Math.min((state.level - 1) / 12, 1);
          state.intensity = normalized;
          state.spawnInterval = 1500 - normalized * 900;
          state.baseSpeed = 80 + normalized * 120;
          updateIntensityVisual();
        }

        function updateIntensityVisual() {
          if (!intensityFillEl) return;
          const baseWidth = 8;
          const maxExtra = 92;
          const width = baseWidth + maxExtra * state.intensity;
          intensityFillEl.style.width = Math.min(100, width) + "%";
        }

        function updateStats() {
          if (statScoreEl) {
            statScoreEl.textContent = state.score.toString();
          }
          const accuracy =
            state.totalTypedChars === 0
              ? 100
              : Math.round(
                  (state.correctTypedChars / state.totalTypedChars) * 100
                );
          if (statAccuracyEl) {
            statAccuracyEl.textContent = accuracy.toString() + "%";
            statAccuracyEl.classList.remove("good", "bad");
            if (accuracy >= 92) {
              statAccuracyEl.classList.add("good");
            } else if (accuracy <= 70) {
              statAccuracyEl.classList.add("bad");
            }
          }
          if (statLevelEl) {
            statLevelEl.textContent = state.level.toString();
          }
          if (statLivesEl) {
            statLivesEl.textContent = state.lives.toString();
          }
        }

        function triggerGameOver() {
          state.gameRunning = false;
          startBtnEl.setAttribute("aria-pressed", "false");
          inputEl.blur();

          const accuracy =
            state.totalTypedChars === 0
              ? 100
              : Math.round(
                  (state.correctTypedChars / state.totalTypedChars) * 100
                );

          overlayScoreEl.textContent = state.score.toString();
          overlayLevelEl.textContent = state.maxLevelReached.toString();
          overlayAccuracyEl.textContent = accuracy.toString() + "%";
          overlayWordsEl.textContent = state.wordsCleared.toString();

          showOverlay();
        }

        function showOverlay() {
          overlayEl.classList.add("is-visible");
        }

        function hideOverlay() {
          overlayEl.classList.remove("is-visible");
        }

        document.addEventListener("DOMContentLoaded", init);
      })();
    </script>
  </body>
  </html>

