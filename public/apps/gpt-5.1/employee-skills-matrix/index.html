<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Employee Skills Matrix</title>
    <style>
      :root {
        --bg: #f4f5fb;
        --bg-elevated: #ffffff;
        --bg-soft: #eef0ff;
        --accent: #4f46e5;
        --accent-soft: rgba(79, 70, 229, 0.08);
        --accent-strong: #3730a3;
        --text-main: #111827;
        --text-soft: #6b7280;
        --border-subtle: #e5e7eb;
        --danger: #ef4444;
        --warning: #f59e0b;
        --success: #22c55e;
        --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.18);
        --radius-lg: 18px;
        --radius-md: 12px;
        --radius-sm: 9px;
        --transition-fast: 0.18s ease-out;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: var(--text-main);
      }

      body {
        background: radial-gradient(circle at top left, #e0e7ff 0, #f4f5fb 45%, #f9fafb 100%);
      }

      .app-shell {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .app-header {
        padding: 20px 24px 10px;
      }

      .app-header-inner {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
      }

      .app-title-block h1 {
        margin: 0;
        font-size: 1.6rem;
        letter-spacing: 0.02em;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .badge-pill {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        background: rgba(16, 185, 129, 0.12);
        color: #047857;
        padding: 3px 9px;
        border-radius: 999px;
        border: 1px solid rgba(16, 185, 129, 0.22);
      }

      .app-title-sub {
        margin-top: 4px;
        font-size: 0.9rem;
        color: var(--text-soft);
      }

      .header-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }

      .btn-primary,
      .btn-ghost {
        border-radius: 999px;
        font-size: 0.85rem;
        border: 1px solid transparent;
        padding: 8px 14px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
        transition: transform var(--transition-fast),
          box-shadow var(--transition-fast),
          background-color var(--transition-fast),
          border-color var(--transition-fast),
          color var(--transition-fast);
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent), var(--accent-strong));
        color: #ffffff;
        box-shadow: 0 12px 28px rgba(79, 70, 229, 0.35);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 40px rgba(79, 70, 229, 0.45);
      }

      .btn-ghost {
        background: rgba(255, 255, 255, 0.85);
        color: var(--text-soft);
        border-color: rgba(148, 163, 184, 0.35);
      }

      .btn-ghost:hover {
        background: #ffffff;
        color: var(--text-main);
      }

      .app-main {
        flex: 1;
        padding: 4px 24px 20px;
      }

      .app-main-inner {
        max-width: 1200px;
        margin: 0 auto 24px;
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 2.1fr);
        gap: 18px;
      }

      @media (max-width: 960px) {
        .app-main-inner {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .panel {
        background: radial-gradient(circle at top left, rgba(79, 70, 229, 0.08), transparent 55%),
          var(--bg-elevated);
        border-radius: var(--radius-lg);
        border: 1px solid rgba(148, 163, 184, 0.3);
        box-shadow: var(--shadow-soft);
        padding: 16px 16px 14px;
        position: relative;
        overflow: hidden;
      }

      .panel::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        border: 1px solid transparent;
        background: linear-gradient(135deg, rgba(148, 163, 184, 0.4), rgba(79, 70, 229, 0.1))
          border-box;
        mask: linear-gradient(#000 0 0) padding-box, linear-gradient(#000 0 0);
        mask-composite: exclude;
        opacity: 0.6;
        pointer-events: none;
      }

      .panel-inner {
        position: relative;
        z-index: 1;
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 8px;
        margin-bottom: 16px;
      }

      .panel-header h2 {
        margin: 0;
        font-size: 0.98rem;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: #4b5563;
      }

      .panel-header span {
        font-size: 0.8rem;
        color: var(--text-soft);
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 10px;
        margin-bottom: 12px;
      }

      @media (max-width: 720px) {
        .metrics-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      .metric-card {
        border-radius: var(--radius-md);
        padding: 10px 11px;
        background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.12), transparent 55%),
          rgba(248, 250, 252, 0.96);
        border: 1px solid rgba(226, 232, 240, 0.9);
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .metric-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: #6b7280;
      }

      .metric-main {
        display: flex;
        align-items: baseline;
        gap: 6px;
      }

      .metric-value {
        font-size: 1.1rem;
        font-weight: 600;
      }

      .metric-chip {
        border-radius: 999px;
        font-size: 0.7rem;
        padding: 2px 7px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: rgba(255, 255, 255, 0.9);
        color: #4b5563;
        white-space: nowrap;
      }

      .metric-footnote {
        font-size: 0.72rem;
        color: #9ca3af;
      }

      .metric-value.accent {
        color: var(--accent-strong);
      }

      .metric-value.success {
        color: var(--success);
      }

      .metric-value.warning {
        color: var(--warning);
      }

      .risk-list {
        margin: 0;
        padding: 0;
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 6px;
        max-height: 168px;
        overflow: auto;
        scrollbar-width: thin;
      }

      .risk-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-radius: var(--radius-md);
        padding: 6px 8px;
        background: rgba(254, 249, 195, 0.7);
        border: 1px solid rgba(250, 204, 21, 0.7);
      }

      .risk-row-critical {
        background: rgba(254, 226, 226, 0.85);
        border-color: rgba(248, 113, 113, 0.9);
      }

      .risk-label {
        font-size: 0.8rem;
        font-weight: 500;
      }

      .risk-meta {
        font-size: 0.75rem;
        color: #7f1d1d;
      }

      .risk-tag {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        border-radius: 999px;
        padding: 2px 7px;
        border: 1px solid rgba(127, 29, 29, 0.7);
        color: #7f1d1d;
        background: rgba(255, 255, 255, 0.92);
      }

      .risk-empty {
        font-size: 0.78rem;
        color: var(--text-soft);
        padding: 8px 8px 2px;
      }

      .filters-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
        margin: 10px 0 6px;
      }

      .filters-grid-wide {
        grid-template-columns: minmax(0, 1.5fr) minmax(0, 1fr);
      }

      @media (max-width: 720px) {
        .filters-grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .field label {
        font-size: 0.74rem;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: #6b7280;
      }

      .field input[type="search"],
      .field select {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        padding: 7px 10px;
        font-size: 0.85rem;
        outline: none;
        background: rgba(249, 250, 251, 0.96);
        transition: border-color var(--transition-fast),
          box-shadow var(--transition-fast),
          background-color var(--transition-fast);
      }

      .field input[type="search"]:focus,
      .field select:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.28);
        background: #ffffff;
      }

      .field input[type="search"]::placeholder {
        color: #9ca3af;
      }

      .legend-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 4px;
        gap: 8px;
        flex-wrap: wrap;
      }

      .legend-label {
        font-size: 0.74rem;
        color: var(--text-soft);
      }

      .legend-items {
        display: inline-flex;
        flex-wrap: wrap;
        gap: 4px;
      }

      .legend-pill {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        border-radius: 999px;
        padding: 2px 8px;
        font-size: 0.7rem;
        background: rgba(255, 255, 255, 0.96);
        border: 1px solid rgba(226, 232, 240, 0.9);
      }

      .legend-swatch {
        width: 16px;
        height: 6px;
        border-radius: 999px;
        background: #e5e7eb;
      }

      .legend-swatch.level-0 {
        background: #e5e7eb;
      }
      .legend-swatch.level-1 {
        background: #fed7aa;
      }
      .legend-swatch.level-2 {
        background: #facc15;
      }
      .legend-swatch.level-3 {
        background: #4ade80;
      }
      .legend-swatch.level-4 {
        background: #22c55e;
      }

      .matrix-wrapper {
        border-radius: var(--radius-md);
        border: 1px solid rgba(209, 213, 219, 0.9);
        background: rgba(249, 250, 251, 0.96);
        overflow: hidden;
        position: relative;
      }

      .matrix-scroll {
        overflow: auto;
        max-height: 430px;
        scrollbar-width: thin;
      }

      .matrix-table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
        min-width: 620px;
        font-size: 0.8rem;
      }

      .matrix-table thead {
        position: sticky;
        top: 0;
        z-index: 3;
      }

      .matrix-table th {
        background: linear-gradient(to bottom, #f9fafb, #e5e7eb);
        padding: 8px 10px;
        text-align: left;
        font-weight: 500;
        color: #4b5563;
        border-bottom: 1px solid #d1d5db;
        white-space: nowrap;
      }

      .matrix-table th:not(:last-child),
      .matrix-table td:not(:last-child) {
        border-right: 1px solid #e5e7eb;
      }

      .matrix-table td {
        padding: 4px 8px;
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
      }

      .matrix-table tr:nth-child(even) td {
        background: #f9fafb;
      }

      .matrix-sticky-col {
        position: sticky;
        left: 0;
        z-index: 2;
        background: inherit;
      }

      .matrix-sticky-col-header {
        z-index: 4;
      }

      .employee-name {
        font-weight: 600;
        font-size: 0.82rem;
      }

      .employee-meta {
        font-size: 0.72rem;
        color: #9ca3af;
      }

      .pill-skill {
        border-radius: 999px;
        padding: 4px 8px;
        font-size: 0.72rem;
        border: 1px solid transparent;
        background: #f3f4f6;
        color: #4b5563;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .pill-skill-count {
        font-variant-numeric: tabular-nums;
        color: #6b7280;
      }

      .matrix-cell-btn {
        width: 100%;
        border-radius: 999px;
        border: 1px solid transparent;
        padding: 5px 6px;
        font-size: 0.72rem;
        cursor: pointer;
        background: #f3f4f6;
        color: #4b5563;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        transition: background-color var(--transition-fast),
          border-color var(--transition-fast),
          transform var(--transition-fast),
          box-shadow var(--transition-fast),
          color var(--transition-fast);
        position: relative;
        overflow: hidden;
      }

      .matrix-cell-btn span.level-dot {
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: #e5e7eb;
      }

      .matrix-cell-btn[data-level="0"] {
        background: #f3f4f6;
        color: #9ca3af;
      }
      .matrix-cell-btn[data-level="1"] {
        background: rgba(254, 215, 170, 0.6);
        border-color: rgba(252, 165, 165, 0.8);
        color: #92400e;
      }
      .matrix-cell-btn[data-level="2"] {
        background: rgba(254, 249, 195, 0.75);
        border-color: rgba(251, 191, 36, 0.8);
        color: #92400e;
      }
      .matrix-cell-btn[data-level="3"] {
        background: rgba(190, 242, 100, 0.75);
        border-color: rgba(101, 163, 13, 0.85);
        color: #365314;
      }
      .matrix-cell-btn[data-level="4"] {
        background: linear-gradient(120deg, #4ade80, #22c55e);
        border-color: rgba(22, 163, 74, 0.95);
        color: #064e3b;
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.4);
      }

      .matrix-cell-btn[data-level="1"] span.level-dot {
        background: #fed7aa;
      }
      .matrix-cell-btn[data-level="2"] span.level-dot {
        background: #facc15;
      }
      .matrix-cell-btn[data-level="3"] span.level-dot {
        background: #4ade80;
      }
      .matrix-cell-btn[data-level="4"] span.level-dot {
        background: #22c55e;
      }

      .matrix-cell-btn:hover {
        transform: translateY(-0.5px);
        box-shadow: 0 8px 16px rgba(15, 23, 42, 0.18);
      }

      .matrix-cell-btn[data-level="0"]:hover {
        background: #e5e7eb;
      }

      .matrix-cell-btn::after {
        content: attr(data-tooltip);
        position: absolute;
        left: 50%;
        bottom: 110%;
        transform: translateX(-50%);
        padding: 4px 6px;
        border-radius: 6px;
        background: #111827;
        color: #f9fafb;
        font-size: 0.7rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.12s ease-out, transform 0.12s ease-out;
        transform-origin: bottom center;
      }

      .matrix-cell-btn:hover::after {
        opacity: 1;
        transform: translateX(-50%) translateY(-1px);
      }

      .matrix-footer {
        padding: 6px 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.73rem;
        color: #9ca3af;
        background: linear-gradient(to right, rgba(79, 70, 229, 0.06), transparent);
      }

      .matrix-footer span {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: #22c55e;
      }

      .toggles-row {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end;
        gap: 6px;
        margin-bottom: 6px;
      }

      .toggle-pill {
        border-radius: 999px;
        padding: 3px 9px;
        font-size: 0.72rem;
        background: rgba(249, 250, 251, 0.95);
        border: 1px solid rgba(209, 213, 219, 0.9);
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
      }

      .toggle-pill input {
        margin: 0;
      }

      .pill-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: rgba(16, 185, 129, 0.9);
      }

      .divider {
        height: 1px;
        background: linear-gradient(
          to right,
          transparent,
          rgba(148, 163, 184, 0.7),
          transparent
        );
        margin: 6px 0 8px;
      }

      .skills-bar {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-top: 4px;
      }

      .skill-bar-row {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .skill-bar-label {
        font-size: 0.75rem;
        color: #4b5563;
        flex: 0 0 90px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .skill-bar-track {
        flex: 1;
        height: 6px;
        border-radius: 999px;
        background: #e5e7eb;
        overflow: hidden;
        position: relative;
      }

      .skill-bar-fill {
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: linear-gradient(90deg, #fecaca, #fbbf24, #4ade80, #22c55e);
        transform-origin: left center;
        transform: scaleX(0.2);
        transition: transform 0.25s ease-out;
      }

      .skill-bar-meta {
        flex: 0 0 auto;
        font-size: 0.72rem;
        color: #6b7280;
        white-space: nowrap;
      }

      .app-footer {
        padding: 0 24px 16px;
        font-size: 0.72rem;
        color: #9ca3af;
      }

      .app-footer-inner {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 6px;
      }

      .app-footer span {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="app-header-inner">
          <div class="app-title-block">
            <h1>
              Employee Skills Matrix
              <span class="badge-pill">HR Analytics</span>
            </h1>
            <div class="app-title-sub">
              Visualize capability coverage, identify risk, and guide upskilling in
              one glance.
            </div>
          </div>
          <div class="header-actions">
            <button class="btn-ghost" type="button" aria-label="Download snapshot">
              ‚¨á Snapshot
            </button>
            <button class="btn-primary" type="button" aria-label="Highlight critical gaps">
              ‚ö° Highlight gaps
            </button>
          </div>
        </div>
      </header>

      <main class="app-main">
        <div class="app-main-inner">
          <section class="panel" aria-label="Summary and filters">
            <div class="panel-inner">
              <div class="panel-header">
                <h2>Talent Coverage Summary</h2>
                <span id="summary-subtitle">Live snapshot ‚Ä¢ Small sample team</span>
              </div>

              <div class="metrics-grid" aria-label="Key metrics">
                <article class="metric-card">
                  <div class="metric-label">Coverage score</div>
                  <div class="metric-main">
                    <div class="metric-value accent" id="metric-coverage">‚Äì%</div>
                    <span class="metric-chip" id="metric-coverage-chip">Balanced</span>
                  </div>
                  <div class="metric-footnote" id="metric-coverage-footnote">
                    Weighted average of all proficiencies.
                  </div>
                </article>
                <article class="metric-card">
                  <div class="metric-label">Employees & roles</div>
                  <div class="metric-main">
                    <div class="metric-value" id="metric-employees">‚Äì</div>
                    <span class="metric-chip" id="metric-roles">‚Äì roles</span>
                  </div>
                  <div class="metric-footnote" id="metric-employees-footnote">
                    Filter to focus on a team or location.
                  </div>
                </article>
                <article class="metric-card">
                  <div class="metric-label">Critical skills</div>
                  <div class="metric-main">
                    <div class="metric-value warning" id="metric-risks">‚Äì</div>
                    <span class="metric-chip" id="metric-risks-chip">Potential gaps</span>
                  </div>
                  <div class="metric-footnote" id="metric-risks-footnote">
                    Skills with limited advanced coverage.
                  </div>
                </article>
              </div>

              <div class="filters-grid filters-grid-wide" aria-label="Filters">
                <div class="field">
                  <label for="search-input">Search people</label>
                  <input
                    id="search-input"
                    type="search"
                    placeholder="Name, role, or skill‚Ä¶"
                    autocomplete="off"
                  />
                </div>
                <div class="field">
                  <label for="skill-filter">Focus skill</label>
                  <select id="skill-filter">
                    <option value="all">All skills</option>
                  </select>
                </div>
              </div>
              <div class="filters-grid" aria-hidden="false">
                <div class="field">
                  <label for="team-filter">Team</label>
                  <select id="team-filter">
                    <option value="all">All teams</option>
                  </select>
                </div>
                <div class="field">
                  <label for="location-filter">Location</label>
                  <select id="location-filter">
                    <option value="all">All locations</option>
                  </select>
                </div>
              </div>

              <div class="legend-row">
                <div class="legend-label">
                  Levels (click a cell to adjust):
                </div>
                <div class="legend-items" aria-label="Proficiency legend">
                  <span class="legend-pill"
                    ><span class="legend-swatch level-0"></span>None</span
                  >
                  <span class="legend-pill"
                    ><span class="legend-swatch level-1"></span>Beginner</span
                  >
                  <span class="legend-pill"
                    ><span class="legend-swatch level-2"></span>Intermediate</span
                  >
                  <span class="legend-pill"
                    ><span class="legend-swatch level-3"></span>Advanced</span
                  >
                  <span class="legend-pill"
                    ><span class="legend-swatch level-4"></span>Expert</span
                  >
                </div>
              </div>

              <div class="divider"></div>

              <ul class="risk-list" id="risk-list" aria-label="Coverage risks"></ul>
            </div>
          </section>

          <section class="panel" aria-label="Skills matrix">
            <div class="panel-inner">
              <div class="panel-header">
                <h2>Skills & People Matrix</h2>
                <span id="matrix-subtitle">Click any cell to update level.</span>
              </div>

              <div class="toggles-row">
                <label class="toggle-pill">
                  <input id="toggle-hide-zero" type="checkbox" />
                  <span class="pill-dot"></span>
                  Hide empty skills
                </label>
                <label class="toggle-pill">
                  <input id="toggle-focus-advanced" type="checkbox" />
                  üîç Advanced & Expert only
                </label>
              </div>

              <div class="matrix-wrapper">
                <div class="matrix-scroll">
                  <table class="matrix-table" id="matrix-table">
                    <thead></thead>
                    <tbody></tbody>
                  </table>
                </div>
                <div class="matrix-footer">
                  <span
                    ><span class="dot"></span> Changes are stored in your browser only
                    (no data leaves this page).</span
                  >
                  <span id="matrix-footer-summary"></span>
                </div>
              </div>

              <div class="skills-bar" id="skills-bar" aria-label="Skill coverage mini-chart"></div>
            </div>
          </section>
        </div>
      </main>

      <footer class="app-footer">
        <div class="app-footer-inner">
          <span
            >Tip: Use this as a conversation aid in calibration, performance, and
            workforce planning sessions.</span
          >
          <span>Data is fictional ‚Ä¢ For demonstration only</span>
        </div>
      </footer>
    </div>

    <script>
      (function () {
        "use strict";

        const STORAGE_KEY = "employee-skills-matrix-v1";

        const LEVELS = [
          { id: 0, label: "None", short: "‚Äì", weight: 0 },
          { id: 1, label: "Beginner", short: "B", weight: 0.35 },
          { id: 2, label: "Intermediate", short: "I", weight: 0.6 },
          { id: 3, label: "Advanced", short: "A", weight: 0.85 },
          { id: 4, label: "Expert", short: "E", weight: 1 },
        ];

        const SKILLS = [
          { id: "communication", label: "Communication", category: "Core" },
          { id: "stakeholder", label: "Stakeholder Management", category: "Core" },
          { id: "leadership", label: "People Leadership", category: "Leadership" },
          { id: "talent", label: "Talent Development", category: "Leadership" },
          { id: "project", label: "Project Delivery", category: "Execution" },
          { id: "analytics", label: "HR Analytics", category: "Analytics" },
          { id: "coaching", label: "Coaching & Feedback", category: "Core" },
          { id: "change", label: "Change Management", category: "Strategy" },
          { id: "culture", label: "Culture & Engagement", category: "People" },
          { id: "recruiting", label: "Recruiting & Hiring", category: "People" },
        ];

        const EMPLOYEES = [
          {
            id: "e1",
            name: "Alex Rivera",
            role: "Engineering Manager",
            team: "Engineering",
            location: "New York",
            tenureYears: 4.1,
            skills: {
              communication: 4,
              stakeholder: 3,
              leadership: 4,
              talent: 3,
              project: 3,
              analytics: 2,
              coaching: 4,
              change: 2,
              culture: 3,
              recruiting: 1,
            },
          },
          {
            id: "e2",
            name: "Priya Patel",
            role: "HR Business Partner",
            team: "People",
            location: "London",
            tenureYears: 3.3,
            skills: {
              communication: 4,
              stakeholder: 4,
              leadership: 3,
              talent: 4,
              project: 2,
              analytics: 3,
              coaching: 4,
              change: 3,
              culture: 4,
              recruiting: 3,
            },
          },
          {
            id: "e3",
            name: "Taylor Kim",
            role: "Senior Recruiter",
            team: "Talent Acquisition",
            location: "Remote",
            tenureYears: 2.0,
            skills: {
              communication: 3,
              stakeholder: 3,
              leadership: 1,
              talent: 3,
              project: 2,
              analytics: 2,
              coaching: 3,
              change: 1,
              culture: 3,
              recruiting: 4,
            },
          },
          {
            id: "e4",
            name: "Jordan Lee",
            role: "People Analytics Lead",
            team: "People",
            location: "New York",
            tenureYears: 3.8,
            skills: {
              communication: 3,
              stakeholder: 3,
              leadership: 2,
              talent: 2,
              project: 3,
              analytics: 4,
              coaching: 2,
              change: 3,
              culture: 2,
              recruiting: 1,
            },
          },
          {
            id: "e5",
            name: "Morgan Chen",
            role: "Product Manager",
            team: "Product",
            location: "Berlin",
            tenureYears: 1.7,
            skills: {
              communication: 3,
              stakeholder: 4,
              leadership: 2,
              talent: 2,
              project: 4,
              analytics: 2,
              coaching: 2,
              change: 3,
              culture: 2,
              recruiting: 1,
            },
          },
          {
            id: "e6",
            name: "Samira Hassan",
            role: "HR Generalist",
            team: "People",
            location: "London",
            tenureYears: 2.5,
            skills: {
              communication: 3,
              stakeholder: 2,
              leadership: 1,
              talent: 3,
              project: 2,
              analytics: 1,
              coaching: 3,
              change: 2,
              culture: 3,
              recruiting: 3,
            },
          },
          {
            id: "e7",
            name: "Diego Santos",
            role: "Engineering Director",
            team: "Engineering",
            location: "Remote",
            tenureYears: 5.9,
            skills: {
              communication: 4,
              stakeholder: 4,
              leadership: 4,
              talent: 3,
              project: 4,
              analytics: 3,
              coaching: 4,
              change: 4,
              culture: 3,
              recruiting: 2,
            },
          },
        ];

        const initialState = {
          employees: structuredClone(EMPLOYEES),
          filters: {
            search: "",
            team: "all",
            location: "all",
            skill: "all",
            hideZero: false,
            focusAdvanced: false,
          },
        };

        function loadState() {
          try {
            const saved = window.localStorage.getItem(STORAGE_KEY);
            if (!saved) return structuredClone(initialState);
            const parsed = JSON.parse(saved);
            if (!parsed || !Array.isArray(parsed.employees)) {
              return structuredClone(initialState);
            }
            const hydrated = structuredClone(initialState);
            const byId = Object.fromEntries(
              parsed.employees.map((e) => [e.id, e.skills || {}])
            );
            hydrated.employees.forEach((emp) => {
              if (byId[emp.id]) {
                emp.skills = Object.assign({}, emp.skills, byId[emp.id]);
              }
            });
            if (parsed.filters) {
              hydrated.filters = Object.assign(hydrated.filters, parsed.filters);
            }
            return hydrated;
          } catch (e) {
            return structuredClone(initialState);
          }
        }

        function saveState(state) {
          try {
            const payload = {
              employees: state.employees.map((e) => ({
                id: e.id,
                skills: e.skills,
              })),
              filters: state.filters,
            };
            window.localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
          } catch (_) {
            // ignore storage issues
          }
        }

        let state = loadState();

        const els = {
          search: document.getElementById("search-input"),
          skillFilter: document.getElementById("skill-filter"),
          teamFilter: document.getElementById("team-filter"),
          locationFilter: document.getElementById("location-filter"),
          toggleHideZero: document.getElementById("toggle-hide-zero"),
          toggleFocusAdvanced: document.getElementById("toggle-focus-advanced"),
          riskList: document.getElementById("risk-list"),
          matrixTable: document.getElementById("matrix-table"),
          skillsBar: document.getElementById("skills-bar"),
          matrixFooterSummary: document.getElementById("matrix-footer-summary"),
          metricCoverage: document.getElementById("metric-coverage"),
          metricCoverageChip: document.getElementById("metric-coverage-chip"),
          metricCoverageFootnote: document.getElementById("metric-coverage-footnote"),
          metricEmployees: document.getElementById("metric-employees"),
          metricRoles: document.getElementById("metric-roles"),
          metricEmployeesFootnote: document.getElementById(
            "metric-employees-footnote"
          ),
          metricRisks: document.getElementById("metric-risks"),
          metricRisksChip: document.getElementById("metric-risks-chip"),
          metricRisksFootnote: document.getElementById("metric-risks-footnote"),
          matrixSubtitle: document.getElementById("matrix-subtitle"),
        };

        function initFilters() {
          const uniqueTeams = new Set();
          const uniqueLocations = new Set();

          state.employees.forEach((emp) => {
            uniqueTeams.add(emp.team);
            uniqueLocations.add(emp.location);
          });

          Array.from(uniqueTeams)
            .sort()
            .forEach((team) => {
              const opt = document.createElement("option");
              opt.value = team;
              opt.textContent = team;
              els.teamFilter.appendChild(opt);
            });

          Array.from(uniqueLocations)
            .sort()
            .forEach((loc) => {
              const opt = document.createElement("option");
              opt.value = loc;
              opt.textContent = loc;
              els.locationFilter.appendChild(opt);
            });

          SKILLS.forEach((skill) => {
            const opt = document.createElement("option");
            opt.value = skill.id;
            opt.textContent = skill.label;
            els.skillFilter.appendChild(opt);
          });

          els.search.value = state.filters.search || "";
          els.teamFilter.value = state.filters.team || "all";
          els.locationFilter.value = state.filters.location || "all";
          els.skillFilter.value = state.filters.skill || "all";
          els.toggleHideZero.checked = !!state.filters.hideZero;
          els.toggleFocusAdvanced.checked = !!state.filters.focusAdvanced;
        }

        function getLevelDef(level) {
          return LEVELS.find((l) => l.id === level) || LEVELS[0];
        }

        function computeMetrics(filteredEmployees, visibleSkills) {
          const skillStats = {};
          visibleSkills.forEach((skill) => {
            skillStats[skill.id] = {
              skill,
              nonZeroCount: 0,
              advancedCount: 0,
              totalWeight: 0,
              maxPossibleWeight: filteredEmployees.length * LEVELS[LEVELS.length - 1].weight,
            };
          });

          let coverageWeightSum = 0;
          let coverageWeightMax =
            filteredEmployees.length *
            visibleSkills.length *
            LEVELS[LEVELS.length - 1].weight;

          filteredEmployees.forEach((emp) => {
            visibleSkills.forEach((skill) => {
              const level = emp.skills[skill.id] ?? 0;
              const def = getLevelDef(level);
              const s = skillStats[skill.id];
              s.totalWeight += def.weight;
              if (level > 0) s.nonZeroCount += 1;
              if (level >= 3) s.advancedCount += 1;
              coverageWeightSum += def.weight;
            });
          });

          const overallCoverage =
            coverageWeightMax > 0 ? (coverageWeightSum / coverageWeightMax) * 100 : 0;

          const riskSkills = Object.values(skillStats)
            .filter((s) => filteredEmployees.length > 0)
            .map((s) => {
              const coveragePct =
                s.maxPossibleWeight > 0
                  ? (s.totalWeight / s.maxPossibleWeight) * 100
                  : 0;
              const advShare =
                filteredEmployees.length > 0
                  ? s.advancedCount / filteredEmployees.length
                  : 0;
              let severity = "ok";
              if (advShare < 0.25 || coveragePct < 45) severity = "watch";
              if (advShare < 0.15 || coveragePct < 30) severity = "critical";
              return {
                id: s.skill.id,
                skill: s.skill,
                coveragePct,
                advShare,
                severity,
              };
            })
            .filter((s) => s.severity !== "ok")
            .sort((a, b) => a.coveragePct - b.coveragePct);

          return { skillStats, overallCoverage, riskSkills };
        }

        function renderSummary(filteredEmployees, visibleSkills, metrics) {
          const employeeCount = filteredEmployees.length;
          const roles = new Set(filteredEmployees.map((e) => e.role));

          const coverage = metrics.overallCoverage || 0;
          els.metricCoverage.textContent = `${coverage.toFixed(0)}%`;

          let chip = "Balanced";
          let footnote = "Overall coverage is healthy.";
          if (coverage < 45) {
            chip = "At risk";
            footnote = "Focus development on 2‚Äì3 critical skills first.";
          } else if (coverage < 65) {
            chip = "Developing";
            footnote = "Upskilling will meaningfully raise resilience.";
          } else if (coverage > 80) {
            chip = "Strong";
            footnote = "Maintain via succession and coaching.";
          }
          els.metricCoverageChip.textContent = chip;
          els.metricCoverageFootnote.textContent = footnote;

          els.metricEmployees.textContent = employeeCount.toString();
          els.metricRoles.textContent = `${roles.size || "‚Äì"} roles`;

          els.metricEmployeesFootnote.textContent =
            employeeCount === state.employees.length
              ? "Showing the full population in this sample."
              : `Filtered to ${employeeCount} of ${state.employees.length} people.`;

          const riskCount = metrics.riskSkills.length;
          els.metricRisks.textContent = riskCount.toString();
          els.metricRisksChip.textContent =
            riskCount === 0 ? "No flagged skills" : "Needs attention";
          els.metricRisksFootnote.textContent =
            riskCount === 0
              ? "All tracked skills meet the minimum coverage threshold."
              : "Prioritize action on critical skills with limited advanced coverage.";

          els.matrixFooterSummary.textContent = `${employeeCount} people √ó ${
            visibleSkills.length
          } skills ‚Ä¢ ${coverage.toFixed(0)}% weighted coverage`;
        }

        function renderRisks(metrics) {
          const list = els.riskList;
          list.innerHTML = "";
          if (metrics.riskSkills.length === 0) {
            const li = document.createElement("li");
            li.className = "risk-empty";
            li.textContent =
              "No skills currently flagged. Use this view to monitor succession and resiliency over time.";
            list.appendChild(li);
            return;
          }
          metrics.riskSkills.forEach((entry) => {
            const li = document.createElement("li");
            const isCritical = entry.severity === "critical";
            li.className = "risk-row" + (isCritical ? " risk-row-critical" : "");
            const label = document.createElement("div");
            label.className = "risk-label";
            label.textContent = entry.skill.label;
            const meta = document.createElement("div");
            meta.className = "risk-meta";
            const advancedPct = entry.advShare * 100;
            meta.textContent = `${advancedPct.toFixed(
              0
            )}% with Advanced+ ‚Ä¢ Overall coverage ${entry.coveragePct.toFixed(0)}%`;
            const tag = document.createElement("span");
            tag.className = "risk-tag";
            tag.textContent = isCritical ? "Critical gap" : "Watch";
            li.appendChild(label);
            li.appendChild(meta);
            li.appendChild(tag);
            list.appendChild(li);
          });
        }

        function filterEmployees() {
          const { search, team, location, skill, focusAdvanced } = state.filters;
          const query = (search || "").trim().toLowerCase();

          return state.employees.filter((emp) => {
            if (team !== "all" && emp.team !== team) return false;
            if (location !== "all" && emp.location !== location) return false;

            if (query) {
              const inBasics =
                emp.name.toLowerCase().includes(query) ||
                emp.role.toLowerCase().includes(query) ||
                emp.team.toLowerCase().includes(query) ||
                emp.location.toLowerCase().includes(query);

              const inSkill = SKILLS.some((s) => {
                const level = emp.skills[s.id] ?? 0;
                const labelMatch = s.label.toLowerCase().includes(query);
                const levelLabelMatch = getLevelDef(level)
                  .label.toLowerCase()
                  .includes(query);
                return labelMatch || levelLabelMatch;
              });

              if (!inBasics && !inSkill) return false;
            }

            if (skill !== "all" && focusAdvanced) {
              const level = emp.skills[skill] ?? 0;
              if (level < 3) return false;
            }

            return true;
          });
        }

        function getVisibleSkills(filteredEmployees) {
          const { skill, hideZero } = state.filters;
          let skills = SKILLS;
          if (skill !== "all") {
            skills = SKILLS.filter((s) => s.id === skill);
          }
          if (!hideZero) return skills;

          return skills.filter((s) =>
            filteredEmployees.some((emp) => (emp.skills[s.id] ?? 0) > 0)
          );
        }

        function renderMatrix(filteredEmployees, visibleSkills) {
          const thead = els.matrixTable.querySelector("thead");
          const tbody = els.matrixTable.querySelector("tbody");
          thead.innerHTML = "";
          tbody.innerHTML = "";

          const headRow = document.createElement("tr");
          const thName = document.createElement("th");
          thName.className = "matrix-sticky-col matrix-sticky-col-header";
          thName.textContent = "Employee";
          headRow.appendChild(thName);

          visibleSkills.forEach((s) => {
            const th = document.createElement("th");
            th.textContent = s.label;
            headRow.appendChild(th);
          });
          thead.appendChild(headRow);

          filteredEmployees.forEach((emp) => {
            const tr = document.createElement("tr");
            const tdName = document.createElement("td");
            tdName.className = "matrix-sticky-col";
            const nameEl = document.createElement("div");
            nameEl.className = "employee-name";
            nameEl.textContent = emp.name;
            const metaEl = document.createElement("div");
            metaEl.className = "employee-meta";
            metaEl.textContent = `${emp.role} ‚Ä¢ ${emp.team} ‚Ä¢ ${emp.location}`;
            tdName.appendChild(nameEl);
            tdName.appendChild(metaEl);
            tr.appendChild(tdName);

            visibleSkills.forEach((skill) => {
              const td = document.createElement("td");
              const level = emp.skills[skill.id] ?? 0;
              const def = getLevelDef(level);
              const btn = document.createElement("button");
              btn.type = "button";
              btn.className = "matrix-cell-btn";
              btn.dataset.level = String(level);
              btn.dataset.empId = emp.id;
              btn.dataset.skillId = skill.id;
              btn.setAttribute(
                "aria-label",
                `${emp.name} ‚Äì ${skill.label}: ${def.label}. Click to cycle level.`
              );
              btn.setAttribute(
                "data-tooltip",
                `${emp.name} ‚Ä¢ ${skill.label}: ${def.label}`
              );
              const dot = document.createElement("span");
              dot.className = "level-dot";
              const label = document.createElement("span");
              label.textContent = def.short;
              btn.appendChild(dot);
              btn.appendChild(label);
              td.appendChild(btn);
              tr.appendChild(td);
            });

            tbody.appendChild(tr);
          });
        }

        function renderSkillBars(metrics, visibleSkills, filteredEmployees) {
          const container = els.skillsBar;
          container.innerHTML = "";
          const { skillStats } = metrics;

          visibleSkills.forEach((skill) => {
            const row = document.createElement("div");
            row.className = "skill-bar-row";
            const label = document.createElement("div");
            label.className = "skill-bar-label";
            label.textContent = skill.label;
            const track = document.createElement("div");
            track.className = "skill-bar-track";
            const fill = document.createElement("div");
            fill.className = "skill-bar-fill";
            const meta = document.createElement("div");
            meta.className = "skill-bar-meta";

            const stats = skillStats[skill.id];
            const coveragePct =
              stats && stats.maxPossibleWeight > 0
                ? (stats.totalWeight / stats.maxPossibleWeight) * 100
                : 0;
            const advPct =
              filteredEmployees.length > 0
                ? (stats.advancedCount / filteredEmployees.length) * 100
                : 0;

            const scale = Math.max(0.04, Math.min(1, coveragePct / 100));
            fill.style.transform = `scaleX(${scale.toFixed(2)})`;

            meta.textContent = `${coveragePct.toFixed(0)}% cov ‚Ä¢ ${advPct.toFixed(
              0
            )}% Adv+`;
            track.appendChild(fill);
            row.appendChild(label);
            row.appendChild(track);
            row.appendChild(meta);
            container.appendChild(row);
          });
        }

        function handleCellClick(evt) {
          const target = evt.target.closest(".matrix-cell-btn");
          if (!target) return;
          const empId = target.dataset.empId;
          const skillId = target.dataset.skillId;
          if (!empId || !skillId) return;

          const emp = state.employees.find((e) => e.id === empId);
          if (!emp) return;
          const current = emp.skills[skillId] ?? 0;
          const next = (current + 1) % LEVELS.length;
          emp.skills[skillId] = next;
          saveState(state);
          render();
        }

        function attachEventListeners() {
          els.search.addEventListener("input", (e) => {
            state.filters.search = e.target.value || "";
            saveState(state);
            render();
          });

          els.skillFilter.addEventListener("change", (e) => {
            state.filters.skill = e.target.value || "all";
            saveState(state);
            render();
          });

          els.teamFilter.addEventListener("change", (e) => {
            state.filters.team = e.target.value || "all";
            saveState(state);
            render();
          });

          els.locationFilter.addEventListener("change", (e) => {
            state.filters.location = e.target.value || "all";
            saveState(state);
            render();
          });

          els.toggleHideZero.addEventListener("change", (e) => {
            state.filters.hideZero = !!e.target.checked;
            saveState(state);
            render();
          });

          els.toggleFocusAdvanced.addEventListener("change", (e) => {
            state.filters.focusAdvanced = !!e.target.checked;
            saveState(state);
            render();
          });

          els.matrixTable.addEventListener("click", handleCellClick);
        }

        function render() {
          const filteredEmployees = filterEmployees();
          const visibleSkills = getVisibleSkills(filteredEmployees);
          const metrics = computeMetrics(filteredEmployees, visibleSkills);

          renderSummary(filteredEmployees, visibleSkills, metrics);
          renderRisks(metrics);
          renderMatrix(filteredEmployees, visibleSkills);
          renderSkillBars(metrics, visibleSkills, filteredEmployees);

          if (filteredEmployees.length === 0) {
            els.matrixSubtitle.textContent =
              "No people match your filters. Adjust filters to see coverage.";
          } else {
            els.matrixSubtitle.textContent =
              "Click any cell to cycle between None, Beginner, Intermediate, Advanced, and Expert.";
          }
        }

        initFilters();
        attachEventListeners();
        render();
      })();
    </script>
  </body>
</html>

