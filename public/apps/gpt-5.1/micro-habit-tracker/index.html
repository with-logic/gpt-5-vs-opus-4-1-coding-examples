<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Micro Habit Tracker</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #f5f7fb;
        --panel: #ffffff;
        --ink: #111827;
        --muted: #6b7280;
        --accent: #5b8def;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Inter", system-ui, sans-serif;
        background: var(--bg);
        color: var(--ink);
        min-height: 100vh;
        padding: clamp(1rem, 4vw, 2rem);
      }
      header {
        margin-bottom: 1.5rem;
      }
      h1 {
        margin: 0 0 0.25rem;
      }
      .board {
        background: var(--panel);
        border-radius: 1.5rem;
        padding: 1rem;
        box-shadow: 0 15px 25px rgba(17, 24, 39, 0.08);
      }
      .habits {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .habit {
        display: grid;
        gap: 0.5rem;
        grid-template-columns: 140px 1fr auto;
        align-items: center;
      }
      .habit-name {
        font-weight: 600;
      }
      .grid-days {
        display: grid;
        grid-template-columns: repeat(7, minmax(24px, 1fr));
        gap: 0.3rem;
      }
      .grid-days button {
        border: 1px solid rgba(0, 0, 0, 0.1);
        background: var(--bg);
        border-radius: 0.5rem;
        height: 32px;
        cursor: pointer;
      }
      .grid-days button.active {
        background: var(--accent);
        color: #fff;
      }
      .chart {
        display: flex;
        gap: 0.2rem;
        height: 6px;
        margin-top: 0.2rem;
      }
      .chart span {
        flex: 1;
        border-radius: 999px;
        background: rgba(91, 141, 239, 0.2);
      }
      .chart span.on {
        background: var(--accent);
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 1rem 0;
      }
      input,
      button,
      label {
        font: inherit;
      }
      button {
        border-radius: 0.75rem;
        border: none;
        padding: 0.6rem 1rem;
        background: var(--accent);
        color: #fff;
        cursor: pointer;
      }
      .streak {
        font-size: 0.9rem;
        color: var(--muted);
      }
      @media (max-width: 720px) {
        .habit {
          grid-template-columns: 1fr;
          border-bottom: 1px solid rgba(0, 0, 0, 0.05);
          padding-bottom: 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Micro Habit Tracker</h1>
      <p>Build tiny wins every day. Seven habits max, deep focus.</p>
    </header>
    <div class="board">
      <div class="controls">
        <input type="text" id="habitName" placeholder="Add habit (max 7)" />
        <button id="addHabit">Add</button>
        <button id="skipDay">Skip today</button>
        <button id="export">Export JSON</button>
        <label>
          <input type="file" id="import" hidden />
          <span style="border:1px solid rgba(0,0,0,0.2);border-radius:0.75rem;padding:0.5rem 1rem;cursor:pointer;display:inline-block;color:var(--accent);">Import</span>
        </label>
      </div>
      <div class="habits" id="habits"></div>
    </div>

    <script>
      const today = new Date();
      const days = Array.from({ length: 7 }, (_, i) => {
        const d = new Date();
        d.setDate(today.getDate() - (6 - i));
        return d;
      });
      const format = (date) => date.toISOString().split("T")[0];
      const habitsEl = document.getElementById("habits");
      const addBtn = document.getElementById("addHabit");
      const nameInput = document.getElementById("habitName");
      const skipBtn = document.getElementById("skipDay");
      const exportBtn = document.getElementById("export");
      const importInput = document.getElementById("import");
      const emojiPalette = ["ðŸŒ±", "ðŸ’§", "ðŸ“š", "ðŸ’ª", "ðŸ§˜", "âœï¸", "ðŸ«—"]; 
      let skipped = new Set();

      let habits = [
        { id: crypto.randomUUID(), name: "Meditate", log: { [format(days[3])]: true, [format(days[4])]: true, [format(days[5])]: false, [format(days[6])]: true }, icon: "ðŸ§˜" },
        { id: crypto.randomUUID(), name: "Stretch", log: { [format(days[4])]: true, [format(days[5])]: true, [format(days[6])]: true }, icon: "ðŸ’ª" },
      ];

      function streakFor(habit) {
        let streak = 0;
        for (let i = days.length - 1; i >= 0; i--) {
          const key = format(days[i]);
          if (skipped.has(key)) continue;
          if (habit.log[key]) streak += 1;
          else break;
        }
        return streak;
      }

      function render() {
        habitsEl.innerHTML = "";
        habits.forEach((habit) => {
          const wrapper = document.createElement("div");
          wrapper.className = "habit";
          const streak = streakFor(habit);
          const name = document.createElement("div");
          name.innerHTML = `<span class="habit-name">${habit.icon} ${habit.name}</span><div class="streak">ðŸ”¥ ${streak} day streak</div>`;
          const dayGrid = document.createElement("div");
          dayGrid.className = "grid-days";
          days.forEach((day) => {
            const btn = document.createElement("button");
            const key = format(day);
            btn.textContent = day.getDate();
            if (habit.log[key]) btn.classList.add("active");
            btn.addEventListener("click", () => toggle(habit.id, key));
            dayGrid.appendChild(btn);
          });
          const chart = document.createElement("div");
          chart.className = "chart";
          days.forEach((day) => {
            const span = document.createElement("span");
            if (habit.log[format(day)]) span.classList.add("on");
            chart.appendChild(span);
          });
          const actions = document.createElement("div");
          const edit = document.createElement("button");
          edit.textContent = "Edit";
          edit.addEventListener("click", () => editHabit(habit.id));
          const del = document.createElement("button");
          del.textContent = "Delete";
          del.addEventListener("click", () => removeHabit(habit.id));
          actions.append(edit, del);
          wrapper.append(name, dayGrid, chart, actions);
          habitsEl.appendChild(wrapper);
        });
      }

      function toggle(id, key) {
        const habit = habits.find((h) => h.id === id);
        if (!habit) return;
        habit.log[key] = !habit.log[key];
        render();
      }

      function addHabit() {
        const name = nameInput.value.trim();
        if (!name || habits.length >= 7) return;
        const icon = emojiPalette[habits.length % emojiPalette.length];
        habits.push({ id: crypto.randomUUID(), name, log: {}, icon });
        nameInput.value = "";
        render();
      }

      function editHabit(id) {
        const habit = habits.find((h) => h.id === id);
        if (!habit) return;
        const value = prompt("Rename habit", habit.name);
        if (value) {
          habit.name = value;
          render();
        }
      }

      function removeHabit(id) {
        habits = habits.filter((h) => h.id !== id);
        render();
      }

      function skipToday() {
        skipped.add(format(today));
        render();
      }

      function exportData() {
        const data = { habits, skipped: [...skipped] };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "habits.json";
        link.click();
      }

      importInput.addEventListener("change", async (event) => {
        const file = event.target.files?.[0];
        if (!file) return;
        const text = await file.text();
        const data = JSON.parse(text);
        habits = data.habits;
        skipped = new Set(data.skipped || []);
        render();
      });

      addBtn.addEventListener("click", addHabit);
      skipBtn.addEventListener("click", skipToday);
      exportBtn.addEventListener("click", exportData);
      render();
    </script>
  </body>
</html>
