<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Micro Habit Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #050816;
        --bg-elevated: #0b1020;
        --bg-soft: #10182b;
        --accent: #ff7a18;
        --accent-soft: rgba(255, 122, 24, 0.2);
        --accent-strong: #ffb347;
        --accent-alt: #4ac6ff;
        --text: #f9fafb;
        --muted: #9ca3af;
        --border-subtle: rgba(148, 163, 184, 0.2);
        --danger: #fb7185;
        --success: #22c55e;
        --radius-lg: 18px;
        --radius-md: 12px;
        --shadow-soft: 0 18px 60px rgba(15, 23, 42, 0.7);
        --shadow-glow: 0 0 40px rgba(250, 204, 21, 0.18);
        --transition-fast: 0.16s ease-out;
        --transition-slow: 0.3s ease-out;
        --max-width: 1080px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top left, #1e293b 0, #020617 55%);
        color: var(--text);
        min-height: 100%;
      }

      body {
        display: flex;
        align-items: stretch;
        justify-content: center;
      }

      .page {
        width: 100%;
        max-width: var(--max-width);
        padding: 18px 14px 24px;
      }

      @media (min-width: 768px) {
        .page {
          padding: 26px 20px 32px;
        }
      }

      .shell {
        position: relative;
        border-radius: 26px;
        padding: 18px 18px 20px;
        background: radial-gradient(circle at top left, #1d283a 0, #020617 55%);
        box-shadow: var(--shadow-soft), var(--shadow-glow);
        overflow: hidden;
      }

      .shell::before {
        content: "";
        position: absolute;
        inset: -120px;
        background:
          radial-gradient(circle at 0 0, rgba(250, 204, 21, 0.22) 0, transparent 55%),
          radial-gradient(circle at 100% 0, rgba(56, 189, 248, 0.18) 0, transparent 55%);
        mix-blend-mode: screen;
        opacity: 0.55;
        pointer-events: none;
      }

      .shell-inner {
        position: relative;
        border-radius: 20px;
        padding: 16px 14px 18px;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), #020617);
        border: 1px solid rgba(148, 163, 184, 0.4);
        backdrop-filter: blur(28px);
      }

      @media (min-width: 900px) {
        .shell-inner {
          padding: 20px 20px 22px;
        }
      }

      .header {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
        gap: 12px 18px;
        margin-bottom: 18px;
      }

      .title-block {
        flex: 1 1 200px;
        min-width: 0;
      }

      .eyebrow {
        font-size: 11px;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: var(--muted);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .eyebrow-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #facc15, #f97316);
        box-shadow: 0 0 12px rgba(250, 204, 21, 0.9);
      }

      h1 {
        margin: 4px 0 4px;
        font-size: 24px;
        letter-spacing: 0.03em;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .sparkle {
        width: 18px;
        height: 18px;
        border-radius: 6px;
        background: conic-gradient(
          from 180deg,
          #f97316,
          #facc15,
          #22c55e,
          #38bdf8,
          #f97316
        );
        display: inline-flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 24px rgba(250, 204, 21, 0.6);
      }

      .sparkle-inner {
        width: 11px;
        height: 11px;
        border-radius: 4px;
        background: radial-gradient(circle at 30% 30%, #fefce8, #eab308);
      }

      .subtitle {
        margin: 0;
        font-size: 13px;
        color: var(--muted);
      }

      .summary-strip {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: stretch;
        justify-content: flex-start;
      }

      .summary-pill {
        min-width: 0;
        flex: 0 1 auto;
        border-radius: 999px;
        padding: 8px 11px;
        background: linear-gradient(
          120deg,
          rgba(15, 23, 42, 0.8),
          rgba(15, 23, 42, 0.2)
        );
        border: 1px solid rgba(148, 163, 184, 0.55);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        color: var(--muted);
        white-space: nowrap;
      }

      .summary-pill strong {
        font-size: 12px;
        color: var(--text);
        font-weight: 600;
      }

      .summary-badge {
        padding: 3px 8px;
        border-radius: 999px;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        background: rgba(34, 197, 94, 0.18);
        color: #bbf7d0;
        border: 1px solid rgba(34, 197, 94, 0.5);
      }

      .content {
        display: grid;
        gap: 14px;
      }

      @media (min-width: 900px) {
        .content {
          grid-template-columns: minmax(0, 3fr) minmax(0, 2.1fr);
          align-items: start;
          gap: 16px;
        }
      }

      .panel {
        border-radius: var(--radius-lg);
        background: radial-gradient(circle at top, #020617, #020617 40%, #020617);
        border: 1px solid var(--border-subtle);
        padding: 12px 11px 11px;
      }

      .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 6px;
        margin-bottom: 10px;
      }

      .panel-title {
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--muted);
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .panel-title-dot {
        width: 9px;
        height: 9px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #4ade80, #22c55e);
        box-shadow: 0 0 14px rgba(34, 197, 94, 0.8);
      }

      .panel-subtitle {
        margin: 0;
        font-size: 11px;
        color: var(--muted);
      }

      .panel-actions {
        display: flex;
        gap: 6px;
        align-items: center;
      }

      button,
      input,
      select,
      textarea {
        font-family: inherit;
      }

      .btn {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        padding: 6px 10px;
        background: radial-gradient(circle at 0 0, rgba(248, 250, 252, 0.12), transparent),
          rgba(15, 23, 42, 0.9);
        color: var(--text);
        font-size: 11px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        transition: background var(--transition-fast), border-color var(--transition-fast),
          transform var(--transition-fast), box-shadow var(--transition-fast),
          color var(--transition-fast);
      }

      .btn-icon-only {
        padding: 6px;
        border-radius: 999px;
      }

      .btn-primary {
        border-color: rgba(248, 250, 252, 0.7);
        background: linear-gradient(120deg, #f97316, #eab308);
        color: #0f172a;
        box-shadow: 0 12px 30px rgba(248, 181, 0, 0.45);
      }

      .btn-ghost {
        background: rgba(15, 23, 42, 0.8);
      }

      .btn-danger {
        border-color: rgba(248, 113, 113, 0.6);
        color: #fecaca;
      }

      .btn span.icon {
        font-size: 13px;
        line-height: 1;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.7);
        border-color: rgba(248, 250, 252, 0.9);
      }

      .btn-primary:hover {
        background: linear-gradient(120deg, #fb923c, #fde047);
        border-color: transparent;
      }

      .btn:active {
        transform: translateY(0);
        box-shadow: none;
      }

      .btn[disabled],
      .btn.disabled {
        opacity: 0.4;
        cursor: default;
        transform: none;
        box-shadow: none;
      }

      .btn-pill-label {
        font-weight: 500;
      }

      .btn-kbd {
        padding: 3px 7px;
        border-radius: 6px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        background: rgba(15, 23, 42, 0.9);
        font-size: 9px;
        color: var(--muted);
      }

      .habit-form {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 10px;
        align-items: center;
      }

      .input {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: rgba(15, 23, 42, 0.9);
        padding: 7px 11px;
        min-width: 0;
        color: var(--text);
        font-size: 12px;
        flex: 1 1 160px;
      }

      .input::placeholder {
        color: rgba(148, 163, 184, 0.7);
      }

      .input:focus {
        outline: none;
        border-color: rgba(248, 250, 252, 0.9);
        box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.4);
      }

      .input-small {
        flex: 0 0 120px;
      }

      .label-pill {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--muted);
      }

      .habits-header-row {
        display: grid;
        grid-template-columns: minmax(0, 1.8fr) repeat(7, 1fr) 0.85fr;
        align-items: center;
        gap: 4px;
        padding: 6px 8px 5px;
        border-radius: 999px;
        background: linear-gradient(120deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.3));
        border: 1px solid rgba(148, 163, 184, 0.6);
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--muted);
        margin-bottom: 4px;
      }

      .habits-header-row span {
        text-align: center;
      }

      .habits-header-label {
        text-align: left;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .habits-header-label span.dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #f97316, #fb923c);
      }

      .habits-list {
        display: flex;
        flex-direction: column;
        gap: 5px;
        max-height: 340px;
        overflow-y: auto;
        padding-right: 4px;
        scrollbar-width: thin;
        scrollbar-color: rgba(148, 163, 184, 0.8) transparent;
      }

      .habits-list::-webkit-scrollbar {
        width: 6px;
      }

      .habits-list::-webkit-scrollbar-track {
        background: transparent;
      }

      .habits-list::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.7);
        border-radius: 999px;
      }

      .habit-row {
        display: grid;
        grid-template-columns: minmax(0, 1.8fr) repeat(7, 1fr) 0.85fr;
        align-items: center;
        gap: 4px;
        padding: 6px 7px;
        border-radius: 999px;
        background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.7), transparent),
          rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.55);
        position: relative;
        overflow: hidden;
      }

      .habit-row::before {
        content: "";
        position: absolute;
        inset: 0;
        opacity: 0;
        background: radial-gradient(circle at 0 0, rgba(250, 204, 21, 0.28), transparent 65%);
        transition: opacity var(--transition-slow);
        pointer-events: none;
      }

      .habit-row[data-heat="high"]::before {
        opacity: 1;
      }

      .habit-label {
        display: flex;
        align-items: center;
        gap: 6px;
        min-width: 0;
      }

      .habit-color {
        width: 9px;
        height: 23px;
        border-radius: 999px;
        background: linear-gradient(180deg, #f97316, #facc15);
        box-shadow: 0 0 18px rgba(249, 115, 22, 0.8);
      }

      .habit-name {
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .habit-meta {
        font-size: 10px;
        color: var(--muted);
      }

      .habit-check-cell {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .check-pill {
        width: 24px;
        height: 24px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.75);
        background: radial-gradient(circle at 0 0, rgba(248, 250, 252, 0.14), transparent),
          rgba(15, 23, 42, 0.9);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        color: rgba(148, 163, 184, 0.85);
        transition: background var(--transition-fast), border-color var(--transition-fast),
          transform var(--transition-fast), box-shadow var(--transition-fast),
          color var(--transition-fast), opacity var(--transition-fast);
      }

      .check-pill[data-state="done"] {
        background: radial-gradient(circle at 30% 30%, #4ade80, #22c55e);
        border-color: rgba(22, 163, 74, 0.9);
        box-shadow: 0 0 16px rgba(34, 197, 94, 0.85);
        color: #052e16;
        transform: translateY(-1px);
      }

      .check-pill[data-state="skip"] {
        background: linear-gradient(135deg, rgba(148, 163, 184, 0.8), rgba(148, 163, 184, 0.3));
        border-style: dashed;
        color: #020617;
      }

      .check-pill[data-state="miss"] {
        opacity: 0.4;
      }

      .check-pill:hover {
        transform: translateY(-1px) scale(1.03);
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
      }

      .streak-chip {
        border-radius: 999px;
        padding: 4px 7px;
        background: radial-gradient(circle at 0 0, rgba(250, 204, 21, 0.35), transparent),
          rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(250, 204, 21, 0.7);
        font-size: 11px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        color: #fef9c3;
      }

      .streak-dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #fbbf24, #f97316);
        box-shadow: 0 0 12px rgba(251, 191, 36, 0.9);
      }

      .streak-label {
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-size: 9px;
        color: rgba(254, 249, 195, 0.9);
      }

      .streak-value {
        font-weight: 600;
      }

      .empty-state {
        padding: 14px 10px 10px;
        border-radius: 16px;
        background: repeating-linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.7),
            rgba(15, 23, 42, 0.7) 1px,
            rgba(15, 23, 42, 0.9) 1px,
            rgba(15, 23, 42, 0.9) 6px
          ),
          #020617;
        border: 1px dashed rgba(148, 163, 184, 0.8);
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 12px;
        color: var(--muted);
      }

      .empty-icon {
        width: 26px;
        height: 26px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
      }

      .empty-highlight {
        color: var(--accent-strong);
      }

      .right-panel {
        display: grid;
        gap: 10px;
      }

      .day-strip {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        align-items: center;
        margin-bottom: 10px;
      }

      .day-pill {
        border-radius: 999px;
        padding: 7px 11px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: radial-gradient(circle at 0 0, rgba(248, 250, 252, 0.1), transparent),
          rgba(15, 23, 42, 0.9);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        color: var(--muted);
      }

      .day-pill strong {
        color: var(--text);
        font-weight: 600;
      }

      .day-skip-indicator {
        border-radius: 999px;
        padding: 3px 8px;
        border: 1px dashed rgba(148, 163, 184, 0.9);
        background: rgba(15, 23, 42, 0.6);
        font-size: 10px;
      }

      .today-heat {
        border-radius: 999px;
        padding: 3px 7px;
        font-size: 10px;
        background: rgba(34, 197, 94, 0.18);
        color: #bbf7d0;
        border: 1px solid rgba(34, 197, 94, 0.5);
        text-transform: uppercase;
        letter-spacing: 0.14em;
      }

      .chart-card {
        border-radius: var(--radius-lg);
        padding: 10px 10px 12px;
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), #020617);
        border: 1px solid rgba(148, 163, 184, 0.7);
      }

      .chart-title-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .chart-title {
        font-size: 12px;
        color: var(--muted);
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .chart-kpi {
        font-size: 11px;
        color: var(--muted);
      }

      .chart-kpi strong {
        color: var(--text);
        font-weight: 600;
      }

      .chart-grid {
        display: grid;
        grid-template-columns: repeat(7, minmax(0, 1fr));
        gap: 4px;
        align-items: end;
        height: 90px;
      }

      .chart-bar {
        position: relative;
        border-radius: 999px;
        background: linear-gradient(180deg, #22c55e, #16a34a);
        box-shadow: 0 8px 16px rgba(16, 185, 129, 0.5);
        overflow: hidden;
        min-height: 3px;
      }

      .chart-bar-inner {
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 30% 0, rgba(250, 250, 249, 0.4), transparent 55%);
        opacity: 0.9;
      }

      .chart-bar.muted {
        background: linear-gradient(180deg, #4b5563, #111827);
        box-shadow: none;
        opacity: 0.65;
      }

      .chart-bar-label {
        margin-top: 3px;
        font-size: 10px;
        text-align: center;
        color: var(--muted);
      }

      .chart-bar-label strong {
        display: block;
        color: var(--text);
        font-size: 11px;
      }

      .chart-footnote {
        margin-top: 6px;
        font-size: 10px;
        color: var(--muted);
        display: flex;
        justify-content: space-between;
        gap: 8px;
      }

      .export-card {
        border-radius: var(--radius-lg);
        padding: 9px 10px 10px;
        background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.25), transparent),
          rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.7);
      }

      .export-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 6px;
        margin-bottom: 6px;
      }

      .export-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--muted);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .export-title-icon {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
      }

      .export-body {
        display: grid;
        gap: 6px;
      }

      .export-input {
        width: 100%;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.9);
        background: rgba(15, 23, 42, 0.96);
        color: var(--text);
        font-size: 11px;
        padding: 6px 7px;
        min-height: 70px;
        resize: vertical;
      }

      .export-input::placeholder {
        color: rgba(148, 163, 184, 0.7);
      }

      .export-input:focus {
        outline: none;
        box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.7);
      }

      .export-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 6px;
        font-size: 10px;
        color: var(--muted);
      }

      .status-badge {
        border-radius: 999px;
        padding: 3px 7px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: rgba(15, 23, 42, 0.9);
        display: inline-flex;
        align-items: center;
        gap: 5px;
      }

      .status-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #4ade80, #22c55e);
      }

      .status-dot.error {
        background: radial-gradient(circle at 30% 30%, #fb7185, #b91c1c);
      }

      .footer {
        margin-top: 14px;
        display: flex;
        justify-content: space-between;
        gap: 8px;
        font-size: 10px;
        color: var(--muted);
        flex-wrap: wrap;
      }

      .footer span strong {
        color: var(--text);
      }

      .pill-group {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      @media (max-width: 768px) {
        h1 {
          font-size: 22px;
        }
        .shell-inner {
          padding: 14px 12px 16px;
        }
        .habits-header-row,
        .habit-row {
          grid-template-columns: minmax(0, 1.4fr) repeat(7, 1fr) 0.95fr;
        }
        .habit-name {
          font-size: 12px;
        }
        .streak-chip {
          padding-inline: 6px;
        }
      }

      @media (max-width: 580px) {
        .header {
          flex-direction: column;
        }
        .panel {
          padding: 11px 9px 10px;
        }
        .habit-form {
          flex-direction: column;
          align-items: stretch;
        }
        .input,
        .input-small {
          flex: 1 1 auto;
          width: 100%;
        }
        .panel-actions {
          width: 100%;
          justify-content: flex-end;
        }
        .habits-header-row,
        .habit-row {
          grid-template-columns: minmax(0, 1.6fr) repeat(7, 1fr);
        }
        .habit-row .streak-chip {
          display: none;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          scroll-behavior: auto !important;
          animation: none !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>
  <body>
    <main class="page">
      <div class="shell">
        <div class="shell-inner">
          <header class="header">
            <div class="title-block">
              <div class="eyebrow">
                <span class="eyebrow-dot"></span>
                Micro Habit System
              </div>
              <h1>
                Micro Habit Tracker
                <span class="sparkle" aria-hidden="true">
                  <span class="sparkle-inner"></span>
                </span>
              </h1>
              <p class="subtitle">
                Design your tiny wins, check in once a day, and watch your streaks glow.
              </p>
            </div>
            <div class="summary-strip">
              <div class="summary-pill">
                <span class="summary-badge">Today</span>
                <span>
                  <strong id="summary-today-completed">0/0</strong> done
                </span>
              </div>
              <div class="summary-pill">
                <span>
                  üî•
                  <strong id="summary-longest-streak">0</strong>
                </span>
                <span>day longest streak</span>
              </div>
              <div class="summary-pill">
                <span>
                  üìà
                  <strong id="summary-consistency">0%</strong>
                </span>
                <span>weekly consistency</span>
              </div>
            </div>
          </header>

          <section class="content">
            <section class="panel" aria-label="Habits">
              <div class="panel-header">
                <div>
                  <div class="panel-title">
                    <span class="panel-title-dot"></span>
                    Habits
                  </div>
                  <p class="panel-subtitle">
                    Track up to seven small, specific daily actions.
                  </p>
                </div>
                <div class="panel-actions">
                  <button class="btn btn-ghost btn-icon-only" id="skip-day-btn" type="button">
                    <span class="icon">‚è≠</span>
                  </button>
                  <button class="btn btn-primary" id="add-habit-btn" type="button">
                    <span class="icon">Ôºã</span>
                    <span class="btn-pill-label">New habit</span>
                  </button>
                </div>
              </div>

              <form class="habit-form" id="habit-form">
                <input
                  id="habit-name-input"
                  class="input"
                  type="text"
                  maxlength="60"
                  autocomplete="off"
                  placeholder="Drink a glass of water, stretch for 2 minutes, write 3 gratitude notes..."
                />
                <input
                  id="habit-target-input"
                  class="input input-small"
                  type="number"
                  min="1"
                  max="7"
                  value="1"
                  aria-label="Target days per week"
                />
                <div class="label-pill">Target / week</div>
              </form>

              <div class="habits-header-row" aria-hidden="true">
                <span class="habits-header-label">
                  <span class="dot"></span>
                  Habit
                </span>
                <span id="dow-0">Mon</span>
                <span id="dow-1">Tue</span>
                <span id="dow-2">Wed</span>
                <span id="dow-3">Thu</span>
                <span id="dow-4">Fri</span>
                <span id="dow-5">Sat</span>
                <span id="dow-6">Sun</span>
                <span>Streak</span>
              </div>

              <div class="habits-list" id="habits-list" aria-live="polite"></div>

              <div class="empty-state" id="empty-state">
                <div class="empty-icon">‚ú®</div>
                <div>
                  Create a tiny habit that takes less than
                  <span class="empty-highlight">2 minutes</span>.
                  Start with one, then layer more once it feels automatic.
                </div>
              </div>
            </section>

            <section class="right-panel" aria-label="Overview and data">
              <section class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">
                      <span class="panel-title-dot"></span>
                      Today
                    </div>
                    <p class="panel-subtitle">
                      Check in once a day, no guilt ‚Äî just data.
                    </p>
                  </div>
                </div>

                <div class="day-strip">
                  <div class="day-pill">
                    <span>üìÖ</span>
                    <span id="today-label">Today</span>
                  </div>
                  <div class="day-pill">
                    <span>üåì</span>
                    <span id="current-streak-summary">0 active streaks</span>
                  </div>
                  <div class="today-heat" id="today-heat">FRESH START</div>
                </div>

                <div class="chart-card" aria-label="Weekly activity chart">
                  <div class="chart-title-row">
                    <div class="chart-title">
                      <span>Weekly heatmap</span>
                    </div>
                    <div class="chart-kpi">
                      <strong id="chart-total">0</strong> check-ins this week
                    </div>
                  </div>
                  <div class="chart-grid" id="weekly-chart"></div>
                  <div class="chart-footnote">
                    <span>Each bar shows completed habits per day.</span>
                    <span id="chart-footnote-meta">You‚Äôre just getting started.</span>
                  </div>
                </div>
              </section>

              <section class="export-card" aria-label="Export and import">
                <div class="export-header">
                  <div class="export-title">
                    <span class="export-title-icon"></span>
                    Data
                  </div>
                  <div class="pill-group">
                    <button class="btn btn-ghost" id="export-btn" type="button">
                      <span class="icon">‚¨á</span>
                      Export
                    </button>
                    <button class="btn btn-ghost" id="import-btn" type="button">
                      <span class="icon">‚¨Ü</span>
                      Import
                    </button>
                  </div>
                </div>
                <div class="export-body">
                  <textarea
                    id="export-input"
                    class="export-input"
                    placeholder='Copy your data here to save it or paste JSON to import (we&apos;ll validate it for you).'
                  ></textarea>
                  <div class="export-footer">
                    <div class="status-badge" id="status-badge">
                      <span class="status-dot" id="status-dot"></span>
                      <span id="status-text">Local autosave enabled</span>
                    </div>
                    <span id="data-meta">Demo data loaded ¬∑ v1</span>
                  </div>
                </div>
              </section>
            </section>
          </section>

          <footer class="footer">
            <span>
              Designed for
              <strong>one calm check-in a day</strong>.
            </span>
            <span id="footer-hint">
              Tip: Tap a day repeatedly to toggle
              <strong>done ‚Üí skip ‚Üí clear</strong>.
            </span>
          </footer>
        </div>
      </div>
    </main>

    <script>
      (function () {
        "use strict";

        const STORAGE_KEY = "micro-habit-tracker-v1";

        /**
         * Data model
         * ----------
         * {
         *   habits: [{
         *     id: string,
         *     name: string,
         *     colorIndex: number,
         *     targetPerWeek: number,
         *   }],
         *   days: {
         *     "YYYY-MM-DD": {
         *        skipAll: boolean,
         *        entries: {
         *          [habitId]: "done" | "skip" | "miss"
         *        }
         *     }
         *   },
         *   createdAt: string
         * }
         */

        const COLOR_GRADIENTS = [
          ["#f97316", "#facc15"],
          ["#22c55e", "#a3e635"],
          ["#38bdf8", "#0ea5e9"],
          ["#a855f7", "#ec4899"],
          ["#f97316", "#22c55e"],
          ["#e11d48", "#fb923c"],
          ["#0ea5e9", "#22c55e"],
        ];

        const habitsListEl = document.getElementById("habits-list");
        const emptyStateEl = document.getElementById("empty-state");
        const habitFormEl = document.getElementById("habit-form");
        const habitNameInput = document.getElementById("habit-name-input");
        const habitTargetInput = document.getElementById("habit-target-input");
        const addHabitBtn = document.getElementById("add-habit-btn");
        const skipDayBtn = document.getElementById("skip-day-btn");
        const todayLabelEl = document.getElementById("today-label");
        const todayHeatEl = document.getElementById("today-heat");
        const currentStreakSummaryEl = document.getElementById("current-streak-summary");
        const weeklyChartEl = document.getElementById("weekly-chart");
        const chartTotalEl = document.getElementById("chart-total");
        const chartFootnoteMetaEl = document.getElementById("chart-footnote-meta");
        const exportInput = document.getElementById("export-input");
        const exportBtn = document.getElementById("export-btn");
        const importBtn = document.getElementById("import-btn");
        const statusTextEl = document.getElementById("status-text");
        const statusDotEl = document.getElementById("status-dot");
        const dataMetaEl = document.getElementById("data-meta");
        const summaryTodayCompletedEl = document.getElementById("summary-today-completed");
        const summaryLongestStreakEl = document.getElementById("summary-longest-streak");
        const summaryConsistencyEl = document.getElementById("summary-consistency");

        function formatDateISO(date) {
          return date.toISOString().slice(0, 10);
        }

        function parseDateISO(iso) {
          const [y, m, d] = iso.split("-").map(Number);
          return new Date(y, m - 1, d);
        }

        function getTodayLocal() {
          const now = new Date();
          return new Date(now.getFullYear(), now.getMonth(), now.getDate());
        }

        function dayKey(date) {
          return formatDateISO(date);
        }

        function getDayOfWeekLabel(date) {
          return date.toLocaleDateString(undefined, {
            weekday: "short",
          });
        }

        function getNiceDateLabel(date) {
          return date.toLocaleDateString(undefined, {
            weekday: "long",
            month: "short",
            day: "numeric",
          });
        }

        function clamp(value, min, max) {
          return Math.min(max, Math.max(min, value));
        }

        function deepClone(obj) {
          return JSON.parse(JSON.stringify(obj));
        }

        function loadState() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) {
              const demo = createDemoState();
              saveState(demo, false);
              return demo;
            }
            const parsed = JSON.parse(raw);
            if (!parsed || typeof parsed !== "object") throw new Error("Invalid data");
            if (!Array.isArray(parsed.habits) || typeof parsed.days !== "object") {
              throw new Error("Bad shape");
            }
            return parsed;
          } catch (e) {
            console.warn("Failed to load state, falling back to demo data:", e);
            const demo = createDemoState();
            saveState(demo, false);
            return demo;
          }
        }

        function saveState(state, updateExport = true) {
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            if (updateExport) {
              exportInput.value = JSON.stringify(state, null, 2);
              setStatus("Saved", false);
            }
          } catch (e) {
            console.warn("Failed to save state:", e);
            setStatus("Storage is not available", true);
          }
        }

        function setStatus(message, isError) {
          statusTextEl.textContent = message;
          if (isError) {
            statusDotEl.classList.add("error");
          } else {
            statusDotEl.classList.remove("error");
          }
        }

        function createDemoState() {
          const today = getTodayLocal();
          const days = {};
          const h1 = {
            id: "h1",
            name: "Morning water",
            colorIndex: 0,
            targetPerWeek: 7,
          };
          const h2 = {
            id: "h2",
            name: "10-minute walk",
            colorIndex: 2,
            targetPerWeek: 5,
          };
          const h3 = {
            id: "h3",
            name: "Evening journal line",
            colorIndex: 3,
            targetPerWeek: 4,
          };
          const habits = [h1, h2, h3];

          for (let i = 3; i >= 0; i--) {
            const d = new Date(today);
            d.setDate(d.getDate() - i);
            const key = dayKey(d);
            const entries = {};
            if (i === 3) {
              entries[h1.id] = "done";
              entries[h2.id] = "done";
            } else if (i === 2) {
              entries[h1.id] = "done";
              entries[h2.id] = "skip";
              entries[h3.id] = "done";
            } else if (i === 1) {
              entries[h1.id] = "done";
              entries[h2.id] = "done";
              entries[h3.id] = "done";
            } else if (i === 0) {
              entries[h1.id] = "done";
            }
            days[key] = {
              skipAll: false,
              entries,
            };
          }

          return {
            habits,
            days,
            createdAt: formatDateISO(today),
          };
        }

        let state = loadState();

        function ensureTodayExists() {
          const today = getTodayLocal();
          const key = dayKey(today);
          if (!state.days[key]) {
            state.days[key] = {
              skipAll: false,
              entries: {},
            };
          }
        }

        function cycleEntryState(day, habitId) {
          ensureTodayExists();
          const dayEntry = state.days[day];
          if (!dayEntry.entries) dayEntry.entries = {};
          const current = dayEntry.entries[habitId] || "miss";
          let next;
          if (current === "miss") {
            next = "done";
          } else if (current === "done") {
            next = "skip";
          } else {
            next = "miss";
          }
          if (next === "miss") {
            delete dayEntry.entries[habitId];
          } else {
            dayEntry.entries[habitId] = next;
          }
          dayEntry.skipAll = false;
        }

        function setSkipAllToday() {
          const todayKey = dayKey(getTodayLocal());
          ensureTodayExists();
          const dayEntry = state.days[todayKey];
          const hasAnyDone =
            dayEntry.entries &&
            Object.values(dayEntry.entries).some((v) => v === "done");
          if (hasAnyDone) {
            return false;
          }
          dayEntry.skipAll = !dayEntry.skipAll;
          if (dayEntry.skipAll) {
            dayEntry.entries = {};
          }
          return dayEntry.skipAll;
        }

        function computeStreakForHabit(habitId, daysMap, maxDaysBack = 365) {
          const today = getTodayLocal();
          let streak = 0;
          for (let offset = 0; offset < maxDaysBack; offset++) {
            const d = new Date(today);
            d.setDate(d.getDate() - offset);
            const k = dayKey(d);
            const dayEntry = daysMap[k];
            let isDone = false;
            if (dayEntry) {
              if (dayEntry.skipAll) {
                isDone = true;
              } else if (
                dayEntry.entries &&
                (dayEntry.entries[habitId] === "done" ||
                  dayEntry.entries[habitId] === "skip")
              ) {
                isDone = true;
              }
            }
            if (isDone) {
              streak += 1;
            } else {
              if (offset > 0) break;
            }
          }
          return streak;
        }

        function computeLongestStreak() {
          let longest = 0;
          for (const habit of state.habits) {
            const s = computeStreakForHabit(habit.id, state.days);
            if (s > longest) longest = s;
          }
          return longest;
        }

        function computeWeeklyStats() {
          const today = getTodayLocal();
          const labels = [];
          const counts = [];
          let total = 0;
          const habitCount = state.habits.length || 1;

          for (let i = 6; i >= 0; i--) {
            const d = new Date(today);
            d.setDate(d.getDate() - i);
            const k = dayKey(d);
            const dayEntry = state.days[k];
            let count = 0;
            if (dayEntry) {
              if (dayEntry.skipAll) {
                count = habitCount;
              } else if (dayEntry.entries) {
                for (const v of Object.values(dayEntry.entries)) {
                  if (v === "done" || v === "skip") count += 1;
                }
              }
            }
            counts.push(count);
            labels.push({
              date: d,
              key: k,
            });
            total += count;
          }

          const maxCount = Math.max(...counts, 1);
          const capacity = habitCount * 7 || 7;
          const consistency =
            habitCount > 0 ? Math.round((total / capacity) * 100) : 0;

          return {
            labels,
            counts,
            total,
            maxCount,
            consistency,
          };
        }

        function computeTodayCompletion() {
          const todayKey = dayKey(getTodayLocal());
          const dayEntry = state.days[todayKey];
          const habitCount = state.habits.length;
          if (!dayEntry || habitCount === 0) return { done: 0, total: habitCount };
          if (dayEntry.skipAll) {
            return { done: habitCount, total: habitCount };
          }
          let done = 0;
          for (const habit of state.habits) {
            if (!dayEntry.entries) continue;
            const v = dayEntry.entries[habit.id];
            if (v === "done" || v === "skip") done++;
          }
          return { done, total: habitCount };
        }

        function renderWeeklyChart() {
          weeklyChartEl.innerHTML = "";
          const stats = computeWeeklyStats();
          chartTotalEl.textContent = stats.total.toString();
          summaryConsistencyEl.textContent = stats.consistency + "%";

          let feel;
          if (stats.consistency === 0) {
            feel = "You‚Äôre just getting started.";
          } else if (stats.consistency < 35) {
            feel = "Tiny is enough ‚Äî just keep touching it.";
          } else if (stats.consistency < 70) {
            feel = "Momentum is building. Stay curious, not perfect.";
          } else {
            feel = "Beautiful consistency. Protect the streak, not the number.";
          }
          chartFootnoteMetaEl.textContent = feel;

          const habitCount = state.habits.length || 1;
          const maxPerDay = habitCount;

          stats.labels.forEach((label, idx) => {
            const barContainer = document.createElement("div");
            barContainer.style.display = "flex";
            barContainer.style.flexDirection = "column";
            barContainer.style.alignItems = "stretch";

            const bar = document.createElement("div");
            bar.className = "chart-bar";
            const percentage = stats.counts[idx] / Math.max(maxPerDay, 1);
            const height = 20 + 70 * percentage;
            bar.style.height = height + "%";

            if (stats.counts[idx] === 0) {
              bar.classList.add("muted");
            }

            const barInner = document.createElement("div");
            barInner.className = "chart-bar-inner";
            bar.appendChild(barInner);

            const labelEl = document.createElement("div");
            labelEl.className = "chart-bar-label";
            const short = getDayOfWeekLabel(label.date);
            labelEl.innerHTML =
              "<strong>" +
              short +
              "</strong>" +
              '<span style="opacity:0.85;">' +
              stats.counts[idx] +
              "</span>";

            barContainer.appendChild(bar);
            barContainer.appendChild(labelEl);
            weeklyChartEl.appendChild(barContainer);
          });
        }

        function updateDayHeader() {
          const today = getTodayLocal();
          todayLabelEl.textContent = getNiceDateLabel(today);

          const todayKey = dayKey(today);
          const dayEntry = state.days[todayKey];
          let mode = "FRESH START";
          if (dayEntry && dayEntry.skipAll) {
            mode = "RESTING DAY";
          } else {
            const completion = computeTodayCompletion();
            if (completion.total > 0) {
              const pct = Math.round(
                (completion.done / completion.total) * 100
              );
              if (pct === 0) mode = "OPEN LOOP";
              else if (pct < 50) mode = "WARMING UP";
              else if (pct < 100) mode = "GLOWING";
              else mode = "FULLY LIT";
            }
          }
          todayHeatEl.textContent = mode;

          const { done, total } = computeTodayCompletion();
          summaryTodayCompletedEl.textContent = done + "/" + total;
        }

        function updateStreakSummary() {
          let active = 0;
          let longest = 0;
          for (const habit of state.habits) {
            const streak = computeStreakForHabit(habit.id, state.days);
            if (streak > 0) active++;
            if (streak > longest) longest = streak;
          }
          currentStreakSummaryEl.textContent =
            active === 1
              ? "1 active streak"
              : active + " active streaks";
          summaryLongestStreakEl.textContent = longest.toString();
        }

        function updateDayOfWeekHeader() {
          const today = getTodayLocal();
          const mondayIndex = (today.getDay() + 6) % 7;
          for (let i = 0; i < 7; i++) {
            const offset = i - mondayIndex;
            const d = new Date(today);
            d.setDate(d.getDate() + offset);
            const label = getDayOfWeekLabel(d);
            const el = document.getElementById("dow-" + i);
            if (el) {
              el.textContent = label;
            }
          }
        }

        function renderHabits() {
          habitsListEl.innerHTML = "";

          if (!state.habits.length) {
            emptyStateEl.style.display = "flex";
          } else {
            emptyStateEl.style.display = "none";
          }

          const today = getTodayLocal();
          const todayKey = dayKey(today);

          const heatData = {};
          for (const habit of state.habits) {
            heatData[habit.id] = computeStreakForHabit(habit.id, state.days, 30);
          }
          const maxHeat = Math.max(...Object.values(heatData), 0);

          state.habits.forEach((habit, habitIndex) => {
            const row = document.createElement("div");
            row.className = "habit-row";
            const streakHeat = heatData[habit.id] || 0;
            if (maxHeat > 0 && streakHeat > 0 && streakHeat === maxHeat) {
              row.dataset.heat = "high";
            }

            const colorPair =
              COLOR_GRADIENTS[habit.colorIndex % COLOR_GRADIENTS.length];

            const label = document.createElement("div");
            label.className = "habit-label";

            const color = document.createElement("div");
            color.className = "habit-color";
            color.style.background =
              "linear-gradient(180deg, " + colorPair[0] + ", " + colorPair[1] + ")";
            label.appendChild(color);

            const textWrap = document.createElement("div");
            textWrap.style.display = "flex";
            textWrap.style.flexDirection = "column";
            textWrap.style.gap = "1px";
            textWrap.style.minWidth = "0";

            const name = document.createElement("div");
            name.className = "habit-name";
            name.textContent = habit.name;
            textWrap.appendChild(name);

            const meta = document.createElement("div");
            meta.className = "habit-meta";
            meta.textContent =
              "Target ¬∑ " +
              habit.targetPerWeek +
              "/week ¬∑ #" +
              (habitIndex + 1);
            textWrap.appendChild(meta);

            label.appendChild(textWrap);
            row.appendChild(label);

            for (let i = 0; i < 7; i++) {
              const cellDate = new Date(today);
              cellDate.setDate(today.getDate() - (6 - i));
              const key = dayKey(cellDate);
              const dayEntry = state.days[key];
              const cell = document.createElement("div");
              cell.className = "habit-check-cell";

              const pill = document.createElement("button");
              pill.type = "button";
              pill.className = "check-pill";

              let stateLabel = "miss";
              if (dayEntry) {
                if (dayEntry.skipAll) {
                  stateLabel = "skip";
                } else if (
                  dayEntry.entries &&
                  (dayEntry.entries[habit.id] === "done" ||
                    dayEntry.entries[habit.id] === "skip")
                ) {
                  stateLabel = dayEntry.entries[habit.id];
                }
              }

              pill.dataset.state = stateLabel;
              pill.setAttribute("aria-label", habit.name + " on " + getNiceDateLabel(cellDate));

              if (stateLabel === "done") {
                pill.textContent = "‚úì";
              } else if (stateLabel === "skip") {
                pill.textContent = "¬∑";
              } else {
                pill.textContent = "";
              }

              if (key === todayKey) {
                pill.addEventListener("click", function () {
                  cycleEntryState(todayKey, habit.id);
                  saveState(state);
                  renderAll();
                });
              } else {
                pill.disabled = true;
                pill.classList.add("disabled");
              }

              cell.appendChild(pill);
              row.appendChild(cell);
            }

            const streakCell = document.createElement("div");
            streakCell.style.display = "flex";
            streakCell.style.alignItems = "center";
            streakCell.style.justifyContent = "center";

            const streakChip = document.createElement("button");
            streakChip.type = "button";
            streakChip.className = "streak-chip";
            streakChip.setAttribute(
              "aria-label",
              "Edit " + habit.name + " (tap to rename or change target)"
            );
            const dot = document.createElement("span");
            dot.className = "streak-dot";
            streakChip.appendChild(dot);
            const textWrap2 = document.createElement("span");
            textWrap2.style.display = "flex";
            textWrap2.style.flexDirection = "column";
            textWrap2.style.alignItems = "flex-start";
            textWrap2.style.gap = "0";
            const labelSpan = document.createElement("span");
            labelSpan.className = "streak-label";
            const streakValue = computeStreakForHabit(habit.id, state.days);
            labelSpan.textContent = "Streak";
            const valueSpan = document.createElement("span");
            valueSpan.className = "streak-value";
            valueSpan.textContent = streakValue + "d";
            textWrap2.appendChild(labelSpan);
            textWrap2.appendChild(valueSpan);
            streakChip.appendChild(textWrap2);

            streakChip.addEventListener("click", function () {
              openHabitEditPrompt(habit);
            });

            streakCell.appendChild(streakChip);
            row.appendChild(streakCell);

            habitsListEl.appendChild(row);
          });
        }

        function openHabitEditPrompt(habit) {
          const name = prompt("Rename habit:", habit.name);
          if (name === null) return;
          const trimmed = name.trim();
          if (!trimmed) return;

          let target = prompt(
            "Target days per week (1-7):",
            String(habit.targetPerWeek || 7)
          );
          if (target === null) {
            habit.name = trimmed;
            saveState(state);
            renderAll();
            return;
          }
          target = parseInt(target, 10);
          if (Number.isNaN(target)) {
            target = habit.targetPerWeek || 7;
          }
          target = clamp(target, 1, 7);

          habit.name = trimmed;
          habit.targetPerWeek = target;
          saveState(state);
          renderAll();
        }

        function handleAddHabit() {
          const rawName = habitNameInput.value.trim();
          if (!rawName) {
            habitNameInput.focus();
            return;
          }
          if (state.habits.length >= 7) {
            alert("This demo is limited to 7 habits. Try editing or deleting one.");
            return;
          }

          let target = parseInt(habitTargetInput.value, 10);
          if (Number.isNaN(target)) target = 7;
          target = clamp(target, 1, 7);

          const newHabit = {
            id: "h" + Date.now().toString(36) + Math.random().toString(16).slice(2, 6),
            name: rawName,
            colorIndex: state.habits.length,
            targetPerWeek: target,
          };

          state.habits.push(newHabit);
          habitNameInput.value = "";
          habitTargetInput.value = String(target);
          saveState(state);
          renderAll();

          if (habitNameInput) {
            habitNameInput.focus();
          }
        }

        function handleImport() {
          const text = exportInput.value.trim();
          if (!text) return;
          let parsed;
          try {
            parsed = JSON.parse(text);
          } catch (e) {
            setStatus("Import failed: invalid JSON", true);
            return;
          }
          if (
            !parsed ||
            typeof parsed !== "object" ||
            !Array.isArray(parsed.habits) ||
            typeof parsed.days !== "object"
          ) {
            setStatus("Import failed: missing habits/days", true);
            return;
          }
          const safe = {
            habits: [],
            days: {},
            createdAt: parsed.createdAt || formatDateISO(getTodayLocal()),
          };

          if (Array.isArray(parsed.habits)) {
            parsed.habits.slice(0, 7).forEach((h, idx) => {
              if (!h || typeof h !== "object") return;
              if (!h.id || !h.name) return;
              safe.habits.push({
                id: String(h.id),
                name: String(h.name).slice(0, 80),
                colorIndex: typeof h.colorIndex === "number" ? h.colorIndex : idx,
                targetPerWeek:
                  typeof h.targetPerWeek === "number"
                    ? clamp(Math.round(h.targetPerWeek), 1, 7)
                    : 7,
              });
            });
          }

          if (parsed.days && typeof parsed.days === "object") {
            const today = getTodayLocal();
            const earliest = new Date(today);
            earliest.setDate(today.getDate() - 365);
            for (const [k, v] of Object.entries(parsed.days)) {
              if (typeof k !== "string") continue;
              const d = parseDateISO(k);
              if (Number.isNaN(d.getTime())) continue;
              if (d < earliest) continue;
              if (!v || typeof v !== "object") continue;
              const entry = {
                skipAll: Boolean(v.skipAll),
                entries: {},
              };
              if (v.entries && typeof v.entries === "object") {
                Object.entries(v.entries).forEach(([id, val]) => {
                  if (["done", "skip", "miss"].includes(val)) {
                    if (val !== "miss") {
                      entry.entries[id] = val;
                    }
                  }
                });
              }
              safe.days[k] = entry;
            }
          }

          state = safe;
          saveState(state);
          renderAll();
          setStatus("Imported successfully", false);
          dataMetaEl.textContent = "Imported ¬∑ " + new Date().toLocaleTimeString();
        }

        function handleExport() {
          exportInput.focus();
          exportInput.select();
          try {
            document.execCommand("copy");
            setStatus("Copied to clipboard", false);
          } catch (e) {
            setStatus("Select + copy to save snapshot", false);
          }
          dataMetaEl.textContent = "Snapshot ¬∑ " + new Date().toLocaleTimeString();
        }

        function wireKeyboardShortcuts() {
          habitFormEl.addEventListener("submit", function (e) {
            e.preventDefault();
            handleAddHabit();
          });

          habitNameInput.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
              e.preventDefault();
              handleAddHabit();
            }
          });
        }

        function wireButtons() {
          addHabitBtn.addEventListener("click", function () {
            handleAddHabit();
          });

          skipDayBtn.addEventListener("click", function () {
            const nowSkip = setSkipAllToday();
            saveState(state);
            renderAll();
            if (nowSkip) {
              setStatus("Today marked as a gentle skip day", false);
            } else {
              setStatus("Skip day cleared for today", false);
            }
          });

          exportBtn.addEventListener("click", handleExport);
          importBtn.addEventListener("click", handleImport);

          exportInput.addEventListener("input", function () {
            setStatus("Ready to import (Export stays unchanged)", false);
          });
        }

        function renderAll() {
          ensureTodayExists();
          renderHabits();
          updateDayHeader();
          updateStreakSummary();
          renderWeeklyChart();

          exportInput.value = JSON.stringify(state, null, 2);
        }

        function deleteAllDataIfRequested() {
          if (window.location.hash === "#reset") {
            try {
              localStorage.removeItem(STORAGE_KEY);
            } catch (e) {}
            state = createDemoState();
            saveState(state);
          }
        }

        function init() {
          deleteAllDataIfRequested();
          updateDayOfWeekHeader();
          wireKeyboardShortcuts();
          wireButtons();
          renderAll();

          dataMetaEl.textContent = "Demo data loaded ¬∑ " + new Date().toLocaleDateString();
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", init);
        } else {
          init();
        }
      })();
    </script>
  </body>
</html>

