<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Falling Fruit Catcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light;
      --bg-gradient: radial-gradient(circle at top, #ffeaa7 0%, #fab1a0 30%, #ff7675 65%, #6c5ce7 100%);
      --panel-bg: rgba(255, 255, 255, 0.16);
      --panel-border: rgba(255, 255, 255, 0.5);
      --accent: #ffca3a;
      --accent-strong: #ff9f1c;
      --text-strong: #ffffff;
      --text-soft: rgba(255, 255, 255, 0.9);
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.28);
      --shadow-subtle: 0 10px 25px rgba(0, 0, 0, 0.18);
      --danger: #ff4757;
      --success: #2ed573;
    }

    * {
      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    html,
    body {
      width: 100%;
      height: 100%;
    }

    body {
      font-family: "Baloo 2", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-image: var(--bg-gradient);
      background-attachment: fixed;
      background-size: cover;
      color: var(--text-strong);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      -webkit-font-smoothing: antialiased;
    }

    .app {
      width: 100%;
      max-width: 960px;
      border-radius: 28px;
      padding: 20px 18px 22px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.05));
      border: 1px solid rgba(255, 255, 255, 0.35);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(16px) saturate(140%);
    }

    .hud {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px 18px;
      padding: 0 6px 6px;
    }

    .title-block {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .title-icon {
      width: 44px;
      height: 44px;
      border-radius: 16px;
      background: radial-gradient(circle at 30% 20%, #ffeaa7, #fd79a8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: var(--shadow-subtle);
    }

    .title-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .title-text-main {
      font-size: 1.5rem;
      letter-spacing: 0.03em;
      font-weight: 700;
      text-shadow: 0 3px 8px rgba(0, 0, 0, 0.35);
    }

    .title-text-sub {
      font-size: 0.82rem;
      opacity: 0.92;
    }

    .scoreboard {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 0.98rem;
      white-space: nowrap;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.18);
      border: 1px solid rgba(255, 255, 255, 0.32);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.22);
    }

    .chip-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      opacity: 0.82;
    }

    .chip-value {
      font-size: 1.05rem;
      font-weight: 700;
    }

    .chip-value-strong {
      color: var(--accent);
    }

    .chip-value-danger {
      color: var(--danger);
    }

    .chip-value-soft {
      font-size: 1rem;
    }

    .badge {
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.4);
      font-size: 0.72rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 8px rgba(46, 213, 115, 0.9);
    }

    .game-wrapper {
      margin-top: 16px;
      position: relative;
      border-radius: 24px;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
    }

    canvas {
      display: block;
      width: 100%;
      height: auto;
      max-height: min(72vh, 580px);
      background: radial-gradient(circle at 20% 0, #ffeaa7 0%, #81ecec 40%, #74b9ff 80%, #55efc4 100%);
      border-radius: 24px;
    }

    .overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(15, 15, 43, 0.75), rgba(15, 15, 43, 0.88));
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease-out;
    }

    .overlay-visible {
      opacity: 1;
      pointer-events: auto;
    }

    .overlay-card {
      min-width: min(360px, 94%);
      max-width: 420px;
      padding: 18px 18px 18px;
      border-radius: 20px;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.06));
      border: 1px solid rgba(255, 255, 255, 0.5);
      box-shadow: var(--shadow-soft);
      text-align: center;
      transform: translateY(10px) scale(0.98);
      transition: transform 260ms ease-out;
    }

    .overlay-visible .overlay-card {
      transform: translateY(0) scale(1);
    }

    .overlay-title {
      font-size: 1.45rem;
      margin-bottom: 4px;
    }

    .overlay-subtitle {
      font-size: 0.92rem;
      opacity: 0.9;
      margin-bottom: 12px;
    }

    .overlay-message {
      font-size: 0.9rem;
      opacity: 0.94;
      margin-bottom: 14px;
    }

    .overlay-highlight {
      font-weight: 600;
      color: var(--accent);
    }

    .overlay-score-line {
      margin-top: 4px;
      font-size: 0.92rem;
    }

    .overlay-score-label {
      opacity: 0.78;
      margin-right: 4px;
    }

    .overlay-score-value {
      font-weight: 700;
      color: var(--accent);
      font-size: 1.05rem;
    }

    .overlay-score-best {
      font-size: 0.85rem;
      opacity: 0.9;
      margin-top: 4px;
    }

    .primary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 10px;
      padding: 8px 20px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 700;
      color: #3a1a00;
      background: radial-gradient(circle at 20% 0, #ffeaa7 0%, #ffca3a 40%, #ff9f1c 100%);
      box-shadow: 0 12px 30px rgba(255, 159, 28, 0.55);
      transform: translateY(0);
      transition: transform 120ms ease-out, box-shadow 120ms ease-out, filter 120ms ease-out;
    }

    .primary-button:focus-visible {
      outline: 3px solid rgba(255, 255, 255, 0.85);
      outline-offset: 3px;
    }

    .primary-button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 8px 18px rgba(255, 159, 28, 0.55);
      filter: brightness(0.96);
    }

    .primary-button-icon {
      font-size: 1.2rem;
    }

    .footer {
      margin-top: 10px;
      padding: 0 6px 2px;
      font-size: 0.82rem;
      opacity: 0.9;
      display: flex;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }

    .footer span {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .footer-key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 20px;
      padding: 2px 6px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.75);
      background: rgba(0, 0, 0, 0.3);
      font-size: 0.76rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
    }

    .pulse-score {
      animation: pulseScore 380ms ease-out;
    }

    @keyframes pulseScore {
      0% {
        transform: scale(1);
      }
      40% {
        transform: scale(1.16);
      }
      100% {
        transform: scale(1);
      }
    }

    @media (max-width: 720px) {
      .app {
        padding: 16px 12px 14px;
        border-radius: 22px;
      }
      .title-text-main {
        font-size: 1.3rem;
      }
      .scoreboard {
        flex: 1;
        justify-content: flex-end;
      }
      .chip-label {
        display: none;
      }
      .chip {
        padding-inline: 10px;
      }
    }

    @media (max-width: 520px) {
      body {
        padding: 10px;
      }
      .hud {
        align-items: flex-start;
      }
      .scoreboard {
        width: 100%;
        justify-content: space-between;
      }
      .overlay-card {
        padding-inline: 16px;
      }
      .footer {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="hud">
      <div class="title-block">
        <div class="title-icon">üçì</div>
        <div class="title-text">
          <div class="title-text-main">Falling Fruit Catcher</div>
          <div class="title-text-sub">Catch the happy fruits before they splat!</div>
        </div>
      </div>
      <div class="scoreboard">
        <div class="chip" aria-live="polite">
          <span class="chip-label">Score</span>
          <span class="chip-value chip-value-strong" id="scoreValue">0</span>
        </div>
        <div class="chip" aria-live="polite">
          <span class="chip-label">Misses</span>
          <span class="chip-value chip-value-danger chip-value-soft" id="missesValue">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        </div>
        <span class="badge">
          <span class="badge-dot"></span>
          Kid mode
        </span>
      </div>
    </header>
    <main class="game-wrapper">
      <canvas id="gameCanvas" width="900" height="540" role="img" aria-label="Colorful fruits falling into a basket"></canvas>
      <div class="overlay overlay-visible" id="overlay">
        <div class="overlay-card">
          <h2 class="overlay-title" id="overlayTitle">Ready to catch?</h2>
          <p class="overlay-subtitle" id="overlaySubtitle">Move the basket and catch the fruits before they hit the ground.</p>
          <p class="overlay-message">
            Use
            <span class="overlay-highlight">arrow keys</span>
            or
            <span class="overlay-highlight">move / tap</span>
            inside the game. Missing
            <span class="overlay-highlight">3 fruits</span>
            ends the game.
          </p>
          <p class="overlay-score-line" id="overlayScoreLine" hidden>
            <span class="overlay-score-label">Your score</span>
            <span class="overlay-score-value" id="overlayScoreValue">0</span>
          </p>
          <p class="overlay-score-best" id="overlayBestLine" hidden></p>
          <button class="primary-button" id="startButton" type="button">
            <span class="primary-button-icon">‚ñ∂</span>
            <span id="startButtonLabel">Start</span>
          </button>
        </div>
      </div>
    </main>
    <footer class="footer">
      <span><span class="footer-key">‚Üê</span><span class="footer-key">‚Üí</span> Move basket</span>
      <span><span class="footer-key">Space</span> or click &ldquo;Start&rdquo; to play</span>
      <span>Best with sound on and full screen</span>
    </footer>
  </div>
  <script>
    (function () {
      var canvas = document.getElementById("gameCanvas");
      var ctx = canvas.getContext("2d");
      var overlay = document.getElementById("overlay");
      var overlayTitle = document.getElementById("overlayTitle");
      var overlaySubtitle = document.getElementById("overlaySubtitle");
      var overlayScoreLine = document.getElementById("overlayScoreLine");
      var overlayScoreValue = document.getElementById("overlayScoreValue");
      var overlayBestLine = document.getElementById("overlayBestLine");
      var startButton = document.getElementById("startButton");
      var startButtonLabel = document.getElementById("startButtonLabel");
      var scoreValue = document.getElementById("scoreValue");
      var missesValue = document.getElementById("missesValue");
      var highScoreKey = "fallingFruitHighScore";

      var maxMisses = 3;
      var basket = {
        x: canvas.width / 2,
        width: 150,
        height: 26,
        speed: 520
      };
      var keys = {
        left: false,
        right: false
      };
      var fruits = [];
      var spawnTimer = 0;
      var score = 0;
      var misses = 0;
      var gameState = "ready";
      var lastTime = 0;
      var lastScorePulseTime = 0;

      var fruitTypes = [
        {
          emoji: "üçì",
          primary: "#ff4b5c",
          highlight: "#ff9aa2",
          leaf: "#2ecc71"
        },
        {
          emoji: "üçå",
          primary: "#ffe066",
          highlight: "#fff3b0",
          leaf: "#6ab04c"
        },
        {
          emoji: "üçé",
          primary: "#ff6b6b",
          highlight: "#feca57",
          leaf: "#00b894"
        },
        {
          emoji: "üçä",
          primary: "#ff9f1a",
          highlight: "#ffd79a",
          leaf: "#27ae60"
        },
        {
          emoji: "üçá",
          primary: "#9b59b6",
          highlight: "#e056fd",
          leaf: "#16a085"
        }
      ];

      function resetGame() {
        fruits.length = 0;
        score = 0;
        misses = 0;
        spawnTimer = 0.2;
        lastTime = 0;
        updateScoreDisplay();
        updateMissesDisplay();
        basket.x = canvas.width / 2;
      }

      function updateScoreDisplay() {
        scoreValue.textContent = String(score);
        var now = performance.now();
        if (now - lastScorePulseTime > 100) {
          lastScorePulseTime = now;
          scoreValue.classList.remove("pulse-score");
          void scoreValue.offsetWidth;
          scoreValue.classList.add("pulse-score");
        }
      }

      function updateMissesDisplay() {
        var heartsFull = Math.max(0, maxMisses - misses);
        var heartsEmpty = Math.max(0, misses);
        var str = "";
        for (var i = 0; i < heartsFull; i++) {
          str += "‚ù§Ô∏è";
        }
        for (var j = 0; j < heartsEmpty; j++) {
          str += "ü§ç";
        }
        missesValue.textContent = str;
      }

      function randomRange(min, max) {
        return Math.random() * (max - min) + min;
      }

      function spawnFruit() {
        var typeIndex = Math.floor(Math.random() * fruitTypes.length);
        var radius = randomRange(26, 34);
        var xPadding = radius + 14;
        var x = randomRange(xPadding, canvas.width - xPadding);
        var baseSpeed = 190 + score * 2.5;
        var vy = randomRange(baseSpeed, baseSpeed + 110);
        fruits.push({
          x: x,
          y: -radius - randomRange(0, 80),
          radius: radius,
          vy: vy,
          typeIndex: typeIndex
        });
      }

      function handleInput(dt) {
        var direction = 0;
        if (keys.left) {
          direction -= 1;
        }
        if (keys.right) {
          direction += 1;
        }
        if (direction !== 0) {
          var distance = direction * basket.speed * dt;
          basket.x += distance;
        }
        var halfWidth = basket.width / 2;
        if (basket.x < halfWidth + 4) {
          basket.x = halfWidth + 4;
        } else if (basket.x > canvas.width - halfWidth - 4) {
          basket.x = canvas.width - halfWidth - 4;
        }
      }

      function update(dt) {
        handleInput(dt);
        spawnTimer -= dt;
        var minInterval = 0.35;
        var maxInterval = 1.0;
        var difficultyScale = Math.min(1, score / 40);
        var interval = maxInterval - (maxInterval - minInterval) * difficultyScale;
        if (spawnTimer <= 0) {
          spawnFruit();
          spawnTimer = interval;
        }
        for (var i = fruits.length - 1; i >= 0; i--) {
          var fruit = fruits[i];
          fruit.y += fruit.vy * dt;
          var basketY = canvas.height - basket.height - 18;
          var halfW = basket.width / 2;
          if (fruit.y + fruit.radius >= basketY - 4) {
            if (Math.abs(fruit.x - basket.x) <= fruit.radius + halfW - 6 && fruit.y - fruit.radius <= basketY + 12) {
              fruits.splice(i, 1);
              score += 1;
              updateScoreDisplay();
              continue;
            }
          }
          if (fruit.y - fruit.radius > canvas.height + 12) {
            fruits.splice(i, 1);
            misses += 1;
            updateMissesDisplay();
            if (misses >= maxMisses) {
              endGame();
              return;
            }
          }
        }
      }

      function drawBackground() {
        var gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        gradient.addColorStop(0, "#a8e6ff");
        gradient.addColorStop(0.4, "#81ecec");
        gradient.addColorStop(0.7, "#55efc4");
        gradient.addColorStop(1, "#00b894");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        var stripeHeight = 30;
        ctx.fillStyle = "rgba(255,255,255,0.35)";
        for (var i = 0; i < 6; i++) {
          var y = 50 + i * 72;
          ctx.globalAlpha = 0.2;
          ctx.beginPath();
          ctx.roundRect(30, y, canvas.width - 60, stripeHeight, 18);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        var cloudY = 70;
        ctx.fillStyle = "rgba(255,255,255,0.9)";
        for (var c = 0; c < 3; c++) {
          var baseX = 120 + c * 230;
          ctx.beginPath();
          ctx.arc(baseX, cloudY, 22, 0, Math.PI * 2);
          ctx.arc(baseX + 22, cloudY + 5, 20, 0, Math.PI * 2);
          ctx.arc(baseX - 20, cloudY + 8, 18, 0, Math.PI * 2);
          ctx.fill();
        }
        var groundHeight = 60;
        var groundY = canvas.height - groundHeight;
        var groundGradient = ctx.createLinearGradient(0, groundY, 0, canvas.height);
        groundGradient.addColorStop(0, "#00b894");
        groundGradient.addColorStop(1, "#009b75");
        ctx.fillStyle = groundGradient;
        ctx.fillRect(0, groundY, canvas.width, groundHeight);
        ctx.fillStyle = "rgba(0,0,0,0.12)";
        for (var g = 0; g < 22; g++) {
          var tileX = (g * 52 + 12) % (canvas.width + 104) - 52;
          ctx.beginPath();
          ctx.roundRect(tileX, groundY + 18, 70, 18, 8);
          ctx.fill();
        }
      }

      function drawBasket() {
        var y = canvas.height - basket.height - 18;
        var halfWidth = basket.width / 2;
        var x = basket.x - halfWidth;
        var radius = 16;
        var gradient = ctx.createLinearGradient(x, y, x, y + basket.height + 16);
        gradient.addColorStop(0, "#ffb347");
        gradient.addColorStop(1, "#ff7e5f");
        ctx.fillStyle = gradient;
        ctx.strokeStyle = "rgba(0,0,0,0.25)";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.roundRect(x, y, basket.width, basket.height + 16, radius);
        ctx.fill();
        ctx.stroke();
        ctx.fillStyle = "rgba(255,255,255,0.28)";
        for (var i = 0; i < 4; i++) {
          var stripeX = x + 10 + i * (basket.width / 4);
          ctx.beginPath();
          ctx.roundRect(stripeX, y + 4, basket.width / 6, basket.height + 10, 8);
          ctx.fill();
        }
        var rimHeight = 10;
        ctx.fillStyle = "rgba(255,255,255,0.9)";
        ctx.beginPath();
        ctx.roundRect(x - 4, y - rimHeight, basket.width + 8, rimHeight, 10);
        ctx.fill();
        ctx.fillStyle = "rgba(0,0,0,0.08)";
        ctx.beginPath();
        ctx.roundRect(x - 4, y - rimHeight + 7, basket.width + 8, 5, 10);
        ctx.fill();
        ctx.fillStyle = "rgba(0,0,0,0.3)";
        var shadowY = canvas.height - 12;
        ctx.beginPath();
        ctx.ellipse(basket.x, shadowY, basket.width * 0.55, 10, 0, 0, Math.PI * 2);
        ctx.fill();
      }

      function drawFruit(fruit) {
        var type = fruitTypes[fruit.typeIndex];
        var x = fruit.x;
        var y = fruit.y;
        var radius = fruit.radius;
        ctx.save();
        ctx.shadowColor = "rgba(0,0,0,0.28)";
        ctx.shadowBlur = 16;
        ctx.shadowOffsetY = 6;
        var gradient = ctx.createRadialGradient(x - radius * 0.3, y - radius * 0.4, radius * 0.2, x, y, radius);
        gradient.addColorStop(0, type.highlight);
        gradient.addColorStop(0.7, type.primary);
        gradient.addColorStop(1, "rgba(0,0,0,0.45)");
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowColor = "transparent";
        ctx.shadowBlur = 0;
        ctx.fillStyle = type.leaf;
        ctx.beginPath();
        ctx.ellipse(x - radius * 0.2, y - radius * 0.9, radius * 0.35, radius * 0.55, -0.6, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "rgba(0,0,0,0.15)";
        ctx.beginPath();
        ctx.arc(x + radius * 0.35, y + radius * 0.35, radius * 0.4, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "rgba(255,255,255,0.85)";
        ctx.beginPath();
        ctx.arc(x - radius * 0.38, y - radius * 0.38, radius * 0.22, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.font = radius * 1.3 + "px system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI Emoji'";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(type.emoji, x, y);
        ctx.restore();
      }

      function drawFruits() {
        for (var i = 0; i < fruits.length; i++) {
          drawFruit(fruits[i]);
        }
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();
        drawFruits();
        drawBasket();
        if (gameState !== "playing") {
          ctx.save();
          ctx.fillStyle = "rgba(0,0,0,0.08)";
          ctx.font = "700 52px 'Baloo 2', system-ui";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText("Catch the fruits!", canvas.width / 2, canvas.height / 2 - 80);
          ctx.restore();
        }
      }

      function loop(timestamp) {
        if (!lastTime) {
          lastTime = timestamp;
        }
        var dt = (timestamp - lastTime) / 1000;
        if (dt > 0.12) {
          dt = 0.12;
        }
        lastTime = timestamp;
        if (gameState === "playing") {
          update(dt);
        }
        draw();
        requestAnimationFrame(loop);
      }

      function setOverlayVisible(visible) {
        if (visible) {
          overlay.classList.add("overlay-visible");
        } else {
          overlay.classList.remove("overlay-visible");
        }
      }

      function startGame() {
        resetGame();
        gameState = "playing";
        overlayTitle.textContent = "Catch them all!";
        overlaySubtitle.textContent = "How many fruits can you grab in a row?";
        overlayScoreLine.hidden = true;
        overlayBestLine.hidden = true;
        startButtonLabel.textContent = "Playing";
        setOverlayVisible(false);
      }

      function endGame() {
        gameState = "ended";
        var message;
        if (score === 0) {
          message = "The fruits were sneaky this time. Try again!";
        } else if (score < 8) {
          message = "Nice start! Can you beat your score?";
        } else if (score < 18) {
          message = "Sweet catching! Keep those fruits flying!";
        } else {
          message = "Amazing reflexes! You are a fruit master!";
        }
        overlayTitle.textContent = "Game over!";
        overlaySubtitle.textContent = message;
        overlayScoreValue.textContent = String(score);
        overlayScoreLine.hidden = false;
        var best = 0;
        try {
          var stored = localStorage.getItem(highScoreKey);
          if (stored != null) {
            best = parseInt(stored, 10) || 0;
          }
          if (score > best) {
            best = score;
            localStorage.setItem(highScoreKey, String(best));
            overlayBestLine.textContent = "New best score: " + best + " üéâ";
          } else if (best > 0) {
            overlayBestLine.textContent = "Best score: " + best;
          } else {
            overlayBestLine.textContent = "";
          }
          overlayBestLine.hidden = overlayBestLine.textContent === "";
        } catch (e) {
          overlayBestLine.hidden = true;
        }
        startButtonLabel.textContent = "Play again";
        setOverlayVisible(true);
      }

      function onStartButtonClick() {
        if (gameState === "playing") {
          return;
        }
        startGame();
      }

      function onKeyDown(event) {
        var key = event.key;
        if (key === "ArrowLeft" || key === "Left") {
          keys.left = true;
        } else if (key === "ArrowRight" || key === "Right") {
          keys.right = true;
        } else if (key === " " || key === "Spacebar") {
          if (gameState !== "playing") {
            startGame();
          }
        } else if (key === "Enter") {
          if (gameState !== "playing") {
            startGame();
          }
        }
      }

      function onKeyUp(event) {
        var key = event.key;
        if (key === "ArrowLeft" || key === "Left") {
          keys.left = false;
        } else if (key === "ArrowRight" || key === "Right") {
          keys.right = false;
        }
      }

      function pointerPositionToCanvas(clientX) {
        var rect = canvas.getBoundingClientRect();
        var scaleX = canvas.width / rect.width;
        return (clientX - rect.left) * scaleX;
      }

      function onPointerMove(clientX) {
        var x = pointerPositionToCanvas(clientX);
        basket.x = x;
        var halfWidth = basket.width / 2;
        if (basket.x < halfWidth + 4) {
          basket.x = halfWidth + 4;
        } else if (basket.x > canvas.width - halfWidth - 4) {
          basket.x = canvas.width - halfWidth - 4;
        }
      }

      function onMouseMove(event) {
        if (event.buttons === 0 && gameState !== "playing") {
          return;
        }
        onPointerMove(event.clientX);
      }

      function onTouchMove(event) {
        if (!event.touches || event.touches.length === 0) {
          return;
        }
        var touch = event.touches[0];
        onPointerMove(touch.clientX);
      }

      function onCanvasClick() {
        if (gameState !== "playing") {
          startGame();
        }
      }

      function attachEvents() {
        startButton.addEventListener("click", onStartButtonClick);
        window.addEventListener("keydown", onKeyDown);
        window.addEventListener("keyup", onKeyUp);
        canvas.addEventListener("mousemove", onMouseMove);
        canvas.addEventListener("touchmove", onTouchMove, { passive: true });
        canvas.addEventListener("click", onCanvasClick);
        window.addEventListener("blur", function () {
          keys.left = false;
          keys.right = false;
        });
      }

      function init() {
        resetGame();
        try {
          var stored = localStorage.getItem(highScoreKey);
          if (stored != null) {
            var best = parseInt(stored, 10) || 0;
            if (best > 0) {
              overlayBestLine.hidden = false;
              overlayBestLine.textContent = "Best score: " + best;
            }
          }
        } catch (e) {
        }
        attachEvents();
        requestAnimationFrame(loop);
      }

      if (document.readyState === "complete" || document.readyState === "interactive") {
        init();
      } else {
        document.addEventListener("DOMContentLoaded", init);
      }
    })();
  </script>
</body>
</html>

