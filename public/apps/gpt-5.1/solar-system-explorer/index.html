<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Solar System Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Solar System Explorer – interactive 3D visualization of planets orbiting the Sun with orbit controls and planet information."
    />
    <style>
      :root {
        color-scheme: dark;
        --bg-main: radial-gradient(circle at top, #121525 0%, #050712 60%, #020309 100%);
        --panel-bg: rgba(10, 12, 24, 0.96);
        --panel-border: rgba(255, 255, 255, 0.06);
        --accent: #4fd1c5;
        --accent-soft: rgba(79, 209, 197, 0.24);
        --accent-strong: rgba(79, 209, 197, 0.7);
        --text-main: #f5f7ff;
        --text-muted: #9ca3c7;
        --danger: #f87171;
        --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.7);
        --radius-lg: 18px;
        --radius-md: 10px;
        --transition-fast: 160ms ease-out;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        color: var(--text-main);
        background: #020309;
      }

      body {
        display: flex;
        flex-direction: column;
        background-image: var(--bg-main);
        background-attachment: fixed;
        background-size: cover;
      }

      .app-root {
        display: grid;
        grid-template-columns: minmax(280px, 360px) minmax(0, 1fr);
        grid-template-rows: 1fr;
        gap: 18px;
        padding: 16px 18px 18px;
        width: 100%;
        height: 100%;
      }

      @media (max-width: 900px) {
        .app-root {
          grid-template-columns: 1fr;
          grid-template-rows: auto minmax(0, 1fr);
          padding: 10px;
        }
      }

      .panel {
        background: var(--panel-bg);
        border-radius: var(--radius-lg);
        border: 1px solid var(--panel-border);
        box-shadow: var(--shadow-soft);
        backdrop-filter: blur(20px);
        position: relative;
        overflow: hidden;
      }

      .panel::before {
        content: "";
        position: absolute;
        inset: -1px;
        border-radius: inherit;
        border: 1px solid transparent;
        background: radial-gradient(circle at top left, var(--accent-soft), transparent 55%);
        mix-blend-mode: screen;
        opacity: 0.6;
        pointer-events: none;
      }

      .info-panel {
        display: flex;
        flex-direction: column;
        padding: 18px 18px 16px;
        gap: 14px;
        z-index: 1;
      }

      .info-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .app-title {
        font-size: 1.05rem;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .title-chip {
        width: 9px;
        height: 18px;
        border-radius: 999px;
        background: linear-gradient(160deg, var(--accent), #8b5cf6);
        box-shadow: 0 0 16px rgba(79, 209, 197, 0.9);
      }

      .app-subtitle {
        font-size: 0.78rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.16em;
      }

      .hint {
        font-size: 0.75rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
      }

      .hint-key {
        padding: 1px 6px 2px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: radial-gradient(circle at top, rgba(148, 163, 184, 0.25), transparent 70%);
        font-size: 0.68rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #e5edff;
      }

      .hint-dot {
        width: 4px;
        height: 4px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.65);
      }

      .divider {
        border: none;
        border-top: 1px solid rgba(148, 163, 184, 0.25);
        margin: 2px 0 6px;
      }

      .planet-name {
        font-size: 1.4rem;
        font-weight: 600;
        letter-spacing: 0.03em;
      }

      .planet-tagline {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        margin-top: -2px;
        color: var(--accent);
      }

      .planet-description {
        font-size: 0.82rem;
        color: var(--text-muted);
        line-height: 1.5;
      }

      .planet-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
      }

      .meta-pill {
        flex: 1;
        min-width: 110px;
        padding: 7px 9px 8px;
        border-radius: var(--radius-md);
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.4));
      }

      .meta-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.11em;
        color: var(--text-muted);
        margin-bottom: 3px;
      }

      .meta-value {
        font-size: 0.88rem;
        font-weight: 500;
      }

      .controls {
        margin-top: 6px;
        padding-top: 6px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        border-top: 1px dashed rgba(148, 163, 184, 0.25);
      }

      .control-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .control-label {
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      .control-value {
        font-size: 0.82rem;
        font-variant-numeric: tabular-nums;
        color: var(--accent-strong);
      }

      .slider-wrapper {
        position: relative;
        padding: 2px 0 4px;
      }

      .slider {
        width: 100%;
        -webkit-appearance: none;
        appearance: none;
        height: 5px;
        border-radius: 999px;
        background: radial-gradient(circle at left, var(--accent-soft), rgba(15, 23, 42, 0.7));
        outline: none;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 999px;
        background: #020617;
        border: 2px solid var(--accent);
        box-shadow: 0 0 0 4px rgba(79, 209, 197, 0.25);
        cursor: pointer;
        transition: box-shadow var(--transition-fast), transform var(--transition-fast),
          background var(--transition-fast);
      }

      .slider::-webkit-slider-thumb:hover {
        box-shadow: 0 0 0 6px rgba(79, 209, 197, 0.32);
        transform: scale(1.03);
      }

      .slider::-moz-range-track {
        height: 5px;
        border-radius: 999px;
        background: radial-gradient(circle at left, var(--accent-soft), rgba(15, 23, 42, 0.7));
      }

      .slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        background: #020617;
        border: 2px solid var(--accent);
        box-shadow: 0 0 0 4px rgba(79, 209, 197, 0.25);
        cursor: pointer;
        transition: box-shadow var(--transition-fast), transform var(--transition-fast),
          background var(--transition-fast);
      }

      .slider:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      .toggle-group {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .toggle {
        position: relative;
        width: 38px;
        height: 20px;
        border-radius: 999px;
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7));
        border: 1px solid rgba(148, 163, 184, 0.5);
        flex-shrink: 0;
        cursor: pointer;
        transition: border var(--transition-fast), box-shadow var(--transition-fast),
          background var(--transition-fast);
      }

      .toggle-thumb {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 14px;
        height: 14px;
        border-radius: 999px;
        background: radial-gradient(circle at top, #e5e7eb, #9ca3af);
        box-shadow: 0 0 10px rgba(148, 163, 184, 0.8);
        transition: transform var(--transition-fast);
      }

      .toggle[data-on="true"] {
        background: radial-gradient(circle at top, rgba(56, 189, 248, 0.9), rgba(15, 23, 42, 0.9));
        border-color: rgba(56, 189, 248, 0.9);
        box-shadow: 0 0 22px rgba(59, 130, 246, 0.8);
      }

      .toggle[data-on="true"] .toggle-thumb {
        transform: translateX(16px);
      }

      .button-row {
        display: flex;
        justify-content: flex-start;
        gap: 8px;
        margin-top: 2px;
      }

      .btn {
        position: relative;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        padding: 5px 11px 6px;
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.7));
        color: var(--text-main);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        overflow: hidden;
      }

      .btn span {
        position: relative;
        z-index: 1;
      }

      .btn::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top, rgba(79, 209, 197, 0.4), transparent 60%);
        opacity: 0;
        transition: opacity var(--transition-fast);
      }

      .btn:hover::before {
        opacity: 1;
      }

      .btn[data-active="true"] {
        border-color: var(--accent);
        color: var(--accent);
      }

      .btn[data-variant="ghost"] {
        border-style: dashed;
        opacity: 0.9;
      }

      .badge {
        font-size: 0.62rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        padding: 2px 7px 3px;
        border-radius: 999px;
        border: 1px solid rgba(56, 189, 248, 0.8);
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.8));
        color: rgba(191, 219, 254, 0.98);
      }

      .planet-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
        gap: 6px;
        margin-top: 10px;
      }

      .planet-chip {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 6px 8px;
        border-radius: 999px;
        font-size: 0.68rem;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        border: 1px solid rgba(148, 163, 184, 0.5);
        color: rgba(226, 232, 240, 0.86);
        cursor: pointer;
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.8));
        transition: background var(--transition-fast), border-color var(--transition-fast),
          color var(--transition-fast), transform var(--transition-fast);
        overflow: hidden;
      }

      .planet-chip::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top, rgba(79, 209, 197, 0.4), transparent 60%);
        opacity: 0;
        transition: opacity var(--transition-fast);
      }

      .planet-chip:hover {
        transform: translateY(-1px);
        border-color: rgba(79, 209, 197, 0.7);
      }

      .planet-chip:hover::before {
        opacity: 1;
      }

      .planet-chip[data-selected="true"] {
        border-color: var(--accent);
        color: var(--accent);
        box-shadow: 0 0 0 1px rgba(79, 209, 197, 0.45);
      }

      .planet-chip-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        margin-right: 5px;
      }

      .planet-chip-label {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .scene-panel {
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: stretch;
        justify-content: stretch;
      }

      .scene-container {
        position: relative;
        width: 100%;
        height: 100%;
      }

      .scene-overlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: radial-gradient(circle at top left, rgba(79, 209, 197, 0.08), transparent 55%),
          radial-gradient(circle at bottom right, rgba(37, 99, 235, 0.18), transparent 55%);
        mix-blend-mode: screen;
        opacity: 0.75;
      }

      .scene-hud {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        pointer-events: none;
        padding: 10px 14px;
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: rgba(148, 163, 184, 0.7);
      }

      .hud-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 10px;
      }

      .hud-label {
        padding: 3px 7px 4px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.8));
        backdrop-filter: blur(12px);
      }

      .hud-orbit-indicator {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .orbit-dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        border: 2px solid rgba(148, 163, 184, 0.9);
        box-shadow: 0 0 16px rgba(148, 163, 184, 0.9);
      }

      .hud-bottom {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        gap: 10px;
      }

      .hud-bottom span {
        padding: 3px 7px 4px;
        border-radius: 999px;
        border: 1px solid rgba(15, 23, 42, 0.7);
        background: radial-gradient(circle at bottom, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7));
        backdrop-filter: blur(12px);
      }

      .tooltip {
        position: fixed;
        z-index: 40;
        pointer-events: none;
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.9));
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        padding: 4px 8px 5px;
        font-size: 0.7rem;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.96);
        opacity: 0;
        transform: translateY(-4px);
        transition: opacity var(--transition-fast), transform var(--transition-fast);
        white-space: nowrap;
      }

      .tooltip[data-visible="true"] {
        opacity: 1;
        transform: translateY(0);
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>
  <body>
    <div id="app" class="app-root" aria-label="Solar System Explorer">
      <section class="panel info-panel" aria-label="Planet information and controls">
        <header class="info-header">
          <div>
            <div class="app-title">
              <span class="title-chip" aria-hidden="true"></span>
              <span>Solar System Explorer</span>
            </div>
            <div class="app-subtitle">Interactive 3D Orbit Viewer</div>
          </div>
          <span class="badge">Live Simulation</span>
        </header>

        <p class="hint" aria-hidden="true">
          <span class="hint-key">Drag</span>
          orbit camera
          <span class="hint-dot"></span>
          <span class="hint-key">Scroll</span>
          zoom
          <span class="hint-dot"></span>
          <span class="hint-key">Click</span>
          select planet
        </p>

        <hr class="divider" />

        <div>
          <h1 class="planet-name" id="planet-name">Sun</h1>
          <div class="planet-tagline" id="planet-tagline">Center of our star system</div>
        </div>

        <p class="planet-description" id="planet-description">
          Welcome to the Solar System. Drag to rotate, scroll to zoom, and click any
          planet to explore real-world orbital characteristics in an ambient 3D
          simulation.
        </p>

        <div class="planet-meta" aria-label="Planet statistics">
          <article class="meta-pill">
            <div class="meta-label">Orbital radius</div>
            <div class="meta-value" id="planet-radius">—</div>
          </article>
          <article class="meta-pill">
            <div class="meta-label">Orbital period</div>
            <div class="meta-value" id="planet-period">—</div>
          </article>
          <article class="meta-pill">
            <div class="meta-label">Day length</div>
            <div class="meta-value" id="planet-day">—</div>
          </article>
        </div>

        <div class="controls" aria-label="Simulation controls">
          <div class="control-row">
            <div>
              <div class="control-label">Orbit speed</div>
              <div class="control-value" id="speed-label">1.0×</div>
            </div>
          </div>
          <div class="slider-wrapper">
            <label class="sr-only" for="speed-slider">Orbit speed multiplier</label>
            <input
              id="speed-slider"
              class="slider"
              type="range"
              min="0"
              max="4"
              step="0.1"
              value="1"
            />
          </div>

          <div class="control-row">
            <div class="toggle-group">
              <div>
                <div class="control-label">Orbital trails</div>
                <div class="control-value">Highlight planet paths</div>
              </div>
            </div>
            <button
              id="orbit-toggle"
              class="toggle"
              type="button"
              data-on="true"
              aria-pressed="true"
              aria-label="Toggle orbit lines"
            >
              <div class="toggle-thumb"></div>
            </button>
          </div>

          <div class="button-row">
            <button
              id="focus-btn"
              type="button"
              class="btn"
              data-active="false"
              aria-pressed="false"
            >
              <span>Focus Planet</span>
            </button>
            <button
              id="reset-btn"
              type="button"
              class="btn"
              data-variant="ghost"
              aria-pressed="false"
            >
              <span>Reset View</span>
            </button>
          </div>
        </div>

        <div class="planet-selector" id="planet-selector" aria-label="Quick select planet"></div>
      </section>

      <section class="panel scene-panel" aria-label="3D solar system visualization">
        <div id="scene-container" class="scene-container" aria-hidden="true"></div>
        <div class="scene-overlay" aria-hidden="true"></div>

        <div class="scene-hud" aria-hidden="true">
          <div class="hud-top">
            <div class="hud-label">Galactic coordinates · Local star neighborhood</div>
            <div class="hud-orbit-indicator">
              <div class="orbit-dot"></div>
              <span>Planetary orbits</span>
            </div>
          </div>
          <div class="hud-bottom">
            <span id="hud-time">Simulated time: 0.0 Earth years</span>
            <span>Controls: Drag · Scroll · Click</span>
          </div>
        </div>
      </section>
    </div>

    <div id="planet-tooltip" class="tooltip" role="status" aria-live="polite"></div>

    <!-- Three.js modules from CDN -->
    <script type="module">
      import * as THREE from "https://unpkg.com/three@0.161.0/build/three.module.js";
      import { OrbitControls } from "https://unpkg.com/three@0.161.0/examples/jsm/controls/OrbitControls.js?module";

      const PLANETS = [
        {
          id: "sun",
          name: "Sun",
          tagline: "Our life-giving star",
          description:
            "A G-type main-sequence star composed primarily of hydrogen and helium. Its gravity dominates the motions of every planet, moon, and comet in the Solar System.",
          radiusKm: 695_700,
          dayHours: 648.0,
          yearDays: Infinity,
          distanceAu: 0,
          color: 0xfff2a8,
          orbitColor: 0x000000,
          sizeScale: 4.0,
          orbitScale: 0,
        },
        {
          id: "mercury",
          name: "Mercury",
          tagline: "Scorched inner world",
          description:
            "Closest to the Sun with virtually no atmosphere, Mercury experiences extreme temperature swings and completes a rapid orbit in just 88 Earth days.",
          radiusKm: 2_439.7,
          dayHours: 1408,
          yearDays: 88,
          distanceAu: 0.39,
          color: 0xb0b3c0,
          orbitColor: 0x64748b,
          sizeScale: 0.34,
          orbitScale: 6,
        },
        {
          id: "venus",
          name: "Venus",
          tagline: "Runaway greenhouse",
          description:
            "Shrouded in thick clouds of sulfuric acid, Venus has surface temperatures hot enough to melt lead and rotates in the opposite direction to most planets.",
          radiusKm: 6_051.8,
          dayHours: 5832,
          yearDays: 225,
          distanceAu: 0.72,
          color: 0xfacc6b,
          orbitColor: 0xfbbf24,
          sizeScale: 0.6,
          orbitScale: 8.4,
        },
        {
          id: "earth",
          name: "Earth",
          tagline: "Our home world",
          description:
            "The only known planet to harbor life, Earth is a water-rich world with a protective atmosphere and dynamic geology shaping continents and oceans.",
          radiusKm: 6_371,
          dayHours: 24,
          yearDays: 365,
          distanceAu: 1.0,
          color: 0x60a5fa,
          orbitColor: 0x3b82f6,
          sizeScale: 0.64,
          orbitScale: 10,
        },
        {
          id: "mars",
          name: "Mars",
          tagline: "The red frontier",
          description:
            "A cold desert world with towering volcanoes and deep canyons. Evidence suggests Mars once had flowing water and perhaps conditions suitable for life.",
          radiusKm: 3_389.5,
          dayHours: 24.6,
          yearDays: 687,
          distanceAu: 1.52,
          color: 0xfb7185,
          orbitColor: 0xf97316,
          sizeScale: 0.46,
          orbitScale: 12,
        },
        {
          id: "jupiter",
          name: "Jupiter",
          tagline: "Gas giant guardian",
          description:
            "The largest planet in our Solar System with a dramatic banded atmosphere and the Great Red Spot, a centuries-old storm larger than Earth.",
          radiusKm: 69_911,
          dayHours: 9.9,
          yearDays: 4333,
          distanceAu: 5.2,
          color: 0xfacc9b,
          orbitColor: 0xf97316,
          sizeScale: 1.8,
          orbitScale: 17,
        },
        {
          id: "saturn",
          name: "Saturn",
          tagline: "Ringed giant",
          description:
            "Known for its spectacular ring system made of ice and rock, Saturn is a hydrogen-helium giant with dozens of diverse moons.",
          radiusKm: 58_232,
          dayHours: 10.7,
          yearDays: 10_759,
          distanceAu: 9.5,
          color: 0xfde68a,
          orbitColor: 0xfcd34d,
          sizeScale: 1.4,
          orbitScale: 21,
        },
        {
          id: "uranus",
          name: "Uranus",
          tagline: "Tilted ice giant",
          description:
            "An ice giant that rotates on its side, likely due to an ancient colossal impact, giving it extreme seasonal variations over its long orbit.",
          radiusKm: 25_362,
          dayHours: 17.2,
          yearDays: 30_687,
          distanceAu: 19.2,
          color: 0x7dd3fc,
          orbitColor: 0x38bdf8,
          sizeScale: 1.0,
          orbitScale: 25,
        },
        {
          id: "neptune",
          name: "Neptune",
          tagline: "Wind-swept frontier",
          description:
            "The most distant major planet, Neptune is a deep-blue world with supersonic winds and a dynamic atmosphere.",
          radiusKm: 24_622,
          dayHours: 16.1,
          yearDays: 60_190,
          distanceAu: 30.1,
          color: 0x4f46e5,
          orbitColor: 0x6366f1,
          sizeScale: 1.0,
          orbitScale: 28,
        },
      ];

      const sceneContainer = document.getElementById("scene-container");
      const planetNameEl = document.getElementById("planet-name");
      const planetTaglineEl = document.getElementById("planet-tagline");
      const planetDescriptionEl = document.getElementById("planet-description");
      const planetRadiusEl = document.getElementById("planet-radius");
      const planetPeriodEl = document.getElementById("planet-period");
      const planetDayEl = document.getElementById("planet-day");
      const speedSliderEl = document.getElementById("speed-slider");
      const speedLabelEl = document.getElementById("speed-label");
      const orbitToggleEl = document.getElementById("orbit-toggle");
      const focusBtnEl = document.getElementById("focus-btn");
      const resetBtnEl = document.getElementById("reset-btn");
      const planetSelectorEl = document.getElementById("planet-selector");
      const hudTimeEl = document.getElementById("hud-time");
      const tooltipEl = document.getElementById("planet-tooltip");

      let renderer, scene, camera, controls;
      let raycaster, pointer;
      let orbitSpeedMultiplier = 1.0;
      let showOrbits = true;
      let focusedOnPlanet = false;
      let elapsedYears = 0;
      let hoveredPlanetId = null;
      let selectedPlanetId = "sun";

      const planetMeshes = new Map();
      const orbitLines = new Map();
      const orbitGroups = new Map();

      const clock = new THREE.Clock();

      function formatNumber(value, fractionDigits = 1) {
        if (!Number.isFinite(value)) return "—";
        return value.toLocaleString(undefined, {
          maximumFractionDigits: fractionDigits,
          minimumFractionDigits: fractionDigits,
        });
      }

      function formatDurationHours(hours) {
        if (!Number.isFinite(hours)) return "—";
        if (hours < 48) return `${formatNumber(hours, 1)} hours`;
        const days = hours / 24;
        return `${formatNumber(days, 1)} Earth days`;
      }

      function formatOrbitalPeriod(days) {
        if (!Number.isFinite(days)) return "—";
        if (days < 365) return `${formatNumber(days, 0)} Earth days`;
        const years = days / 365;
        return `${formatNumber(years, 2)} Earth years`;
      }

      function formatRadius(distanceAu) {
        if (!Number.isFinite(distanceAu) || distanceAu === 0) return "At the system center";
        return `${formatNumber(distanceAu, 2)} AU from Sun`;
      }

      function initThree() {
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.setClearColor(new THREE.Color(0x020617), 1);
        sceneContainer.appendChild(renderer.domElement);

        scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x020617, 0.02);

        const width = sceneContainer.clientWidth || window.innerWidth;
        const height = sceneContainer.clientHeight || window.innerHeight;

        camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 200);
        camera.position.set(0, 18, 46);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.06;
        controls.enablePan = false;
        controls.minDistance = 16;
        controls.maxDistance = 90;
        controls.autoRotate = false;
        controls.autoRotateSpeed = 0.15;

        const ambient = new THREE.AmbientLight(0x1f2937, 0.9);
        scene.add(ambient);

        const sunLight = new THREE.PointLight(0xfff9c4, 3, 180, 1.6);
        sunLight.position.set(0, 0, 0);
        scene.add(sunLight);

        const sunGeometry = new THREE.SphereGeometry(4, 64, 64);
        const sunMaterial = new THREE.MeshBasicMaterial({
          color: 0xfff7b2,
        });
        const sunMesh = new THREE.Mesh(sunGeometry, sunMaterial);
        sunMesh.userData.planetId = "sun";
        scene.add(sunMesh);
        planetMeshes.set("sun", sunMesh);

        const sunGlow = new THREE.Mesh(
          new THREE.SphereGeometry(6.5, 32, 32),
          new THREE.MeshBasicMaterial({
            color: 0xfff5c7,
            transparent: true,
            opacity: 0.18,
            blending: THREE.AdditiveBlending,
            side: THREE.BackSide,
          })
        );
        scene.add(sunGlow);

        createStarfield();
        createPlanets();

        raycaster = new THREE.Raycaster();
        pointer = new THREE.Vector2();

        handleResize();
        window.addEventListener("resize", handleResize);

        renderer.domElement.addEventListener("pointermove", onPointerMove);
        renderer.domElement.addEventListener("pointerdown", onPointerDown);

        animate();
      }

      function createStarfield() {
        const starGeometry = new THREE.BufferGeometry();
        const starCount = 1400;
        const positions = new Float32Array(starCount * 3);
        const colors = new Float32Array(starCount * 3);
        const color = new THREE.Color();

        for (let i = 0; i < starCount; i++) {
          const radius = 70 + Math.random() * 40;
          const theta = Math.random() * Math.PI * 2;
          const phi = Math.acos(2 * Math.random() - 1);

          const x = radius * Math.sin(phi) * Math.cos(theta);
          const y = radius * Math.sin(phi) * Math.sin(theta);
          const z = radius * Math.cos(phi);

          positions[i * 3] = x;
          positions[i * 3 + 1] = y;
          positions[i * 3 + 2] = z;

          const t = Math.random();
          color.setHSL(0.58 + 0.12 * t, 0.4 + 0.3 * t, 0.7 + 0.2 * t);
          colors[i * 3] = color.r;
          colors[i * 3 + 1] = color.g;
          colors[i * 3 + 2] = color.b;
        }

        starGeometry.setAttribute("position", new THREE.BufferAttribute(positions, 3));
        starGeometry.setAttribute("color", new THREE.BufferAttribute(colors, 3));

        const starMaterial = new THREE.PointsMaterial({
          size: 0.5,
          sizeAttenuation: true,
          vertexColors: true,
          transparent: true,
          opacity: 0.9,
          depthWrite: false,
          blending: THREE.AdditiveBlending,
        });

        const stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);
      }

      function createPlanets() {
        const baseYearSeconds = 6.0;

        for (const planet of PLANETS) {
          if (planet.id === "sun") continue;

          const group = new THREE.Group();
          group.position.set(0, 0, 0);
          scene.add(group);
          orbitGroups.set(planet.id, group);

          const orbitRadius = planet.orbitScale;

          const orbitSegments = 180;
          const orbitGeometry = new THREE.BufferGeometry();
          const orbitPositions = new Float32Array((orbitSegments + 1) * 3);
          for (let i = 0; i <= orbitSegments; i++) {
            const angle = (i / orbitSegments) * Math.PI * 2;
            orbitPositions[i * 3] = Math.cos(angle) * orbitRadius;
            orbitPositions[i * 3 + 1] = 0;
            orbitPositions[i * 3 + 2] = Math.sin(angle) * orbitRadius;
          }
          orbitGeometry.setAttribute(
            "position",
            new THREE.BufferAttribute(orbitPositions, 3)
          );

          const orbitMaterial = new THREE.LineBasicMaterial({
            color: planet.orbitColor,
            transparent: true,
            opacity: 0.45,
          });

          const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
          orbitLine.rotation.x = Math.PI / 2;
          orbitLines.set(planet.id, orbitLine);
          group.add(orbitLine);

          const radius = planet.sizeScale;
          const widthSegments = 48;
          const heightSegments = 32;
          const geometry = new THREE.SphereGeometry(radius, widthSegments, heightSegments);
          const material = new THREE.MeshStandardMaterial({
            color: planet.color,
            emissive: planet.color,
            emissiveIntensity: 0.14,
            metalness: 0.1,
            roughness: 0.6,
          });

          const mesh = new THREE.Mesh(geometry, material);
          mesh.position.set(orbitRadius, 0, 0);
          mesh.castShadow = false;
          mesh.receiveShadow = false;
          mesh.userData.planetId = planet.id;
          mesh.userData.angularVelocity =
            planet.yearDays === Infinity ? 0 : (Math.PI * 2) / (planet.yearDays || 365);
          mesh.userData.rotationSpeed = 0.6 / (1 + planet.radiusKm / 7000);

          group.add(mesh);
          planetMeshes.set(planet.id, mesh);
        }

        buildPlanetSelectorUI();
        selectPlanet("sun");
      }

      function buildPlanetSelectorUI() {
        planetSelectorEl.innerHTML = "";
        for (const planet of PLANETS) {
          const chip = document.createElement("button");
          chip.type = "button";
          chip.className = "planet-chip";
          chip.dataset.planetId = planet.id;
          chip.dataset.selected = planet.id === selectedPlanetId ? "true" : "false";
          chip.setAttribute("aria-label", `Select ${planet.name}`);

          const dot = document.createElement("span");
          dot.className = "planet-chip-dot";
          dot.style.background =
            planet.id === "sun"
              ? "radial-gradient(circle at top, #fbbf24, #f97316)"
              : `radial-gradient(circle at top, #0b1120, #020617), radial-gradient(circle, #ffffff11, #0000), radial-gradient(circle at top, #${planet.color.toString(
                  16
                )}, #${planet.color.toString(16)})`;

          const label = document.createElement("span");
          label.className = "planet-chip-label";
          label.textContent = planet.name;

          chip.appendChild(dot);
          chip.appendChild(label);

          chip.addEventListener("click", () => {
            selectPlanet(planet.id);
            gentlyFocusPlanet(planet.id);
          });

          planetSelectorEl.appendChild(chip);
        }
      }

      function updatePlanetSelectorUI() {
        const chips = planetSelectorEl.querySelectorAll(".planet-chip");
        for (const chip of chips) {
          chip.dataset.selected = chip.dataset.planetId === selectedPlanetId ? "true" : "false";
        }
      }

      function handleResize() {
        if (!renderer || !camera) return;
        const width = sceneContainer.clientWidth || window.innerWidth;
        const height = sceneContainer.clientHeight || window.innerHeight;
        renderer.setSize(width, height, false);
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
      }

      function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();
        const effectiveDelta = delta * orbitSpeedMultiplier;

        for (const planet of PLANETS) {
          if (planet.id === "sun") continue;
          const group = orbitGroups.get(planet.id);
          const mesh = planetMeshes.get(planet.id);
          if (!group || !mesh) continue;

          const angularVelocity =
            mesh.userData.angularVelocity || (Math.PI * 2) / (planet.yearDays || 365);
          group.rotation.y += angularVelocity * effectiveDelta * 2.5;

          const rotationSpeed = mesh.userData.rotationSpeed || 0.3;
          mesh.rotation.y += rotationSpeed * delta;
        }

        elapsedYears += (effectiveDelta / 6.0) * 0.2;
        hudTimeEl.textContent = `Simulated time: ${formatNumber(elapsedYears, 1)} Earth years`;

        updateOrbitVisibility();
        controls.update();
        renderer.render(scene, camera);
      }

      function updateOrbitVisibility() {
        for (const [id, orbit] of orbitLines.entries()) {
          orbit.visible = showOrbits && id !== "sun";
        }
      }

      function onPointerMove(event) {
        const rect = renderer.domElement.getBoundingClientRect();
        pointer.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
        pointer.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

        raycaster.setFromCamera(pointer, camera);
        const objects = Array.from(planetMeshes.values());
        const intersects = raycaster.intersectObjects(objects, true);

        if (intersects.length > 0) {
          const top = intersects[0].object;
          const planetId = top.userData.planetId;
          hoveredPlanetId = planetId;
          showTooltip(event.clientX, event.clientY, PLANETS.find((p) => p.id === planetId));
        } else {
          hoveredPlanetId = null;
          hideTooltip();
        }
      }

      function onPointerDown(event) {
        const rect = renderer.domElement.getBoundingClientRect();
        pointer.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
        pointer.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

        raycaster.setFromCamera(pointer, camera);
        const objects = Array.from(planetMeshes.values());
        const intersects = raycaster.intersectObjects(objects, true);

        if (intersects.length > 0) {
          const top = intersects[0].object;
          const planetId = top.userData.planetId;
          if (planetId) {
            selectPlanet(planetId);
          }
        }
      }

      function showTooltip(x, y, planet) {
        if (!planet) return;
        tooltipEl.textContent = planet.name;
        tooltipEl.style.left = `${x + 10}px`;
        tooltipEl.style.top = `${y + 10}px`;
        tooltipEl.dataset.visible = "true";
      }

      function hideTooltip() {
        tooltipEl.dataset.visible = "false";
      }

      function selectPlanet(id) {
        const planet = PLANETS.find((p) => p.id === id) || PLANETS[0];
        selectedPlanetId = planet.id;

        planetNameEl.textContent = planet.name;
        planetTaglineEl.textContent = planet.tagline;
        planetDescriptionEl.textContent = planet.description;

        planetRadiusEl.textContent = formatRadius(planet.distanceAu);
        planetPeriodEl.textContent = formatOrbitalPeriod(planet.yearDays);
        planetDayEl.textContent = formatDurationHours(planet.dayHours);

        for (const [planetId, mesh] of planetMeshes.entries()) {
          if (planetId === "sun") continue;
          if (!mesh.material) continue;
          const isSelected = planetId === selectedPlanetId;
          mesh.material.emissiveIntensity = isSelected ? 0.35 : 0.14;
          mesh.scale.setScalar(isSelected ? 1.08 : 1.0);
        }

        updatePlanetSelectorUI();
        focusBtnEl.dataset.active = "false";
        focusBtnEl.setAttribute("aria-pressed", "false");
        focusedOnPlanet = false;
      }

      function gentlyFocusPlanet(planetId) {
        const mesh = planetMeshes.get(planetId);
        if (!mesh) return;

        const worldPos = new THREE.Vector3();
        mesh.getWorldPosition(worldPos);

        const offsetDirection = worldPos
          .clone()
          .normalize()
          .add(new THREE.Vector3(0.3, 0.32, 0.18))
          .normalize();

        const distance = worldPos.length() + 5;
        const targetPos = offsetDirection.multiplyScalar(distance);

        const startPos = camera.position.clone();
        const startTarget = controls.target.clone();
        const endTarget = worldPos.clone();

        const duration = 0.9;
        let elapsed = 0;

        function tween() {
          elapsed += clock.getDelta();
          const t = Math.min(elapsed / duration, 1);
          const ease = t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;

          camera.position.lerpVectors(startPos, targetPos, ease);
          controls.target.lerpVectors(startTarget, endTarget, ease);
          controls.update();

          if (t < 1) {
            requestAnimationFrame(tween);
          }
        }

        tween();
      }

      function resetCameraView() {
        const defaultPos = new THREE.Vector3(0, 18, 46);
        const defaultTarget = new THREE.Vector3(0, 0, 0);
        const startPos = camera.position.clone();
        const startTarget = controls.target.clone();

        const duration = 0.9;
        let elapsed = 0;

        function tween() {
          elapsed += clock.getDelta();
          const t = Math.min(elapsed / duration, 1);
          const ease = t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;

          camera.position.lerpVectors(startPos, defaultPos, ease);
          controls.target.lerpVectors(startTarget, defaultTarget, ease);
          controls.update();

          if (t < 1) {
            requestAnimationFrame(tween);
          }
        }

        tween();
      }

      function initControls() {
        speedSliderEl.addEventListener("input", () => {
          orbitSpeedMultiplier = parseFloat(speedSliderEl.value || "1");
          speedLabelEl.textContent = `${orbitSpeedMultiplier.toFixed(1)}×`;
        });

        orbitToggleEl.addEventListener("click", () => {
          showOrbits = !showOrbits;
          orbitToggleEl.dataset.on = showOrbits ? "true" : "false";
          orbitToggleEl.setAttribute("aria-pressed", showOrbits ? "true" : "false");
          updateOrbitVisibility();
        });

        focusBtnEl.addEventListener("click", () => {
          if (selectedPlanetId === "sun") {
            gentlyFocusPlanet("sun");
            return;
          }
          focusedOnPlanet = !focusedOnPlanet;
          focusBtnEl.dataset.active = focusedOnPlanet ? "true" : "false";
          focusBtnEl.setAttribute("aria-pressed", focusedOnPlanet ? "true" : "false");

          if (focusedOnPlanet) {
            gentlyFocusPlanet(selectedPlanetId);
          } else {
            resetCameraView();
          }
        });

        resetBtnEl.addEventListener("click", () => {
          focusedOnPlanet = false;
          focusBtnEl.dataset.active = "false";
          focusBtnEl.setAttribute("aria-pressed", "false");
          orbitSpeedMultiplier = 1.0;
          speedSliderEl.value = "1";
          speedLabelEl.textContent = "1.0×";
          elapsedYears = 0;
          resetCameraView();
        });
      }

      initThree();
      initControls();
    </script>
  </body>
</html>
