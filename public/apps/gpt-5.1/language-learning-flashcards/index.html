<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Travel Phrase Flashcards</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: dark light;
        --bg: radial-gradient(circle at top, #1a2a6c, #1a1b2f 55%, #000000);
        --surface: rgba(17, 24, 39, 0.9);
        --surface-soft: rgba(31, 41, 55, 0.9);
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.1);
        --accent-strong: #0ea5e9;
        --accent-muted: #7dd3fc;
        --danger: #f97373;
        --text: #e5e7eb;
        --text-soft: #9ca3af;
        --border-subtle: rgba(148, 163, 184, 0.35);
        --shadow-soft: 0 24px 60px rgba(15, 23, 42, 0.9);
        --radius-xl: 20px;
        --transition-fast: 160ms ease-out;
        --transition-slow: 260ms cubic-bezier(0.19, 1, 0.22, 1);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        background: #020617;
        color: var(--text);
      }

      body {
        display: flex;
        align-items: stretch;
        justify-content: center;
      }

      .app-shell {
        min-height: 100vh;
        width: 100%;
        max-width: 1120px;
        padding: 24px 16px 32px;
        margin: 0 auto;
        background-image: var(--bg);
        background-attachment: fixed;
        overflow: hidden;
        position: relative;
        color: var(--text);
      }

      .app-shell::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background:
          radial-gradient(circle at 10% -10%, rgba(96, 165, 250, 0.15), transparent 55%),
          radial-gradient(circle at 80% 120%, rgba(45, 212, 191, 0.14), transparent 55%);
        mix-blend-mode: screen;
        opacity: 0.9;
      }

      .app-inner {
        position: relative;
        z-index: 1;
        max-width: 980px;
        margin: 0 auto;
        background: linear-gradient(
          145deg,
          rgba(15, 23, 42, 0.95),
          rgba(15, 23, 42, 0.85)
        );
        border-radius: 28px;
        border: 1px solid rgba(148, 163, 184, 0.55);
        box-shadow: 0 32px 80px rgba(15, 23, 42, 0.9);
        padding: 20px 20px 22px;
        backdrop-filter: blur(18px) saturate(1.8);
        display: grid;
        grid-template-columns: minmax(0, 2.2fr) minmax(260px, 1.3fr);
        gap: 18px;
      }

      @media (max-width: 880px) {
        .app-inner {
          grid-template-columns: minmax(0, 1fr);
          padding: 18px 16px 20px;
        }
      }

      header.app-header {
        grid-column: 1 / -1;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.4);
        margin-bottom: 4px;
      }

      .title-block {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .title-logo {
        width: 36px;
        height: 36px;
        border-radius: 999px;
        background: conic-gradient(
          from 200deg,
          #22d3ee,
          #38bdf8,
          #6366f1,
          #f97316,
          #22d3ee
        );
        position: relative;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 12px 28px rgba(15, 23, 42, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .title-logo-inner {
        width: 82%;
        height: 82%;
        border-radius: inherit;
        background: radial-gradient(circle at 25% 15%, #f9fafb, #d1d5db);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0f172a;
        font-weight: 700;
        font-size: 17px;
        letter-spacing: 0.08em;
      }

      .title-text h1 {
        margin: 0 0 2px;
        font-size: clamp(1.1rem, 1.8vw, 1.3rem);
        font-weight: 650;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        color: #e5e7eb;
      }

      .title-text p {
        margin: 0;
        font-size: 0.8rem;
        color: var(--text-soft);
      }

      .pill-row {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .status-pill {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        padding: 5px 10px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.72rem;
        line-height: 1;
        color: var(--text-soft);
        background: linear-gradient(
          120deg,
          rgba(15, 23, 42, 0.96),
          rgba(15, 23, 42, 0.88)
        );
      }

      .status-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 20%, #f9fafb, #22c55e);
        box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.25);
      }

      .pill-label {
        font-weight: 500;
        color: #e5e7eb;
      }

      .lang-switcher {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 9px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: rgba(15, 23, 42, 0.9);
        font-size: 0.7rem;
        color: var(--text-soft);
        cursor: pointer;
        transition: background var(--transition-fast), border-color var(--transition-fast),
          transform 90ms ease-out, box-shadow 90ms ease-out;
      }

      .lang-switcher:hover {
        background: rgba(15, 23, 42, 0.96);
        border-color: rgba(148, 163, 184, 0.8);
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.7);
        transform: translateY(-1px);
      }

      .lang-switcher select {
        border: none;
        outline: none;
        background: transparent;
        color: inherit;
        font: inherit;
        padding: 0;
        cursor: pointer;
      }

      .lang-switcher select option {
        color: #020617;
      }

      .layout-main {
        display: grid;
        grid-template-rows: auto 1fr auto;
        gap: 10px;
      }

      .controls-bar {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 8px 10px 10px;
        background: rgba(15, 23, 42, 0.9);
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.55);
        box-shadow: 0 14px 32px rgba(15, 23, 42, 0.85);
      }

      .controls-left {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }

      .controls-label {
        font-size: 0.78rem;
        color: var(--text-soft);
      }

      .select-styled {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 11px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: radial-gradient(circle at top, #020617, #020617);
        color: #e5e7eb;
        font-size: 0.8rem;
        cursor: pointer;
        box-shadow:
          0 14px 38px rgba(15, 23, 42, 0.9),
          inset 0 0 0 1px rgba(15, 23, 42, 0.95);
        transition: border-color var(--transition-fast), box-shadow var(--transition-fast),
          transform 90ms ease-out, background 160ms ease-out;
      }

      .select-styled:hover {
        border-color: rgba(248, 250, 252, 0.88);
        transform: translateY(-1px);
        background: radial-gradient(circle at top, #0b1120, #020617);
      }

      .select-styled select {
        border: none;
        outline: none;
        background: transparent;
        color: inherit;
        font: inherit;
        padding: 0;
        cursor: pointer;
        appearance: none;
      }

      .select-styled select option {
        color: #020617;
      }

      .select-chevron {
        font-size: 0.7rem;
        opacity: 0.7;
      }

      .chip-row {
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
        font-size: 0.75rem;
      }

      .chip {
        padding: 4px 7px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(15, 23, 42, 0.88);
        color: var(--text-soft);
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .chip-key {
        padding: 2px 5px;
        border-radius: 6px;
        background: rgba(15, 23, 42, 0.98);
        border: 1px solid rgba(148, 163, 184, 0.6);
        font-size: 0.68rem;
        color: #e5e7eb;
      }

      .button-row {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
      }

      .btn {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 7px 13px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.65);
        background: radial-gradient(circle at 10% 0, #38bdf8, #0ea5e9);
        color: #0b1120;
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.03em;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow:
          0 16px 38px rgba(15, 23, 42, 0.95),
          inset 0 0 0 1px rgba(248, 250, 252, 0.14);
        transition:
          transform 90ms ease-out,
          box-shadow 90ms ease-out,
          background-position 160ms ease-out,
          filter 120ms ease-out;
        background-size: 200% 200%;
        background-position: 0% 40%;
      }

      .btn-secondary {
        background: radial-gradient(circle at 0 0, #020617, #020617);
        color: var(--accent-muted);
        border-color: rgba(148, 163, 184, 0.75);
        box-shadow:
          0 14px 32px rgba(15, 23, 42, 0.9),
          inset 0 0 0 1px rgba(15, 23, 42, 1);
      }

      .btn-ghost {
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-soft);
        border-color: rgba(148, 163, 184, 0.6);
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.85);
      }

      .btn:active {
        transform: translateY(1px) scale(0.99);
        box-shadow:
          0 6px 18px rgba(15, 23, 42, 0.9),
          inset 0 0 0 1px rgba(15, 23, 42, 0.9);
        filter: brightness(0.97);
      }

      .btn[disabled] {
        opacity: 0.55;
        cursor: default;
        filter: grayscale(0.3);
        box-shadow: none;
      }

      .btn-icon {
        font-size: 0.85rem;
      }

      .btn-label-sub {
        font-size: 0.64rem;
        font-weight: 500;
        opacity: 0.85;
      }

      .btn-stack {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        line-height: 1.1;
      }

      .flashcard-area {
        position: relative;
        margin-top: 4px;
        padding: 18px 10px 12px;
        border-radius: var(--radius-xl);
        background: radial-gradient(circle at top, #020617, #020617);
        border: 1px solid rgba(148, 163, 184, 0.7);
        box-shadow: var(--shadow-soft);
        overflow: hidden;
      }

      .flashcard-area::before {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: radial-gradient(
          circle at -10% 0%,
          rgba(59, 130, 246, 0.3),
          transparent 60%
        );
        mix-blend-mode: screen;
        opacity: 0.6;
      }

      .flashcard-shell {
        position: relative;
        width: 100%;
        height: 260px;
        max-height: 55vh;
        display: flex;
        align-items: center;
        justify-content: center;
        perspective: 1300px;
      }

      @media (max-width: 880px) {
        .flashcard-shell {
          height: 220px;
        }
      }

      .deck-shuffle-anim {
        animation: deckShuffle 320ms ease-out;
      }

      @keyframes deckShuffle {
        0% {
          transform: translateX(0) rotate(0deg);
        }
        25% {
          transform: translateX(-10px) rotate(-1.2deg);
        }
        75% {
          transform: translateX(10px) rotate(1.2deg);
        }
        100% {
          transform: translateX(0) rotate(0deg);
        }
      }

      .card-wrapper {
        position: absolute;
        width: min(440px, 100%);
        transform-style: preserve-3d;
        transform-origin: center;
        transition:
          transform var(--transition-slow),
          filter 180ms ease-out,
          opacity 250ms ease-out;
        cursor: pointer;
      }

      .card-shadow {
        position: absolute;
        inset: 0;
        border-radius: 24px;
        background: radial-gradient(
          ellipse at bottom,
          rgba(15, 23, 42, 0.35),
          transparent 72%
        );
        filter: blur(10px);
        opacity: 0.9;
        transform: scale(0.96) translateY(16px);
        z-index: -1;
      }

      .flashcard {
        position: relative;
        width: 100%;
        height: 220px;
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        background: radial-gradient(circle at 0 -20%, #1f2937, #020617 68%);
        box-shadow:
          0 26px 60px rgba(15, 23, 42, 0.98),
          inset 0 0 0 1px rgba(15, 23, 42, 1);
        transform-style: preserve-3d;
        transition: inherit;
        overflow: hidden;
      }

      .card-wrapper.flipped .flashcard {
        transform: rotateY(180deg);
      }

      .card-face {
        position: absolute;
        inset: 0;
        padding: 18px 20px 14px;
        backface-visibility: hidden;
        display: flex;
        flex-direction: column;
      }

      .card-face.back {
        transform: rotateY(180deg);
        background: radial-gradient(circle at 100% -40%, #1e293b, #020617 72%);
      }

      .card-tag-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 10px;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--text-soft);
      }

      .card-tag {
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .card-tag strong {
        font-weight: 600;
        color: #e5e7eb;
      }

      .card-tag-accent {
        border-color: rgba(56, 189, 248, 0.8);
        background: rgba(8, 47, 73, 0.95);
        color: #7dd3fc;
      }

      .card-tag-pill {
        padding: 3px 7px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
      }

      .card-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 8px;
      }

      .card-phrase-main {
        font-size: clamp(1.35rem, 2.2vw, 1.6rem);
        font-weight: 600;
        letter-spacing: 0.01em;
        color: #f9fafb;
      }

      .card-phrase-romanized {
        font-size: 0.88rem;
        color: var(--accent-muted);
      }

      .card-phrase-subtitle {
        font-size: 0.82rem;
        color: var(--text-soft);
      }

      .card-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        font-size: 0.75rem;
        color: var(--text-soft);
      }

      .card-footer-icon {
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .card-footer-cta {
        font-weight: 500;
        color: var(--accent-muted);
      }

      .card-progress {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.74rem;
        color: var(--text-soft);
      }

      .card-progress-bar {
        position: relative;
        flex: 1;
        height: 5px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        overflow: hidden;
      }

      .card-progress-bar-fill {
        position: absolute;
        inset: 0;
        width: 0%;
        border-radius: inherit;
        background: linear-gradient(90deg, #22c55e, #4ade80);
        box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.6);
        transition: width 220ms ease-out;
      }

      .card-index-pill {
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
      }

      .card-wrapper.leaving {
        pointer-events: none;
        animation: cardLeave 280ms var(--transition-slow) forwards;
      }

      @keyframes cardLeave {
        0% {
          opacity: 1;
          transform: translateX(0) rotate(0deg) scale(1);
          filter: blur(0);
        }
        60% {
          opacity: 0.1;
          transform: translateX(22px) rotate(4deg) scale(0.96);
          filter: blur(1px);
        }
        100% {
          opacity: 0;
          transform: translateX(34px) rotate(6deg) scale(0.94);
          filter: blur(2px);
        }
      }

      .hint-row {
        padding-top: 10px;
        margin-top: 8px;
        border-top: 1px dashed rgba(148, 163, 184, 0.5);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        font-size: 0.72rem;
        color: var(--text-soft);
      }

      .hint-shortcuts {
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
      }

      .badge {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 999px;
        font-size: 0.7rem;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-soft);
      }

      .badge-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 20%, #e5e7eb, #22c55e);
      }

      .stats-panel {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 10px 12px 10px;
        border-radius: 18px;
        background: radial-gradient(circle at -20% 0, #020617, #020617 70%);
        border: 1px solid rgba(148, 163, 184, 0.7);
        box-shadow:
          0 22px 60px rgba(15, 23, 42, 0.98),
          inset 0 0 0 1px rgba(15, 23, 42, 0.98);
      }

      .stats-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 6px;
        margin-bottom: 6px;
      }

      .stats-title {
        font-size: 0.9rem;
        font-weight: 550;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        color: #e5e7eb;
      }

      .stats-subtitle {
        font-size: 0.75rem;
        color: var(--text-soft);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }

      .stat-card {
        padding: 8px 9px 8px;
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.92);
      }

      .stat-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--text-soft);
        margin-bottom: 6px;
      }

      .stat-main {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 4px;
      }

      .stat-value {
        font-size: 1.1rem;
        font-weight: 650;
        color: #f9fafb;
      }

      .stat-unit {
        font-size: 0.72rem;
        color: var(--accent-muted);
      }

      .stat-bar {
        margin-top: 8px;
        position: relative;
        height: 6px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        overflow: hidden;
      }

      .stat-bar-fill {
        position: absolute;
        inset: 0;
        width: 0;
        border-radius: inherit;
        background: linear-gradient(90deg, #22c55e, #4ade80);
        transition: width 220ms ease-out;
      }

      .stat-bar-fill-secondary {
        background: linear-gradient(90deg, #38bdf8, #6366f1);
      }

      .stat-meta {
        font-size: 0.7rem;
        color: var(--text-soft);
        margin-top: 6px;
      }

      .pill-small {
        padding: 3px 6px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.55);
        font-size: 0.68rem;
        color: var(--text-soft);
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .pill-small strong {
        color: #e5e7eb;
        font-weight: 600;
      }

      .list-learned {
        margin: 0;
        padding: 0;
        list-style: none;
        font-size: 0.76rem;
        max-height: 150px;
        overflow: auto;
        border-radius: 9px;
        border: 1px solid rgba(51, 65, 85, 0.7);
        background: rgba(15, 23, 42, 0.9);
      }

      .list-empty-state {
        padding: 7px 9px;
        font-size: 0.72rem;
        color: var(--text-soft);
      }

      .list-learned-item {
        padding: 6px 9px 7px;
        border-bottom: 1px solid rgba(30, 64, 175, 0.5);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 6px;
      }

      .list-learned-item:last-child {
        border-bottom: none;
      }

      .list-learned-main {
        display: flex;
        flex-direction: column;
        gap: 1px;
      }

      .list-learned-phrase {
        color: #e5e7eb;
      }

      .list-learned-sub {
        color: var(--text-soft);
      }

      .list-learned-tag {
        font-size: 0.7rem;
        color: var(--accent-muted);
      }

      .footer {
        grid-column: 1 / -1;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding-top: 6px;
        font-size: 0.7rem;
        color: var(--text-soft);
      }

      .footer span strong {
        color: #e5e7eb;
      }

      .footer-links {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .footer-badge {
        padding: 3px 7px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
    </style>
  </head>
  <body>
    <main class="app-shell" id="appRoot">
      <div class="app-inner" aria-live="polite">
        <header class="app-header">
          <div class="title-block">
            <div class="title-logo" aria-hidden="true">
              <div class="title-logo-inner">ÊóÖ</div>
            </div>
            <div class="title-text">
              <h1 id="appTitle">Travel Phrase Flashcards</h1>
              <p id="appSubtitle">
                Ten essential phrases in English, Spanish, French, or Japanese.
              </p>
            </div>
          </div>
          <div class="pill-row">
            <div class="status-pill" aria-hidden="true">
              <span class="status-dot"></span>
              <span class="pill-label" id="statusLabel">Daily Streak</span>
              <span id="statusValue">Perfect start</span>
            </div>
            <label class="lang-switcher">
              <span id="uiLanguageLabel">UI</span>
              <select id="uiLanguageSelect" aria-label="UI language">
                <option value="en">English</option>
                <option value="es">Espa√±ol</option>
                <option value="fr">Fran√ßais</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
              </select>
            </label>
          </div>
        </header>

        <section class="layout-main" aria-label="Flashcard workspace">
          <section class="controls-bar">
            <div class="controls-left">
              <div class="controls-label" id="deckLabel">
                Learn phrases in:
              </div>
              <label class="select-styled">
                <span class="btn-icon" aria-hidden="true">üåç</span>
                <select id="learningLanguageSelect" aria-label="Language to learn">
                  <option value="en">English</option>
                  <option value="es">Espa√±ol</option>
                  <option value="fr">Fran√ßais</option>
                  <option value="ja">Êó•Êú¨Ë™û</option>
                </select>
                <span class="select-chevron" aria-hidden="true">‚ñæ</span>
              </label>
              <div class="chip-row" aria-hidden="true">
                <div class="chip">
                  <span class="chip-key">Space</span>
                  <span id="chipFlip">Flip card</span>
                </div>
                <div class="chip">
                  <span class="chip-key">L</span>
                  <span id="chipLearn">Mark learned</span>
                </div>
              </div>
            </div>
            <div class="button-row">
              <button class="btn btn-secondary" id="shuffleBtn" type="button">
                <span class="btn-icon" aria-hidden="true">üîÄ</span>
                <span class="btn-stack">
                  <span id="shuffleLabel">Shuffle</span>
                  <span class="btn-label-sub" id="shuffleSubLabel">
                    Reshuffle remaining
                  </span>
                </span>
              </button>
              <button class="btn btn-ghost" id="resetBtn" type="button">
                <span class="btn-icon" aria-hidden="true">‚Ü∫</span>
                <span class="btn-stack">
                  <span id="resetLabel">Reset</span>
                  <span class="btn-label-sub" id="resetSubLabel">
                    Clear learned
                  </span>
                </span>
              </button>
            </div>
          </section>

          <section class="flashcard-area">
            <h2 class="sr-only" id="cardRegionTitle">Current flashcard</h2>
            <div class="flashcard-shell" id="flashcardShell">
              <!-- Flashcard injected by JavaScript -->
            </div>
            <div class="hint-row">
              <div id="hintFlip">
                Click the card or press <span class="badge"><span
                    class="badge-dot"
                  ></span>Space</span>
                to flip.
              </div>
              <div class="hint-shortcuts" aria-hidden="true">
                <span class="badge">
                  <span>Tip</span>&nbsp;¬∑&nbsp;<span id="hintTip">
                    Aim to learn all 10 today.
                  </span>
                </span>
              </div>
            </div>
          </section>
        </section>

        <aside class="stats-panel" aria-label="Progress overview">
          <header class="stats-header">
            <div>
              <div class="stats-title" id="statsTitle">Session overview</div>
              <div class="stats-subtitle" id="statsSubtitle">
                Track learned phrases per language.
              </div>
            </div>
          </header>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label" id="statLearnedLabel">
                Learned today
              </div>
              <div class="stat-main">
                <div>
                  <span class="stat-value" id="statLearnedValue">0</span>
                  <span class="stat-unit" id="statLearnedUnit">/ 10</span>
                </div>
                <span class="pill-small">
                  <span id="statLanguageLabel">Language</span>:
                  <strong id="statLanguageValue">English</strong>
                </span>
              </div>
              <div class="stat-bar">
                <div
                  class="stat-bar-fill"
                  id="statLearnedBar"
                  style="width: 0%"
                ></div>
              </div>
              <div class="stat-meta" id="statMeta">
                Mark a card as learned to fill this ring.
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-label" id="statDeckLabel">
                Deck status
              </div>
              <div class="stat-main">
                <div>
                  <span class="stat-value" id="statRemainingValue">10</span>
                  <span class="stat-unit" id="statRemainingUnit">
                    remaining
                  </span>
                </div>
                <span class="pill-small">
                  <span id="statTotalLabel">Total</span>:
                  <strong id="statTotalValue">10</strong>
                </span>
              </div>
              <div class="stat-bar">
                <div
                  class="stat-bar-fill stat-bar-fill-secondary"
                  id="statRemainingBar"
                  style="width: 100%"
                ></div>
              </div>
              <div class="stat-meta" id="statDeckMeta">
                Shuffle at any time; learned cards stay learned.
              </div>
            </div>
          </div>
          <div>
            <div class="stats-subtitle" id="learnedListTitle">
              Learned this session
            </div>
            <ul class="list-learned" id="learnedList">
              <li class="list-empty-state" id="learnedEmpty">
                No phrases learned yet. Mark cards as learned to see them here.
              </li>
            </ul>
          </div>
        </aside>

        <footer class="footer">
          <span id="footerLeft">
            Built for focused, bite-size travel practice.
          </span>
          <div class="footer-links" aria-hidden="true">
            <span class="footer-badge">
              <span>‚åò</span> + <span>‚Üµ</span> ¬∑
              <span id="footerShortcutHint">Flip &amp; learn faster</span>
            </span>
            <span class="footer-badge">
              <span id="footerLocaleHint">Locale-aware UI</span>
            </span>
          </div>
        </footer>
      </div>
    </main>

    <script>
      (function () {
        "use strict";

        const uiStrings = {
          en: {
            appTitle: "Travel Phrase Flashcards",
            appSubtitle:
              "Ten essential phrases in English, Spanish, French, or Japanese.",
            statusLabel: "Daily streak",
            statusValue: "Perfect start",
            uiLanguageLabel: "UI",
            deckLabel: "Learn phrases in:",
            chipFlip: "Flip card",
            chipLearn: "Mark learned",
            shuffleLabel: "Shuffle",
            shuffleSubLabel: "Reshuffle remaining",
            resetLabel: "Reset",
            resetSubLabel: "Clear learned",
            hintFlip:
              'Click the card or press <span class="badge"><span class="badge-dot"></span>Space</span> to flip.',
            hintTip: "Aim to learn all 10 today.",
            statsTitle: "Session overview",
            statsSubtitle: "Track learned phrases per language.",
            statLearnedLabel: "Learned today",
            statLearnedUnit: "/ 10",
            statLanguageLabel: "Language",
            statMeta: "Mark a card as learned to fill this ring.",
            statDeckLabel: "Deck status",
            statRemainingUnit: "remaining",
            statTotalLabel: "Total",
            statDeckMeta:
              "Shuffle at any time; learned cards stay learned.",
            learnedListTitle: "Learned this session",
            learnedEmpty:
              "No phrases learned yet. Mark cards as learned to see them here.",
            footerLeft: "Built for focused, bite-size travel practice.",
            footerShortcutHint: "Flip & learn faster",
            footerLocaleHint: "Locale-aware UI",
            cardFrontLabel: "Guess in",
            cardBackLabel: "Translation",
            cardTapHint: "Tap or press Space to flip.",
          },
          es: {
            appTitle: "Tarjetas de Viaje",
            appSubtitle:
              "Diez frases esenciales en ingl√©s, espa√±ol, franc√©s o japon√©s.",
            statusLabel: "Racha de hoy",
            statusValue: "Buen comienzo",
            uiLanguageLabel: "Interfaz",
            deckLabel: "Quiero aprender:",
            chipFlip: "Girar tarjeta",
            chipLearn: "Marcar aprendido",
            shuffleLabel: "Mezclar",
            shuffleSubLabel: "Mezclar restantes",
            resetLabel: "Reiniciar",
            resetSubLabel: "Borrar aprendidos",
            hintFlip:
              'Haz clic en la tarjeta o pulsa <span class="badge"><span class="badge-dot"></span>Espacio</span> para girar.',
            hintTip: "Intenta aprender las 10 hoy.",
            statsTitle: "Resumen de sesi√≥n",
            statsSubtitle:
              "Lleva el control por idioma que estudias.",
            statLearnedLabel: "Aprendidos hoy",
            statLearnedUnit: "/ 10",
            statLanguageLabel: "Idioma",
            statMeta:
              "Marca tarjetas como aprendidas para llenar el anillo.",
            statDeckLabel: "Estado del mazo",
            statRemainingUnit: "restantes",
            statTotalLabel: "Total",
            statDeckMeta:
              "Mezcla cuando quieras; lo aprendido se mantiene.",
            learnedListTitle: "Aprendidos en esta sesi√≥n",
            learnedEmpty:
              "Todav√≠a no hay frases aprendidas. M√°rcalas y aparecer√°n aqu√≠.",
            footerLeft:
              "Pensado para practicar viajes en sesiones cortas.",
            footerShortcutHint: "Gira y aprende m√°s r√°pido",
            footerLocaleHint: "Interfaz seg√∫n tu idioma",
            cardFrontLabel: "Adivina en",
            cardBackLabel: "Traducci√≥n",
            cardTapHint: "Toca o pulsa Espacio para girar.",
          },
          fr: {
            appTitle: "Cartes de Phrases de Voyage",
            appSubtitle:
              "Dix phrases essentielles en anglais, espagnol, fran√ßais ou japonais.",
            statusLabel: "S√©rie du jour",
            statusValue: "Bon d√©part",
            uiLanguageLabel: "Interface",
            deckLabel: "Je veux apprendre :",
            chipFlip: "Retourner la carte",
            chipLearn: "Marquer appris",
            shuffleLabel: "M√©langer",
            shuffleSubLabel: "M√©langer restantes",
            resetLabel: "R√©initialiser",
            resetSubLabel: "Effacer appris",
            hintFlip:
              'Cliquez sur la carte ou appuyez sur <span class="badge"><span class="badge-dot"></span>Espace</span> pour la retourner.',
            hintTip: "Visez les 10 phrases aujourd‚Äôhui.",
            statsTitle: "Vue d‚Äôensemble",
            statsSubtitle:
              "Suivez vos progr√®s par langue √©tudi√©e.",
            statLearnedLabel: "Apprises aujourd‚Äôhui",
            statLearnedUnit: "/ 10",
            statLanguageLabel: "Langue",
            statMeta:
              "Marquez une carte comme apprise pour remplir l‚Äôanneau.",
            statDeckLabel: "√âtat du paquet",
            statRemainingUnit: "restantes",
            statTotalLabel: "Total",
            statDeckMeta:
              "M√©langez √† tout moment ; les cartes apprises restent.",
            learnedListTitle: "Apprises cette session",
            learnedEmpty:
              "Aucune phrase apprise pour l‚Äôinstant. Marquez-les et elles s‚Äôafficheront ici.",
            footerLeft:
              "Pens√© pour pratiquer le voyage en petites sessions.",
            footerShortcutHint: "Retournez & apprenez plus vite",
            footerLocaleHint: "Interface adapt√©e √† votre langue",
            cardFrontLabel: "Devinez en",
            cardBackLabel: "Traduction",
            cardTapHint: "Touchez ou appuyez sur Espace pour retourner.",
          },
          ja: {
            appTitle: "ÊóÖ„ÅÆ„Éï„É©„ÉÉ„Ç∑„É•„Ç´„Éº„Éâ",
            appSubtitle:
              "Ëã±Ë™û„Éª„Çπ„Éö„Ç§„É≥Ë™û„Éª„Éï„É©„É≥„ÇπË™û„ÉªÊó•Êú¨Ë™û„ÅÆ‰æøÂà©„Å™„Éï„É¨„Éº„Ç∫10ÂÄã„ÄÇ",
            statusLabel: "Êú¨Êó•„ÅÆ„Çπ„ÉÜreak",
            statusValue: "ËâØ„ÅÑ„Çπ„Çø„Éº„Éà",
            uiLanguageLabel: "Ë°®Á§∫",
            deckLabel: "Â≠¶„Å≥„Åü„ÅÑË®ÄË™ûÔºö",
            chipFlip: "„Ç´„Éº„Éâ„Çí„ÇÅ„Åè„Çã",
            chipLearn: "ÁøíÂæóÊ∏à„Åø„Å´„Åô„Çã",
            shuffleLabel: "„Ç∑„É£„ÉÉ„Éï„É´",
            shuffleSubLabel: "ÊÆã„Çä„Çí‰∏¶„Å≥Êõø„Åà",
            resetLabel: "„É™„Çª„ÉÉ„Éà",
            resetSubLabel: "ÁøíÂæó„Çí„ÇØ„É™„Ç¢",
            hintFlip:
              '„Ç´„Éº„Éâ„Çí„ÇØ„É™„ÉÉ„ÇØ„ÄÅ„Åæ„Åü„ÅØ <span class="badge"><span class="badge-dot"></span>Space</span> „Ç≠„Éº„Åß„ÇÅ„Åè„Çä„Åæ„Åô„ÄÇ',
            hintTip: "„Åæ„Åö„ÅØ 10 ÂÄã„Åô„Åπ„Å¶Ë¶ö„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ",
            statsTitle: "„Çª„ÉÉ„Ç∑„Éß„É≥Ê¶ÇË¶Å",
            statsSubtitle: "Ë®ÄË™û„Åî„Å®„ÅÆÁøíÂæóÁä∂Ê≥Å„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ",
            statLearnedLabel: "‰ªäÊó•Ë¶ö„Åà„ÅüÊï∞",
            statLearnedUnit: "/ 10",
            statLanguageLabel: "Ë®ÄË™û",
            statMeta:
              "ÁøíÂæóÊ∏à„Åø„Å´„Åô„Çã„Å®„É™„É≥„Ç∞„ÅåÊ∫Ä„Å°„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ",
            statDeckLabel: "„Éá„ÉÉ„Ç≠„ÅÆÁä∂ÊÖã",
            statRemainingUnit: "ÊûöÊÆã„Çä",
            statTotalLabel: "ÂêàË®à",
            statDeckMeta:
              "„ÅÑ„Å§„Åß„ÇÇ„Ç∑„É£„ÉÉ„Éï„É´ÂèØËÉΩ„ÄÇÁøíÂæóÊ∏à„Åø„ÅØÁ∂≠ÊåÅ„Åï„Çå„Åæ„Åô„ÄÇ",
            learnedListTitle: "„Åì„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅßË¶ö„Åà„Åü„Éï„É¨„Éº„Ç∫",
            learnedEmpty:
              "„Åæ„Å†ÁøíÂæóÊ∏à„Åø„ÅÆ„Éï„É¨„Éº„Ç∫„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Ç´„Éº„Éâ„ÇíÁøíÂæóÊ∏à„Åø„Å´„Åô„Çã„Å®Ë°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ",
            footerLeft:
              "Áü≠„ÅÑ„Çπ„Ç≠„ÉûÊôÇÈñì„ÅßÊóÖ„ÅÆ„Éï„É¨„Éº„Ç∫„ÇíÈõÜ‰∏≠Â≠¶Áøí„ÄÇ",
            footerShortcutHint: "Á¥†Êó©„Åè„ÇÅ„Åè„Å£„Å¶Ë¶ö„Åà„Åæ„Åó„Çá„ÅÜ",
            footerLocaleHint: "„Éñ„É©„Ç¶„Ç∂Ë®ÄË™û„Å´Âêà„Çè„Åõ„ÅüË°®Á§∫",
            cardFrontLabel: "Â≠¶ÁøíË®ÄË™û",
            cardBackLabel: "Ë®≥",
            cardTapHint: "„Çø„ÉÉ„Éó„Åæ„Åü„ÅØ Space „Ç≠„Éº„Åß„ÇÅ„Åè„Çä„Åæ„Åô„ÄÇ",
          },
        };

        const decks = {
          en: [
            {
              id: "en-1",
              source: "Where is the train station?",
              target: "Where is the train station?",
              romanized: "",
              context: "Finding transportation",
            },
            {
              id: "en-2",
              source: "How much does this cost?",
              target: "How much does this cost?",
              romanized: "",
              context: "Shopping",
            },
            {
              id: "en-3",
              source: "I have a reservation.",
              target: "I have a reservation.",
              romanized: "",
              context: "Hotel check-in",
            },
            {
              id: "en-4",
              source: "Can you recommend a good restaurant?",
              target: "Can you recommend a good restaurant?",
              romanized: "",
              context: "Asking locals",
            },
            {
              id: "en-5",
              source: "Where is the nearest ATM?",
              target: "Where is the nearest ATM?",
              romanized: "",
              context: "Money & banks",
            },
            {
              id: "en-6",
              source: "Do you speak English?",
              target: "Do you speak English?",
              romanized: "",
              context: "Language help",
            },
            {
              id: "en-7",
              source: "I am allergic to peanuts.",
              target: "I am allergic to peanuts.",
              romanized: "",
              context: "Food & safety",
            },
            {
              id: "en-8",
              source: "Where is the bathroom?",
              target: "Where is the bathroom?",
              romanized: "",
              context: "Essentials",
            },
            {
              id: "en-9",
              source: "Can you take a photo of us?",
              target: "Can you take a photo of us?",
              romanized: "",
              context: "Social",
            },
            {
              id: "en-10",
              source: "What time does it open?",
              target: "What time does it open?",
              romanized: "",
              context: "Opening hours",
            },
          ],
          es: [
            {
              id: "es-1",
              source: "Where is the train station?",
              target: "¬øD√≥nde est√° la estaci√≥n de tren?",
              romanized: "",
              context: "Transporte",
            },
            {
              id: "es-2",
              source: "How much does this cost?",
              target: "¬øCu√°nto cuesta esto?",
              romanized: "",
              context: "Compras",
            },
            {
              id: "es-3",
              source: "I have a reservation.",
              target: "Tengo una reserva.",
              romanized: "",
              context: "Hotel",
            },
            {
              id: "es-4",
              source: "Can you recommend a good restaurant?",
              target: "¬øPuede recomendarme un buen restaurante?",
              romanized: "",
              context: "Recomendaciones",
            },
            {
              id: "es-5",
              source: "Where is the nearest ATM?",
              target: "¬øD√≥nde est√° el cajero autom√°tico m√°s cercano?",
              romanized: "",
              context: "Dinero",
            },
            {
              id: "es-6",
              source: "Do you speak English?",
              target: "¬øHabla ingl√©s?",
              romanized: "",
              context: "Idioma",
            },
            {
              id: "es-7",
              source: "I am allergic to peanuts.",
              target: "Soy al√©rgico a los cacahuetes.",
              romanized: "",
              context: "Salud",
            },
            {
              id: "es-8",
              source: "Where is the bathroom?",
              target: "¬øD√≥nde est√° el ba√±o?",
              romanized: "",
              context: "B√°sico",
            },
            {
              id: "es-9",
              source: "Can you take a photo of us?",
              target: "¬øPuede sacarnos una foto?",
              romanized: "",
              context: "Social",
            },
            {
              id: "es-10",
              source: "What time does it open?",
              target: "¬øA qu√© hora abre?",
              romanized: "",
              context: "Horarios",
            },
          ],
          fr: [
            {
              id: "fr-1",
              source: "Where is the train station?",
              target: "O√π est la gare ?",
              romanized: "",
              context: "Transport",
            },
            {
              id: "fr-2",
              source: "How much does this cost?",
              target: "Combien √ßa co√ªte ?",
              romanized: "",
              context: "Shopping",
            },
            {
              id: "fr-3",
              source: "I have a reservation.",
              target: "J‚Äôai une r√©servation.",
              romanized: "",
              context: "H√¥tel",
            },
            {
              id: "fr-4",
              source: "Can you recommend a good restaurant?",
              target: "Pouvez-vous recommander un bon restaurant ?",
              romanized: "",
              context: "Conseils",
            },
            {
              id: "fr-5",
              source: "Where is the nearest ATM?",
              target: "O√π est le distributeur le plus proche ?",
              romanized: "",
              context: "Argent",
            },
            {
              id: "fr-6",
              source: "Do you speak English?",
              target: "Parlez-vous anglais ?",
              romanized: "",
              context: "Langue",
            },
            {
              id: "fr-7",
              source: "I am allergic to peanuts.",
              target: "Je suis allergique aux cacahu√®tes.",
              romanized: "",
              context: "Sant√©",
            },
            {
              id: "fr-8",
              source: "Where is the bathroom?",
              target: "O√π sont les toilettes ?",
              romanized: "",
              context: "Essentiel",
            },
            {
              id: "fr-9",
              source: "Can you take a photo of us?",
              target: "Pouvez-vous nous prendre en photo ?",
              romanized: "",
              context: "Social",
            },
            {
              id: "fr-10",
              source: "What time does it open?",
              target: "√Ä quelle heure √ßa ouvre ?",
              romanized: "",
              context: "Horaires",
            },
          ],
          ja: [
            {
              id: "ja-1",
              source: "Where is the train station?",
              target: "ÈßÖ„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü",
              romanized: "Eki wa doko desu ka?",
              context: "‰∫§ÈÄö",
            },
            {
              id: "ja-2",
              source: "How much does this cost?",
              target: "„Åì„Çå„ÅØ„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü",
              romanized: "Kore wa ikura desu ka?",
              context: "Ë≤∑„ÅÑÁâ©",
            },
            {
              id: "ja-3",
              source: "I have a reservation.",
              target: "‰∫àÁ¥Ñ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
              romanized: "Yoyaku ga arimasu.",
              context: "„Éõ„ÉÜ„É´",
            },
            {
              id: "ja-4",
              source: "Can you recommend a good restaurant?",
              target: "„Åä„Åô„Åô„ÇÅ„ÅÆ„É¨„Çπ„Éà„É©„É≥„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü",
              romanized: "Osusume no resutoran wa arimasu ka?",
              context: "„Åä„Åô„Åô„ÇÅ",
            },
            {
              id: "ja-5",
              source: "Where is the nearest ATM?",
              target: "‰∏ÄÁï™Ëøë„ÅÑATM„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü",
              romanized: "Ichiban chikai ƒì-tƒ´-emu wa doko desu ka?",
              context: "„ÅäÈáë",
            },
            {
              id: "ja-6",
              source: "Do you speak English?",
              target: "Ëã±Ë™û„ÇíË©±„Åõ„Åæ„Åô„ÅãÔºü",
              romanized: "Eigo o hanasemasu ka?",
              context: "Ë®ÄË™û",
            },
            {
              id: "ja-7",
              source: "I am allergic to peanuts.",
              target: "„Éî„Éº„Éä„ÉÉ„ÉÑ„Ç¢„É¨„É´„ÇÆ„Éº„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
              romanized: "Pƒ´nattsu arerugƒ´ ga arimasu.",
              context: "ÂÅ•Â∫∑",
            },
            {
              id: "ja-8",
              source: "Where is the bathroom?",
              target: "„Éà„Ç§„É¨„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü",
              romanized: "Toire wa doko desu ka?",
              context: "Âü∫Êú¨",
            },
            {
              id: "ja-9",
              source: "Can you take a photo of us?",
              target: "ÂÜôÁúü„ÇíÊíÆ„Å£„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü",
              romanized: "Shashin o totte moraemasu ka?",
              context: "‰∫§ÊµÅ",
            },
            {
              id: "ja-10",
              source: "What time does it open?",
              target: "‰ΩïÊôÇ„Å´Èñã„Åç„Åæ„Åô„ÅãÔºü",
              romanized: "Nanji ni hirakimasu ka?",
              context: "Âñ∂Ê•≠ÊôÇÈñì",
            },
          ],
        };

        const appRoot = document.getElementById("appRoot");
        const flashcardShell = document.getElementById("flashcardShell");
        const shuffleBtn = document.getElementById("shuffleBtn");
        const resetBtn = document.getElementById("resetBtn");
        const uiLanguageSelect = document.getElementById("uiLanguageSelect");
        const learningLanguageSelect = document.getElementById(
          "learningLanguageSelect"
        );
        const learnedList = document.getElementById("learnedList");
        const learnedEmpty = document.getElementById("learnedEmpty");

        const statLearnedValue = document.getElementById("statLearnedValue");
        const statLearnedUnit = document.getElementById("statLearnedUnit");
        const statLanguageValue = document.getElementById("statLanguageValue");
        const statLearnedBar = document.getElementById("statLearnedBar");
        const statRemainingValue = document.getElementById("statRemainingValue");
        const statRemainingBar = document.getElementById("statRemainingBar");
        const statTotalValue = document.getElementById("statTotalValue");

        const textElements = {
          appTitle: document.getElementById("appTitle"),
          appSubtitle: document.getElementById("appSubtitle"),
          statusLabel: document.getElementById("statusLabel"),
          statusValue: document.getElementById("statusValue"),
          uiLanguageLabel: document.getElementById("uiLanguageLabel"),
          deckLabel: document.getElementById("deckLabel"),
          chipFlip: document.getElementById("chipFlip"),
          chipLearn: document.getElementById("chipLearn"),
          shuffleLabel: document.getElementById("shuffleLabel"),
          shuffleSubLabel: document.getElementById("shuffleSubLabel"),
          resetLabel: document.getElementById("resetLabel"),
          resetSubLabel: document.getElementById("resetSubLabel"),
          statsTitle: document.getElementById("statsTitle"),
          statsSubtitle: document.getElementById("statsSubtitle"),
          statLearnedLabel: document.getElementById("statLearnedLabel"),
          statLanguageLabel: document.getElementById("statLanguageLabel"),
          statMeta: document.getElementById("statMeta"),
          statDeckLabel: document.getElementById("statDeckLabel"),
          statRemainingUnit: document.getElementById("statRemainingUnit"),
          statTotalLabel: document.getElementById("statTotalLabel"),
          statDeckMeta: document.getElementById("statDeckMeta"),
          learnedListTitle: document.getElementById("learnedListTitle"),
          learnedEmpty: document.getElementById("learnedEmpty"),
          footerLeft: document.getElementById("footerLeft"),
          footerShortcutHint: document.getElementById("footerShortcutHint"),
          footerLocaleHint: document.getElementById("footerLocaleHint"),
          hintContainer: document.getElementById("hintFlip"),
          hintTip: document.getElementById("hintTip"),
        };

        const LOCAL_STORAGE_KEY = "travel-flashcards-progress-v1";

        function detectInitialUiLanguage() {
          const browser = (navigator.language || navigator.userLanguage || "en")
            .toLowerCase()
            .slice(0, 2);
          if (browser === "es") return "es";
          if (browser === "fr") return "fr";
          if (browser === "ja") return "ja";
          return "en";
        }

        function shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
        }

        function loadProgress() {
          try {
            const raw = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (!raw) return {};
            const parsed = JSON.parse(raw);
            if (!parsed || typeof parsed !== "object") return {};
            return parsed;
          } catch (e) {
            return {};
          }
        }

        function saveProgress(progress) {
          try {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(progress));
          } catch (e) {}
        }

        let state = {
          uiLanguage: detectInitialUiLanguage(),
          learningLanguage: "en",
          deckOrder: [],
          currentIndex: 0,
          isFlipped: false,
          learned: loadProgress(),
        };

        function applyUiStrings() {
          const strings = uiStrings[state.uiLanguage] || uiStrings.en;
          textElements.appTitle.textContent = strings.appTitle;
          textElements.appSubtitle.textContent = strings.appSubtitle;
          textElements.statusLabel.textContent = strings.statusLabel;
          textElements.statusValue.textContent = strings.statusValue;
          textElements.uiLanguageLabel.textContent = strings.uiLanguageLabel;
          textElements.deckLabel.textContent = strings.deckLabel;
          textElements.chipFlip.textContent = strings.chipFlip;
          textElements.chipLearn.textContent = strings.chipLearn;
          textElements.shuffleLabel.textContent = strings.shuffleLabel;
          textElements.shuffleSubLabel.textContent = strings.shuffleSubLabel;
          textElements.resetLabel.textContent = strings.resetLabel;
          textElements.resetSubLabel.textContent = strings.resetSubLabel;
          textElements.statsTitle.textContent = strings.statsTitle;
          textElements.statsSubtitle.textContent = strings.statsSubtitle;
          textElements.statLearnedLabel.textContent = strings.statLearnedLabel;
          statLearnedUnit.textContent = strings.statLearnedUnit;
          textElements.statLanguageLabel.textContent =
            strings.statLanguageLabel;
          textElements.statMeta.textContent = strings.statMeta;
          textElements.statDeckLabel.textContent = strings.statDeckLabel;
          textElements.statRemainingUnit.textContent =
            strings.statRemainingUnit;
          textElements.statTotalLabel.textContent = strings.statTotalLabel;
          textElements.statDeckMeta.textContent = strings.statDeckMeta;
          textElements.learnedListTitle.textContent =
            strings.learnedListTitle;
          textElements.learnedEmpty.textContent = strings.learnedEmpty;
          textElements.footerLeft.textContent = strings.footerLeft;
          textElements.footerShortcutHint.textContent =
            strings.footerShortcutHint;
          textElements.footerLocaleHint.textContent =
            strings.footerLocaleHint;
          textElements.hintTip.textContent = strings.hintTip;
          textElements.hintContainer.innerHTML = strings.hintFlip;
        }

        function getDeck(language) {
          return decks[language] || decks.en;
        }

        function initDeckForLanguage(language) {
          const deck = getDeck(language);
          const baseOrder = deck.map((card) => card.id);
          shuffleArray(baseOrder);
          state.deckOrder = baseOrder;
          state.currentIndex = 0;
          state.isFlipped = false;
          updateStats();
          renderFlashcard();
          updateButtons();
        }

        function currentDeck() {
          return getDeck(state.learningLanguage);
        }

        function getCardById(id) {
          const deck = currentDeck();
          return deck.find((c) => c.id === id) || deck[0];
        }

        function getCurrentCard() {
          const id = state.deckOrder[state.currentIndex];
          return getCardById(id);
        }

        function getLearnedForLanguage(lang) {
          const forLang = state.learned[lang];
          if (!forLang || !Array.isArray(forLang)) return [];
          return forLang;
        }

        function markCardLearned(cardId) {
          const lang = state.learningLanguage;
          const learnedForLang = getLearnedForLanguage(lang);
          if (!learnedForLang.includes(cardId)) {
            const next = learnedForLang.concat(cardId);
            state.learned = {
              ...state.learned,
              [lang]: next,
            };
            saveProgress(state.learned);
          }
          updateStats();
          updateLearnedList();
        }

        function resetLearnedForLanguage(lang) {
          if (state.learned[lang]) {
            const next = { ...state.learned };
            delete next[lang];
            state.learned = next;
            saveProgress(state.learned);
          }
          updateStats();
          updateLearnedList();
        }

        function updateStats() {
          const deck = currentDeck();
          const total = deck.length;
          const learnedIds = getLearnedForLanguage(state.learningLanguage);
          const learnedCount = Math.min(learnedIds.length, total);
          const remaining = Math.max(total - learnedCount, 0);
          statLearnedValue.textContent = learnedCount.toString();
          statRemainingValue.textContent = remaining.toString();
          statTotalValue.textContent = total.toString();
          statLanguageValue.textContent = languageDisplayName(
            state.learningLanguage
          );
          const learnedPct = total === 0 ? 0 : (learnedCount / total) * 100;
          const remainingPct = total === 0 ? 0 : (remaining / total) * 100;
          statLearnedBar.style.width = learnedPct.toFixed(0) + "%";
          statRemainingBar.style.width = remainingPct.toFixed(0) + "%";
        }

        function languageDisplayName(code) {
          switch (code) {
            case "es":
              return "Espa√±ol";
            case "fr":
              return "Fran√ßais";
            case "ja":
              return "Êó•Êú¨Ë™û";
            default:
              return "English";
          }
        }

        function updateLearnedList() {
          const lang = state.learningLanguage;
          const learnedIds = getLearnedForLanguage(lang);
          while (learnedList.firstChild) {
            learnedList.removeChild(learnedList.firstChild);
          }
          if (!learnedIds.length) {
            learnedEmpty.textContent =
              uiStrings[state.uiLanguage]?.learnedEmpty ||
              uiStrings.en.learnedEmpty;
            learnedEmpty.id = "learnedEmpty";
            learnedEmpty.className = "list-empty-state";
            learnedList.appendChild(learnedEmpty);
            return;
          }

          learnedIds.forEach((id) => {
            const card = getCardById(id);
            const li = document.createElement("li");
            li.className = "list-learned-item";
            const main = document.createElement("div");
            main.className = "list-learned-main";
            const primary = document.createElement("div");
            primary.className = "list-learned-phrase";
            primary.textContent = card.target;
            const sub = document.createElement("div");
            sub.className = "list-learned-sub";
            sub.textContent = card.source;
            main.appendChild(primary);
            main.appendChild(sub);
            li.appendChild(main);
            const tag = document.createElement("div");
            tag.className = "list-learned-tag";
            tag.textContent = card.context;
            li.appendChild(tag);
            learnedList.appendChild(li);
          });
        }

        function updateButtons() {
          const hasDeck = state.deckOrder.length > 0;
          shuffleBtn.disabled = !hasDeck;
          resetBtn.disabled = !hasDeck;
        }

        function renderFlashcard() {
          while (flashcardShell.firstChild) {
            flashcardShell.removeChild(flashcardShell.firstChild);
          }

          if (!state.deckOrder.length) return;
          const strings = uiStrings[state.uiLanguage] || uiStrings.en;
          const card = getCurrentCard();
          const indexDisplay = `${state.currentIndex + 1} / ${
            state.deckOrder.length
          }`;

          const wrapper = document.createElement("div");
          wrapper.className = "card-wrapper" + (state.isFlipped ? " flipped" : "");
          wrapper.setAttribute("role", "button");
          wrapper.setAttribute("aria-label", strings.cardTapHint);
          wrapper.setAttribute("tabindex", "0");

          const shadow = document.createElement("div");
          shadow.className = "card-shadow";

          const cardEl = document.createElement("article");
          cardEl.className = "flashcard";
          cardEl.setAttribute("aria-live", "polite");

          const front = document.createElement("div");
          front.className = "card-face front";
          const frontTagRow = document.createElement("div");
          frontTagRow.className = "card-tag-row";
          const frontTag = document.createElement("div");
          frontTag.className = "card-tag card-tag-accent";
          frontTag.innerHTML =
            "<span>" +
            strings.cardFrontLabel +
            "</span><span class='card-tag-pill'>" +
            languageDisplayName(state.learningLanguage) +
            "</span>";
          const frontIndex = document.createElement("div");
          frontIndex.className = "card-index-pill";
          frontIndex.textContent = indexDisplay;
          frontTagRow.appendChild(frontTag);
          frontTagRow.appendChild(frontIndex);
          const frontBody = document.createElement("div");
          frontBody.className = "card-body";
          const mainPhrase = document.createElement("div");
          mainPhrase.className = "card-phrase-main";
          mainPhrase.textContent = card.target;
          const roman =
            card.romanized && card.romanized.trim()
              ? document.createElement("div")
              : null;
          if (roman) {
            roman.className = "card-phrase-romanized";
            roman.textContent = card.romanized;
          }
          const subtitle = document.createElement("div");
          subtitle.className = "card-phrase-subtitle";
          subtitle.textContent = card.context;
          frontBody.appendChild(mainPhrase);
          if (roman) frontBody.appendChild(roman);
          frontBody.appendChild(subtitle);
          const frontFooter = document.createElement("div");
          frontFooter.className = "card-footer";
          const footerLeft = document.createElement("div");
          footerLeft.className = "card-footer-icon";
          footerLeft.innerHTML = "<span>üëÜ</span><span>" +
            strings.cardTapHint +
            "</span>";
          const footerRight = document.createElement("div");
          footerRight.className = "card-progress";
          const progressLabel = document.createElement("span");
          progressLabel.textContent = "10 cards";
          const progressBar = document.createElement("div");
          progressBar.className = "card-progress-bar";
          const progressFill = document.createElement("div");
          progressFill.className = "card-progress-bar-fill";
          const learnedCount = getLearnedForLanguage(state.learningLanguage)
            .length;
          const pct = (learnedCount / currentDeck().length) * 100;
          progressFill.style.width = pct.toFixed(0) + "%";
          progressBar.appendChild(progressFill);
          footerRight.appendChild(progressLabel);
          footerRight.appendChild(progressBar);
          frontFooter.appendChild(footerLeft);
          frontFooter.appendChild(footerRight);
          front.appendChild(frontTagRow);
          front.appendChild(frontBody);
          front.appendChild(frontFooter);

          const back = document.createElement("div");
          back.className = "card-face back";
          const backTagRow = document.createElement("div");
          backTagRow.className = "card-tag-row";
          const backTag = document.createElement("div");
          backTag.className = "card-tag";
          backTag.innerHTML =
            "<span>" +
            strings.cardBackLabel +
            "</span><span class='card-tag-pill'>English</span>";
          const backIndex = document.createElement("div");
          backIndex.className = "card-index-pill";
          backIndex.textContent = indexDisplay;
          backTagRow.appendChild(backTag);
          backTagRow.appendChild(backIndex);
          const backBody = document.createElement("div");
          backBody.className = "card-body";
          const backMain = document.createElement("div");
          backMain.className = "card-phrase-main";
          backMain.textContent = card.source;
          const backSubtitle = document.createElement("div");
          backSubtitle.className = "card-phrase-subtitle";
          backSubtitle.textContent = card.context;
          backBody.appendChild(backMain);
          backBody.appendChild(backSubtitle);
          const backFooter = document.createElement("div");
          backFooter.className = "card-footer";
          const backLeft = document.createElement("div");
          backLeft.className = "card-footer-icon";
          backLeft.innerHTML =
            "<span>‚úÖ</span><span class='card-footer-cta'>Press L to mark learned</span>";
          const backRight = document.createElement("div");
          backRight.className = "card-progress";
          const backHint = document.createElement("span");
          backHint.textContent = "Flip again to review.";
          backRight.appendChild(backHint);
          backFooter.appendChild(backLeft);
          backFooter.appendChild(backRight);
          back.appendChild(backTagRow);
          back.appendChild(backBody);
          back.appendChild(backFooter);

          cardEl.appendChild(front);
          cardEl.appendChild(back);
          wrapper.appendChild(cardEl);
          wrapper.appendChild(shadow);
          flashcardShell.appendChild(wrapper);

          function toggleFlip() {
            state.isFlipped = !state.isFlipped;
            wrapper.classList.toggle("flipped", state.isFlipped);
          }

          wrapper.addEventListener("click", function (event) {
            if (event.target.closest("button")) return;
            toggleFlip();
          });

          wrapper.addEventListener("keydown", function (event) {
            if (event.key === "Enter" || event.key === " ") {
              event.preventDefault();
              toggleFlip();
            }
          });

          return wrapper;
        }

        function animateShuffle() {
          flashcardShell.classList.remove("deck-shuffle-anim");
          void flashcardShell.offsetWidth;
          flashcardShell.classList.add("deck-shuffle-anim");
        }

        function handleShuffle() {
          if (!state.deckOrder.length) return;
          shuffleArray(state.deckOrder);
          state.currentIndex = 0;
          state.isFlipped = false;
          animateShuffle();
          renderFlashcard();
          updateButtons();
        }

        function handleMarkLearned() {
          if (!state.deckOrder.length) return;
          const currentCard = getCurrentCard();
          markCardLearned(currentCard.id);

          const wrapper = flashcardShell.querySelector(".card-wrapper");
          if (!wrapper) {
            renderFlashcard();
            return;
          }

          wrapper.classList.add("leaving");

          function afterAnimation() {
            wrapper.removeEventListener("animationend", afterAnimation);
            if (state.currentIndex < state.deckOrder.length - 1) {
              state.currentIndex += 1;
            }
            state.isFlipped = false;
            renderFlashcard();
            updateButtons();
          }

          wrapper.addEventListener("animationend", afterAnimation);
        }

        function handleReset() {
          resetLearnedForLanguage(state.learningLanguage);
          initDeckForLanguage(state.learningLanguage);
        }

        function handleKeydown(event) {
          const tag = event.target.tagName.toLowerCase();
          if (tag === "input" || tag === "textarea" || tag === "select") return;
          if (event.key === " " || event.code === "Space") {
            event.preventDefault();
            const wrapper = flashcardShell.querySelector(".card-wrapper");
            if (wrapper) {
              wrapper.click();
            }
          } else if (
            event.key.toLowerCase() === "l" ||
            event.code === "KeyL"
          ) {
            event.preventDefault();
            handleMarkLearned();
          }
        }

        shuffleBtn.addEventListener("click", handleShuffle);
        resetBtn.addEventListener("click", handleReset);

        uiLanguageSelect.addEventListener("change", function () {
          const next = uiLanguageSelect.value;
          if (!uiStrings[next]) return;
          state.uiLanguage = next;
          applyUiStrings();
          updateLearnedList();
          renderFlashcard();
        });

        learningLanguageSelect.addEventListener("change", function () {
          const next = learningLanguageSelect.value;
          state.learningLanguage = next;
          initDeckForLanguage(next);
          updateLearnedList();
        });

        document.addEventListener("keydown", handleKeydown);

        (function bootstrap() {
          uiLanguageSelect.value = state.uiLanguage;
          applyUiStrings();
          const browserLang = detectInitialUiLanguage();
          learningLanguageSelect.value = browserLang;
          state.learningLanguage = browserLang;
          initDeckForLanguage(browserLang);
          updateLearnedList();
          appRoot.classList.add("ready");
        })();
      })();
    </script>
  </body>
</html>

