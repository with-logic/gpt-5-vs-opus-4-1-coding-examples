<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Interactive World Clock</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta
      name="description"
      content="Interactive World Clock – track current time across cities with a day/night aware interface."
    />
    <style>
      :root {
        color-scheme: dark;
        --bg-gradient-start: #020617;
        --bg-gradient-end: #020617;
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.25);
        --text-main: #e5e7eb;
        --text-soft: #9ca3af;
        --card-bg: rgba(15, 23, 42, 0.92);
        --card-border: rgba(148, 163, 184, 0.25);
        --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.8);
        --radius-xl: 18px;
        --transition-fast: 160ms ease-out;
        --transition-med: 220ms ease-out;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Inter", "Segoe UI", sans-serif;
        background: radial-gradient(
            circle at top left,
            rgba(56, 189, 248, 0.25),
            transparent 55%
          ),
          radial-gradient(
            circle at bottom right,
            rgba(168, 85, 247, 0.18),
            transparent 55%
          ),
          linear-gradient(145deg, var(--bg-gradient-start), var(--bg-gradient-end));
        color: var(--text-main);
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
      }

      body {
        display: flex;
        align-items: stretch;
        justify-content: center;
      }

      .app-shell {
        position: relative;
        width: 100%;
        max-width: 1120px;
        margin: 32px auto;
        padding: 24px 20px 28px;
      }

      @media (min-width: 768px) {
        .app-shell {
          margin: 40px auto;
          padding: 28px 24px 32px;
        }
      }

      .glass-panel {
        position: relative;
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        background: radial-gradient(
            circle at top,
            rgba(15, 23, 42, 0.95),
            rgba(15, 23, 42, 0.96)
          ),
          linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.95),
            rgba(15, 23, 42, 0.98)
          );
        box-shadow: 0 22px 60px rgba(15, 23, 42, 0.95);
        padding: 22px 18px 22px;
        overflow: hidden;
      }

      @media (min-width: 768px) {
        .glass-panel {
          padding: 26px 24px 26px;
        }
      }

      .orbital-backdrop {
        pointer-events: none;
        position: absolute;
        inset: 0;
        opacity: 0.55;
        mix-blend-mode: screen;
      }

      .orbital-backdrop::before,
      .orbital-backdrop::after {
        content: "";
        position: absolute;
        border-radius: 999px;
        border: 1px dashed rgba(148, 163, 184, 0.16);
        box-shadow: 0 0 60px rgba(15, 23, 42, 0.3);
      }

      .orbital-backdrop::before {
        width: 520px;
        height: 520px;
        top: -260px;
        right: -220px;
        border-color: rgba(56, 189, 248, 0.35);
      }

      .orbital-backdrop::after {
        width: 420px;
        height: 420px;
        bottom: -260px;
        left: -210px;
        border-color: rgba(168, 85, 247, 0.3);
      }

      .orbital-dot {
        position: absolute;
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: linear-gradient(135deg, #f97316, #eab308);
        box-shadow: 0 0 16px rgba(249, 115, 22, 0.85);
        animation: orbit 26s linear infinite;
        top: 2%;
        right: 7%;
      }

      @keyframes orbit {
        0% {
          transform: translate(0, 0);
        }
        25% {
          transform: translate(-26px, 48px);
        }
        50% {
          transform: translate(-6px, 132px);
        }
        75% {
          transform: translate(56px, 56px);
        }
        100% {
          transform: translate(0, 0);
        }
      }

      .app-inner {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: 22px;
      }

      header.app-header {
        display: flex;
        flex-direction: column;
        gap: 18px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.28);
        padding-bottom: 18px;
      }

      @media (min-width: 768px) {
        header.app-header {
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          gap: 24px;
          padding-bottom: 20px;
        }
      }

      .title-block {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .app-kicker {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: #9ca3af;
      }

      .app-kicker-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 20%, #fcd34d, #f97316);
        box-shadow: 0 0 12px rgba(248, 250, 252, 0.65);
      }

      .app-title {
        font-size: clamp(1.5rem, 1.25rem + 0.5vw, 1.8rem);
        letter-spacing: -0.02em;
        display: flex;
        align-items: baseline;
        gap: 10px;
      }

      .app-title span.primary {
        font-weight: 600;
      }

      .app-title span.secondary {
        font-weight: 400;
        font-size: 0.86em;
        color: #9ca3af;
      }

      .app-subtitle {
        font-size: 0.9rem;
        color: var(--text-soft);
        max-width: 30rem;
      }

      .header-right {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      @media (min-width: 640px) {
        .header-right {
          flex-direction: row;
          align-items: center;
          justify-content: flex-end;
          gap: 14px;
        }
      }

      .format-toggle {
        border-radius: 999px;
        padding: 6px 10px 6px 10px;
        border: 1px solid rgba(148, 163, 184, 0.55);
        background: radial-gradient(
            circle at top,
            rgba(15, 23, 42, 0.9),
            rgba(15, 23, 42, 0.95)
          ),
          linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.9),
            rgba(15, 23, 42, 0.95)
          );
        color: var(--text-main);
        font-size: 0.8rem;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        transition: border-color var(--transition-fast),
          box-shadow var(--transition-fast), background var(--transition-fast),
          transform 120ms ease-out;
        box-shadow: 0 10px 26px rgba(15, 23, 42, 0.8);
      }

      .format-toggle:focus-visible {
        outline: 2px solid #38bdf8;
        outline-offset: 2px;
      }

      .format-toggle:hover {
        border-color: rgba(56, 189, 248, 0.8);
        box-shadow: 0 14px 30px rgba(15, 23, 42, 0.9);
        transform: translateY(-1px);
      }

      .format-toggle-label {
        text-transform: uppercase;
        letter-spacing: 0.16em;
        font-size: 10px;
        color: #9ca3af;
      }

      .format-toggle-pill {
        --thumb-translate: 0%;
        position: relative;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        padding: 2px;
        border-radius: 999px;
        background: radial-gradient(
            circle at 10% 0,
            rgba(148, 163, 184, 0.32),
            transparent 50%
          ),
          rgba(15, 23, 42, 0.9);
        min-width: 92px;
        font-size: 0.78rem;
      }

      .format-toggle-option {
        position: relative;
        text-align: center;
        padding: 4px 7px;
        z-index: 1;
        color: #9ca3af;
        transition: color var(--transition-fast);
      }

      .format-toggle-option span {
        opacity: 0.85;
      }

      .format-toggle-thumb {
        position: absolute;
        inset: 2px;
        width: calc(50% - 3px);
        border-radius: 999px;
        background: radial-gradient(
            circle at top,
            rgba(56, 189, 248, 0.95),
            rgba(37, 99, 235, 0.95)
          ),
          linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(56, 189, 248, 0.9));
        box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.1),
          0 0 22px rgba(56, 189, 248, 0.65);
        transform: translateX(var(--thumb-translate));
        transition: transform var(--transition-med);
      }

      .format-toggle[data-format="12"] .format-toggle-pill {
        --thumb-translate: 0%;
      }

      .format-toggle[data-format="24"] .format-toggle-pill {
        --thumb-translate: 100%;
      }

      .format-toggle[data-format="12"]
        .format-toggle-option[data-option="12"],
      .format-toggle[data-format="24"]
        .format-toggle-option[data-option="24"] {
        color: #e5e7eb;
      }

      .local-summary {
        display: inline-flex;
        align-items: center;
        justify-content: flex-end;
        gap: 10px;
        padding: 7px 11px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.52);
        background: radial-gradient(
            circle at 0 0,
            rgba(56, 189, 248, 0.3),
            transparent 55%
          ),
          rgba(15, 23, 42, 0.96);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.85);
        min-width: 0;
      }

      .local-summary-icon {
        width: 24px;
        height: 24px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 20%, #facc15, #f97316);
        box-shadow: 0 0 14px rgba(234, 179, 8, 0.9);
        position: relative;
      }

      .local-summary-icon::after {
        content: "";
        position: absolute;
        inset: 4px;
        border-radius: inherit;
        border: 1px solid rgba(15, 23, 42, 0.6);
      }

      .local-summary-body {
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 0;
      }

      .local-summary-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: #9ca3af;
      }

      .local-summary-main {
        font-size: 0.9rem;
        font-variant-numeric: tabular-nums;
        white-space: nowrap;
      }

      .local-summary-zone {
        font-size: 0.76rem;
        color: var(--text-soft);
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        max-width: 240px;
      }

      main.app-main {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .toolbar-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
        flex-wrap: wrap;
      }

      .toolbar-hint {
        font-size: 0.76rem;
        color: #9ca3af;
      }

      .toolbar-hint-strong {
        color: #e5e7eb;
        font-weight: 500;
      }

      .add-city-button {
        border-radius: 999px;
        border: 1px solid rgba(56, 189, 248, 0.8);
        background: radial-gradient(
            circle at 10% 0,
            rgba(56, 189, 248, 0.35),
            transparent 55%
          ),
          rgba(15, 23, 42, 0.96);
        color: #e5e7eb;
        padding: 7px 14px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        cursor: pointer;
        box-shadow: 0 12px 32px rgba(15, 23, 42, 0.9);
        transition: background var(--transition-fast),
          box-shadow var(--transition-fast), transform 120ms ease-out;
      }

      .add-city-button:hover {
        box-shadow: 0 16px 40px rgba(15, 23, 42, 0.95);
        transform: translateY(-1px);
        background: radial-gradient(
            circle at 10% 0,
            rgba(56, 189, 248, 0.48),
            transparent 55%
          ),
          rgba(15, 23, 42, 0.98);
      }

      .add-city-button:focus-visible {
        outline: 2px solid #38bdf8;
        outline-offset: 2px;
      }

      .add-city-button-icon {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        border: 1px solid rgba(56, 189, 248, 0.8);
        background: rgba(15, 23, 42, 0.9);
      }

      .city-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 14px;
      }

      @media (min-width: 1024px) {
        .city-grid {
          gap: 16px;
        }
      }

      .city-card {
        position: relative;
        border-radius: var(--radius-xl);
        border: 1px solid var(--card-border);
        background:
          radial-gradient(
            circle at 0 0,
            rgba(56, 189, 248, 0.18),
            transparent 58%
          ),
          radial-gradient(
            circle at 100% 0,
            rgba(248, 250, 252, 0.06),
            transparent 60%
          ),
          radial-gradient(
            circle at 50% 120%,
            rgba(15, 23, 42, 0.9),
            rgba(15, 23, 42, 0.98)
          );
        box-shadow: var(--shadow-soft);
        padding: 13px 12px 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        gap: 10px;
        transform-origin: center;
        transition: transform var(--transition-fast),
          box-shadow var(--transition-fast), border-color var(--transition-fast),
          background var(--transition-med), opacity 100ms ease-out;
        --accent-hue: 210;
        --accent-lightness: 52%;
      }

      @media (min-width: 900px) {
        .city-card {
          padding: 14px 14px 13px;
        }
      }

      .city-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at 0 -20%,
          hsla(var(--accent-hue), 95%, 68%, 0.58),
          transparent 58%
        );
        opacity: 0.8;
        mix-blend-mode: screen;
        pointer-events: none;
      }

      .city-card::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at 50% 130%,
          hsla(var(--accent-hue), 100%, 10%, 0.4),
          transparent 55%
        );
        opacity: 1;
        pointer-events: none;
      }

      .city-card-inner {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .city-card:hover {
        transform: translateY(-2px) translateZ(0);
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.95);
        border-color: rgba(148, 163, 184, 0.75);
      }

      .city-card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .city-meta {
        display: flex;
        flex-direction: column;
        gap: 3px;
        min-width: 0;
      }

      .city-name-row {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .city-name {
        font-size: 0.98rem;
        font-weight: 600;
        letter-spacing: -0.01em;
      }

      .badge {
        border-radius: 999px;
        padding: 2px 7px;
        font-size: 0.68rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        border: 1px solid rgba(148, 163, 184, 0.6);
        color: #9ca3af;
        background: rgba(15, 23, 42, 0.9);
      }

      .badge-local {
        border-color: rgba(56, 189, 248, 0.9);
        color: #e5e7eb;
        background: radial-gradient(
            circle at 0 0,
            rgba(56, 189, 248, 0.45),
            transparent 55%
          ),
          rgba(15, 23, 42, 0.98);
      }

      .city-subtitle {
        font-size: 0.78rem;
        color: var(--text-soft);
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        max-width: 180px;
      }

      .remove-city-button {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.55);
        background: rgba(15, 23, 42, 0.95);
        color: #9ca3af;
        width: 26px;
        height: 26px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        padding: 0;
        cursor: pointer;
        transition: background var(--transition-fast),
          border-color var(--transition-fast), color var(--transition-fast),
          transform 120ms ease-out;
      }

      .remove-city-button:hover {
        background: rgba(248, 113, 113, 0.15);
        border-color: rgba(239, 68, 68, 0.8);
        color: #fecaca;
        transform: translateY(-1px);
      }

      .remove-city-button:focus-visible {
        outline: 2px solid rgba(239, 68, 68, 0.9);
        outline-offset: 2px;
      }

      .remove-city-button[disabled] {
        opacity: 0.5;
        cursor: default;
      }

      .city-main-time {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .time-row {
        display: flex;
        align-items: baseline;
        gap: 4px;
        font-variant-numeric: tabular-nums;
      }

      .time-value {
        font-size: 1.6rem;
        font-weight: 600;
        letter-spacing: -0.04em;
      }

      .time-seconds {
        font-size: 0.86rem;
        color: #9ca3af;
        min-width: 1.8em;
      }

      .time-period {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: #9ca3af;
      }

      .date-row {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.78rem;
        color: var(--text-soft);
        flex-wrap: wrap;
      }

      .date-value {
        white-space: nowrap;
      }

      .gmt-offset {
        padding: 2px 7px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.55);
        font-variant-numeric: tabular-nums;
      }

      .city-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-top: 1px;
      }

      .phase-indicator {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .phase-icon {
        width: 20px;
        height: 20px;
        border-radius: 999px;
        background: radial-gradient(
          circle at 30% 20%,
          hsla(var(--accent-hue), 93%, 68%, 0.96),
          hsla(var(--accent-hue), 95%, 55%, 0.95)
        );
        display: inline-flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 14px
          hsla(var(--accent-hue), 95%, var(--accent-lightness), 0.95);
      }

      .phase-label {
        font-size: 0.8rem;
        color: #e5e7eb;
        text-transform: capitalize;
      }

      .relative-time {
        font-size: 0.78rem;
        color: var(--text-soft);
        text-align: right;
      }

      .relative-time-strong {
        color: #e5e7eb;
      }

      .time-orbit {
        position: absolute;
        inset: -24px;
        border-radius: inherit;
        border: 1px dashed rgba(148, 163, 184, 0.16);
        opacity: 0.65;
        pointer-events: none;
      }

      .time-orbit-dot {
        position: absolute;
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: radial-gradient(
          circle at 30% 20%,
          hsla(var(--accent-hue), 96%, 80%, 1),
          hsla(var(--accent-hue), 95%, 65%, 1)
        );
        box-shadow: 0 0 12px
          hsla(var(--accent-hue), 95%, var(--accent-lightness), 0.95);
        transform-origin: center center;
      }

      .city-card[data-phase="night"] {
        --accent-hue: 220;
        --accent-lightness: 52%;
      }

      .city-card[data-phase="morning"] {
        --accent-hue: 42;
        --accent-lightness: 64%;
      }

      .city-card[data-phase="afternoon"] {
        --accent-hue: 196;
        --accent-lightness: 58%;
      }

      .city-card[data-phase="evening"] {
        --accent-hue: 265;
        --accent-lightness: 52%;
      }

      .city-card[data-phase="night"] .phase-label {
        opacity: 0.96;
      }

      .city-card[data-phase="night"] .gmt-offset {
        border-color: rgba(148, 163, 184, 0.65);
      }

      .dialog-root {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        opacity: 0;
        transition: opacity var(--transition-med);
        z-index: 30;
      }

      .dialog-root.is-visible {
        pointer-events: auto;
        opacity: 1;
      }

      .dialog-backdrop {
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle at top,
            rgba(15, 23, 42, 0.86),
            rgba(15, 23, 42, 0.96)
          ),
          rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .dialog-panel {
        position: relative;
        z-index: 1;
        width: min(460px, 100% - 36px);
        max-height: min(480px, 100% - 72px);
        border-radius: 20px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: radial-gradient(
            circle at 0 0,
            rgba(56, 189, 248, 0.3),
            transparent 54%
          ),
          rgba(15, 23, 42, 0.98);
        box-shadow: 0 26px 80px rgba(15, 23, 42, 0.98);
        padding: 16px 15px 14px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        transform: translateY(8px) scale(0.98);
        opacity: 0;
        transition: opacity var(--transition-med),
          transform var(--transition-med);
      }

      .dialog-root.is-visible .dialog-panel {
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      @media (min-width: 640px) {
        .dialog-panel {
          padding: 18px 18px 16px;
        }
      }

      .dialog-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .dialog-title {
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .dialog-title-pill {
        border-radius: 999px;
        padding: 2px 7px;
        font-size: 0.68rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        border: 1px solid rgba(148, 163, 184, 0.65);
        color: #9ca3af;
        background: rgba(15, 23, 42, 0.96);
      }

      .dialog-close-button {
        border-radius: 999px;
        width: 26px;
        height: 26px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.98);
        color: #9ca3af;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        padding: 0;
        transition: background var(--transition-fast),
          border-color var(--transition-fast), color var(--transition-fast),
          transform 120ms ease-out;
      }

      .dialog-close-button:hover {
        background: rgba(15, 23, 42, 0.9);
        border-color: rgba(248, 113, 113, 0.8);
        color: #fecaca;
        transform: translateY(-1px);
      }

      .dialog-close-button:focus-visible {
        outline: 2px solid rgba(248, 113, 113, 0.9);
        outline-offset: 2px;
      }

      .dialog-description {
        font-size: 0.8rem;
        color: var(--text-soft);
      }

      .dialog-body {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .search-field-wrapper {
        position: relative;
      }

      .search-input {
        width: 100%;
        border-radius: 999px;
        padding: 7px 32px 7px 26px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: radial-gradient(
            circle at 0 0,
            rgba(56, 189, 248, 0.22),
            transparent 55%
          ),
          rgba(15, 23, 42, 0.98);
        color: #e5e7eb;
        font-size: 0.85rem;
        box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
      }

      .search-input::placeholder {
        color: rgba(148, 163, 184, 0.85);
      }

      .search-input:focus-visible {
        outline: 2px solid rgba(56, 189, 248, 0.9);
        outline-offset: 2px;
      }

      .search-icon {
        position: absolute;
        left: 9px;
        top: 50%;
        transform: translateY(-50%);
        width: 12px;
        height: 12px;
        border-radius: 999px;
        border: 2px solid rgba(148, 163, 184, 0.8);
      }

      .search-icon::after {
        content: "";
        position: absolute;
        width: 6px;
        height: 1.5px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.8);
        transform: rotate(45deg);
        transform-origin: right center;
        right: -3px;
        bottom: 0;
      }

      .search-kbd-hint {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.7rem;
        color: rgba(148, 163, 184, 0.95);
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        padding: 2px 5px;
        background: rgba(15, 23, 42, 0.98);
      }

      .timezone-list {
        border-radius: 16px;
        border: 1px solid rgba(31, 41, 55, 0.85);
        background: radial-gradient(
            circle at 0 0,
            rgba(56, 189, 248, 0.15),
            transparent 55%
          ),
          rgba(15, 23, 42, 0.98);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
        padding: 4px;
        max-height: 290px;
        overflow: auto;
      }

      .timezone-list::-webkit-scrollbar {
        width: 6px;
      }

      .timezone-list::-webkit-scrollbar-track {
        background: transparent;
      }

      .timezone-list::-webkit-scrollbar-thumb {
        background: rgba(55, 65, 81, 0.9);
        border-radius: 999px;
      }

      .timezone-list-item {
        width: 100%;
        border-radius: 12px;
        border: 1px solid transparent;
        background: transparent;
        color: inherit;
        text-align: left;
        padding: 7px 8px 7px;
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr) auto;
        column-gap: 8px;
        row-gap: 2px;
        align-items: center;
        font-size: 0.8rem;
        cursor: pointer;
        transition: background var(--transition-fast),
          border-color var(--transition-fast), transform 120ms ease-out;
      }

      .timezone-list-item:hover {
        background: radial-gradient(
            circle at 0 0,
            rgba(56, 189, 248, 0.35),
            transparent 55%
          ),
          rgba(15, 23, 42, 0.96);
        border-color: rgba(56, 189, 248, 0.9);
        transform: translateY(-1px);
      }

      .timezone-list-city {
        font-weight: 500;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }

      .timezone-list-region {
        font-size: 0.76rem;
        color: var(--text-soft);
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }

      .timezone-list-zone {
        justify-self: flex-end;
        font-size: 0.76rem;
        color: #9ca3af;
        font-variant-numeric: tabular-nums;
      }

      .timezone-empty {
        padding: 12px 10px;
        font-size: 0.8rem;
        color: var(--text-soft);
        text-align: center;
      }

      .timezone-empty span {
        color: #e5e7eb;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }

      @media (max-width: 480px) {
        header.app-header {
          padding-bottom: 16px;
        }

        .city-card {
          padding: 12px 10px 11px;
        }

        .city-name {
          font-size: 0.94rem;
        }

        .time-value {
          font-size: 1.45rem;
        }
      }

      svg.icon {
        width: 14px;
        height: 14px;
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <div class="glass-panel">
        <div class="orbital-backdrop">
          <div class="orbital-dot"></div>
        </div>
        <div class="app-inner">
          <header class="app-header">
            <div class="title-block">
              <div class="app-kicker">
                <div class="app-kicker-dot" aria-hidden="true"></div>
                <span>Interactive World Clock</span>
              </div>
              <div class="app-title">
                <span class="primary">Global time,</span>
                <span class="secondary">at a single glance.</span>
              </div>
              <p class="app-subtitle">
                Add cities, switch between 12 and 24&nbsp;hour formats, and see
                how every location moves from night to day.
              </p>
            </div>
            <div class="header-right">
              <button
                id="format-toggle"
                class="format-toggle"
                type="button"
                role="switch"
                aria-checked="false"
                aria-label="Toggle 12 or 24 hour time"
                data-format="24"
              >
                <span class="format-toggle-label">Time format</span>
                <span class="format-toggle-pill">
                  <span
                    class="format-toggle-option"
                    data-option="12"
                    aria-hidden="true"
                  >
                    <span>12h</span>
                  </span>
                  <span
                    class="format-toggle-option"
                    data-option="24"
                    aria-hidden="true"
                  >
                    <span>24h</span>
                  </span>
                  <span
                    class="format-toggle-thumb"
                    aria-hidden="true"
                  ></span>
                </span>
              </button>
              <div class="local-summary" aria-live="polite">
                <div class="local-summary-icon" aria-hidden="true"></div>
                <div class="local-summary-body">
                  <div class="local-summary-label">Local time</div>
                  <div class="local-summary-main" id="local-time-main">
                    --
                  </div>
                  <div class="local-summary-zone" id="local-time-zone">
                    Detecting timezone…
                  </div>
                </div>
              </div>
            </div>
          </header>
          <main class="app-main">
            <div class="toolbar-row">
              <div class="toolbar-hint">
                <span class="toolbar-hint-strong">Tip:</span> hover a city to
                see its glow change with the time of day.
              </div>
              <button
                id="add-city-button"
                type="button"
                class="add-city-button"
              >
                <span class="add-city-button-icon" aria-hidden="true">+</span>
                <span>Add city</span>
              </button>
            </div>
            <section
              aria-label="World clock cards"
              class="city-grid"
              id="city-grid"
            ></section>
          </main>
        </div>
      </div>
    </div>

    <div
      class="dialog-root"
      id="add-city-dialog"
      aria-hidden="true"
      aria-labelledby="add-city-title"
      aria-modal="true"
    >
      <div class="dialog-backdrop"></div>
      <div class="dialog-panel" role="dialog">
        <div class="dialog-header">
          <h2 class="dialog-title" id="add-city-title">
            Add a city
            <span class="dialog-title-pill">World map</span>
          </h2>
          <button
            type="button"
            class="dialog-close-button"
            id="add-city-close"
            aria-label="Close add city"
          >
            ×
          </button>
        </div>
        <p class="dialog-description">
          Search for a city or timezone, then pick a card to add it to your
          dashboard.
        </p>
        <div class="dialog-body">
          <div class="search-field-wrapper">
            <span class="search-icon" aria-hidden="true"></span>
            <input
              type="search"
              class="search-input"
              id="city-search"
              placeholder="Start typing a city, country, or timezone…"
              autocomplete="off"
            />
            <span class="search-kbd-hint">⌘K</span>
          </div>
          <div
            class="timezone-list"
            id="timezone-list"
            aria-label="Available cities"
          ></div>
        </div>
      </div>
    </div>

    <template id="city-card-template">
      <article class="city-card" data-timezone="">
        <div class="city-card-inner">
          <header class="city-card-header">
            <div class="city-meta">
              <div class="city-name-row">
                <h2 class="city-name"></h2>
                <span class="badge badge-local" data-role="local-badge"
                  >Local</span
                >
              </div>
              <div class="city-subtitle"></div>
            </div>
            <button
              type="button"
              class="remove-city-button"
              title="Remove city"
              aria-label="Remove city"
              data-role="remove"
            >
              ×
            </button>
          </header>
          <div class="city-main-time">
            <div class="time-row">
              <span class="time-value">--:--</span>
              <span class="time-seconds">--</span>
              <span class="time-period"></span>
            </div>
            <div class="date-row">
              <span class="date-value">—</span>
              <span class="gmt-offset">GMT</span>
            </div>
          </div>
          <footer class="city-footer">
            <div class="phase-indicator">
              <div class="phase-icon" aria-hidden="true">
                <svg
                  class="icon"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <circle cx="12" cy="12" r="4"></circle>
                </svg>
              </div>
              <span class="phase-label">—</span>
            </div>
            <div class="relative-time">
              <span class="relative-time-strong">Now</span>
            </div>
          </footer>
        </div>
        <div class="time-orbit">
          <div class="time-orbit-dot"></div>
        </div>
      </article>
    </template>

    <svg
      aria-hidden="true"
      width="0"
      height="0"
      style="position: absolute; width: 0; height: 0; overflow: hidden"
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        <symbol id="icon-moon" viewBox="0 0 24 24">
          <path
            d="M21 12.79A8.25 8.25 0 0111.21 3 7 7 0 1019 14.79 8.26 8.26 0 0121 12.79z"
            fill="currentColor"
          />
        </symbol>
        <symbol id="icon-sunrise" viewBox="0 0 24 24">
          <path
            d="M5 18a7 7 0 0114 0"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
          />
          <path
            d="M12 4v5"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
          />
          <path
            d="M9.5 8.5L12 6l2.5 2.5"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M4 21h16"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
          />
        </symbol>
        <symbol id="icon-sun" viewBox="0 0 24 24">
          <circle
            cx="12"
            cy="12"
            r="4"
            stroke="currentColor"
            stroke-width="1.6"
            fill="none"
          />
          <path
            d="M12 3v2.5M12 18.5V21M4.22 4.22L5.8 5.8M18.2 18.2l1.58 1.58M3 12h2.5M18.5 12H21M4.22 19.78L5.8 18.2M18.2 5.8l1.58-1.58"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
          />
        </symbol>
        <symbol id="icon-sunset" viewBox="0 0 24 24">
          <path
            d="M5 17a7 7 0 0114 0"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
          />
          <path
            d="M12 15v5"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
          />
          <path
            d="M9.5 18.5L12 21l2.5-2.5"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M4 7h2M18 7h2M6.34 4.34L7.76 5.76M16.24 5.76l1.42-1.42"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
          />
        </symbol>
      </defs>
    </svg>

    <script>
      (function () {
        "use strict";

        const STORAGE_KEY = "interactive-world-clock-state-v1";

        const PHASES = {
          night: {
            label: "Night",
            iconId: "icon-moon",
          },
          morning: {
            label: "Morning",
            iconId: "icon-sunrise",
          },
          afternoon: {
            label: "Afternoon",
            iconId: "icon-sun",
          },
          evening: {
            label: "Evening",
            iconId: "icon-sunset",
          },
        };

        const TIMEZONE_OPTIONS = (function () {
          const entries = [
            {
              city: "New York",
              region: "United States",
              timeZone: "America/New_York",
            },
            {
              city: "Los Angeles",
              region: "United States",
              timeZone: "America/Los_Angeles",
            },
            {
              city: "Chicago",
              region: "United States",
              timeZone: "America/Chicago",
            },
            {
              city: "Mexico City",
              region: "Mexico",
              timeZone: "America/Mexico_City",
            },
            {
              city: "São Paulo",
              region: "Brazil",
              timeZone: "America/Sao_Paulo",
            },
            {
              city: "Buenos Aires",
              region: "Argentina",
              timeZone: "America/Argentina/Buenos_Aires",
            },
            {
              city: "London",
              region: "United Kingdom",
              timeZone: "Europe/London",
            },
            {
              city: "Reykjavík",
              region: "Iceland",
              timeZone: "Atlantic/Reykjavik",
            },
            {
              city: "Paris",
              region: "France",
              timeZone: "Europe/Paris",
            },
            {
              city: "Berlin",
              region: "Germany",
              timeZone: "Europe/Berlin",
            },
            {
              city: "Madrid",
              region: "Spain",
              timeZone: "Europe/Madrid",
            },
            {
              city: "Rome",
              region: "Italy",
              timeZone: "Europe/Rome",
            },
            {
              city: "Athens",
              region: "Greece",
              timeZone: "Europe/Athens",
            },
            {
              city: "Cairo",
              region: "Egypt",
              timeZone: "Africa/Cairo",
            },
            {
              city: "Johannesburg",
              region: "South Africa",
              timeZone: "Africa/Johannesburg",
            },
            {
              city: "Nairobi",
              region: "Kenya",
              timeZone: "Africa/Nairobi",
            },
            {
              city: "Dubai",
              region: "United Arab Emirates",
              timeZone: "Asia/Dubai",
            },
            {
              city: "Moscow",
              region: "Russia",
              timeZone: "Europe/Moscow",
            },
            {
              city: "Istanbul",
              region: "Türkiye",
              timeZone: "Europe/Istanbul",
            },
            {
              city: "Karachi",
              region: "Pakistan",
              timeZone: "Asia/Karachi",
            },
            {
              city: "Mumbai",
              region: "India",
              timeZone: "Asia/Kolkata",
            },
            {
              city: "Dhaka",
              region: "Bangladesh",
              timeZone: "Asia/Dhaka",
            },
            {
              city: "Bangkok",
              region: "Thailand",
              timeZone: "Asia/Bangkok",
            },
            {
              city: "Singapore",
              region: "Singapore",
              timeZone: "Asia/Singapore",
            },
            {
              city: "Hong Kong",
              region: "China",
              timeZone: "Asia/Hong_Kong",
            },
            {
              city: "Tokyo",
              region: "Japan",
              timeZone: "Asia/Tokyo",
            },
            {
              city: "Seoul",
              region: "South Korea",
              timeZone: "Asia/Seoul",
            },
            {
              city: "Sydney",
              region: "Australia",
              timeZone: "Australia/Sydney",
            },
            {
              city: "Melbourne",
              region: "Australia",
              timeZone: "Australia/Melbourne",
            },
            {
              city: "Auckland",
              region: "New Zealand",
              timeZone: "Pacific/Auckland",
            },
            {
              city: "Honolulu",
              region: "United States",
              timeZone: "Pacific/Honolulu",
            },
            {
              city: "Anchorage",
              region: "United States",
              timeZone: "America/Anchorage",
            },
            {
              city: "Vancouver",
              region: "Canada",
              timeZone: "America/Vancouver",
            },
            {
              city: "Toronto",
              region: "Canada",
              timeZone: "America/Toronto",
            },
            {
              city: "Beijing",
              region: "China",
              timeZone: "Asia/Shanghai",
            },
            {
              city: "Jakarta",
              region: "Indonesia",
              timeZone: "Asia/Jakarta",
            },
            {
              city: "Manila",
              region: "Philippines",
              timeZone: "Asia/Manila",
            },
            {
              city: "Wellington",
              region: "New Zealand",
              timeZone: "Pacific/Auckland",
            },
          ];
          return entries;
        })();

        function getLocalTimeZone() {
          try {
            return Intl.DateTimeFormat().resolvedOptions().timeZone;
          } catch (e) {
            return "Etc/UTC";
          }
        }

        function detect24hPreference() {
          try {
            const date = new Date(Date.UTC(2020, 0, 1, 13, 0, 0));
            const formatted = date.toLocaleTimeString(undefined, {
              hour: "numeric",
              minute: "2-digit",
            });
            const uses12 = /AM|PM/i.test(formatted);
            return !uses12;
          } catch (e) {
            return true;
          }
        }

        function safeLoadState() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return null;
            const parsed = JSON.parse(raw);
            if (!parsed || typeof parsed !== "object") return null;
            if (!Array.isArray(parsed.cities)) return null;
            return parsed;
          } catch (e) {
            return null;
          }
        }

        function safeSaveState(state) {
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
          } catch (e) {
            /* ignore */
          }
        }

        function makeCity(entry, overrides) {
          const base = {
            id: entry.timeZone,
            city: entry.city,
            region: entry.region,
            timeZone: entry.timeZone,
            isLocal: !!entry.isLocal,
          };
          if (overrides && typeof overrides === "object") {
            for (const key in overrides) {
              base[key] = overrides[key];
            }
          }
          return base;
        }

        function getDefaultCities() {
          const localTz = getLocalTimeZone();
          const localMatch = TIMEZONE_OPTIONS.find(
            (option) => option.timeZone === localTz
          );

          const localCity = makeCity(
            localMatch || {
              city: "Your location",
              region: localTz.replace(/_/g, " "),
              timeZone: localTz,
            },
            { isLocal: true, id: "local-" + localTz }
          );

          const core = [
            "America/New_York",
            "Europe/London",
            "Europe/Paris",
            "Asia/Tokyo",
            "Australia/Sydney",
          ];

          const cities = [localCity];
          for (const tz of core) {
            if (tz === localTz) continue;
            const match = TIMEZONE_OPTIONS.find(
              (option) => option.timeZone === tz
            );
            if (match) cities.push(makeCity(match));
          }
          return cities;
        }

        const initialState = (function () {
          const stored = safeLoadState();
          if (stored) {
            return {
              is24h: !!stored.is24h,
              cities: stored.cities
                .filter(
                  (c) =>
                    c &&
                    typeof c.timeZone === "string" &&
                    typeof c.city === "string"
                )
                .map((c) =>
                  makeCity(
                    {
                      city: c.city,
                      region: c.region || "",
                      timeZone: c.timeZone,
                      isLocal: !!c.isLocal,
                    },
                    { id: c.id || c.timeZone }
                  )
                ),
            };
          }
          return {
            is24h: detect24hPreference(),
            cities: getDefaultCities(),
          };
        })();

        const state = {
          is24h: initialState.is24h,
          cities: initialState.cities,
        };

        const elements = {
          grid: document.getElementById("city-grid"),
          cardTemplate: document.getElementById("city-card-template"),
          formatToggle: document.getElementById("format-toggle"),
          addCityButton: document.getElementById("add-city-button"),
          dialogRoot: document.getElementById("add-city-dialog"),
          dialogClose: document.getElementById("add-city-close"),
          searchInput: document.getElementById("city-search"),
          timezoneList: document.getElementById("timezone-list"),
          localTimeMain: document.getElementById("local-time-main"),
          localTimeZone: document.getElementById("local-time-zone"),
        };

        const cityElements = new Map();

        function zonedDate(now, timeZone) {
          try {
            const formatter = new Intl.DateTimeFormat("en-US", {
              timeZone,
              year: "numeric",
              month: "2-digit",
              day: "2-digit",
              hour: "2-digit",
              minute: "2-digit",
              second: "2-digit",
              hour12: false,
            });
            const parts = formatter
              .formatToParts(now)
              .reduce(function (acc, part) {
                if (part.type !== "literal") {
                  acc[part.type] = parseInt(part.value, 10);
                }
                return acc;
              }, {});
            return new Date(
              parts.year || now.getUTCFullYear(),
              (parts.month || 1) - 1,
              parts.day || 1,
              parts.hour || 0,
              parts.minute || 0,
              parts.second || 0,
              now.getMilliseconds()
            );
          } catch (e) {
            return new Date(now.getTime());
          }
        }

        function formatTimeParts(date, is24h) {
          let hours = date.getHours();
          const minutes = date.getMinutes();
          const seconds = date.getSeconds();
          let period = "";
          if (!is24h) {
            period = hours >= 12 ? "PM" : "AM";
            hours = hours % 12;
            if (hours === 0) hours = 12;
          }
          const hourStr = String(hours).padStart(is24h ? 2 : 1, "0");
          const minuteStr = String(minutes).padStart(2, "0");
          const secondStr = String(seconds).padStart(2, "0");
          return {
            hourStr,
            minuteStr,
            secondStr,
            period,
          };
        }

        function formatDate(date) {
          try {
            return date.toLocaleDateString(undefined, {
              weekday: "short",
              month: "short",
              day: "numeric",
            });
          } catch (e) {
            return (
              date.getFullYear() +
              "-" +
              String(date.getMonth() + 1).padStart(2, "0") +
              "-" +
              String(date.getDate()).padStart(2, "0")
            );
          }
        }

        function getGmtOffset(now, timeZone) {
          try {
            const fmt = new Intl.DateTimeFormat("en-US", {
              timeZone,
              timeZoneName: "short",
              hour: "2-digit",
              minute: "2-digit",
            });
            const parts = fmt.formatToParts(now);
            const tzNamePart = parts.find(
              (p) => p.type === "timeZoneName"
            );
            if (tzNamePart && tzNamePart.value) {
              return tzNamePart.value.replace(/^GMT/, "UTC");
            }
          } catch (e) {
            /* ignore */
          }
          return "UTC";
        }

        function getPhase(hour) {
          if (hour >= 5 && hour < 11) return "morning";
          if (hour >= 11 && hour < 17) return "afternoon";
          if (hour >= 17 && hour < 21) return "evening";
          return "night";
        }

        function computeRelative(nowLocal, targetDate) {
          const diffMs = targetDate.getTime() - nowLocal.getTime();
          const diffHours = diffMs / (1000 * 60 * 60);
          const roundedHours =
            Math.abs(diffHours) < 0.5
              ? 0
              : Math.round(diffHours * 2) / 2;
          const dayOffset = Math.round(diffMs / (1000 * 60 * 60 * 24));
          let dayWord = "Today";
          if (dayOffset > 0) dayWord = "Tomorrow";
          else if (dayOffset < 0) dayWord = "Yesterday";

          if (roundedHours === 0) {
            return { label: dayWord + " · same time", emphasis: true };
          }

          const ahead = diffHours > 0;
          const abs = Math.abs(roundedHours);
          const hours = Math.floor(abs);
          const minutes = Math.round((abs - hours) * 60);

          var parts = [];
          if (hours) {
            parts.push(hours + "h");
          }
          if (minutes) {
            parts.push(minutes + "m");
          }
          const deltaStr = parts.join(" ");
          const direction = ahead ? "ahead" : "behind";
          return {
            label: dayWord + " · " + deltaStr + " " + direction,
            emphasis: false,
          };
        }

        function timeOrbitAngle(date) {
          const totalSeconds =
            date.getHours() * 3600 +
            date.getMinutes() * 60 +
            date.getSeconds();
          const angle = (totalSeconds / 86400) * 360;
          return angle;
        }

        function describeTimeZoneId(id) {
          if (!id) return "";
          return id.replace(/_/g, " ").replace(/\//g, " / ");
        }

        function syncFormatToggle() {
          const is24h = !!state.is24h;
          elements.formatToggle.dataset.format = is24h ? "24" : "12";
          elements.formatToggle.setAttribute(
            "aria-checked",
            is24h ? "true" : "false"
          );
        }

        function createCityCard(city) {
          const fragment = elements.cardTemplate.content.cloneNode(true);
          const card = fragment.querySelector(".city-card");
          const nameEl = fragment.querySelector(".city-name");
          const subtitleEl = fragment.querySelector(".city-subtitle");
          const removeBtn = fragment.querySelector(
            '[data-role="remove"]'
          );
          const localBadge = fragment.querySelector(
            '[data-role="local-badge"]'
          );

          card.dataset.timezone = city.timeZone;
          card.dataset.cityId = city.id;

          nameEl.textContent = city.city;
          subtitleEl.textContent = city.region || describeTimeZoneId(
            city.timeZone
          );

          if (!city.isLocal) {
            if (localBadge && localBadge.parentNode) {
              localBadge.parentNode.removeChild(localBadge);
            }
          }

          if (city.isLocal) {
            if (removeBtn) {
              removeBtn.disabled = true;
              removeBtn.setAttribute(
                "aria-label",
                "Local city cannot be removed"
              );
            }
          } else if (removeBtn) {
            removeBtn.addEventListener("click", function (event) {
              event.stopPropagation();
              removeCity(city.id);
            });
          }

          const orbitDot = fragment.querySelector(".time-orbit-dot");
          if (orbitDot) {
            orbitDot.dataset.cityId = city.id;
          }

          return card;
        }

        function renderCities() {
          cityElements.clear();
          elements.grid.innerHTML = "";
          state.cities.forEach(function (city) {
            const card = createCityCard(city);
            elements.grid.appendChild(card);
            cityElements.set(city.id, card);
          });
        }

        function addCityFromOption(option) {
          const existing = state.cities.some(
            (c) => c.timeZone === option.timeZone
          );
          if (existing) {
            closeDialog();
            return;
          }
          const city = makeCity(option);
          state.cities.push(city);
          safeSaveState(state);

          const card = createCityCard(city);
          elements.grid.appendChild(card);
          cityElements.set(city.id, card);
          tick();
          closeDialog();
        }

        function removeCity(cityId) {
          const index = state.cities.findIndex((c) => c.id === cityId);
          if (index === -1) return;
          const city = state.cities[index];
          if (city.isLocal) return;
          state.cities.splice(index, 1);
          safeSaveState(state);
          const el = cityElements.get(cityId);
          if (el && el.parentNode) {
            el.style.opacity = "0";
            setTimeout(function () {
              if (el.parentNode) {
                el.parentNode.removeChild(el);
              }
            }, 140);
          }
          cityElements.delete(cityId);
        }

        function renderTimezoneList(filterText) {
          const term = (filterText || "").toLowerCase();
          elements.timezoneList.innerHTML = "";

          const activeIds = new Set(
            state.cities.map(function (c) {
              return c.timeZone;
            })
          );

          const candidates = TIMEZONE_OPTIONS.filter(function (option) {
            if (activeIds.has(option.timeZone)) return false;
            if (!term) return true;
            const haystack =
              (option.city + " " + option.region + " " + option.timeZone)
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "");
            const needle = term
              .normalize("NFD")
              .replace(/[\u0300-\u036f]/g, "");
            return haystack.indexOf(needle) !== -1;
          });

          if (!candidates.length) {
            const empty = document.createElement("div");
            empty.className = "timezone-empty";
            empty.innerHTML =
              "No matches. Try another <span>city</span> or timezone.";
            elements.timezoneList.appendChild(empty);
            return;
          }

          candidates.forEach(function (option) {
            const button = document.createElement("button");
            button.type = "button";
            button.className = "timezone-list-item";
            button.dataset.timezone = option.timeZone;

            const cityEl = document.createElement("div");
            cityEl.className = "timezone-list-city";
            cityEl.textContent = option.city;

            const regionEl = document.createElement("div");
            regionEl.className = "timezone-list-region";
            regionEl.textContent = option.region;

            const zoneEl = document.createElement("div");
            zoneEl.className = "timezone-list-zone";
            zoneEl.textContent = option.timeZone.replace(
              /\//g,
              " / "
            );

            button.appendChild(cityEl);
            button.appendChild(regionEl);
            button.appendChild(zoneEl);

            elements.timezoneList.appendChild(button);
          });
        }

        function openDialog() {
          elements.dialogRoot.classList.add("is-visible");
          elements.dialogRoot.setAttribute("aria-hidden", "false");
          renderTimezoneList("");
          requestAnimationFrame(function () {
            try {
              elements.searchInput.focus();
              elements.searchInput.select();
            } catch (e) {
              /* ignore */
            }
          });
        }

        function closeDialog() {
          elements.dialogRoot.classList.remove("is-visible");
          elements.dialogRoot.setAttribute("aria-hidden", "true");
        }

        function syncLocalSummary(now) {
          const localTz = getLocalTimeZone();
          const localDate = zonedDate(now, localTz);
          const parts = formatTimeParts(localDate, state.is24h);
          elements.localTimeMain.textContent =
            parts.hourStr + ":" + parts.minuteStr + ":" + parts.secondStr;
          elements.localTimeZone.textContent =
            "Your timezone · " + describeTimeZoneId(localTz);
        }

        function buildPhaseIconSvg(phaseKey) {
          const phase = PHASES[phaseKey] || PHASES.night;
          const icon = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "svg"
          );
          icon.setAttribute("class", "icon");
          icon.setAttribute("viewBox", "0 0 24 24");
          const use = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "use"
          );
          use.setAttributeNS(
            "http://www.w3.org/1999/xlink",
            "href",
            "#" + phase.iconId
          );
          icon.appendChild(use);
          return icon;
        }

        function updateCityCard(city, card, now, nowLocal) {
          const timeZone = city.timeZone;
          const zoned = zonedDate(now, timeZone);
          const parts = formatTimeParts(zoned, state.is24h);
          const dateText = formatDate(zoned);
          const gmtOffset = getGmtOffset(now, timeZone);
          const phaseKey = getPhase(zoned.getHours());

          const timeValueEl = card.querySelector(".time-value");
          const secondsEl = card.querySelector(".time-seconds");
          const periodEl = card.querySelector(".time-period");
          const dateEl = card.querySelector(".date-value");
          const gmtEl = card.querySelector(".gmt-offset");
          const phaseLabelEl = card.querySelector(".phase-label");
          const phaseIconWrap = card.querySelector(".phase-icon");
          const relativeEl = card.querySelector(".relative-time");
          const orbitDot = card.querySelector(".time-orbit-dot");

          if (timeValueEl) {
            timeValueEl.textContent =
              parts.hourStr + ":" + parts.minuteStr;
          }
          if (secondsEl) {
            secondsEl.textContent = parts.secondStr;
          }
          if (periodEl) {
            periodEl.textContent = state.is24h ? "" : parts.period;
          }
          if (dateEl) {
            dateEl.textContent = dateText;
          }
          if (gmtEl) {
            gmtEl.textContent = gmtOffset;
          }

          const rel = computeRelative(nowLocal, zoned);
          if (relativeEl) {
            relativeEl.textContent = "";
            const strong = document.createElement("span");
            strong.className = "relative-time-strong";
            strong.textContent = rel.label.split(" · ")[0];
            relativeEl.appendChild(strong);

            const rest = rel.label.split(" · ")[1];
            if (rest) {
              const span = document.createElement("span");
              span.textContent = " · " + rest;
              relativeEl.appendChild(span);
            }
          }

          card.dataset.phase = phaseKey;
          if (phaseLabelEl) {
            phaseLabelEl.textContent = PHASES[phaseKey].label;
          }

          if (phaseIconWrap) {
            phaseIconWrap.innerHTML = "";
            const svg = buildPhaseIconSvg(phaseKey);
            phaseIconWrap.appendChild(svg);
          }

          const angle = timeOrbitAngle(zoned);
          if (orbitDot) {
            const radius = 50;
            const rad = (angle * Math.PI) / 180;
            const x = 50 + radius * Math.cos(rad);
            const y = 50 + radius * Math.sin(rad);
            orbitDot.style.top = y + "%";
            orbitDot.style.left = x + "%";
          }
        }

        function tick() {
          const now = new Date();
          const nowLocal = zonedDate(now, getLocalTimeZone());
          syncLocalSummary(now);
          state.cities.forEach(function (city) {
            const card = cityElements.get(city.id);
            if (!card) return;
            updateCityCard(city, card, now, nowLocal);
          });
        }

        function bindEvents() {
          elements.formatToggle.addEventListener("click", function () {
            state.is24h = !state.is24h;
            syncFormatToggle();
            safeSaveState(state);
            tick();
          });

          elements.addCityButton.addEventListener("click", function () {
            openDialog();
          });

          elements.dialogClose.addEventListener("click", function () {
            closeDialog();
          });

          elements.dialogRoot.addEventListener("click", function (event) {
            if (event.target === elements.dialogRoot) {
              closeDialog();
            }
          });

          elements.searchInput.addEventListener("input", function (event) {
            renderTimezoneList(event.target.value || "");
          });

          elements.timezoneList.addEventListener("click", function (event) {
            const item = event.target.closest(".timezone-list-item");
            if (!item) return;
            const tz = item.dataset.timezone;
            const option = TIMEZONE_OPTIONS.find(
              (opt) => opt.timeZone === tz
            );
            if (!option) return;
            addCityFromOption(option);
          });

          document.addEventListener("keydown", function (event) {
            const isMac = navigator.platform.indexOf("Mac") === 0;
            const modKey = isMac ? event.metaKey : event.ctrlKey;
            if (modKey && !event.shiftKey && !event.altKey) {
              if (
                event.key === "k" ||
                event.key === "K"
              ) {
                event.preventDefault();
                if (
                  elements.dialogRoot.classList.contains("is-visible")
                ) {
                  closeDialog();
                } else {
                  openDialog();
                }
              }
            }

            if (event.key === "Escape") {
              if (
                elements.dialogRoot.classList.contains("is-visible")
              ) {
                event.preventDefault();
                closeDialog();
              }
            }
          });

          document.addEventListener("visibilitychange", function () {
            if (document.visibilityState === "visible") {
              tick();
            }
          });
        }

        function init() {
          renderCities();
          syncFormatToggle();
          bindEvents();
          tick();
          setInterval(tick, 1000);
        }

        if (
          document.readyState === "interactive" ||
          document.readyState === "complete"
        ) {
          init();
        } else {
          document.addEventListener("DOMContentLoaded", init);
        }
      })();
    </script>
  </body>
</html>

