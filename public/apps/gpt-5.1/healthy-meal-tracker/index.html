<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Healthy Meal Tracker</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      :root {
        --bg: #0f172a;
        --bg-soft: #020617;
        --card: #020617;
        --card-soft: #02081a;
        --accent: #22c55e;
        --accent-soft: rgba(34, 197, 94, 0.12);
        --accent-strong: #16a34a;
        --accent-warn: #f97316;
        --accent-danger: #ef4444;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --border-subtle: rgba(148, 163, 184, 0.35);
        --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.85);
        --radius-lg: 18px;
        --radius-xl: 26px;
        --transition-fast: 160ms ease-out;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          sans-serif;
        color: var(--text);
        background:
          radial-gradient(circle at top left, #22c55e15 0, transparent 60%),
          radial-gradient(circle at bottom right, #22c55e10 0, transparent 55%),
          radial-gradient(circle at top right, #f9731615 0, transparent 55%),
          #020617;
        display: flex;
        align-items: stretch;
        justify-content: center;
        padding: 28px 16px 32px;
      }

      .app-shell {
        position: relative;
        width: 100%;
        max-width: 1120px;
        background: radial-gradient(circle at top, #0b1220 0, #020617 55%);
        border-radius: var(--radius-xl);
        border: 1px solid rgba(148, 163, 184, 0.35);
        box-shadow: var(--shadow-soft);
        padding: 22px 22px 24px;
        overflow: hidden;
      }

      @media (min-width: 768px) {
        .app-shell {
          padding: 26px 26px 26px;
        }
      }

      .app-shell::before {
        content: "";
        position: absolute;
        inset: -40%;
        background:
          radial-gradient(circle at 10% 0, #4ade8030 0, transparent 55%),
          radial-gradient(circle at 100% 0, #22c55e10 0, transparent 55%);
        opacity: 0.9;
        pointer-events: none;
        z-index: -1;
      }

      .app-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 20px;
      }

      .title-stack {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo-pill {
        width: 48px;
        height: 48px;
        border-radius: 999px;
        background: conic-gradient(
          from 210deg,
          #22c55e,
          #4ade80,
          #a3e635,
          #facc15,
          #f97316,
          #22c55e
        );
        padding: 2px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.3),
          0 15px 35px rgba(34, 197, 94, 0.4);
      }

      .logo-inner {
        width: 100%;
        height: 100%;
        border-radius: inherit;
        background: radial-gradient(circle at 30% 0, #111827, #020617 70%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
      }

      .title-text h1 {
        font-size: 1.5rem;
        letter-spacing: 0.03em;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .title-chip {
        font-size: 0.72rem;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(34, 197, 94, 0.12);
        color: #bbf7d0;
        border: 1px solid rgba(34, 197, 94, 0.45);
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .title-text p {
        margin: 3px 0 0;
        font-size: 0.86rem;
        color: var(--muted);
      }

      .pill-row {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: flex-end;
        gap: 8px;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border-radius: 999px;
        padding: 6px 10px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: linear-gradient(120deg, #020617bd, #020617f2);
        backdrop-filter: blur(18px);
        font-size: 0.78rem;
        color: var(--muted);
      }

      .pill i {
        color: #4ade80;
        font-size: 0.85rem;
      }

      .pill strong {
        color: #e5e7eb;
        font-weight: 600;
      }

      .app-main {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.95fr);
        gap: 18px;
        align-items: flex-start;
      }

      @media (max-width: 900px) {
        .app-main {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .card {
        position: relative;
        background: radial-gradient(circle at top, #020617, #020617);
        border-radius: var(--radius-lg);
        padding: 16px 16px 14px;
        border: 1px solid var(--border-subtle);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.78);
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        inset: 0;
        background:
          radial-gradient(circle at 0 0, rgba(34, 197, 94, 0.12), transparent 55%),
          radial-gradient(circle at 100% 100%, rgba(56, 189, 248, 0.05), transparent
                  55%);
        opacity: 0.85;
        pointer-events: none;
      }

      .card-inner {
        position: relative;
        z-index: 1;
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 10px;
      }

      .card-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.96rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--muted);
      }

      .card-title span.icon-circle {
        width: 24px;
        height: 24px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.95rem;
        background: rgba(34, 197, 94, 0.22);
        color: #bbf7d0;
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
      }

      .card-subtitle {
        font-size: 0.78rem;
        color: var(--muted);
      }

      .divider {
        margin: 8px 0 14px;
        border: none;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(148, 163, 184, 0.55),
          transparent
        );
      }

      .layout-two {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.9fr);
        gap: 16px;
      }

      @media (max-width: 840px) {
        .layout-two {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .field-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 10px;
      }

      .field {
        flex: 1 1 140px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .field label {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--muted);
      }

      .field span.label-extra {
        font-size: 0.7rem;
        color: var(--muted);
      }

      .input,
      .select,
      .textarea {
        width: 100%;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        padding: 7px 11px;
        font-size: 0.9rem;
        background: radial-gradient(circle at top left, #020617, #020617);
        color: var(--text);
        outline: none;
        transition: border-color var(--transition-fast),
          box-shadow var(--transition-fast), transform var(--transition-fast),
          background-color 140ms ease-out;
      }

      .textarea {
        resize: vertical;
        min-height: 70px;
        max-height: 140px;
        border-radius: 14px;
        padding-top: 8px;
        padding-bottom: 8px;
        font-size: 0.88rem;
      }

      .input:focus,
      .select:focus,
      .textarea:focus {
        border-color: rgba(74, 222, 128, 0.9);
        box-shadow:
          0 0 0 1px rgba(74, 222, 128, 0.6),
          0 0 0 6px rgba(34, 197, 94, 0.15);
        transform: translateY(-0.5px);
      }

      .input::placeholder,
      .textarea::placeholder {
        color: rgba(148, 163, 184, 0.7);
      }

      .select {
        appearance: none;
        -moz-appearance: none;
        -webkit-appearance: none;
        padding-right: 28px;
        background-image: linear-gradient(45deg, transparent 50%, #9ca3af 50%),
          linear-gradient(135deg, #9ca3af 50%, transparent 50%);
        background-position:
          calc(100% - 14px) 10px,
          calc(100% - 9px) 10px;
        background-size: 5px 5px, 5px 5px;
        background-repeat: no-repeat;
      }

      .input-number {
        font-variant-numeric: tabular-nums;
      }

      .muted {
        color: var(--muted);
        font-size: 0.78rem;
      }

      .muted strong {
        color: #e5e7eb;
      }

      .btn-row {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-top: 6px;
      }

      .btn-primary,
      .btn-ghost,
      .chip-secondary {
        border-radius: 999px;
        border: 1px solid transparent;
        padding: 7px 14px;
        font-size: 0.86rem;
        display: inline-flex;
        align-items: center;
        gap: 7px;
        cursor: pointer;
        background: none;
        color: inherit;
        transition: background-color var(--transition-fast),
          transform var(--transition-fast), box-shadow var(--transition-fast),
          border-color var(--transition-fast), color var(--transition-fast),
          opacity var(--transition-fast);
        outline: none;
        white-space: nowrap;
      }

      .btn-primary {
        background: linear-gradient(135deg, #22c55e, #4ade80);
        color: #022c22;
        border-color: rgba(21, 128, 61, 0.9);
        font-weight: 600;
        box-shadow:
          0 0 0 1px rgba(34, 197, 94, 0.4),
          0 14px 30px rgba(34, 197, 94, 0.45);
      }

      .btn-primary i {
        font-size: 0.86rem;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        background: linear-gradient(135deg, #22c55e, #a3e635);
        box-shadow:
          0 0 0 1px rgba(190, 242, 100, 0.8),
          0 16px 34px rgba(34, 197, 94, 0.72);
      }

      .btn-primary:active {
        transform: translateY(0);
        box-shadow:
          0 0 0 1px rgba(190, 242, 100, 0.9),
          0 9px 22px rgba(22, 163, 74, 0.8);
      }

      .btn-ghost {
        border-color: rgba(148, 163, 184, 0.7);
        color: var(--muted);
        background: rgba(15, 23, 42, 0.7);
      }

      .btn-ghost:hover {
        background: rgba(15, 23, 42, 0.92);
        color: #e5e7eb;
      }

      .btn-ghost i {
        font-size: 0.9rem;
      }

      .btn-ghost[data-variant="danger"] {
        border-color: rgba(248, 113, 113, 0.75);
        color: #fecaca;
      }

      .btn-ghost[data-variant="danger"]:hover {
        background: rgba(127, 29, 29, 0.8);
        color: #fee2e2;
      }

      .chip-secondary {
        padding-inline: 10px;
        border-color: rgba(148, 163, 184, 0.7);
        color: var(--muted);
        background: rgba(15, 23, 42, 0.7);
        font-size: 0.78rem;
      }

      .chip-secondary i {
        font-size: 0.78rem;
      }

      .chip-secondary span.strong {
        color: #e5e7eb;
        font-weight: 600;
      }

      .pill-group {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 4px;
      }

      .pill-small {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        font-size: 0.7rem;
        padding: 3px 8px;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        color: var(--muted);
        background: rgba(15, 23, 42, 0.85);
      }

      .pill-small i {
        font-size: 0.78rem;
      }

      .pill-small span.value {
        color: #e5e7eb;
        font-variant-numeric: tabular-nums;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 10px;
        margin-top: 6px;
      }

      @media (max-width: 640px) {
        .summary-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      .summary-card {
        border-radius: 14px;
        padding: 8px 10px 7px;
        border: 1px solid rgba(148, 163, 184, 0.55);
        background: radial-gradient(circle at top, #020617, #020617);
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 8px;
        align-items: center;
      }

      .summary-icon {
        width: 30px;
        height: 30px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        background: rgba(34, 197, 94, 0.13);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
      }

      .summary-label {
        font-size: 0.7rem;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.14em;
      }

      .summary-value {
        font-variant-numeric: tabular-nums;
        font-size: 1rem;
        font-weight: 600;
      }

      .summary-sub {
        font-size: 0.72rem;
        color: var(--muted);
      }

      .summary-value[data-tone="warning"] {
        color: var(--accent-warn);
      }

      .summary-value[data-tone="danger"] {
        color: var(--accent-danger);
      }

      .progress-wrapper {
        display: flex;
        gap: 14px;
        align-items: center;
        justify-content: center;
        margin-top: 2px;
      }

      .progress-ring {
        width: 142px;
        height: 142px;
        filter: drop-shadow(0 18px 35px rgba(15, 23, 42, 0.9));
      }

      .progress-labels {
        display: flex;
        flex-direction: column;
        gap: 4px;
        max-width: 180px;
      }

      .progress-title {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--muted);
      }

      .progress-main {
        display: flex;
        align-items: baseline;
        gap: 6px;
      }

      .progress-main span.value {
        font-size: 1.6rem;
        font-weight: 600;
        font-variant-numeric: tabular-nums;
      }

      .progress-main span.unit {
        font-size: 0.86rem;
        color: var(--muted);
      }

      .progress-caption {
        font-size: 0.78rem;
        color: var(--muted);
      }

      .tag-row {
        margin-top: 6px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .tag {
        border-radius: 999px;
        padding: 4px 9px 3px;
        font-size: 0.74rem;
        border: 1px solid rgba(148, 163, 184, 0.7);
        color: var(--muted);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .tag span.dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: linear-gradient(135deg, #22c55e, #a3e635);
        box-shadow: 0 0 0 1px rgba(190, 242, 100, 0.9);
      }

      .ingredients-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 8px;
        min-height: 20px;
      }

      .ingredient-chip {
        border-radius: 999px;
        padding: 3px 8px 3px;
        border: 1px solid rgba(148, 163, 184, 0.75);
        font-size: 0.72rem;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(15, 23, 42, 0.96);
        color: var(--muted);
      }

      .ingredient-chip span.dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: #4ade80;
      }

      .ingredient-chip strong {
        color: #e5e7eb;
      }

      .ingredient-chip span.count {
        font-variant-numeric: tabular-nums;
      }

      .ingredient-empty {
        font-size: 0.76rem;
        color: var(--muted);
      }

      .meals-header-row {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 10px;
      }

      .meals-badge {
        border-radius: 999px;
        padding: 3px 7px;
        font-size: 0.72rem;
        border: 1px solid rgba(148, 163, 184, 0.7);
        color: var(--muted);
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .meals-badge span.dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: #22c55e;
      }

      .meals-badge span.value {
        font-variant-numeric: tabular-nums;
        color: #e5e7eb;
      }

      .meals-actions {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 6px;
      }

      .meals-actions .btn-ghost {
        padding-inline: 9px;
        font-size: 0.8rem;
      }

      .meals-actions .btn-ghost i {
        font-size: 0.8rem;
      }

      .table-wrapper {
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.55);
        overflow: hidden;
        background: rgba(15, 23, 42, 0.96);
        max-height: 360px;
        display: flex;
        flex-direction: column;
      }

      .table-scroll {
        overflow: auto;
        scrollbar-width: thin;
        scrollbar-color: rgba(148, 163, 184, 0.8) rgba(15, 23, 42, 0.3);
      }

      .table-scroll::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      .table-scroll::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.7);
      }

      .table-scroll::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.85);
        border-radius: 999px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.86rem;
      }

      thead {
        background: rgba(15, 23, 42, 0.98);
        position: sticky;
        top: 0;
        z-index: 1;
      }

      th,
      td {
        padding: 7px 8px;
        text-align: left;
        border-bottom: 1px solid rgba(31, 41, 55, 0.95);
      }

      th {
        font-size: 0.74rem;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--muted);
        white-space: nowrap;
        background: rgba(15, 23, 42, 0.98);
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      tbody tr {
        transition: background-color 140ms ease-out, transform 140ms ease-out,
          box-shadow 140ms ease-out;
      }

      tbody tr:hover {
        background: radial-gradient(circle at 0 0, #064e3b80, transparent 55%);
        transform: translateY(-0.5px);
        box-shadow: 0 10px 28px rgba(15, 23, 42, 0.8);
      }

      .meal-main {
        display: flex;
        align-items: center;
        gap: 7px;
      }

      .meal-icon {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.86rem;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.7);
      }

      .meal-name {
        font-weight: 500;
      }

      .meal-type-pill {
        border-radius: 999px;
        padding: 3px 7px;
        font-size: 0.72rem;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        border: 1px solid transparent;
        color: var(--muted);
      }

      .meal-type-pill[data-type="Breakfast"] {
        background: rgba(59, 130, 246, 0.18);
        border-color: rgba(59, 130, 246, 0.8);
        color: #bfdbfe;
      }

      .meal-type-pill[data-type="Lunch"] {
        background: rgba(34, 197, 94, 0.18);
        border-color: rgba(34, 197, 94, 0.85);
        color: #bbf7d0;
      }

      .meal-type-pill[data-type="Dinner"] {
        background: rgba(248, 250, 252, 0.05);
        border-color: rgba(148, 163, 184, 0.9);
        color: #e5e7eb;
      }

      .meal-type-pill[data-type="Snack"] {
        background: rgba(249, 115, 22, 0.18);
        border-color: rgba(249, 115, 22, 0.9);
        color: #fed7aa;
      }

      .meal-type-pill[data-type="Drink"] {
        background: rgba(56, 189, 248, 0.18);
        border-color: rgba(56, 189, 248, 0.9);
        color: #bae6fd;
      }

      .meal-calories {
        font-variant-numeric: tabular-nums;
        text-align: right;
        white-space: nowrap;
      }

      .calories-badge {
        border-radius: 999px;
        padding: 3px 8px 3px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
      }

      .calories-badge[data-tone="base"] {
        background: rgba(34, 197, 94, 0.14);
        color: #bbf7d0;
      }

      .calories-badge[data-tone="warn"] {
        background: rgba(249, 115, 22, 0.14);
        color: #fed7aa;
      }

      .calories-badge[data-tone="danger"] {
        background: rgba(239, 68, 68, 0.16);
        color: #fecaca;
      }

      .calories-badge span.label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .calories-badge span.value {
        font-variant-numeric: tabular-nums;
        font-weight: 600;
      }

      .meal-ingredients {
        max-width: 260px;
        font-size: 0.8rem;
        color: var(--muted);
      }

      .meal-ingredients span {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: inline-block;
        max-width: 100%;
        vertical-align: bottom;
      }

      .meal-actions {
        display: inline-flex;
        gap: 4px;
      }

      .icon-button {
        width: 26px;
        height: 26px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: rgba(15, 23, 42, 0.9);
        color: var(--muted);
        cursor: pointer;
        font-size: 0.75rem;
        transition: background-color 140ms ease-out, transform 140ms ease-out,
          box-shadow 140ms ease-out, border-color 140ms ease-out,
          color 140ms ease-out;
      }

      .icon-button:hover {
        background: rgba(15, 23, 42, 1);
        border-color: rgba(74, 222, 128, 0.9);
        color: #bbf7d0;
        transform: translateY(-0.5px);
        box-shadow: 0 8px 18px rgba(15, 23, 42, 0.9);
      }

      .icon-button[data-variant="danger"]:hover {
        border-color: rgba(248, 113, 113, 0.95);
        color: #fecaca;
        background: rgba(127, 29, 29, 0.85);
      }

      .empty-state {
        padding: 7px 10px 9px;
        font-size: 0.82rem;
        color: var(--muted);
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .empty-state span.icon {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.7);
      }

      .banner {
        margin-top: 12px;
        border-radius: 12px;
        padding: 7px 9px;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .banner[data-tone="success"] {
        background: rgba(22, 163, 74, 0.14);
        border: 1px solid rgba(22, 163, 74, 0.8);
        color: #bbf7d0;
      }

      .banner[data-tone="notice"] {
        background: rgba(37, 99, 235, 0.14);
        border: 1px solid rgba(37, 99, 235, 0.85);
        color: #bfdbfe;
      }

      .banner i {
        font-size: 0.9rem;
      }

      .banner span.label {
        font-weight: 500;
      }

      .banner span.caption {
        color: inherit;
        opacity: 0.85;
      }

      .banner button {
        border-radius: 999px;
        border: none;
        padding: 3px 8px;
        font-size: 0.75rem;
        cursor: pointer;
        background: rgba(15, 23, 42, 0.8);
        color: inherit;
      }

      .banner button:hover {
        background: rgba(15, 23, 42, 1);
      }

      .validation {
        margin-top: 4px;
        font-size: 0.78rem;
        color: rgba(248, 113, 113, 0.9);
      }

      .fade-in {
        animation: fadeIn 280ms ease-out both;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(3px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          scroll-behavior: auto !important;
          animation-duration: 1ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 1ms !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="title-stack">
          <div class="logo-pill" aria-hidden="true">
            <div class="logo-inner">
              <span>ü•ó</span>
            </div>
          </div>
          <div class="title-text">
            <h1>
              Healthy Meal Tracker
              <span class="title-chip">Daily Fuel</span>
            </h1>
            <p>Log meals, ingredients, and calories in one focused view.</p>
          </div>
        </div>
        <div class="pill-row">
          <div class="pill">
            <i class="fa-solid fa-bullseye"></i>
            <span>Daily goal:&nbsp;<strong id="headerGoalLabel">2,000 kcal</strong></span>
          </div>
          <div class="pill">
            <i class="fa-solid fa-calendar-day"></i>
            <span id="headerDateLabel">Today</span>
          </div>
        </div>
      </header>

      <main class="app-main">
        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div class="card-title">
                <span class="icon-circle" aria-hidden="true">ü•ó</span>
                <span>Log Meal</span>
              </div>
              <p class="card-subtitle">
                Capture what you eat with ingredients and calories.
              </p>
            </div>
            <hr class="divider" />
            <form id="mealForm" autocomplete="off" novalidate>
              <div class="layout-two">
                <div>
                  <div class="field-row">
                    <div class="field">
                      <label for="mealName">Meal name</label>
                      <input
                        id="mealName"
                        name="mealName"
                        class="input"
                        type="text"
                        placeholder="e.g. Rainbow veggie bowl"
                        required
                      />
                    </div>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label for="mealType">Meal type</label>
                      <select
                        id="mealType"
                        name="mealType"
                        class="select"
                        required
                      >
                        <option value="Breakfast">Breakfast</option>
                        <option value="Lunch">Lunch</option>
                        <option value="Dinner" selected>Dinner</option>
                        <option value="Snack">Snack</option>
                        <option value="Drink">Drink</option>
                      </select>
                    </div>
                    <div class="field">
                      <label for="mealCalories">Calories</label>
                      <input
                        id="mealCalories"
                        name="mealCalories"
                        class="input input-number"
                        type="number"
                        min="0"
                        step="1"
                        inputmode="decimal"
                        placeholder="e.g. 480"
                        required
                      />
                    </div>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label for="mealDate">Date</label>
                      <input
                        id="mealDate"
                        name="mealDate"
                        class="input input-number"
                        type="date"
                        required
                      />
                    </div>
                    <div class="field">
                      <label for="mealTime">Time</label>
                      <input
                        id="mealTime"
                        name="mealTime"
                        class="input input-number"
                        type="time"
                      />
                    </div>
                  </div>
                </div>
                <div>
                  <div class="field">
                    <label for="mealIngredients">
                      Ingredients
                      <span class="label-extra">(comma or line separated)</span>
                    </label>
                    <textarea
                      id="mealIngredients"
                      name="mealIngredients"
                      class="textarea"
                      placeholder="Spinach, quinoa, cherry tomatoes, avocado, lemon dressing"
                    ></textarea>
                  </div>
                  <p class="muted" style="margin-top: 4px">
                    Tip:&nbsp;<strong>Ingredients help surface your most-used foods</strong>
                    in the daily summary cloud.
                  </p>
                </div>
              </div>
              <div id="formValidation" class="validation" aria-live="polite"></div>
              <div class="btn-row">
                <button type="submit" class="btn-primary" id="submitButton">
                  <i class="fa-solid fa-plus"></i>
                  <span id="submitButtonLabel">Add meal</span>
                </button>
                <div style="display: flex; flex-wrap: wrap; gap: 6px">
                  <button
                    type="button"
                    class="btn-ghost"
                    id="cancelEditButton"
                    style="display: none"
                  >
                    <i class="fa-solid fa-rotate-left"></i>
                    <span>Cancel edit</span>
                  </button>
                  <button
                    type="button"
                    class="chip-secondary"
                    id="prefillExampleButton"
                  >
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                    <span class="strong">One-tap sample day</span>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </section>

        <section class="card">
          <div class="card-inner">
            <div class="card-header">
              <div class="card-title">
                <span class="icon-circle" aria-hidden="true">üìä</span>
                <span>Daily Summary</span>
              </div>
              <div class="field-row" style="margin-bottom: 0">
                <div class="field" style="min-width: 150px">
                  <label for="summaryDate">Day</label>
                  <input
                    id="summaryDate"
                    class="input input-number"
                    type="date"
                  />
                </div>
                <div class="field" style="min-width: 140px">
                  <label for="dailyGoal">
                    Calorie goal
                  </label>
                  <input
                    id="dailyGoal"
                    class="input input-number"
                    type="number"
                    min="800"
                    max="4000"
                    step="50"
                    value="2000"
                  />
                </div>
              </div>
            </div>
            <hr class="divider" />
            <div class="layout-two">
              <div>
                <div class="progress-wrapper">
                  <svg
                    class="progress-ring"
                    viewBox="0 0 160 160"
                    aria-hidden="true"
                  >
                    <defs>
                      <linearGradient
                        id="ringGradient"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="100%"
                      >
                        <stop offset="0%" stop-color="#4ade80" />
                        <stop offset="50%" stop-color="#22c55e" />
                        <stop offset="100%" stop-color="#a3e635" />
                      </linearGradient>
                      <linearGradient
                        id="ringGradientWarn"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="100%"
                      >
                        <stop offset="0%" stop-color="#f97316" />
                        <stop offset="100%" stop-color="#facc15" />
                      </linearGradient>
                      <linearGradient
                        id="ringGradientDanger"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="100%"
                      >
                        <stop offset="0%" stop-color="#ef4444" />
                        <stop offset="100%" stop-color="#f97316" />
                      </linearGradient>
                    </defs>
                    <circle
                      cx="80"
                      cy="80"
                      r="60"
                      fill="none"
                      stroke="rgba(15,23,42,1)"
                      stroke-width="18"
                    ></circle>
                    <circle
                      id="progressRingCircle"
                      cx="80"
                      cy="80"
                      r="60"
                      fill="none"
                      stroke="url(#ringGradient)"
                      stroke-width="18"
                      stroke-linecap="round"
                      stroke-dasharray="0 999"
                      stroke-dashoffset="0"
                      transform="rotate(-90 80 80)"
                      style="
                        filter: drop-shadow(0 0 18px rgba(34, 197, 94, 0.85));
                        transition: stroke-dashoffset 260ms ease-out,
                          stroke 220ms ease-out;
                      "
                    ></circle>
                    <circle
                      cx="80"
                      cy="80"
                      r="44"
                      fill="rgba(15,23,42,0.95)"
                      stroke="rgba(15,23,42,1)"
                      stroke-width="1"
                    ></circle>
                    <text
                      id="progressRingPercent"
                      x="80"
                      y="78"
                      text-anchor="middle"
                      fill="#e5e7eb"
                      font-size="22"
                      font-weight="600"
                    >
                      0%
                    </text>
                    <text
                      id="progressRingLabel"
                      x="80"
                      y="98"
                      text-anchor="middle"
                      fill="#9ca3af"
                      font-size="11"
                      letter-spacing=".18em"
                      style="text-transform: uppercase"
                    >
                      Of Daily Goal
                    </text>
                  </svg>
                  <div class="progress-labels">
                    <div class="progress-title">Today&apos;s calories</div>
                    <div class="progress-main">
                      <span class="value" id="summaryCalories">0</span>
                      <span class="unit">kcal consumed</span>
                    </div>
                    <div class="progress-caption" id="summaryCaption">
                      Add your first meal to start tracking.
                    </div>
                    <div class="tag-row">
                      <div class="tag">
                        <span class="dot"></span>
                        <span id="summaryMealsTag">0 meal logged</span>
                      </div>
                      <div class="tag">
                        <i class="fa-solid fa-leaf"></i>
                        <span id="summaryIngredientsTag">0 ingredients</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <div class="summary-grid">
                  <div class="summary-card">
                    <div class="summary-icon" aria-hidden="true">üçé</div>
                    <div>
                      <div class="summary-label">Calories left</div>
                      <div
                        class="summary-value"
                        id="summaryRemaining"
                        data-tone="base"
                      >
                        2,000
                      </div>
                      <div class="summary-sub" id="summaryRemainingLabel">
                        Within gentle range.
                      </div>
                    </div>
                  </div>
                  <div class="summary-card">
                    <div class="summary-icon" aria-hidden="true">üçΩÔ∏è</div>
                    <div>
                      <div class="summary-label">Average per meal</div>
                      <div class="summary-value" id="summaryAverage">0</div>
                      <div class="summary-sub" id="summaryAverageLabel">
                        ‚Äî
                      </div>
                    </div>
                  </div>
                  <div class="summary-card">
                    <div class="summary-icon" aria-hidden="true">üïí</div>
                    <div>
                      <div class="summary-label">Last logged</div>
                      <div class="summary-value" id="summaryLastMeal">None</div>
                      <div class="summary-sub" id="summaryLastMealLabel">
                        Log your first meal for today.
                      </div>
                    </div>
                  </div>
                </div>
                <div style="margin-top: 10px">
                  <p class="muted" style="margin: 0 0 4px">
                    Top ingredients today
                  </p>
                  <div
                    class="ingredients-cloud"
                    id="ingredientsCloud"
                    aria-live="polite"
                  >
                    <span class="ingredient-empty"
                      >Add a few meals to discover your go-to foods.</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <section class="card" style="margin-top: 18px">
        <div class="card-inner">
          <div class="meals-header-row">
            <div class="card-title">
              <span class="icon-circle" aria-hidden="true">üìã</span>
              <span>Meals for the day</span>
            </div>
            <div class="meals-actions">
              <span class="meals-badge">
                <span class="dot"></span>
                <span id="mealsCountBadge" class="value">0 meals</span>
              </span>
              <button
                type="button"
                class="btn-ghost"
                id="clearDayButton"
                data-variant="danger"
              >
                <i class="fa-solid fa-trash"></i>
                <span>Clear day</span>
              </button>
            </div>
          </div>
          <hr class="divider" style="margin-top: 2px; margin-bottom: 8px" />
          <div class="table-wrapper">
            <div class="table-scroll">
              <table aria-label="Meals for selected day">
                <thead>
                  <tr>
                    <th scope="col">Meal</th>
                    <th scope="col">Type</th>
                    <th scope="col">Calories</th>
                    <th scope="col">Ingredients</th>
                    <th scope="col">Time</th>
                    <th scope="col" style="text-align: right">Actions</th>
                  </tr>
                </thead>
                <tbody id="mealsBody"></tbody>
              </table>
            </div>
            <div id="mealsEmptyState" class="empty-state">
              <span class="icon" aria-hidden="true">ü•£</span>
              <span id="emptyStateLabel"
                >No meals logged for this day yet.</span
              >
            </div>
          </div>
          <div
            id="statusBanner"
            class="banner fade-in"
            data-tone="notice"
            style="display: none"
          >
            <div style="display: flex; align-items: center; gap: 8px">
              <i
                id="statusBannerIcon"
                class="fa-solid fa-circle-info"
                aria-hidden="true"
              ></i>
              <div>
                <span id="statusBannerLabel" class="label"></span>
                <span id="statusBannerCaption" class="caption"></span>
              </div>
            </div>
            <button type="button" id="statusBannerDismiss">Dismiss</button>
          </div>
        </div>
      </section>
    </div>

    <script>
      (function () {
        "use strict";

        const STORAGE_KEY = "healthyMealTracker_v1";
        const DEFAULT_GOAL = 2000;

        const mealForm = document.getElementById("mealForm");
        const mealNameField = document.getElementById("mealName");
        const mealTypeField = document.getElementById("mealType");
        const mealCaloriesField = document.getElementById("mealCalories");
        const mealDateField = document.getElementById("mealDate");
        const mealTimeField = document.getElementById("mealTime");
        const mealIngredientsField = document.getElementById("mealIngredients");
        const formValidation = document.getElementById("formValidation");
        const submitButton = document.getElementById("submitButton");
        const submitButtonLabel = document.getElementById("submitButtonLabel");
        const cancelEditButton = document.getElementById("cancelEditButton");
        const prefillExampleButton = document.getElementById(
          "prefillExampleButton"
        );

        const summaryDateField = document.getElementById("summaryDate");
        const dailyGoalField = document.getElementById("dailyGoal");

        const headerGoalLabel = document.getElementById("headerGoalLabel");
        const headerDateLabel = document.getElementById("headerDateLabel");

        const summaryCalories = document.getElementById("summaryCalories");
        const summaryCaption = document.getElementById("summaryCaption");
        const summaryMealsTag = document.getElementById("summaryMealsTag");
        const summaryIngredientsTag =
          document.getElementById("summaryIngredientsTag");
        const summaryRemaining = document.getElementById("summaryRemaining");
        const summaryRemainingLabel =
          document.getElementById("summaryRemainingLabel");
        const summaryAverage = document.getElementById("summaryAverage");
        const summaryAverageLabel =
          document.getElementById("summaryAverageLabel");
        const summaryLastMeal = document.getElementById("summaryLastMeal");
        const summaryLastMealLabel =
          document.getElementById("summaryLastMealLabel");
        const ingredientsCloud = document.getElementById("ingredientsCloud");

        const mealsBody = document.getElementById("mealsBody");
        const mealsCountBadge = document.getElementById("mealsCountBadge");
        const mealsEmptyState = document.getElementById("mealsEmptyState");
        const emptyStateLabel = document.getElementById("emptyStateLabel");
        const clearDayButton = document.getElementById("clearDayButton");

        const statusBanner = document.getElementById("statusBanner");
        const statusBannerLabel = document.getElementById("statusBannerLabel");
        const statusBannerCaption = document.getElementById(
          "statusBannerCaption"
        );
        const statusBannerIcon = document.getElementById("statusBannerIcon");
        const statusBannerDismiss = document.getElementById(
          "statusBannerDismiss"
        );

        const progressRingCircle =
          document.getElementById("progressRingCircle");
        const progressRingPercent =
          document.getElementById("progressRingPercent");
        const progressRingLabel = document.getElementById("progressRingLabel");

        let state = {
          meals: [],
          goal: DEFAULT_GOAL,
        };

        let editingMealId = null;
        let progressCircumference = 0;

        function todayISO() {
          const d = new Date();
          const year = d.getFullYear();
          const month = String(d.getMonth() + 1).padStart(2, "0");
          const day = String(d.getDate()).padStart(2, "0");
          return year + "-" + month + "-" + day;
        }

        function formatCalories(num) {
          if (!Number.isFinite(num)) return "0";
          return Math.round(num).toLocaleString(undefined, {
            maximumFractionDigits: 0,
          });
        }

        function formatDateHuman(iso) {
          if (!iso) return "Today";
          const d = new Date(iso + "T12:00:00");
          const today = todayISO();
          if (iso === today) return "Today";
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          const tomorrowIso = tomorrow.toISOString().slice(0, 10);
          if (iso === tomorrowIso) return "Tomorrow";
          return d.toLocaleDateString(undefined, {
            weekday: "short",
            month: "short",
            day: "numeric",
          });
        }

        function formatTimeHuman(time) {
          if (!time) return "‚Äî";
          const [h, m] = time.split(":");
          if (h === undefined || m === undefined) return time;
          const d = new Date();
          d.setHours(parseInt(h, 10));
          d.setMinutes(parseInt(m, 10));
          return d.toLocaleTimeString(undefined, {
            hour: "numeric",
            minute: "2-digit",
          });
        }

        function loadState() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return;
            const parsed = JSON.parse(raw);
            if (!parsed || typeof parsed !== "object") return;
            if (Array.isArray(parsed.meals)) {
              state.meals = parsed.meals
                .map(function (m) {
                  if (!m || typeof m !== "object") return null;
                  if (!m.id || !m.name || !m.date) return null;
                  const calories = Number(m.calories);
                  if (!Number.isFinite(calories) || calories < 0) return null;
                  return {
                    id: String(m.id),
                    name: String(m.name),
                    type: m.type || "Meal",
                    calories: calories,
                    ingredients: Array.isArray(m.ingredients)
                      ? m.ingredients
                          .map(function (i) {
                            return String(i || "").trim();
                          })
                          .filter(Boolean)
                      : [],
                    date: String(m.date),
                    time: m.time ? String(m.time) : "",
                    createdAt: m.createdAt ? Number(m.createdAt) : Date.now(),
                  };
                })
                .filter(Boolean);
            }
            if (
              typeof parsed.goal === "number" &&
              parsed.goal >= 800 &&
              parsed.goal <= 4000
            ) {
              state.goal = parsed.goal;
            }
          } catch (e) {
          }
        }

        function saveState() {
          try {
            var payload = {
              meals: state.meals,
              goal: state.goal,
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
          } catch (e) {
          }
        }

        function uuid() {
          return (
            Date.now().toString(36) +
            "-" +
            Math.random().toString(36).slice(2, 9)
          );
        }

        function getSelectedDate() {
          return summaryDateField.value || todayISO();
        }

        function syncHeaderDate() {
          const iso = getSelectedDate();
          headerDateLabel.textContent = formatDateHuman(iso);
        }

        function syncGoalInputs() {
          dailyGoalField.value = state.goal;
          headerGoalLabel.textContent = formatCalories(state.goal) + " kcal";
        }

        function setStatusBanner(opts) {
          if (!opts) {
            statusBanner.style.display = "none";
            return;
          }
          statusBanner.dataset.tone = opts.tone || "notice";
          statusBannerLabel.textContent = opts.label || "";
          statusBannerCaption.textContent =
            opts.caption || "";
          statusBannerIcon.className =
            "fa-solid " + (opts.iconClass || "fa-circle-info");
          statusBanner.style.display = "flex";
        }

        function clearStatusBanner() {
          setStatusBanner(null);
        }

        function resetForm() {
          mealForm.reset();
          mealDateField.value = getSelectedDate();
          mealTypeField.value = "Dinner";
          formValidation.textContent = "";
          editingMealId = null;
          submitButtonLabel.textContent = "Add meal";
          submitButton.querySelector("i").className = "fa-solid fa-plus";
          cancelEditButton.style.display = "none";
        }

        function validateForm() {
          const name = mealNameField.value.trim();
          const calories = Number(mealCaloriesField.value);
          const date = mealDateField.value;
          if (!name) {
            return "Add a short, descriptive meal name.";
          }
          if (!Number.isFinite(calories) || calories <= 0) {
            return "Calories must be a positive number.";
          }
          if (!date) {
            return "Choose a date for this meal.";
          }
          return "";
        }

        function parseIngredients(raw) {
          if (!raw) return [];
          const tokens = raw
            .split(/[\n,]/g)
            .map(function (token) {
              return token.trim();
            })
            .filter(Boolean);
          var seen = Object.create(null);
          var result = [];
          for (var i = 0; i < tokens.length; i++) {
            var item = tokens[i];
            var key = item.toLowerCase();
            if (!seen[key]) {
              seen[key] = true;
              result.push(item);
            }
          }
          return result;
        }

        function computeSummaryForDate(date) {
          var mealsForDay = state.meals.filter(function (m) {
            return m.date === date;
          });
          mealsForDay.sort(function (a, b) {
            if (a.time && b.time && a.time !== b.time) {
              return a.time < b.time ? -1 : 1;
            }
            return a.createdAt - b.createdAt;
          });
          var totalCalories = mealsForDay.reduce(function (sum, m) {
            return sum + (Number(m.calories) || 0);
          }, 0);
          var avgCalories =
            mealsForDay.length > 0
              ? totalCalories / mealsForDay.length
              : 0;
          var ingredients = [];
          for (var i = 0; i < mealsForDay.length; i++) {
            var meal = mealsForDay[i];
            if (!Array.isArray(meal.ingredients)) continue;
            for (var j = 0; j < meal.ingredients.length; j++) {
              ingredients.push(meal.ingredients[j]);
            }
          }
          var ingredientCounts = Object.create(null);
          for (var k = 0; k < ingredients.length; k++) {
            var ing = ingredients[k];
            var key = ing.toLowerCase();
            ingredientCounts[key] = (ingredientCounts[key] || 0) + 1;
          }
          var ingredientEntries = [];
          for (var key in ingredientCounts) {
            if (Object.prototype.hasOwnProperty.call(ingredientCounts, key)) {
              ingredientEntries.push({
                name:
                  ingredients.find(function (x) {
                    return x.toLowerCase() === key;
                  }) || key,
                count: ingredientCounts[key],
              });
            }
          }
          ingredientEntries.sort(function (a, b) {
            if (b.count === a.count) {
              return a.name.localeCompare(b.name);
            }
            return b.count - a.count;
          });
          var topIngredients = ingredientEntries.slice(0, 6);
          var lastMeal = mealsForDay.length
            ? mealsForDay[mealsForDay.length - 1]
            : null;
          return {
            date: date,
            meals: mealsForDay,
            totalCalories: totalCalories,
            avgCalories: avgCalories,
            topIngredients: topIngredients,
            lastMeal: lastMeal,
          };
        }

        function updateProgressRing(total, goal) {
          var radius = progressRingCircle.r.baseVal.value || 60;
          if (!progressCircumference) {
            progressCircumference = 2 * Math.PI * radius;
            progressRingCircle.style.strokeDasharray =
              progressCircumference + " " + progressCircumference;
          }
          var pct =
            goal > 0 ? Math.max(0, Math.min(130, (total / goal) * 100)) : 0;
          var offset =
            progressCircumference -
            (pct / 100) * progressCircumference;
          progressRingCircle.style.strokeDashoffset = offset;
          var displayPct = Math.min(999, Math.round((total / goal) * 100));
          if (!Number.isFinite(displayPct) || goal <= 0) {
            displayPct = 0;
          }
          progressRingPercent.textContent = displayPct + "%";
          var tone = "base";
          if (displayPct >= 120) {
            tone = "danger";
          } else if (displayPct >= 90) {
            tone = "warn";
          }
          if (tone === "danger") {
            progressRingCircle.setAttribute("stroke", "url(#ringGradientDanger)");
          } else if (tone === "warn") {
            progressRingCircle.setAttribute("stroke", "url(#ringGradientWarn)");
          } else {
            progressRingCircle.setAttribute("stroke", "url(#ringGradient)");
          }
          if (displayPct === 0) {
            progressRingLabel.textContent = "Of Daily Goal";
          } else if (displayPct < 80) {
            progressRingLabel.textContent = "Comfortable Zone";
          } else if (displayPct <= 100) {
            progressRingLabel.textContent = "Near Your Goal";
          } else {
            progressRingLabel.textContent = "Above Goal";
          }
        }

        function renderIngredientsCloud(summary) {
          while (ingredientsCloud.firstChild) {
            ingredientsCloud.removeChild(ingredientsCloud.firstChild);
          }
          var entries = summary.topIngredients;
          if (!entries.length) {
            var span = document.createElement("span");
            span.className = "ingredient-empty";
            span.textContent =
              "Add a few meals to discover your go-to foods.";
            ingredientsCloud.appendChild(span);
            return;
          }
          for (var i = 0; i < entries.length; i++) {
            var chip = document.createElement("span");
            chip.className = "ingredient-chip fade-in";
            var dot = document.createElement("span");
            dot.className = "dot";
            var text = document.createElement("strong");
            text.textContent = entries[i].name;
            var count = document.createElement("span");
            count.className = "count";
            count.textContent = "√ó" + entries[i].count;
            chip.appendChild(dot);
            chip.appendChild(text);
            chip.appendChild(count);
            ingredientsCloud.appendChild(chip);
          }
        }

        function renderMealsTable(summary) {
          while (mealsBody.firstChild) {
            mealsBody.removeChild(mealsBody.firstChild);
          }
          var meals = summary.meals;
          mealsCountBadge.textContent =
            meals.length === 1 ? "1 meal" : meals.length + " meals";
          if (!meals.length) {
            mealsEmptyState.style.display = "flex";
            emptyStateLabel.textContent =
              "No meals logged for this day yet.";
            return;
          }
          mealsEmptyState.style.display = "none";
          for (var i = 0; i < meals.length; i++) {
            var meal = meals[i];
            var tr = document.createElement("tr");
            tr.className = "fade-in";

            var tdName = document.createElement("td");
            var mealMain = document.createElement("div");
            mealMain.className = "meal-main";
            var icon = document.createElement("span");
            icon.className = "meal-icon";
            icon.textContent = mealEmoji(meal.type);
            var nameSpan = document.createElement("span");
            nameSpan.className = "meal-name";
            nameSpan.textContent = meal.name;
            mealMain.appendChild(icon);
            mealMain.appendChild(nameSpan);
            tdName.appendChild(mealMain);
            tr.appendChild(tdName);

            var tdType = document.createElement("td");
            var typePill = document.createElement("span");
            typePill.className = "meal-type-pill";
            typePill.dataset.type = meal.type || "Meal";
            typePill.textContent = meal.type || "Meal";
            tdType.appendChild(typePill);
            tr.appendChild(tdType);

            var tdCalories = document.createElement("td");
            tdCalories.className = "meal-calories";
            var badge = document.createElement("span");
            badge.className = "calories-badge";
            var mealTone = "base";
            if (meal.calories >= 900) {
              mealTone = "danger";
            } else if (meal.calories >= 600) {
              mealTone = "warn";
            }
            badge.dataset.tone = mealTone;
            var label = document.createElement("span");
            label.className = "label";
            label.textContent = "Meal";
            var value = document.createElement("span");
            value.className = "value";
            value.textContent = formatCalories(meal.calories) + " kcal";
            badge.appendChild(label);
            badge.appendChild(value);
            tdCalories.appendChild(badge);
            tr.appendChild(tdCalories);

            var tdIngredients = document.createElement("td");
            tdIngredients.className = "meal-ingredients";
            var ingredientsSpan = document.createElement("span");
            if (meal.ingredients && meal.ingredients.length) {
              ingredientsSpan.textContent = meal.ingredients.join(", ");
            } else {
              ingredientsSpan.textContent = "‚Äî";
            }
            tdIngredients.appendChild(ingredientsSpan);
            tr.appendChild(tdIngredients);

            var tdTime = document.createElement("td");
            tdTime.textContent = formatTimeHuman(meal.time);
            tr.appendChild(tdTime);

            var tdActions = document.createElement("td");
            tdActions.style.textAlign = "right";
            var actions = document.createElement("div");
            actions.className = "meal-actions";
            var editBtn = document.createElement("button");
            editBtn.type = "button";
            editBtn.className = "icon-button";
            editBtn.innerHTML =
              '<i class="fa-solid fa-pen"></i><span class="sr-only">Edit</span>';
            editBtn.addEventListener("click", function (id) {
              return function () {
                startEditingMeal(id);
              };
            })(meal.id);
            var delBtn = document.createElement("button");
            delBtn.type = "button";
            delBtn.className = "icon-button";
            delBtn.dataset.variant = "danger";
            delBtn.innerHTML =
              '<i class="fa-solid fa-xmark"></i><span class="sr-only">Delete</span>';
            delBtn.addEventListener("click", function (id) {
              return function () {
                deleteMeal(id);
              };
            })(meal.id);
            actions.appendChild(editBtn);
            actions.appendChild(delBtn);
            tdActions.appendChild(actions);
            tr.appendChild(tdActions);

            mealsBody.appendChild(tr);
          }
        }

        function updateSummary() {
          var date = getSelectedDate();
          var summary = computeSummaryForDate(date);
          var goal = state.goal || DEFAULT_GOAL;
          var total = summary.totalCalories;
          summaryCalories.textContent = formatCalories(total);
          var mealsCount = summary.meals.length;
          var ingredientsCount = summary.topIngredients.reduce(function (
            sum,
            entry
          ) {
            return sum + entry.count;
          },
          0);
          summaryMealsTag.textContent =
            mealsCount === 1 ? "1 meal logged" : mealsCount + " meals logged";
          summaryIngredientsTag.textContent =
            ingredientsCount === 1
              ? "1 ingredient"
              : ingredientsCount + " ingredients";

          if (!mealsCount) {
            summaryCaption.textContent =
              "Add your first meal to start tracking.";
          } else if (total < goal * 0.75) {
            summaryCaption.textContent =
              "You have plenty of room left in your goal.";
          } else if (total <= goal) {
            summaryCaption.textContent =
              "Nicely balanced‚Äîhovering close to your target.";
          } else if (total <= goal * 1.2) {
            summaryCaption.textContent =
              "Slightly above your goal. Notice how you feel.";
          } else {
            summaryCaption.textContent =
              "You are well above today\u2019s target. Consider lighter meals ahead.";
          }

          updateProgressRing(total, goal);

          var remaining = goal - total;
          summaryRemaining.textContent = formatCalories(
            remaining > 0 ? remaining : 0
          );
          var remainingTone = "base";
          var remainingLabel = "";
          if (!mealsCount) {
            remainingTone = "base";
            remainingLabel = "You haven't logged any calories yet today.";
          } else if (remaining > goal * 0.4) {
            remainingTone = "base";
            remainingLabel = "Within gentle range.";
          } else if (remaining >= goal * 0.1) {
            remainingTone = "warning";
            remainingLabel = "Close to your goal‚Äîcheck in with your hunger.";
          } else if (remaining > 0) {
            remainingTone = "warning";
            remainingLabel = "Just a little room left to play with.";
          } else if (remaining >= -goal * 0.15) {
            remainingTone = "danger";
            remainingLabel = "Slightly above today\u2019s goal.";
          } else {
            remainingTone = "danger";
            remainingLabel = "Noticeably above goal for today.";
          }
          summaryRemaining.dataset.tone = remainingTone;
          summaryRemainingLabel.textContent = remainingLabel;

          var avg = summary.avgCalories || 0;
          summaryAverage.textContent = formatCalories(avg);
          if (!mealsCount) {
            summaryAverageLabel.textContent =
              "Average will appear after logging meals.";
          } else if (avg < 300) {
            summaryAverageLabel.textContent = "Light meals on average.";
          } else if (avg <= 700) {
            summaryAverageLabel.textContent = "Moderate energy per meal.";
          } else {
            summaryAverageLabel.textContent = "Hearty meals overall.";
          }

          if (!summary.lastMeal) {
            summaryLastMeal.textContent = "None";
            summaryLastMealLabel.textContent =
              "Log your first meal for today.";
          } else {
            summaryLastMeal.textContent = summary.lastMeal.name;
            var when = summary.lastMeal.time
              ? "Logged at " + formatTimeHuman(summary.lastMeal.time) + "."
              : "Most recent for this day.";
            summaryLastMealLabel.textContent = when;
          }

          renderIngredientsCloud(summary);
          renderMealsTable(summary);
          syncHeaderDate();
        }

        function mealEmoji(type) {
          switch (type) {
            case "Breakfast":
              return "ü•£";
            case "Lunch":
              return "ü•ô";
            case "Dinner":
              return "üçΩÔ∏è";
            case "Snack":
              return "üçé";
            case "Drink":
              return "ü•§";
            default:
              return "ü•ó";
          }
        }

        function startEditingMeal(id) {
          var meal = state.meals.find(function (m) {
            return m.id === id;
          });
          if (!meal) return;
          editingMealId = id;
          mealNameField.value = meal.name;
          mealTypeField.value = meal.type || "Dinner";
          mealCaloriesField.value = meal.calories;
          mealDateField.value = meal.date;
          mealTimeField.value = meal.time || "";
          mealIngredientsField.value = (meal.ingredients || []).join(", ");
          submitButtonLabel.textContent = "Update meal";
          submitButton.querySelector("i").className =
            "fa-solid fa-check";
          cancelEditButton.style.display = "inline-flex";
          formValidation.textContent = "";
          setStatusBanner({
            tone: "notice",
            label: "Editing meal.",
            caption:
              "Make changes and press \u201cUpdate meal\u201d, or cancel to go back.",
            iconClass: "fa-pen",
          });
          mealNameField.focus();
        }

        function deleteMeal(id) {
          var before = state.meals.length;
          state.meals = state.meals.filter(function (m) {
            return m.id !== id;
          });
          if (state.meals.length !== before) {
            saveState();
            updateSummary();
            if (editingMealId === id) {
              resetForm();
            }
            setStatusBanner({
              tone: "success",
              label: "Meal removed.",
              caption: "Your daily summary has been updated.",
              iconClass: "fa-circle-check",
            });
          }
        }

        function clearDay(date) {
          var remaining = state.meals.filter(function (m) {
            return m.date !== date;
          });
          if (remaining.length === state.meals.length) return;
          state.meals = remaining;
          saveState();
          updateSummary();
          setStatusBanner({
            tone: "success",
            label: "Day cleared.",
            caption:
              "All meals for this day were removed from your tracker.",
            iconClass: "fa-broom",
          });
          if (editingMealId) {
            resetForm();
          }
        }

        function maybeConfirmClearDay() {
          var date = getSelectedDate();
          var summary = computeSummaryForDate(date);
          if (!summary.meals.length) {
            clearDay(date);
            return;
          }
          var msg =
            "Clear all meals for " +
            formatDateHuman(date) +
            "? This cannot be undone.";
          if (window.confirm(msg)) {
            clearDay(date);
          }
        }

        function applySampleDay() {
          var baseDate = getSelectedDate();
          function addSample(meal) {
            state.meals.push(
              Object.assign(
                {
                  id: uuid(),
                  date: baseDate,
                  createdAt: Date.now() + Math.random() * 1000,
                },
                meal
              )
            );
          }
          var existing = computeSummaryForDate(baseDate).meals.length;
          if (!existing) {
            addSample({
              name: "Morning oatmeal & berries",
              type: "Breakfast",
              calories: 360,
              ingredients: [
                "Rolled oats",
                "Blueberries",
                "Almond milk",
                "Chia seeds",
              ],
              time: "07:45",
            });
            addSample({
              name: "Colorful grain bowl",
              type: "Lunch",
              calories: 540,
              ingredients: [
                "Quinoa",
                "Spinach",
                "Chickpeas",
                "Cherry tomatoes",
                "Avocado",
              ],
              time: "12:30",
            });
            addSample({
              name: "Apple & almond snack",
              type: "Snack",
              calories: 180,
              ingredients: ["Apple", "Almonds"],
              time: "15:45",
            });
            addSample({
              name: "Lemon herb salmon",
              type: "Dinner",
              calories: 620,
              ingredients: [
                "Salmon",
                "Lemon",
                "Olive oil",
                "Broccoli",
                "Brown rice",
              ],
              time: "19:15",
            });
            addSample({
              name: "Herbal tea",
              type: "Drink",
              calories: 5,
              ingredients: ["Herbal tea"],
              time: "21:00",
            });
          } else {
            addSample({
              name: "Seasonal fruit plate",
              type: "Snack",
              calories: 210,
              ingredients: ["Grapes", "Orange", "Kiwi"],
              time: "16:10",
            });
          }
          saveState();
          updateSummary();
          setStatusBanner({
            tone: "success",
            label: "Sample meals added.",
            caption:
              "Explore how the tracker feels with a realistic day.",
            iconClass: "fa-circle-check",
          });
        }

        function handleFormSubmit(event) {
          event.preventDefault();
          var message = validateForm();
          if (message) {
            formValidation.textContent = message;
            return;
          }
          formValidation.textContent = "";
          var ingredients = parseIngredients(mealIngredientsField.value);
          var mealData = {
            name: mealNameField.value.trim(),
            type: mealTypeField.value || "Meal",
            calories: Number(mealCaloriesField.value),
            ingredients: ingredients,
            date: mealDateField.value || getSelectedDate(),
            time: mealTimeField.value || "",
          };
          if (editingMealId) {
            var existingIndex = state.meals.findIndex(function (m) {
              return m.id === editingMealId;
            });
            if (existingIndex !== -1) {
              var prev = state.meals[existingIndex];
              state.meals[existingIndex] = Object.assign({}, prev, mealData);
            }
            setStatusBanner({
              tone: "success",
              label: "Meal updated.",
              caption:
                "Your changes are saved and reflected in today\u2019s summary.",
              iconClass: "fa-circle-check",
            });
          } else {
            state.meals.push(
              Object.assign(
                {
                  id: uuid(),
                  createdAt: Date.now(),
                },
                mealData
              )
            );
            setStatusBanner({
              tone: "success",
              label: "Meal logged.",
              caption:
                "Great work\u2014check the summary card to see how it fits today\u2019s goal.",
              iconClass: "fa-circle-check",
            });
          }
          saveState();
          updateSummary();
          resetForm();
        }

        function handleGoalChange() {
          var val = Number(dailyGoalField.value);
          if (!Number.isFinite(val) || val < 800 || val > 4000) {
            dailyGoalField.value = state.goal;
            return;
          }
          state.goal = Math.round(val);
          syncGoalInputs();
          saveState();
          updateSummary();
        }

        function initialiseDates() {
          var today = todayISO();
          summaryDateField.value = today;
          if (!mealDateField.value) {
            mealDateField.value = today;
          }
          syncHeaderDate();
        }

        function attachListeners() {
          mealForm.addEventListener("submit", handleFormSubmit);
          summaryDateField.addEventListener("change", function () {
            mealDateField.value = summaryDateField.value || todayISO();
            updateSummary();
          });
          dailyGoalField.addEventListener("change", handleGoalChange);
          clearDayButton.addEventListener("click", maybeConfirmClearDay);
          cancelEditButton.addEventListener("click", function () {
            resetForm();
            clearStatusBanner();
          });
          prefillExampleButton.addEventListener("click", function () {
            applySampleDay();
          });
          statusBannerDismiss.addEventListener("click", clearStatusBanner);
        }

        function init() {
          loadState();
          syncGoalInputs();
          initialiseDates();
          attachListeners();
          updateSummary();
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", init);
        } else {
          init();
        }
      })();
    </script>
  </body>
</html>

