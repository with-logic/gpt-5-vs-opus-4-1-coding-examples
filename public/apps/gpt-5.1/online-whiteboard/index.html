<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Online Whiteboard</title>
  <style>
    :root {
      --bg-root: #020617;
      --bg-elevated: rgba(15, 23, 42, 0.96);
      --bg-elevated-soft: rgba(15, 23, 42, 0.9);
      --bg-toolbar: rgba(15, 23, 42, 0.96);
      --border-subtle: rgba(148, 163, 184, 0.35);
      --border-strong: rgba(148, 163, 184, 0.7);
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --accent-strong: rgba(56, 189, 248, 0.9);
      --accent-warm: #f97316;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --text-softer: #6b7280;
      --canvas-bg: #f9fafb;
      --danger: #f97373;
      --radius-lg: 18px;
      --radius-md: 14px;
      --shadow-soft: 0 18px 60px rgba(15, 23, 42, 0.75);
      --shadow-toolbar: 0 18px 50px rgba(15, 23, 42, 0.9);
      --transition-fast: 160ms ease-out;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      color: var(--text-main);
      background:
        radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.22), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(248, 113, 113, 0.18), transparent 50%),
        radial-gradient(circle at 100% 0%, rgba(52, 211, 153, 0.2), transparent 55%),
        #020617;
      background-attachment: fixed;
      -webkit-font-smoothing: antialiased;
    }

    .app-root {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 10px;
      gap: 10px;
    }

    .app-shell {
      display: flex;
      flex-direction: column;
      border-radius: 24px;
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.2), transparent 55%),
        rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow: 0 30px 120px rgba(15, 23, 42, 0.9);
      overflow: hidden;
      backdrop-filter: blur(26px) saturate(150%);
      -webkit-backdrop-filter: blur(26px) saturate(150%);
      max-width: 1400px;
      margin: auto;
      width: 100%;
      height: calc(100vh - 20px);
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.38);
      background: linear-gradient(
        135deg,
        rgba(15, 23, 42, 0.98),
        rgba(15, 23, 42, 0.9)
      );
      position: relative;
      z-index: 2;
    }

    .title-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .title-badge {
      height: 32px;
      width: 32px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #38bdf8, #22c55e);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.8),
        0 0 0 5px rgba(56, 189, 248, 0.25),
        0 18px 45px rgba(15, 23, 42, 0.95);
      position: relative;
      overflow: hidden;
    }

    .title-badge::before,
    .title-badge::after {
      content: "";
      position: absolute;
      inset: 16%;
      border-radius: inherit;
      border: 2px solid rgba(15, 23, 42, 0.85);
      transform: rotate(22deg);
    }

    .title-badge::after {
      inset: 32%;
      border-style: dashed;
      border-color: rgba(15, 23, 42, 0.5);
      opacity: 0.9;
    }

    .title-text-main {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.03em;
      color: #f9fafb;
    }

    .title-text-sub {
      font-size: 12px;
      color: var(--text-softer);
    }

    .title-text-sub strong {
      font-weight: 500;
      color: var(--accent-strong);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.18), transparent 60%),
        rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #4ade80;
      box-shadow: 0 0 0 4px rgba(74, 222, 128, 0.15);
    }

    .pill-muted {
      border-style: dashed;
      border-color: rgba(148, 163, 184, 0.55);
      color: var(--text-softer);
      background: rgba(15, 23, 42, 0.9);
    }

    .app-main {
      flex: 1;
      display: flex;
      gap: 10px;
      padding: 10px;
      background: radial-gradient(circle at 100% 0, rgba(56, 189, 248, 0.04), transparent 60%);
      backdrop-filter: blur(14px);
    }

    .toolbar {
      width: 260px;
      max-width: 40vw;
      background: var(--bg-toolbar);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-toolbar);
      display: flex;
      flex-direction: column;
      padding: 12px 12px 10px;
      gap: 10px;
    }

    .toolbar-section {
      border-radius: 12px;
      padding: 10px;
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.16), transparent 55%),
        rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .toolbar-section + .toolbar-section {
      margin-top: 4px;
    }

    .toolbar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-softer);
      margin-bottom: 10px;
    }

    .toolbar-header span:last-child {
      font-size: 10px;
      color: var(--text-softer);
      text-transform: none;
      letter-spacing: normal;
    }

    .tool-row {
      display: flex;
      gap: 6px;
    }

    .tool-row.wrap {
      flex-wrap: wrap;
    }

    .segmented {
      display: inline-flex;
      padding: 2px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      gap: 2px;
    }

    .segmented button {
      border: none;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition:
        background-color var(--transition-fast),
        color var(--transition-fast),
        transform 120ms ease-out,
        box-shadow 140ms ease-out;
      white-space: nowrap;
    }

    .segmented button span.label {
      pointer-events: none;
    }

    .segmented button .glyph {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      opacity: 0.9;
    }

    .segmented button[data-tool="pen"] .glyph {
      border-radius: 999px;
      border-width: 0;
      background: linear-gradient(135deg, #38bdf8, #3b82f6);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.7);
    }

    .segmented button[data-tool="highlighter"] .glyph {
      background: linear-gradient(135deg, #facc15, #f97316);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.7);
    }

    .segmented button[data-tool="eraser"] .glyph {
      background: linear-gradient(135deg, #e5e7eb, #cbd5f5);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.5);
    }

    .segmented button.is-active {
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.4), transparent 70%),
        rgba(15, 23, 42, 0.98);
      color: #e5f2ff;
      box-shadow:
        0 0 0 1px rgba(56, 189, 248, 0.4),
        0 0 0 6px rgba(56, 189, 248, 0.22);
      transform: translateY(-0.5px);
    }

    .segmented button:not(.is-active):hover {
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
    }

    .segmented button:active {
      transform: translateY(0.5px) scale(0.99);
      box-shadow: none;
    }

    .subtle-label {
      font-size: 11px;
      color: var(--text-softer);
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      gap: 8px;
    }

    .subtle-label span.key-hint {
      padding: 2px 6px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      font-size: 10px;
      color: var(--text-softer);
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      outline: none;
      cursor: pointer;
      border: 1px solid rgba(71, 85, 105, 0.9);
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #38bdf8;
      box-shadow:
        0 0 0 2px rgba(15, 23, 42, 0.95),
        0 0 0 6px rgba(56, 189, 248, 0.4);
      border: none;
      margin-top: -6px;
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #38bdf8;
      box-shadow:
        0 0 0 2px rgba(15, 23, 42, 0.95),
        0 0 0 6px rgba(56, 189, 248, 0.4);
      border: none;
    }

    input[type="range"]::-moz-range-track {
      height: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(71, 85, 105, 0.9);
    }

    .slider-value {
      font-size: 11px;
      color: var(--text-soft);
      min-width: 34px;
      text-align: right;
    }

    .color-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .swatches {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      flex: 1;
    }

    .swatch {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      cursor: pointer;
      position: relative;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.7);
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast);
    }

    .swatch.is-active {
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 0 0 4px rgba(56, 189, 248, 0.7);
      transform: translateY(-0.5px) scale(1.02);
    }

    .swatch:hover {
      transform: translateY(-0.5px) scale(1.03);
    }

    .color-picker-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .color-picker-wrap input[type="color"] {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      padding: 0;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: transparent;
      cursor: pointer;
    }

    .color-picker-wrap input[type="color"]::-webkit-color-swatch {
      border-radius: inherit;
      border: none;
      padding: 0;
    }

    .color-picker-wrap input[type="color"]::-moz-color-swatch {
      border-radius: inherit;
      border: none;
    }

    .mono-button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.2), transparent 60%),
        rgba(15, 23, 42, 0.98);
      color: var(--text-soft);
      font-size: 11px;
      padding: 6px 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      flex: 1;
      white-space: nowrap;
      transition:
        background-color var(--transition-fast),
        border-color var(--transition-fast),
        color var(--transition-fast),
        transform 120ms ease-out,
        box-shadow 140ms ease-out;
    }

    .mono-button span.key {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 10px;
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.9);
    }

    .mono-button:hover {
      background: rgba(15, 23, 42, 0.98);
      color: #e5e7eb;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.8);
      transform: translateY(-0.5px);
    }

    .mono-button:active {
      transform: translateY(0.5px) scale(0.99);
      box-shadow: none;
    }

    .mono-button.primary {
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.36), transparent 70%),
        linear-gradient(135deg, #0ea5e9, #6366f1);
      border-color: rgba(56, 189, 248, 0.9);
      color: #f9fafb;
      box-shadow:
        0 8px 25px rgba(37, 99, 235, 0.7),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .mono-button.primary:hover {
      filter: brightness(1.05);
    }

    .mono-button.danger {
      border-color: rgba(248, 113, 113, 0.9);
      color: #fecaca;
      background: radial-gradient(circle at 0 0, rgba(248, 113, 113, 0.36), transparent 70%),
        linear-gradient(135deg, #ef4444, #b91c1c);
      box-shadow:
        0 8px 25px rgba(248, 113, 113, 0.6),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .mono-button.secondary-outline {
      background: rgba(15, 23, 42, 0.98);
      border-style: dashed;
      color: var(--text-soft);
    }

    .mono-button.secondary-outline:hover {
      border-style: solid;
    }

    .mono-button.small {
      padding: 5px 8px;
      font-size: 11px;
    }

    .action-row {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }

    .hint-text {
      font-size: 11px;
      color: var(--text-softer);
      margin-top: 6px;
      line-height: 1.35;
    }

    .hint-text code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      font-size: 10px;
      padding: 1px 4px;
      border-radius: 4px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
    }

    .canvas-shell {
      flex: 1;
      border-radius: 22px;
      background:
        radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.14), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(148, 163, 184, 0.12), transparent 60%),
        rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.55);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .canvas-inner {
      position: relative;
      flex: 1;
      margin: 14px 14px 10px;
      border-radius: 18px;
      background-color: var(--canvas-bg);
      overflow: hidden;
      box-shadow:
        inset 0 0 0 1px rgba(148, 163, 184, 0.35),
        0 22px 45px rgba(15, 23, 42, 0.7);
    }

    .canvas-inner::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(to right, rgba(148, 163, 184, 0.17) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(148, 163, 184, 0.17) 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.68;
      mix-blend-mode: multiply;
      pointer-events: none;
    }

    .canvas-inner::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(15, 23, 42, 0.09), transparent 55%);
      mix-blend-mode: multiply;
      pointer-events: none;
    }

    .whiteboard-canvas {
      position: relative;
      width: 100%;
      height: 100%;
      display: block;
      background: transparent;
      touch-action: none;
      cursor: crosshair;
    }

    .canvas-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .canvas-top-strip {
      position: absolute;
      top: 10px;
      left: 14px;
      right: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-softer);
      pointer-events: none;
    }

    .canvas-top-strip .badge {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.88);
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .canvas-top-strip .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #4ade80;
      box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.22);
    }

    .canvas-top-strip .badge span {
      white-space: nowrap;
    }

    .canvas-kb-cheats {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .canvas-kb-cheats .chip {
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.86);
      border: 1px dashed rgba(148, 163, 184, 0.7);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      pointer-events: auto;
    }

    .canvas-kb-cheats .chip code {
      font-size: 10px;
      padding: 1px 4px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
    }

    .canvas-bottom-strip {
      position: absolute;
      left: 14px;
      right: 14px;
      bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 8px;
      font-size: 11px;
      color: var(--text-softer);
      pointer-events: none;
    }

    .canvas-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      pointer-events: auto;
    }

    .canvas-status span {
      white-space: nowrap;
    }

    .canvas-status-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: #38bdf8;
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.3);
    }

    .canvas-hint {
      padding: 4px 8px;
      border-radius: 9px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px dashed rgba(148, 163, 184, 0.7);
      max-width: 60%;
      line-height: 1.4;
    }

    .canvas-hint strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .canvas-hint code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      font-size: 10px;
      padding: 1px 4px;
      border-radius: 4px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
    }

    .floating-preview {
      position: absolute;
      top: 18px;
      right: 18px;
      width: 84px;
      height: 58px;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.65);
      background: rgba(2, 6, 23, 0.96);
      box-shadow:
        0 12px 30px rgba(15, 23, 42, 0.85),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .floating-preview canvas {
      width: 92%;
      height: 86%;
      border-radius: 8px;
      background: #f9fafb;
      box-shadow:
        inset 0 0 0 1px rgba(148, 163, 184, 0.6),
        0 4px 10px rgba(15, 23, 42, 0.85);
    }

    .floating-preview-label {
      position: absolute;
      bottom: 5px;
      left: 8px;
      right: 8px;
      text-align: center;
      font-size: 9px;
      color: var(--text-soft);
      text-shadow: 0 1px 2px rgba(2, 6, 23, 0.9);
      pointer-events: none;
    }

    .canvas-cta {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 260ms ease-out;
    }

    .canvas-cta-inner {
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
      font-size: 11px;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      pointer-events: auto;
    }

    .canvas-cta-inner strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .canvas-cta-inner code {
      font-size: 10px;
      padding: 1px 4px;
      border-radius: 4px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
    }

    .canvas-cta.is-visible {
      opacity: 1;
    }

    .app-footer {
      padding: 6px 12px 10px;
      font-size: 11px;
      color: var(--text-softer);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid rgba(15, 23, 42, 0.9);
      background: linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.92),
        rgba(15, 23, 42, 0.96)
      );
    }

    .footer-left,
    .footer-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .footer-dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: #38bdf8;
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.45);
    }

    .footer-right span {
      white-space: nowrap;
    }

    .footer-right code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      font-size: 10px;
      padding: 1px 4px;
      border-radius: 4px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
    }

    @media (max-width: 960px) {
      .app-shell {
        height: auto;
        max-height: none;
      }

      .app-main {
        flex-direction: column;
      }

      .toolbar {
        width: auto;
        max-width: none;
        order: 1;
      }

      .canvas-shell {
        order: 0;
        min-height: min(440px, 60vh);
      }

      .canvas-inner {
        margin: 12px 10px 10px;
      }

      .canvas-top-strip {
        left: 12px;
        right: 12px;
        font-size: 10px;
      }

      .canvas-bottom-strip {
        left: 12px;
        right: 12px;
        font-size: 10px;
      }

      .floating-preview {
        display: none;
      }
    }

    @media (max-width: 640px) {
      .app-root {
        padding: 6px;
      }

      .app-shell {
        border-radius: 16px;
      }

      .app-header {
        padding: 8px 10px;
      }

      .app-main {
        padding: 6px;
      }

      .toolbar {
        padding: 8px 8px 8px;
      }

      .toolbar-section {
        padding: 8px;
      }

      .canvas-inner {
        margin: 8px 8px 8px;
        border-radius: 14px;
      }

      .canvas-bottom-strip {
        display: none;
      }

      .hint-text {
        display: none;
      }

      .app-footer {
        padding: 6px 8px 8px;
      }
    }
  </style>
</head>
<body>
  <div class="app-root">
    <div class="app-shell">
      <header class="app-header">
        <div class="title-wrap">
          <div class="title-badge" aria-hidden="true"></div>
          <div>
            <div class="title-text-main">Online Whiteboard</div>
            <div class="title-text-sub">
              Draw, explore ideas, and iterate visually –
              <strong>all in your browser</strong>.
            </div>
          </div>
        </div>
        <div class="header-right">
          <div class="pill">
            <span class="pill-dot" aria-hidden="true"></span>
            <span>Local session · Nothing leaves this tab</span>
          </div>
          <div class="pill pill-muted">
            <span>Tip: press <code>F11</code> for full-screen</span>
          </div>
        </div>
      </header>

      <main class="app-main">
        <aside class="toolbar" aria-label="Whiteboard controls">
          <section class="toolbar-section" aria-label="Tools">
            <div class="toolbar-header">
              <span>Tools</span>
              <span>Choose how you draw</span>
            </div>
            <div class="tool-row">
              <div class="segmented" role="radiogroup" aria-label="Drawing tools">
                <button type="button" class="tool-button is-active" data-tool="pen" aria-pressed="true">
                  <span class="glyph" aria-hidden="true"></span>
                  <span class="label">Pen</span>
                </button>
                <button type="button" class="tool-button" data-tool="highlighter" aria-pressed="false">
                  <span class="glyph" aria-hidden="true"></span>
                  <span class="label">Highlighter</span>
                </button>
                <button type="button" class="tool-button" data-tool="eraser" aria-pressed="false">
                  <span class="glyph" aria-hidden="true"></span>
                  <span class="label">Eraser</span>
                </button>
              </div>
            </div>
          </section>

          <section class="toolbar-section" aria-label="Stroke settings">
            <div class="toolbar-header">
              <span>Stroke</span>
              <span>Fine-tune your mark</span>
            </div>
            <div class="subtle-label">
              <span>Brush size</span>
              <span class="key-hint">Scroll or drag</span>
            </div>
            <div class="slider-row">
              <input id="brush-size" type="range" min="2" max="40" value="6" aria-label="Brush size" />
              <div class="slider-value" id="brush-size-value">6 px</div>
            </div>
            <div class="subtle-label" style="margin-top: 10px;">
              <span>Color</span>
              <span class="key-hint">Press <kbd>1–6</kbd></span>
            </div>
            <div class="color-row">
              <div class="swatches" aria-label="Preset colors">
                <button type="button" class="swatch is-active" data-color="#0f172a" style="background:#0f172a;"
                  aria-label="Ink black"></button>
                <button type="button" class="swatch" data-color="#ef4444" style="background:#ef4444;"
                  aria-label="Red"></button>
                <button type="button" class="swatch" data-color="#f97316" style="background:#f97316;"
                  aria-label="Orange"></button>
                <button type="button" class="swatch" data-color="#eab308" style="background:#eab308;"
                  aria-label="Gold"></button>
                <button type="button" class="swatch" data-color="#22c55e" style="background:#22c55e;"
                  aria-label="Green"></button>
                <button type="button" class="swatch" data-color="#3b82f6" style="background:#3b82f6;"
                  aria-label="Blue"></button>
                <button type="button" class="swatch" data-color="#a855f7" style="background:#a855f7;"
                  aria-label="Purple"></button>
              </div>
              <div class="color-picker-wrap">
                <input type="color" id="color-picker" aria-label="Custom color" />
                <span>Custom</span>
              </div>
            </div>
          </section>

          <section class="toolbar-section" aria-label="Board actions">
            <div class="toolbar-header">
              <span>Board</span>
              <span>Manage your canvas</span>
            </div>
            <div class="tool-row wrap">
              <button type="button" class="mono-button small" id="undo-button">
                Undo
                <span class="key">Ctrl+Z</span>
              </button>
              <button type="button" class="mono-button small secondary-outline" id="redo-button">
                Redo
                <span class="key">Ctrl+Y</span>
              </button>
            </div>
            <div class="action-row">
              <button type="button" class="mono-button small danger" id="clear-button">
                Clear board
                <span class="key">Del</span>
              </button>
              <button type="button" class="mono-button small primary" id="save-button">
                Save image
                <span class="key">Ctrl+S</span>
              </button>
            </div>
            <p class="hint-text">
              Shortcuts:
              <code>B</code> pen,
              <code>H</code> highlighter,
              <code>E</code> eraser,
              <code>Ctrl+Z</code>/<code>Ctrl+Y</code> undo/redo,
              <code>Ctrl+S</code> save,
              <code>Del</code> clear.
            </p>
          </section>
        </aside>

        <section class="canvas-shell" aria-label="Drawing surface">
          <div class="canvas-inner">
            <canvas id="whiteboard" class="whiteboard-canvas" aria-label="Drawing area"></canvas>
            <div class="canvas-overlay" aria-hidden="true">
              <div class="canvas-top-strip">
                <div class="badge">
                  <span class="badge-dot"></span>
                  <span>Sketch, map, storyboard, and iterate freely.</span>
                </div>
                <div class="canvas-kb-cheats">
                  <div class="chip">
                    <code>B</code>
                    <span>Pen</span>
                  </div>
                  <div class="chip">
                    <code>H</code>
                    <span>Highlighter</span>
                  </div>
                  <div class="chip">
                    <code>E</code>
                    <span>Eraser</span>
                  </div>
                </div>
              </div>
              <div class="canvas-bottom-strip">
                <div class="canvas-status" id="canvas-status">
                  <span class="canvas-status-dot"></span>
                  <span id="status-text">Ready to draw</span>
                </div>
                <div class="canvas-hint">
                  <strong>Pro tip:</strong>
                  hold <code>Shift</code> while drawing for smoother strokes.
                </div>
              </div>
              <div class="canvas-cta" id="canvas-cta">
                <div class="canvas-cta-inner">
                  <span><strong>Start sketching:</strong></span>
                  <span>select a tool and drag on the board</span>
                  <span><code>B</code> pen · <code>H</code> highlighter</span>
                </div>
              </div>
            </div>
          </div>
          <div class="floating-preview" aria-hidden="true">
            <canvas id="mini-preview"></canvas>
            <div class="floating-preview-label">Live overview</div>
          </div>
        </section>
      </main>

      <footer class="app-footer">
        <div class="footer-left">
          <span class="footer-dot"></span>
          <span>Designed for quick sketches, diagrams, and visual thinking.</span>
        </div>
        <div class="footer-right">
          <span>Keyboard-friendly:</span>
          <code>B</code>
          <span>/</span>
          <code>H</code>
          <span>/</span>
          <code>E</code>
          <span>·</span>
          <code>Ctrl+Z</code>
          <span>/</span>
          <code>Ctrl+Y</code>
          <span>/</span>
          <code>Ctrl+S</code>
        </div>
      </footer>
    </div>
  </div>

  <script>
    (function () {
      "use strict";

      const canvas = document.getElementById("whiteboard");
      const ctx = canvas.getContext("2d", { willReadFrequently: false });
      const miniCanvas = document.getElementById("mini-preview");
      const miniCtx = miniCanvas.getContext("2d");

      const toolButtons = Array.from(document.querySelectorAll(".tool-button"));
      const brushSizeInput = document.getElementById("brush-size");
      const brushSizeValue = document.getElementById("brush-size-value");
      const colorPicker = document.getElementById("color-picker");
      const swatches = Array.from(document.querySelectorAll(".swatch"));
      const undoButton = document.getElementById("undo-button");
      const redoButton = document.getElementById("redo-button");
      const clearButton = document.getElementById("clear-button");
      const saveButton = document.getElementById("save-button");
      const statusText = document.getElementById("status-text");
      const canvasCta = document.getElementById("canvas-cta");

      let viewWidth = 0;
      let viewHeight = 0;

      let currentTool = "pen";
      let currentColor = "#0f172a";
      let currentBrushSize = parseInt(brushSizeInput.value, 10) || 6;

      let strokes = [];
      let undoneStrokes = [];
      let isDrawing = false;
      let activeStroke = null;
      let lastPoint = null;
      let activePointerId = null;
      let hasDrawn = false;

      const state = {
        lastFrame: 0,
        dirtyPreview: true,
      };

      function setStatus(message) {
        statusText.textContent = message;
      }

      function showCtaOnce() {
        if (!hasDrawn) {
          canvasCta.classList.add("is-visible");
        }
      }

      function hideCta() {
        if (canvasCta.classList.contains("is-visible")) {
          canvasCta.classList.remove("is-visible");
        }
      }

      function resizeCanvas() {
        const rect = canvas.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;
        viewWidth = Math.max(1, Math.round(rect.width));
        viewHeight = Math.max(1, Math.round(rect.height));

        canvas.width = viewWidth * dpr;
        canvas.height = viewHeight * dpr;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

        miniCanvas.width = 84;
        miniCanvas.height = 56;

        ctx.lineCap = "round";
        ctx.lineJoin = "round";

        clearCanvasBackground();
        redrawAllStrokes();
        markPreviewDirty();
      }

      function clearCanvasBackground() {
        ctx.save();
        ctx.setTransform(window.devicePixelRatio || 1, 0, 0, window.devicePixelRatio || 1, 0, 0);
        ctx.clearRect(0, 0, viewWidth, viewHeight);
        ctx.fillStyle = "#f9fafb";
        ctx.fillRect(0, 0, viewWidth, viewHeight);
        ctx.restore();
      }

      function createStroke(tool, color, size) {
        return {
          tool,
          color,
          size,
          points: [],
          meta: {
            createdAt: performance.now(),
          },
        };
      }

      function pointFromEvent(evt) {
        const rect = canvas.getBoundingClientRect();
        const x = (evt.clientX - rect.left);
        const y = (evt.clientY - rect.top);
        const nx = viewWidth > 0 ? x / viewWidth : 0;
        const ny = viewHeight > 0 ? y / viewHeight : 0;
        const pressure = typeof evt.pressure === "number" && evt.pressure > 0 ? evt.pressure : 1;
        return { x: nx, y: ny, pressure: pressure };
      }

      function denormalizePoint(p) {
        return {
          x: p.x * viewWidth,
          y: p.y * viewHeight,
          pressure: p.pressure,
        };
      }

      function applyStrokeStyleFor(stroke) {
        const isEraser = stroke.tool === "eraser";
        const isHighlighter = stroke.tool === "highlighter";

        ctx.globalCompositeOperation = isEraser ? "destination-out" : "source-over";
        ctx.globalAlpha = isHighlighter ? 0.22 : 1;
        ctx.strokeStyle = isEraser ? "#000000" : stroke.color;

        const baseSize = stroke.size || 6;
        const effectiveSize = isHighlighter ? baseSize * 2.1 : baseSize;
        ctx.lineWidth = Math.max(0.5, effectiveSize);
      }

      function drawStrokeSegment(stroke, fromPoint, toPoint) {
        if (!fromPoint || !toPoint) return;

        applyStrokeStyleFor(stroke);
        const a = denormalizePoint(fromPoint);
        const b = denormalizePoint(toPoint);

        if (stroke.tool !== "eraser" && (fromPoint.pressure || toPoint.pressure)) {
          const avgPressure = (fromPoint.pressure + toPoint.pressure) / 2;
          const baseSize = stroke.size || 6;
          const isHighlighter = stroke.tool === "highlighter";
          const effectiveSize = isHighlighter ? baseSize * 2.1 : baseSize;
          ctx.lineWidth = Math.max(0.5, effectiveSize * (0.5 + avgPressure * 0.7));
        }

        ctx.beginPath();
        const midX = (a.x + b.x) / 2;
        const midY = (a.y + b.y) / 2;
        ctx.moveTo(a.x, a.y);
        ctx.quadraticCurveTo(a.x, a.y, midX, midY);
        ctx.stroke();
        ctx.globalAlpha = 1;
        ctx.globalCompositeOperation = "source-over";
      }

      function drawCompleteStroke(stroke) {
        if (!stroke || stroke.points.length === 0) {
          return;
        }

        applyStrokeStyleFor(stroke);
        const pts = stroke.points;

        if (pts.length === 1) {
          const p = denormalizePoint(pts[0]);
          ctx.beginPath();
          ctx.arc(p.x, p.y, ctx.lineWidth / 2, 0, Math.PI * 2);
          ctx.fillStyle = ctx.strokeStyle;
          ctx.fill();
          ctx.globalAlpha = 1;
          ctx.globalCompositeOperation = "source-over";
          return;
        }

        const first = denormalizePoint(pts[0]);
        ctx.beginPath();
        ctx.moveTo(first.x, first.y);
        for (let i = 1; i < pts.length; i++) {
          const a = denormalizePoint(pts[i - 1]);
          const b = denormalizePoint(pts[i]);
          const mx = (a.x + b.x) / 2;
          const my = (a.y + b.y) / 2;
          ctx.quadraticCurveTo(a.x, a.y, mx, my);
        }

        const last = denormalizePoint(pts[pts.length - 1]);
        ctx.lineTo(last.x, last.y);
        ctx.stroke();

        ctx.globalAlpha = 1;
        ctx.globalCompositeOperation = "source-over";
      }

      function redrawAllStrokes() {
        clearCanvasBackground();
        if (!Array.isArray(strokes) || strokes.length === 0) {
          showCtaOnce();
          return;
        }

        hideCta();
        for (let i = 0; i < strokes.length; i++) {
          drawCompleteStroke(strokes[i]);
        }
      }

      function markPreviewDirty() {
        state.dirtyPreview = true;
      }

      function renderMiniPreview() {
        if (!state.dirtyPreview) return;
        state.dirtyPreview = false;

        const miniWidth = miniCanvas.width;
        const miniHeight = miniCanvas.height;
        miniCtx.save();
        miniCtx.setTransform(1, 0, 0, 1, 0, 0);
        miniCtx.clearRect(0, 0, miniWidth, miniHeight);
        miniCtx.fillStyle = "#f9fafb";
        miniCtx.fillRect(0, 0, miniWidth, miniHeight);

        if (!strokes.length) {
          miniCtx.restore();
          return;
        }

        miniCtx.lineCap = "round";
        miniCtx.lineJoin = "round";

        const scaleX = miniWidth / viewWidth;
        const scaleY = miniHeight / viewHeight;

        for (let i = 0; i < strokes.length; i++) {
          const stroke = strokes[i];
          const pts = stroke.points;
          if (!pts.length) continue;

          const isEraser = stroke.tool === "eraser";
          const isHighlighter = stroke.tool === "highlighter";
          miniCtx.globalCompositeOperation = isEraser ? "destination-out" : "source-over";
          miniCtx.globalAlpha = isHighlighter ? 0.25 : 1;
          miniCtx.strokeStyle = isEraser ? "#000000" : stroke.color;
          const baseSize = stroke.size || 6;
          const effectiveSize = isHighlighter ? baseSize * 1.6 : baseSize;
          miniCtx.lineWidth = Math.max(0.6, effectiveSize * ((scaleX + scaleY) / 2));

          if (pts.length === 1) {
            const p = pts[0];
            const x = p.x * viewWidth * scaleX;
            const y = p.y * viewHeight * scaleY;
            miniCtx.beginPath();
            miniCtx.arc(x, y, miniCtx.lineWidth / 2, 0, Math.PI * 2);
            miniCtx.fillStyle = miniCtx.strokeStyle;
            miniCtx.fill();
            continue;
          }

          miniCtx.beginPath();
          for (let j = 1; j < pts.length; j++) {
            const prev = pts[j - 1];
            const curr = pts[j];
            const ax = prev.x * viewWidth * scaleX;
            const ay = prev.y * viewHeight * scaleY;
            const bx = curr.x * viewWidth * scaleX;
            const by = curr.y * viewHeight * scaleY;
            const mx = (ax + bx) / 2;
            const my = (ay + by) / 2;
            if (j === 1) {
              miniCtx.moveTo(ax, ay);
            }
            miniCtx.quadraticCurveTo(ax, ay, mx, my);
          }
          miniCtx.stroke();
        }

        miniCtx.globalAlpha = 1;
        miniCtx.globalCompositeOperation = "source-over";
        miniCtx.restore();
      }

      function ensureRenderLoop() {
        function loop(timestamp) {
          state.lastFrame = timestamp;
          renderMiniPreview();
          window.requestAnimationFrame(loop);
        }
        window.requestAnimationFrame(loop);
      }

      function beginStroke(evt) {
        if (evt.button !== undefined && evt.button !== 0) {
          return;
        }

        canvas.focus && canvas.focus();

        activePointerId = evt.pointerId != null ? evt.pointerId : null;
        isDrawing = true;
        undoneStrokes.length = 0;

        activeStroke = createStroke(currentTool, currentColor, currentBrushSize);
        const pt = pointFromEvent(evt);

        activeStroke.points.push(pt);
        strokes.push(activeStroke);
        lastPoint = pt;
        setStatus("Drawing…");
        hideCta();
        hasDrawn = true;

        if (canvas.setPointerCapture && evt.pointerId != null) {
          try {
            canvas.setPointerCapture(evt.pointerId);
          } catch (_) {
          }
        }

        const tap = denormalizePoint(pt);
        applyStrokeStyleFor(activeStroke);
        ctx.beginPath();
        ctx.arc(tap.x, tap.y, ctx.lineWidth / 2, 0, Math.PI * 2);
        ctx.fillStyle = ctx.strokeStyle;
        ctx.fill();
        ctx.globalAlpha = 1;
        ctx.globalCompositeOperation = "source-over";

        markPreviewDirty();
        evt.preventDefault();
      }

      function continueStroke(evt) {
        if (!isDrawing || !activeStroke) return;
        if (activePointerId != null && evt.pointerId != null && evt.pointerId !== activePointerId) {
          return;
        }

        const pt = pointFromEvent(evt);
        const points = activeStroke.points;
        const last = points[points.length - 1];

        if (last && Math.hypot(pt.x - last.x, pt.y - last.y) < 0.002) {
          return;
        }

        activeStroke.points.push(pt);

        if (lastPoint) {
          drawStrokeSegment(activeStroke, lastPoint, pt);
        }
        lastPoint = pt;
        markPreviewDirty();
        evt.preventDefault();
      }

      function endStroke(evt) {
        if (!isDrawing) return;
        if (activePointerId != null && evt.pointerId != null && evt.pointerId !== activePointerId) {
          return;
        }
        isDrawing = false;
        activePointerId = null;
        lastPoint = null;

        if (canvas.releasePointerCapture && evt.pointerId != null) {
          try {
            canvas.releasePointerCapture(evt.pointerId);
          } catch (_) {
          }
        }

        setStatus("Ready to draw");
        markPreviewDirty();
        evt.preventDefault();
      }

      function cancelStroke() {
        if (!isDrawing) return;
        isDrawing = false;
        activePointerId = null;
        lastPoint = null;
        setStatus("Ready to draw");
        markPreviewDirty();
      }

      function updateBrushSizeLabel() {
        brushSizeValue.textContent = currentBrushSize + " px";
      }

      function setTool(tool) {
        currentTool = tool;
        toolButtons.forEach((btn) => {
          const isActive = btn.dataset.tool === tool;
          btn.classList.toggle("is-active", isActive);
          btn.setAttribute("aria-pressed", String(isActive));
        });
        const name = tool === "pen" ? "Pen" : tool === "highlighter" ? "Highlighter" : "Eraser";
        setStatus(name + " selected");
      }

      function setColor(color) {
        currentColor = color;
        swatches.forEach((swatch) => {
          const isActive = swatch.dataset.color &&
            swatch.dataset.color.toLowerCase() === color.toLowerCase();
          swatch.classList.toggle("is-active", isActive);
        });
        colorPicker.value = color;
      }

      function undo() {
        if (!strokes.length) return;
        const stroke = strokes.pop();
        if (stroke) {
          undoneStrokes.push(stroke);
        }
        redrawAllStrokes();
        markPreviewDirty();
        setStatus("Undo");
      }

      function redo() {
        if (!undoneStrokes.length) return;
        const stroke = undoneStrokes.pop();
        if (stroke) {
          strokes.push(stroke);
        }
        redrawAllStrokes();
        markPreviewDirty();
        setStatus("Redo");
      }

      function clearBoard() {
        if (!strokes.length && !hasDrawn) {
          clearCanvasBackground();
          markPreviewDirty();
          return;
        }
        strokes = [];
        undoneStrokes = [];
        clearCanvasBackground();
        markPreviewDirty();
        hasDrawn = false;
        setStatus("Board cleared");
        showCtaOnce();
      }

      function saveImage() {
        try {
          const link = document.createElement("a");
          const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
          link.download = "whiteboard-" + timestamp + ".png";
          if (canvas.toBlob) {
            canvas.toBlob(function (blob) {
              if (!blob) return;
              const url = URL.createObjectURL(blob);
              link.href = url;
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              URL.revokeObjectURL(url);
            }, "image/png");
          } else {
            link.href = canvas.toDataURL("image/png");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }
          setStatus("Image saved as PNG");
        } catch (err) {
          console.error(err);
          setStatus("Unable to save image");
        }
      }

      function handleKeydown(evt) {
        const key = evt.key.toLowerCase();
        const isCtrl = evt.ctrlKey || evt.metaKey;

        if (isCtrl && key === "z") {
          evt.preventDefault();
          undo();
          return;
        }

        if (isCtrl && key === "y") {
          evt.preventDefault();
          redo();
          return;
        }

        if (isCtrl && key === "s") {
          evt.preventDefault();
          saveImage();
          return;
        }

        if (key === "delete" || key === "backspace") {
          if (!(evt.target && (evt.target.tagName === "INPUT" || evt.target.tagName === "TEXTAREA"))) {
            evt.preventDefault();
            clearBoard();
          }
          return;
        }

        if (!evt.target || (evt.target === document.body || evt.target === canvas)) {
          if (key === "b") {
            setTool("pen");
            evt.preventDefault();
          } else if (key === "h") {
            setTool("highlighter");
            evt.preventDefault();
          } else if (key === "e") {
            setTool("eraser");
            evt.preventDefault();
          } else if (key >= "1" && key <= "7") {
            const index = parseInt(key, 10) - 1;
            const sw = swatches[index];
            if (sw) {
              const color = sw.dataset.color;
              if (color) {
                setColor(color);
              }
            }
            evt.preventDefault();
          }
        }
      }

      function attachEventListeners() {
        window.addEventListener("resize", resizeCanvas);

        canvas.addEventListener("pointerdown", beginStroke);
        canvas.addEventListener("pointermove", continueStroke);
        window.addEventListener("pointerup", endStroke);
        window.addEventListener("pointercancel", cancelStroke);
        canvas.addEventListener("pointerleave", function (evt) {
          if (isDrawing) {
            endStroke(evt);
          }
        });

        toolButtons.forEach((btn) => {
          btn.addEventListener("click", function () {
            const tool = btn.dataset.tool;
            if (tool) {
              setTool(tool);
            }
          });
        });

        brushSizeInput.addEventListener("input", function () {
          const next = parseInt(brushSizeInput.value, 10) || 6;
          currentBrushSize = next;
          updateBrushSizeLabel();
        });

        canvas.addEventListener("wheel", function (evt) {
          if (!evt.ctrlKey && !evt.metaKey && !evt.shiftKey) {
            evt.preventDefault();
            const delta = evt.deltaY;
            const step = delta > 0 ? -1 : 1;
            let value = parseInt(brushSizeInput.value, 10) || currentBrushSize;
            value = Math.min(40, Math.max(2, value + step));
            currentBrushSize = value;
            brushSizeInput.value = String(value);
            updateBrushSizeLabel();
          }
        }, { passive: false });

        colorPicker.addEventListener("input", function () {
          setColor(colorPicker.value);
        });

        swatches.forEach((swatch) => {
          swatch.addEventListener("click", function () {
            const color = swatch.dataset.color;
            if (color) {
              setColor(color);
            }
          });
        });

        undoButton.addEventListener("click", undo);
        redoButton.addEventListener("click", redo);
        clearButton.addEventListener("click", clearBoard);
        saveButton.addEventListener("click", saveImage);

        window.addEventListener("keydown", handleKeydown);
      }

      function init() {
        try {
          if (!canvas || !ctx || !miniCanvas || !miniCtx) {
            return;
          }

          colorPicker.value = currentColor;
          updateBrushSizeLabel();
          showCtaOnce();

          resizeCanvas();
          attachEventListeners();
          ensureRenderLoop();
        } catch (err) {
          console.error(err);
          setStatus("Whiteboard initialisation failed");
        }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>

