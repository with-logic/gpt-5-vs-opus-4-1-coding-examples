<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Virtual Drum Kit</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Virtual Drum Kit - play a studio-style drum set with your keyboard or by tapping pads, with recording and playback."
    />
    <style>
      :root {
        --bg: #050816;
        --bg-elevated: #0b1020;
        --bg-panel: #0f172a;
        --border-subtle: rgba(148, 163, 184, 0.2);
        --accent: #f97316;
        --accent-soft: rgba(249, 115, 22, 0.25);
        --accent-strong: #fb923c;
        --accent-red: #ef4444;
        --accent-green: #22c55e;
        --text-primary: #e5e7eb;
        --text-muted: #9ca3af;
        --pad-default: #111827;
        --pad-highlight: #1f2937;
        --pad-border: rgba(148, 163, 184, 0.3);
        --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.85);
        --radius-lg: 18px;
        --radius-full: 999px;
        --focus-ring: 0 0 0 2px rgba(15, 23, 42, 0.9),
          0 0 0 4px rgba(249, 115, 22, 0.8);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #111827 0, #020617 40%, #020617 100%);
        color: var(--text-primary);
        -webkit-font-smoothing: antialiased;
      }

      body {
        display: flex;
        align-items: stretch;
        justify-content: center;
        padding: 16px;
      }

      .studio-background {
        position: fixed;
        inset: 0;
        overflow: hidden;
        pointer-events: none;
        z-index: -1;
      }

      .studio-glow {
        position: absolute;
        border-radius: 999px;
        filter: blur(80px);
        opacity: 0.7;
        transform: translate3d(0, 0, 0);
      }

      .studio-glow.glow-top {
        width: 420px;
        height: 420px;
        top: -160px;
        left: -80px;
        background: radial-gradient(circle, #22c55e 0, transparent 60%);
      }

      .studio-glow.glow-right {
        width: 460px;
        height: 460px;
        bottom: -200px;
        right: -140px;
        background: radial-gradient(circle, #0ea5e9 0, transparent 60%);
      }

      .studio-glow.glow-center {
        width: 420px;
        height: 420px;
        top: 20%;
        right: 40%;
        background: radial-gradient(circle, rgba(249, 115, 22, 0.9) 0, transparent 60%);
        opacity: 0.25;
      }

      .app-shell {
        position: relative;
        margin: auto;
        max-width: 1040px;
        width: 100%;
        background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.14), transparent 55%),
          radial-gradient(circle at bottom right, rgba(15, 118, 110, 0.28), transparent 55%),
          linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.22);
        box-shadow: var(--shadow-soft);
        padding: 20px 20px 16px;
        backdrop-filter: blur(26px) saturate(155%);
      }

      @media (min-width: 768px) {
        .app-shell {
          padding: 24px 28px 22px;
        }
      }

      .app-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 16px;
      }

      .title-block {
        display: flex;
        align-items: center;
        gap: 14px;
      }

      .logo-badge {
        width: 44px;
        height: 44px;
        border-radius: 18px;
        background: radial-gradient(circle at 30% 20%, #f97316, #ea580c);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 12px 30px rgba(249, 115, 22, 0.7);
        position: relative;
        overflow: hidden;
      }

      .logo-badge::before,
      .logo-badge::after {
        content: "";
        position: absolute;
        border-radius: 999px;
        border: 1px solid rgba(254, 243, 199, 0.25);
      }

      .logo-badge::before {
        inset: 8px;
      }

      .logo-badge::after {
        inset: 14px;
      }

      .logo-icon {
        width: 20px;
        height: 20px;
        border-radius: 999px;
        border: 2px solid rgba(254, 249, 195, 0.85);
        box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.4);
        position: relative;
      }

      .logo-icon::before,
      .logo-icon::after {
        content: "";
        position: absolute;
        inset: 4px;
        border-radius: 999px;
        border: 1px solid rgba(254, 243, 199, 0.9);
        opacity: 0.6;
      }

      .logo-icon::after {
        inset: 8px;
        opacity: 0.4;
      }

      .title-text h1 {
        font-size: 1.35rem;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        margin: 0 0 4px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .title-pill {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(254, 215, 170, 0.5);
        color: #fed7aa;
        background: radial-gradient(circle, rgba(248, 250, 252, 0.1), transparent 55%);
      }

      .title-subtitle {
        font-size: 0.85rem;
        color: var(--text-muted);
        max-width: 440px;
      }

      .header-right {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 6px;
        min-width: 180px;
      }

      .indicator-row {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 6px 10px;
        border-radius: 999px;
        background: radial-gradient(circle at 0 0, rgba(34, 197, 94, 0.22), transparent 70%),
          rgba(15, 23, 42, 0.92);
        border: 1px solid rgba(34, 197, 94, 0.45);
        box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9);
      }

      .led {
        width: 9px;
        height: 9px;
        border-radius: 999px;
        background: radial-gradient(circle, #22c55e, #16a34a);
        box-shadow: 0 0 8px rgba(34, 197, 94, 0.95);
      }

      .indicator-row span {
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: #bbf7d0;
        white-space: nowrap;
      }

      .key-hints {
        font-size: 0.74rem;
        color: var(--text-muted);
        text-align: right;
      }

      .key-hints code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        font-size: 0.7rem;
      }

      .app-main {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
        gap: 18px;
      }

      @media (max-width: 900px) {
        .app-main {
          grid-template-columns: minmax(0, 1fr);
        }
        .header-right {
          align-items: flex-start;
        }
        .key-hints {
          text-align: left;
        }
      }

      .drum-surface {
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95));
        border-radius: var(--radius-lg);
        border: 1px solid rgba(148, 163, 184, 0.35);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.75);
        padding: 16px 14px 12px;
        position: relative;
        overflow: hidden;
      }

      @media (min-width: 768px) {
        .drum-surface {
          padding: 18px 18px 14px;
        }
      }

      .drum-surface::before {
        content: "";
        position: absolute;
        inset: -40%;
        background-image: radial-gradient(circle, rgba(148, 163, 184, 0.12) 1px, transparent 0);
        background-size: 40px 40px;
        opacity: 0.3;
        pointer-events: none;
      }

      .drum-surface-inner {
        position: relative;
        z-index: 1;
      }

      .pad-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 10px;
      }

      .pad-header span {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        color: rgba(148, 163, 184, 0.85);
      }

      .pad-legend {
        font-size: 0.72rem;
        color: var(--text-muted);
      }

      .pad-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 10px;
      }

      @media (max-width: 720px) {
        .pad-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      .pad {
        position: relative;
        min-height: 108px;
        padding: 10px 8px 10px;
        border-radius: 22px;
        border: 1px solid var(--pad-border);
        background: radial-gradient(circle at 20% 0, rgba(148, 163, 184, 0.32), transparent 55%),
          linear-gradient(145deg, #020617, #020617);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.95), 0 10px 22px rgba(15, 23, 42, 0.9);
        color: var(--text-primary);
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: stretch;
        text-align: left;
        transition:
          transform 0.08s ease-out,
          box-shadow 0.08s ease-out,
          border-color 0.12s ease-out,
          background-position 0.12s ease-out;
        background-size: 300% 300%;
        background-position: 20% 0%;
        overflow: hidden;
      }

      .pad::before {
        content: "";
        position: absolute;
        inset: 1px;
        border-radius: 20px;
        background: radial-gradient(circle at 80% 120%, rgba(59, 130, 246, 0.32), transparent 60%);
        opacity: 0;
        transition: opacity 0.12s ease-out;
      }

      .pad:hover {
        transform: translateY(-1px);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9), 0 14px 28px rgba(15, 23, 42, 0.95);
        border-color: rgba(148, 163, 184, 0.5);
      }

      .pad:focus-visible {
        outline: none;
        box-shadow: var(--focus-ring), 0 14px 30px rgba(15, 23, 42, 0.95);
      }

      .pad-main {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 6px;
      }

      .pad-label {
        font-size: 0.86rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        white-space: nowrap;
      }

      .pad-sub {
        font-size: 0.7rem;
        color: var(--text-muted);
      }

      .pad-keycap {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        font-size: 0.8rem;
        padding: 3px 9px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.38), transparent 70%),
          rgba(15, 23, 42, 0.98);
        box-shadow: 0 4px 10px rgba(15, 23, 42, 0.9);
      }

      .pad-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 10px;
      }

      .pad-meter {
        position: relative;
        display: inline-flex;
        gap: 3px;
        align-items: flex-end;
        height: 14px;
      }

      .pad-meter-bar {
        width: 3px;
        border-radius: 999px;
        background: linear-gradient(to top, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.95));
        opacity: 0.5;
        transform-origin: bottom;
        transform: scaleY(0.2);
        transition: transform 0.1s ease-out, opacity 0.1s ease-out;
      }

      .pad-type {
        font-size: 0.72rem;
        color: rgba(148, 163, 184, 0.95);
        text-transform: uppercase;
        letter-spacing: 0.18em;
      }

      .pad.active {
        transform: translateY(2px) scale(0.985);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.95), 0 8px 20px rgba(0, 0, 0, 0.85);
        border-color: rgba(249, 115, 22, 0.85);
        background-position: 60% 40%;
      }

      .pad.active::before {
        opacity: 1;
      }

      .pad.active .pad-meter-bar {
        transform: scaleY(1);
        opacity: 1;
      }

      @media (max-width: 600px) {
        .pad {
          min-height: 120px;
          padding-inline: 10px;
        }
      }

      .control-panel {
        background: linear-gradient(160deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.99));
        border-radius: var(--radius-lg);
        border: 1px solid rgba(148, 163, 184, 0.4);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
        padding: 14px 14px 12px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      @media (min-width: 768px) {
        .control-panel {
          padding: 16px;
        }
      }

      .transport {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
      }

      .transport-left,
      .transport-right {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .btn {
        position: relative;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.26), transparent 55%),
          rgba(15, 23, 42, 0.95);
        color: var(--text-primary);
        font-size: 0.78rem;
        padding: 7px 13px;
        display: inline-flex;
        align-items: center;
        gap: 7px;
        cursor: pointer;
        box-shadow: 0 7px 14px rgba(15, 23, 42, 0.9);
        text-transform: uppercase;
        letter-spacing: 0.18em;
        min-height: 30px;
        transition:
          transform 0.1s ease-out,
          box-shadow 0.1s ease-out,
          border-color 0.1s ease-out,
          background-color 0.12s ease-out;
      }

      .btn span.icon {
        width: 8px;
        height: 8px;
        border-radius: 2px;
      }

      .btn-record span.icon {
        border-radius: 999px;
        background: radial-gradient(circle, #ef4444, #b91c1c);
        box-shadow: 0 0 12px rgba(239, 68, 68, 0.9);
      }

      .btn-play span.icon {
        width: 0;
        height: 0;
        border-left: 8px solid #22c55e;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
        border-radius: 1px;
        box-shadow: 0 0 8px rgba(34, 197, 94, 0.9);
      }

      .btn-stop span.icon {
        border-radius: 2px;
        background: linear-gradient(to bottom right, #f97316, #ea580c);
        box-shadow: 0 0 9px rgba(249, 115, 22, 0.9);
      }

      .btn-clear span.icon {
        border-radius: 999px;
        width: 10px;
        height: 10px;
        border: 2px solid rgba(148, 163, 184, 0.9);
        box-shadow: none;
      }

      .btn:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 10px 18px rgba(0, 0, 0, 0.95);
        border-color: rgba(249, 115, 22, 0.8);
      }

      .btn:active:not(:disabled) {
        transform: translateY(1px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.9);
      }

      .btn:focus-visible {
        outline: none;
        box-shadow: var(--focus-ring), 0 6px 13px rgba(0, 0, 0, 0.9);
      }

      .btn-primary {
        background: radial-gradient(circle at 0 0, rgba(249, 115, 22, 0.32), transparent 60%),
          linear-gradient(130deg, #f97316, #ea580c);
        border-color: rgba(249, 115, 22, 0.9);
        color: #0b1120;
      }

      .btn-toggle-on {
        box-shadow: 0 0 10px rgba(249, 115, 22, 0.8), 0 8px 18px rgba(15, 23, 42, 0.9);
      }

      .btn:disabled {
        opacity: 0.55;
        cursor: default;
        box-shadow: none;
      }

      .record-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        margin-right: 4px;
        background: radial-gradient(circle, #ef4444, #b91c1c);
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.9);
        opacity: 0;
      }

      .record-dot.blink {
        animation: blink 1s ease-in-out infinite;
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 0.15;
        }
        50% {
          opacity: 1;
        }
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 5px 10px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
        font-size: 0.72rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.16em;
      }

      .status-pill[data-mode="idle"] {
        border-color: rgba(148, 163, 184, 0.65);
      }

      .status-pill[data-mode="recording"] {
        border-color: rgba(248, 113, 113, 0.9);
        color: #fecaca;
        background: linear-gradient(
          125deg,
          rgba(127, 29, 29, 0.85),
          rgba(127, 29, 29, 0.95),
          rgba(185, 28, 28, 0.95)
        );
      }

      .status-pill[data-mode="playing"] {
        border-color: rgba(52, 211, 153, 0.9);
        color: #bbf7d0;
        background: linear-gradient(
          125deg,
          rgba(6, 78, 59, 0.9),
          rgba(5, 150, 105, 0.9),
          rgba(16, 185, 129, 0.9)
        );
      }

      .status-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.9);
      }

      .status-pill[data-mode="recording"] .status-dot {
        background: #fecaca;
      }

      .status-pill[data-mode="playing"] .status-dot {
        background: #bbf7d0;
      }

      .status-text-main {
        font-weight: 600;
      }

      .status-text-sub {
        font-size: 0.66rem;
        opacity: 0.8;
      }

      .status-text-sub span {
        color: #e5e7eb;
      }

      .status-text-sub strong {
        font-weight: 600;
        color: #f97316;
      }

      .timeline {
        display: flex;
        flex-direction: column;
        gap: 7px;
      }

      .timeline-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .timeline-bar-wrapper {
        flex: 1;
        position: relative;
        border-radius: 999px;
        padding: 6px 10px;
        background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.22), transparent 65%),
          rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.45);
      }

      .timeline-bar {
        position: relative;
        height: 6px;
        border-radius: 999px;
        background: linear-gradient(
          to right,
          rgba(148, 163, 184, 0.55),
          rgba(96, 165, 250, 0.95),
          rgba(52, 211, 153, 0.95)
        );
        overflow: hidden;
      }

      .timeline-progress {
        position: absolute;
        inset: 0;
        border-radius: inherit;
        transform-origin: left;
        transform: scaleX(0);
        background: linear-gradient(
          90deg,
          rgba(34, 197, 94, 0.1),
          rgba(34, 197, 94, 0.9),
          rgba(56, 189, 248, 0.95)
        );
      }

      .timeline-empty {
        font-size: 0.7rem;
        color: var(--text-muted);
      }

      .timeline-count {
        font-size: 0.7rem;
        color: var(--text-muted);
        min-width: 80px;
        text-align: right;
      }

      .timeline-count span {
        color: #e5e7eb;
        font-weight: 600;
      }

      .knob-group {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
        gap: 10px;
        align-items: center;
      }

      @media (max-width: 720px) {
        .knob-group {
          grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
        }
      }

      .slider-block {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .slider-label-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 6px;
      }

      .slider-label-main {
        font-size: 0.74rem;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        color: rgba(148, 163, 184, 0.95);
      }

      .slider-label-value {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        font-size: 0.7rem;
        color: #e5e7eb;
        padding: 1px 7px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
      }

      .slider-helper {
        font-size: 0.7rem;
        color: var(--text-muted);
      }

      .slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 4px;
        border-radius: 999px;
        background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.28), transparent 60%),
          rgba(15, 23, 42, 0.95);
        outline: none;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 999px;
        background: radial-gradient(circle at 35% 25%, #f97316, #ea580c);
        border: 2px solid rgba(15, 23, 42, 0.95);
        box-shadow:
          0 0 0 2px rgba(249, 115, 22, 0.7),
          0 0 16px rgba(249, 115, 22, 0.85);
        cursor: pointer;
        margin-top: -6px;
      }

      .slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        background: radial-gradient(circle at 35% 25%, #f97316, #ea580c);
        border: 2px solid rgba(15, 23, 42, 0.95);
        box-shadow:
          0 0 0 2px rgba(249, 115, 22, 0.7),
          0 0 16px rgba(249, 115, 22, 0.85);
        cursor: pointer;
      }

      .slider::-moz-range-track {
        height: 4px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.95);
      }

      .tips {
        font-size: 0.7rem;
        color: var(--text-muted);
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: space-between;
        padding-top: 4px;
        border-top: 1px dashed rgba(148, 163, 184, 0.35);
      }

      .tips strong {
        color: #e5e7eb;
      }

      .tips code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
      }

      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div class="studio-background" aria-hidden="true">
      <div class="studio-glow glow-top"></div>
      <div class="studio-glow glow-right"></div>
      <div class="studio-glow glow-center"></div>
    </div>

    <main class="app-shell" aria-label="Virtual Drum Kit">
      <header class="app-header">
        <div class="title-block">
          <div class="logo-badge" aria-hidden="true">
            <div class="logo-icon"></div>
          </div>
          <div class="title-text">
            <h1>
              Virtual Drum Kit
              <span class="title-pill">Studio Mode</span>
            </h1>
            <div class="title-subtitle">
              Tap the pads or use your keyboard to play a live drum kit. Hit
              <strong>Record</strong>, perform a groove, then <strong>Play</strong> it back.
            </div>
          </div>
        </div>
        <div class="header-right">
          <div class="indicator-row" aria-hidden="true">
            <span class="led"></span>
            <span>Live Audio Engine</span>
          </div>
          <div class="key-hints">
            Pads are mapped to
            <code>A&nbsp;S&nbsp;D&nbsp;F&nbsp;J&nbsp;K&nbsp;L&nbsp;;</code>
          </div>
        </div>
      </header>

      <section class="app-main">
        <section class="drum-surface" aria-label="Drum pads">
          <div class="drum-surface-inner">
            <div class="pad-header">
              <span>Performance Pads</span>
              <div class="pad-legend">Tap or press the matching key.</div>
            </div>
            <div class="pad-grid">
              <button
                class="pad"
                type="button"
                data-sound="kick"
                data-key="A"
                aria-label="Kick drum (key A)"
              >
                <div class="pad-main">
                  <div>
                    <div class="pad-label">Kick</div>
                    <div class="pad-sub">Deep studio bass</div>
                  </div>
                  <div class="pad-keycap">A</div>
                </div>
                <div class="pad-footer">
                  <div class="pad-meter" aria-hidden="true">
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                  </div>
                  <div class="pad-type">Bass Drum</div>
                </div>
              </button>

              <button
                class="pad"
                type="button"
                data-sound="snare"
                data-key="S"
                aria-label="Snare drum (key S)"
              >
                <div class="pad-main">
                  <div>
                    <div class="pad-label">Snare</div>
                    <div class="pad-sub">Tight studio crack</div>
                  </div>
                  <div class="pad-keycap">S</div>
                </div>
                <div class="pad-footer">
                  <div class="pad-meter" aria-hidden="true">
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                  </div>
                  <div class="pad-type">Snare</div>
                </div>
              </button>

              <button
                class="pad"
                type="button"
                data-sound="hihat-closed"
                data-key="D"
                aria-label="Closed hi-hat (key D)"
              >
                <div class="pad-main">
                  <div>
                    <div class="pad-label">Hi-Hat</div>
                    <div class="pad-sub">Closed, sharp tick</div>
                  </div>
                  <div class="pad-keycap">D</div>
                </div>
                <div class="pad-footer">
                  <div class="pad-meter" aria-hidden="true">
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                  </div>
                  <div class="pad-type">Closed Hat</div>
                </div>
              </button>

              <button
                class="pad"
                type="button"
                data-sound="hihat-open"
                data-key="F"
                aria-label="Open hi-hat (key F)"
              >
                <div class="pad-main">
                  <div>
                    <div class="pad-label">Hi-Hat</div>
                    <div class="pad-sub">Open shimmer</div>
                  </div>
                  <div class="pad-keycap">F</div>
                </div>
                <div class="pad-footer">
                  <div class="pad-meter" aria-hidden="true">
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                  </div>
                  <div class="pad-type">Open Hat</div>
                </div>
              </button>

              <button
                class="pad"
                type="button"
                data-sound="tom-low"
                data-key="J"
                aria-label="Low tom (key J)"
              >
                <div class="pad-main">
                  <div>
                    <div class="pad-label">Tom</div>
                    <div class="pad-sub">Low shell</div>
                  </div>
                  <div class="pad-keycap">J</div>
                </div>
                <div class="pad-footer">
                  <div class="pad-meter" aria-hidden="true">
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                  </div>
                  <div class="pad-type">Floor Tom</div>
                </div>
              </button>

              <button
                class="pad"
                type="button"
                data-sound="tom-mid"
                data-key="K"
                aria-label="Mid tom (key K)"
              >
                <div class="pad-main">
                  <div>
                    <div class="pad-label">Tom</div>
                    <div class="pad-sub">Mid punch</div>
                  </div>
                  <div class="pad-keycap">K</div>
                </div>
                <div class="pad-footer">
                  <div class="pad-meter" aria-hidden="true">
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                  </div>
                  <div class="pad-type">Rack Tom</div>
                </div>
              </button>

              <button
                class="pad"
                type="button"
                data-sound="crash"
                data-key="L"
                aria-label="Crash cymbal (key L)"
              >
                <div class="pad-main">
                  <div>
                    <div class="pad-label">Crash</div>
                    <div class="pad-sub">Bright accent</div>
                  </div>
                  <div class="pad-keycap">L</div>
                </div>
                <div class="pad-footer">
                  <div class="pad-meter" aria-hidden="true">
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                  </div>
                  <div class="pad-type">Cymbal</div>
                </div>
              </button>

              <button
                class="pad"
                type="button"
                data-sound="clap"
                data-key=";"
                aria-label="Clap (key semicolon)"
              >
                <div class="pad-main">
                  <div>
                    <div class="pad-label">Clap</div>
                    <div class="pad-sub">Studio layer</div>
                  </div>
                  <div class="pad-keycap">;</div>
                </div>
                <div class="pad-footer">
                  <div class="pad-meter" aria-hidden="true">
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                    <div class="pad-meter-bar"></div>
                  </div>
                  <div class="pad-type">Percussion</div>
                </div>
              </button>
            </div>
          </div>
        </section>

        <aside class="control-panel" aria-label="Recording controls and timeline">
          <div class="transport">
            <div class="transport-left">
              <button
                class="btn btn-record"
                type="button"
                id="record-btn"
                aria-pressed="false"
                aria-label="Record a new performance"
              >
                <span class="record-dot" id="record-led"></span>
                <span class="icon" aria-hidden="true"></span>
                <span>Record</span>
              </button>
              <button
                class="btn btn-play"
                type="button"
                id="play-btn"
                aria-pressed="false"
                aria-label="Play or stop the recorded performance"
              >
                <span class="icon" aria-hidden="true"></span>
                <span id="play-label">Play</span>
              </button>
              <button
                class="btn btn-clear"
                type="button"
                id="clear-btn"
                aria-label="Clear the current recording"
              >
                <span class="icon" aria-hidden="true"></span>
                <span>Clear</span>
              </button>
            </div>
            <div class="transport-right">
              <div class="status-pill" id="status-pill" data-mode="idle">
                <span class="status-dot"></span>
                <div>
                  <div class="status-text-main" id="status-main">Ready</div>
                  <div class="status-text-sub" id="status-sub">
                    Hit <strong>Record</strong> and play a beat.
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="timeline">
            <div class="timeline-row">
              <div class="timeline-bar-wrapper">
                <div class="timeline-bar" aria-hidden="true">
                  <div class="timeline-progress" id="timeline-progress"></div>
                </div>
                <div class="timeline-empty" id="timeline-empty">
                  No events yet — your groove will appear here.
                </div>
              </div>
              <div class="timeline-count" id="timeline-count">
                Hits: <span>0</span>
              </div>
            </div>
          </div>

          <div class="knob-group" aria-label="Playback and sensitivity settings">
            <div class="slider-block">
              <div class="slider-label-row">
                <div class="slider-label-main">Playback Speed</div>
                <div class="slider-label-value"><span id="tempo-display">1.0×</span></div>
              </div>
              <input
                id="tempo-slider"
                class="slider"
                type="range"
                min="0.5"
                max="1.5"
                step="0.05"
                value="1"
                aria-label="Playback speed"
              />
              <div class="slider-helper">Slow things down or push the tempo.</div>
            </div>
            <div class="slider-block">
              <div class="slider-label-row">
                <div class="slider-label-main">Pad Dynamics</div>
                <div class="slider-label-value"><span id="sensitivity-display">Normal</span></div>
              </div>
              <input
                id="sensitivity-slider"
                class="slider"
                type="range"
                min="0.6"
                max="1.4"
                step="0.1"
                value="1"
                aria-label="Pad sensitivity"
              />
              <div class="slider-helper">Shape how hard the hits feel.</div>
            </div>
          </div>

          <div class="tips" aria-label="Usage tips">
            <div>
              <strong>Pro tip:</strong> Layer <code>Kick</code> + <code>Clap</code> on beats
              1&nbsp;&amp;&nbsp;3 for an instant groove.
            </div>
            <div>
              <strong>Shortcut:</strong> Use the key row
              <code>A&nbsp;S&nbsp;D&nbsp;F&nbsp;J&nbsp;K&nbsp;L&nbsp;;</code>
              to play without leaving the keyboard.
            </div>
          </div>
        </aside>
      </section>
    </main>

    <script>
      (function () {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        const state = {
          isRecording: false,
          isPlaying: false,
          recordStartTime: 0,
          recordedEvents: [],
          playbackTimeouts: [],
          playbackStartTime: 0,
          lastDuration: 0,
          baseVelocity: 1,
          playbackSpeed: 1,
        };

        const pads = Array.from(document.querySelectorAll(".pad"));
        const recordBtn = document.getElementById("record-btn");
        const recordLed = document.getElementById("record-led");
        const playBtn = document.getElementById("play-btn");
        const playLabel = document.getElementById("play-label");
        const clearBtn = document.getElementById("clear-btn");
        const statusPill = document.getElementById("status-pill");
        const statusMain = document.getElementById("status-main");
        const statusSub = document.getElementById("status-sub");
        const timelineEmpty = document.getElementById("timeline-empty");
        const timelineProgress = document.getElementById("timeline-progress");
        const timelineCount = document.getElementById("timeline-count").querySelector("span");
        const tempoSlider = document.getElementById("tempo-slider");
        const tempoDisplay = document.getElementById("tempo-display");
        const sensitivitySlider = document.getElementById("sensitivity-slider");
        const sensitivityDisplay = document.getElementById("sensitivity-display");

        function ensureAudioContext() {
          if (!AudioContext) {
            console.warn("Web Audio API not supported in this browser.");
            return null;
          }
          if (!audioCtx) {
            audioCtx = new AudioContext();
          }
          if (audioCtx.state === "suspended") {
            audioCtx.resume();
          }
          return audioCtx;
        }

        function envGain(duration) {
          const ctx = ensureAudioContext();
          if (!ctx) return null;
          const gain = ctx.createGain();
          gain.gain.setValueAtTime(0, ctx.currentTime);
          gain.gain.linearRampToValueAtTime(1, ctx.currentTime + 0.001);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
          return gain;
        }

        function playKick(velocity) {
          const ctx = ensureAudioContext();
          if (!ctx) return;
          const osc = ctx.createOscillator();
          const gain = envGain(0.35);
          if (!gain) return;

          osc.type = "sine";
          const now = ctx.currentTime;
          const baseFreq = 80 * velocity;
          osc.frequency.setValueAtTime(baseFreq * 1.9, now);
          osc.frequency.exponentialRampToValueAtTime(baseFreq * 0.4, now + 0.25);

          gain.gain.cancelScheduledValues(now);
          gain.gain.setValueAtTime(1.1 * velocity, now);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 0.35);

          osc.connect(gain);
          gain.connect(ctx.destination);

          osc.start(now);
          osc.stop(now + 0.4);
        }

        function playSnare(velocity) {
          const ctx = ensureAudioContext();
          if (!ctx) return;

          const bufferSize = ctx.sampleRate * 0.4;
          const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
          const data = buffer.getChannelData(0);

          for (let i = 0; i < bufferSize; i++) {
            data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
          }

          const noise = ctx.createBufferSource();
          noise.buffer = buffer;

          const noiseFilter = ctx.createBiquadFilter();
          noiseFilter.type = "bandpass";
          noiseFilter.frequency.value = 1800;
          noiseFilter.Q.value = 0.8;

          const noiseGain = ctx.createGain();
          const now = ctx.currentTime;
          noiseGain.gain.setValueAtTime(1.2 * velocity, now);
          noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);

          noise.connect(noiseFilter);
          noiseFilter.connect(noiseGain);
          noiseGain.connect(ctx.destination);

          const toneOsc = ctx.createOscillator();
          const toneGain = ctx.createGain();
          toneOsc.type = "triangle";
          toneOsc.frequency.setValueAtTime(220, now);
          toneOsc.frequency.exponentialRampToValueAtTime(140, now + 0.15);

          toneGain.gain.setValueAtTime(0.8 * velocity, now);
          toneGain.gain.exponentialRampToValueAtTime(0.001, now + 0.18);

          toneOsc.connect(toneGain);
          toneGain.connect(ctx.destination);

          noise.start(now);
          noise.stop(now + 0.25);
          toneOsc.start(now);
          toneOsc.stop(now + 0.22);
        }

        function createHiHatNoise(duration, frequency, velocity, open) {
          const ctx = ensureAudioContext();
          if (!ctx) return;

          const bufferSize = ctx.sampleRate * duration;
          const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
          const data = buffer.getChannelData(0);
          for (let i = 0; i < bufferSize; i++) {
            data[i] = Math.random() * 2 - 1;
          }

          const noise = ctx.createBufferSource();
          noise.buffer = buffer;

          const hp = ctx.createBiquadFilter();
          hp.type = "highpass";
          hp.frequency.value = frequency;

          const bp = ctx.createBiquadFilter();
          bp.type = "bandpass";
          bp.frequency.value = open ? 9500 : 11000;
          bp.Q.value = open ? 0.8 : 1.4;

          const gain = ctx.createGain();
          const now = ctx.currentTime;
          const base = open ? 0.8 : 0.5;
          gain.gain.setValueAtTime(base * velocity, now);
          if (open) {
            gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
          } else {
            gain.gain.exponentialRampToValueAtTime(0.001, now + duration * 0.5);
          }

          noise.connect(hp);
          hp.connect(bp);
          bp.connect(gain);
          gain.connect(ctx.destination);

          noise.start(now);
          noise.stop(now + duration);
        }

        function playHiHatClosed(velocity) {
          createHiHatNoise(0.09, 9000, velocity, false);
        }

        function playHiHatOpen(velocity) {
          createHiHatNoise(0.38, 7500, velocity, true);
        }

        function playTom(frequency, velocity) {
          const ctx = ensureAudioContext();
          if (!ctx) return;

          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          const now = ctx.currentTime;

          osc.type = "sine";
          osc.frequency.setValueAtTime(frequency * 1.05, now);
          osc.frequency.exponentialRampToValueAtTime(frequency * 0.6, now + 0.25);

          gain.gain.setValueAtTime(1 * velocity, now);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 0.35);

          const filter = ctx.createBiquadFilter();
          filter.type = "lowpass";
          filter.frequency.value = 2200;
          filter.Q.value = 0.8;

          osc.connect(filter);
          filter.connect(gain);
          gain.connect(ctx.destination);

          osc.start(now);
          osc.stop(now + 0.4);
        }

        function playCrash(velocity) {
          const ctx = ensureAudioContext();
          if (!ctx) return;

          const bufferSize = ctx.sampleRate * 1.6;
          const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
          const data = buffer.getChannelData(0);
          for (let i = 0; i < bufferSize; i++) {
            data[i] =
              (Math.random() * 2 - 1) *
              (1 - i / bufferSize) *
              (i < bufferSize * 0.06 ? 0.7 : 1);
          }

          const noise = ctx.createBufferSource();
          noise.buffer = buffer;

          const hp = ctx.createBiquadFilter();
          hp.type = "highpass";
          hp.frequency.value = 5000;

          const gain = ctx.createGain();
          const now = ctx.currentTime;
          gain.gain.setValueAtTime(1.4 * velocity, now);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 1.6);

          noise.connect(hp);
          hp.connect(gain);
          gain.connect(ctx.destination);

          noise.start(now);
          noise.stop(now + 1.7);
        }

        function playClap(velocity) {
          const ctx = ensureAudioContext();
          if (!ctx) return;

          const bufferSize = ctx.sampleRate * 0.35;
          const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
          const data = buffer.getChannelData(0);
          for (let i = 0; i < bufferSize; i++) {
            data[i] = Math.random() * 2 - 1;
          }

          const createBurst = (offset, scale) => {
            const src = ctx.createBufferSource();
            src.buffer = buffer;

            const bp = ctx.createBiquadFilter();
            bp.type = "bandpass";
            bp.frequency.value = 1800;
            bp.Q.value = 1.2;

            const gain = ctx.createGain();
            const t = ctx.currentTime + offset;
            gain.gain.setValueAtTime(scale * velocity, t);
            gain.gain.exponentialRampToValueAtTime(0.001, t + 0.22);

            src.connect(bp);
            bp.connect(gain);
            gain.connect(ctx.destination);

            src.start(t);
            src.stop(t + 0.25);
          };

          createBurst(0, 1.1);
          createBurst(0.035, 0.95);
          createBurst(0.07, 0.8);
        }

        function playSound(id, velocityScale) {
          const velocity = velocityScale * state.baseVelocity;
          switch (id) {
            case "kick":
              playKick(velocity);
              break;
            case "snare":
              playSnare(velocity);
              break;
            case "hihat-closed":
              playHiHatClosed(velocity);
              break;
            case "hihat-open":
              playHiHatOpen(velocity);
              break;
            case "tom-low":
              playTom(140, velocity);
              break;
            case "tom-mid":
              playTom(190, velocity);
              break;
            case "crash":
              playCrash(velocity);
              break;
            case "clap":
              playClap(velocity);
              break;
            default:
              break;
          }
        }

        function animatePad(padEl) {
          if (!padEl) return;
          padEl.classList.remove("active");
          void padEl.offsetWidth;
          padEl.classList.add("active");

          const bars = padEl.querySelectorAll(".pad-meter-bar");
          const hitLevel = 0.6 + Math.random() * 0.4;

          bars.forEach((bar, index) => {
            const scale = hitLevel * (0.7 + index * 0.15);
            bar.style.transform = "scaleY(" + scale.toFixed(2) + ")";
            bar.style.opacity = "1";
          });

          setTimeout(() => {
            padEl.classList.remove("active");
            bars.forEach((bar) => {
              bar.style.transform = "scaleY(0.2)";
              bar.style.opacity = "0.5";
            });
          }, 120);
        }

        function updateStatus(mode, options) {
          statusPill.dataset.mode = mode;
          if (mode === "idle") {
            statusMain.textContent = "Ready";
            statusSub.innerHTML = 'Hit <strong>Record</strong> and play a beat.';
          } else if (mode === "recording") {
            statusMain.textContent = "Recording";
            statusSub.innerHTML = "Every hit is captured to the timeline.";
          } else if (mode === "playing") {
            statusMain.textContent = "Playing Back";
            const duration =
              options && typeof options.duration === "number" ? options.duration : 0;
            const seconds = duration / 1000;
            statusSub.innerHTML =
              'Your groove is performing at <span>' +
              state.playbackSpeed.toFixed(2) +
              "×</span> for <strong>" +
              seconds.toFixed(2) +
              "s</strong>.";
          }
        }

        function updateTimelineMeta() {
          const count = state.recordedEvents.length;
          timelineCount.textContent = count;
          if (!count) {
            timelineEmpty.classList.remove("hidden");
            timelineProgress.style.transform = "scaleX(0)";
            return;
          }
          timelineEmpty.classList.add("hidden");
          const duration = state.recordedEvents[state.recordedEvents.length - 1].time;
          state.lastDuration = duration;
          timelineProgress.style.transform = "scaleX(1)";
        }

        function scheduleTimelineProgress(durationMs) {
          if (!durationMs || durationMs <= 0) {
            timelineProgress.style.transform = "scaleX(0)";
            return;
          }
          const start = performance.now();
          state.playbackStartTime = start;

          function step() {
            if (!state.isPlaying) {
              timelineProgress.style.transform = "scaleX(0)";
              return;
            }
            const elapsed = performance.now() - start;
            const progress = Math.min(1, elapsed / durationMs);
            timelineProgress.style.transform = "scaleX(" + progress.toFixed(3) + ")";
            if (elapsed < durationMs) {
              requestAnimationFrame(step);
            }
          }

          requestAnimationFrame(step);
        }

        function clearPlaybackTimeouts() {
          state.playbackTimeouts.forEach((id) => clearTimeout(id));
          state.playbackTimeouts = [];
        }

        function stopPlayback() {
          if (!state.isPlaying) return;
          clearPlaybackTimeouts();
          state.isPlaying = false;
          playBtn.classList.remove("btn-primary", "btn-toggle-on");
          playLabel.textContent = "Play";
          playBtn.setAttribute("aria-pressed", "false");
          recordBtn.disabled = false;
          updateStatus("idle");
          timelineProgress.style.transform = "scaleX(0)";
        }

        function startRecording() {
          if (state.isPlaying) {
            stopPlayback();
          }
          state.isRecording = true;
          state.recordStartTime = performance.now();
          state.recordedEvents = [];
          updateTimelineMeta();
          recordBtn.classList.add("btn-primary", "btn-toggle-on");
          recordBtn.setAttribute("aria-pressed", "true");
          recordLed.classList.add("blink");
          playBtn.disabled = true;
          clearBtn.disabled = true;
          updateStatus("recording");
        }

        function stopRecording() {
          state.isRecording = false;
          recordBtn.classList.remove("btn-primary", "btn-toggle-on");
          recordBtn.setAttribute("aria-pressed", "false");
          recordLed.classList.remove("blink");
          playBtn.disabled = state.recordedEvents.length === 0;
          clearBtn.disabled = state.recordedEvents.length === 0;
          if (state.recordedEvents.length > 0) {
            updateStatus("idle");
          } else {
            updateStatus("idle");
          }
          updateTimelineMeta();
        }

        function toggleRecording() {
          if (state.isPlaying) return;
          if (!state.isRecording) {
            startRecording();
          } else {
            stopRecording();
          }
        }

        function playRecording() {
          if (state.isRecording || state.isPlaying) return;
          if (!state.recordedEvents.length) return;

          const speed = state.playbackSpeed || 1;
          const adjustedDuration = (state.lastDuration || 0) / speed;
          if (!adjustedDuration || !isFinite(adjustedDuration)) return;

          state.isPlaying = true;
          playBtn.classList.add("btn-primary", "btn-toggle-on");
          playLabel.textContent = "Stop";
          playBtn.setAttribute("aria-pressed", "true");
          recordBtn.disabled = true;
          clearBtn.disabled = true;

          updateStatus("playing", { duration: adjustedDuration });
          scheduleTimelineProgress(adjustedDuration);

          const startTime = performance.now();
          const events = state.recordedEvents.slice();

          events.forEach((evt) => {
            const scheduled = evt.time / speed;
            const timeoutId = setTimeout(() => {
              if (!state.isPlaying) return;
              triggerPad(evt.sound, true, evt.velocity || 1);
            }, scheduled);
            state.playbackTimeouts.push(timeoutId);
          });

          const finalTimeout = setTimeout(() => {
            if (!state.isPlaying) return;
            stopPlayback();
          }, adjustedDuration + 80);
          state.playbackTimeouts.push(finalTimeout);
        }

        function clearRecording() {
          stopPlayback();
          state.recordedEvents = [];
          state.lastDuration = 0;
          playBtn.disabled = true;
          clearBtn.disabled = true;
          updateStatus("idle");
          updateTimelineMeta();
        }

        function recordHit(sound, velocity) {
          if (!state.isRecording) return;
          const now = performance.now();
          const time = now - state.recordStartTime;
          state.recordedEvents.push({ time, sound, velocity });
          updateTimelineMeta();
        }

        function triggerPad(soundId, fromPlayback, velocityScale) {
          const padEl = pads.find((el) => el.dataset.sound === soundId);
          if (!padEl) return;
          ensureAudioContext();
          const velocity = typeof velocityScale === "number" ? velocityScale : 1;
          playSound(soundId, velocity);
          animatePad(padEl);
          if (!fromPlayback) {
            recordHit(soundId, velocity);
          }
        }

        pads.forEach((padEl) => {
          padEl.addEventListener("pointerdown", (evt) => {
            evt.preventDefault();
            const soundId = padEl.dataset.sound;
            triggerPad(soundId, false, 1);
          });
          padEl.addEventListener("touchstart", (evt) => {
            evt.preventDefault();
            const soundId = padEl.dataset.sound;
            triggerPad(soundId, false, 1);
          });
        });

        const keyMap = {};
        pads.forEach((padEl) => {
          const key = padEl.dataset.key;
          if (key) {
            keyMap[key.toLowerCase()] = padEl.dataset.sound;
          }
        });

        let heldKeys = {};

        window.addEventListener("keydown", (evt) => {
          const key = evt.key.toLowerCase();
          if (!keyMap[key]) return;
          if (heldKeys[key]) return;
          heldKeys[key] = true;
          evt.preventDefault();
          triggerPad(keyMap[key], false, 1);
        });

        window.addEventListener("keyup", (evt) => {
          const key = evt.key.toLowerCase();
          if (heldKeys[key]) {
            delete heldKeys[key];
          }
        });

        recordBtn.addEventListener("click", () => {
          toggleRecording();
        });

        playBtn.addEventListener("click", () => {
          if (!state.recordedEvents.length) return;
          if (!state.isPlaying) {
            playRecording();
          } else {
            stopPlayback();
          }
        });

        clearBtn.addEventListener("click", () => {
          clearRecording();
        });

        tempoSlider.addEventListener("input", () => {
          const speed = parseFloat(tempoSlider.value) || 1;
          state.playbackSpeed = speed;
          tempoDisplay.textContent = speed.toFixed(2) + "×";
        });
        state.playbackSpeed = parseFloat(tempoSlider.value) || 1;
        tempoDisplay.textContent = state.playbackSpeed.toFixed(2) + "×";

        sensitivitySlider.addEventListener("input", () => {
          const raw = parseFloat(sensitivitySlider.value) || 1;
          state.baseVelocity = raw;
          let label = "Normal";
          if (raw < 0.8) label = "Soft";
          else if (raw > 1.2) label = "Punchy";
          else if (raw < 0.95) label = "Gentle";
          else if (raw > 1.05) label = "Tight";
          sensitivityDisplay.textContent = label;
        });
        sensitivitySlider.dispatchEvent(new Event("input"));

        playBtn.disabled = true;
        clearBtn.disabled = true;
        updateTimelineMeta();
        updateStatus("idle");
      })();
    </script>
  </body>
</html>

