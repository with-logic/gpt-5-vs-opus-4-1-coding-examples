<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Target Clicker Challenge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #f4f6fb;
        --accent: #2563eb;
        --accent-soft: rgba(37, 99, 235, 0.12);
        --accent-2: #ec4899;
        --accent-3: #22c55e;
        --danger: #ef4444;
        --text-main: #0f172a;
        --text-muted: #6b7280;
        --panel: rgba(255, 255, 255, 0.9);
        --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.18);
        --radius-xl: 1.5rem;
        --transition-fast: 160ms ease-out;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      html,
      body {
        padding: 0;
        margin: 0;
        height: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top left, #e0f2fe 0, #f4f6fb 45%, #fdf2ff 100%);
        color: var(--text-main);
        -webkit-font-smoothing: antialiased;
      }

      body {
        display: flex;
        align-items: stretch;
        justify-content: center;
        padding: 16px;
      }

      .app {
        position: relative;
        width: min(960px, 100%);
        height: min(620px, calc(100vh - 32px));
        border-radius: 32px;
        background:
          radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.16), transparent 55%),
          radial-gradient(circle at 80% 0%, rgba(236, 72, 153, 0.16), transparent 60%),
          radial-gradient(circle at 20% 100%, rgba(34, 197, 94, 0.16), transparent 55%),
          rgba(255, 255, 255, 0.9);
        overflow: hidden;
        box-shadow: var(--shadow-soft);
        backdrop-filter: blur(22px);
        border: 1px solid rgba(148, 163, 184, 0.35);
        display: flex;
        flex-direction: column;
      }

      .app::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.35), transparent 55%);
        mix-blend-mode: screen;
        pointer-events: none;
      }

      .header {
        position: relative;
        z-index: 2;
        padding: 18px 24px 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .brand-icon {
        width: 32px;
        height: 32px;
        border-radius: 20px;
        background:
          conic-gradient(from 180deg, #2563eb, #22c55e, #ec4899, #eab308, #2563eb);
        position: relative;
        box-shadow: 0 10px 28px rgba(37, 99, 235, 0.5);
        overflow: hidden;
      }

      .brand-icon-inner {
        position: absolute;
        inset: 4px;
        border-radius: 16px;
        background: radial-gradient(circle at 30% 30%, #ffffff, #dbeafe);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 16px;
        color: #1d4ed8;
      }

      .brand-text {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .brand-title {
        font-weight: 700;
        letter-spacing: 0.04em;
        font-size: 14px;
        text-transform: uppercase;
      }

      .brand-subtitle {
        font-size: 12px;
        color: var(--text-muted);
      }

      .meta-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px 6px 4px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.8);
        color: #e5e7eb;
        font-size: 11px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        box-shadow: 0 12px 35px rgba(15, 23, 42, 0.55);
      }

      .meta-dot {
        width: 18px;
        height: 18px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #fefce8, #f97316);
        position: relative;
        box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.4);
      }

      .meta-dot::after {
        content: "";
        position: absolute;
        inset: -4px;
        border-radius: inherit;
        border: 1px solid rgba(249, 115, 22, 0.55);
        opacity: 0.9;
      }

      .meta-pill span:last-child {
        opacity: 0.9;
      }

      .meta-pill span[data-key] {
        opacity: 0.6;
      }

      .layout {
        position: relative;
        z-index: 1;
        display: grid;
        grid-template-columns: minmax(0, 2.2fr) minmax(240px, 1.2fr);
        gap: 18px;
        padding: 6px 18px 18px;
        flex: 1;
        min-height: 0;
      }

      @media (max-width: 820px) {
        .app {
          height: auto;
        }
        .layout {
          grid-template-columns: minmax(0, 1fr);
          grid-template-rows: auto auto;
          padding: 4px 14px 16px;
        }
      }

      .arena-wrap {
        position: relative;
        border-radius: 26px;
        padding: 10px;
        background:
          linear-gradient(135deg, rgba(15, 23, 42, 0.1), transparent),
          radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.18), transparent 65%),
          radial-gradient(circle at 100% 100%, rgba(236, 72, 153, 0.16), transparent 60%),
          rgba(15, 23, 42, 0.03);
        box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.22);
        overflow: hidden;
        min-height: 0;
      }

      .arena {
        position: relative;
        border-radius: 20px;
        height: 100%;
        min-height: 260px;
        background:
          radial-gradient(circle at 20% 0, rgba(148, 163, 184, 0.45), transparent 60%),
          radial-gradient(circle at 80% 100%, rgba(15, 23, 42, 0.92), #020617);
        border: 1px solid rgba(15, 23, 42, 0.66);
        overflow: hidden;
        cursor: crosshair;
      }

      .arena::before,
      .arena::after {
        content: "";
        position: absolute;
        inset: -10%;
        background-image: radial-gradient(circle, rgba(148, 163, 184, 0.25) 0.5px, transparent 0.5px);
        background-size: 22px 22px;
        opacity: 0.24;
        pointer-events: none;
      }

      .arena::after {
        mix-blend-mode: soft-light;
        opacity: 0.18;
      }

      .arena-overlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
        background:
          radial-gradient(circle at 0 0, rgba(79, 70, 229, 0.4), transparent 55%),
          radial-gradient(circle at 100% 100%, rgba(239, 68, 68, 0.4), transparent 55%);
        mix-blend-mode: soft-light;
        opacity: 0.4;
      }

      .arena-inner {
        position: relative;
        inset: 0;
        padding: 2px;
        width: 100%;
        height: 100%;
      }

      .scan-line {
        position: absolute;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(190, 242, 100, 0.2) 10%,
          rgba(190, 242, 100, 0.95) 50%,
          rgba(190, 242, 100, 0.2) 90%,
          transparent 100%
        );
        mix-blend-mode: screen;
        opacity: 0;
        pointer-events: none;
      }

      .scan-line.active {
        animation: scan 2.8s linear infinite;
        opacity: 1;
      }

      @keyframes scan {
        0% {
          top: -5%;
        }
        100% {
          top: 105%;
        }
      }

      .hint {
        position: absolute;
        left: 14px;
        bottom: 12px;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        font-size: 11px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        opacity: 0.9;
      }

      .hint-key {
        padding: 3px 8px;
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: rgba(15, 23, 42, 0.85);
        font-size: 10px;
        letter-spacing: 0.08em;
      }

      .target {
        position: absolute;
        width: 70px;
        height: 70px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: crosshair;
        transform-origin: center;
        transition:
          transform 120ms ease-out,
          opacity 110ms ease-out;
      }

      .target-ring {
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: radial-gradient(circle at 30% 20%, #ffffff, #e5e7eb, #c7d2fe);
        box-shadow:
          0 0 0 2px rgba(15, 23, 42, 0.65),
          0 16px 26px rgba(15, 23, 42, 0.84);
      }

      .target-ring::before,
      .target-ring::after {
        content: "";
        position: absolute;
        border-radius: inherit;
        inset: 8px;
        border: 3px solid transparent;
      }

      .target-ring::before {
        border-top-color: #22c55e;
        border-left-color: #22c55e;
        border-right-color: #22c55e;
      }

      .target-ring::after {
        inset: 15px;
        border: 2px dashed rgba(34, 197, 94, 0.75);
      }

      .target-core {
        position: absolute;
        inset: 20px;
        border-radius: inherit;
        background:
          radial-gradient(circle at 30% 30%, #fef9c3, #22c55e),
          conic-gradient(from 180deg, #22c55e, #4ade80, #bef264, #22c55e);
        box-shadow:
          0 0 0 1px rgba(248, 250, 252, 0.6),
          0 0 22px rgba(22, 163, 74, 0.9);
      }

      .target-glow {
        position: absolute;
        inset: -12px;
        border-radius: inherit;
        background: radial-gradient(circle, rgba(190, 242, 100, 0.4), transparent 60%);
        filter: blur(3px);
        opacity: 0.55;
        mix-blend-mode: screen;
      }

      .target[data-variant="pink"] .target-core {
        background:
          radial-gradient(circle at 30% 30%, #fee2f2, #ec4899),
          conic-gradient(from 180deg, #ec4899, #f97316, #fbbf24, #ec4899);
        box-shadow:
          0 0 0 1px rgba(254, 249, 195, 0.6),
          0 0 22px rgba(236, 72, 153, 0.9);
      }

      .target[data-variant="blue"] .target-core {
        background:
          radial-gradient(circle at 30% 30%, #e0f2fe, #2563eb),
          conic-gradient(from 180deg, #2563eb, #22d3ee, #38bdf8, #2563eb);
        box-shadow:
          0 0 0 1px rgba(191, 219, 254, 0.8),
          0 0 22px rgba(37, 99, 235, 0.9);
      }

      .target-pulse {
        position: absolute;
        inset: 4px;
        border-radius: inherit;
        border: 1px solid rgba(190, 242, 100, 0.45);
        animation: pulse 1.4s ease-out infinite;
        mix-blend-mode: screen;
      }

      @keyframes pulse {
        0% {
          transform: scale(0.9);
          opacity: 0.8;
        }
        100% {
          transform: scale(1.25);
          opacity: 0;
        }
      }

      .target[data-state="spawning"] {
        animation: spawn 160ms cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
      }

      .target[data-state="despawning"] {
        animation: despawn 160ms ease-in forwards;
      }

      .target[data-state="hit"] {
        animation: hit 180ms ease-out forwards;
      }

      @keyframes spawn {
        from {
          transform: scale(0.15);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes despawn {
        from {
          transform: scale(1);
          opacity: 1;
        }
        to {
          transform: scale(0.6);
          opacity: 0;
        }
      }

      @keyframes hit {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        40% {
          transform: scale(1.18);
        }
        100% {
          transform: scale(0.4);
          opacity: 0;
        }
      }

      .crosshair {
        position: absolute;
        width: 32px;
        height: 32px;
        border-radius: 999px;
        border: 1px solid rgba(248, 250, 252, 0.7);
        box-shadow: 0 0 12px rgba(59, 130, 246, 0.7);
        pointer-events: none;
        transform: translate(-50%, -50%);
        opacity: 0;
        backdrop-filter: blur(3px);
      }

      .crosshair::before,
      .crosshair::after {
        content: "";
        position: absolute;
        background: rgba(248, 250, 252, 0.85);
      }

      .crosshair::before {
        left: 50%;
        top: 2px;
        bottom: 2px;
        width: 1px;
        transform: translateX(-50%);
      }

      .crosshair::after {
        top: 50%;
        left: 2px;
        right: 2px;
        height: 1px;
        transform: translateY(-50%);
      }

      .crosshair.active {
        opacity: 1;
      }

      .click-flash {
        position: absolute;
        width: 32px;
        height: 32px;
        border-radius: 999px;
        border: 2px solid rgba(251, 191, 36, 0.9);
        pointer-events: none;
        transform: translate(-50%, -50%);
        opacity: 0;
      }

      .click-flash[data-state="flash"] {
        animation: clickFlash 240ms ease-out forwards;
      }

      @keyframes clickFlash {
        from {
          transform: translate(-50%, -50%) scale(0.3);
          opacity: 0.85;
        }
        to {
          transform: translate(-50%, -50%) scale(1.35);
          opacity: 0;
        }
      }

      .sidebar {
        position: relative;
        border-radius: 24px;
        padding: 14px 16px 14px;
        background:
          linear-gradient(145deg, rgba(248, 250, 252, 0.9), rgba(241, 245, 249, 0.9)),
          radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.18), transparent 60%),
          radial-gradient(circle at 100% 100%, rgba(236, 72, 153, 0.18), transparent 60%);
        box-shadow:
          0 16px 30px rgba(148, 163, 184, 0.45),
          inset 0 0 0 1px rgba(226, 232, 240, 0.9);
        color: var(--text-main);
        overflow: hidden;
      }

      .sidebar::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.85),
          rgba(248, 250, 252, 0.1)
        );
        opacity: 0.6;
        pointer-events: none;
      }

      .sidebar-inner {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: 10px;
        height: 100%;
      }

      .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .panel-title-block {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .panel-title {
        font-weight: 700;
        font-size: 17px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .panel-subtitle {
        font-size: 12px;
        color: var(--text-muted);
      }

      .chip {
        padding: 4px 8px;
        border-radius: 999px;
        font-size: 10px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(37, 99, 235, 0.07);
        color: #1d4ed8;
        border: 1px solid rgba(129, 140, 248, 0.5);
      }

      .chip-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.25);
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
        margin-top: 6px;
      }

      .metric-card {
        border-radius: 16px;
        padding: 8px 10px 9px;
        background: rgba(255, 255, 255, 0.85);
        box-shadow:
          0 8px 20px rgba(148, 163, 184, 0.25),
          inset 0 0 0 1px rgba(226, 232, 240, 0.9);
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .metric-label {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
      }

      .metric-value-row {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 4px;
      }

      .metric-value {
        font-size: 20px;
        font-weight: 700;
      }

      .metric-unit {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
      }

      .metric-bar-wrap {
        position: relative;
        margin-top: 4px;
        width: 100%;
        height: 4px;
        border-radius: 999px;
        background: rgba(226, 232, 240, 0.95);
        overflow: hidden;
      }

      .metric-bar {
        position: absolute;
        inset: 0;
        width: 0%;
        border-radius: inherit;
        background: linear-gradient(90deg, #22c55e, #a3e635, #22c55e);
        box-shadow: 0 0 10px rgba(190, 242, 100, 0.8);
        transition: width 160ms ease-out;
      }

      .metric-bar--accent {
        background: linear-gradient(90deg, #2563eb, #22d3ee, #2563eb);
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.7);
      }

      .metric-small {
        font-size: 11px;
        color: var(--text-muted);
      }

      .metric-pill {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 6px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.05);
        font-size: 10px;
      }

      .controls {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-top: 10px;
      }

      .button-primary {
        position: relative;
        flex: 1;
        border: 0;
        border-radius: 999px;
        padding: 10px 14px;
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        cursor: pointer;
        color: #f9fafb;
        background-image: linear-gradient(135deg, #2563eb, #6366f1, #ec4899);
        box-shadow:
          0 14px 30px rgba(129, 140, 248, 0.7),
          0 0 0 1px rgba(191, 219, 254, 0.9);
        transition:
          transform 120ms ease-out,
          box-shadow 120ms ease-out,
          filter 120ms ease-out;
      }

      .button-primary span[data-label] {
        text-shadow: 0 1px 1px rgba(15, 23, 42, 0.4);
      }

      .button-primary:hover {
        transform: translateY(-1px) scale(1.01);
        filter: brightness(1.05);
        box-shadow:
          0 22px 38px rgba(129, 140, 248, 0.85),
          0 0 0 1px rgba(191, 219, 254, 1);
      }

      .button-primary:active {
        transform: translateY(0) scale(0.99);
        box-shadow:
          0 10px 20px rgba(129, 140, 248, 0.7),
          0 0 0 1px rgba(191, 219, 254, 1);
      }

      .button-primary:disabled {
        cursor: default;
        filter: grayscale(0.1) brightness(0.9);
        opacity: 0.9;
        box-shadow:
          0 6px 16px rgba(148, 163, 184, 0.35),
          0 0 0 1px rgba(209, 213, 219, 0.9);
      }

      .button-pill {
        padding: 7px 10px;
        border-radius: 999px;
        font-size: 11px;
        border: 0;
        background: rgba(15, 23, 42, 0.05);
        color: var(--text-muted);
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: default;
      }

      .kbd {
        padding: 2px 6px;
        border-radius: 6px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        background: rgba(248, 250, 252, 0.9);
        font-size: 10px;
      }

      .steps {
        margin-top: 10px;
        padding: 9px 10px 9px;
        border-radius: 16px;
        background: rgba(248, 250, 252, 0.9);
        box-shadow: inset 0 0 0 1px rgba(226, 232, 240, 0.9);
        font-size: 11px;
      }

      .steps-title {
        font-weight: 600;
        font-size: 11px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-bottom: 4px;
      }

      .steps ul {
        margin: 0;
        padding-left: 18px;
        display: grid;
        gap: 2px;
      }

      .steps li {
        color: var(--text-muted);
      }

      .steps li strong {
        color: var(--text-main);
        font-weight: 600;
      }

      .history-card {
        margin-top: 8px;
        padding: 8px 9px;
        border-radius: 16px;
        background: rgba(15, 23, 42, 0.94);
        color: #e5e7eb;
        font-size: 11px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        box-shadow:
          0 16px 30px rgba(15, 23, 42, 0.9),
          inset 0 0 0 1px rgba(148, 163, 184, 0.6);
      }

      .history-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .history-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        opacity: 0.75;
      }

      .history-pills {
        display: flex;
        gap: 6px;
        align-items: center;
        flex-wrap: wrap;
      }

      .history-pill {
        padding: 3px 7px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.9);
        font-size: 10px;
      }

      .history-body {
        display: grid;
        gap: 2px;
      }

      .history-row {
        display: flex;
        justify-content: space-between;
        gap: 6px;
      }

      .history-label {
        opacity: 0.75;
      }

      .history-value {
        font-weight: 500;
      }

      .toast {
        position: absolute;
        top: 16px;
        left: 50%;
        transform: translateX(-50%);
        padding: 7px 10px 7px;
        border-radius: 999px;
        font-size: 11px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: rgba(15, 23, 42, 0.88);
        color: #e5e7eb;
        opacity: 0;
        pointer-events: none;
        box-shadow: 0 14px 28px rgba(15, 23, 42, 0.85);
        transition: opacity 140ms ease-out, transform 140ms ease-out;
        z-index: 6;
      }

      .toast[data-visible="true"] {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      .toast[data-visible="false"] {
        transform: translateX(-50%) translateY(-8px);
      }

      .toast-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.4);
      }

      .toast[data-intent="warning"] .toast-dot {
        background: #f97316;
        box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.4);
      }

      .toast[data-intent="danger"] .toast-dot {
        background: #ef4444;
        box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.4);
      }

      .toast-kpi {
        font-weight: 600;
      }

      .timer-radial {
        position: relative;
        width: 46px;
        height: 46px;
        border-radius: 999px;
        flex-shrink: 0;
      }

      .timer-svg {
        transform: rotate(-90deg);
      }

      .timer-ring-bg {
        stroke: rgba(148, 163, 184, 0.5);
      }

      .timer-ring {
        stroke: url(#timerGradient);
        transition: stroke-dashoffset 80ms linear;
      }

      .timer-core {
        position: absolute;
        inset: 5px;
        border-radius: inherit;
        background: radial-gradient(circle at 30% 30%, #eff6ff, #dbeafe);
        box-shadow: 0 0 0 1px rgba(191, 219, 254, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 13px;
        color: #1d4ed8;
      }

      .timer-core small {
        font-size: 9px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #64748b;
      }

      .timer-build {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 2px;
        font-size: 11px;
        color: var(--text-muted);
      }

      .timer-build strong {
        font-weight: 600;
        color: var(--text-main);
      }

      .overlay-center {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
      }

      .overlay-card {
        position: relative;
        padding: 16px 20px;
        border-radius: 20px;
        background: linear-gradient(
          135deg,
          rgba(15, 23, 42, 0.98),
          rgba(15, 23, 42, 0.88)
        );
        color: #e5e7eb;
        box-shadow:
          0 22px 40px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(148, 163, 184, 0.6);
        max-width: 360px;
        width: min(340px, 88vw);
        text-align: center;
        transform: translateY(10px);
        opacity: 0;
        transition: opacity 160ms ease-out, transform 160ms ease-out;
        pointer-events: auto;
      }

      .overlay-card[data-visible="true"] {
        opacity: 1;
        transform: translateY(0);
      }

      .overlay-title {
        font-size: 18px;
        font-weight: 700;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        margin-bottom: 4px;
      }

      .overlay-subtitle {
        font-size: 12px;
        color: rgba(226, 232, 240, 0.8);
        margin-bottom: 12px;
      }

      .overlay-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 8px;
        margin: 10px 0 8px;
      }

      .overlay-metric {
        padding: 7px 8px;
        border-radius: 12px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.8);
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .overlay-metric-label {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        opacity: 0.75;
      }

      .overlay-metric-value {
        font-size: 16px;
        font-weight: 700;
      }

      .overlay-metric-unit {
        font-size: 10px;
        opacity: 0.75;
      }

      .overlay-highlight {
        margin-top: 6px;
        font-size: 11px;
        color: rgba(248, 250, 252, 0.9);
      }

      .overlay-highlight strong {
        color: #facc15;
      }

      .overlay-actions {
        margin-top: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .overlay-button {
        padding: 7px 12px;
        border-radius: 999px;
        border: 0;
        font-size: 11px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .overlay-button--primary {
        background: linear-gradient(135deg, #22c55e, #a3e635);
        color: #022c22;
        box-shadow:
          0 14px 26px rgba(34, 197, 94, 0.8),
          0 0 0 1px rgba(190, 242, 100, 0.9);
      }

      .overlay-button--ghost {
        background: transparent;
        border: 1px solid rgba(148, 163, 184, 0.8);
        color: #e5e7eb;
      }

      .overlay-rank-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(248, 250, 252, 0.2);
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin-bottom: 6px;
      }

      .overlay-rank-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: linear-gradient(135deg, #f97316, #facc15);
        box-shadow: 0 0 0 4px rgba(234, 179, 8, 0.4);
      }

      .overlay-blur {
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at center, rgba(15, 23, 42, 0.55), transparent 55%);
        pointer-events: none;
      }

      .overlay-blur[data-visible="false"] {
        opacity: 0;
        transition: opacity 160ms ease-out;
      }

      .overlay-blur[data-visible="true"] {
        opacity: 1;
      }

      .badge-row {
        display: flex;
        gap: 6px;
        margin-top: 4px;
        flex-wrap: wrap;
      }

      .badge {
        padding: 3px 7px;
        border-radius: 999px;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        background: rgba(15, 23, 42, 0.05);
        color: var(--text-muted);
      }

      .badge--hot {
        background: rgba(249, 115, 22, 0.08);
        color: #b45309;
        border: 1px solid rgba(248, 171, 82, 0.9);
      }

      .badge--pro {
        background: rgba(34, 197, 94, 0.08);
        color: #166534;
        border: 1px solid rgba(134, 239, 172, 0.9);
      }

      .fade-in {
        animation: fadeInUp 240ms ease-out forwards;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 600px) {
        .header {
          padding: 14px 16px 8px;
        }
        .brand-subtitle {
          display: none;
        }
        .meta-pill {
          display: none;
        }
        .panel-subtitle {
          display: none;
        }
        .layout {
          gap: 12px;
        }
        .controls {
          flex-direction: column;
          align-items: stretch;
        }
        .button-primary {
          width: 100%;
        }
        .button-pill {
          width: 100%;
          justify-content: center;
        }
        .overlay-card {
          padding: 14px 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app" id="app">
      <div class="header">
        <div class="brand">
          <div class="brand-icon">
            <div class="brand-icon-inner">TC</div>
          </div>
          <div class="brand-text">
            <div class="brand-title">Target Clicker</div>
            <div class="brand-subtitle">Precision aim in 20 seconds</div>
          </div>
        </div>
        <div class="meta-pill" id="metaPill">
          <div class="meta-dot"></div>
          <span data-key>Mode</span>
          <span id="metaModeLabel">Training Run</span>
        </div>
      </div>

      <div class="layout">
        <div class="arena-wrap">
          <div class="arena" id="arena">
            <div class="arena-overlay"></div>
            <div class="scan-line" id="scanLine"></div>
            <div class="arena-inner" id="arenaInner"></div>
            <div class="crosshair" id="crosshair"></div>
            <div class="click-flash" id="clickFlash"></div>
            <div class="hint">
              <span class="hint-key">20s</span>
              <span>Hit as many targets as you can.</span>
            </div>

            <div class="overlay-blur" id="overlayBlur" data-visible="false"></div>
            <div class="overlay-center">
              <div class="overlay-card" id="startOverlay" data-visible="true">
                <div class="overlay-title">Ready to Lock In?</div>
                <div class="overlay-subtitle">
                  Targets will spawn around the arena. Click them quickly and precisely before they vanish.
                </div>
                <div class="overlay-grid">
                  <div class="overlay-metric">
                    <div class="overlay-metric-label">Duration</div>
                    <div class="overlay-metric-value">20</div>
                    <div class="overlay-metric-unit">Seconds</div>
                  </div>
                  <div class="overlay-metric">
                    <div class="overlay-metric-label">Targets</div>
                    <div class="overlay-metric-value">&infin;</div>
                    <div class="overlay-metric-unit">Reactive</div>
                  </div>
                  <div class="overlay-metric">
                    <div class="overlay-metric-label">Focus</div>
                    <div class="overlay-metric-value">100%</div>
                    <div class="overlay-metric-unit">Required</div>
                  </div>
                </div>
                <div class="overlay-highlight">
                  Press <strong>Space</strong> or click <strong>Begin Run</strong> to start your 20 second challenge.
                </div>
                <div class="overlay-actions">
                  <button class="overlay-button overlay-button--primary" id="startButtonPrimary">
                    <span>Begin Run</span>
                  </button>
                  <button class="overlay-button overlay-button--ghost" id="startButtonGhost">
                    <span>Warm-Up Click</span>
                  </button>
                </div>
              </div>

              <div class="overlay-card" id="resultOverlay" data-visible="false">
                <div class="overlay-rank-pill">
                  <div class="overlay-rank-dot"></div>
                  <span id="resultRank">New Personal Best?</span>
                </div>
                <div class="overlay-title">Run Complete</div>
                <div class="overlay-subtitle" id="resultSummary">
                  Analysing your performance...
                </div>
                <div class="overlay-grid">
                  <div class="overlay-metric">
                    <div class="overlay-metric-label">Score</div>
                    <div class="overlay-metric-value" id="resultScore">0</div>
                    <div class="overlay-metric-unit">Hits</div>
                  </div>
                  <div class="overlay-metric">
                    <div class="overlay-metric-label">Accuracy</div>
                    <div class="overlay-metric-value" id="resultAccuracy">0%</div>
                    <div class="overlay-metric-unit">Precision</div>
                  </div>
                  <div class="overlay-metric">
                    <div class="overlay-metric-label">Rhythm</div>
                    <div class="overlay-metric-value" id="resultRhythm">0.00</div>
                    <div class="overlay-metric-unit">Targets/s</div>
                  </div>
                </div>
                <div class="overlay-highlight" id="resultHighlight">
                  Keep playing to calibrate your aim curve.
                </div>
                <div class="overlay-actions">
                  <button class="overlay-button overlay-button--primary" id="restartButton">
                    <span>Run Again</span>
                  </button>
                  <button class="overlay-button overlay-button--ghost" id="shareButton">
                    <span>Copy Summary</span>
                  </button>
                </div>
              </div>
            </div>

            <div class="toast" id="toast" data-visible="false" data-intent="success">
              <div class="toast-dot"></div>
              <span id="toastMessage"></span>
              <span class="toast-kpi" id="toastKpi"></span>
            </div>
          </div>
        </div>

        <aside class="sidebar">
          <div class="sidebar-inner">
            <header class="panel-header">
              <div class="panel-title-block">
                <div class="panel-title">Run Telemetry</div>
                <div class="panel-subtitle">
                  Real-time score and accuracy overlay.
                </div>
              </div>
              <div class="chip">
                <span class="chip-dot"></span>
                <span>Live</span>
              </div>
            </header>

            <div class="metrics-grid">
              <div class="metric-card">
                <div class="metric-label">Score</div>
                <div class="metric-value-row">
                  <div class="metric-value" id="scoreValue">0</div>
                  <div class="metric-unit">Hits</div>
                </div>
                <div class="metric-bar-wrap">
                  <div class="metric-bar metric-bar--accent" id="scoreBar"></div>
                </div>
                <div class="metric-small">
                  Streak: <span id="streakValue">0</span> • Max: <span id="maxStreakValue">0</span>
                </div>
              </div>

              <div class="metric-card">
                <div class="metric-label">Accuracy</div>
                <div class="metric-value-row">
                  <div class="metric-value" id="accuracyValue">0%</div>
                  <div class="metric-unit">Precision</div>
                </div>
                <div class="metric-bar-wrap">
                  <div class="metric-bar" id="accuracyBar"></div>
                </div>
                <div class="metric-small">
                  Hits: <span id="hitCountValue">0</span> • Misses: <span id="missCountValue">0</span>
                </div>
              </div>
            </div>

            <div class="controls">
              <button class="button-primary" id="startButton">
                <span data-label>Start 20s Run</span>
              </button>
              <button class="button-pill" id="modeToggle">
                <span>Mode</span>
                <span class="kbd">Space</span>
              </button>
            </div>

            <div class="steps">
              <div class="steps-title">How it works</div>
              <ul>
                <li><strong>Start</strong> a 20 second run.</li>
                <li><strong>Click</strong> each glowing target once.</li>
                <li><strong>Avoid</strong> spamming to keep accuracy high.</li>
                <li><strong>Review</strong> your end-of-run stats.</li>
              </ul>
            </div>

            <div class="history-card">
              <div class="history-header">
                <div class="history-title">Last Run Snapshot</div>
                <div class="history-pills">
                  <span class="history-pill" id="lastScorePill">Score: –</span>
                  <span class="history-pill" id="lastAccuracyPill">Accuracy: –</span>
                </div>
              </div>
              <div class="history-body">
                <div class="history-row">
                  <span class="history-label">Peak streak</span>
                  <span class="history-value" id="lastStreak">–</span>
                </div>
                <div class="history-row">
                  <span class="history-label">Total targets seen</span>
                  <span class="history-value" id="lastTargets">–</span>
                </div>
                <div class="history-row">
                  <span class="history-label">Mode</span>
                  <span class="history-value" id="lastMode">Training</span>
                </div>
              </div>
            </div>

            <div class="badge-row">
              <span class="badge badge--hot">Fast Reactions</span>
              <span class="badge badge--pro">Aim Trainer</span>
              <span class="badge">Click Targets • 20s</span>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <script>
      (function () {
        const GAME_DURATION = 20_000;
        const MIN_SPAWN_INTERVAL = 300;
        const MAX_SPAWN_INTERVAL = 650;
        const TARGET_LIFETIME = 900;

        const app = document.getElementById("app");
        const arena = document.getElementById("arena");
        const arenaInner = document.getElementById("arenaInner");
        const scanLine = document.getElementById("scanLine");
        const crosshair = document.getElementById("crosshair");
        const clickFlash = document.getElementById("clickFlash");

        const startOverlay = document.getElementById("startOverlay");
        const resultOverlay = document.getElementById("resultOverlay");
        const overlayBlur = document.getElementById("overlayBlur");

        const startButton = document.getElementById("startButton");
        const startButtonPrimary = document.getElementById("startButtonPrimary");
        const startButtonGhost = document.getElementById("startButtonGhost");
        const restartButton = document.getElementById("restartButton");
        const shareButton = document.getElementById("shareButton");
        const modeToggle = document.getElementById("modeToggle");
        const metaModeLabel = document.getElementById("metaModeLabel");

        const scoreValue = document.getElementById("scoreValue");
        const scoreBar = document.getElementById("scoreBar");
        const streakValue = document.getElementById("streakValue");
        const maxStreakValue = document.getElementById("maxStreakValue");
        const accuracyValue = document.getElementById("accuracyValue");
        const accuracyBar = document.getElementById("accuracyBar");
        const hitCountValue = document.getElementById("hitCountValue");
        const missCountValue = document.getElementById("missCountValue");

        const lastScorePill = document.getElementById("lastScorePill");
        const lastAccuracyPill = document.getElementById("lastAccuracyPill");
        const lastStreak = document.getElementById("lastStreak");
        const lastTargets = document.getElementById("lastTargets");
        const lastMode = document.getElementById("lastMode");

        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");
        const toastKpi = document.getElementById("toastKpi");

        const resultScore = document.getElementById("resultScore");
        const resultAccuracy = document.getElementById("resultAccuracy");
        const resultRhythm = document.getElementById("resultRhythm");
        const resultRank = document.getElementById("resultRank");
        const resultSummary = document.getElementById("resultSummary");
        const resultHighlight = document.getElementById("resultHighlight");

        const modeState = {
          index: 0,
          modes: [
            { id: "training", label: "Training Run", spawnMultiplier: 1 },
            { id: "challenge", label: "Challenge Mode", spawnMultiplier: 1.25 },
          ],
        };

        const gameState = {
          running: false,
          startTime: 0,
          timerHandle: null,
          spawnHandle: null,
          lastSpawnTime: 0,
          targetsSpawned: 0,
          targetsHit: 0,
          rawClicks: 0,
          misses: 0,
          streak: 0,
          maxStreak: 0,
          lastClickTime: 0,
          lastStats: null,
        };

        function createTimerRadial() {
          const timerRow = document.createElement("div");
          timerRow.style.display = "flex";
          timerRow.style.alignItems = "center";
          timerRow.style.justifyContent = "space-between";
          timerRow.style.gap = "10px";
          timerRow.style.marginTop = "6px";

          const timerRadial = document.createElement("div");
          timerRadial.className = "timer-radial";
          timerRadial.innerHTML = `
            <svg class="timer-svg" width="46" height="46" viewBox="0 0 46 46">
              <defs>
                <linearGradient id="timerGradient" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#22c55e"/>
                  <stop offset="50%" stop-color="#a3e635"/>
                  <stop offset="100%" stop-color="#22c55e"/>
                </linearGradient>
              </defs>
              <circle
                class="timer-ring-bg"
                cx="23" cy="23" r="18"
                fill="none"
                stroke-width="3"
              ></circle>
              <circle
                id="timerRing"
                class="timer-ring"
                cx="23" cy="23" r="18"
                fill="none"
                stroke-width="3.5"
                stroke-linecap="round"
                stroke-dasharray="${2 * Math.PI * 18}"
                stroke-dashoffset="0"
              ></circle>
            </svg>
            <div class="timer-core" id="timerCore">
              <span id="timerLabel">20</span>
            </div>
          `;

          const timerBuild = document.createElement("div");
          timerBuild.className = "timer-build";
          timerBuild.innerHTML = `
            <span><strong>20s burst</strong> • Reactive targets</span>
            <span><small>Space</small> to start, <small>Click</small> to score</span>
          `;

          timerRow.appendChild(timerRadial);
          timerRow.appendChild(timerBuild);

          const controls = document.querySelector(".controls");
          if (controls && controls.parentElement) {
            controls.parentElement.insertBefore(timerRow, controls);
          }
        }

        createTimerRadial();

        const timerRing = document.getElementById("timerRing");
        const timerCore = document.getElementById("timerCore");
        const timerLabel = document.getElementById("timerLabel");
        const circumference = 2 * Math.PI * 18;

        function setTimerProgress(remainingMs) {
          const ratio = Math.max(0, Math.min(1, remainingMs / GAME_DURATION));
          const offset = circumference * (1 - ratio);
          if (timerRing) {
            timerRing.style.strokeDashoffset = String(offset);
          }
          if (timerLabel) {
            const seconds = Math.ceil(remainingMs / 1000);
            timerLabel.textContent = String(seconds);
          }
          if (timerCore) {
            if (ratio < 0.25) {
              timerCore.style.background =
                "radial-gradient(circle at 30% 30%, #fee2e2, #fecaca)";
              timerCore.style.color = "#b91c1c";
            } else if (ratio < 0.6) {
              timerCore.style.background =
                "radial-gradient(circle at 30% 30%, #fef9c3, #fde68a)";
              timerCore.style.color = "#92400e";
            } else {
              timerCore.style.background =
                "radial-gradient(circle at 30% 30%, #eff6ff, #dbeafe)";
              timerCore.style.color = "#1d4ed8";
            }
          }
        }

        function resetTimerVisual() {
          if (timerRing) {
            timerRing.style.strokeDashoffset = "0";
          }
          if (timerLabel) timerLabel.textContent = "20";
          if (timerCore) {
            timerCore.style.background =
              "radial-gradient(circle at 30% 30%, #eff6ff, #dbeafe)";
            timerCore.style.color = "#1d4ed8";
          }
        }

        function resetStats() {
          gameState.targetsSpawned = 0;
          gameState.targetsHit = 0;
          gameState.rawClicks = 0;
          gameState.misses = 0;
          gameState.streak = 0;
          gameState.maxStreak = 0;
          gameState.lastClickTime = 0;
          updateStatsUI();
        }

        function updateStatsUI() {
          const hits = gameState.targetsHit;
          const clicks = gameState.rawClicks;
          const misses = gameState.misses;
          let accuracy = 0;
          if (clicks > 0) {
            accuracy = (hits / clicks) * 100;
          }
          const totalInteractions = hits + misses;
          scoreValue.textContent = String(hits);
          streakValue.textContent = String(gameState.streak);
          maxStreakValue.textContent = String(gameState.maxStreak);
          hitCountValue.textContent = String(hits);
          missCountValue.textContent = String(misses);
          accuracyValue.textContent = clicks === 0 ? "0%" : accuracy.toFixed(0) + "%";

          const scorePercent = Math.min(100, (hits / 25) * 100);
          scoreBar.style.width = scorePercent + "%";

          const accPercent = isNaN(accuracy) ? 0 : Math.min(100, accuracy);
          accuracyBar.style.width = accPercent + "%";

          if (accPercent >= 85) {
            accuracyBar.style.background =
              "linear-gradient(90deg, #22c55e, #a3e635, #22c55e)";
          } else if (accPercent >= 50) {
            accuracyBar.style.background =
              "linear-gradient(90deg, #f97316, #facc15, #f97316)";
          } else {
            accuracyBar.style.background =
              "linear-gradient(90deg, #ef4444, #f97316, #ef4444)";
          }
        }

        function setMode(indexDelta) {
          const total = modeState.modes.length;
          modeState.index = (modeState.index + indexDelta + total) % total;
          const mode = modeState.modes[modeState.index];
          metaModeLabel.textContent = mode.label;
          modeToggle.querySelector("span").textContent =
            mode.id === "training" ? "Training" : "Challenge";
          app.dataset.mode = mode.id;
        }

        setMode(0);

        function spawnTarget() {
          if (!gameState.running) return;

          const variantRoll = Math.random();
          let variant = "green";
          if (variantRoll > 0.66) variant = "pink";
          else if (variantRoll > 0.33) variant = "blue";

          const rect = arenaInner.getBoundingClientRect();
          const size = 70;
          const padding = 16;
          const maxLeft = rect.width - size - padding;
          const maxTop = rect.height - size - padding;
          if (maxLeft <= 0 || maxTop <= 0) return;
          const x = padding + Math.random() * maxLeft;
          const y = padding + Math.random() * maxTop;

          const target = document.createElement("button");
          target.type = "button";
          target.className = "target";
          target.setAttribute("data-state", "spawning");
          target.setAttribute("data-variant", variant);
          target.style.left = x + "px";
          target.style.top = y + "px";
          target.innerHTML = `
            <div class="target-glow"></div>
            <div class="target-ring"></div>
            <div class="target-core"></div>
            <div class="target-pulse"></div>
          `;

          const targetId = ++gameState.targetsSpawned;
          target.dataset.targetId = String(targetId);

          const lifetime = TARGET_LIFETIME;

          const despawnTimeout = window.setTimeout(() => {
            if (!target.isConnected) return;
            target.setAttribute("data-state", "despawning");
            setTimeout(() => {
              if (target.isConnected) {
                target.remove();
              }
            }, 160);
          }, lifetime);

          target.addEventListener("click", (event) => {
            event.stopPropagation();
            if (!gameState.running) return;
            if (target.dataset.hit === "true") return;
            target.dataset.hit = "true";
            window.clearTimeout(despawnTimeout);
            onTargetHit(target, event);
          });

          arenaInner.appendChild(target);
        }

        function onTargetHit(target, event) {
          gameState.targetsHit += 1;
          gameState.streak += 1;
          gameState.maxStreak = Math.max(gameState.maxStreak, gameState.streak);
          const now = performance.now();
          gameState.lastClickTime = now;

          target.setAttribute("data-state", "hit");
          setTimeout(() => {
            if (target.isConnected) target.remove();
          }, 180);

          updateStatsUI();
          showToast("Nice hit!", "+" + 1 + " score", "success");

          const strength = Math.min(1, gameState.streak / 8);
          const scale = 1 + strength * 0.03;
          app.style.transform = "scale(" + scale + ")";
          window.setTimeout(() => {
            app.style.transform = "";
          }, 80);
        }

        function onArenaClick(event) {
          if (!gameState.running) return;
          gameState.rawClicks += 1;
          const targetElement = event.target.closest(".target");
          if (!targetElement) {
            gameState.misses += 1;
            gameState.streak = 0;
            updateStatsUI();
            showToast("Missed target", "- accuracy", "warning");
          }
          renderClickFx(event);
        }

        function renderClickFx(event) {
          const rect = arena.getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;

          crosshair.style.left = x + "px";
          crosshair.style.top = y + "px";
          crosshair.classList.add("active");

          clickFlash.style.left = x + "px";
          clickFlash.style.top = y + "px";
          clickFlash.dataset.state = "flash";

          setTimeout(() => {
            crosshair.classList.remove("active");
            clickFlash.dataset.state = "";
          }, 210);
        }

        let toastTimeout = null;
        function showToast(message, kpiText, intent) {
          toastMessage.textContent = message;
          toastKpi.textContent = kpiText || "";
          toast.dataset.intent = intent || "success";
          toast.dataset.visible = "true";
          if (toastTimeout) window.clearTimeout(toastTimeout);
          toastTimeout = window.setTimeout(() => {
            toast.dataset.visible = "false";
          }, 1100);
        }

        function clearTargets() {
          const existing = arenaInner.querySelectorAll(".target");
          existing.forEach((t) => t.remove());
        }

        function scheduleNextSpawn() {
          if (!gameState.running) return;
          const baseInterval =
            MIN_SPAWN_INTERVAL +
            Math.random() * (MAX_SPAWN_INTERVAL - MIN_SPAWN_INTERVAL);
          const mode = modeState.modes[modeState.index];
          const adjusted = baseInterval / (mode.spawnMultiplier || 1);
          gameState.spawnHandle = window.setTimeout(() => {
            spawnTarget();
            scheduleNextSpawn();
          }, adjusted);
        }

        function startRun() {
          if (gameState.running) return;

          resetStats();
          clearTargets();
          crosshair.classList.remove("active");
          clickFlash.dataset.state = "";
          overlayBlur.dataset.visible = "false";
          startOverlay.dataset.visible = "false";
          resultOverlay.dataset.visible = "false";

          const mode = modeState.modes[modeState.index];
          showToast(
            mode.id === "training" ? "Training run started" : "Challenge mode engaged",
            "20s",
            "success"
          );

          scanLine.classList.add("active");
          gameState.running = true;
          gameState.startTime = performance.now();

          startButton.disabled = true;
          startButtonPrimary.disabled = true;
          startButtonGhost.disabled = true;
          restartButton.disabled = true;

          setTimerProgress(GAME_DURATION);
          scheduleNextSpawn();

          function tick() {
            if (!gameState.running) return;
            const now = performance.now();
            const elapsed = now - gameState.startTime;
            const remaining = GAME_DURATION - elapsed;
            if (remaining <= 0) {
              setTimerProgress(0);
              endRun();
              return;
            }
            setTimerProgress(remaining);
            gameState.timerHandle = window.requestAnimationFrame(tick);
          }

          gameState.timerHandle = window.requestAnimationFrame(tick);
        }

        function endRun() {
          if (!gameState.running) return;
          gameState.running = false;
          scanLine.classList.remove("active");

          if (gameState.spawnHandle) {
            window.clearTimeout(gameState.spawnHandle);
            gameState.spawnHandle = null;
          }
          if (gameState.timerHandle) {
            window.cancelAnimationFrame(gameState.timerHandle);
            gameState.timerHandle = null;
          }

          const elapsed = GAME_DURATION;
          const hits = gameState.targetsHit;
          const clicks = gameState.rawClicks || hits;
          const misses = gameState.misses;
          const totalTargets = gameState.targetsSpawned;
          const accuracy = clicks > 0 ? (hits / clicks) * 100 : 0;
          const targetsPerSecond = hits / (elapsed / 1000);
          const mode = modeState.modes[modeState.index];

          gameState.lastStats = {
            hits,
            accuracy,
            clicks,
            misses,
            targetsPerSecond,
            maxStreak: gameState.maxStreak,
            totalTargets,
            modeId: mode.id,
            modeLabel: mode.label,
          };

          lastScorePill.textContent = "Score: " + hits;
          lastAccuracyPill.textContent = "Accuracy: " + accuracy.toFixed(1) + "%";
          lastStreak.textContent = String(gameState.maxStreak);
          lastTargets.textContent = String(totalTargets || "–");
          lastMode.textContent = mode.id === "training" ? "Training" : "Challenge";

          resultScore.textContent = String(hits);
          resultAccuracy.textContent = accuracy.toFixed(1) + "%";
          resultRhythm.textContent = targetsPerSecond.toFixed(2);

          let rank = "Warming Up";
          let highlight =
            "Nice warm-up run. Focus on smooth, consistent clicks.";
          let summary;

          if (hits >= 30 && accuracy >= 90) {
            rank = "S-Tier Aim";
            highlight =
              "Elite performance. Your precision and rhythm are competition-ready.";
          } else if (hits >= 24 && accuracy >= 80) {
            rank = "Diamond";
            highlight =
              "Great control. Push for just a bit more consistency to reach the top tier.";
          } else if (hits >= 18 && accuracy >= 70) {
            rank = "Platinum";
            highlight =
              "Strong fundamentals. Try to prioritise precise shots over rapid clicking.";
          } else if (hits >= 12) {
            rank = "Gold";
            highlight =
              "Solid start. Track targets early and commit to clean clicks.";
          } else if (hits > 0) {
            rank = "Bronze";
            highlight =
              "Every run trains your eyes and hand together. Focus on calm, deliberate inputs.";
          }

          const accLabel =
            accuracy >= 90
              ? "hyper-accurate"
              : accuracy >= 80
              ? "accurate"
              : accuracy >= 65
              ? "balanced"
              : "aggressive";

          summary =
            "You landed " +
            hits +
            " hits in 20 seconds with " +
            accuracy.toFixed(1) +
            "% " +
            accLabel +
            " clicking.";

          resultRank.textContent = rank;
          resultSummary.textContent = summary;
          resultHighlight.innerHTML = highlight;

          overlayBlur.dataset.visible = "true";
          resultOverlay.dataset.visible = "true";

          startButton.disabled = false;
          startButtonPrimary.disabled = false;
          startButtonGhost.disabled = false;
          restartButton.disabled = false;

          showToast("Run complete", hits + " hits • " + accuracy.toFixed(0) + "%", "success");

          clearTargets();
          resetTimerVisual();
        }

        function shareSummary() {
          if (!navigator.clipboard || !gameState.lastStats) {
            showToast("Clipboard not available", "", "warning");
            return;
          }
          const stats = gameState.lastStats;
          const text =
            "Target Clicker — 20s Run\\n" +
            "Score: " +
            stats.hits +
            " hits\\n" +
            "Accuracy: " +
            stats.accuracy.toFixed(1) +
            "% (" +
            stats.hits +
            " / " +
            stats.clicks +
            ")\\n" +
            "Rhythm: " +
            stats.targetsPerSecond.toFixed(2) +
            " targets/s\\n" +
            "Streak: " +
            stats.maxStreak +
            " max\\n" +
            "Mode: " +
            stats.modeLabel;
          navigator.clipboard
            .writeText(text)
            .then(() => {
              showToast("Summary copied", "Share your run!", "success");
            })
            .catch(() => {
              showToast("Couldn't copy summary", "", "danger");
            });
        }

        function warmupClick() {
          showToast("Warm-up only", "Practice your click rhythm", "success");
        }

        arena.addEventListener("click", onArenaClick);

        startButton.addEventListener("click", () => {
          startRun();
        });
        startButtonPrimary.addEventListener("click", () => {
          startRun();
        });
        restartButton.addEventListener("click", () => {
          startRun();
        });
        startButtonGhost.addEventListener("click", () => {
          warmupClick();
        });

        shareButton.addEventListener("click", () => {
          shareSummary();
        });

        modeToggle.addEventListener("click", () => {
          setMode(1);
          showToast("Mode changed", metaModeLabel.textContent, "success");
        });

        document.addEventListener("keydown", (event) => {
          if (event.code === "Space") {
            event.preventDefault();
            if (gameState.running) return;
            if (resultOverlay.dataset.visible === "true") {
              resultOverlay.dataset.visible = "false";
              overlayBlur.dataset.visible = "false";
            }
            startRun();
          }
        });

        window.addEventListener("blur", () => {
          if (gameState.running) {
            endRun();
            showToast("Run paused (window blurred)", "", "warning");
          }
        });
      })();
    </script>
  </body>
</html>

