<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Weather Theatre • React + Canvas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
      }

      body {
        min-height: 100vh;
        display: flex;
        align-items: stretch;
        justify-content: center;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
          sans-serif;
        background:
          radial-gradient(circle at top, #182544 0, #050816 55%, #010208 100%);
        color: #f9fafb;
        -webkit-font-smoothing: antialiased;
      }

      #root {
        flex: 1;
        display: flex;
      }

      .app-shell {
        margin: 20px;
        margin-top: 22px;
        margin-bottom: 22px;
        flex: 1;
        max-width: 1240px;
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        background:
          radial-gradient(circle at top, rgba(15, 23, 42, 0.98) 0, #020617 60%);
        box-shadow:
          0 40px 120px rgba(15, 23, 42, 0.95),
          0 0 0 1px rgba(15, 23, 42, 0.8);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      }

      .app-shell::before {
        content: "";
        position: absolute;
        inset: -40%;
        opacity: 0.5;
        background:
          radial-gradient(circle at 10% -10%, rgba(59, 130, 246, 0.14), transparent 60%),
          radial-gradient(circle at 90% 110%, rgba(251, 191, 36, 0.16), transparent 65%),
          radial-gradient(circle at -10% 50%, rgba(236, 72, 153, 0.18), transparent 60%);
        filter: blur(2px);
        pointer-events: none;
        z-index: -1;
      }

      .app-header {
        padding: 16px 22px 10px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.35);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        position: relative;
        background:
          linear-gradient(
            to bottom,
            rgba(15, 23, 42, 0.96),
            rgba(15, 23, 42, 0.92)
          );
      }

      .brand-title {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .brand-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .brand-badge {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        padding: 4px 9px;
        border-radius: 999px;
        border: 1px solid rgba(251, 191, 36, 0.7);
        background:
          radial-gradient(circle at 30% 0, rgba(253, 224, 71, 0.25), transparent 60%),
          linear-gradient(to right, #92400e, #854d0e);
        color: #fefce8;
        box-shadow:
          0 0 16px rgba(250, 204, 21, 0.5),
          inset 0 0 0 1px rgba(250, 250, 250, 0.08);
      }

      .brand-heading {
        margin: 0;
        font-family: "Playfair Display", system-ui, -apple-system, serif;
        font-size: 24px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #f9fafb;
        text-shadow:
          0 0 16px rgba(15, 23, 42, 0.7),
          0 0 32px rgba(15, 23, 42, 0.8);
      }

      .brand-subtitle {
        font-size: 12px;
        max-width: 420px;
        color: rgba(226, 232, 240, 0.85);
      }

      .header-meta {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 4px;
        font-size: 11px;
        color: rgba(148, 163, 184, 0.95);
        text-align: right;
      }

      .meta-chips {
        display: inline-flex;
        gap: 6px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .chip {
        padding: 3px 9px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background:
          linear-gradient(
            to bottom right,
            rgba(15, 23, 42, 0.9),
            rgba(15, 23, 42, 0.6)
          );
        color: rgba(226, 232, 240, 0.9);
        display: inline-flex;
        align-items: center;
        gap: 4px;
        white-space: nowrap;
      }

      .chip-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #38bdf8 0, #0ea5e9 40%, #0369a1 100%);
        box-shadow:
          0 0 10px rgba(56, 189, 248, 0.9),
          0 0 18px rgba(14, 165, 233, 0.8);
      }

      .chip-pill {
        border-color: rgba(250, 204, 21, 0.55);
        background:
          linear-gradient(
            to bottom right,
            rgba(22, 163, 74, 0.2),
            rgba(251, 191, 36, 0.12)
          );
      }

      .app-main {
        flex: 1;
        display: flex;
        min-height: 0;
        padding: 14px 18px 18px;
        gap: 18px;
      }

      .stage-panel {
        flex: 1.15;
        min-width: 0;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .stage-wrapper {
        position: relative;
        flex: 1;
        min-height: 280px;
        border-radius: 20px;
        overflow: hidden;
        background:
          radial-gradient(circle at top, #020617 0, #020617 30%, #020617 100%);
        box-shadow:
          0 22px 60px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(15, 23, 42, 0.6);
        aspect-ratio: 16/9;
        isolation: isolate;
      }

      .stage-inner {
        position: absolute;
        inset: 0;
      }

      .stage-canvas {
        width: 100%;
        height: 100%;
        display: block;
      }

      .stage-frame-glow {
        position: absolute;
        inset: 0;
        pointer-events: none;
        border-radius: 20px;
        box-shadow:
          inset 0 0 0 1px rgba(15, 23, 42, 0.95),
          inset 0 0 0 2px rgba(15, 23, 42, 0.7),
          inset 0 0 30px rgba(15, 23, 42, 0.9);
      }

      .stage-frame-top-arch {
        position: absolute;
        left: -12px;
        right: -12px;
        top: -40px;
        height: 108px;
        background:
          radial-gradient(circle at 50% 120%, rgba(15, 23, 42, 0) 0, rgba(15, 23, 42, 0.95) 62%, #020617 100%),
          linear-gradient(
            to bottom,
            rgba(148, 163, 184, 0.2),
            rgba(15, 23, 42, 0.9)
          );
        opacity: 0.9;
        pointer-events: none;
      }

      .stage-header-rail {
        position: absolute;
        top: 14px;
        left: 24px;
        right: 24px;
        height: 6px;
        border-radius: 999px;
        background:
          linear-gradient(
            to right,
            rgba(15, 23, 42, 0.2),
            rgba(148, 163, 184, 0.5),
            rgba(15, 23, 42, 0.2)
          );
        box-shadow:
          0 0 18px rgba(148, 163, 184, 0.7),
          0 0 40px rgba(15, 23, 42, 0.9);
        opacity: 0.9;
      }

      .stage-lights-row {
        position: absolute;
        top: 14px;
        left: 52px;
        right: 52px;
        display: flex;
        justify-content: space-between;
        pointer-events: none;
      }

      .stage-light {
        width: 7px;
        height: 9px;
        border-radius: 999px;
        background:
          radial-gradient(circle at 50% 0, #facc15 0, #fbbf24 38%, #713f12 100%);
        box-shadow:
          0 0 7px rgba(251, 191, 36, 0.8),
          0 0 18px rgba(251, 191, 36, 0.5);
      }

      .subtitle-bar {
        position: absolute;
        left: 22px;
        right: 22px;
        bottom: 18px;
        padding: 10px 14px 9px;
        border-radius: 999px;
        backdrop-filter: blur(12px);
        background:
          linear-gradient(
            to right,
            rgba(15, 23, 42, 0.92),
            rgba(15, 23, 42, 0.86)
          );
        border: 1px solid rgba(148, 163, 184, 0.7);
        box-shadow:
          0 18px 40px rgba(15, 23, 42, 0.85),
          0 0 0 1px rgba(15, 23, 42, 0.8);
        display: flex;
        align-items: center;
        gap: 10px;
        pointer-events: none;
      }

      .subtitle-label {
        font-size: 11px;
        letter-spacing: 0.13em;
        text-transform: uppercase;
        opacity: 0.78;
        white-space: nowrap;
      }

      .subtitle-text {
        flex: 1;
        min-width: 0;
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: clip;
      }

      .subtitle-caret {
        display: inline-block;
        margin-left: 1px;
        font-size: 13px;
        opacity: 0.85;
      }

      .forecast-strip {
        position: absolute;
        top: 24px;
        left: 22px;
        padding: 8px 11px 8px;
        border-radius: 12px;
        background:
          linear-gradient(
            to bottom right,
            rgba(15, 23, 42, 0.88),
            rgba(15, 23, 42, 0.9)
          );
        border: 1px solid rgba(148, 163, 184, 0.5);
        box-shadow:
          0 18px 40px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(15, 23, 42, 0.8);
        font-size: 11px;
        display: flex;
        flex-direction: column;
        gap: 3px;
        max-width: 58%;
        backdrop-filter: blur(12px);
      }

      .forecast-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .forecast-title {
        font-size: 11px;
        letter-spacing: 0.17em;
        text-transform: uppercase;
        opacity: 0.88;
      }

      .forecast-pill {
        padding: 3px 8px;
        border-radius: 999px;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        border: 1px solid rgba(59, 130, 246, 0.7);
        background:
          linear-gradient(
            to right,
            rgba(37, 99, 235, 0.45),
            rgba(56, 189, 248, 0.25)
          );
        color: #e0f2fe;
      }

      .forecast-city {
        font-size: 13px;
        font-weight: 600;
        color: #e5e7eb;
      }

      .forecast-summary {
        font-size: 11px;
        color: rgba(209, 213, 219, 0.95);
      }

      .forecast-detail {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.13em;
        color: rgba(148, 163, 184, 0.95);
      }

      .forecast-dot {
        margin: 0 4px;
        opacity: 0.7;
      }

      .curtain {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 4;
      }

      .curtain-side {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 53%;
        background:
          radial-gradient(circle at 40% 0, #be123c 0, #7f1d1d 40%, #450a0a 90%),
          repeating-linear-gradient(
            -7deg,
            rgba(127, 29, 29, 0.95),
            rgba(127, 29, 29, 0.95) 8px,
            rgba(69, 10, 10, 0.98) 8px,
            rgba(69, 10, 10, 0.98) 16px
          );
        box-shadow:
          0 0 50px rgba(0, 0, 0, 0.95),
          0 0 120px rgba(15, 23, 42, 0.9);
      }

      .curtain-left {
        left: 0;
        transform-origin: left center;
        animation: curtain-open-left 1.35s cubic-bezier(0.16, 0.9, 0.23, 1) forwards;
      }

      .curtain-right {
        right: 0;
        transform-origin: right center;
        animation: curtain-open-right 1.35s cubic-bezier(0.16, 0.9, 0.23, 1) forwards;
      }

      .curtain-valance {
        position: absolute;
        left: -8%;
        right: -8%;
        top: -2px;
        height: 86px;
        background:
          radial-gradient(circle at 50% 110%, #450a0a 0, #0b0f1e 60%, #020617 80%),
          repeating-linear-gradient(
            -6deg,
            #b91c1c,
            #b91c1c 9px,
            #7f1d1d 9px,
            #7f1d1d 18px
          );
        transform-origin: top center;
        animation: curtain-valance-lift 1.2s cubic-bezier(0.34, 1.16, 0.36, 1)
          forwards 0.15s;
        box-shadow:
          0 24px 50px rgba(0, 0, 0, 0.9),
          0 0 18px rgba(127, 29, 29, 0.85);
      }

      @keyframes curtain-open-left {
        0% {
          transform: translateX(0);
        }
        10% {
          transform: translateX(-2%);
        }
        100% {
          transform: translateX(-102%);
        }
      }

      @keyframes curtain-open-right {
        0% {
          transform: translateX(0);
        }
        10% {
          transform: translateX(2%);
        }
        100% {
          transform: translateX(102%);
        }
      }

      @keyframes curtain-valance-lift {
        0% {
          transform: translateY(0);
        }
        100% {
          transform: translateY(-100%);
        }
      }

      .control-panel {
        flex: 0.9;
        min-width: 0;
        display: flex;
        flex-direction: column;
        gap: 14px;
        padding: 6px 4px 2px 8px;
        border-left: 1px solid rgba(31, 41, 55, 0.9);
        background:
          radial-gradient(circle at 10% 0, rgba(56, 189, 248, 0.09), transparent 55%),
          radial-gradient(circle at 80% 110%, rgba(251, 191, 36, 0.12), transparent 60%),
          linear-gradient(
            to right,
            rgba(15, 23, 42, 0.96),
            rgba(15, 23, 42, 0.97)
          );
      }

      .control-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding-right: 8px;
      }

      .control-title {
        font-size: 11px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        opacity: 0.85;
      }

      .control-caption {
        font-size: 11px;
        color: rgba(148, 163, 184, 0.98);
        max-width: 260px;
      }

      .time-toggle {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: stretch;
        border-radius: 999px;
        padding: 3px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background:
          linear-gradient(
            to right,
            rgba(15, 23, 42, 0.95),
            rgba(15, 23, 42, 0.9)
          );
        cursor: pointer;
        font-size: 11px;
        gap: 2px;
        min-width: 180px;
        overflow: hidden;
        box-shadow:
          0 12px 30px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(15, 23, 42, 0.7);
      }

      .time-toggle-pill {
        position: relative;
        flex: 1;
        text-align: center;
        padding: 6px 10px;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        z-index: 1;
        transition: color 0.24s ease;
        color: rgba(148, 163, 184, 0.9);
        white-space: nowrap;
      }

      .time-toggle-pill--active {
        color: #fef9c3;
      }

      .time-toggle-thumb {
        position: absolute;
        top: 3px;
        bottom: 3px;
        width: calc(50% - 3px);
        border-radius: 999px;
        background:
          radial-gradient(circle at 20% 0, #facc15 0, #f97316 40%, #92400e 100%);
        box-shadow:
          0 0 18px rgba(251, 191, 36, 0.85),
          0 12px 30px rgba(15, 23, 42, 0.95);
        transform: translateX(0);
        transition: transform 0.24s cubic-bezier(0.22, 0.61, 0.36, 1);
      }

      .time-toggle-thumb--night {
        transform: translateX(100%);
        background:
          radial-gradient(circle at 15% 15%, #e5e7eb 0, #a5b4fc 40%, #312e81 100%);
        box-shadow:
          0 0 18px rgba(129, 140, 248, 0.9),
          0 12px 30px rgba(15, 23, 42, 0.95);
      }

      .sliders-stack {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 6px 8px 8px;
        border-radius: 16px;
        border: 1px solid rgba(30, 64, 175, 0.9);
        background:
          radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.16), transparent 55%),
          radial-gradient(circle at 100% 130%, rgba(129, 140, 248, 0.18), transparent
                60%),
          linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.98),
            rgba(15, 23, 42, 0.96)
          );
        box-shadow:
          0 18px 40px rgba(15, 23, 42, 0.95),
          0 0 0 1px rgba(15, 23, 42, 0.9);
      }

      .slider-block {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .slider-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 6px;
        font-size: 11px;
      }

      .slider-label-row {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .slider-tag {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        color: rgba(148, 163, 184, 0.9);
      }

      .slider-chip {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.68);
        background:
          linear-gradient(
            to bottom right,
            rgba(15, 23, 42, 0.95),
            rgba(15, 23, 42, 0.8)
          );
        color: rgba(226, 232, 240, 0.95);
      }

      .slider-value {
        font-variant-numeric: tabular-nums;
        color: rgba(249, 250, 251, 0.96);
      }

      .slider-input {
        width: 100%;
        appearance: none;
        height: 6px;
        border-radius: 999px;
        background: linear-gradient(
          90deg,
          rgba(15, 23, 42, 0.9),
          rgba(15, 23, 42, 0.9)
        );
        outline: none;
      }

      .slider-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #f9fafb;
        border: 2px solid #0ea5e9;
        box-shadow:
          0 0 0 3px rgba(56, 189, 248, 0.15),
          0 12px 20px rgba(15, 23, 42, 0.9);
        cursor: pointer;
      }

      .slider-input::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #f9fafb;
        border: 2px solid #0ea5e9;
        box-shadow:
          0 0 0 3px rgba(56, 189, 248, 0.15),
          0 12px 20px rgba(15, 23, 42, 0.9);
        cursor: pointer;
      }

      .slider-input::-moz-range-track {
        height: 6px;
        border-radius: 999px;
        background: linear-gradient(
          90deg,
          rgba(15, 23, 42, 0.9),
          rgba(15, 23, 42, 0.9)
        );
      }

      .slider-caption {
        font-size: 10px;
        color: rgba(148, 163, 184, 0.98);
      }

      .slider-block--cosy .slider-input {
        background: linear-gradient(90deg, #f97316, #fb7185);
      }

      .slider-block--cosy .slider-input::-webkit-slider-thumb {
        border-color: #fb923c;
        box-shadow:
          0 0 0 3px rgba(251, 146, 60, 0.22),
          0 12px 20px rgba(15, 23, 42, 0.95);
      }

      .slider-block--cosy .slider-input::-moz-range-thumb {
        border-color: #fb923c;
        box-shadow:
          0 0 0 3px rgba(251, 146, 60, 0.22),
          0 12px 20px rgba(15, 23, 42, 0.95);
      }

      .slider-block--eerie .slider-input {
        background: linear-gradient(90deg, #22c55e, #22d3ee);
      }

      .slider-block--eerie .slider-input::-webkit-slider-thumb {
        border-color: #22c55e;
        box-shadow:
          0 0 0 3px rgba(34, 197, 94, 0.22),
          0 12px 20px rgba(15, 23, 42, 0.95);
      }

      .slider-block--eerie .slider-input::-moz-range-thumb {
        border-color: #22c55e;
        box-shadow:
          0 0 0 3px rgba(34, 197, 94, 0.22),
          0 12px 20px rgba(15, 23, 42, 0.95);
      }

      .slider-block--heroic .slider-input {
        background: linear-gradient(90deg, #facc15, #fb7185);
      }

      .slider-block--heroic .slider-input::-webkit-slider-thumb {
        border-color: #facc15;
        box-shadow:
          0 0 0 3px rgba(250, 204, 21, 0.22),
          0 12px 20px rgba(15, 23, 42, 0.95);
      }

      .slider-block--heroic .slider-input::-moz-range-thumb {
        border-color: #facc15;
        box-shadow:
          0 0 0 3px rgba(250, 204, 21, 0.22),
          0 12px 20px rgba(15, 23, 42, 0.95);
      }

      .scene-actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 2px 8px 0;
        gap: 8px;
      }

      .cue-button {
        flex-shrink: 0;
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid rgba(251, 191, 36, 0.8);
        background:
          radial-gradient(circle at 0 0, rgba(253, 224, 71, 0.4), transparent 58%),
          linear-gradient(135deg, #ca8a04, #f97316);
        color: #fefce8;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        cursor: pointer;
        box-shadow:
          0 16px 35px rgba(250, 204, 21, 0.5),
          0 0 0 1px rgba(15, 23, 42, 0.85);
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .cue-button-icon {
        width: 9px;
        height: 9px;
        border-radius: 999px;
        background:
          conic-gradient(
            from 160deg,
            #fcd34d,
            #f97316,
            #f97316,
            #facc15,
            #fde68a
          );
        box-shadow:
          0 0 8px rgba(252, 211, 77, 0.95),
          0 0 20px rgba(250, 204, 21, 0.6);
      }

      .cue-button-secondary {
        flex: 1;
        font-size: 10px;
        color: rgba(148, 163, 184, 0.98);
        text-align: right;
      }

      .mood-legend {
        margin-top: 2px;
        padding: 8px 8px 10px;
        border-radius: 14px;
        border: 1px solid rgba(51, 65, 85, 0.9);
        background:
          linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.98),
            rgba(15, 23, 42, 0.94)
          );
        display: flex;
        flex-direction: column;
        gap: 4px;
        font-size: 10px;
        color: rgba(148, 163, 184, 0.96);
      }

      .mood-bars {
        display: grid;
        grid-template-columns: 1fr;
        gap: 3px;
      }

      .mood-bars-row {
        display: grid;
        grid-template-columns: 68px 1fr;
        align-items: center;
        gap: 6px;
      }

      .mood-label {
        text-transform: uppercase;
        letter-spacing: 0.14em;
        font-size: 9px;
      }

      .mood-bar-track {
        position: relative;
        height: 4px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        overflow: hidden;
      }

      .mood-bar-fill {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        border-radius: inherit;
        transform-origin: left center;
        transform: scaleX(0.4);
      }

      .mood-bar-fill--cosy {
        background: linear-gradient(90deg, #f97316, #fb7185);
      }

      .mood-bar-fill--eerie {
        background: linear-gradient(90deg, #22c55e, #22d3ee);
      }

      .mood-bar-fill--heroic {
        background: linear-gradient(90deg, #facc15, #fb7185);
      }

      .app-footer {
        padding: 7px 20px 9px;
        border-top: 1px solid rgba(15, 23, 42, 0.95);
        font-size: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: rgba(148, 163, 184, 0.96);
        background:
          linear-gradient(
            to top,
            rgba(15, 23, 42, 0.96),
            rgba(15, 23, 42, 0.92)
          );
      }

      .footer-right {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .footer-dot {
        width: 5px;
        height: 5px;
        border-radius: 999px;
        background:
          radial-gradient(circle at 30% 0, #22d3ee 0, #0ea5e9 40%, #0369a1 100%);
        box-shadow:
          0 0 8px rgba(56, 189, 248, 0.9),
          0 0 14px rgba(56, 189, 248, 0.7);
      }

      .footer-label-strong {
        color: rgba(226, 232, 240, 0.96);
      }

      @media (max-width: 960px) {
        .app-main {
          flex-direction: column;
          padding: 12px 14px 14px;
        }

        .control-panel {
          border-left: none;
          border-top: 1px solid rgba(31, 41, 55, 0.9);
          padding: 10px 6px 6px;
        }

        .stage-panel {
          order: -1;
        }

        .forecast-strip {
          max-width: 68%;
        }

        .subtitle-bar {
          bottom: 14px;
        }
      }

      @media (max-width: 720px) {
        .app-shell {
          margin: 10px;
        }

        .app-header {
          padding: 12px 14px 8px;
          flex-direction: column;
          align-items: flex-start;
        }

        .header-meta {
          align-items: flex-start;
          text-align: left;
        }

        .brand-heading {
          font-size: 21px;
        }

        .stage-wrapper {
          min-height: 240px;
        }

        .forecast-strip {
          max-width: 78%;
        }
      }

      @media (max-width: 520px) {
        .subtitle-bar {
          left: 14px;
          right: 14px;
        }

        .forecast-strip {
          left: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script>
      (function () {
        const { useState, useEffect, useRef, useMemo } = React;
        const e = React.createElement;

        const MOCK_FORECAST = {
          city: "Harbourford",
          summary: "Soft rain drifting in from the west.",
          detail: "18°C • scattered showers • southerly breeze",
        };

        function clamp01(value) {
          if (value < 0) return 0;
          if (value > 1) return 1;
          return value;
        }

        function lerp(a, b, t) {
          return a + (b - a) * t;
        }

        function mixColor(c1, c2, t) {
          return [
            lerp(c1[0], c2[0], t),
            lerp(c1[1], c2[1], t),
            lerp(c1[2], c2[2], t),
          ];
        }

        function mixThree(c1, c2, c3, w1, w2, w3) {
          const sum = w1 + w2 + w3 || 1;
          const n1 = w1 / sum;
          const n2 = w2 / sum;
          const n3 = w3 / sum;
          return [
            c1[0] * n1 + c2[0] * n2 + c3[0] * n3,
            c1[1] * n1 + c2[1] * n2 + c3[1] * n3,
            c1[2] * n1 + c2[2] * n2 + c3[2] * n3,
          ];
        }

        function colorToRgba(c, alpha) {
          return (
            "rgba(" +
            Math.round(c[0]) +
            "," +
            Math.round(c[1]) +
            "," +
            Math.round(c[2]) +
            "," +
            alpha +
            ")"
          );
        }

        function buildSubtitle(cosy, eerie, heroic, timeMode) {
          const total = cosy + eerie + heroic || 1;
          const cosyN = cosy / total;
          const eerieN = eerie / total;
          const heroicN = heroic / total;

          let primary = "cosy";
          let primaryValue = cosyN;
          if (eerieN > primaryValue) {
            primary = "eerie";
            primaryValue = eerieN;
          }
          if (heroicN > primaryValue) {
            primary = "heroic";
            primaryValue = heroicN;
          }

          const timeWord = timeMode === "night" ? "Night" : "Matinée";

          let line;
          if (primary === "cosy") {
            if (timeMode === "night") {
              line =
                "Lantern-warm rain patters over harbour roofs and velvet waves.";
            } else {
              line =
                "A golden drizzle softens the harbour as umbrellas bloom in slow motion.";
            }
          } else if (primary === "eerie") {
            if (timeMode === "night") {
              line =
                "Fog swallows the pier lights; rain etches silver lines through the dark.";
            } else {
              line =
                "Milk-grey rain and drifting mist turn the bay into a whispered silhouette.";
            }
          } else {
            if (timeMode === "night") {
              line =
                "Searchlights carve through storm clouds as the harbour readies for its midnight overture.";
            } else {
              line =
                "Sunbreaks cut through the showers, spotlighting the harbour like a grand finale.";
            }
          }

          const moodString =
            "Cosy " +
            Math.round(cosy) +
            " • Eerie " +
            Math.round(eerie) +
            " • Heroic " +
            Math.round(heroic);

          return timeWord + " scene — " + line + " (" + moodString + ")";
        }

        const SKY_TOP_DAY = {
          cosy: [255, 232, 210],
          eerie: [210, 224, 244],
          heroic: [255, 234, 188],
        };
        const SKY_BOTTOM_DAY = {
          cosy: [173, 210, 255],
          eerie: [132, 165, 205],
          heroic: [251, 191, 119],
        };
        const SKY_TOP_NIGHT = {
          cosy: [39, 46, 89],
          eerie: [9, 18, 48],
          heroic: [40, 54, 110],
        };
        const SKY_BOTTOM_NIGHT = {
          cosy: [8, 12, 32],
          eerie: [3, 7, 20],
          heroic: [15, 23, 71],
        };

        function createSceneGeometry(width, height) {
          const horizonY = height * 0.6;
          const clouds = [];
          const cloudCount = Math.max(7, Math.round(width / 120));
          for (let i = 0; i < cloudCount; i++) {
            const depth = Math.random();
            clouds.push({
              x: Math.random() * width,
              y: Math.random() * horizonY * 0.7 + height * 0.04,
              radius: 22 + Math.random() * 36,
              depth: depth,
              wobbleOffset: Math.random() * Math.PI * 2,
            });
          }

          const raindrops = [];
          const dropCount = Math.round(130 + (width * height) / 6500);
          for (let i = 0; i < dropCount; i++) {
            raindrops.push({
              x: Math.random() * width,
              y: Math.random() * height,
              length: 10 + Math.random() * 18,
              speedScale: 0.25 + Math.random() * 0.9,
              windOffset: (Math.random() - 0.5) * 10,
            });
          }

          const stars = [];
          const starCount = Math.round(70 + width / 16);
          for (let i = 0; i < starCount; i++) {
            stars.push({
              x: Math.random() * width,
              y: Math.random() * horizonY * 0.55,
              radius: Math.random() * 1.4 + 0.5,
              phase: Math.random() * Math.PI * 2,
              twinkleScale: 0.35 + Math.random() * 0.9,
            });
          }

          const glowOrbs = [];
          const orbCount = 4;
          for (let i = 0; i < orbCount; i++) {
            const t = i / (orbCount - 1 || 1);
            glowOrbs.push({
              x: lerp(width * 0.14, width * 0.86, t),
              y: height * 0.9,
              radius: 26 + Math.random() * 10,
            });
          }

          return {
            width: width,
            height: height,
            horizonY: horizonY,
            clouds: clouds,
            raindrops: raindrops,
            stars: stars,
            glowOrbs: glowOrbs,
          };
        }

        function drawCloudShape(ctx, x, y, r, depth, softness) {
          const puff = r;
          const alpha = softness != null ? softness : 0.9;
          ctx.beginPath();
          ctx.arc(x - puff * 0.6, y, puff * 0.85, Math.PI * 0.5, Math.PI * 1.5);
          ctx.arc(x, y - puff * 0.7, puff, Math.PI, 0);
          ctx.arc(x + puff * 0.6, y, puff * 0.9, Math.PI * 1.5, Math.PI * 0.5);
          ctx.closePath();
          ctx.globalAlpha *= 0.9 + (1 - depth) * 0.2 * alpha;
          ctx.fill();
        }

        function drawHillsLayer(
          ctx,
          width,
          height,
          horizonY,
          color,
          amplitude,
          offsetX,
          detail
        ) {
          const segments = detail || 7;
          ctx.beginPath();
          ctx.moveTo(-20, height + 20);
          for (let i = 0; i <= segments; i++) {
            const t = i / segments;
            const x = lerp(-40, width + 40, t);
            const wave =
              Math.sin(t * Math.PI * 1.4 + offsetX * 0.003) * amplitude * 0.55 +
              Math.sin(t * Math.PI * 2.8 - offsetX * 0.0015) *
                amplitude *
                0.35;
            const y = horizonY + wave;
            ctx.lineTo(x, y);
          }
          ctx.lineTo(width + 40, height + 20);
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.fill();
        }

        function drawFrame(scene, dt, mood, pointer) {
          if (!scene || !scene.ctx || !scene.canvas) {
            return;
          }
          const ctx = scene.ctx;
          const canvas = scene.canvas;
          const width = scene.width;
          const height = scene.height;

          const cosy = clamp01(mood.cosy / 100);
          const eerie = clamp01(mood.eerie / 100);
          const heroic = clamp01(mood.heroic / 100);
          const sum = cosy + eerie + heroic || 1;
          const cosyN = cosy / sum;
          const eerieN = eerie / sum;
          const heroicN = heroic / sum;

          const nightFactor = mood.timeMode === "night" ? 1 : 0;

          const skyTopDay = mixThree(
            SKY_TOP_DAY.cosy,
            SKY_TOP_DAY.eerie,
            SKY_TOP_DAY.heroic,
            cosyN,
            eerieN,
            heroicN
          );
          const skyBottomDay = mixThree(
            SKY_BOTTOM_DAY.cosy,
            SKY_BOTTOM_DAY.eerie,
            SKY_BOTTOM_DAY.heroic,
            cosyN,
            eerieN,
            heroicN
          );
          const skyTopNight = mixThree(
            SKY_TOP_NIGHT.cosy,
            SKY_TOP_NIGHT.eerie,
            SKY_TOP_NIGHT.heroic,
            cosyN,
            eerieN,
            heroicN
          );
          const skyBottomNight = mixThree(
            SKY_BOTTOM_NIGHT.cosy,
            SKY_BOTTOM_NIGHT.eerie,
            SKY_BOTTOM_NIGHT.heroic,
            cosyN,
            eerieN,
            heroicN
          );

          const skyTop = mixColor(skyTopDay, skyTopNight, nightFactor);
          const skyBottom = mixColor(skyBottomDay, skyBottomNight, nightFactor);

          const gradient = ctx.createLinearGradient(0, 0, 0, height);
          gradient.addColorStop(0, colorToRgba(skyTop, 1));
          gradient.addColorStop(1, colorToRgba(skyBottom, 1));
          ctx.setTransform(1, 0, 0, 1, 0, 0);
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, width, height);

          const timeSec = scene.sceneElapsed || 0;

          const stars = scene.stars;
          if (stars && stars.length) {
            ctx.save();
            ctx.globalCompositeOperation = "screen";
            for (let i = 0; i < stars.length; i++) {
              const s = stars[i];
              const twinkle =
                0.35 +
                s.twinkleScale *
                  (0.4 + 0.6 * Math.max(0, Math.sin(timeSec * 2.8 + s.phase)));
              const alpha =
                nightFactor *
                (0.18 + 0.32 * heroicN + 0.25 * cosyN) *
                twinkle;
              if (alpha <= 0.02) continue;
              ctx.beginPath();
              ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
              ctx.fillStyle = "rgba(226, 232, 240," + alpha.toFixed(3) + ")";
              ctx.fill();
            }
            ctx.restore();
          }

          const horizonY = scene.horizonY;
          const pointerX = pointer ? pointer.x : 0.5;
          const parallaxStrength = 18 + heroicN * 10 + eerieN * 8;

          const backHillColor = colorToRgba(
            mixThree(
              [59, 130, 246],
              [30, 64, 175],
              [15, 23, 42],
              cosyN * 0.7,
              eerieN * 1.1,
              heroicN * 0.6
            ),
            0.96 - nightFactor * 0.2
          );
          const midHillColor = colorToRgba(
            mixThree(
              [37, 99, 235],
              [15, 23, 42],
              [30, 64, 175],
              cosyN * 1.0,
              eerieN * 0.7,
              heroicN * 1.2
            ),
            0.98
          );
          const frontHillColor = colorToRgba(
            mixThree(
              [30, 64, 175],
              [15, 23, 42],
              [71, 85, 105],
              cosyN * 0.8,
              eerieN * 0.7,
              heroicN * 1.3
            ),
            0.98
          );

          ctx.save();
          drawHillsLayer(
            ctx,
            width,
            height,
            horizonY - 18,
            backHillColor,
            32,
            -parallaxStrength * 0.6 * (pointerX - 0.5),
            7
          );
          drawHillsLayer(
            ctx,
            width,
            height,
            horizonY - 6,
            midHillColor,
            40,
            -parallaxStrength * 1.0 * (pointerX - 0.5),
            8
          );
          drawHillsLayer(
            ctx,
            width,
            height,
            horizonY + 8,
            frontHillColor,
            52,
            -parallaxStrength * 1.5 * (pointerX - 0.5),
            8
          );
          ctx.restore();

          const clouds = scene.clouds;
          if (clouds && clouds.length) {
            const baseCloudSpeed =
              10 + 16 * cosyN + 22 * eerieN + 10 * heroicN;
            const cloudDayColor = [250, 250, 255];
            const cloudNightColor = [191, 202, 228];
            const baseCloudColor = mixColor(
              cloudDayColor,
              cloudNightColor,
              nightFactor * (0.6 + 0.2 * eerieN)
            );
            ctx.save();
            ctx.globalCompositeOperation = "lighter";
            for (let i = 0; i < clouds.length; i++) {
              const c = clouds[i];
              const depth = 0.3 + 0.7 * c.depth;
              const speed =
                baseCloudSpeed *
                dt *
                (0.4 + 0.9 * (1 - depth)) *
                (nightFactor ? 0.9 : 1.1);
              c.x += speed;
              const maxRadius = c.radius * 3.1;
              if (c.x - maxRadius > width + 40) {
                c.x = -maxRadius - 10;
                c.y =
                  Math.random() * horizonY * 0.7 + height * (0.02 + 0.05 * c.depth);
              }
              const parallaxX =
                (pointerX - 0.5) * 30 * (1.2 - depth * 0.9) * (1 + heroicN * 0.6);
              const wobble =
                Math.sin(timeSec * 0.7 + c.wobbleOffset) * (2 + 5 * (1 - depth));
              const x = c.x + parallaxX;
              const y = c.y + wobble;
              ctx.globalAlpha = 0.5 + 0.4 * (1 - depth) * (1 - eerieN * 0.3);
              ctx.fillStyle = colorToRgba(baseCloudColor, 1);
              drawCloudShape(
                ctx,
                x,
                y,
                c.radius,
                depth,
                0.8 + cosyN * 0.2 - eerieN * 0.2
              );
            }
            ctx.restore();
          }

          const rainIntensityBase =
            0.2 + 0.55 * eerieN + 0.35 * cosyN + 0.1 * heroicN;
          const rainIntensity = clamp01(rainIntensityBase);
          if (rainIntensity > 0.06 && scene.raindrops && scene.raindrops.length) {
            const raindrops = scene.raindrops;
            const wind = -30 - 35 * heroicN + (pointerX - 0.5) * -90;
            const rainSpeed =
              260 +
              220 * eerieN +
              120 * heroicN +
              (nightFactor ? 40 : 0) +
              cosyN * -40;
            ctx.save();
            ctx.globalCompositeOperation = "screen";
            ctx.lineWidth = 1;
            const rainColor = mixColor(
              [191, 219, 254],
              [129, 140, 248],
              nightFactor * 0.7
            );
            ctx.strokeStyle = colorToRgba(
              rainColor,
              0.18 + rainIntensity * (0.28 + 0.2 * heroicN)
            );
            for (let i = 0; i < raindrops.length; i++) {
              const d = raindrops[i];
              d.y += rainSpeed * dt * (0.5 + d.speedScale);
              d.x +=
                wind * dt * (0.45 + 0.7 * d.speedScale) +
                d.windOffset * dt * 0.6;
              if (d.y - d.length > height || d.x < -40 || d.x > width + 40) {
                d.x = Math.random() * width;
                d.y = -20 - Math.random() * 80;
                d.length = 8 + Math.random() * 18;
              }
              const sway = d.windOffset * (0.25 + heroicN * 0.55);
              ctx.beginPath();
              ctx.moveTo(d.x + sway, d.y);
              ctx.lineTo(d.x + sway + 1.4, d.y + d.length);
              ctx.stroke();
            }
            ctx.restore();
          } else if (nightFactor > 0.2) {
            ctx.save();
            const hazeTop = horizonY * (0.2 + 0.25 * cosyN);
            const hazeGrad = ctx.createLinearGradient(
              0,
              hazeTop,
              0,
              horizonY + 30
            );
            hazeGrad.addColorStop(
              0,
              "rgba(15,23,42," + (0.0 + 0.06 * nightFactor) + ")"
            );
            hazeGrad.addColorStop(
              0.6,
              "rgba(15,23,42," + (0.16 + 0.2 * nightFactor * (0.4 + eerieN)) + ")"
            );
            hazeGrad.addColorStop(
              1,
              "rgba(15,23,42," + (0.32 + 0.18 * nightFactor) + ")"
            );
            ctx.fillStyle = hazeGrad;
            ctx.fillRect(-20, hazeTop, width + 40, horizonY + 50 - hazeTop);
            ctx.restore();
          }

          const stageTop = horizonY + 32;
          const stageBottom = height * 0.98;
          const floorGrad = ctx.createLinearGradient(
            0,
            stageTop,
            0,
            stageBottom
          );
          floorGrad.addColorStop(
            0,
            "rgba(24,16,10," + (0.8 + heroicN * 0.1) + ")"
          );
          floorGrad.addColorStop(
            0.52,
            "rgba(15,10,7," + (0.94 + heroicN * 0.05) + ")"
          );
          floorGrad.addColorStop(
            1,
            "rgba(0,0,0," + (0.98 + heroicN * 0.02) + ")"
          );
          ctx.fillStyle = floorGrad;
          ctx.fillRect(-20, stageTop, width + 40, stageBottom - stageTop + 40);

          ctx.save();
          ctx.globalAlpha = 0.15 + 0.2 * cosyN;
          ctx.strokeStyle = "rgba(148,115,88,0.7)";
          ctx.lineWidth = 1;
          const plankCount = 12;
          for (let i = 0; i <= plankCount; i++) {
            const t = i / plankCount;
            const y = lerp(stageTop + 4, stageBottom - 2, t);
            ctx.beginPath();
            ctx.moveTo(-10, y);
            ctx.lineTo(width + 10, y);
            ctx.stroke();
          }
          ctx.restore();

          if (scene.glowOrbs && scene.glowOrbs.length) {
            const glowIntensity =
              0.42 + 0.25 * heroicN + 0.18 * cosyN + 0.08 * nightFactor;
            ctx.save();
            ctx.globalCompositeOperation = "screen";
            for (let i = 0; i < scene.glowOrbs.length; i++) {
              const orb = scene.glowOrbs[i];
              const pulsing =
                0.9 + 0.2 * Math.sin(timeSec * 2.2 + i * 1.7 + heroicN * 3.0);
              const radius = orb.radius * (0.9 + heroicN * 0.2) * pulsing;
              const gradientOrb = ctx.createRadialGradient(
                orb.x,
                orb.y,
                0,
                orb.x,
                orb.y,
                radius
              );
              gradientOrb.addColorStop(
                0,
                "rgba(254,249,195," + (0.9 * glowIntensity) + ")"
              );
              gradientOrb.addColorStop(
                0.4,
                "rgba(253,224,171," + (0.6 * glowIntensity) + ")"
              );
              gradientOrb.addColorStop(
                1,
                "rgba(0,0,0," + (0.0 * glowIntensity) + ")"
              );
              ctx.fillStyle = gradientOrb;
              ctx.beginPath();
              ctx.arc(orb.x, orb.y, radius, 0, Math.PI * 2);
              ctx.fill();
            }
            ctx.restore();
          }

          ctx.save();
          ctx.globalAlpha = 0.6 + heroicN * 0.3 + cosyN * 0.1;
          const footlights = 7;
          for (let i = 0; i < footlights; i++) {
            const t = (i + 0.5) / footlights;
            const x =
              lerp(width * 0.12, width * 0.88, t) +
              (pointerX - 0.5) * 4 * (1 - Math.abs(t - 0.5) * 2.0);
            const y = stageTop - 4;
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, Math.PI * 2);
            ctx.fillStyle =
              "rgba(253,224,171," + (0.75 + 0.2 * heroicN) + ")";
            ctx.fill();
          }
          ctx.restore();

          const spotlightWarm = mixColor(
            [253, 224, 171],
            [252, 211, 77],
            0.4 + heroicN * 0.4
          );
          const spotlightCool = mixColor(
            [191, 219, 254],
            [129, 140, 248],
            0.7
          );
          const centerX = width * 0.5;
          const baseY = stageTop + 2;
          const sweepBase =
            timeSec *
            (0.45 + heroicN * 0.9 + (nightFactor ? 0.15 : 0.0));
          const heroBoost = 0.4 + 0.6 * heroicN;

          function drawBeam(angleCenter, widthAngle, color, strength) {
            const beamLength = height * (0.95 - 0.18 * cosyN);
            const a1 = angleCenter - widthAngle * 0.5;
            const a2 = angleCenter + widthAngle * 0.5;
            const p1x = centerX + Math.cos(a1) * beamLength;
            const p1y = baseY - Math.sin(a1) * beamLength;
            const p2x = centerX + Math.cos(a2) * beamLength;
            const p2y = baseY - Math.sin(a2) * beamLength;
            ctx.save();
            ctx.globalCompositeOperation = "screen";
            ctx.beginPath();
            ctx.moveTo(centerX - 4, baseY);
            ctx.lineTo(centerX + 4, baseY);
            ctx.lineTo(p2x, p2y);
            ctx.lineTo(p1x, p1y);
            ctx.closePath();
            const grad = ctx.createLinearGradient(
              centerX,
              baseY,
              centerX,
              baseY - beamLength
            );
            grad.addColorStop(
              0,
              colorToRgba(color, 0.08 + 0.12 * strength * heroBoost)
            );
            grad.addColorStop(
              0.25,
              colorToRgba(color, 0.18 + 0.18 * strength * heroBoost)
            );
            grad.addColorStop(
              0.9,
              colorToRgba(color, 0.0 + 0.02 * strength)
            );
            grad.addColorStop(1, "rgba(0,0,0,0)");
            ctx.fillStyle = grad;
            ctx.fill();
            ctx.restore();
          }

          const sway = (pointerX - 0.5) * 0.15;
          const leftAngle =
            -0.65 +
            Math.sin(sweepBase * 1.1 + 0.3) * (0.3 + 0.24 * heroicN) +
            sway;
          const rightAngle =
            -0.35 +
            Math.sin(sweepBase * 1.4 + Math.PI * 0.7) *
              (0.35 + 0.28 * heroicN) +
            sway * 0.5;
          const centerAngle =
            -0.48 +
            Math.sin(sweepBase * 1.7 + Math.PI * 0.2) *
              (0.25 + 0.22 * heroicN) +
            sway * 0.8;

          drawBeam(
            leftAngle,
            0.5 + 0.3 * heroicN,
            mixColor(spotlightWarm, spotlightCool, 0.1),
            0.8
          );
          drawBeam(
            rightAngle,
            0.5 + 0.32 * heroicN,
            mixColor(spotlightWarm, spotlightCool, 0.35),
            0.9
          );
          drawBeam(
            centerAngle,
            0.36 + 0.26 * heroicN,
            mixColor(spotlightWarm, spotlightCool, nightFactor * 0.5),
            1.0
          );
        }

        function WeatherStage(props) {
          const canvasRef = useRef(null);
          const animationRef = useRef(null);
          const sceneRef = useRef({
            ctx: null,
            canvas: null,
            width: 0,
            height: 0,
            horizonY: 0,
            clouds: [],
            raindrops: [],
            stars: [],
            glowOrbs: [],
            lastTime: 0,
            sceneStartTime: 0,
            sceneElapsed: 0,
          });
          const moodRef = useRef({
            cosy: props.cosy,
            eerie: props.eerie,
            heroic: props.heroic,
            timeMode: props.timeMode,
          });

          useEffect(
            function () {
              moodRef.current = {
                cosy: props.cosy,
                eerie: props.eerie,
                heroic: props.heroic,
                timeMode: props.timeMode,
              };
            },
            [props.cosy, props.eerie, props.heroic, props.timeMode]
          );

          useEffect(
            function () {
              const canvas = canvasRef.current;
              if (!canvas) return;
              const ctx = canvas.getContext("2d");
              const scene = sceneRef.current;
              scene.ctx = ctx;
              scene.canvas = canvas;

              function handleResize() {
                if (!scene.canvas || !scene.ctx) return;
                const rect = scene.canvas.getBoundingClientRect();
                const displayWidth = rect.width || scene.canvas.clientWidth || 1;
                const displayHeight =
                  rect.height || scene.canvas.clientHeight || 1;
                const dpr = window.devicePixelRatio || 1;
                scene.canvas.width = displayWidth * dpr;
                scene.canvas.height = displayHeight * dpr;
                scene.width = displayWidth;
                scene.height = displayHeight;
                scene.horizonY = displayHeight * 0.6;
                scene.ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
                const geometry = createSceneGeometry(displayWidth, displayHeight);
                scene.width = geometry.width;
                scene.height = geometry.height;
                scene.horizonY = geometry.horizonY;
                scene.clouds = geometry.clouds;
                scene.raindrops = geometry.raindrops;
                scene.stars = geometry.stars;
                scene.glowOrbs = geometry.glowOrbs;
              }

              handleResize();
              window.addEventListener("resize", handleResize);

              let running = true;
              function loop(timestamp) {
                if (!running) return;
                if (!scene.lastTime) {
                  scene.lastTime = timestamp;
                  scene.sceneStartTime = timestamp;
                }
                const dt = (timestamp - scene.lastTime) / 1000 || 0;
                scene.lastTime = timestamp;
                if (!scene.sceneStartTime) scene.sceneStartTime = timestamp;
                scene.sceneElapsed = (timestamp - scene.sceneStartTime) / 1000;
                const pointer =
                  (props.pointerRef && props.pointerRef.current) || {
                    x: 0.5,
                    y: 0.5,
                  };
                drawFrame(scene, dt, moodRef.current, pointer);
                animationRef.current = requestAnimationFrame(loop);
              }

              animationRef.current = requestAnimationFrame(loop);

              return function () {
                running = false;
                if (animationRef.current) {
                  cancelAnimationFrame(animationRef.current);
                }
                window.removeEventListener("resize", handleResize);
              };
            },
            [props.pointerRef]
          );

          useEffect(
            function () {
              const scene = sceneRef.current;
              scene.sceneStartTime = 0;
            },
            [props.sceneId]
          );

          return e(
            "div",
            { className: "stage-inner" },
            e("canvas", {
              ref: canvasRef,
              className: "stage-canvas",
            }),
            e("div", { className: "stage-frame-glow" }),
            e("div", { className: "stage-frame-top-arch" }),
            e("div", { className: "stage-header-rail" }),
            e(
              "div",
              { className: "stage-lights-row" },
              Array.from({ length: 6 }).map(function (_, idx) {
                return e("div", {
                  key: idx,
                  className: "stage-light",
                });
              })
            )
          );
        }

        function CurtainOverlay(props) {
          return e(
            "div",
            {
              className: "curtain",
            },
            e("div", { className: "curtain-side curtain-left" }),
            e("div", { className: "curtain-side curtain-right" }),
            e("div", { className: "curtain-valance" })
          );
        }

        function SceneSubtitle(props) {
          const [display, setDisplay] = useState("");
          const [cursorVisible, setCursorVisible] = useState(true);

          useEffect(
            function () {
              let index = 0;
              setDisplay("");
              const text = props.text || "";
              const maxChars = text.length;
              const delay = 26;
              let cancelled = false;
              function tick() {
                if (cancelled) return;
                index += 1;
                setDisplay(text.slice(0, index));
                if (index < maxChars) {
                  setTimeout(tick, delay);
                }
              }
              setTimeout(tick, 90);
              return function () {
                cancelled = true;
              };
            },
            [props.text, props.sceneId]
          );

          useEffect(function () {
            const id = setInterval(function () {
              setCursorVisible(function (v) {
                return !v;
              });
            }, 560);
            return function () {
              clearInterval(id);
            };
          }, []);

          return e(
            "div",
            { className: "subtitle-bar" },
            e("div", { className: "subtitle-label" }, "Scene"),
            e(
              "div",
              { className: "subtitle-text" },
              display,
              e(
                "span",
                {
                  className: "subtitle-caret",
                  style: { opacity: cursorVisible ? 1 : 0 },
                },
                "▌"
              )
            )
          );
        }

        function ForecastStrip(props) {
          const modeLabel = props.timeMode === "night" ? "Night" : "Matinée";
          const modeIcon = props.timeMode === "night" ? "◦" : "◎";
          return e(
            "div",
            { className: "forecast-strip" },
            e(
              "div",
              { className: "forecast-header" },
              e("div", { className: "forecast-title" }, "Mock forecast"),
              e(
                "div",
                { className: "forecast-pill" },
                modeIcon + " " + modeLabel + " show"
              )
            ),
            e("div", { className: "forecast-city" }, props.forecast.city),
            e("div", { className: "forecast-summary" }, props.forecast.summary),
            e(
              "div",
              { className: "forecast-detail" },
              props.forecast.detail,
              e("span", { className: "forecast-dot" }, "•"),
              "No live data"
            )
          );
        }

        function TimeToggle(props) {
          const isNight = props.timeMode === "night";
          return e(
            "button",
            {
              type: "button",
              className: "time-toggle",
              role: "switch",
              "aria-checked": isNight ? "true" : "false",
              "aria-label": "Toggle between Matinée and Night",
              onClick: props.onToggle,
            },
            e(
              "div",
              {
                className:
                  "time-toggle-pill" +
                  (isNight ? "" : " time-toggle-pill--active"),
              },
              "Matinée"
            ),
            e(
              "div",
              {
                className:
                  "time-toggle-pill" +
                  (isNight ? " time-toggle-pill--active" : ""),
              },
              "Night"
            ),
            e("div", {
              className:
                "time-toggle-thumb" +
                (isNight ? " time-toggle-thumb--night" : ""),
            })
          );
        }

        function MoodSlider(props) {
          return e(
            "div",
            {
              className:
                "slider-block slider-block--" +
                (props.variant || "").toLowerCase(),
            },
            e(
              "div",
              { className: "slider-header" },
              e(
                "div",
                { className: "slider-label-row" },
                e("div", { className: "slider-tag" }, props.label),
                props.chip
                  ? e("div", { className: "slider-chip" }, props.chip)
                  : null
              ),
              e(
                "div",
                { className: "slider-value" },
                Math.round(props.value)
              )
            ),
            e("input", {
              type: "range",
              min: 0,
              max: 100,
              value: props.value,
              onChange: function (event) {
                const next = Number(event.target.value || "0");
                props.onChange(next);
              },
              className: "slider-input",
            }),
            props.caption
              ? e("div", { className: "slider-caption" }, props.caption)
              : null
          );
        }

        function MoodLegend(props) {
          const cosyScale = clamp01(props.cosy / 100);
          const eerieScale = clamp01(props.eerie / 100);
          const heroicScale = clamp01(props.heroic / 100);
          return e(
            "div",
            { className: "mood-legend" },
            e(
              "div",
              null,
              "Remix this single forecast into new moods."
            ),
            e(
              "div",
              { className: "mood-bars" },
              e(
                "div",
                { className: "mood-bars-row" },
                e("div", { className: "mood-label" }, "Cosy"),
                e(
                  "div",
                  { className: "mood-bar-track" },
                  e("div", {
                    className: "mood-bar-fill mood-bar-fill--cosy",
                    style: {
                      transform: "scaleX(" + cosyScale.toFixed(3) + ")",
                    },
                  })
                )
              ),
              e(
                "div",
                { className: "mood-bars-row" },
                e("div", { className: "mood-label" }, "Eerie"),
                e(
                  "div",
                  { className: "mood-bar-track" },
                  e("div", {
                    className: "mood-bar-fill mood-bar-fill--eerie",
                    style: {
                      transform: "scaleX(" + eerieScale.toFixed(3) + ")",
                    },
                  })
                )
              ),
              e(
                "div",
                { className: "mood-bars-row" },
                e("div", { className: "mood-label" }, "Heroic"),
                e(
                  "div",
                  { className: "mood-bar-track" },
                  e("div", {
                    className: "mood-bar-fill mood-bar-fill--heroic",
                    style: {
                      transform: "scaleX(" + heroicScale.toFixed(3) + ")",
                    },
                  })
                )
              )
            )
          );
        }

        function App() {
          const [cosy, setCosy] = useState(72);
          const [eerie, setEerie] = useState(28);
          const [heroic, setHeroic] = useState(40);
          const [timeMode, setTimeMode] = useState("matinee");
          const [sceneId, setSceneId] = useState(0);
          const pointerRef = useRef({ x: 0.5, y: 0.5 });

          const subtitle = useMemo(
            function () {
              return buildSubtitle(cosy, eerie, heroic, timeMode);
            },
            [cosy, eerie, heroic, timeMode]
          );

          function handlePointerMove(event) {
            const rect = event.currentTarget.getBoundingClientRect();
            const clientX = event.clientX;
            const clientY = event.clientY;
            if (!rect.width || !rect.height) return;
            const px = clamp01((clientX - rect.left) / rect.width);
            const py = clamp01((clientY - rect.top) / rect.height);
            pointerRef.current.x = px;
            pointerRef.current.y = py;
          }

          function handleTouchMove(event) {
            if (!event.touches || !event.touches.length) return;
            const touch = event.touches[0];
            const rect = event.currentTarget.getBoundingClientRect();
            if (!rect.width || !rect.height) return;
            const px = clamp01((touch.clientX - rect.left) / rect.width);
            const py = clamp01((touch.clientY - rect.top) / rect.height);
            pointerRef.current.x = px;
            pointerRef.current.y = py;
          }

          function handlePointerLeave() {
            pointerRef.current.x = 0.5;
            pointerRef.current.y = 0.5;
          }

          function cueScene() {
            setSceneId(function (id) {
              return id + 1;
            });
          }

          function handleToggleTime() {
            setTimeMode(function (prev) {
              return prev === "night" ? "matinee" : "night";
            });
            cueScene();
          }

          return e(
            "div",
            { className: "app-shell" },
            e(
              "header",
              { className: "app-header" },
              e(
                "div",
                { className: "brand-title" },
                e(
                  "div",
                  { className: "brand-row" },
                  e("div", { className: "brand-badge" }, "Weather Theatre"),
                  e(
                    "h1",
                    { className: "brand-heading" },
                    "Stagecraft for Storms"
                  )
                ),
                e(
                  "div",
                  { className: "brand-subtitle" },
                  "Parallax skies, sweeping spotlights, and a single rainy forecast remixed into countless moods."
                )
              ),
              e(
                "div",
                { className: "header-meta" },
                e(
                  "div",
                  { className: "meta-chips" },
                  e(
                    "div",
                    { className: "chip" },
                    e("span", { className: "chip-dot" }),
                    "React + Canvas live set"
                  ),
                  e(
                    "div",
                    { className: "chip chip-pill" },
                    "Matinée / Night toggle"
                  )
                ),
                e(
                  "div",
                  null,
                  "Mock forecast: ",
                  MOCK_FORECAST.city,
                  " • ",
                  MOCK_FORECAST.summary
                )
              )
            ),
            e(
              "main",
              { className: "app-main" },
              e(
                "section",
                { className: "stage-panel" },
                e(
                  "div",
                  {
                    className: "stage-wrapper",
                    onMouseMove: handlePointerMove,
                    onMouseLeave: handlePointerLeave,
                    onTouchMove: handleTouchMove,
                    onTouchEnd: handlePointerLeave,
                  },
                  e(WeatherStage, {
                    cosy: cosy,
                    eerie: eerie,
                    heroic: heroic,
                    timeMode: timeMode,
                    pointerRef: pointerRef,
                    sceneId: sceneId,
                  }),
                  e(ForecastStrip, {
                    forecast: MOCK_FORECAST,
                    timeMode: timeMode,
                  }),
                  e(SceneSubtitle, {
                    text: subtitle,
                    sceneId: sceneId,
                  }),
                  e(CurtainOverlay, { key: sceneId })
                )
              ),
              e(
                "aside",
                { className: "control-panel" },
                e(
                  "div",
                  { className: "control-header" },
                  e("div", { className: "control-title" }, "Scene controls"),
                  e(
                    "div",
                    { className: "control-caption" },
                    "Dial in cosy, eerie, and heroic notes, then cue a reveal."
                  )
                ),
                e(TimeToggle, {
                  timeMode: timeMode,
                  onToggle: handleToggleTime,
                }),
                e(
                  "div",
                  { className: "sliders-stack" },
                  e(MoodSlider, {
                    label: "Cosy",
                    value: cosy,
                    onChange: function (v) {
                      setCosy(v);
                    },
                    chip: "lamps • window glow",
                    caption: "Warms the palette and softens the rain.",
                    variant: "cosy",
                  }),
                  e(MoodSlider, {
                    label: "Eerie",
                    value: eerie,
                    onChange: function (v) {
                      setEerie(v);
                    },
                    chip: "fog • silhouettes",
                    caption: "Thickens the fog and sharpens the shadows.",
                    variant: "eerie",
                  }),
                  e(MoodSlider, {
                    label: "Heroic",
                    value: heroic,
                    onChange: function (v) {
                      setHeroic(v);
                    },
                    chip: "spotlight • fanfare",
                    caption: "Cranks up searchlights and dramatic contrast.",
                    variant: "heroic",
                  })
                ),
                e(
                  "div",
                  { className: "scene-actions" },
                  e(
                    "button",
                    {
                      type: "button",
                      className: "cue-button",
                      onClick: cueScene,
                    },
                    e("span", { className: "cue-button-icon" }),
                    "Cue new scene"
                  ),
                  e(
                    "div",
                    { className: "cue-button-secondary" },
                    "Curtains sweep aside on each cue."
                  )
                ),
                e(MoodLegend, {
                  cosy: cosy,
                  eerie: eerie,
                  heroic: heroic,
                })
              )
            ),
            e(
              "footer",
              { className: "app-footer" },
              e(
                "div",
                null,
                "Weather Theatre runs entirely on a mock forecast — no external APIs."
              ),
              e(
                "div",
                { className: "footer-right" },
                e("div", { className: "footer-dot" }),
                e(
                  "div",
                  { className: "footer-label-strong" },
                  "Matinée"
                ),
                e("span", null, " / "),
                e(
                  "div",
                  { className: "footer-label-strong" },
                  "Night"
                ),
                e("span", null, " remixes")
              )
            )
          );
        }

        const rootElement = document.getElementById("root");
        if (rootElement) {
          const root = ReactDOM.createRoot(rootElement);
          root.render(e(App));
        }
      })();
    </script>
  </body>
</html>

