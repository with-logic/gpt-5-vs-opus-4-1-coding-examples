<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Theatre</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1a1a1a;
            color: #f5f5f5;
            font-family: 'Playfair Display', serif;
        }

        .theatre-font {
            font-family: 'Playfair Display', serif;
        }

        .typewriter-font {
            font-family: 'Special Elite', cursive;
        }

        canvas {
            display: block;
        }

        .curtain {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #4a0404, #800000, #4a0404);
            z-index: 50;
            transition: transform 1.5s cubic-bezier(0.77, 0, 0.175, 1);
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5);
        }

        .curtain-left, .curtain-right {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            background: 
                linear-gradient(90deg, rgba(0,0,0,0.3) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.3) 100%),
                repeating-linear-gradient(
                    90deg,
                    #600 0px,
                    #700 20px,
                    #800 40px,
                    #700 60px,
                    #600 80px
                );
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            z-index: 100;
            transition: transform 1.8s cubic-bezier(0.645, 0.045, 0.355, 1);
        }

        .curtain-left { left: 0; border-right: 4px solid #d4af37; }
        .curtain-right { right: 0; border-left: 4px solid #d4af37; }

        .curtain-open .curtain-left { transform: translateX(-95%); }
        .curtain-open .curtain-right { transform: translateX(95%); }

        .gold-fringe {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: repeating-linear-gradient(
                90deg,
                #d4af37 0px,
                #f1d592 5px,
                #d4af37 10px
            );
            border-top: 2px solid #b8860b;
        }

        .stage-floor {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 12vh;
            background: linear-gradient(to bottom, #1a110a, #000);
            z-index: 40;
            border-top: 4px solid #2c1e14;
        }

        .stage-floor::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 100%;
            background: radial-gradient(ellipse at center bottom, rgba(212, 175, 55, 0.1) 0%, transparent 70%);
        }

        input[type=range] {
            -webkit-appearance: none;
            background: rgba(255,255,255,0.1);
            height: 4px;
            border-radius: 2px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px; width: 16px;
            border-radius: 50%;
            background: #d4af37;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            border: 2px solid #fff;
        }

        .theatre-label {
            font-size: 0.65rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: #d4af37;
            margin-bottom: 0.5rem;
        }

        .spotlight-beam {
            position: absolute;
            top: -20%;
            left: 50%;
            width: 40vw;
            height: 150vh;
            background: radial-gradient(ellipse at top, rgba(255,255,255,0.15) 0%, transparent 60%);
            transform-origin: top center;
            mix-blend-mode: screen;
            pointer-events: none;
            z-index: 35;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SCENES = {
            cosy: {
                bg: [255, 209, 148],
                sky: [255, 154, 158],
                forecast: "A gentle warmth embraces the valley. Golden rays dance through the leaves, whispering of a quiet afternoon. Stay soft, stay warm."
            },
            eerie: {
                bg: [15, 12, 41],
                sky: [48, 43, 99],
                forecast: "The wind carries secrets from the hollow. Shadows stretch long across the jagged peaks, and the fog swallows the path ahead. Tread lightly."
            },
            heroic: {
                bg: [75, 108, 183],
                sky: [24, 40, 72],
                forecast: "Thunder rolls across the horizon! A mighty gale tests the resolve of the mountains. The sky crackles with ancient power. Stand firm!"
            }
        };

        const Typewriter = ({ text }) => {
            const [display, setDisplay] = useState('');
            useEffect(() => {
                let i = 0;
                setDisplay('');
                const timer = setInterval(() => {
                    if (i < text.length) {
                        setDisplay(prev => prev + text.charAt(i));
                        i++;
                    } else clearInterval(timer);
                }, 40)
                return () => clearInterval(timer);
            }, [text]);
            return <span className="typewriter-font italic leading-relaxed">{display}</span>;
        };

        const App = () => {
            const canvasRef = useRef(null);
            const [isOpen, setIsOpen] = useState(false);
            const [isNight, setIsNight] = useState(false);
            const [values, setValues] = useState({ cosy: 60, eerie: 20, heroic: 20 });
            const [dominant, setDominant] = useState('cosy');

            useEffect(() => {
                const max = Object.entries(values).reduce((a, b) => b[1] > a[1] ? b : a);
                setDominant(max[0]);
            }, [values]);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let frame;

                const draw = (t) => {
                    const w = canvas.width = window.innerWidth;
                    const h = canvas.height = window.innerHeight;
                    const time = t * 0.001;

                    // Weights
                    const total = values.cosy + values.eerie + values.heroic || 1;
                    const weights = { 
                        cosy: values.cosy/total, 
                        eerie: values.eerie/total, 
                        heroic: values.heroic/total 
                    };

                    // Sky
                    const lerp = (c1, c2, c3, ws) => c1.map((v, i) => v*ws.cosy + c2[i]*ws.eerie + c3[i]*ws.heroic);
                    const skyColor = lerp(SCENES.cosy.sky, SCENES.eerie.sky, SCENES.heroic.sky, weights);
                    const bgColor = lerp(SCENES.cosy.bg, SCENES.eerie.bg, SCENES.heroic.bg, weights);
                    
                    const grad = ctx.createLinearGradient(0,0,0,h);
                    const nightFactor = isNight ? 0.2 : 1.0;
                    grad.addColorStop(0, `rgb(${skyColor[0]*nightFactor}, ${skyColor[1]*nightFactor}, ${skyColor[2]*nightFactor})`);
                    grad.addColorStop(1, `rgb(${bgColor[0]*nightFactor}, ${bgColor[1]*nightFactor}, ${bgColor[2]*nightFactor})`);
                    ctx.fillStyle = grad;
                    ctx.fillRect(0,0,w,h);

                    // Sun/Moon
                    ctx.save();
                    const orbX = w * 0.8;
                    const orbY = h * 0.2;
                    ctx.shadowBlur = 40;
                    ctx.shadowColor = isNight ? '#fff' : '#ffd';
                    ctx.fillStyle = isNight ? '#eee' : '#fff9c4';
                    ctx.beginPath();
                    ctx.arc(orbX, orbY, 40, 0, Math.PI*2);
                    ctx.fill();
                    ctx.restore();

                    // Parallax Layers
                    const drawMountain = (offsetY, speed, color, amplitude, freq, roughness) => {
                        ctx.save();
                        ctx.translate(Math.sin(time * 0.1) * speed * 20, 0);
                        ctx.beginPath();
                        ctx.moveTo(0, h);
                        for(let x=0; x<=w; x+=5) {
                            let y = offsetY;
                            y += Math.sin(x * freq + time * speed) * amplitude;
                            y += Math.sin(x * 0.02) * roughness;
                            ctx.lineTo(x, y);
                        }
                        ctx.lineTo(w, h);
                        ctx.fillStyle = color;
                        ctx.fill();
                        ctx.restore();
                    };

                    const baseNight = isNight ? 0.3 : 1;
                    
                    // Back
                    drawMountain(h*0.6, 0.1, `rgba(40,40,60,${0.4*baseNight})`, 40, 0.002, 20);
                    // Props
                    const drawProp = (x, y, scale, type, color) => {
                        ctx.save();
                        ctx.translate(x, y);
                        ctx.scale(scale, scale);
                        ctx.fillStyle = color;
                        if(type === 'tree') {
                            ctx.beginPath();
                            ctx.moveTo(0, 0);
                            ctx.lineTo(-20, 40);
                            ctx.lineTo(20, 40);
                            ctx.fill();
                            ctx.beginPath();
                            ctx.moveTo(0, -20);
                            ctx.lineTo(-15, 10);
                            ctx.lineTo(15, 10);
                            ctx.fill();
                        } else if(type === 'building') {
                            ctx.fillRect(-20, 0, 40, 60);
                            ctx.fillStyle = 'rgba(255,255,255,0.2)';
                            ctx.fillRect(-10, 10, 8, 8);
                            ctx.fillRect(2, 10, 8, 8);
                        }
                        ctx.restore();
                    };

                    // Draw back props
                    for(let i=0; i<5; i++) {
                        const px = (i * 0.25 * w + time * 20) % (w + 100) - 50;
                        drawProp(px, h*0.7, 1, 'tree', `rgba(10,30,10,${0.3*baseNight})`);
                    }

                    // Mid
                    drawMountain(h*0.75, 0.2, `rgba(20,20,30,${0.7*baseNight})`, 30, 0.005, 40);
                    
                    // Draw mid props
                    for(let i=0; i<3; i++) {
                        const px = (i * 0.4 * w + time * 40) % (w + 100) - 50;
                        const pType = weights.eerie > 0.4 ? 'building' : 'tree';
                        drawProp(px, h*0.82, 1.5, pType, `rgba(15,15,25,${0.8*baseNight})`);
                    }

                    // Weather FX
                    if (weights.heroic > 0.2) {
                        ctx.strokeStyle = `rgba(200,220,255,${weights.heroic * 0.5})`;
                        ctx.lineWidth = 1.5;
                        for(let i=0; i<80; i++) {
                            const rx = (i*137.5) % w;
                            const ry = (i*224.7 + time*1500) % h;
                            ctx.beginPath(); ctx.moveTo(rx, ry); ctx.lineTo(rx-15, ry+30); ctx.stroke();
                        }
                        // Lightning
                        if (Math.random() > 0.98) {
                            ctx.fillStyle = `rgba(255,255,255,${weights.heroic * 0.8})`;
                            ctx.fillRect(0,0,w,h);
                        }
                    }
                    
                    if (weights.cosy > 0.3) {
                        for(let i=0; i<20; i++) {
                            ctx.fillStyle = `rgba(255,255,200,${weights.cosy * 0.4})`;
                            const px = (Math.sin(i + time*0.5)*0.5+0.5)*w;
                            const py = (Math.cos(i*0.7 + time*0.3)*0.5+0.5)*h;
                            ctx.beginPath(); ctx.arc(px, py, 2, 0, Math.PI*2); ctx.fill();
                        }
                    }

                    // Front
                    drawMountain(h*0.9, 0.4, `rgba(10,10,15,${1*baseNight})`, 20, 0.01, 10);

                    frame = requestAnimationFrame(draw);
                };
                frame = requestAnimationFrame(draw);
                return () => cancelAnimationFrame(frame);
            }, [values, isNight]);

            return (
                <div className={`relative w-full h-screen bg-black transition-all duration-1000 ${isOpen ? 'curtain-open' : ''}`}>
                    {/* Curtains */}
                    <div className="curtain-left flex flex-col justify-end">
                        <div className="gold-fringe"></div>
                    </div>
                    <div className="curtain-right flex flex-col justify-end">
                        <div className="gold-fringe"></div>
                    </div>

                    {!isOpen && (
                        <div className="absolute inset-0 z-[110] flex flex-col items-center justify-center bg-black/40">
                            <h1 className="theatre-font text-7xl font-bold text-[#d4af37] mb-8 tracking-tighter drop-shadow-[0_5px_15px_rgba(0,0,0,0.5)]">WEATHER THEATRE</h1>
                            <button 
                                onClick={() => setIsOpen(true)}
                                className="px-12 py-4 border-2 border-[#d4af37] text-[#d4af37] hover:bg-[#d4af37] hover:text-black transition-all duration-500 rounded-full uppercase tracking-widest text-sm font-bold bg-transparent"
                            >
                                Raise the Curtain
                            </button>
                        </div>
                    )}

                    {/* Spotlight */}
                    <div className="spotlight-beam" style={{ 
                        animation: 'sweep 8s ease-in-out infinite',
                        left: '30%',
                        transformOrigin: 'top center'
                    }}></div>

                    <canvas ref={canvasRef} className="absolute inset-0 w-full h-full" />
                    
                    <div className="stage-floor"></div>

                    {/* UI */}
                    <div className="absolute bottom-12 left-1/2 -translate-x-1/2 w-full max-w-5xl px-8 z-50">
                        <div className="flex flex-col gap-6">
                            {/* Subtitle */}
                            <div className="bg-black/80 backdrop-blur-md border border-[#d4af37]/30 p-8 rounded-xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] min-h-[140px] flex items-center justify-center">
                                <p className="text-[#f1d592] text-2xl text-center">
                                    {isOpen && <Typewriter text={SCENES[dominant].forecast} />}
                                </p>
                            </div>

                            {/* Controls */}
                            <div className="bg-neutral-900/90 backdrop-blur-md border border-[#d4af37]/20 p-6 rounded-2xl flex flex-wrap items-center justify-between gap-8 shadow-2xl">
                                <div className="flex gap-12 flex-1 justify-center">
                                    {['cosy', 'eerie', 'heroic'].map(type => (
                                        <div key={type} className="flex flex-col items-center">
                                            <span className="theatre-label">{type}</span>
                                            <input 
                                                type="range" min="0" max="100" 
                                                value={values[type]} 
                                                onChange={e => setValues({...values, [type]: parseInt(e.target.value)})}
                                                className="w-32"
                                            />
                                        </div>
                                    ))}
                                </div>
                                <div className="flex items-center gap-6 border-l border-white/10 pl-8">
                                    <button 
                                        onClick={() => setIsNight(!isNight)}
                                        className={`w-40 py-2 rounded-full border border-[#d4af37]/50 text-xs uppercase tracking-widest transition-all duration-300 ${isNight ? 'bg-[#d4af37] text-black font-bold' : 'text-[#d4af37]'}`}
                                    >
                                        {isNight ? '★ Night' : '☼ Matinée'}
                                    </button>
                                    <button 
                                        onClick={() => setIsOpen(false)}
                                        className="text-[#d4af37]/60 hover:text-[#d4af37] transition-colors"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <style>{`
                        @keyframes sweep {
                            0%, 100% { transform: rotate(-25deg); opacity: 0.2; }
                            50% { transform: rotate(25deg); opacity: 0.5; }
                        }
                    `}</style>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

    </script>
</body>
</html>
