<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Practice Drills</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            user-select: none;
            color: #1e293b;
        }
        .mono {
            font-family: 'JetBrains Mono', monospace;
        }
        .shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .pulse-green {
            animation: pulse-green 0.5s ease-out;
        }
        @keyframes pulse-green {
            0% { background-color: transparent; }
            50% { background-color: #f0fdf4; }
            100% { background-color: transparent; }
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const DIFFICULTIES = {
            EASY: { label: 'Easy', range: [1, 10], ops: ['+', '-'] },
            MEDIUM: { label: 'Medium', range: [1, 20], ops: ['+', '-', '*'] },
            HARD: { label: 'Hard', range: [1, 50], ops: ['+', '-', '*', '/'] },
            INSANE: { label: 'Insane', range: [10, 100], ops: ['+', '-', '*', '/'] }
        };

        const DURATIONS = [30, 60, 120];

        const App = () => {
            const [gameState, setGameState] = useState('START'); // START, PLAYING, FINISHED
            const [difficulty, setDifficulty] = useState('MEDIUM');
            const [duration, setDuration] = useState(60);
            const [score, setScore] = useState({ correct: 0, total: 0 });
            const [timeLeft, setTimeLeft] = useState(60);
            const [problem, setProblem] = useState(null);
            const [userInput, setUserInput] = useState('');
            const [feedback, setFeedback] = useState(null); // 'correct', 'wrong'
            const [history, setHistory] = useState([]);
            const [highScores, setHighScores] = useState([]);

            const inputRef = useRef(null);

            // Load high scores
            useEffect(() => {
                const saved = localStorage.getItem('math_drills_scores');
                if (saved) setHighScores(JSON.parse(saved));
            }, []);

            // Timer logic
            useEffect(() => {
                let timer;
                if (gameState === 'PLAYING' && timeLeft > 0) {
                    timer = setInterval(() => {
                        setTimeLeft(prev => {
                            if (prev <= 1) {
                                endGame();
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(timer);
            }, [gameState, timeLeft]);

            const generateProblem = () => {
                const config = DIFFICULTIES[difficulty];
                const op = config.ops[Math.floor(Math.random() * config.ops.length)];
                let a, b, ans;

                switch (op) {
                    case '+':
                        a = Math.floor(Math.random() * (config.range[1] - config.range[0] + 1)) + config.range[0];
                        b = Math.floor(Math.random() * (config.range[1] - config.range[0] + 1)) + config.range[0];
                        ans = a + b;
                        break;
                    case '-':
                        a = Math.floor(Math.random() * (config.range[1] - config.range[0] + 1)) + config.range[0];
                        b = Math.floor(Math.random() * a) + 1; // Ensure positive result
                        ans = a - b;
                        break;
                    case '*':
                        const multRange = difficulty === 'EASY' ? [1, 5] : (difficulty === 'MEDIUM' ? [1, 12] : [2, 15]);
                        a = Math.floor(Math.random() * (multRange[1] - multRange[0] + 1)) + multRange[0];
                        b = Math.floor(Math.random() * (multRange[1] - multRange[0] + 1)) + multRange[0];
                        ans = a * b;
                        break;
                    case '/':
                        const divRange = difficulty === 'HARD' ? [1, 12] : [2, 15];
                        b = Math.floor(Math.random() * (divRange[1] - divRange[0] + 1)) + divRange[0];
                        ans = Math.floor(Math.random() * (divRange[1] - divRange[0] + 1)) + divRange[0];
                        a = ans * b;
                        break;
                }

                setProblem({ a, b, op, ans });
                setUserInput('');
            };

            const startGame = () => {
                setScore({ correct: 0, total: 0 });
                setTimeLeft(duration);
                setHistory([]);
                setGameState('PLAYING');
                generateProblem();
                setTimeout(() => inputRef.current?.focus(), 100);
            };

            const endGame = () => {
                setGameState('FINISHED');
                const newScore = {
                    date: new Date().toLocaleDateString(),
                    score: score.correct,
                    difficulty,
                    duration,
                    accuracy: Math.round((score.correct / (score.total || 1)) * 100)
                };
                const updated = [newScore, ...highScores].slice(0, 10);
                setHighScores(updated);
                localStorage.setItem('math_drills_scores', JSON.stringify(updated));
            };

            const handleInput = (e) => {
                const val = e.target.value;
                if (/^-?\d*$/.test(val)) {
                    setUserInput(val);
                }
            };

            const checkAnswer = (e) => {
                e.preventDefault();
                if (!userInput) return;

                const isCorrect = parseInt(userInput) === problem.ans;
                setScore(prev => ({
                    correct: prev.correct + (isCorrect ? 1 : 0),
                    total: prev.total + 1
                }));

                setHistory(prev => [{
                    ...problem,
                    userAns: userInput,
                    isCorrect
                }, ...prev]);

                if (isCorrect) {
                    setFeedback('correct');
                    setTimeout(() => setFeedback(null), 300);
                    generateProblem();
                } else {
                    setFeedback('wrong');
                    setTimeout(() => setFeedback(null), 400);
                    setUserInput('');
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    <div className="w-full max-w-xl bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
                        
                        {gameState === 'START' && (
                            <div className="p-8 text-center">
                                <h1 className="text-4xl font-extrabold text-slate-800 mb-2">Math Practice</h1>
                                <p className="text-slate-500 mb-8 text-lg">Sharpen your mind with quick drills.</p>
                                
                                <div className="space-y-6 text-left">
                                    <div>
                                        <label className="block text-sm font-semibold text-slate-600 mb-2 uppercase tracking-wider">Difficulty</label>
                                        <div className="grid grid-cols-2 gap-2">
                                            {Object.keys(DIFFICULTIES).map(key => (
                                                <button
                                                    key={key}
                                                    onClick={() => setDifficulty(key)}
                                                    className={`py-3 px-4 rounded-xl font-bold transition-all ${
                                                        difficulty === key 
                                                        ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 scale-[1.02]' 
                                                        : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                                    }`}
                                                >
                                                    {DIFFICULTIES[key].label}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-slate-600 mb-2 uppercase tracking-wider">Time Limit</label>
                                        <div className="grid grid-cols-3 gap-2">
                                            {DURATIONS.map(d => (
                                                <button
                                                    key={d}
                                                    onClick={() => setDuration(d)}
                                                    className={`py-3 px-4 rounded-xl font-bold transition-all ${
                                                        duration === d 
                                                        ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 scale-[1.02]' 
                                                        : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                                                    }`}
                                                >
                                                    {d}s
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <button 
                                    onClick={startGame}
                                    className="w-full mt-10 py-5 bg-emerald-500 hover:bg-emerald-600 text-white rounded-2xl font-extrabold text-2xl shadow-lg shadow-emerald-100 transition-all active:scale-95"
                                >
                                    START DRILL
                                </button>

                                {highScores.length > 0 && (
                                    <div className="mt-8 border-t pt-6 text-left">
                                        <h3 className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">Recent Sessions</h3>
                                        <div className="space-y-2">
                                            {highScores.slice(0, 3).map((s, i) => (
                                                <div key={i} className="flex justify-between items-center text-slate-600 bg-slate-50 p-3 rounded-lg">
                                                    <span className="font-semibold">{s.difficulty} • {s.duration}s</span>
                                                    <span className="font-bold text-blue-600">{s.score} pts ({s.accuracy}%)</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {gameState === 'PLAYING' && (
                            <div className={`p-8 transition-colors duration-300 ${feedback === 'correct' ? 'pulse-green' : ''}`}>
                                <div className="flex justify-between items-center mb-12">
                                    <div className="flex items-center space-x-2">
                                        <div className="bg-slate-100 rounded-full h-12 w-12 flex items-center justify-center">
                                            <span className="mono text-xl font-bold text-blue-600">{timeLeft}</span>
                                        </div>
                                        <span className="text-sm font-bold text-slate-400 uppercase">Seconds</span>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-3xl font-extrabold text-slate-800">{score.correct}</div>
                                        <div className="text-xs font-bold text-slate-400 uppercase">Correct</div>
                                    </div>
                                </div>

                                <div className={`text-center mb-12 transition-transform ${feedback === 'wrong' ? 'shake' : ''}`}>
                                    <div className="mono text-7xl font-extrabold text-slate-800 tracking-tight flex items-center justify-center space-x-4">
                                        <span>{problem.a}</span>
                                        <span className="text-blue-500">{problem.op === '*' ? '×' : problem.op === '/' ? '÷' : problem.op}</span>
                                        <span>{problem.b}</span>
                                        <span className="text-slate-300">=</span>
                                    </div>
                                </div>

                                <form onSubmit={checkAnswer} className="relative">
                                    <input
                                        ref={inputRef}
                                        type="number"
                                        value={userInput}
                                        onChange={handleInput}
                                        className={`w-full bg-slate-50 border-2 text-center py-6 text-5xl font-extrabold rounded-2xl outline-none transition-all ${
                                            feedback === 'wrong' ? 'border-red-400 text-red-500 bg-red-50' : 'border-slate-100 focus:border-blue-500 text-slate-800'
                                        }`}
                                        placeholder="?"
                                        autoFocus
                                    />
                                    <div className="mt-4 text-center text-slate-400 text-sm font-medium">
                                        Press ENTER to submit
                                    </div>
                                </form>
                            </div>
                        )}

                        {gameState === 'FINISHED' && (
                            <div className="p-8 text-center">
                                <div className="mb-6">
                                    <div className="inline-block p-4 bg-emerald-50 rounded-full mb-4">
                                        <svg className="w-12 h-12 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <h2 className="text-4xl font-extrabold text-slate-800 mb-1">Time's Up!</h2>
                                    <p className="text-slate-500">Here's how you performed</p>
                                </div>

                                <div className="grid grid-cols-2 gap-4 mb-8">
                                    <div className="bg-slate-50 p-6 rounded-2xl">
                                        <div className="text-4xl font-black text-blue-600">{score.correct}</div>
                                        <div className="text-xs font-bold text-slate-400 uppercase mt-1 tracking-wider">Correct Answers</div>
                                    </div>
                                    <div className="bg-slate-50 p-6 rounded-2xl">
                                        <div className="text-4xl font-black text-blue-600">{Math.round((score.correct / (score.total || 1)) * 100)}%</div>
                                        <div className="text-xs font-bold text-slate-400 uppercase mt-1 tracking-wider">Accuracy</div>
                                    </div>
                                </div>

                                <div className="max-h-60 overflow-y-auto mb-8 pr-2 custom-scrollbar">
                                    <table className="w-full text-left">
                                        <thead className="sticky top-0 bg-white">
                                            <tr>
                                                <th className="py-2 text-xs font-bold text-slate-400 uppercase">Problem</th>
                                                <th className="py-2 text-xs font-bold text-slate-400 uppercase text-right">Result</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {history.map((item, i) => (
                                                <tr key={i}>
                                                    <td className="py-3 mono font-bold text-slate-700">
                                                        {item.a} {item.op === '*' ? '×' : item.op === '/' ? '÷' : item.op} {item.b} = {item.ans}
                                                    </td>
                                                    <td className={`py-3 text-right font-bold ${item.isCorrect ? 'text-emerald-500' : 'text-red-500'}`}>
                                                        {item.isCorrect ? '✓' : `✗ (${item.userAns})`}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>

                                <button 
                                    onClick={() => setGameState('START')}
                                    className="w-full py-5 bg-slate-800 hover:bg-slate-900 text-white rounded-2xl font-extrabold text-xl transition-all shadow-lg active:scale-95"
                                >
                                    BACK TO MENU
                                </button>
                            </div>
                        )}
                    </div>
                    
                    <footer className="mt-8 text-slate-400 text-sm font-medium">
                        MATH PRACTICE DRILLS &bull; V1.0
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
