<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ocean Wave Simulation</title>
  <style>
    :root {
      --bg-top: #8fb7ce;
      --bg-bottom: #11354a;
      --panel-bg: rgba(255, 255, 255, 0.1);
      --panel-border: rgba(255, 255, 255, 0.25);
      --text: #ebf8ff;
      --muted: #c6dce9;
      --accent: #8ed9ff;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: "Avenir Next", "Segoe UI", "Trebuchet MS", sans-serif;
      color: var(--text);
      background: radial-gradient(120vmax 75vmax at 50% 0%, #c9e7f3 0%, #7eabc3 42%, #2f647e 74%, #12364c 100%);
    }

    #app {
      position: relative;
      width: 100%;
      height: 100%;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    .vignette {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(130% 80% at 50% -12%, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.02) 55%, rgba(0, 0, 0, 0.2) 100%),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.06), rgba(0, 0, 0, 0.28));
      mix-blend-mode: screen;
    }

    .panel {
      position: absolute;
      top: 1.2rem;
      left: 1.2rem;
      width: min(22rem, calc(100% - 2.4rem));
      padding: 1rem 1rem 0.9rem;
      border-radius: 1rem;
      border: 1px solid var(--panel-border);
      background: linear-gradient(140deg, rgba(15, 53, 74, 0.55), rgba(12, 39, 54, 0.4));
      backdrop-filter: blur(10px) saturate(1.2);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.25);
    }

    .title {
      margin: 0;
      font-size: 1.18rem;
      letter-spacing: 0.03em;
      font-weight: 520;
    }

    .subtitle {
      margin: 0.25rem 0 1rem;
      font-size: 0.86rem;
      color: var(--muted);
    }

    .control {
      margin-bottom: 0.75rem;
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 0.3rem;
    }

    label {
      font-size: 0.86rem;
      letter-spacing: 0.02em;
      color: #e7f6ff;
    }

    .value {
      font-size: 0.8rem;
      color: var(--accent);
      font-variant-numeric: tabular-nums;
    }

    input[type="range"] {
      width: 100%;
      appearance: none;
      height: 0.35rem;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(109, 180, 215, 0.7), rgba(225, 247, 255, 0.55));
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 1rem;
      height: 1rem;
      border-radius: 50%;
      background: #f5fdff;
      border: 2px solid #74b9d9;
      box-shadow: 0 0 0 6px rgba(116, 185, 217, 0.18);
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 1rem;
      height: 1rem;
      border-radius: 50%;
      background: #f5fdff;
      border: 2px solid #74b9d9;
      box-shadow: 0 0 0 6px rgba(116, 185, 217, 0.18);
      cursor: pointer;
    }

    .footer-note {
      margin: 0.15rem 0 0;
      font-size: 0.72rem;
      color: rgba(214, 233, 244, 0.9);
      letter-spacing: 0.01em;
    }

    @media (max-width: 620px) {
      .panel {
        top: auto;
        bottom: 1rem;
        left: 1rem;
        width: calc(100% - 2rem);
      }

      .title {
        font-size: 1.03rem;
      }

      .subtitle {
        font-size: 0.78rem;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <canvas id="ocean" aria-label="Animated ocean wave simulation"></canvas>
    <div class="vignette"></div>

    <section class="panel" aria-label="Ocean simulation controls">
      <h1 class="title">Ocean Wave Simulation</h1>
      <p class="subtitle">Calm, wind-driven swells with dynamic light.</p>

      <div class="control">
        <div class="row">
          <label for="wind">Wind Speed</label>
          <span class="value" id="windValue"></span>
        </div>
        <input id="wind" type="range" min="0" max="100" value="46" />
      </div>

      <div class="control">
        <div class="row">
          <label for="height">Wave Height</label>
          <span class="value" id="heightValue"></span>
        </div>
        <input id="height" type="range" min="0" max="100" value="42" />
      </div>

      <div class="control">
        <div class="row">
          <label for="light">Lighting</label>
          <span class="value" id="lightValue"></span>
        </div>
        <input id="light" type="range" min="0" max="100" value="58" />
      </div>

      <p class="footer-note">Tip: slower wind and softer light create an evening sea.</p>
    </section>
  </div>

  <script>
    (() => {
      const canvas = document.getElementById("ocean");
      const ctx = canvas.getContext("2d");

      const windInput = document.getElementById("wind");
      const heightInput = document.getElementById("height");
      const lightInput = document.getElementById("light");

      const windValue = document.getElementById("windValue");
      const heightValue = document.getElementById("heightValue");
      const lightValue = document.getElementById("lightValue");

      const state = {
        dpr: Math.min(window.devicePixelRatio || 1, 2),
        width: 0,
        height: 0,
        t: 0,
        wind: Number(windInput.value) / 100,
        waveHeight: Number(heightInput.value) / 100,
        lighting: Number(lightInput.value) / 100,
      };

      const smooth = {
        wind: state.wind,
        waveHeight: state.waveHeight,
        lighting: state.lighting,
      };

      const lerp = (a, b, n) => a + (b - a) * n;
      const clamp = (x, min, max) => Math.max(min, Math.min(max, x));

      function resize() {
        state.width = window.innerWidth;
        state.height = window.innerHeight;
        canvas.width = Math.floor(state.width * state.dpr);
        canvas.height = Math.floor(state.height * state.dpr);
        canvas.style.width = state.width + "px";
        canvas.style.height = state.height + "px";
        ctx.setTransform(state.dpr, 0, 0, state.dpr, 0, 0);
      }

      function waveY(xNorm, band, time) {
        const w = smooth.wind;
        const h = smooth.waveHeight;

        const f1 = band.freq * (1 + 1.45 * w);
        const f2 = band.freq2 * (1 + 0.65 * w);
        const f3 = band.freq3 * (1 + 0.35 * w);

        const s1 = Math.sin((xNorm * f1 + time * band.speed * (0.6 + w)) * Math.PI * 2 + band.phase);
        const s2 = Math.sin((xNorm * f2 - time * band.speed * 1.3 * (0.5 + w)) * Math.PI * 2 + band.phase2);
        const s3 = Math.sin((xNorm * f3 + time * band.speed * 0.7) * Math.PI * 2 + band.phase3);

        const chop = Math.sin((xNorm * (18 + 36 * w) - time * (0.4 + w) * 4.8) * Math.PI * 2);

        const primary = (s1 * 0.65 + s2 * 0.28 + s3 * 0.2);
        const shape = primary + chop * (0.03 + w * 0.065);

        return band.baseY + shape * band.amp * (0.45 + h * 1.25);
      }

      function derivative(xNorm, band, time, eps = 0.0015) {
        return (waveY(xNorm + eps, band, time) - waveY(xNorm - eps, band, time)) / (eps * state.width * 2);
      }

      function drawSky() {
        const light = smooth.lighting;
        const grad = ctx.createLinearGradient(0, 0, 0, state.height);
        const topR = Math.round(140 + light * 85);
        const topG = Math.round(176 + light * 58);
        const topB = Math.round(198 + light * 34);
        const midR = Math.round(84 + light * 48);
        const midG = Math.round(137 + light * 35);
        const midB = Math.round(166 + light * 20);
        const lowR = Math.round(19 + light * 24);
        const lowG = Math.round(62 + light * 22);
        const lowB = Math.round(88 + light * 18);

        grad.addColorStop(0, `rgb(${topR}, ${topG}, ${topB})`);
        grad.addColorStop(0.42, `rgb(${midR}, ${midG}, ${midB})`);
        grad.addColorStop(1, `rgb(${lowR}, ${lowG}, ${lowB})`);

        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, state.width, state.height);

        const glowX = state.width * (0.72 - smooth.wind * 0.09);
        const glowY = state.height * 0.14;
        const glow = ctx.createRadialGradient(glowX, glowY, 10, glowX, glowY, state.width * 0.48);
        glow.addColorStop(0, `rgba(255, 245, 221, ${0.24 + light * 0.52})`);
        glow.addColorStop(0.3, `rgba(255, 224, 186, ${0.12 + light * 0.2})`);
        glow.addColorStop(1, "rgba(255, 208, 163, 0)");
        ctx.fillStyle = glow;
        ctx.fillRect(0, 0, state.width, state.height);
      }

      function drawBand(band, time) {
        const samples = Math.max(220, Math.floor(state.width / 5));
        const dx = state.width / (samples - 1);

        const sunDirX = -0.4 + smooth.wind * 0.35;
        const sunDirY = -1;
        const invLen = 1 / Math.hypot(sunDirX, sunDirY);
        const lx = sunDirX * invLen;
        const ly = sunDirY * invLen;

        const baseR = band.color[0] + smooth.lighting * 30;
        const baseG = band.color[1] + smooth.lighting * 40;
        const baseB = band.color[2] + smooth.lighting * 46;

        for (let i = 0; i < samples - 1; i++) {
          const x1 = i * dx;
          const x2 = (i + 1) * dx;
          const xn1 = x1 / state.width;
          const xn2 = x2 / state.width;

          const y1 = waveY(xn1, band, time);
          const y2 = waveY(xn2, band, time);
          const yMid = (y1 + y2) * 0.5;

          const slope = derivative((xn1 + xn2) * 0.5, band, time);
          const nx = -slope;
          const ny = -1;
          const nLen = 1 / Math.hypot(nx, ny);
          const ndotl = clamp((nx * nLen) * lx + (ny * nLen) * ly, -1, 1);
          const lambert = Math.pow(clamp((ndotl + 1) * 0.5, 0, 1), 1.2);
          const spec = Math.pow(clamp(lambert, 0, 1), 22) * (0.06 + smooth.lighting * 0.45) * band.specular;

          const depth = clamp((yMid - band.baseY + band.amp * 1.8) / (band.amp * 3.6), 0, 1);
          const shade = 0.6 + lambert * 0.65 - depth * 0.27;

          const r = clamp(Math.round(baseR * shade + 255 * spec), 0, 255);
          const g = clamp(Math.round(baseG * shade + 255 * spec), 0, 255);
          const b = clamp(Math.round(baseB * shade + 255 * spec), 0, 255);

          ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
          ctx.beginPath();
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.lineTo(x2, state.height + 2);
          ctx.lineTo(x1, state.height + 2);
          ctx.closePath();
          ctx.fill();
        }

        const foamAlpha = (0.04 + smooth.wind * 0.16 + smooth.lighting * 0.08) * band.foam;
        ctx.strokeStyle = `rgba(236, 250, 255, ${foamAlpha})`;
        ctx.lineWidth = 1.1 + band.foam * 1.3;
        ctx.beginPath();
        for (let i = 0; i < samples; i++) {
          const x = i * dx;
          const xn = x / state.width;
          const y = waveY(xn, band, time) - band.foamLift * (0.7 + smooth.waveHeight);
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.stroke();
      }

      function updateLabels() {
        windValue.textContent = `${Math.round(state.wind * 40)} kn`;
        heightValue.textContent = `${(0.6 + state.waveHeight * 4.4).toFixed(1)} m`;
        lightValue.textContent = `${Math.round(18 + state.lighting * 82)}%`;
      }

      function animate(now) {
        state.t = now * 0.001;

        smooth.wind = lerp(smooth.wind, state.wind, 0.028);
        smooth.waveHeight = lerp(smooth.waveHeight, state.waveHeight, 0.028);
        smooth.lighting = lerp(smooth.lighting, state.lighting, 0.028);

        drawSky();

        const h = state.height;
        const w = state.width;
        const ampScale = 24 + smooth.waveHeight * 86;

        const bands = [
          {
            baseY: h * 0.52,
            amp: ampScale * 0.23,
            speed: 0.16,
            freq: 1.2,
            freq2: 2.4,
            freq3: 4.6,
            phase: 0.2,
            phase2: 2.3,
            phase3: 5.6,
            color: [36, 84, 115],
            specular: 0.4,
            foam: 0.26,
            foamLift: 1.2,
          },
          {
            baseY: h * 0.61,
            amp: ampScale * 0.32,
            speed: 0.24,
            freq: 1.45,
            freq2: 2.9,
            freq3: 5.2,
            phase: 1.1,
            phase2: 3.6,
            phase3: 0.5,
            color: [22, 78, 111],
            specular: 0.68,
            foam: 0.42,
            foamLift: 1.9,
          },
          {
            baseY: h * 0.71,
            amp: ampScale * 0.45,
            speed: 0.34,
            freq: 1.8,
            freq2: 3.3,
            freq3: 6.4,
            phase: 2.2,
            phase2: 0.6,
            phase3: 2.7,
            color: [14, 66, 98],
            specular: 0.95,
            foam: 0.7,
            foamLift: 2.3,
          },
          {
            baseY: h * 0.82,
            amp: ampScale * 0.62,
            speed: 0.48,
            freq: 2.2,
            freq2: 3.7,
            freq3: 7.2,
            phase: 0.4,
            phase2: 5.2,
            phase3: 1.3,
            color: [8, 55, 86],
            specular: 1.25,
            foam: 1,
            foamLift: 2.8,
          },
        ];

        const haze = ctx.createLinearGradient(0, h * 0.45, 0, h);
        haze.addColorStop(0, `rgba(187, 223, 243, ${0.02 + smooth.lighting * 0.08})`);
        haze.addColorStop(1, "rgba(9, 29, 41, 0.32)");

        bands.forEach((band, idx) => {
          drawBand(band, state.t + idx * 0.7 + w * 0.00005);
        });

        ctx.fillStyle = haze;
        ctx.fillRect(0, h * 0.44, w, h * 0.6);

        requestAnimationFrame(animate);
      }

      function bindInput(input, key) {
        input.addEventListener("input", () => {
          state[key] = Number(input.value) / 100;
          updateLabels();
        });
      }

      bindInput(windInput, "wind");
      bindInput(heightInput, "waveHeight");
      bindInput(lightInput, "lighting");
      window.addEventListener("resize", resize);

      resize();
      updateLabels();
      requestAnimationFrame(animate);
    })();
  </script>
</body>
</html>
