<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Online Whiteboard</title>
  <style>
    :root {
      --bg: #f3f5f8;
      --panel: rgba(255, 255, 255, 0.88);
      --border: rgba(21, 31, 56, 0.15);
      --text: #1a2540;
      --muted: #647089;
      --accent: #0d9488;
      --accent-strong: #0f766e;
      --shadow: 0 12px 35px rgba(25, 35, 65, 0.15);
    }

    * { box-sizing: border-box; }

    html,
    body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      font-family: "Avenir Next", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1000px 500px at 10% -20%, rgba(13, 148, 136, 0.13), transparent 60%),
        radial-gradient(1100px 700px at 100% 120%, rgba(59, 130, 246, 0.1), transparent 55%),
        var(--bg);
    }

    .app {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      cursor: crosshair;
      touch-action: none;
      background: white;
    }

    .toolbar {
      position: absolute;
      top: 14px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
      display: flex;
      gap: 8px;
      align-items: center;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 14px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: var(--panel);
      box-shadow: var(--shadow);
      max-width: calc(100vw - 24px);
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .group {
      display: flex;
      align-items: center;
      gap: 6px;
      padding-right: 8px;
      margin-right: 4px;
      border-right: 1px solid var(--border);
    }

    .group:last-child {
      border-right: 0;
      margin-right: 0;
      padding-right: 0;
    }

    .btn {
      border: 1px solid var(--border);
      background: white;
      color: var(--text);
      border-radius: 10px;
      height: 38px;
      min-width: 38px;
      padding: 0 12px;
      font-size: 14px;
      line-height: 1;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      user-select: none;
      white-space: nowrap;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(23, 34, 61, 0.12);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent-strong);
    }

    .btn.warn {
      color: #b42318;
      border-color: rgba(180, 35, 24, 0.25);
      background: #fff6f5;
    }

    input[type="color"] {
      width: 40px;
      height: 38px;
      padding: 4px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: white;
      cursor: pointer;
    }

    input[type="range"] {
      width: 130px;
      accent-color: var(--accent);
      cursor: pointer;
    }

    .size-readout {
      min-width: 46px;
      text-align: center;
      font-size: 13px;
      color: var(--muted);
      font-weight: 700;
    }

    .hint {
      position: absolute;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      z-index: 15;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.9);
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      user-select: none;
    }

    @media (max-width: 720px) {
      .toolbar {
        left: 10px;
        right: 10px;
        transform: none;
      }
      .hint {
        width: calc(100vw - 20px);
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="app" aria-label="Online Whiteboard App">
    <canvas id="board" aria-label="Whiteboard canvas"></canvas>

    <div class="toolbar" role="toolbar" aria-label="Drawing tools">
      <div class="group">
        <button id="drawBtn" class="btn active" type="button" title="Draw (D)">Draw</button>
        <button id="eraseBtn" class="btn" type="button" title="Erase (E)">Erase</button>
      </div>

      <div class="group">
        <input id="colorPicker" type="color" value="#111111" aria-label="Pick color" title="Brush color" />
        <input id="sizeRange" type="range" min="1" max="50" value="5" aria-label="Brush size" title="Brush size" />
        <span id="sizeReadout" class="size-readout">5 px</span>
      </div>

      <div class="group">
        <button id="undoBtn" class="btn" type="button" title="Undo (Ctrl/Cmd+Z)">Undo</button>
        <button id="redoBtn" class="btn" type="button" title="Redo (Ctrl/Cmd+Shift+Z)">Redo</button>
      </div>

      <div class="group">
        <button id="clearBtn" class="btn warn" type="button" title="Clear board">Clear</button>
        <button id="saveBtn" class="btn" type="button" title="Save image (S)">Save</button>
      </div>
    </div>

    <div class="hint">Tip: Mouse, touch, or stylus supported. Keyboard: D draw, E erase, S save.</div>
  </div>

  <script>
    (function () {
      const canvas = document.getElementById('board');
      const ctx = canvas.getContext('2d');

      const drawBtn = document.getElementById('drawBtn');
      const eraseBtn = document.getElementById('eraseBtn');
      const colorPicker = document.getElementById('colorPicker');
      const sizeRange = document.getElementById('sizeRange');
      const sizeReadout = document.getElementById('sizeReadout');
      const undoBtn = document.getElementById('undoBtn');
      const redoBtn = document.getElementById('redoBtn');
      const clearBtn = document.getElementById('clearBtn');
      const saveBtn = document.getElementById('saveBtn');

      let mode = 'draw';
      let drawing = false;
      let pointerId = null;
      let lastX = 0;
      let lastY = 0;

      const history = [];
      const future = [];
      const HISTORY_LIMIT = 30;

      function resizeCanvas() {
        const snapshot = canvas.width > 0 && canvas.height > 0 ? canvas.toDataURL('image/png') : null;

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        if (snapshot) {
          const img = new Image();
          img.onload = () => ctx.drawImage(img, 0, 0);
          img.src = snapshot;
        } else {
          fillWhite();
          saveState();
        }
      }

      function fillWhite() {
        ctx.save();
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.restore();
      }

      function setMode(nextMode) {
        mode = nextMode;
        drawBtn.classList.toggle('active', mode === 'draw');
        eraseBtn.classList.toggle('active', mode === 'erase');
        canvas.style.cursor = mode === 'erase' ? 'cell' : 'crosshair';
      }

      function updateSize() {
        sizeReadout.textContent = sizeRange.value + ' px';
      }

      function getPoint(event) {
        const rect = canvas.getBoundingClientRect();
        return {
          x: event.clientX - rect.left,
          y: event.clientY - rect.top
        };
      }

      function saveState() {
        if (history.length >= HISTORY_LIMIT) history.shift();
        history.push(canvas.toDataURL('image/png'));
        future.length = 0;
      }

      function restoreFromDataUrl(dataUrl) {
        const img = new Image();
        img.onload = () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        };
        img.src = dataUrl;
      }

      function undo() {
        if (history.length <= 1) return;
        const current = history.pop();
        future.push(current);
        restoreFromDataUrl(history[history.length - 1]);
      }

      function redo() {
        if (future.length === 0) return;
        const next = future.pop();
        history.push(next);
        restoreFromDataUrl(next);
      }

      function startDraw(event) {
        if (drawing) return;
        drawing = true;
        pointerId = event.pointerId;
        canvas.setPointerCapture(pointerId);

        const p = getPoint(event);
        lastX = p.x;
        lastY = p.y;

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
      }

      function draw(event) {
        if (!drawing || event.pointerId !== pointerId) return;
        const p = getPoint(event);

        ctx.lineWidth = Number(sizeRange.value);
        if (mode === 'erase') {
          ctx.globalCompositeOperation = 'destination-out';
          ctx.strokeStyle = 'rgba(0,0,0,1)';
        } else {
          ctx.globalCompositeOperation = 'source-over';
          ctx.strokeStyle = colorPicker.value;
        }

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();

        lastX = p.x;
        lastY = p.y;
      }

      function endDraw(event) {
        if (!drawing || event.pointerId !== pointerId) return;
        drawing = false;
        pointerId = null;
        ctx.globalCompositeOperation = 'source-over';
        saveState();
      }

      function clearBoard() {
        fillWhite();
        saveState();
      }

      function saveImage() {
        const link = document.createElement('a');
        const stamp = new Date().toISOString().replace(/[:.]/g, '-');
        link.download = `online-whiteboard-${stamp}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      }

      drawBtn.addEventListener('click', () => setMode('draw'));
      eraseBtn.addEventListener('click', () => setMode('erase'));
      sizeRange.addEventListener('input', updateSize);

      undoBtn.addEventListener('click', undo);
      redoBtn.addEventListener('click', redo);

      clearBtn.addEventListener('click', clearBoard);
      saveBtn.addEventListener('click', saveImage);

      canvas.addEventListener('pointerdown', startDraw);
      canvas.addEventListener('pointermove', draw);
      canvas.addEventListener('pointerup', endDraw);
      canvas.addEventListener('pointercancel', endDraw);
      canvas.addEventListener('pointerout', endDraw);

      window.addEventListener('keydown', (e) => {
        const key = e.key.toLowerCase();

        if (key === 'd') {
          setMode('draw');
        } else if (key === 'e') {
          setMode('erase');
        } else if (key === 's') {
          e.preventDefault();
          saveImage();
        } else if ((e.ctrlKey || e.metaKey) && key === 'z' && !e.shiftKey) {
          e.preventDefault();
          undo();
        } else if ((e.ctrlKey || e.metaKey) && key === 'z' && e.shiftKey) {
          e.preventDefault();
          redo();
        }
      });

      window.addEventListener('resize', resizeCanvas);

      updateSize();
      setMode('draw');
      resizeCanvas();
    })();
  </script>
</body>
</html>
