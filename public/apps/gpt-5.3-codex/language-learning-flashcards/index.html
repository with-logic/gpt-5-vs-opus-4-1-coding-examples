<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Language Learning Flashcards</title>
  <style>
    :root {
      --bg-1: #f6f2ea;
      --bg-2: #d7ebea;
      --bg-3: #f8d9bf;
      --ink: #172025;
      --muted: #4f6069;
      --accent: #0f766e;
      --accent-2: #f97316;
      --card-front: #fffdf8;
      --card-back: #12303c;
      --success: #15803d;
      --danger: #b91c1c;
      --shadow: 0 22px 60px rgba(18, 48, 60, 0.2);
      --radius: 22px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Avenir Next", "Segoe UI", "Noto Sans", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 10% 15%, rgba(255, 255, 255, 0.68), transparent 48%),
        radial-gradient(circle at 84% 22%, rgba(255, 255, 255, 0.6), transparent 52%),
        linear-gradient(135deg, var(--bg-1), var(--bg-2) 53%, var(--bg-3));
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
      overflow-x: hidden;
    }

    .grain {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.15;
      background-image: radial-gradient(rgba(16, 24, 40, 0.4) 0.6px, transparent 0.6px);
      background-size: 5px 5px;
      mix-blend-mode: soft-light;
    }

    .app {
      width: min(100%, 980px);
      background: rgba(255, 255, 255, 0.74);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.65);
      border-radius: calc(var(--radius) + 4px);
      box-shadow: var(--shadow);
      padding: 28px;
      position: relative;
      overflow: hidden;
      transform: translateY(0);
      animation: liftIn 640ms cubic-bezier(.24,.75,.24,1);
    }

    @keyframes liftIn {
      from { opacity: 0; transform: translateY(18px) scale(0.985); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .topbar {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.35rem, 3.5vw, 2.05rem);
      line-height: 1.15;
      letter-spacing: 0.01em;
    }

    .subtitle {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 0.96rem;
    }

    .stats {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .pill {
      border: 1px solid rgba(15, 118, 110, 0.2);
      color: #0f5c56;
      background: rgba(255, 255, 255, 0.74);
      padding: 7px 11px;
      border-radius: 999px;
      font-size: 0.84rem;
      font-weight: 700;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 18px;
    }

    button, select {
      font: inherit;
      border: 0;
      border-radius: 12px;
      padding: 10px 12px;
      transition: transform 160ms ease, box-shadow 220ms ease, background 220ms ease, opacity 220ms ease;
    }

    button {
      color: white;
      background: #174760;
      box-shadow: 0 6px 16px rgba(23, 71, 96, 0.24);
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.01em;
    }

    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(1px) scale(0.99); }
    button:disabled { cursor: not-allowed; opacity: 0.6; }

    .secondary { background: #0f766e; box-shadow: 0 6px 16px rgba(15, 118, 110, 0.27); }
    .warn { background: var(--accent-2); box-shadow: 0 6px 16px rgba(249, 115, 22, 0.25); }
    .ghost {
      background: rgba(255, 255, 255, 0.88);
      color: #174760;
      border: 1px solid rgba(23, 71, 96, 0.2);
      box-shadow: none;
    }

    select {
      width: 100%;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(23, 71, 96, 0.24);
      color: #12303c;
      font-weight: 700;
      cursor: pointer;
      outline: none;
    }

    .stage {
      perspective: 1400px;
      min-height: 360px;
      position: relative;
    }

    .card-wrap {
      width: 100%;
      min-height: 360px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 620ms cubic-bezier(.21,.75,.21,1), opacity 360ms ease;
      cursor: pointer;
    }

    .card-wrap.is-flipped { transform: rotateY(180deg); }
    .card-wrap.shuffle { animation: shuffleCard 480ms cubic-bezier(.33,.8,.24,1); }
    .card-wrap.learned-burst { animation: pulseLearned 500ms ease; }

    @keyframes shuffleCard {
      0% { transform: translateX(0) rotateZ(0); }
      28% { transform: translateX(-11px) rotateZ(-1.1deg); }
      62% { transform: translateX(12px) rotateZ(1.2deg); }
      100% { transform: translateX(0) rotateZ(0); }
    }

    @keyframes pulseLearned {
      0% { transform: scale(1); }
      42% { transform: scale(1.022); }
      100% { transform: scale(1); }
    }

    .card-face {
      position: absolute;
      inset: 0;
      backface-visibility: hidden;
      border-radius: var(--radius);
      padding: clamp(18px, 5vw, 30px);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 18px 48px rgba(18, 48, 60, 0.16);
      overflow: hidden;
    }

    .card-face::before {
      content: "";
      position: absolute;
      top: -56px;
      right: -60px;
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.35), transparent 70%);
      pointer-events: none;
    }

    .card-front {
      background: linear-gradient(140deg, var(--card-front), #f0f7f8 80%);
      color: #132028;
    }

    .card-back {
      background: linear-gradient(135deg, var(--card-back), #1c5f68);
      color: #effffd;
      transform: rotateY(180deg);
    }

    .face-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 0.85rem;
      font-weight: 700;
      color: rgba(19, 32, 40, 0.78);
    }

    .card-back .face-meta { color: rgba(239, 255, 253, 0.84); }

    .phrase {
      font-size: clamp(1.4rem, 4.5vw, 2.35rem);
      font-weight: 800;
      line-height: 1.18;
      letter-spacing: 0.01em;
      margin: 14px 0;
      text-wrap: balance;
    }

    .hint {
      color: var(--muted);
      font-size: 0.95rem;
      font-weight: 600;
      line-height: 1.35;
    }

    .card-back .hint { color: rgba(239, 255, 253, 0.86); }

    .learned-badge {
      position: absolute;
      top: 16px;
      left: 16px;
      background: rgba(21, 128, 61, 0.92);
      color: white;
      font-weight: 800;
      font-size: 0.78rem;
      border-radius: 999px;
      padding: 7px 10px;
      opacity: 0;
      transform: translateY(-8px);
      transition: opacity 220ms ease, transform 220ms ease;
      pointer-events: none;
      z-index: 3;
    }

    .learned .learned-badge {
      opacity: 1;
      transform: translateY(0);
    }

    .progress-row {
      margin-top: 16px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 1px solid rgba(23, 71, 96, 0.35);
      background: rgba(255, 255, 255, 0.75);
      transition: transform 200ms ease, background 200ms ease, border-color 200ms ease;
    }

    .dot.current {
      transform: scale(1.26);
      background: #174760;
      border-color: #174760;
    }

    .dot.learned {
      background: #22c55e;
      border-color: #15803d;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 22, 30, 0.45);
      backdrop-filter: blur(5px);
      display: grid;
      place-items: center;
      padding: 22px;
      z-index: 9;
      opacity: 1;
      transition: opacity 220ms ease;
    }

    .overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .dialog {
      width: min(100%, 620px);
      background: white;
      border-radius: 20px;
      padding: 22px;
      box-shadow: 0 24px 50px rgba(0,0,0,0.22);
      animation: popIn 260ms ease;
    }

    @keyframes popIn {
      from { transform: scale(0.95) translateY(10px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }

    .lang-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 16px;
    }

    .lang-btn {
      text-align: left;
      background: #f7fbfd;
      color: #12303c;
      border: 1px solid rgba(18, 48, 60, 0.18);
      padding: 14px;
      box-shadow: none;
      border-radius: 14px;
      font-weight: 800;
    }

    .lang-btn small {
      display: block;
      color: var(--muted);
      font-weight: 600;
      margin-top: 5px;
      font-size: 0.84rem;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(16px);
      background: rgba(12, 35, 49, 0.92);
      color: white;
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 0.89rem;
      font-weight: 700;
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease, transform 220ms ease;
      z-index: 12;
      text-align: center;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    @media (max-width: 760px) {
      .app { padding: 18px; }
      .controls { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .controls select { grid-column: span 2; }
      .stage, .card-wrap { min-height: 320px; }
      .lang-grid { grid-template-columns: 1fr; }
    }

    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>
  <div class="grain" aria-hidden="true"></div>
  <div class="overlay" id="languageOverlay" role="dialog" aria-modal="true" aria-labelledby="pickerTitle">
    <div class="dialog">
      <h2 id="pickerTitle" style="margin: 0; font-size: 1.5rem;"></h2>
      <p id="pickerText" style="margin: 8px 0 0; color: var(--muted);"></p>
      <div class="lang-grid" id="langButtons"></div>
    </div>
  </div>

  <main class="app" aria-live="polite">
    <section class="topbar">
      <div>
        <h1 id="title"></h1>
        <p class="subtitle" id="subtitle"></p>
      </div>
      <div class="stats">
        <span class="pill" id="progressPill"></span>
        <span class="pill" id="learnedPill"></span>
      </div>
    </section>

    <section class="controls">
      <select id="targetSelect" aria-label="Language selector"></select>
      <button id="prevBtn" class="ghost" type="button"></button>
      <button id="nextBtn" type="button"></button>
      <button id="shuffleBtn" class="warn" type="button"></button>
      <button id="learnBtn" class="secondary" type="button"></button>
    </section>

    <section class="stage" id="cardStage">
      <article class="card-wrap" id="card" tabindex="0" role="button" aria-label="Flip flashcard">
        <span class="learned-badge" id="learnedBadge"></span>
        <div class="card-face card-front">
          <div class="face-meta">
            <span id="frontLabel"></span>
            <span id="cardIndexLabel"></span>
          </div>
          <p class="phrase" id="frontPhrase"></p>
          <p class="hint" id="frontHint"></p>
        </div>
        <div class="card-face card-back">
          <div class="face-meta">
            <span id="backLabel"></span>
            <span id="pronounceLabel"></span>
          </div>
          <p class="phrase" id="backPhrase"></p>
          <p class="hint" id="backHint"></p>
        </div>
      </article>
    </section>

    <div class="progress-row" id="progressDots" aria-hidden="true"></div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    const uiText = {
      en: {
        title: "Travel Flashcards",
        subtitle: "Flip each card to reveal the translation.",
        chooseTitle: "Which language do you want to learn?",
        chooseText: "Pick one to start practicing useful travel phrases.",
        progress: "Card {current}/{total}",
        learned: "Learned {count}/{total}",
        selectAria: "Choose language to learn",
        previous: "Previous",
        next: "Next",
        shuffle: "Shuffle",
        markLearned: "Mark as learned",
        markUnlearned: "Unmark learned",
        frontLabel: "Prompt",
        backLabel: "Translation",
        pronounce: "Tap to flip",
        frontHint: "Click or press Enter to flip this card.",
        backHint: "Great. Say it out loud once before moving on.",
        learnedBadge: "Learned",
        toastShuffle: "Cards shuffled",
        toastLearned: "Marked as learned",
        toastUnlearned: "Removed from learned"
      },
      es: {
        title: "Tarjetas de Viaje",
        subtitle: "Gira cada tarjeta para ver la traduccion.",
        chooseTitle: "Que idioma quieres aprender?",
        chooseText: "Elige uno para practicar frases utiles de viaje.",
        progress: "Tarjeta {current}/{total}",
        learned: "Aprendidas {count}/{total}",
        selectAria: "Elegir idioma para aprender",
        previous: "Anterior",
        next: "Siguiente",
        shuffle: "Mezclar",
        markLearned: "Marcar aprendida",
        markUnlearned: "Quitar aprendida",
        frontLabel: "Frase",
        backLabel: "Traduccion",
        pronounce: "Toca para girar",
        frontHint: "Haz clic o pulsa Enter para girar la tarjeta.",
        backHint: "Bien. Dila en voz alta antes de continuar.",
        learnedBadge: "Aprendida",
        toastShuffle: "Tarjetas mezcladas",
        toastLearned: "Marcada como aprendida",
        toastUnlearned: "Quitada de aprendidas"
      },
      fr: {
        title: "Cartes de Voyage",
        subtitle: "Retournez chaque carte pour voir la traduction.",
        chooseTitle: "Quelle langue voulez-vous apprendre ?",
        chooseText: "Choisissez-en une pour pratiquer des phrases utiles.",
        progress: "Carte {current}/{total}",
        learned: "Apprises {count}/{total}",
        selectAria: "Choisir la langue a apprendre",
        previous: "Precedente",
        next: "Suivante",
        shuffle: "Melanger",
        markLearned: "Marquer apprise",
        markUnlearned: "Retirer apprise",
        frontLabel: "Phrase",
        backLabel: "Traduction",
        pronounce: "Touchez pour retourner",
        frontHint: "Cliquez ou appuyez sur Entree pour retourner la carte.",
        backHint: "Parfait. Dites-la a voix haute une fois.",
        learnedBadge: "Apprise",
        toastShuffle: "Cartes melangees",
        toastLearned: "Marquee comme apprise",
        toastUnlearned: "Retiree des apprises"
      },
      ja: {
        title: "Travel Flashcards",
        subtitle: "Flipして訳を確認します。",
        chooseTitle: "どの言語を学びますか？",
        chooseText: "旅行で使えるフレーズを練習しましょう。",
        progress: "カード {current}/{total}",
        learned: "習得 {count}/{total}",
        selectAria: "学習する言語を選ぶ",
        previous: "前へ",
        next: "次へ",
        shuffle: "シャッフル",
        markLearned: "習得にする",
        markUnlearned: "習得を外す",
        frontLabel: "問題",
        backLabel: "訳",
        pronounce: "タップで反転",
        frontHint: "クリックまたはEnterで反転します。",
        backHint: "そのまま声に出して言ってみましょう。",
        learnedBadge: "習得済み",
        toastShuffle: "カードをシャッフルしました",
        toastLearned: "習得として保存しました",
        toastUnlearned: "習得から外しました"
      }
    };

    const languageNames = {
      en: { native: "English", locale: "English" },
      es: { native: "Espanol", locale: "Spanish" },
      fr: { native: "Francais", locale: "French" },
      ja: { native: "日本語", locale: "Japanese" }
    };

    const phraseBank = [
      { key: "hello", en: "Hello", es: "Hola", fr: "Bonjour", ja: "こんにちは" },
      { key: "thank", en: "Thank you", es: "Gracias", fr: "Merci", ja: "ありがとうございます" },
      { key: "where_hotel", en: "Where is the hotel?", es: "Donde esta el hotel?", fr: "Ou est l'hotel ?", ja: "ホテルはどこですか？" },
      { key: "price", en: "How much is this?", es: "Cuanto cuesta esto?", fr: "Combien ca coute ?", ja: "これはいくらですか？" },
      { key: "help", en: "I need help", es: "Necesito ayuda", fr: "J'ai besoin d'aide", ja: "助けが必要です" },
      { key: "bathroom", en: "Where is the bathroom?", es: "Donde esta el bano?", fr: "Ou sont les toilettes ?", ja: "トイレはどこですか？" },
      { key: "ticket", en: "One ticket, please", es: "Un boleto, por favor", fr: "Un billet, s'il vous plait", ja: "チケットを1枚お願いします" },
      { key: "vegetarian", en: "I am vegetarian", es: "Soy vegetariano/a", fr: "Je suis vegetarien(ne)", ja: "私はベジタリアンです" },
      { key: "airport", en: "How do I get to the airport?", es: "Como llego al aeropuerto?", fr: "Comment aller a l'aeroport ?", ja: "空港へはどう行きますか？" },
      { key: "goodbye", en: "Goodbye", es: "Adios", fr: "Au revoir", ja: "さようなら" }
    ];

    const state = {
      uiLang: detectUiLang(),
      targetLang: null,
      cards: [],
      index: 0,
      flipped: false,
      learned: new Set()
    };

    const els = {
      overlay: document.getElementById("languageOverlay"),
      pickerTitle: document.getElementById("pickerTitle"),
      pickerText: document.getElementById("pickerText"),
      langButtons: document.getElementById("langButtons"),
      title: document.getElementById("title"),
      subtitle: document.getElementById("subtitle"),
      progressPill: document.getElementById("progressPill"),
      learnedPill: document.getElementById("learnedPill"),
      targetSelect: document.getElementById("targetSelect"),
      prevBtn: document.getElementById("prevBtn"),
      nextBtn: document.getElementById("nextBtn"),
      shuffleBtn: document.getElementById("shuffleBtn"),
      learnBtn: document.getElementById("learnBtn"),
      card: document.getElementById("card"),
      learnedBadge: document.getElementById("learnedBadge"),
      frontLabel: document.getElementById("frontLabel"),
      backLabel: document.getElementById("backLabel"),
      pronounceLabel: document.getElementById("pronounceLabel"),
      cardIndexLabel: document.getElementById("cardIndexLabel"),
      frontPhrase: document.getElementById("frontPhrase"),
      backPhrase: document.getElementById("backPhrase"),
      frontHint: document.getElementById("frontHint"),
      backHint: document.getElementById("backHint"),
      progressDots: document.getElementById("progressDots"),
      toast: document.getElementById("toast")
    };

    function detectUiLang() {
      const code = (navigator.language || "en").slice(0, 2).toLowerCase();
      return uiText[code] ? code : "en";
    }

    function t(key, vars = {}) {
      const table = uiText[state.uiLang] || uiText.en;
      let txt = table[key] || uiText.en[key] || key;
      Object.entries(vars).forEach(([k, v]) => {
        txt = txt.replace(`{${k}}`, String(v));
      });
      return txt;
    }

    function getSourceLang() {
      if (!state.targetLang) return state.uiLang;
      return state.uiLang === state.targetLang ? "en" : state.uiLang;
    }

    function setupLanguageChooser() {
      els.pickerTitle.textContent = t("chooseTitle");
      els.pickerText.textContent = t("chooseText");
      els.langButtons.innerHTML = "";

      ["en", "es", "fr", "ja"].forEach((code) => {
        const btn = document.createElement("button");
        btn.className = "lang-btn";
        btn.type = "button";
        btn.innerHTML = `${languageNames[code].native}<small>${languageNames[code].locale}</small>`;
        btn.addEventListener("click", () => setTargetLanguage(code, true));
        els.langButtons.appendChild(btn);
      });
    }

    function setupSelect() {
      els.targetSelect.innerHTML = "";
      ["en", "es", "fr", "ja"].forEach((code) => {
        const option = document.createElement("option");
        option.value = code;
        option.textContent = `${languageNames[code].native} (${languageNames[code].locale})`;
        els.targetSelect.appendChild(option);
      });
      els.targetSelect.setAttribute("aria-label", t("selectAria"));
      els.targetSelect.addEventListener("change", (e) => setTargetLanguage(e.target.value));
    }

    function setTargetLanguage(code, closeOverlay = false) {
      state.targetLang = code;
      state.cards = phraseBank.map((phrase, i) => ({ ...phrase, id: i + 1 }));
      state.index = 0;
      state.flipped = false;
      state.learned = new Set();
      els.targetSelect.value = code;

      if (closeOverlay) {
        els.overlay.classList.add("hidden");
        setTimeout(() => {
          els.overlay.style.display = "none";
        }, 220);
      }

      renderAll();
    }

    function currentCard() {
      return state.cards[state.index];
    }

    function flipCard() {
      state.flipped = !state.flipped;
      els.card.classList.toggle("is-flipped", state.flipped);
    }

    function renderText() {
      els.title.textContent = t("title");
      els.subtitle.textContent = t("subtitle");
      els.prevBtn.textContent = t("previous");
      els.nextBtn.textContent = t("next");
      els.shuffleBtn.textContent = t("shuffle");
      els.frontLabel.textContent = t("frontLabel");
      els.backLabel.textContent = t("backLabel");
      els.pronounceLabel.textContent = t("pronounce");
      els.frontHint.textContent = t("frontHint");
      els.backHint.textContent = t("backHint");
      els.learnedBadge.textContent = t("learnedBadge");
    }

    function renderStats() {
      const total = state.cards.length;
      const current = state.index + 1;
      els.progressPill.textContent = t("progress", { current, total });
      els.learnedPill.textContent = t("learned", { count: state.learned.size, total });
      els.cardIndexLabel.textContent = `${current} / ${total}`;
    }

    function renderCard() {
      const card = currentCard();
      if (!card) return;
      const source = getSourceLang();
      els.frontPhrase.textContent = card[source] || card.en;
      els.backPhrase.textContent = card[state.targetLang] || card.en;

      const isLearned = state.learned.has(card.id);
      els.card.classList.toggle("learned", isLearned);
      els.learnBtn.textContent = isLearned ? t("markUnlearned") : t("markLearned");
      els.card.classList.toggle("is-flipped", state.flipped);
      renderStats();
      renderDots();
    }

    function renderDots() {
      els.progressDots.innerHTML = "";
      state.cards.forEach((card, idx) => {
        const dot = document.createElement("span");
        dot.className = "dot";
        if (idx === state.index) dot.classList.add("current");
        if (state.learned.has(card.id)) dot.classList.add("learned");
        els.progressDots.appendChild(dot);
      });
    }

    function go(step) {
      if (!state.cards.length) return;
      state.index = (state.index + step + state.cards.length) % state.cards.length;
      state.flipped = false;
      renderCard();
    }

    function shuffleCards() {
      const current = currentCard();
      for (let i = state.cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [state.cards[i], state.cards[j]] = [state.cards[j], state.cards[i]];
      }
      if (current) {
        const newIndex = state.cards.findIndex((c) => c.id === current.id);
        state.index = newIndex >= 0 ? newIndex : 0;
      }
      state.flipped = false;
      els.card.classList.remove("is-flipped");
      els.card.classList.remove("shuffle");
      void els.card.offsetWidth;
      els.card.classList.add("shuffle");
      renderCard();
      toast(t("toastShuffle"));
    }

    function toggleLearned() {
      const card = currentCard();
      if (!card) return;
      if (state.learned.has(card.id)) {
        state.learned.delete(card.id);
        toast(t("toastUnlearned"));
      } else {
        state.learned.add(card.id);
        els.card.classList.remove("learned-burst");
        void els.card.offsetWidth;
        els.card.classList.add("learned-burst");
        toast(t("toastLearned"));
      }
      renderCard();
    }

    let toastTimer;
    function toast(message) {
      els.toast.textContent = message;
      els.toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => {
        els.toast.classList.remove("show");
      }, 1200);
    }

    function renderAll() {
      renderText();
      renderCard();
    }

    function bindEvents() {
      els.card.addEventListener("click", flipCard);
      els.card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          flipCard();
        }
      });
      els.prevBtn.addEventListener("click", () => go(-1));
      els.nextBtn.addEventListener("click", () => go(1));
      els.shuffleBtn.addEventListener("click", shuffleCards);
      els.learnBtn.addEventListener("click", toggleLearned);
      document.addEventListener("keydown", (e) => {
        if (els.overlay.style.display !== "none" && !els.overlay.classList.contains("hidden")) return;
        if (e.key === "ArrowRight") go(1);
        if (e.key === "ArrowLeft") go(-1);
        if (e.key.toLowerCase() === "l") toggleLearned();
      });
    }

    function init() {
      setupLanguageChooser();
      setupSelect();
      bindEvents();
      const defaultTarget = state.uiLang;
      setTargetLanguage(["en", "es", "fr", "ja"].includes(defaultTarget) ? defaultTarget : "en");
      els.overlay.style.display = "grid";
    }

    init();
  </script>
</body>
</html>
