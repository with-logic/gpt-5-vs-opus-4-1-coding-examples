<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <meta name="description" content="Podcast Home Page – browse episodes, search, and subscribe." />
  <title>Podcast Home Page</title>
  <style>
    :root {
      --bg: #0b1220;            /* deep navy */
      --bg-elev: #0f172a;       /* slate-900 */
      --bg-soft: #111827;       /* gray-900 */
      --card: #121a2e;
      --muted: #94a3b8;         /* slate-400 */
      --text: #e2e8f0;          /* slate-200 */
      --text-strong: #f8fafc;   /* slate-50 */
      --accent-1: #a78bfa;      /* violet-300 */
      --accent-2: #22d3ee;      /* cyan-400 */
      --accent-3: #34d399;      /* emerald-400 */
      --ring: rgba(56,189,248,0.4);
      --shadow: rgba(2, 6, 23, 0.6);
      --danger: #f87171;
      --ok: #10b981;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      color: var(--text); background: radial-gradient(1200px 600px at 10% -10%, rgba(167,139,250,.12), transparent 60%), radial-gradient(1000px 500px at 110% -10%, rgba(34,211,238,.10), transparent 60%), linear-gradient(180deg, var(--bg) 0%, #0a1224 40%, #0a1020 100%);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    .container { width: min(1100px, 92vw); margin: 0 auto; }

    a { color: inherit; text-decoration: none; }
    a:focus-visible, button:focus-visible, input:focus-visible { outline: 2px solid var(--accent-2); outline-offset: 2px; }

    .skip { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
    .skip:focus { position: fixed; left: 1rem; top: 1rem; width: auto; height: auto; padding: .5rem .75rem; background: var(--bg-elev); border-radius: .5rem; z-index: 9999; }

    header.hero {
      position: relative; padding: 56px 0 28px; background: linear-gradient(180deg, rgba(15,23,42,0.6) 0%, rgba(2,6,23,0) 100%);
      border-bottom: 1px solid rgba(148,163,184,0.12);
    }
    .badge {
      display: inline-flex; align-items: center; gap: .5rem; padding: .35rem .6rem; border-radius: 999px; background: rgba(167,139,250,.12); color: #c7d2fe; font-weight: 600; font-size: .8rem; letter-spacing: .02em;
      border: 1px solid rgba(167,139,250,.35);
    }
    .title {
      margin: 14px 0 8px; font-size: clamp(28px, 5vw, 42px); line-height: 1.1; font-weight: 800;
      background: linear-gradient(90deg, var(--text-strong), #cbd5e1 45%, #a5b4fc 90%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      letter-spacing: -0.02em;
    }
    .tagline { color: var(--muted); max-width: 65ch; font-size: 1.05rem; }

    .sub-row { margin-top: 18px; display: flex; gap: .75rem; flex-wrap: wrap; align-items: center; }

    .btn { --bgc: rgba(255,255,255,.06); --bd: rgba(148,163,184,.28);
      display: inline-flex; align-items: center; gap: .55rem; padding: .66rem .85rem; border-radius: .75rem; background: var(--bgc);
      border: 1px solid var(--bd); color: var(--text); cursor: pointer; font-weight: 600; transition: transform .05s ease, background .2s ease, border-color .2s ease;
    }
    .btn:hover { transform: translateY(-1px); border-color: rgba(148,163,184,.45); }
    .btn:active { transform: translateY(0); }
    .btn.primary { background: linear-gradient(135deg, rgba(167,139,250,.16), rgba(34,211,238,.14)); border-color: rgba(167,139,250,.45); }
    .btn.ghost { background: transparent; }
    .btn .icon { width: 18px; height: 18px; }

    .controls {
      position: sticky; top: 0; z-index: 20; backdrop-filter: saturate(120%) blur(8px);
      background: linear-gradient(180deg, rgba(2,6,23,.9) 0%, rgba(2,6,23,.6) 100%);
      border-bottom: 1px solid rgba(148,163,184,0.12);
    }
    .controls-inner { display: flex; gap: .75rem; padding: .8rem 0; align-items: center; }

    .search {
      flex: 1; display: flex; align-items: center; gap: .6rem; background: var(--bg-elev);
      border: 1px solid rgba(148,163,184,.28); border-radius: .75rem; padding: .55rem .7rem;
    }
    .search input { flex: 1; background: transparent; border: 0; color: var(--text); font-size: 1rem; outline: none; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: rgba(148,163,184,.16); border: 1px solid rgba(148,163,184,.35); padding: .05rem .4rem; border-radius: .35rem; color: #cbd5e1; font-size: .85rem; }
    .count { color: var(--muted); font-size: .95rem; white-space: nowrap; }

    main { padding: 22px 0 96px; }

    .episodes { display: grid; gap: 14px; }

    .card { position: relative; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border: 1px solid rgba(148,163,184,.16); border-radius: 16px; overflow: clip; box-shadow: 0 10px 30px var(--shadow);
    }
    .card-inner { display: grid; grid-template-columns: auto 1fr; gap: 14px; padding: 14px; align-items: center; }

    .cover { width: 64px; height: 64px; border-radius: 12px; position: relative; display: grid; place-items: center; color: #fff; font-weight: 800; letter-spacing: .02em; }
    .cover::after { content: ""; position: absolute; inset: 0; border-radius: inherit; border: 1px solid rgba(255,255,255,.2); pointer-events: none; }

    .playbtn { position: absolute; inset: 0; display: grid; place-items: center; background: linear-gradient(180deg, rgba(2,6,23,0.0), rgba(2,6,23,0.45)); opacity: 0; transition: opacity .2s ease; }
    .card:hover .playbtn { opacity: 1; }
    .playbtn .pbtn { display: inline-grid; place-items: center; width: 40px; height: 40px; border-radius: 999px; background: linear-gradient(135deg, var(--accent-1), var(--accent-2)); border: 0; box-shadow: 0 10px 20px rgba(34,211,238,.25); cursor: pointer; }

    .meta { display: flex; flex-wrap: wrap; gap: 8px 12px; align-items: center; color: var(--muted); font-size: .92rem; }
    .meta .dot { width: 6px; height: 6px; background: rgba(148,163,184,.6); border-radius: 50%; display: inline-block; }

    .title-row { display: flex; align-items: baseline; justify-content: space-between; gap: .75rem; }
    .ep-title { font-size: 1.05rem; font-weight: 700; color: var(--text-strong); margin: 2px 0 6px; letter-spacing: .01em; }
    .desc { color: #cbd5e1; margin: 0 0 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    .tags { display: flex; gap: 6px; flex-wrap: wrap; }
    .tag { font-size: .78rem; padding: .18rem .5rem; border-radius: 999px; background: rgba(148,163,184,.12); color: #cbd5e1; border: 1px solid rgba(148,163,184,.2); }

    .actions { display: flex; gap: .5rem; align-items: center; }
    .small { font-size: .9rem; color: var(--muted); }

    .progress-mini { position: absolute; left: 0; right: 0; bottom: 0; height: 3px; background: rgba(148,163,184,.18); }
    .progress-mini > i { display: block; height: 100%; background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); width: 0%; }

    /* Player */
    .player {
      position: fixed; left: 0; right: 0; bottom: 0; z-index: 50; background: linear-gradient(180deg, rgba(17,24,39,.86), rgba(2,6,23,.92));
      border-top: 1px solid rgba(148,163,184,.16); box-shadow: 0 -10px 30px var(--shadow);
    }
    .player-inner { padding: 10px 0; display: grid; grid-template-columns: 1fr auto; gap: 18px; align-items: center; }
    .np { display: grid; grid-template-columns: auto 1fr; gap: 12px; align-items: center; }
    .np .pcover { width: 52px; height: 52px; border-radius: 10px; position: relative; }
    .np .pcover::after { content: ""; position: absolute; inset: 0; border-radius: inherit; border: 1px solid rgba(255,255,255,.2); }
    .np .line1 { font-weight: 700; color: var(--text-strong); }
    .np .line2 { color: var(--muted); font-size: .9rem; }

    .controls-row { display: flex; align-items: center; gap: 10px; justify-self: end; }
    .ctl { width: 36px; height: 36px; display: inline-grid; place-items: center; border-radius: 10px; border: 1px solid rgba(148,163,184,.25); background: rgba(255,255,255,.03); color: var(--text); cursor: pointer; }
    .ctl:hover { border-color: rgba(148,163,184,.4); }
    .ctl.primary { width: 44px; height: 44px; background: linear-gradient(135deg, var(--accent-1), var(--accent-2)); border-color: transparent; box-shadow: 0 8px 22px rgba(34,211,238,.25); }

    .timeline { display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center; margin-top: 6px; color: var(--muted); font-variant-numeric: tabular-nums; }
    input[type="range"] { -webkit-appearance: none; appearance: none; background: transparent; width: 100%; height: 28px; }
    input[type="range"]::-webkit-slider-runnable-track { height: 6px; border-radius: 999px; background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); }
    input[type="range"]::-moz-range-track { height: 6px; border-radius: 999px; background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; margin-top: -6px; width: 18px; height: 18px; border-radius: 50%; background: #fff; border: 2px solid #38bdf8; box-shadow: 0 1px 6px rgba(0,0,0,.35); }
    input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; border-radius: 50%; background: #fff; border: 2px solid #38bdf8; }

    footer { color: var(--muted); padding: 22px 0 120px; text-align: center; }

    @media (max-width: 720px) {
      .card-inner { grid-template-columns: auto 1fr; }
      .np { grid-template-columns: auto 1fr; }
      .controls-inner { flex-wrap: wrap; }
      .count { order: 3; width: 100%; }
    }
  </style>
</head>
<body>
  <a href="#content" class="skip">Skip to content</a>

  <header class="hero">
    <div class="container">
      <span class="badge" aria-hidden="true">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M4 12a8 8 0 1 1 16 0"/><path d="M9 12a3 3 0 1 1 6 0v7H9z"/></svg>
        Podcast
      </span>
      <h1 class="title">Podcast Home Page</h1>
      <p class="tagline">Dive into thoughtful conversations, expert insights, and stories from creators and technologists around the world. Play episodes, search the archive, and subscribe on your favorite platform.</p>

      <div class="sub-row" role="group" aria-label="Subscribe">
        <button class="btn primary" id="btn-main-subscribe" type="button">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 20V4"/><path d="M5 12h14"/></svg>
          Subscribe
        </button>
        <a class="btn" id="btn-apple" href="#" role="button" aria-label="Subscribe on Apple Podcasts">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="#fff" d="M16.365 1.43c-.545.037-1.19.31-1.613.66-.362.3-.78.83-.958 1.27-.19.45-.269.9-.26 1.43.01.59.145 1.02.458 1.54.182.302.534.696.818.875.319.2.888.41 1.245.45.52.06 1.2-.11 1.706-.41.8-.48 1.398-1.37 1.57-2.35.048-.28.048-.86 0-1.14-.192-1.101-.95-2.03-1.94-2.44-.36-.15-.822-.24-1.026-.24-.07 0-.235.01-.3.02zM12.104 6.02c-2.13.24-4.252 1.39-5.69 3.13-1.07 1.29-1.772 2.87-2.044 4.64-.092.603-.108 1.84-.033 2.47.32 2.63 1.496 4.71 3.493 6.07.78.54 1.91 1.04 2.79 1.2.81.15 2.018.15 2.78 0 2.71-.53 4.934-2.29 6.063-4.78.396-.86.66-1.77.8-2.82.07-.54.07-1.93 0-2.46-.29-2.14-1.23-3.98-2.81-5.41-1.41-1.28-3.14-2.03-5.06-2.18-.41-.03-0.485-.03-.79-.01z"/></svg>
          Apple
        </a>
        <a class="btn" id="btn-spotify" href="#" role="button" aria-label="Subscribe on Spotify">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="#1ED760" d="M12 1.75C6.07 1.75 1.25 6.57 1.25 12.5S6.07 23.25 12 23.25 22.75 18.43 22.75 12.5 17.93 1.75 12 1.75zm5.07 15.68a.75.75 0 01-1.03.24c-2.81-1.71-6.36-2.1-10.53-1.17a.75.75 0 01-.33-1.46c4.49-.99 8.37-.56 11.46 1.3.36.22.48.69.24 1.03zm1.38-3.15a.9.9 0 01-1.24.29c-3.23-1.99-8.15-2.57-11.98-1.43a.9.9 0 11-.52-1.73c4.26-1.27 9.59-.63 13.27 1.6.43.26.57.82.28 1.27zm.1-3.28a1.05 1.05 0 01-1.45.34c-3.7-2.28-9.35-2.8-13.43-1.56a1.05 1.05 0 11-.61-2.02c4.55-1.37 10.76-.8 14.94 1.8.5.31.66.98.34 1.44z"/></svg>
          Spotify
        </a>
        <a class="btn" id="btn-rss" href="#" role="button" aria-label="Copy RSS feed">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="#f97316" d="M4 4a1.5 1.5 0 011.5-1.5c8.56 0 15.5 6.94 15.5 15.5A1.5 1.5 0 0119.5 20 1.5 1.5 0 0118 18.5C18 11.59 12.41 6 5.5 6A1.5 1.5 0 014 4zm0 7a1.5 1.5 0 011.5-1.5c5.52 0 10 4.48 10 10A1.5 1.5 0 0114 21a1.5 1.5 0 01-1.5-1.5c0-3.86-3.14-7-7-7A1.5 1.5 0 014 11zm2 10a3 3 0 110-6 3 3 0 010 6z"/></svg>
          RSS
        </a>
        <span class="small">or press <span class="kbd">/</span> to search</span>
      </div>
    </div>
  </header>

  <div class="controls" role="region" aria-label="Search and filters">
    <div class="container controls-inner">
      <div class="search" style="min-width: 220px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="11" cy="11" r="7"/><path d="m20 20-3.5-3.5"/></svg>
        <input id="search" type="text" inputmode="search" autocomplete="off" placeholder="Search episodes, topics, guests…" aria-label="Search episodes" />
        <span class="kbd" aria-hidden="true">/</span>
      </div>
      <div class="count" id="resultCount" aria-live="polite"></div>
      <div class="actions">
        <button class="btn ghost" id="sortBtn" type="button" aria-pressed="true" title="Sort newest to oldest">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M3 7h14"/><path d="M3 12h10"/><path d="M3 17h6"/></svg>
          Newest
        </button>
      </div>
    </div>
  </div>

  <main id="content" class="container">
    <section class="episodes" id="episodeList" aria-label="Episodes"></section>
    <footer>Made with care for audio. Keyboard: / search, Space play/pause, ←/→ seek.</footer>
  </main>

  <div class="player" role="region" aria-label="Now Playing">
    <div class="container player-inner">
      <div class="np">
        <div id="npCover" class="pcover" aria-hidden="true" style="background: linear-gradient(135deg, var(--accent-1), var(--accent-2));"></div>
        <div>
          <div id="npTitle" class="line1">Nothing playing</div>
          <div id="npMeta" class="line2">Select an episode to start listening</div>
        </div>
      </div>
      <div class="controls-col" style="min-width: 320px; max-width: 560px;">
        <div class="controls-row">
          <button class="ctl" id="backBtn" title="Back 15 seconds" aria-label="Back 15 seconds">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 7 9 5l2-2"/><path d="M22 12A10 10 0 1 1 12 2"/><path d="M13 13H8c0 1 1 2 2.5 2S13 14 13 13z"/></svg>
          </button>
          <button class="ctl primary" id="playPauseBtn" title="Play" aria-label="Play">
            <svg id="playIcon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
            <svg id="pauseIcon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display:none"><path d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>
          </button>
          <button class="ctl" id="fwdBtn" title="Forward 30 seconds" aria-label="Forward 30 seconds">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m13 7 2-2 2 2"/><path d="M2 12a10 10 0 1 0 10-10"/><path d="M11 13h5c0 1-1 2-2.5 2S11 14 11 13z"/></svg>
          </button>
          <button class="ctl" id="speedBtn" title="Playback speed" aria-label="Playback speed">1×</button>
          <button class="ctl" id="muteBtn" title="Mute" aria-label="Mute">
            <svg id="volIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5 6 9H2v6h4l5 4z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
            <svg id="muteIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M11 5 6 9H2v6h4l5 4z"/><path d="m22 9-6 6"/><path d="m16 9 6 6"/></svg>
          </button>
        </div>
        <div class="timeline">
          <span id="curTime">0:00</span>
          <input id="seek" type="range" min="0" max="0" step="1" value="0" aria-label="Seek" />
          <span id="dur">0:00</span>
        </div>
      </div>
    </div>
  </div>

  <audio id="audio" preload="none" crossorigin="anonymous"></audio>

  <script>
  (function() {
    const RSS_FEED_URL = 'https://example.com/podcast/rss.xml';

    const episodes = [
      {
        id: 'e12',
        title: 'Design for Deep Listening',
        date: '2026-01-12',
        duration: 48 * 60 + 16,
        description: 'We explore sound design patterns that keep listeners engaged without fatigue, from sonic branding to dynamic range for commutes.',
        tags: ['design','sound','ux'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'
      },
      {
        id: 'e11',
        title: 'AI in the Studio: Tools That Stick',
        date: '2025-12-28',
        duration: 52 * 60 + 5,
        description: 'From cleanup to mixing, where machine learning genuinely helps creators—and where it falls short.',
        tags: ['ai','workflow'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3'
      },
      {
        id: 'e10',
        title: 'The Indie Podcaster Playbook',
        date: '2025-12-12',
        duration: 41 * 60 + 42,
        description: 'Gear, growth, and grit. A candid chat about sustaining an indie show while keeping a healthy creative rhythm.',
        tags: ['indie','growth','gear'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3'
      },
      {
        id: 'e09',
        title: 'Capturing Authentic Conversations',
        date: '2025-11-22',
        duration: 45 * 60 + 12,
        description: 'Techniques for interviews that feel natural, with tips on prep, presence, and pacing.',
        tags: ['interview','technique'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3'
      },
      {
        id: 'e08',
        title: 'Editing That Feels Invisible',
        date: '2025-11-07',
        duration: 39 * 60 + 8,
        description: 'Cut with intention. We unpack editing decisions that improve clarity while preserving voice and authenticity.',
        tags: ['editing','craft'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3'
      },
      {
        id: 'e07',
        title: 'The Anatomy of a Great Intro',
        date: '2025-10-20',
        duration: 36 * 60 + 29,
        description: 'Hook, promise, and payoff. Structuring openings that earn attention and set the tone.',
        tags: ['structure','writing'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3'
      },
      {
        id: 'e06',
        title: 'Practical Room Treatment on a Budget',
        date: '2025-10-03',
        duration: 43 * 60 + 1,
        description: 'DIY acoustics and portable kits that noticeably improve recordings from any room.',
        tags: ['acoustics','gear','diy'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3'
      },
      {
        id: 'e05',
        title: 'Publishing Cadence That Works Long-Term',
        date: '2025-09-15',
        duration: 38 * 60 + 50,
        description: 'Finding a sustainable schedule and measuring like a human, not a robot.',
        tags: ['sustainability','workflow'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3'
      },
      {
        id: 'e04',
        title: 'Audience Research Without the Noise',
        date: '2025-08-31',
        duration: 44 * 60 + 5,
        description: 'Talk to real listeners, synthesize patterns, and turn insights into roadmap bets.',
        tags: ['research','growth'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3'
      },
      {
        id: 'e03',
        title: 'Field Recording: Capturing Place',
        date: '2025-08-10',
        duration: 46 * 60 + 39,
        description: 'Tech and tactics for ambient scenes, foley, and environments that transport your audience.',
        tags: ['field','sound'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3'
      },
      {
        id: 'e02',
        title: 'Remote Recording, Real Connection',
        date: '2025-07-25',
        duration: 40 * 60 + 2,
        description: 'Latency, local tracks, and rituals that make remote conversations feel face-to-face.',
        tags: ['remote','tools'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-11.mp3'
      },
      {
        id: 'e01',
        title: 'Welcome: Why Audio Still Matters',
        date: '2025-07-02',
        duration: 32 * 60 + 44,
        description: 'Setting intentions for the season and why audio remains our most intimate medium.',
        tags: ['intro','vision'],
        audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-12.mp3'
      }
    ];

    // State
    let state = {
      query: '',
      sortNewest: true,
      filtered: [],
      currentId: null,
      speedIndex: 0,
      speeds: [1, 1.25, 1.5, 1.75, 2]
    };

    // Elements
    const listEl = document.getElementById('episodeList');
    const searchEl = document.getElementById('search');
    const countEl = document.getElementById('resultCount');
    const sortBtn = document.getElementById('sortBtn');

    const audio = document.getElementById('audio');
    const npCover = document.getElementById('npCover');
    const npTitle = document.getElementById('npTitle');
    const npMeta  = document.getElementById('npMeta');
    const playBtn = document.getElementById('playPauseBtn');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const backBtn = document.getElementById('backBtn');
    const fwdBtn = document.getElementById('fwdBtn');
    const speedBtn = document.getElementById('speedBtn');
    const muteBtn = document.getElementById('muteBtn');
    const volIcon = document.getElementById('volIcon');
    const muteIcon = document.getElementById('muteIcon');
    const seek = document.getElementById('seek');
    const curTime = document.getElementById('curTime');
    const dur = document.getElementById('dur');

    // Subscribe buttons
    document.getElementById('btn-main-subscribe').addEventListener('click', openSubscribe);
    document.getElementById('btn-apple').addEventListener('click', e => { e.preventDefault(); window.open('https://podcasts.apple.com/', '_blank'); });
    document.getElementById('btn-spotify').addEventListener('click', e => { e.preventDefault(); window.open('https://open.spotify.com/show', '_blank'); });
    document.getElementById('btn-rss').addEventListener('click', async e => {
      e.preventDefault();
      try {
        await navigator.clipboard.writeText(RSS_FEED_URL);
        toast('RSS URL copied to clipboard');
      } catch {
        prompt('Copy RSS URL', RSS_FEED_URL);
      }
    });

    function openSubscribe() {
      toast('Choose a platform: Apple • Spotify • RSS');
    }

    // Utilities
    const clamp = (v, min, max) => Math.min(max, Math.max(min, v));
    function fmtTime(t) {
      const s = Math.floor(t % 60).toString().padStart(2,'0');
      const m = Math.floor(t / 60) % 60;
      const h = Math.floor(t / 3600);
      return h ? `${h}:${m.toString().padStart(2,'0')}:${s}` : `${m}:${s}`;
    }
    function fmtDate(iso) {
      const d = new Date(iso + 'T12:00:00');
      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
    }
    function coverGradientFrom(id) {
      // Simple deterministic gradient from id
      const n = Array.from(id).reduce((a,c)=>a+c.charCodeAt(0),0);
      const hues = [280, 190, 160, 200, 145, 210, 260, 310];
      const h1 = hues[n % hues.length];
      const h2 = (h1 + 60) % 360;
      return `linear-gradient(135deg, hsl(${h1} 75% 60% / .95), hsl(${h2} 80% 55% / .95))`;
    }

    function epProgressKey(id){ return `ep-progress-${id}`; }

    function getSavedTime(id) {
      const raw = localStorage.getItem(epProgressKey(id));
      return raw ? parseFloat(raw) : 0;
    }
    function saveTime(id, t) {
      try { localStorage.setItem(epProgressKey(id), String(t)); } catch {}
    }

    // Rendering
    function render() {
      const data = [...episodes];
      const q = state.query.trim().toLowerCase();
      let filtered = data.filter(e => {
        if (!q) return true;
        const hay = `${e.title} ${e.description} ${e.tags.join(' ')}`.toLowerCase();
        return hay.includes(q);
      });
      filtered.sort((a,b) => state.sortNewest ? (b.date.localeCompare(a.date)) : (a.date.localeCompare(b.date)));
      state.filtered = filtered;
      countEl.textContent = `${filtered.length} of ${episodes.length} episodes`;
      listEl.innerHTML = '';

      filtered.forEach((ep) => {
        const card = document.createElement('article');
        card.className = 'card'; card.setAttribute('data-id', ep.id); card.setAttribute('aria-label', ep.title);
        const inner = document.createElement('div'); inner.className = 'card-inner';

        // Cover
        const cover = document.createElement('div'); cover.className = 'cover'; cover.style.background = coverGradientFrom(ep.id);
        cover.innerHTML = `<span>${ep.title.split(' ').map(w=>w[0]).join('').slice(0,3).toUpperCase()}</span>`;
        const overlay = document.createElement('div'); overlay.className = 'playbtn';
        const p = document.createElement('button'); p.className = 'pbtn'; p.setAttribute('aria-label','Play episode');
        p.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>';
        overlay.appendChild(p);
        const wrap = document.createElement('div'); wrap.style.position='relative'; wrap.appendChild(cover); wrap.appendChild(overlay);

        // Content
        const content = document.createElement('div');
        const titleRow = document.createElement('div'); titleRow.className = 'title-row';
        const h = document.createElement('h3'); h.className = 'ep-title'; h.textContent = ep.title; titleRow.appendChild(h);
        const actions = document.createElement('div'); actions.className = 'actions';
        const playSm = document.createElement('button'); playSm.className = 'btn'; playSm.innerHTML = '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon fill="currentColor" points="8,5 19,12 8,19"/></svg>Play';
        actions.appendChild(playSm); titleRow.appendChild(actions);

        const meta = document.createElement('div'); meta.className = 'meta';
        meta.innerHTML = `<span>${fmtDate(ep.date)}</span><span class="dot"></span><span>${fmtTime(ep.duration)}</span>`;

        const desc = document.createElement('p'); desc.className = 'desc'; desc.textContent = ep.description;

        const tags = document.createElement('div'); tags.className = 'tags';
        ep.tags.forEach(t => { const x = document.createElement('span'); x.className = 'tag'; x.textContent = t; tags.appendChild(x); });

        content.appendChild(titleRow); content.appendChild(meta); content.appendChild(desc); content.appendChild(tags);

        inner.appendChild(wrap); inner.appendChild(content);
        card.appendChild(inner);

        const mini = document.createElement('div'); mini.className = 'progress-mini'; mini.innerHTML = '<i></i>';
        const saved = getSavedTime(ep.id); const pct = clamp((saved / ep.duration) * 100, 0, 100);
        mini.firstElementChild.style.width = pct + '%';
        card.appendChild(mini);

        // Events
        const start = () => playEpisode(ep.id);
        p.addEventListener('click', (e)=>{ e.stopPropagation(); start(); });
        playSm.addEventListener('click', (e)=>{ e.stopPropagation(); start(); });
        card.addEventListener('click', start);

        listEl.appendChild(card);
      });

      // highlight playing
      highlightCurrent();
    }

    function highlightCurrent() {
      document.querySelectorAll('.card').forEach(el => el.style.borderColor = 'rgba(148,163,184,.16)');
      if (!state.currentId) return;
      const current = document.querySelector(`.card[data-id="${state.currentId}"]`);
      if (current) current.style.borderColor = 'rgba(34,211,238,.6)';
    }

    function playEpisode(id) {
      const ep = episodes.find(e => e.id === id);
      if (!ep) return;
      // If already loaded, toggle
      if (state.currentId === id) {
        if (audio.paused) audio.play(); else audio.pause();
        return;
      }
      state.currentId = id;
      audio.src = ep.audioUrl;
      audio.playbackRate = state.speeds[state.speedIndex];
      const saved = clamp(getSavedTime(id), 0, ep.duration - 1);
      audio.currentTime = saved;
      audio.play().catch(()=>{});
      // UI
      npCover.style.background = coverGradientFrom(ep.id);
      npTitle.textContent = ep.title;
      npMeta.textContent = `${fmtDate(ep.date)} • ${fmtTime(ep.duration)}`;
      highlightCurrent();
      // Update mini progress bar for previous card immediately in next tick
      setTimeout(() => updateMiniProgress(id, saved, ep.duration), 0);
    }

    function updateMiniProgress(id, time, duration) {
      const el = document.querySelector(`.card[data-id="${id}"] .progress-mini > i`);
      if (el) el.style.width = clamp((time / duration) * 100, 0, 100) + '%';
    }

    // Search & sort
    searchEl.addEventListener('input', () => { state.query = searchEl.value; render(); });
    sortBtn.addEventListener('click', () => {
      state.sortNewest = !state.sortNewest;
      sortBtn.setAttribute('aria-pressed', String(state.sortNewest));
      sortBtn.innerHTML = state.sortNewest
        ? '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7h14"/><path d="M3 12h10"/><path d="M3 17h6"/></svg>Newest'
        : '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7h6"/><path d="M3 12h10"/><path d="M3 17h14"/></svg>Oldest';
      render();
    });

    // Player controls
    playBtn.addEventListener('click', () => { if (!state.currentId) { if (state.filtered.length) playEpisode(state.filtered[0].id); return; } audio.paused ? audio.play() : audio.pause(); });
    backBtn.addEventListener('click', () => { audio.currentTime = clamp(audio.currentTime - 15, 0, audio.duration || 0); });
    fwdBtn.addEventListener('click', () => { const d = audio.duration || 0; audio.currentTime = clamp(audio.currentTime + 30, 0, d); });
    speedBtn.addEventListener('click', () => {
      state.speedIndex = (state.speedIndex + 1) % state.speeds.length;
      audio.playbackRate = state.speeds[state.speedIndex];
      speedBtn.textContent = state.speeds[state.speedIndex].toFixed(2).replace(/\.00$/, '') + '×';
    });
    muteBtn.addEventListener('click', () => {
      audio.muted = !audio.muted;
      volIcon.style.display = audio.muted ? 'none' : '';
      muteIcon.style.display = audio.muted ? '' : 'none';
      muteBtn.setAttribute('aria-label', audio.muted ? 'Unmute' : 'Mute');
    });

    seek.addEventListener('input', () => {
      if (audio.duration) audio.currentTime = Number(seek.value);
    });

    audio.addEventListener('loadedmetadata', () => {
      dur.textContent = fmtTime(audio.duration || 0);
      seek.max = Math.floor(audio.duration || 0);
    });

    let lastSaveAt = 0;
    audio.addEventListener('timeupdate', () => {
      curTime.textContent = fmtTime(audio.currentTime);
      if (!isNaN(seek.max)) seek.value = Math.floor(audio.currentTime);
      const ep = episodes.find(e => e.id === state.currentId);
      if (ep) {
        updateMiniProgress(ep.id, audio.currentTime, ep.duration);
        const now = Date.now();
        if (now - lastSaveAt > 1000) { // throttle saves
          saveTime(ep.id, audio.currentTime);
          lastSaveAt = now;
        }
      }
    });

    audio.addEventListener('play', () => {
      playIcon.style.display = 'none'; pauseIcon.style.display = '';
      playBtn.setAttribute('title','Pause'); playBtn.setAttribute('aria-label','Pause');
    });
    audio.addEventListener('pause', () => {
      playIcon.style.display = ''; pauseIcon.style.display = 'none';
      playBtn.setAttribute('title','Play'); playBtn.setAttribute('aria-label','Play');
    });
    audio.addEventListener('ended', () => {
      // Auto-advance to next filtered
      const idx = state.filtered.findIndex(e => e.id === state.currentId);
      const next = state.filtered[idx + 1];
      if (next) playEpisode(next.id);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      const tag = (e.target && e.target.tagName) || '';
      const isTyping = ['INPUT','TEXTAREA'].includes(tag);
      if (e.key === '/' && !isTyping) { e.preventDefault(); searchEl.focus(); return; }
      if (e.code === 'Space' && !isTyping) { e.preventDefault(); if (!state.currentId && state.filtered.length) playEpisode(state.filtered[0].id); else audio.paused ? audio.play() : audio.pause(); }
      if (e.key === 'ArrowLeft' && !isTyping) { e.preventDefault(); audio.currentTime = clamp(audio.currentTime - 5, 0, audio.duration||0); }
      if (e.key === 'ArrowRight' && !isTyping) { e.preventDefault(); const d = audio.duration||0; audio.currentTime = clamp(audio.currentTime + 5, 0, d); }
      if (e.key.toLowerCase() === 'k' && !isTyping) { e.preventDefault(); audio.paused ? audio.play() : audio.pause(); }
      if (e.key.toLowerCase() === 'j' && !isTyping) { e.preventDefault(); audio.currentTime = clamp(audio.currentTime - 10, 0, audio.duration||0); }
      if (e.key.toLowerCase() === 'l' && !isTyping) { e.preventDefault(); const d = audio.duration||0; audio.currentTime = clamp(audio.currentTime + 10, 0, d); }
    });

    // Toast
    let toastTimer; const toastEl = document.createElement('div');
    toastEl.setAttribute('role','status'); toastEl.style.position='fixed'; toastEl.style.left='50%'; toastEl.style.bottom='86px'; toastEl.style.transform='translateX(-50%)'; toastEl.style.zIndex='60';
    toastEl.style.padding='10px 14px'; toastEl.style.background='rgba(17,24,39,.92)'; toastEl.style.border='1px solid rgba(148,163,184,.35)'; toastEl.style.borderRadius='10px'; toastEl.style.boxShadow='0 10px 30px rgba(0,0,0,.45)'; toastEl.style.display='none';
    document.body.appendChild(toastEl);
    function toast(msg){
      toastEl.textContent = msg; toastEl.style.display='block';
      clearTimeout(toastTimer); toastTimer = setTimeout(()=> toastEl.style.display='none', 1800);
    }

    // Initial render
    state.filtered = episodes.slice();
    state.filtered.sort((a,b)=> b.date.localeCompare(a.date));
    speedBtn.textContent = state.speeds[state.speedIndex] + '×';
    render();
  })();
  </script>
</body>
</html>
