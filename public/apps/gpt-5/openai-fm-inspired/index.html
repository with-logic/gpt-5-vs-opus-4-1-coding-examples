<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenAI.fm ‚Äî Inspired ‚Ä¢ Concept Player</title>
  <meta name="description" content="A concept, single‚Äëfile podcast player inspired by OpenAI.fm ‚Äî with transcripts, chapters, search, and a reactive audio visualizer.">
  <meta name="color-scheme" content="dark light">
  <meta property="og:title" content="OpenAI.fm ‚Äî Inspired" />
  <meta property="og:description" content="A concept, single‚Äëfile podcast player inspired by OpenAI.fm ‚Äî with transcripts, chapters, search, and a reactive audio visualizer." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#111318" />
  <style>
    /*
      OpenAI.fm ‚Äî Inspired (single-file)
      - No external CSS files; everything inline
      - Optional JS libraries may load from CDNs, but this file stands alone
      - Focus: elegant UI, accessibility, performance, and fun details
    */

    :root{
      --bg: #0b0e12;
      --panel: rgba(255,255,255,0.06);
      --panel-2: rgba(255,255,255,0.04);
      --border: rgba(255,255,255,0.12);
      --text: #e6edf3;
      --muted: #b8c2cc;
      --muted-2: #94a3b8;
      --accent: #7c9cf7;
      --accent-2: #98f5e1;
      --good: #2bd576;
      --warn: #ffcc66;
      --danger: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
      --radius-sm: 10px;
      --radius-xs: 8px;
    }

    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text); background: var(--bg);
      overflow-x:hidden; 
    }

    /* Subtle animated gradient + starry glow backdrop */
    .bg-wrap{position:fixed; inset:0; z-index:-2;}
    .gradient{position:absolute; inset:-20% -10%; filter: blur(60px); opacity:.55; background:
      radial-gradient(50% 40% at 15% 10%, #7c9cf733 0%, transparent 60%),
      radial-gradient(50% 40% at 85% 20%, #98f5e133 0%, transparent 60%),
      radial-gradient(60% 60% at 70% 70%, #a78bfa33 0%, transparent 60%),
      radial-gradient(50% 60% at 30% 80%, #fca5a533 0%, transparent 60%);
      animation: drift 30s linear infinite alternate; mix-blend-mode: screen;
    }
    @keyframes drift{from{transform:translate3d(-1%,0,0) scale(1.05)}to{transform:translate3d(1%,0,0) scale(1.08)}}

    /* Canvas: particle constellations */
    #bg-canvas{position:fixed; inset:0; z-index:-1; opacity:.55}

    /* Layout */
    .container{width:min(1200px, 90vw); margin-inline:auto}
    .grid{display:grid; gap:18px}
    .hero{padding:56px 0 24px;}
    .hero-inner{display:grid; grid-template-columns: 1.2fr .8fr; gap:28px; align-items:center}
    @media (max-width: 920px){ .hero-inner{grid-template-columns:1fr; gap:10px} }

    .glass{background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow)}
    .glass-sm{background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid var(--border); border-radius: var(--radius-sm); box-shadow: var(--shadow)}
    .pill{border:1px solid var(--border); background:rgba(255,255,255,.06); border-radius:999px; padding:6px 10px}
    .muted{color:var(--muted)}
    .muter{color:var(--muted-2)}
    .accent{color:var(--accent)}

    /* Header */
    header{position:sticky; top:0; z-index:30; backdrop-filter:saturate(140%) blur(10px); background:linear-gradient(180deg, rgba(11,14,18,0.8), rgba(11,14,18,0.3) 60%, rgba(11,14,18,0)); border-bottom:1px solid var(--border)}
    .nav{display:flex; align-items:center; justify-content:space-between; padding:14px 0}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{width:34px; height:34px; border-radius:10px; background:conic-gradient(from 210deg, #98f5e1, #7c9cf7, #a78bfa, #98f5e1); box-shadow:0 8px 30px #7c9cf755}
    .wordmark{font-weight:700; letter-spacing:0.2px}
    nav a{color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px}
    nav a:hover{color:var(--text); background-color:rgba(255,255,255,.06)}

    /* Buttons */
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid var(--border); color:var(--text); background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04)); cursor:pointer; user-select:none}
    .btn:hover{background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06))}
    .btn.primary{border-color:transparent; background:linear-gradient(90deg, #7c9cf7, #98f5e1); color:#0b0e12; font-weight:700}
    .btn.ghost{background:transparent}
    .btn.small{padding:8px 10px; border-radius:10px}

    /* Hero */
    .sup{display:inline-flex; gap:8px; align-items:center}
    .spark{width:8px; height:8px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #fff, #7c9cf7 60%, transparent 70%); box-shadow:0 0 24px #7c9cf7}
    h1{font-size: clamp(36px, 4.2vw, 64px); line-height:1.05; margin:10px 0 12px; letter-spacing:-.5px}
    .lede{font-size: clamp(16px, 1.6vw, 18px); color:var(--muted); max-width:55ch}

    .orb{aspect-ratio:1/1; min-height:300px; border-radius: 24px; position:relative; overflow:hidden}
    .orb::before{content:""; position:absolute; inset:-20%; background: radial-gradient(closest-side, #98f5e1 10%, #7c9cf7 25%, #a78bfa 40%, transparent 60%); filter:blur(40px); animation:orb 12s ease-in-out infinite alternate}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:18px}
    .orb::after{content:""; position:absolute; inset:0; background: radial-gradient(40% 40% at 60% 60%, rgba(255,255,255,.18), transparent 50%); mix-blend-mode: screen; opacity:.5}

    /* Search + tags */
    .tools{display:flex; gap:12px; align-items:center; justify-content:space-between; margin:24px 0}
    .search{flex:1; display:flex; align-items:center; gap:8px; padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,.05)}
    .search input{flex:1; background:transparent; border:0; outline:0; color:var(--text); font-size:15px}
    .tags{display:flex; gap:8px; flex-wrap:wrap}
    .tag{cursor:pointer}
    .tag.active{background:linear-gradient(90deg, #7c9cf7, #98f5e1); color:#0b0e12; border-color:transparent}

    /* Episode cards */
    .episodes{display:grid; grid-template-columns: repeat(12, 1fr); gap:16px}
    @media (max-width: 900px){ .episodes{grid-template-columns: repeat(6, 1fr)} }
    @media (max-width: 600px){ .episodes{grid-template-columns: repeat(4, 1fr)} }
    .card{grid-column: span 6; display:grid; grid-template-columns: 130px 1fr; gap:16px; padding:14px}
    @media (max-width: 600px){ .card{grid-column: span 12; grid-template-columns: 1fr;}}
    .cover{width: 100%; aspect-ratio:1/1; border-radius: 12px; background: #0f1218; position:relative; overflow:hidden; border:1px solid var(--border)}
    .cover .ink{position:absolute; inset:0; filter:saturate(130%) blur(0.5px); opacity:.95}
    .card h3{margin:4px 0 4px; font-size:18px}
    .meta{display:flex; gap:10px; align-items:center; color:var(--muted); font-size:13px}
    .meta .dot{width:4px; height:4px; background:var(--muted-2); border-radius:50%}
    .card .row{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
    .chip{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); color:var(--muted)}
    .chip.k{border-color:#7c9cf755; color:#7c9cf7}
    .actions{display:flex; gap:8px; align-items:center; margin-top:10px}
    .action{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px; border:1px solid var(--border); background:rgba(255,255,255,.04); cursor:pointer}
    .action:hover{background:rgba(255,255,255,.08)}
    .action[aria-pressed="true"]{border-color:#7c9cf7aa; box-shadow:0 0 0 2px #7c9cf726 inset}
    .desc{color:var(--muted); font-size:14px; margin-top:8px}

    /* Transcript */
    details.transcript{margin-top:10px}
    details.transcript > summary{cursor:pointer; list-style:none; display:flex; align-items:center; gap:8px; color:var(--muted)}
    details.transcript > summary::-webkit-details-marker{display:none}
    details.transcript .tx{margin-top:10px; line-height:1.6; color:#cbd5e1; max-height:45vh; overflow:auto; padding-right:6px}
    mark{background: linear-gradient(90deg, #7c9cf733, transparent); border-radius:4px; padding:0 2px}

    /* Sticky Player */
    .player{position:sticky; bottom:0; z-index:40; backdrop-filter:saturate(140%) blur(8px); background:linear-gradient(180deg, rgba(11,14,18,0), rgba(11,14,18,.85)); border-top:1px solid var(--border)}
    .player-inner{display:grid; grid-template-columns: 1.2fr 2fr 1fr; gap:16px; align-items:center; padding:12px 0}
    @media (max-width: 900px){ .player-inner{grid-template-columns: 1fr; gap:8px} }
    .np{display:flex; align-items:center; gap:12px}
    .np .mini{width:42px; height:42px; border-radius:8px; background:#0f1218; border:1px solid var(--border); overflow:hidden}
    .np .t{display:flex; flex-direction:column}
    .np .t .title{font-weight:600; font-size:14px}
    .np .t .sub{font-size:12px; color:var(--muted)}
    .bar{display:grid; grid-template-columns: 40px 1fr 42px; gap:10px; align-items:center}
    .seek{position:relative; height:8px; background:rgba(255,255,255,.06); border-radius:999px; border:1px solid var(--border); overflow:hidden; cursor:pointer}
    .seek .fill{position:absolute; inset:0; width:0%; background:linear-gradient(90deg, #7c9cf7, #98f5e1)}
    .seek .handle{position:absolute; top:-2px; width:14px; height:14px; border-radius:50%; background: #e6edf3; transform:translateX(-50%); box-shadow:0 4px 18px #7c9cf788; display:none}
    .seek:hover .handle{display:block}
    .controls-row{display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .kbtn{width:38px; height:38px; display:inline-grid; place-items:center; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,.05); cursor:pointer}
    .kbtn:hover{background:rgba(255,255,255,.09)}
    .kbtn.strong{border-color:transparent; background:linear-gradient(180deg, #7c9cf7 0%, #98f5e1 100%); color:#0b0e12; font-weight:800}
    .kbtn[data-active="true"]{box-shadow:0 0 0 2px #7c9cf72e inset}
    .vol{display:flex; align-items:center; gap:8px; min-width:140px}
    .range{appearance:none; width:100%; height:8px; background:rgba(255,255,255,.06); border-radius:999px; outline:none; border:1px solid var(--border)}
    .range::-webkit-slider-thumb{appearance:none; width:16px; height:16px; background:#e6edf3; border-radius:50%; box-shadow:0 4px 14px #7c9cf766}

    /* Visualizer canvas */
    #viz{grid-column: 1 / -1; height:48px; width:100%; display:block; border-radius:10px; border:1px solid var(--border); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); overflow:hidden}

    /* Shortcuts modal */
    .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.55); z-index:60}
    .modal[open]{display:grid}
    .sheet{width:min(720px, 92vw); padding:18px; border-radius:16px; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05)); border:1px solid var(--border); box-shadow:var(--shadow)}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; padding:2px 8px; border-radius:6px; border:1px solid var(--border); background:rgba(255,255,255,.06)}

    footer{margin:42px 0 90px; color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}

    /* Reduced motion friendly */
    @media (prefers-reduced-motion: reduce){
      .gradient,.orb::before{animation:none}
    }
  </style>
</head>
<body>
  <!-- Ambient background -->
  <div class="bg-wrap" aria-hidden="true">
    <div class="gradient"></div>
    <canvas id="bg-canvas"></canvas>
  </div>

  <!-- Header -->
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="wordmark">OpenAI.fm <span class="muter">‚Äî Inspired</span></div>
      </div>
      <nav>
        <a href="#episodes">Episodes</a>
        <a href="#about">About</a>
        <a href="#" id="open-shortcuts" title="Keyboard shortcuts">Shortcuts</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero container">
    <div class="hero-inner">
      <div>
        <div class="sup"><span class="spark"></span><span class="muted">Concept audio player</span></div>
        <h1>Ideas in conversation. Research in the open.</h1>
        <p class="lede">A streamlined, single‚Äëfile experience inspired by OpenAI.fm ‚Äî featuring a delightful player, searchable transcripts, chapters, and a reactive audio visualizer. Built with accessibility and performance in mind.</p>
        <div class="controls">
          <button class="btn primary" id="play-featured">‚ñ∂ Play featured</button>
          <button class="btn" id="subscribe">‚§ì Subscribe</button>
          <span class="pill">No tracking ‚Ä¢ No cookies ‚Ä¢ Just audio</span>
        </div>
      </div>
      <div class="orb glass" aria-hidden="true"></div>
    </div>
  </section>

  <!-- Tools: Search + Tags -->
  <section class="container">
    <div class="tools">
      <label class="search glass-sm" style="flex:1" for="q">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="muter" aria-hidden="true"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input id="q" placeholder="Search title, guests, or transcript‚Ä¶ (‚åò/ to focus)" autocomplete="off" />
      </label>
      <div class="tags" id="tag-bar" role="tablist" aria-label="Episode category filters">
        <button class="pill tag active" data-tag="all" role="tab" aria-selected="true">All</button>
        <button class="pill tag" data-tag="Research" role="tab">Research</button>
        <button class="pill tag" data-tag="Product" role="tab">Product</button>
        <button class="pill tag" data-tag="Policy" role="tab">Policy</button>
        <button class="pill tag" data-tag="Creativity" role="tab">Creativity</button>
      </div>
    </div>
  </section>

  <!-- Episodes -->
  <main id="episodes" class="container">
    <div id="episode-list" class="episodes" aria-live="polite"></div>
  </main>

  <!-- Player -->
  <section class="player" aria-label="Player">
    <div class="container player-inner">
      <div class="np">
        <div class="mini" id="np-cover" aria-hidden="true"></div>
        <div class="t">
          <div class="title" id="np-title">Select an episode</div>
          <div class="sub" id="np-sub">‚Äî</div>
        </div>
      </div>

      <div class="bar">
        <div class="time mono" id="t-current">0:00</div>
        <div class="seek" id="seek" aria-label="Seek" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="fill" id="seek-fill"></div>
          <div class="handle" id="seek-handle"></div>
        </div>
        <div class="time mono" id="t-total">0:00</div>
      </div>

      <div class="controls-row">
        <button class="kbtn" id="back15" title="Back 15s (‚Üê)">‚ü≤15</button>
        <button class="kbtn strong" id="toggle" title="Play / Pause (Space)">‚ñ∂Ô∏é/‚è∏</button>
        <button class="kbtn" id="fwd30" title="Forward 30s (‚Üí)">30‚ü≥</button>
        <button class="kbtn" id="loop" title="Loop">‚àû</button>
        <button class="kbtn" id="speed" title="Speed (S)"><span id="speed-val">1.0√ó</span></button>
        <div class="vol">
          <button class="kbtn" id="mute" title="Mute (M)">üîà</button>
          <input type="range" min="0" max="1" step="0.01" value="0.9" class="range" id="volume" aria-label="Volume" />
        </div>
      </div>

      <canvas id="viz" height="48"></canvas>
    </div>
    <audio id="audio" preload="metadata" crossorigin="anonymous"></audio>
  </section>

  <!-- Shortcuts modal -->
  <dialog class="modal" id="shortcuts">
    <div class="sheet">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
        <strong>Keyboard Shortcuts</strong>
        <button class="btn small" id="close-shortcuts">Close (Esc)</button>
      </div>
      <div class="grid" style="grid-template-columns: 1fr 1fr; gap:10px">
        <div><span class="kbd">Space</span> Play / Pause</div>
        <div><span class="kbd">‚Üê</span> Back 15s</div>
        <div><span class="kbd">‚Üí</span> Forward 30s</div>
        <div><span class="kbd">S</span> Cycle speed</div>
        <div><span class="kbd">M</span> Mute</div>
        <div><span class="kbd">?</span> Toggle help</div>
        <div><span class="kbd">‚åò/</span> Focus search</div>
        <div><span class="kbd">1-9</span> Jump to chapter</div>
      </div>
    </div>
  </dialog>

  <!-- About -->
  <footer class="container" id="about">
    <p><strong>About this demo</strong></p>
    <p class="muted">This single‚Äëfile app is a fan‚Äëmade concept inspired by OpenAI.fm. It is not affiliated with or endorsed by OpenAI. Audio assets are public demo files. The UI focuses on accessibility, smooth interactions, and practical features like transcripts, chapters, and a responsive visualizer ‚Äî all without frameworks.</p>
  </footer>

  <template id="episode-card">
    <article class="card glass" data-episode>
      <div class="cover">
        <canvas width="260" height="260" class="ink"></canvas>
      </div>
      <div>
        <div class="row" style="justify-content:space-between">
          <h3 class="title"></h3>
          <div class="row">
            <span class="chip k duration">‚Äî</span>
            <button class="action favorite" aria-label="Favorite">‚òÖ</button>
            <button class="action share" aria-label="Share">‚§¥Ô∏é</button>
            <a class="action download" aria-label="Download" download title="Download">‚§ì</a>
          </div>
        </div>
        <div class="meta">
          <span class="date"></span><span class="dot"></span><span class="guests"></span><span class="dot"></span><span class="tags"></span>
        </div>
        <p class="desc"></p>
        <div class="row chapters" style="margin-top:8px"></div>
        <div class="actions">
          <button class="btn play">‚ñ∂ Play</button>
          <button class="btn ghost queue">Ôºã Queue</button>
          <button class="btn ghost transcript-btn">üìù Transcript</button>
        </div>
        <details class="transcript">
          <summary>Transcript preview</summary>
          <div class="tx"></div>
        </details>
      </div>
    </article>
  </template>

  <script>
  (function(){
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const fmtTime = (s)=>{
      s = Math.max(0, Math.floor(s||0));
      const m = Math.floor(s/60), ss = s%60; return m+":"+String(ss).padStart(2,'0');
    };

    // Episode data (demo audio sources)
    const EPISODES = [
      {
        id:"ep01",
        title:"Frontier Models & Safety",
        guests:["Mira Murati","Jan Leike"],
        date:"2025-11-05",
        tags:["Research","Safety"],
        desc:"On evaluating and deploying frontier systems safely ‚Äî from red teaming to post‚Äëdeployment monitoring.",
        audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
        chapters:[
          {label:"Intro", t:0},
          {label:"Risk taxonomy", t:90},
          {label:"Evaluation", t:420},
          {label:"Q&A", t:1420}
        ],
        transcript:`Host: Welcome back to OpenAI.fm Inspired. Today we're exploring safety practices for frontier models.\n\nMira: We start with clear evaluation targets ‚Äî not just capability tests, but red‚Äëteaming with domain experts.\n\nJan: Alignment research benefits from sharing benchmarks and incidents. The question isn't if surprises happen, but how prepared we are.\n\nHost: We close with monitoring and incident response playbooks.`
      },
      {
        id:"ep02",
        title:"Scaling Laws & Emergent Behavior",
        guests:["Jared Kaplan","OpenAI Research"],
        date:"2025-09-12",
        tags:["Research"],
        desc:"What scaling still buys us, where it doesn't, and how evaluation must evolve.",
        audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
        chapters:[
          {label:"Setup", t:0},
          {label:"Data mixtures", t:120},
          {label:"Emergence", t:560},
          {label:"Limits", t:1200}
        ],
        transcript:`Host: Scaling laws offered a map of progress.\n\nGuest: But mixtures, modalities, and objective choice now matter as much as parameter count.\n\nHost: Evaluation is shifting toward tasks that reflect real human workflows.`
      },
      {
        id:"ep03",
        title:"AI + Creativity: Tools for Artists",
        guests:["Visual Artists","Musicians"],
        date:"2025-06-20",
        tags:["Creativity","Product"],
        desc:"From storyboards to sound design ‚Äî collaborating with models while preserving intent and style.",
        audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
        chapters:[
          {label:"Sketching", t:0},
          {label:"Iteration", t:240},
          {label:"Rights & credit", t:770},
          {label:"Release", t:1320}
        ],
        transcript:`Host: Artists prototype faster with AI, but control still matters.\n\nPanelist: We design tools where the human sets direction and the model refines.\n\nHost: Transparent attribution unlocks better collaboration.`
      },
      {
        id:"ep04",
        title:"Governance, Open Source & Alignment",
        guests:["Policy Researchers"],
        date:"2025-03-03",
        tags:["Policy","Research"],
        desc:"Balancing openness with responsibility ‚Äî evaluating models without enabling misuse.",
        audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3",
        chapters:[
          {label:"Context", t:0},
          {label:"Auditing", t:300},
          {label:"Openness", t:900},
          {label:"Standards", t:1500}
        ],
        transcript:`Host: Policy isn't a brake; it's a steering wheel.\n\nGuest: We need repeatable audits and tiered access, not silence.\n\nHost: Shared standards improve safety and interoperability.`
      }
    ];

    // State
    const state = {
      q:"",
      tag:"all",
      favorites:new Set(JSON.parse(localStorage.getItem('ai_fm_favs')||'[]')),
      speed: parseFloat(localStorage.getItem('ai_fm_speed')||'1') || 1,
      volume: parseFloat(localStorage.getItem('ai_fm_vol')||'0.9') || 0.9,
      loop: localStorage.getItem('ai_fm_loop')=="1",
      currentId: localStorage.getItem('ai_fm_current')||null,
      lastTime: parseFloat(localStorage.getItem('ai_fm_time')||'0')||0,
      queue: []
    };

    // DOM refs
    const list = $('#episode-list');
    const tpl = $('#episode-card');
    const q = $('#q');
    const tagBar = $('#tag-bar');

    const audio = $('#audio');
    const npTitle = $('#np-title');
    const npSub = $('#np-sub');
    const npCover = $('#np-cover');
    const btnPlayPause = $('#toggle');
    const btnBack15 = $('#back15');
    const btnFwd30 = $('#fwd30');
    const btnLoop = $('#loop');
    const btnSpeed = $('#speed');
    const speedVal = $('#speed-val');
    const btnMute = $('#mute');
    const rangeVol = $('#volume');
    const tCurrent = $('#t-current');
    const tTotal = $('#t-total');
    const seek = $('#seek');
    const seekFill = $('#seek-fill');
    const seekHandle = $('#seek-handle');
    const viz = $('#viz');
    const playFeatured = $('#play-featured');
    const openShortcuts = $('#open-shortcuts');
    const closeShortcuts = $('#close-shortcuts');
    const modalShortcuts = $('#shortcuts');

    // Paint generative covers
    function paintCover(canvas, id){
      const ctx = canvas.getContext('2d');
      const w = canvas.width, h = canvas.height; ctx.clearRect(0,0,w,h);
      const rand = (seed)=>{
        let x = Math.sin(seed*9999)*10000; return x - Math.floor(x);
      };
      const base = id.split('').reduce((a,c)=>a+c.charCodeAt(0), 0);
      const colors = [
        ['#7c9cf7','#98f5e1'],
        ['#a78bfa','#7c9cf7'],
        ['#ff99c8','#7c9cf7'],
        ['#98f5e1','#f8f7a1']
      ];
      const pair = colors[base % colors.length];
      const grad = ctx.createLinearGradient(0,0,w,h);
      grad.addColorStop(0, pair[0]); grad.addColorStop(1, pair[1]);
      ctx.fillStyle = grad; ctx.fillRect(0,0,w,h);
      ctx.globalCompositeOperation='overlay';
      for(let i=0;i<22;i++){
        ctx.beginPath();
        const r = 10 + (rand(base+i)*70);
        const x = rand(base+i*2)*w, y = rand(base+i*3)*h;
        ctx.fillStyle = `rgba(255,255,255,${0.08+rand(base+i)*0.2})`;
        ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
      }
      ctx.globalCompositeOperation='lighter';
      for(let i=0;i<12;i++){
        ctx.beginPath();
        ctx.strokeStyle = `rgba(255,255,255,${0.06+rand(base+i)*0.25})`;
        ctx.lineWidth = 1.2;
        ctx.moveTo(rand(base+i)*w, rand(base+i*11)*h);
        ctx.bezierCurveTo(rand(base+i*2)*w, rand(base+i*4)*h, rand(base+i*3)*w, rand(base+i*5)*h, rand(base+i*7)*w, rand(base+i*13)*h);
        ctx.stroke();
      }
    }

    // Render episode cards
    function render(){
      list.innerHTML = '';
      const text = state.q.trim().toLowerCase();
      const activeTag = state.tag.toLowerCase();
      let items = EPISODES.filter(e=>{
        const matchTag = activeTag==='all' || e.tags.some(t=>t.toLowerCase()===activeTag);
        if(!matchTag) return false;
        if(!text) return true;
        return (
          e.title.toLowerCase().includes(text) ||
          e.guests.join(' ').toLowerCase().includes(text) ||
          e.transcript.toLowerCase().includes(text)
        );
      });
      if(items.length===0){ list.innerHTML = `<div class=\"glass\" style=\"grid-column:1/-1; padding:18px\">No matches. Try different keywords or filters.</div>`; return; }
      items.forEach(e=>{
        const node = tpl.content.firstElementChild.cloneNode(true);
        node.dataset.id = e.id;
        node.querySelector('.title').textContent = e.title;
        node.querySelector('.date').textContent = new Date(e.date).toLocaleDateString(undefined,{year:'numeric', month:'short', day:'2-digit'});
        node.querySelector('.guests').textContent = e.guests.join(', ');
        node.querySelector('.tags').textContent = e.tags.join(' ‚Ä¢ ');
        node.querySelector('.desc').textContent = e.desc;
        const cover = node.querySelector('canvas.ink');
        paintCover(cover, e.id);
        node.querySelector('.download').href = e.audio;
        const favBtn = node.querySelector('.favorite');
        favBtn.setAttribute('aria-pressed', state.favorites.has(e.id));
        favBtn.addEventListener('click',()=>{toggleFavorite(e.id, favBtn)});
        node.querySelector('.share').addEventListener('click',()=>shareEpisode(e));
        node.querySelector('.play').addEventListener('click',()=>playEpisode(e.id));
        node.querySelector('.queue').addEventListener('click',()=>enqueue(e.id));
        const chapWrap = node.querySelector('.chapters');
        e.chapters.forEach((c,i)=>{
          const b = document.createElement('button'); b.className='chip'; b.textContent = `${i+1}. ${c.label}`; b.title = `Jump to ${fmtTime(c.t)}`;
          b.addEventListener('click',()=>{ playEpisode(e.id, c.t); }); chapWrap.appendChild(b);
        });
        const det = node.querySelector('details.transcript');
        const tx = node.querySelector('.tx'); tx.innerHTML = highlighter(e.transcript, text);
        node.querySelector('.transcript-btn').addEventListener('click',()=>det.open = !det.open);
        list.appendChild(node);
        // duration will be filled asynchronously once metadata is known
        ensureDuration(e).then(d=>{ node.querySelector('.duration').textContent = fmtTime(d); });
      });
    }

    function highlighter(text, query){
      if(!query) return text.replace(/\n/g,'<br/>');
      const rx = new RegExp('('+query.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&')+')','ig');
      return text.replace(rx,'<mark>$1</mark>').replace(/\n/g,'<br/>');
    }

    function toggleFavorite(id, btn){
      if(state.favorites.has(id)) state.favorites.delete(id); else state.favorites.add(id);
      btn.setAttribute('aria-pressed', state.favorites.has(id));
      localStorage.setItem('ai_fm_favs', JSON.stringify([...state.favorites]));
    }

    function shareEpisode(e){
      const url = new URL(location.href); url.hash = `#ep=${e.id}`;
      const text = `${e.title} ‚Äî OpenAI.fm Inspired`;
      if(navigator.share){ navigator.share({title:text, text:e.desc, url:String(url)}).catch(()=>{}); }
      else{ navigator.clipboard.writeText(String(url)).then(()=>flash(`Link copied`)); }
    }

    function flash(msg){
      const el = document.createElement('div'); el.textContent = msg;
      el.style.cssText = 'position:fixed;left:50%;top:20px;transform:translateX(-50%);background:rgba(255,255,255,.08);border:1px solid var(--border);padding:8px 12px;border-radius:10px;backdrop-filter:blur(8px);z-index:80';
      document.body.appendChild(el); setTimeout(()=>el.remove(), 1200);
    }

    // Audio plumbing
    let audioReady = false, context, analyser, sourceNode, dataArray;
    const resumeContext = async ()=>{
      if(context) return; try{
        context = new (window.AudioContext||window.webkitAudioContext)();
        sourceNode = context.createMediaElementSource(audio);
        analyser = context.createAnalyser(); analyser.fftSize = 256; analyser.smoothingTimeConstant = 0.85; dataArray = new Uint8Array(analyser.frequencyBinCount);
        sourceNode.connect(analyser); analyser.connect(context.destination);
      }catch(err){ console.warn('WebAudio not available', err); }
    };

    function episodeById(id){ return EPISODES.find(e=>e.id===id); }

    function linkEpisode(e){
      audio.src = e.audio; audio.loop = state.loop; audio.playbackRate = state.speed; audio.volume = state.volume; audio.preload = 'metadata';
      npTitle.textContent = e.title; npSub.textContent = `${e.guests.join(', ')} ‚Ä¢ ${new Date(e.date).toLocaleDateString()}`;
      // paint mini cover
      const c = document.createElement('canvas'); c.width=84; c.height=84; paintCover(c, e.id); npCover.innerHTML=''; npCover.appendChild(c);
      document.title = `${e.title} ‚Äî OpenAI.fm Inspired`;
      localStorage.setItem('ai_fm_current', e.id);
    }

    async function playEpisode(id, startAt){
      const e = episodeById(id) || EPISODES[0]; linkEpisode(e);
      if(!context && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) await resumeContext();
      await audio.play().catch(()=>{});
      if(typeof startAt==='number') audio.currentTime = startAt;
      history.replaceState({}, '', `#ep=${e.id}`);
    }

    function enqueue(id){ state.queue.push(id); flash('Queued'); }

    function nextInQueue(){
      const nxt = state.queue.shift(); if(nxt){ playEpisode(nxt); return true; }
      const current = state.currentId || EPISODES[0].id;
      const idx = EPISODES.findIndex(e=>e.id===current);
      const auto = EPISODES[(idx+1)%EPISODES.length]; if(auto){ playEpisode(auto.id); return true; }
      return false;
    }

    function ensureDuration(e){
      return new Promise(res=>{
        const probe = new Audio(); probe.preload='metadata'; probe.src=e.audio; 
        const done=()=>{ probe.remove(); res(isFinite(probe.duration)?probe.duration:0); };
        probe.addEventListener('loadedmetadata',done); probe.addEventListener('error',done);
      });
    }

    // Player events
    audio.addEventListener('loadedmetadata',()=>{
      tTotal.textContent = fmtTime(audio.duration);
      if(state.currentId && Math.abs(state.lastTime) > 1 && audio.src.includes(state.currentId)){
        // no-op safeguard; we restore time on canplay
      }
    });
    audio.addEventListener('canplay',()=>{
      if(state.currentId && Math.abs(state.lastTime) > 1){
        audio.currentTime = state.lastTime; state.lastTime = 0; localStorage.removeItem('ai_fm_time');
      }
    });
    audio.addEventListener('timeupdate',()=>{
      tCurrent.textContent = fmtTime(audio.currentTime);
      tTotal.textContent = isFinite(audio.duration)?fmtTime(audio.duration):'0:00';
      const p = (audio.currentTime/(audio.duration||1))*100; seekFill.style.width = p+'%'; seek.setAttribute('aria-valuenow', Math.round(p)); seekHandle.style.left = p+'%';
      const id = state.currentId = (new URL(audio.src)).hash?.slice(1) || localStorage.getItem('ai_fm_current') || '';
      localStorage.setItem('ai_fm_time', String(audio.currentTime));
    });
    audio.addEventListener('ended',()=>{ if(!state.loop) nextInQueue(); });
    audio.addEventListener('play',()=>{ btnPlayPause.textContent='‚è∏'; drawViz(); });
    audio.addEventListener('pause',()=>{ btnPlayPause.textContent='‚ñ∂Ô∏é'; });

    // Controls
    btnPlayPause.addEventListener('click', async ()=>{
      if(audio.paused){ await resumeContext(); audio.play(); } else { audio.pause(); }
    });
    btnBack15.addEventListener('click',()=> audio.currentTime = Math.max(0, audio.currentTime - 15));
    btnFwd30.addEventListener('click',()=> audio.currentTime = Math.min((audio.duration||1)-1, audio.currentTime + 30));
    btnLoop.addEventListener('click',()=>{ state.loop=!state.loop; audio.loop=state.loop; btnLoop.dataset.active=state.loop; localStorage.setItem('ai_fm_loop', state.loop?'1':'0');});
    const speeds=[0.8,1,1.15,1.25,1.5,1.75,2];
    function setSpeed(v){ state.speed=v; audio.playbackRate=v; speedVal.textContent=v.toFixed(2).replace(/\.00$/,'')+'√ó'; localStorage.setItem('ai_fm_speed', String(v)); }
    setSpeed(state.speed);
    btnSpeed.addEventListener('click',()=>{ const i=(speeds.indexOf(state.speed)+1)%speeds.length; setSpeed(speeds[i]); });
    btnMute.addEventListener('click',()=>{ audio.muted=!audio.muted; btnMute.textContent = audio.muted?'üîá':'üîà'; });
    rangeVol.value = state.volume; audio.volume = state.volume;
    rangeVol.addEventListener('input',()=>{ state.volume=parseFloat(rangeVol.value); audio.volume=state.volume; localStorage.setItem('ai_fm_vol', String(state.volume)); });

    // Seek interaction
    function setSeekFromClientX(clientX){
      const rect = seek.getBoundingClientRect();
      const r = Math.min(1, Math.max(0, (clientX - rect.left)/rect.width));
      audio.currentTime = r * (audio.duration||1);
    }
    seek.addEventListener('pointerdown',(e)=>{ seek.setPointerCapture(e.pointerId); setSeekFromClientX(e.clientX); });
    seek.addEventListener('pointermove',(e)=>{ if(e.pressure>0) setSeekFromClientX(e.clientX); });

    // Search + tags
    q.addEventListener('input',()=>{ state.q=q.value; render(); });
    document.addEventListener('keydown',(e)=>{
      if((e.metaKey||e.ctrlKey) && e.key==='/'){ e.preventDefault(); q.focus(); }
      if(e.key==='?' && !e.shiftKey===false){ toggleShortcuts(); }
      if(e.key===' ' && document.activeElement.tagName!=='INPUT' && document.activeElement.tagName!=='TEXTAREA'){ e.preventDefault(); btnPlayPause.click(); }
      if(e.key==='ArrowLeft'){ e.preventDefault(); btnBack15.click(); }
      if(e.key==='ArrowRight'){ e.preventDefault(); btnFwd30.click(); }
      if(e.key.toLowerCase()==='s'){ e.preventDefault(); btnSpeed.click(); }
      if(e.key.toLowerCase()==='m'){ e.preventDefault(); btnMute.click(); }
      // Chapters 1..9
      if(/^[1-9]$/.test(e.key)){
        const ep = EPISODES.find(x=> audio.src.includes(x.audio.slice(-16)) ) || EPISODES[0];
        const idx = parseInt(e.key,10)-1; const ch = ep?.chapters[idx]; if(ch){ audio.currentTime = ch.t; }
      }
    });
    tagBar.addEventListener('click', (e)=>{
      const b = e.target.closest('.tag'); if(!b) return; $$('.tag', tagBar).forEach(x=>x.classList.remove('active')); b.classList.add('active');
      state.tag = b.dataset.tag; render();
    });

    // Subscribe button (display quick sheet)
    $('#subscribe').addEventListener('click',()=>{
      const sheet = document.createElement('div');
      sheet.className='sheet'; sheet.style.position='fixed'; sheet.style.inset='auto 0 0 0'; sheet.style.margin='auto'; sheet.style.maxWidth='520px'; sheet.style.zIndex='70';
      sheet.innerHTML = `<div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px\"><strong>Subscribe</strong><button class=\"btn small\">Close</button></div>
        <div class=\"grid\" style=\"grid-template-columns:1fr 1fr; gap:10px\">
          <a class=\"btn\" href=\"#\" onclick=\"return false\">RSS</a>
          <a class=\"btn\" href=\"#\" onclick=\"return false\">Apple Podcasts</a>
          <a class=\"btn\" href=\"#\" onclick=\"return false\">Spotify</a>
          <a class=\"btn\" href=\"#\" onclick=\"return false\">YouTube</a>
        </div>`;
      const close = sheet.querySelector('button'); close.addEventListener('click',()=>sheet.remove());
      document.body.appendChild(sheet);
      setTimeout(()=>{sheet.style.transform='translateY(0)';},0);
    });

    // Modal helpers
    function toggleShortcuts(){ if(modalShortcuts.open) modalShortcuts.close(); else modalShortcuts.showModal(); }
    openShortcuts.addEventListener('click',(e)=>{ e.preventDefault(); toggleShortcuts(); });
    closeShortcuts.addEventListener('click',()=> modalShortcuts.close());
    modalShortcuts.addEventListener('click',(e)=>{ if(e.target===modalShortcuts) modalShortcuts.close(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && modalShortcuts.open) modalShortcuts.close(); });

    // Featured button
    playFeatured.addEventListener('click',()=> playEpisode(EPISODES[0].id));

    // Initial render
    render();

    // Deep-link (#ep=...)
    const hashId = new URL(location.href).hash.match(/ep=([a-z0-9]+)/i)?.[1];
    if(hashId){ playEpisode(hashId); }
    else if(state.currentId){ // warm resume
      const e = episodeById(state.currentId); if(e){ linkEpisode(e); }
    }

    // Background Constellation Canvas
    const bg = $('#bg-canvas'); const bctx = bg.getContext('2d');
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1));
    function resizeBG(){ bg.width = innerWidth*DPR; bg.height = innerHeight*DPR; }
    resizeBG(); addEventListener('resize', resizeBG);
    const N = 70; const nodes = Array.from({length:N}).map(()=>({
      x: Math.random()*bg.width, y: Math.random()*bg.height, vx:(Math.random()-.5)*0.15, vy:(Math.random()-.5)*0.15
    }));
    function stepBG(){
      if(window.matchMedia('(prefers-reduced-motion: reduce)').matches){ return; }
      bctx.clearRect(0,0,bg.width,bg.height); bctx.fillStyle='rgba(255,255,255,0.5)';
      for(const n of nodes){ n.x+=n.vx; n.y+=n.vy; if(n.x<0||n.x>bg.width) n.vx*=-1; if(n.y<0||n.y>bg.height) n.vy*=-1; }
      // links
      for(let i=0;i<N;i++){
        for(let j=i+1;j<N;j++){
          const a=nodes[i], b=nodes[j]; const dx=a.x-b.x, dy=a.y-b.y; const d= Math.hypot(dx,dy);
          if(d<160*DPR){
            const o = (1 - d/(160*DPR))*0.45; bctx.strokeStyle=`rgba(151,182,255,${o})`; bctx.lineWidth=1; bctx.beginPath(); bctx.moveTo(a.x,a.y); bctx.lineTo(b.x,b.y); bctx.stroke();
          }
        }
      }
      // stars
      nodes.forEach(n=>{ bctx.globalAlpha=.8; bctx.fillStyle='#aab4ff'; bctx.beginPath(); bctx.arc(n.x,n.y, 0.8*DPR, 0, Math.PI*2); bctx.fill(); });
      requestAnimationFrame(stepBG);
    }
    stepBG();

    // Visualizer drawing
    const vctx = viz.getContext('2d');
    function drawViz(){
      if(!analyser){ // CSS shimmer fallback
        vctx.clearRect(0,0,viz.width,viz.height); return; }
      const W = viz.clientWidth, H = viz.clientHeight; if(viz.width!==W) viz.width=W; if(viz.height!==H) viz.height=H;
      const bars = 48; const step = Math.floor(analyser.frequencyBinCount / bars);
      function frame(){
        if(audio.paused){ return; }
        analyser.getByteFrequencyData(dataArray);
        vctx.clearRect(0,0,W,H);
        for(let i=0;i<bars;i++){
          const v = dataArray[i*step]/255; const h = Math.max(2, v * (H-6));
          const x = (W/bars)*i + 4; const w = (W/bars) - 8;
          const g = vctx.createLinearGradient(x, H-h, x, H);
          g.addColorStop(0, '#98f5e1'); g.addColorStop(1, '#7c9cf7');
          vctx.fillStyle = g; vctx.fillRect(x, H-h, w, h);
        }
        requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    // Accessibility: announce focused areas
    document.addEventListener('focusin',(e)=>{
      if(e.target===q) q.setAttribute('aria-live','polite');
    });

  })();
  </script>
</body>
</html>
