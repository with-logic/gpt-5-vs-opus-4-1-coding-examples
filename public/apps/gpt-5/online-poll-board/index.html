<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Online Poll Board</title>
  <meta name="description" content="Vote on trending topics â€“ delightful, single-file poll board with animated results." />
  <style>
    :root{
      --bg: #f7fbff;
      --bg-accent: #eef6ff;
      --ink: #102a43;
      --muted: #6b7c93;
      --brand: #5b8def;
      --brand-2: #8ec5ff;
      --ok: #14b8a6;
      --warn: #f59e0b;
      --hot: #ef5b78;
      --card: #ffffff;
      --shadow: 0 10px 30px rgba(16,42,67,.08), 0 2px 6px rgba(16,42,67,.05);
      --radius: 16px;
      --radius-sm: 12px;
      --focus: 0 0 0 3px rgba(91,141,239,.35);
    }

    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at -10% -10%, #e9f6ff 0%, transparent 60%),
        radial-gradient(900px 500px at 110% 0%, #fff1f7 0%, transparent 55%),
        radial-gradient(900px 500px at 10% 100%, #f0fff9 0%, transparent 55%),
        var(--bg);
      background-attachment: fixed;
    }

    .app{
      max-width: 1100px; margin: 0 auto; padding: 32px 20px 48px;
    }

    .header{
      display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap;
    }
    .title{
      display:flex; align-items:center; gap:16px;
    }
    .logo{
      width:48px; height:48px; border-radius:14px; background: conic-gradient(from 180deg at 50% 50%, var(--brand), var(--brand-2), #7ee3d0, #ffd4a3, var(--hot), var(--brand));
      position:relative; box-shadow: var(--shadow);
    }
    .logo::after{
      content:""; position:absolute; inset:4px; border-radius:11px; background: linear-gradient(180deg,#fff,rgba(255,255,255,.6));
    }
    h1{ margin:0; font-weight:800; letter-spacing:-.02em; font-size: clamp(28px, 3.2vw, 40px); }
    .subtitle{ color: var(--muted); margin-top:4px; }

    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .chip{
      border:1px solid #dfe7f5; background:#fff; padding:10px 14px; border-radius:999px; cursor:pointer; transition:.2s ease; color:#334e68; font-weight:600;
    }
    .chip[aria-pressed="true"], .chip:hover{ box-shadow: var(--shadow); transform: translateY(-1px); border-color:#bfd6ff; }

    .search{
      position:relative; flex:1 1 260px; min-width:260px;
    }
    .search input{
      width:100%; padding:12px 14px 12px 40px; border-radius:999px; border:1px solid #dfe7f5; outline:none; background:#fff; transition:border .2s ease, box-shadow .2s ease; font-size:15px;
    }
    .search input:focus{ border-color:#bfd6ff; box-shadow: var(--focus); }
    .search svg{ position:absolute; left:12px; top:50%; transform:translateY(-50%); stroke:#7b8794; }

    .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:18px; margin-top:18px; }

    .card{
      background: linear-gradient(180deg, #ffffffcc, #ffffff); backdrop-filter: blur(6px);
      border:1px solid #e8eef8; border-radius: var(--radius); padding:18px 18px 16px; box-shadow: var(--shadow); position:relative; overflow:hidden;
    }
    .cat{ font-size:12px; font-weight:700; letter-spacing:.08em; color:#5b8def; text-transform:uppercase; background:#eef4ff; padding:6px 10px; border-radius:999px; display:inline-block; }
    .q{ font-size:18px; font-weight:800; margin:10px 0 14px; letter-spacing:-.02em; }

    .options{ display:flex; flex-direction:column; gap:10px; }
    .option-btn{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 14px; border-radius:12px; border:1px solid #e6eef8; background:#fff; cursor:pointer; font-weight:700; transition:.2s ease; color:#1f2937;
    }
    .option-btn:hover{ transform: translateY(-1px); box-shadow: var(--shadow); border-color:#cfe0ff; }
    .option-btn:active{ transform: translateY(0); }

    .meta{ display:flex; align-items:center; justify-content:space-between; margin-top:12px; color:#5a6b7b; font-size:13px; }
    .meta .view-results{ color:#365eeb; cursor:pointer; font-weight:700; }

    .results{ display:flex; flex-direction:column; gap:10px; }
    .bar{ position:relative; background:#f1f6ff; border-radius:12px; border:1px solid #e0e8f8; overflow:hidden; }
    .bar > .fill{ height:44px; width:0%; background: linear-gradient(90deg, #5b8def, #7fd3ff); transition:width .8s cubic-bezier(.2,.8,.2,1); }
    .bar .row{ position:absolute; inset:0; display:flex; align-items:center; justify-content:space-between; padding:0 12px; font-weight:700; color:#102a43; }
    .bar[data-hot="true"] > .fill{ background: linear-gradient(90deg, #ef5b78, #ff9fb2); }

    .tag{ padding:6px 10px; border-radius:999px; background:#eef7f6; color:#0f766e; font-weight:700; font-size:12px; }

    .footer{ margin-top:26px; display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; color:#546a7b; font-size:14px; }
    .btn{
      border:none; background: linear-gradient(180deg, #5b8def, #4f79e6);
      color:#fff; padding:10px 14px; border-radius:12px; font-weight:800; letter-spacing:.02em; cursor:pointer; box-shadow: var(--shadow); transition: transform .12s ease, box-shadow .2s ease; }
    .btn:hover{ transform: translateY(-1px); }
    .btn:focus{ outline:none; box-shadow: var(--focus); }
    .btn.secondary{ background:#ffffff; border:1px solid #dfe7f5; color:#334e68; }
    .btn.secondary:hover{ box-shadow: var(--shadow); border-color:#bfd6ff; }

    .stats{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .pill{ background:#fff; border:1px solid #e6eef8; border-radius:999px; padding:8px 12px; font-weight:700; color:#334e68; }

    .empty{ text-align:center; color:#6b7c93; padding:26px; border:1px dashed #cfe0ff; border-radius:14px; background: #ffffffa6; }

    .toast{ position:fixed; left:50%; bottom:24px; transform:translateX(-50%) translateY(20px); background:#102a43; color:#fff; padding:12px 16px; border-radius:12px; box-shadow: var(--shadow); opacity:0; transition:.35s ease; font-weight:700; z-index:50; }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0); }

    canvas.confetti{ position:fixed; inset:0; pointer-events:none; z-index:40; }

    @media (prefers-reduced-motion: reduce){
      .option-btn:hover{ transform:none; }
      .btn:hover{ transform:none; }
      .bar > .fill{ transition:none; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title" role="banner">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Online Poll Board</h1>
          <div class="subtitle">Vote on trending topics (mock) â€” watch results animate in real time.</div>
        </div>
      </div>
      <div class="toolbar" role="toolbar" aria-label="Filters and actions">
        <button class="chip" data-filter="all" aria-pressed="true">All</button>
        <button class="chip" data-filter="tech">Tech</button>
        <button class="chip" data-filter="lifestyle">Lifestyle</button>
        <button class="chip" data-filter="fun">Fun</button>
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke-width="2" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke="currentColor"></circle><line x1="21" y1="21" x2="16.65" y2="16.65" stroke="currentColor"></line></svg>
          <input id="search" placeholder="Search pollsâ€¦" aria-label="Search polls" />
        </div>
      </div>
    </div>

    <div id="grid" class="grid" role="list"></div>

    <div class="footer">
      <div class="stats">
        <span class="pill" id="stat-polls">0 polls</span>
        <span class="pill" id="stat-votes">0 total votes</span>
        <span class="pill" id="stat-participation">Your votes: 0</span>
      </div>
      <div class="actions">
        <button class="btn secondary" id="toggle-results">View Results for All</button>
        <button class="btn" id="reset-demo" title="Clears local demo votes only">Reset Demo</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
  (function(){
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

    // Seed data: light, friendly topics
    const POLLS = [
      {
        id: 'p1', category: 'tech', question: 'Which AI feature excites you most in 2026?',
        options: [
          { id: 'o1', label: 'Realtime assistants', votes: 124 },
          { id: 'o2', label: 'Generative design', votes: 97 },
          { id: 'o3', label: 'Smart automation', votes: 88 }
        ]
      },
      {
        id: 'p2', category: 'lifestyle', question: 'Best way to start the day?',
        options: [
          { id: 'o1', label: 'Coffee â˜•', votes: 168 },
          { id: 'o2', label: 'Tea ðŸµ', votes: 96 },
          { id: 'o3', label: 'Workout ðŸ’ª', votes: 72 },
          { id: 'o4', label: 'Meditation ðŸ§˜', votes: 54 }
        ]
      },
      {
        id: 'p3', category: 'fun', question: 'Pick a weekend adventure:',
        options: [
          { id: 'o1', label: 'Hiking trail', votes: 80 },
          { id: 'o2', label: 'City food tour', votes: 120 },
          { id: 'o3', label: 'Museum crawl', votes: 64 }
        ]
      },
      {
        id: 'p4', category: 'tech', question: 'Your favorite dev superpower?',
        options: [
          { id: 'o1', label: 'AI code suggestions', votes: 140 },
          { id: 'o2', label: 'Instant previews', votes: 92 },
          { id: 'o3', label: 'Great docs', votes: 76 }
        ]
      },
      {
        id: 'p5', category: 'lifestyle', question: 'Ideal focus music?',
        options: [
          { id: 'o1', label: 'Lo-fi beats', votes: 110 },
          { id: 'o2', label: 'Ambient', votes: 66 },
          { id: 'o3', label: 'Classical', votes: 84 },
          { id: 'o4', label: 'Silence', votes: 40 }
        ]
      }
    ];

    const STORAGE_KEY = 'opb_votes_v1';
    const state = {
      filter: 'all',
      showAllResults: false,
      search: '',
      votes: loadVotes(), // { [pollId]: optionId }
    };

    function loadVotes(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }catch{ return {}; }
    }
    function saveVotes(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state.votes)); }

    function sumVotes(poll){ return poll.options.reduce((a,o)=>a+o.votes,0); }
    function getPollById(id){ return POLLS.find(p=>p.id===id); }
    function hasVoted(pollId){ return !!state.votes[pollId]; }

    function formatPct(n){ return Math.round(n) + '%'; }

    function animateNumber(el, to, duration=600){
      const from = parseInt(el.getAttribute('data-from') || el.textContent || 0,10) || 0;
      const start = performance.now();
      const delta = to - from;
      function tick(now){
        const t = Math.min(1, (now - start)/duration);
        const eased = t<.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2; // easeInOutCubic
        el.textContent = Math.round(from + delta * eased);
        if(t<1) requestAnimationFrame(tick); else el.setAttribute('data-from', to);
      }
      requestAnimationFrame(tick);
    }

    function toast(msg){
      const e = $('#toast'); e.textContent = msg; e.classList.add('show');
      clearTimeout(e._t); e._t = setTimeout(()=>e.classList.remove('show'), 1600);
    }

    // Lightweight confetti
    function confetti(){
      const colors = ['#5b8def','#7fd3ff','#7ee3d0','#ffd4a3','#ef5b78'];
      const N = 120;
      const canvas = document.createElement('canvas');
      canvas.className = 'confetti';
      const ctx = canvas.getContext('2d');
      function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
      resize(); window.addEventListener('resize', resize, { once: true });
      document.body.appendChild(canvas);
      const parts = Array.from({length:N}, (_,i)=>({
        x: Math.random()*canvas.width,
        y: -20 - Math.random()*canvas.height*0.6,
        r: 6 + Math.random()*8,
        c: colors[i%colors.length],
        vx: -1 + Math.random()*2,
        vy: 2 + Math.random()*3,
        rot: Math.random()*Math.PI,
        vr: -0.2 + Math.random()*0.4,
        shape: Math.random()<.5?'rect':'tri'
      }));
      const start = performance.now();
      (function frame(now){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for(const p of parts){
          p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.vy += 0.02;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot); ctx.fillStyle = p.c;
          if(p.shape==='tri'){ ctx.beginPath(); ctx.moveTo(-p.r, p.r); ctx.lineTo(p.r, p.r); ctx.lineTo(0, -p.r); ctx.closePath(); ctx.fill(); }
          else { ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r); }
          ctx.restore();
        }
        if(now - start < 1600) requestAnimationFrame(frame); else canvas.remove();
      })(start);
    }

    // Rendering
    function render(){
      const grid = $('#grid');
      const query = state.search.trim().toLowerCase();
      const items = POLLS.filter(p=> state.filter==='all' || p.category===state.filter)
                         .filter(p=> !query || p.question.toLowerCase().includes(query));
      grid.innerHTML = '';
      if(items.length===0){
        grid.innerHTML = `<div class="empty" role="status">No polls match your filters.</div>`;
      } else {
        for(const p of items){ grid.appendChild(renderCard(p)); }
      }
      // Stats
      $('#stat-polls').textContent = `${items.length} ${items.length===1?'poll':'polls'}`;
      const totalVotes = items.reduce((a,p)=>a+sumVotes(p),0);
      $('#stat-votes').textContent = `${totalVotes.toLocaleString()} total votes`;
      const yourVotes = Object.keys(state.votes).length;
      $('#stat-participation').textContent = `Your votes: ${yourVotes}`;
    }

    function renderCard(poll){
      const card = document.createElement('div');
      card.className = 'card';
      card.setAttribute('role','listitem');
      card.dataset.pollId = poll.id;

      const header = document.createElement('div');
      header.innerHTML = `<span class="cat">${cap(poll.category)}</span>`;

      const q = document.createElement('div'); q.className = 'q'; q.textContent = poll.question;

      card.appendChild(header); card.appendChild(q);

      const voted = hasVoted(poll.id);
      if(voted || state.showAllResults){ card.appendChild(renderResults(poll)); }
      else { card.appendChild(renderOptions(poll)); }

      const meta = document.createElement('div'); meta.className='meta';
      const total = sumVotes(poll).toLocaleString();
      meta.innerHTML = `<span><span class="tag">${total}</span> votes</span>`;
      const toggle = document.createElement('span'); toggle.className='view-results'; toggle.tabIndex=0; toggle.role='button'; toggle.textContent = voted? 'Change vote' : 'View results';
      toggle.addEventListener('click', ()=>{
        if(voted){
          delete state.votes[poll.id]; saveVotes(); toast('Vote cleared for this poll'); render();
        } else { state.showAllResults = !state.showAllResults; renderToolbarResultToggle(); render(); }
      });
      meta.appendChild(toggle);
      card.appendChild(meta);

      return card;
    }

    function renderOptions(poll){
      const box = document.createElement('div'); box.className='options';
      for(const opt of poll.options){
        const btn = document.createElement('button'); btn.type='button'; btn.className='option-btn';
        btn.setAttribute('aria-label', `Vote for ${opt.label}`);
        btn.innerHTML = `<span>${opt.label}</span><span style="color:#6b7c93; font-weight:800;">${opt.votes.toLocaleString()}</span>`;
        btn.addEventListener('click', ()=> vote(poll.id, opt.id, btn));
        box.appendChild(btn);
      }
      return box;
    }

    function renderResults(poll){
      const total = sumVotes(poll) || 1;
      const winner = poll.options.slice().sort((a,b)=>b.votes-a.votes)[0]?.id;
      const wrap = document.createElement('div'); wrap.className='results';
      for(const opt of poll.options){
        const pct = (opt.votes/total*100);
        const row = document.createElement('div'); row.className='bar'; if(opt.id===winner) row.dataset.hot = 'true';
        row.innerHTML = `
          <div class="fill" style="width:0%"></div>
          <div class="row">
            <div>${opt.label}</div>
            <div><span class="count" data-from="0">${opt.votes}</span> â€¢ <span class="pct">${formatPct(pct)}</span></div>
          </div>
        `;
        // animate fill after append
        setTimeout(()=>{ $('.fill', row).style.width = pct+"%"; }, 10);
        wrap.appendChild(row);
      }
      // animate counts
      setTimeout(()=> $$('.count', wrap).forEach(c=>animateNumber(c, parseInt(c.textContent,10))), 60);
      return wrap;
    }

    function vote(pollId, optionId, btn){
      if(hasVoted(pollId)) { toast('You already voted on this poll'); return; }
      const poll = getPollById(pollId); if(!poll) return;
      const opt = poll.options.find(o=>o.id===optionId); if(!opt) return;

      // Micro interaction
      btn.style.transform='scale(.98)'; setTimeout(()=>btn.style.transform='', 120);

      // Update counts
      opt.votes += 1;
      state.votes[pollId] = optionId; saveVotes();

      // Celebration
      confetti(); toast('Vote recorded!');

      // Re-render with results and animate
      const card = btn.closest('.card');
      const optionsEl = $('.options', card);
      const resultsEl = renderResults(poll);
      optionsEl.replaceWith(resultsEl);

      // Update footer stats immediately
      updateFooterStats();
    }

    function updateFooterStats(){
      const items = POLLS.filter(p=> state.filter==='all' || p.category===state.filter)
                         .filter(p=> !state.search || p.question.toLowerCase().includes(state.search.trim().toLowerCase()));
      $('#stat-polls').textContent = `${items.length} ${items.length===1?'poll':'polls'}`;
      const totalVotes = items.reduce((a,p)=>a+sumVotes(p),0);
      $('#stat-votes').textContent = `${totalVotes.toLocaleString()} total votes`;
      $('#stat-participation').textContent = `Your votes: ${Object.keys(state.votes).length}`;
    }

    function cap(s){ return s.slice(0,1).toUpperCase()+s.slice(1); }

    // Toolbar & filters
    function bindToolbar(){
      $$('.chip').forEach(ch=> ch.addEventListener('click', ()=>{
        $$('.chip').forEach(c=>c.setAttribute('aria-pressed','false'));
        ch.setAttribute('aria-pressed','true');
        state.filter = ch.dataset.filter; render();
      }));
      $('#search').addEventListener('input', (e)=>{ state.search = e.target.value; render(); });
      $('#reset-demo').addEventListener('click', ()=>{
        state.votes = {}; saveVotes(); toast('Demo votes cleared'); render();
      });
      $('#toggle-results').addEventListener('click', ()=>{
        state.showAllResults = !state.showAllResults; renderToolbarResultToggle(); render();
      });
    }

    function renderToolbarResultToggle(){
      $('#toggle-results').textContent = state.showAllResults ? 'Hide Results for All' : 'View Results for All';
    }

    // Initial
    bindToolbar(); renderToolbarResultToggle(); render();
  })();
  </script>
</body>
</html>
