<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Custom QR Code Generator</title>
  
  <!-- All CSS is inlined below -->
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #0f1720;
      --muted: #7a8699;
      --text: #e6edf6;
      --accent: #0ea5e9;
      --accent-2: #60a5fa;
      --ring: rgba(14,165,233,.35);
      --surface: #0b1220;
      --ok: #10b981;
      --warn: #f59e0b;
      --bad: #ef4444;
      --shadow: 0 10px 30px rgba(2,8,23,.5);
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f6f8fb;
        --panel: #ffffff;
        --muted: #5b6472;
        --text: #0b1220;
        --accent: #0284c7;
        --accent-2: #2563eb;
        --ring: rgba(2,132,199,.25);
        --surface: #eef2f7;
        --shadow: 0 10px 30px rgba(2,8,23,.08);
      }
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font: 14px/1.35 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 1200px at 10% -20%, var(--surface), transparent 60%),
                  radial-gradient(1000px 1000px at 110% 20%, rgba(99,102,241,.18), transparent 60%),
                  var(--bg);
      color: var(--text);
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px 18px 40px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 22px;
    }
    .brand {
      display: flex; align-items: center; gap: 12px;
    }
    .logo {
      width: 36px; height: 36px; border-radius: 10px;
      background: conic-gradient(from 200deg, var(--accent), var(--accent-2));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.12), var(--shadow);
    }
    h1 { margin: 0; font-size: 20px; letter-spacing: .3px; }
    .sub { color: var(--muted); font-size: 12px; }

    .layout {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 20px;
    }
    @media (max-width: 980px) {
      .layout { grid-template-columns: 1fr; }
    }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,.02), transparent 40%), var(--panel);
      border: 1px solid rgba(148,163,184,.12);
      border-radius: 14px;
      box-shadow: var(--shadow);
    }

    .controls { padding: 18px; }
    .control { margin-bottom: 14px; }
    .label {
      display: flex; align-items: center; justify-content: space-between;
      font-weight: 600; font-size: 12px; color: var(--muted); margin-bottom: 8px;
    }
    .row { display: flex; gap: 10px; }

    textarea, select, input[type="text"], input[type="number"] {
      width: 100%;
      background: #0a0f18;
      color: var(--text);
      border: 1px solid rgba(148,163,184,.18);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
      transition: border .2s, box-shadow .2s, background .2s;
    }
    @media (prefers-color-scheme: light) {
      textarea, select, input[type="text"], input[type="number"] {
        background: #f9fbff;
      }
    }
    textarea:focus, select:focus, input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 6px var(--ring);
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .chip {
      display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px;
      border-radius: 999px; border: 1px solid rgba(148,163,184,.18);
      color: var(--muted); background: rgba(148,163,184,.08);
      font-size: 12px;
    }

    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      border: 1px solid rgba(148,163,184,.18);
      border-radius: 12px;
      padding: 10px 14px; font-weight: 600; cursor: pointer;
      color: white; background: linear-gradient(180deg, var(--accent-2), var(--accent));
      text-decoration: none; user-select: none;
      box-shadow: 0 8px 24px rgba(2,132,199,.35);
    }
    .btn:disabled { opacity: .6; cursor: not-allowed; box-shadow: none; }
    .btn.secondary { background: transparent; color: var(--text); box-shadow: none; }

    .swatch {
      display: flex; gap: 10px; align-items: center;
      background: rgba(148,163,184,.08);
      border: 1px solid rgba(148,163,184,.18);
      padding: 8px; border-radius: 12px; width: 100%;
    }
    .swatch input[type="color"] {
      -webkit-appearance: none; appearance: none; border: none; padding: 0; width: 36px; height: 36px;
      background: none; cursor: pointer; border-radius: 8px; overflow: hidden;
    }
    .swatch input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
    .swatch input[type="color"]::-webkit-color-swatch { border: none; }

    .range {
      -webkit-appearance: none; appearance: none; width: 100%; height: 6px; border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2)); outline: none;
    }
    .range::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: white; border: 2px solid var(--accent); box-shadow: 0 2px 10px rgba(2,132,199,.4);
    }
    .range::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%; background: white; border: 2px solid var(--accent);
    }

    .preview-wrap { padding: 16px; }
    .preview {
      position: relative; display: grid; place-items: center;
      border-radius: 16px; padding: 24px; min-height: 420px;
      background:
        radial-gradient(600px 600px at 90% -10%, rgba(99,102,241,.2), transparent 40%),
        radial-gradient(400px 400px at -10% 110%, rgba(14,165,233,.25), transparent 40%),
        linear-gradient(180deg, rgba(255,255,255,.02), transparent 40%), var(--panel);
      border: 1px solid rgba(148,163,184,.12);
      box-shadow: var(--shadow);
    }
    .grid-bg {
      position: absolute; inset: 0; pointer-events: none; border-radius: 16px; overflow: hidden;
      mask-image: radial-gradient(closest-side, black 70%, transparent);
      opacity: .6;
    }
    .grid-bg::before {
      content: ""; position: absolute; inset: 0;
      background-image: linear-gradient(to right, rgba(148,163,184,.08) 1px, transparent 1px),
                        linear-gradient(to bottom, rgba(148,163,184,.08) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    canvas { display: block; border-radius: 10px; }

    .hint { color: var(--muted); font-size: 12px; }
    .kpis { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

    .footer {
      margin-top: 16px; color: var(--muted); font-size: 12px; text-align: center;
    }

    .spacer { flex: 1 1 auto; }
    .row.wrap { flex-wrap: wrap; }

    .radio {
      display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(148,163,184,.18); background: rgba(148,163,184,.08);
      cursor: pointer; user-select: none; font-weight: 600; color: var(--muted);
    }
    .radio input { display: none; }
    .radio[data-checked="true"] { color: var(--text); border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring); }

    .contrast { font-weight: 700; }
    .contrast.ok { color: var(--ok); }
    .contrast.warn { color: var(--warn); }
    .contrast.bad { color: var(--bad); }

    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
  </style>

  <!-- Lightweight QR generator (allowed via CDN) -->
  <script defer src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Custom QR Code Generator</h1>
          <div class="sub">Generate beautiful QR codes with custom colors and export as PNG.</div>
        </div>
      </div>
      <div class="kpis">
        <span class="chip" id="statusChip" aria-live="polite">Ready</span>
      </div>
    </header>

    <div class="layout">
      <!-- Controls Panel -->
      <section class="panel controls" aria-label="QR options and input">
        <div class="control">
          <div class="label">
            <span>Text or URL</span>
            <span class="hint">Live preview updates as you type</span>
          </div>
          <textarea id="qrText" placeholder="Type your text or paste a URL…\nExamples:\nhttps://example.com\nWIFI:T:WPA;S:MyWiFi;P:supersecret;;\nBEGIN:VCARD\nN:Doe;Jane;;;\nTEL:+1 555 0100\nEND:VCARD"></textarea>
        </div>

        <div class="control">
          <div class="label"><span>Colors</span><span class="hint">Ensure strong contrast for scannability</span></div>
          <div class="row">
            <div class="swatch" style="flex:1">
              <input id="colorDark" type="color" value="#111827" aria-label="Foreground color" />
              <input id="hexDark" type="text" value="#111827" aria-label="Foreground hex" />
            </div>
            <div class="swatch" style="flex:1">
              <input id="colorLight" type="color" value="#ffffff" aria-label="Background color" />
              <input id="hexLight" type="text" value="#ffffff" aria-label="Background hex" />
            </div>
          </div>
          <div class="row" style="margin-top:10px; align-items:center; gap: 10px;">
            <button class="btn secondary" id="swapBtn" type="button" title="Swap colors">Swap</button>
            <button class="btn secondary" id="randomBtn" type="button" title="Random high-contrast colors">Random</button>
            <span class="spacer"></span>
            <span class="chip">Contrast: <span id="contrastVal" class="contrast">—</span></span>
          </div>
        </div>

        <div class="control">
          <div class="label"><span>Quality & Size</span><span class="hint">Error correction, dimensions, and margin</span></div>
          <div class="row wrap" style="gap:10px">
            <label class="radio" id="scale1"><input type="radio" name="scale" value="1" checked>1x</label>
            <label class="radio" id="scale2"><input type="radio" name="scale" value="2">2x</label>
            <label class="radio" id="scale4"><input type="radio" name="scale" value="4">4x</label>
            <span class="spacer"></span>
            <select id="ecl" title="Error Correction Level">
              <option value="M">ECL: M (default)</option>
              <option value="L">ECL: L</option>
              <option value="Q">ECL: Q</option>
              <option value="H">ECL: H (max)</option>
            </select>
          </div>

          <div class="row" style="margin-top:12px; align-items:center; gap:12px;">
            <div style="flex:1">
              <div class="label"><span>Pixel Size</span><span id="sizeOut">512 px</span></div>
              <input id="size" type="range" class="range" min="128" max="1024" step="16" value="512" />
            </div>
            <div style="width: 1px; background: rgba(148,163,184,.18); align-self: stretch"></div>
            <div style="flex:1">
              <div class="label"><span>Margin</span><span id="marginOut">4</span></div>
              <input id="margin" type="range" class="range" min="0" max="16" step="1" value="4" />
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:14px; gap:10px;">
          <button class="btn" id="downloadBtn" type="button">Download PNG</button>
          <button class="btn secondary" id="copyBtn" type="button" title="Copy PNG to clipboard">Copy PNG</button>
          <button class="btn secondary" id="resetBtn" type="button" title="Reset to defaults">Reset</button>
        </div>
        <div class="hint" style="margin-top:10px">Tip: Drop text anywhere on the page to populate the input.</div>
      </section>

      <!-- Preview Panel -->
      <section class="panel preview-wrap" aria-label="QR preview">
        <div class="preview">
          <div class="grid-bg" aria-hidden="true"></div>
          <canvas id="qrCanvas" width="512" height="512" aria-label="QR code preview"></canvas>
          <div class="sr-only" aria-live="polite" id="liveMsg"></div>
        </div>
      </section>
    </div>

    <div class="footer">
      Built for speed and clarity • No tracking • Works offline after load
    </div>
  </div>

  <!-- All app logic is inlined below -->
  <script>
    (function() {
      const $ = (sel) => document.querySelector(sel);
      const els = {
        text: $('#qrText'),
        colorDark: $('#colorDark'),
        colorLight: $('#colorLight'),
        hexDark: $('#hexDark'),
        hexLight: $('#hexLight'),
        size: $('#size'),
        margin: $('#margin'),
        ecl: $('#ecl'),
        canvas: $('#qrCanvas'),
        download: $('#downloadBtn'),
        copy: $('#copyBtn'),
        reset: $('#resetBtn'),
        swap: $('#swapBtn'),
        random: $('#randomBtn'),
        sizeOut: $('#sizeOut'),
        marginOut: $('#marginOut'),
        contrastVal: $('#contrastVal'),
        statusChip: $('#statusChip'),
        liveMsg: $('#liveMsg'),
        scaleRadios: Array.from(document.querySelectorAll('input[name="scale"]')),
        scaleLabels: [$('#scale1'), $('#scale2'), $('#scale4')]
      };

      // Helpers
      const clamp = (n, a, b) => Math.min(Math.max(n, a), b);
      const isHex = (s) => /^#?[0-9a-fA-F]{6}$/.test(s);
      const normHex = (s) => {
        if (!s) return '#000000';
        s = s.trim();
        if (s[0] !== '#') s = '#' + s;
        return s.slice(0, 7).toLowerCase();
      };
      const hexToRgb = (hex) => {
        hex = normHex(hex).replace('#','');
        return {
          r: parseInt(hex.substring(0,2), 16),
          g: parseInt(hex.substring(2,4), 16),
          b: parseInt(hex.substring(4,6), 16),
        };
      };
      const relLuminance = ({r,g,b}) => {
        const srgb = [r,g,b].map(v => v/255).map(v => v <= 0.03928 ? v/12.92 : Math.pow((v+0.055)/1.055, 2.4));
        return 0.2126*srgb[0] + 0.7152*srgb[1] + 0.0722*srgb[2];
      };
      const contrastRatio = (hex1, hex2) => {
        const L1 = relLuminance(hexToRgb(hex1));
        const L2 = relLuminance(hexToRgb(hex2));
        const bright = Math.max(L1,L2), dark = Math.min(L1,L2);
        return (bright + 0.05) / (dark + 0.05);
      };

      function updateContrastBadge() {
        const c = contrastRatio(els.hexDark.value, els.hexLight.value);
        const txt = c.toFixed(2) + ' : 1';
        els.contrastVal.textContent = txt;
        els.contrastVal.classList.remove('ok','warn','bad');
        if (c >= 4.5) els.contrastVal.classList.add('ok');
        else if (c >= 3) els.contrastVal.classList.add('warn');
        else els.contrastVal.classList.add('bad');
      }

      function syncColorInputs(which) {
        // Keep color pickers and hex text in sync
        if (which === 'darkHex' && isHex(els.hexDark.value)) {
          els.colorDark.value = normHex(els.hexDark.value);
        }
        if (which === 'lightHex' && isHex(els.hexLight.value)) {
          els.colorLight.value = normHex(els.hexLight.value);
        }
        if (which === 'darkPicker') {
          els.hexDark.value = normHex(els.colorDark.value);
        }
        if (which === 'lightPicker') {
          els.hexLight.value = normHex(els.colorLight.value);
        }
        updateContrastBadge();
      }

      function setScaleUI() {
        const val = getScale();
        els.scaleLabels.forEach(l => l.dataset.checked = 'false');
        const idx = {1:0, 2:1, 4:2}[val] ?? 0;
        els.scaleLabels[idx].dataset.checked = 'true';
      }

      function getScale() {
        const r = els.scaleRadios.find(r => r.checked);
        return r ? parseInt(r.value, 10) : 1;
      }

      function setStatus(msg) {
        els.statusChip.textContent = msg;
      }

      function setLive(msg) {
        els.liveMsg.textContent = msg;
      }

      // QR Rendering
      let renderTimer = null;
      async function renderQR({forExport = false} = {}) {
        const text = (els.text.value || '').trim();
        const width = clamp(parseInt(els.size.value,10) || 512, 64, 4096);
        const margin = clamp(parseInt(els.margin.value,10) || 0, 0, 64);
        const colorDark = normHex(els.hexDark.value);
        const colorLight = normHex(els.hexLight.value);
        const errorCorrectionLevel = els.ecl.value;

        const opts = { errorCorrectionLevel, width, margin, color: { dark: colorDark, light: colorLight } };
        const canvas = forExport ? document.createElement('canvas') : els.canvas;

        if (!text) {
          // draw a subtle placeholder grid on the preview canvas
          if (!forExport) {
            const ctx = canvas.getContext('2d');
            canvas.width = width; canvas.height = width;
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = colorLight;
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = colorDark + '22';
            const step = 20;
            for (let x=0;x<canvas.width;x+=step) { ctx.fillRect(x,0,1,canvas.height); }
            for (let y=0;y<canvas.height;y+=step) { ctx.fillRect(0,y,canvas.width,1); }
          }
          els.download.disabled = true;
          els.copy.disabled = true;
          setStatus('Enter text to generate');
          return null;
        }

        try {
          await QRCode.toCanvas(canvas, text, opts);
          if (!forExport) {
            canvas.style.width = width + 'px';
            canvas.style.height = width + 'px';
            els.download.disabled = false;
            els.copy.disabled = false;
            setStatus('QR updated');
            setLive('QR updated');
          }
          return canvas;
        } catch (err) {
          console.error(err);
          setStatus('Render failed');
          return null;
        }
      }

      function debouncedRender() {
        clearTimeout(renderTimer);
        renderTimer = setTimeout(() => renderQR(), 80);
      }

      // Export helpers
      async function downloadPng() {
        const scale = getScale();
        const baseSize = parseInt(els.size.value, 10) || 512;
        const exportSize = clamp(baseSize * scale, 128, 4096);
        const canvas = await renderQR({forExport: true});
        if (!canvas) return;
        // upscale if needed without blurring
        if (canvas.width !== exportSize) {
          const up = document.createElement('canvas');
          up.width = exportSize; up.height = exportSize;
          const ctx = up.getContext('2d');
          ctx.imageSmoothingEnabled = false;
          ctx.drawImage(canvas, 0, 0, exportSize, exportSize);
          const url = up.toDataURL('image/png');
          triggerDownload(url);
        } else {
          triggerDownload(canvas.toDataURL('image/png'));
        }
      }

      function triggerDownload(url) {
        const nameSafe = (els.text.value.trim() || 'qr-code').replace(/\s+/g,'-').slice(0,40);
        const a = document.createElement('a');
        a.href = url; a.download = nameSafe + '.png';
        document.body.appendChild(a); a.click(); a.remove();
        setStatus('PNG downloaded');
      }

      async function copyPng() {
        try {
          const scale = getScale();
          const baseSize = parseInt(els.size.value, 10) || 512;
          const exportSize = clamp(baseSize * scale, 128, 4096);
          const canvas = await renderQR({forExport: true});
          if (!canvas) return;
          let target = canvas;
          if (canvas.width !== exportSize) {
            const up = document.createElement('canvas');
            up.width = exportSize; up.height = exportSize;
            const ctx = up.getContext('2d');
            ctx.imageSmoothingEnabled = false;
            ctx.drawImage(canvas, 0, 0, exportSize, exportSize);
            target = up;
          }
          const blob = await new Promise(res => target.toBlob(res, 'image/png'));
          await navigator.clipboard.write([ new ClipboardItem({ 'image/png': blob }) ]);
          setStatus('Copied PNG to clipboard');
        } catch (e) {
          console.warn('Copy failed, falling back to download', e);
          await downloadPng();
        }
      }

      function swapColors() {
        const a = els.hexDark.value, b = els.hexLight.value;
        els.hexDark.value = normHex(b);
        els.hexLight.value = normHex(a);
        els.colorDark.value = els.hexDark.value;
        els.colorLight.value = els.hexLight.value;
        updateContrastBadge();
        debouncedRender();
      }

      function randomColors() {
        // Generate a dark and a light color with high contrast
        function rand() { return Math.floor(Math.random()*256); }
        let attempts = 0;
        while (attempts++ < 1000) {
          const dark = { r: rand()>>1, g: rand()>>1, b: rand()>>1 }; // bias darker
          const light = { r: 160 + (rand()>>2), g: 160 + (rand()>>2), b: 160 + (rand()>>2) }; // bias lighter
          const toHex = (o) => '#' + [o.r,o.g,o.b].map(v => v.toString(16).padStart(2,'0')).join('');
          const dh = toHex(dark), lh = toHex(light);
          if (contrastRatio(dh, lh) >= 4) {
            els.hexDark.value = dh; els.hexLight.value = lh;
            els.colorDark.value = dh; els.colorLight.value = lh;
            updateContrastBadge();
            debouncedRender();
            return;
          }
        }
      }

      function resetAll() {
        els.text.value = '';
        els.hexDark.value = '#111827';
        els.hexLight.value = '#ffffff';
        els.colorDark.value = '#111827';
        els.colorLight.value = '#ffffff';
        els.ecl.value = 'M';
        els.size.value = '512';
        els.margin.value = '4';
        els.scaleRadios.forEach(r => r.checked = (r.value === '1'));
        setScaleUI();
        els.sizeOut.textContent = '512 px';
        els.marginOut.textContent = '4';
        updateContrastBadge();
        debouncedRender();
      }

      // Wire events
      ['input','change','keyup'].forEach(evt => els.text.addEventListener(evt, debouncedRender));
      els.size.addEventListener('input', () => { els.sizeOut.textContent = els.size.value + ' px'; debouncedRender(); });
      els.margin.addEventListener('input', () => { els.marginOut.textContent = els.margin.value; debouncedRender(); });
      els.ecl.addEventListener('change', debouncedRender);

      els.colorDark.addEventListener('input', () => { syncColorInputs('darkPicker'); debouncedRender(); });
      els.colorLight.addEventListener('input', () => { syncColorInputs('lightPicker'); debouncedRender(); });
      els.hexDark.addEventListener('input', () => { if (isHex(els.hexDark.value)) { syncColorInputs('darkHex'); debouncedRender(); } });
      els.hexLight.addEventListener('input', () => { if (isHex(els.hexLight.value)) { syncColorInputs('lightHex'); debouncedRender(); } });

      els.download.addEventListener('click', downloadPng);
      els.copy.addEventListener('click', copyPng);
      els.reset.addEventListener('click', resetAll);
      els.swap.addEventListener('click', swapColors);
      els.random.addEventListener('click', randomColors);

      els.scaleRadios.forEach(r => r.addEventListener('change', () => { setScaleUI(); }));

      // Drag & drop text support
      window.addEventListener('dragover', e => { e.preventDefault(); });
      window.addEventListener('drop', e => {
        e.preventDefault();
        const dt = e.dataTransfer;
        if (dt && dt.getData('text')) {
          els.text.value = dt.getData('text');
          debouncedRender();
        }
      });

      // URL params support
      try {
        const params = new URLSearchParams(location.search);
        if (params.has('text')) {
          els.text.value = params.get('text');
        }
        if (params.has('dark')) {
          const v = normHex(params.get('dark')); els.hexDark.value = v; els.colorDark.value = v;
        }
        if (params.has('light')) {
          const v = normHex(params.get('light')); els.hexLight.value = v; els.colorLight.value = v;
        }
        if (params.has('size')) {
          const v = clamp(parseInt(params.get('size'),10)||512, 128, 1024); els.size.value = String(v);
        }
      } catch {}

      // Initial UI sync and first render
      setScaleUI();
      updateContrastBadge();
      debouncedRender();
    })();
  </script>
</body>
</html>
