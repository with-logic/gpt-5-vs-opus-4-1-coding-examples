<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solar System Explorer</title>
  <meta name="description" content="Interactive Solar System Explorer — drag, zoom, click planets for info, and control orbit speed." />
  <style>
    :root{
      --bg:#0b0f16;
      --panel:#0f1624;
      --panel-2:#0b1220;
      --text:#e6eefc;
      --muted:#9fb2d8;
      --accent:#4cc9f0;
      --accent-2:#22d3ee;
      --warning:#f59e0b;
      --success:#34d399;
      --danger:#ef4444;
      --ring:#24324a;
      --shadow:0 6px 30px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.02) inset;
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; overflow:hidden; background:radial-gradient(1200px 800px at 60% -10%, #151b2a 0%, var(--bg) 45%, #030711 100%);
      color:var(--text); font:400 14px/1.4 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    /* Layout */
    #app{position:fixed; inset:0;}

    /* Top HUD */
    .hud{position:absolute; top:12px; left:12px; right:12px; display:flex; gap:12px; align-items:center; z-index:10;}
    .brand{display:flex; align-items:center; gap:10px; padding:10px 14px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid var(--ring); border-radius:12px; box-shadow:var(--shadow); backdrop-filter: blur(6px);}
    .brand .dot{width:10px; height:10px; border-radius:50%; background:radial-gradient(circle at 35% 35%, #fff 0%, #ffd36b 45%, #f59e0b 70%, #b45309 100%); box-shadow:0 0 18px rgba(245, 158, 11,.8), 0 0 42px rgba(245,158,11,.25)}
    .brand h1{margin:0; font-size:15px; letter-spacing:.6px; font-weight:700}

    .panel{display:flex; align-items:center; gap:10px; padding:10px 12px; background:linear-gradient(180deg, rgba(8,12,22,.9), rgba(6,10,18,.8)); border:1px solid var(--ring); border-radius:12px; box-shadow:var(--shadow); backdrop-filter: blur(6px);}

    .spacer{flex:1}

    .btn{appearance:none; cursor:pointer; border:1px solid var(--ring); background:linear-gradient(180deg, #1a2336, #0f172a); color:var(--text); padding:8px 12px; border-radius:10px; font-weight:600; letter-spacing:.3px; display:inline-flex; align-items:center; gap:8px; box-shadow:var(--shadow); transition: transform .08s ease, background .2s ease, border-color .2s ease;}
    .btn:hover{transform: translateY(-1px); border-color:#2b3b5e}
    .btn:active{transform: translateY(0)}
    .btn[aria-pressed="true"]{background:linear-gradient(180deg, #123149, #0c2539); border-color:#184e73; color:#a9e8ff}

    .stat{opacity:.9; font-weight:600; letter-spacing:.2px;}

    /* Slider */
    .slider{display:flex; align-items:center; gap:10px; min-width:260px}
    .slider label{font-weight:700; font-size:12px; text-transform:uppercase; color:var(--muted); letter-spacing:.8px}
    .slider output{min-width:42px; text-align:right; font-variant-numeric: tabular-nums; color:#a8e1ff}
    input[type="range"]{ -webkit-appearance:none; width:180px; height:24px; background:transparent;}
    input[type="range"]:focus{outline:none}
    input[type="range"]::-webkit-slider-runnable-track{height:6px; background:linear-gradient(90deg, #0ea5e9, #22d3ee); border-radius:999px; box-shadow:0 0 0 1px rgba(0,0,0,.3) inset}
    input[type="range"]::-moz-range-track{height:6px; background:linear-gradient(90deg, #0ea5e9, #22d3ee); border-radius:999px}
    input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none; width:18px; height:18px; border-radius:50%; background:radial-gradient(circle at 35% 35%, #d1f4ff 0%, #8be9ff 45%, #20b7e6 70%, #0284c7 100%); margin-top:-6px; border:1px solid #0ea5e9; box-shadow:0 0 20px rgba(34,211,238,.5)}
    input[type="range"]::-moz-range-thumb{width:18px; height:18px; border-radius:50%; background:#22d3ee; border:0}

    /* Right Info Panel */
    .info{position:absolute; right:12px; top:64px; width:320px; max-width:calc(100% - 24px); border:1px solid var(--ring); background:linear-gradient(180deg, rgba(8,12,22,.9), rgba(6,10,18,.85)); border-radius:14px; box-shadow:var(--shadow); backdrop-filter:blur(8px); z-index:10; overflow:hidden}
    .info header{display:flex; align-items:center; gap:10px; padding:12px 14px; border-bottom:1px solid #1a2640}
    .pill{display:inline-flex; align-items:center; gap:8px; background:#0e1a2f; color:#a3c7ff; padding:6px 10px; border-radius:999px; border:1px solid #1f2d4a; font-weight:700; font-size:12px; letter-spacing:.3px}
    .info .body{padding:12px 14px; color:#cfe1ff}
    .row{display:flex; align-items:center; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #203050}
    .row:last-child{border-bottom:0}
    .k{color:#8fb2ff; font-weight:600}
    .v{font-variant-numeric:tabular-nums}

    /* Help footer */
    .help{position:absolute; left:12px; bottom:12px; right:12px; display:flex; gap:10px; align-items:center; justify-content:space-between; z-index:10}
    .tips{flex:1; padding:10px 12px; border:1px dashed #22324f; color:#bfd3ff; border-radius:12px; background:rgba(9,14,24,.6);}
    .tips strong{color:#a8e1ff}

    /* Canvas container */
    #scene{position:absolute; inset:0}

    /* Small screens */
    @media (max-width: 820px){
      .hud{flex-wrap:wrap}
      .info{position:absolute; right:12px; left:12px; width:auto}
      .slider{min-width:0}
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="hud">
      <div class="brand"><span class="dot"></span><h1>Solar System Explorer</h1></div>
      <div class="panel slider">
        <label for="speed">Orbit Speed</label>
        <input id="speed" type="range" min="0" max="8" step="0.1" value="1.6" />
        <output id="speedOut">1.6×</output>
        <button class="btn" id="playBtn" aria-pressed="true" title="Play/Pause orbits">▶</button>
        <button class="btn" id="resetBtn" title="Reset view">Reset</button>
      </div>
      <div class="panel">
        <span class="stat" id="statDistance">—</span>
      </div>
      <div class="spacer"></div>
      <div class="panel">
        <button class="btn" id="toggleOrbits" aria-pressed="true" title="Toggle orbit paths">Orbits</button>
        <button class="btn" id="toggleAutoRotate" aria-pressed="false" title="Auto-rotate camera">Auto</button>
      </div>
    </div>

    <aside class="info" id="info" aria-live="polite">
      <header>
        <span class="pill" id="planetName">Select a planet</span>
        <div class="spacer"></div>
        <button class="btn" id="focusBtn" title="Focus camera on selection">Focus</button>
      </header>
      <div class="body" id="infoBody">
        Tap or click a planet to view details. Use the speed control to accelerate or slow down time.
      </div>
    </aside>

    <div class="help">
      <div class="tips">
        <strong>Drag</strong> to rotate • <strong>Scroll / Pinch</strong> to zoom • <strong>Right-drag</strong> to pan • <strong>Click planets</strong> for details
      </div>
      <div class="panel"><span class="stat" id="fps">FPS: —</span></div>
    </div>

    <div id="scene" aria-label="3D Solar System"></div>
  </div>

  <!-- Libraries -->
  <script src="https://unpkg.com/three@0.159.0/build/three.min.js"></script>

  <script type="module">
  import { OrbitControls } from 'https://unpkg.com/three@0.159.0/examples/jsm/controls/OrbitControls.js?module';
  (function(){
    if(!window.THREE){
      alert('Three.js failed to load. Please check your network and reload.');
      return;
    }

    const YEAR_SECONDS = 60; // Earth completes one orbit in ~60s at speed 1.0
    const AU = 28; // visual units per astronomical unit

    const container = document.getElementById('scene');
    const infoEl = document.getElementById('info');
    const nameEl = document.getElementById('planetName');
    const bodyEl = document.getElementById('infoBody');
    const speedEl = document.getElementById('speed');
    const speedOutEl = document.getElementById('speedOut');
    const playBtn = document.getElementById('playBtn');
    const resetBtn = document.getElementById('resetBtn');
    const toggleOrbitsBtn = document.getElementById('toggleOrbits');
    const toggleAutoBtn = document.getElementById('toggleAutoRotate');
    const focusBtn = document.getElementById('focusBtn');
    const statDistance = document.getElementById('statDistance');
    const fpsEl = document.getElementById('fps');

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, powerPreference:'high-performance' });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    container.appendChild(renderer.domElement);

    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 4000);
    camera.position.set(0, 80, 220);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.minDistance = 30; controls.maxDistance = 1200;
    controls.target.set(0,0,0);

    // Ambient and a bright sun point light
    scene.add(new THREE.AmbientLight(0x687aa1, 0.3));
    const sunLight = new THREE.PointLight(0xffffff, 2.4, 0, 2);
    sunLight.position.set(0,0,0);

    // Sun
    const sunGeo = new THREE.SphereGeometry(12, 72, 72);
    const sunMat = new THREE.MeshStandardMaterial({ color:0x222222, emissive:0xffc94d, emissiveIntensity:1.5, roughness:0.6, metalness:0.0 });
    const sun = new THREE.Mesh(sunGeo, sunMat);
    sun.name = 'Sun';

    // Sun glow sprite (canvas-based radial gradient)
    function makeGlowSprite(hex, size){
      const c = document.createElement('canvas'); c.width = c.height = 256; const ctx = c.getContext('2d');
      const g = ctx.createRadialGradient(128,128,10, 128,128,128);
      const col = new THREE.Color(hex);
      g.addColorStop(0, 'rgba(' + [col.r*255|0,col.g*255|0,col.b*255|0].join(',') + ',1)');
      g.addColorStop(0.25, 'rgba(' + [col.r*255|0,col.g*255|0,col.b*255|0].join(',') + ',.7)');
      g.addColorStop(1,'rgba(' + [col.r*255|0,col.g*255|0,col.b*255|0].join(',') + ',0)');
      ctx.fillStyle = g; ctx.fillRect(0,0,256,256);
      const tex = new THREE.CanvasTexture(c); tex.colorSpace = THREE.SRGBColorSpace;
      const mat = new THREE.SpriteMaterial({ map: tex, blending: THREE.AdditiveBlending, depthWrite:false, transparent:true });
      const s = new THREE.Sprite(mat); s.scale.set(size,size,1); return s;
    }

    const sunGlow = makeGlowSprite(0xffb02e, 120);

    const sunGroup = new THREE.Group();
    sunGroup.add(sun); sunGroup.add(sunLight); sunGroup.add(sunGlow);
    scene.add(sunGroup);

    // Star field
    function addStars(count=5000){
      const g = new THREE.BufferGeometry();
      const pos = new Float32Array(count*3);
      for(let i=0;i<count;i++){
        // distribute in a shell
        const r = 900 + Math.random()*600;
        const t = Math.random()*Math.PI*2; const p = Math.acos(2*Math.random()-1);
        pos[i*3+0] = r * Math.sin(p)*Math.cos(t);
        pos[i*3+1] = r * Math.cos(p);
        pos[i*3+2] = r * Math.sin(p)*Math.sin(t);
      }
      g.setAttribute('position', new THREE.BufferAttribute(pos,3));
      const m = new THREE.PointsMaterial({ size: 1.2, color:0x9db7ff, transparent:true, opacity:0.9, depthWrite:false });
      const mesh = new THREE.Points(g,m); scene.add(mesh);
    }
    addStars(4200);

    // Planet definitions (stylized sizes, real-ish distances and orbital periods)
    const PLANETS = [
      { key:'mercury', name:'Mercury', color:0xb6b6b6, size:0.8, au:0.39, period:88, type:'Terrestrial', radiusKm:2440, moons:0, desc:'Smallest planet; cratered surface and extreme temperature swings.' },
      { key:'venus',   name:'Venus',   color:0xe6c28b, size:1.9, au:0.72, period:225, type:'Terrestrial', radiusKm:6052, moons:0, desc:'Shrouded by thick clouds; hottest planet due to runaway greenhouse effect.' },
      { key:'earth',   name:'Earth',   color:0x6bb6ff, size:2.0, au:1.00, period:365, type:'Terrestrial', radiusKm:6371, moons:1, desc:'Our home world, the blue planet with abundant liquid water.' },
      { key:'mars',    name:'Mars',    color:0xff6b57, size:1.4, au:1.52, period:687, type:'Terrestrial', radiusKm:3390, moons:2, desc:'The red planet; giant volcanoes and ancient river valleys.' },
      { key:'jupiter', name:'Jupiter', color:0xd7b890, size:5.5, au:5.20, period:4333, type:'Gas Giant', radiusKm:69911, moons:95, desc:'Largest planet; powerful storms like the Great Red Spot.' },
      { key:'saturn',  name:'Saturn',  color:0xf3e0a6, size:4.7, au:9.58, period:10759, type:'Gas Giant', radiusKm:58232, moons:146, desc:'Famous for its spectacular ring system of ice and rock.' },
      { key:'uranus',  name:'Uranus',  color:0xa6f1f7, size:3.6, au:19.20, period:30687, type:'Ice Giant', radiusKm:25362, moons:28, desc:'An ice giant tipped on its side with an extreme axial tilt.' },
      { key:'neptune', name:'Neptune', color:0x5aa4ff, size:3.4, au:30.07, period:60190, type:'Ice Giant', radiusKm:24622, moons:16, desc:'Deep blue and supersonic winds; farthest major planet.' }
    ];

    // Orbits group (toggle visibility)
    const orbitsGroup = new THREE.Group(); scene.add(orbitsGroup);

    const planets = []; // {data,pivot,mesh,orbit,angle,orbitSpeed,spin,selectGlow}

    function makeOrbit(radius){
      const pts = new Float32Array(256*3);
      for(let i=0;i<256;i++){
        const a = (i/256)*Math.PI*2; const x = Math.cos(a)*radius; const z = Math.sin(a)*radius;
        pts[i*3] = x; pts[i*3+1] = 0; pts[i*3+2] = z;
      }
      const g = new THREE.BufferGeometry(); g.setAttribute('position', new THREE.BufferAttribute(pts,3));
      const m = new THREE.LineBasicMaterial({ color:0x1e2a47, transparent:true, opacity:0.8 });
      const line = new THREE.LineLoop(g,m); return line;
    }

    function makePlanet(data){
      const pivot = new THREE.Object3D();
      const geo = new THREE.SphereGeometry(data.size, 48, 48);
      const mat = new THREE.MeshStandardMaterial({ color:data.color, roughness:0.9, metalness:0.0 });
      const mesh = new THREE.Mesh(geo, mat); mesh.name = data.name;
      mesh.position.x = data.au * AU;

      // Subtle atmospheric rim via second sprite
      const halo = makeGlowSprite(data.color, data.size*8); halo.renderOrder = 0; halo.material.opacity = 0.14; mesh.add(halo);

      // Saturn ring
      if(data.key === 'saturn'){
        const rIn = data.size*1.6, rOut = data.size*3.0;
        const ringGeo = new THREE.RingGeometry(rIn, rOut, 96);
        const ringMat = new THREE.MeshStandardMaterial({ color:0xe7dfbe, roughness:0.7, metalness:0.0, side:THREE.DoubleSide, transparent:true, opacity:0.85 });
        const ring = new THREE.Mesh(ringGeo, ringMat);
        ring.rotation.x = Math.PI/2.2;
        mesh.add(ring);
      }

      const orbit = makeOrbit(data.au * AU);
      orbitsGroup.add(orbit);

      pivot.add(mesh); scene.add(pivot);

      const angle = Math.random()*Math.PI*2;
      pivot.rotation.y = angle;

      const orbitSpeed = (Math.PI*2) / (YEAR_SECONDS * (data.period/365));
      const spin = (Math.PI*2) / (24 + Math.random()*12) / 50; // stylized spin

      // selection glow (sprite)
      const selectGlow = makeGlowSprite(0xffffff, data.size*10); selectGlow.material.opacity = 0; mesh.add(selectGlow);

      const planet = { data, pivot, mesh, orbit, angle, orbitSpeed, spin, selectGlow };
      planets.push(planet);
      return planet;
    }

    PLANETS.forEach(makePlanet);

    // Raycaster for selection
    const raycaster = new THREE.Raycaster();
    const pointer = new THREE.Vector2();
    let pointerDown = null; // {x,y}
    let selected = null; // planet obj

    function setSelected(p){
      selected = p;
      planets.forEach(pl => pl.selectGlow.material.opacity = (pl===p ? 0.45 : 0));
      if(p){
        nameEl.textContent = p.data.name;
        const au = p.data.au.toFixed(2);
        const distKm = (p.data.au*149_597_870).toLocaleString();
        bodyEl.innerHTML = `
          <div class="row"><div class="k">Type</div><div class="v">${p.data.type}</div></div>
          <div class="row"><div class="k">Avg Distance</div><div class="v">${au} AU</div></div>
          <div class="row"><div class="k">Mean Radius</div><div class="v">${p.data.radiusKm.toLocaleString()} km</div></div>
          <div class="row"><div class="k">Orbital Period</div><div class="v">${p.data.period.toLocaleString()} days</div></div>
          <div class="row"><div class="k">Moons</div><div class="v">${p.data.moons}</div></div>
          <p style="opacity:.95; margin:10px 0 0;">${p.data.desc}</p>
        `;
      }else{
        nameEl.textContent = 'Select a planet';
        bodyEl.textContent = 'Tap or click a planet to view details. Use the speed control to accelerate or slow down time.';
      }
    }

    function screenRaycast(ev){
      const rect = renderer.domElement.getBoundingClientRect();
      pointer.x = ((ev.clientX - rect.left) / rect.width) * 2 - 1;
      pointer.y = -((ev.clientY - rect.top) / rect.height) * 2 + 1;
      raycaster.setFromCamera(pointer, camera);
      const meshes = planets.map(p=>p.mesh);
      const hits = raycaster.intersectObjects(meshes, false);
      return hits[0]?.object || null;
    }

    function pickPlanet(ev){
      const hit = screenRaycast(ev);
      if(hit){
        const p = planets.find(pl => pl.mesh === hit);
        setSelected(p);
        flash(statDistance, `Distance: ${p.data.au.toFixed(2)} AU`);
      }
    }

    // Focus camera to selected planet smoothly
    let focusing = null; // {fromPos, toPos, fromTarget, toTarget, t}
    function focusOn(p){
      if(!p) return;
      const worldPos = new THREE.Vector3(); p.mesh.getWorldPosition(worldPos);
      const dir = new THREE.Vector3().subVectors(camera.position, controls.target).normalize();
      const distance = Math.max(12, p.data.size*6 + 10);
      const toTarget = worldPos.clone();
      const toPos = worldPos.clone().add(dir.multiplyScalar(distance));
      focusing = {
        fromPos: camera.position.clone(), toPos,
        fromTarget: controls.target.clone(), toTarget,
        t: 0
      };
    }

    // UI state
    let paused = false;
    let timeScale = parseFloat(localStorage.getItem('sse_speed') || speedEl.value);
    speedEl.value = timeScale; speedOutEl.textContent = timeScale.toFixed(1) + '×';

    // Event wiring
    speedEl.addEventListener('input', (e)=>{
      timeScale = parseFloat(e.target.value);
      localStorage.setItem('sse_speed', String(timeScale));
      speedOutEl.textContent = timeScale.toFixed(1) + '×';
    });

    playBtn.addEventListener('click', ()=>{
      paused = !paused;
      playBtn.setAttribute('aria-pressed', String(!paused));
      playBtn.textContent = paused ? '❚❚' : '▶';
    });

    resetBtn.addEventListener('click', ()=>{
      controls.reset();
      camera.position.set(0,80,220);
      controls.target.set(0,0,0);
      focusing = null;
    });

    toggleOrbitsBtn.addEventListener('click', ()=>{
      const now = !(toggleOrbitsBtn.getAttribute('aria-pressed') === 'true');
      toggleOrbitsBtn.setAttribute('aria-pressed', String(now));
      orbitsGroup.visible = now;
    });

    toggleAutoBtn.addEventListener('click', ()=>{
      const now = !(toggleAutoBtn.getAttribute('aria-pressed') === 'true');
      toggleAutoBtn.setAttribute('aria-pressed', String(now));
      controls.autoRotate = now; controls.autoRotateSpeed = 0.8;
    });

    focusBtn.addEventListener('click', ()=> selected && focusOn(selected));

    // Pointer handling (click vs. drag)
    renderer.domElement.addEventListener('pointerdown', (ev)=>{ pointerDown = {x:ev.clientX, y:ev.clientY}; });
    renderer.domElement.addEventListener('pointerup', (ev)=>{
      if(!pointerDown) return; const dx = ev.clientX - pointerDown.x; const dy = ev.clientY - pointerDown.y; pointerDown = null;
      const moved = Math.hypot(dx,dy) > 5; if(!moved) pickPlanet(ev);
    });

    // Resize
    window.addEventListener('resize', ()=>{
      camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Animation loop
    const clock = new THREE.Clock();
    let lastFpsUpdate = 0;

    function flash(el, text){
      el.textContent = text; el.style.transition = 'none'; el.style.opacity = '1';
      requestAnimationFrame(()=>{ el.style.transition = 'opacity 1.2s ease'; el.style.opacity = '.5'; });
    }

    function update(dt){
      // Rotate sun subtly
      sun.rotation.y += dt * 0.02;

      // Move planets
      const factor = paused ? 0 : (timeScale);
      for(const p of planets){
        p.angle += dt * p.orbitSpeed * factor;
        p.pivot.rotation.y = p.angle;
        p.mesh.rotation.y += dt * p.spin * (0.5 + factor);
      }

      // Smooth focus animation
      if(focusing){
        focusing.t += dt * 1.2; const t = Math.min(1, focusing.t);
        const ease = t<.5 ? 2*t*t : -1 + (4 - 2*t)*t; // easeInOutQuad-ish
        camera.position.lerpVectors(focusing.fromPos, focusing.toPos, ease);
        controls.target.lerpVectors(focusing.fromTarget, focusing.toTarget, ease);
        if(t>=1) focusing = null;
      }

      controls.update();
    }

    function render(){ renderer.render(scene, camera); }

    function loop(){
      const dt = clock.getDelta();
      update(dt);
      render();

      // fps every ~0.5s
      lastFpsUpdate += dt; if(lastFpsUpdate>0.5){ fpsEl.textContent = 'FPS: ' + (1/dt|0); lastFpsUpdate = 0; }

      requestAnimationFrame(loop);
    }

    loop();

    // Initial selection (Earth)
    const earth = planets.find(p=>p.data.key==='earth');
    setSelected(earth);

    // Keyboard helpers
    window.addEventListener('keydown', (e)=>{
      if(e.key===' '){ e.preventDefault(); playBtn.click(); }
      if(e.key==='o' || e.key==='O'){ toggleOrbitsBtn.click(); }
      if(e.key==='f' || e.key==='F'){ focusBtn.click(); }
      if(e.key==='r' || e.key==='R'){ resetBtn.click(); }
    });

  })();
  </script>
</body>
</html>
