<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Target Clicker — 20s Challenge</title>
  <meta name="description" content="Fast-paced target clicking challenge. Hit colorful animated targets for 20 seconds and beat your best score!" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-1: #f6f9ff;
      --bg-2: #eef6ff;
      --ink: #0b1221;
      --muted: #5c688a;
      --brand: #5b8cff;
      --brand-2: #7c6cff;
      --good: #00b894;
      --bad: #ff7675;
      --glass: rgba(255,255,255,0.65);
      --shadow: 0 10px 30px rgba(16,24,40,.10), 0 2px 8px rgba(16,24,40,.06);
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--ink);
      background: radial-gradient(1200px 800px at 15% 10%, #ffffff 0%, var(--bg-1) 50%, var(--bg-2) 100%);
      overflow: hidden;
      user-select: none;
    }

    /* Top HUD */
    .hud {
      position: fixed; inset: 0 0 auto 0; height: 72px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center;
      padding: 12px 16px; gap: 12px; pointer-events: none; z-index: 20;
    }
    .chip {
      pointer-events: auto; display: inline-flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 14px;
      background: var(--glass); box-shadow: var(--shadow); backdrop-filter: blur(10px);
    }
    .chip b { font-weight: 800; letter-spacing: 0.2px; }
    .chip .value { font-weight: 800; font-variant-numeric: tabular-nums; }
    .center { justify-self: center; text-align: center; pointer-events: none; }

    .title { font-weight: 800; letter-spacing: 0.3px; }
    .subtitle { font-size: 12px; color: var(--muted); }

    .bar-wrap { position: fixed; top: 72px; left: 0; width: 100%; height: 6px; background: rgba(0,0,0,0.06); z-index: 19; }
    .bar { height: 100%; width: 100%; background: linear-gradient(90deg, var(--brand), var(--brand-2)); transform-origin: left; }

    /* Playfield */
    .play {
      position: absolute; inset: 0; top: 78px; cursor: crosshair; overflow: hidden;
    }

    /* Start + Results Overlay */
    .overlay { position: absolute; inset: 0; display: grid; place-items: center; z-index: 30; }
    .panel {
      width: min(720px, calc(100% - 32px));
      background: var(--glass);
      border-radius: 20px; box-shadow: var(--shadow); padding: 28px; backdrop-filter: blur(12px);
      animation: float-in 480ms cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes float-in { from { transform: translateY(12px) scale(.98); opacity: 0; } }

    .actions { display: flex; gap: 12px; flex-wrap: wrap; }
    .btn {
      appearance: none; border: 0; border-radius: 12px; padding: 14px 18px; font-weight: 800; letter-spacing: .3px; cursor: pointer;
      background: linear-gradient(180deg, var(--brand), var(--brand-2)); color: #fff; box-shadow: 0 10px 24px rgba(91,140,255,.35);
      transition: transform .12s ease, filter .2s ease; will-change: transform;
    }
    .btn:hover { transform: translateY(-1px); filter: brightness(1.05); }
    .btn:active { transform: translateY(0); filter: brightness(.96); }
    .btn.secondary { background: #fff; color: var(--ink); box-shadow: var(--shadow); }

    /* Target */
    .target {
      position: absolute; display: grid; place-items: center; width: var(--size); height: var(--size);
      transform: translate(-50%, -50%); border-radius: 50%;
      animation: rise 1000ms ease-out both;
      pointer-events: auto;
    }
    @keyframes rise { from { transform: translate(-50%, -50%) scale(.75); opacity: 0 } to { transform: translate(-50%, -50%) scale(1); opacity: 1 } }

    .ring {
      position: absolute; inset: 0; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff 0 18%, rgba(255,255,255,.0) 19%),
                  conic-gradient(from 0deg, #ff8a8a, #ffd36e, #87f7a0, #7ecbff, #d9a0ff, #ff8a8a);
      filter: saturate(1.1) contrast(1.05);
      animation: spin 1.8s linear infinite;
    }
    .ring::after {
      content: ""; position: absolute; inset: 12%; border-radius: 50%; background: rgba(255,255,255,.85);
      box-shadow: inset 0 0 20px rgba(0,0,0,.06);
    }
    .halo { position: absolute; inset: -18%; border-radius: 50%; filter: blur(10px); opacity: .65; background: radial-gradient(closest-side, rgba(91,140,255,.55), rgba(124,108,255,.15), transparent 70%); animation: pulse 1200ms ease-in-out infinite; }
    @keyframes spin { to { transform: rotate(360deg) } }
    @keyframes pulse { 0%, 100% { opacity: .55; transform: scale(.98) } 50% { opacity: .8; transform: scale(1.04) } }

    /* Miss ripple */
    .ripple { position: absolute; width: 16px; height: 16px; border-radius: 50%; border: 2px solid rgba(91,140,255,.75); transform: translate(-50%, -50%); animation: ripple 600ms ease-out both; pointer-events: none; }
    @keyframes ripple { from { opacity: .6; transform: translate(-50%, -50%) scale(.5) } to { opacity: 0; transform: translate(-50%, -50%) scale(4) } }

    /* Confetti */
    .confetti { position: absolute; inset: 0; overflow: hidden; pointer-events: none; }
    .confetti i { position: absolute; width: 8px; height: 14px; border-radius: 2px; opacity: 0; animation: fall linear forwards; transform: translateY(-20vh) rotate(0deg); }
    @keyframes fall { to { transform: translateY(120vh) rotate(720deg); opacity: 1; } }

    /* Responsive tweaks */
    @media (max-width: 600px) {
      .hud { height: 68px; }
      .bar-wrap { top: 68px; }
      .title { font-size: 16px; }
      .panel { padding: 22px; }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>
  <!-- HUD -->
  <div class="hud" aria-hidden="true">
    <div class="chip" id="scoreChip" title="Score">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3l2.09 4.24L19 8.27l-3.27 3.19.77 4.49L12 14.77l-4.5 2.37.86-4.49L5 8.27l4.91-1.03L12 3z" stroke="currentColor" stroke-width="1.6"/></svg>
      <span><b>Score</b> <span class="value" id="score">0</span></span>
    </div>
    <div class="center">
      <div class="title">Target Clicker</div>
      <div class="subtitle"><span id="status">Ready</span> • <span id="timerText">20.0s</span></div>
    </div>
    <div class="chip" id="accChip" title="Accuracy">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3v3m0 12v3M3 12h3m12 0h3M5.64 5.64l2.12 2.12m8.48 8.48l2.12 2.12M5.64 18.36l2.12-2.12m8.48-8.48l2.12-2.12" stroke="currentColor" stroke-width="1.6"/><circle cx="12" cy="12" r="5.5" stroke="currentColor" stroke-width="1.6"/></svg>
      <span><b>Accuracy</b> <span class="value" id="accuracy">—</span></span>
    </div>
  </div>
  <div class="bar-wrap" aria-hidden="true"><div class="bar" id="timeBar"></div></div>

  <!-- Playfield -->
  <div class="play" id="play" role="application" aria-label="Target clicking playfield"></div>

  <!-- Overlay (Start/End) -->
  <div class="overlay" id="overlay">
    <div class="panel">
      <h1 style="margin:0 0 6px 0">20‑Second Target Challenge</h1>
      <p style="margin:0 0 18px 0; color: var(--muted); max-width: 60ch">Click the colorful animated targets as they appear. You have 20 seconds. Aim for a high score and pinpoint accuracy. Misses count!</p>
      <div class="actions" style="margin-top:6px">
        <button class="btn" id="startBtn" aria-label="Start game">Start 20s Game</button>
        <button class="btn secondary" id="howBtn" aria-label="How to play">How it works</button>
      </div>
    </div>
  </div>

  <!-- Live regions for screen readers -->
  <div aria-live="polite" aria-atomic="true" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden">
    <span id="srUpdate"></span>
  </div>

  <script>
  (function(){
    const DURATION = 20_000; // 20s
    const MIN_SPAWN = 280, MAX_SPAWN = 520; // spawn every ~0.3–0.5s
    const TTL_MIN = 850, TTL_MAX = 1200; // target lifetime
    const SIZE_MIN = 54, SIZE_MAX = 96;
    const MAX_ONSCREEN = 3;

    const play = document.getElementById('play');
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('startBtn');
    const howBtn = document.getElementById('howBtn');
    const scoreEl = document.getElementById('score');
    const accEl = document.getElementById('accuracy');
    const statusEl = document.getElementById('status');
    const timeBar = document.getElementById('timeBar');
    const timerText = document.getElementById('timerText');
    const srUpdate = document.getElementById('srUpdate');

    let state = {
      active: false,
      start: 0,
      timerId: null,
      spawnId: null,
      hits: 0,
      clicks: 0,
      misses: 0,
      onscreen: new Set(),
      best: Number(localStorage.getItem('tc_best')||0)
    };

    function rnd(min, max){ return Math.random() * (max - min) + min; }
    function rndInt(min, max){ return Math.floor(rnd(min, max)); }
    function clamp(n, a, b){ return Math.min(b, Math.max(a, n)); }

    function setStatus(t){ statusEl.textContent = t; }

    function reset(){
      // Clear lingering targets
      [...state.onscreen].forEach(el => el.remove());
      state.onscreen.clear();
      state.hits = 0; state.clicks = 0; state.misses = 0;
      scoreEl.textContent = '0';
      accEl.textContent = '—';
      timeBar.style.transform = 'scaleX(1)';
      timerText.textContent = (DURATION/1000).toFixed(1)+ 's';
      play.style.cursor = 'crosshair';
    }

    function formatPct(num){ return (num*100).toFixed(0) + '%'; }

    function accuracy(){ return state.clicks === 0 ? 0 : (state.hits / state.clicks); }

    function updateHUD(){
      scoreEl.textContent = state.hits;
      accEl.textContent = state.clicks ? formatPct(accuracy()) : '—';
    }

    function ripple(x, y){
      const r = document.createElement('div');
      r.className = 'ripple'; r.style.left = x+'px'; r.style.top = y+'px';
      play.appendChild(r);
      setTimeout(()=>r.remove(), 620);
    }

    function spawnTarget(){
      if (!state.active) return;
      if (state.onscreen.size >= MAX_ONSCREEN) return;

      const rect = play.getBoundingClientRect();
      const size = rndInt(SIZE_MIN, SIZE_MAX);
      const pad = size * 0.6 + 10;
      const x = rnd(rect.left + pad, rect.right - pad);
      const y = rnd(rect.top + pad, rect.bottom - pad);
      const ttl = rndInt(TTL_MIN, TTL_MAX);

      const t = document.createElement('button');
      t.className = 'target';
      t.setAttribute('aria-label','Target');
      t.style.setProperty('--size', size+'px');
      t.style.left = x+'px'; t.style.top = y+'px';
      t.style.border = '0'; t.style.background = 'transparent'; t.style.padding = '0';

      const halo = document.createElement('div'); halo.className = 'halo';
      const ring = document.createElement('div'); ring.className = 'ring';
      t.append(halo, ring);

      const remove = () => { if (t.parentNode){ state.onscreen.delete(t); t.remove(); } };

      const onClick = (ev) => {
        ev.stopPropagation();
        if (!state.active) return;
        state.hits++; state.clicks++;
        updateHUD();
        // burst effect
        t.style.transition = 'transform 120ms ease, opacity 160ms ease';
        t.style.transform = 'translate(-50%,-50%) scale(1.25)';
        t.style.opacity = '0';
        setTimeout(remove, 120);
      };

      t.addEventListener('click', onClick, { once: true });
      play.appendChild(t);
      state.onscreen.add(t);
      setTimeout(remove, ttl);
    }

    function scheduleSpawns(){
      const tick = () => {
        if (!state.active) return;
        spawnTarget();
        const nextIn = rndInt(MIN_SPAWN, MAX_SPAWN);
        state.spawnId = setTimeout(tick, nextIn);
      };
      state.spawnId = setTimeout(tick, 220);
    }

    function startGame(){
      reset();
      overlay.style.display = 'none';
      state.active = true; state.start = performance.now();
      setStatus('Go!');
      scheduleSpawns();
      const step = () => {
        if (!state.active) return;
        const elapsed = performance.now() - state.start;
        const left = clamp(DURATION - elapsed, 0, DURATION);
        const p = left / DURATION;
        timeBar.style.transform = `scaleX(${p})`;
        timerText.textContent = (left/1000).toFixed(1) + 's';
        if (left <= 0) { endGame(); return; }
        state.timerId = requestAnimationFrame(step);
      };
      state.timerId = requestAnimationFrame(step);
    }

    function endGame(){
      state.active = false;
      clearTimeout(state.spawnId);
      cancelAnimationFrame(state.timerId);
      setStatus('Finished');
      play.style.cursor = 'default';
      // remove remaining targets gracefully
      [...state.onscreen].forEach(el=>{
        el.style.transition = 'transform 160ms ease, opacity 180ms ease';
        el.style.transform = 'translate(-50%,-50%) scale(.8)';
        el.style.opacity = '0';
        setTimeout(()=>el.remove(), 180);
      });
      state.onscreen.clear();

      const acc = accuracy();
      const score = state.hits;
      const bestBefore = state.best;
      if (score > state.best){ state.best = score; localStorage.setItem('tc_best', String(score)); }

      showResults({ score, accuracy: acc, clicks: state.clicks, hits: state.hits, misses: state.misses, best: state.best, improved: score>bestBefore });
      fireConfetti();
      srUpdate.textContent = `Game over. Score ${score}. Accuracy ${(acc*100).toFixed(0)} percent.`;
    }

    function showResults(r){
      const pct = formatPct(r.accuracy);
      const grade = r.accuracy >= 0.9 ? 'Sharpshooter' : r.accuracy >= 0.75 ? 'Sniper' : r.accuracy >= 0.5 ? 'Ranger' : 'Wildcard';
      overlay.innerHTML = `
        <div class="panel" role="dialog" aria-modal="true" aria-label="Results">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap">
            <h2 style="margin:0">Results</h2>
            <span style="font-weight:600; color: var(--muted)">20‑Second Challenge</span>
          </div>
          <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 16px 0 18px 0">
            <div class="chip" style="justify-content:center"><span><b>Score</b> <span class="value" style="font-size:22px">${r.score}</span></span></div>
            <div class="chip" style="justify-content:center"><span><b>Accuracy</b> <span class="value" style="font-size:22px">${pct}</span></span></div>
            <div class="chip" style="justify-content:center"><span><b>Clicks</b> <span class="value" style="font-size:22px">${r.clicks}</span></span></div>
          </div>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:18px">
            <span class="chip" title="Hits"><b>Hits</b> <span class="value">${r.hits}</span></span>
            <span class="chip" title="Misses" style="color: var(--bad)"><b>Misses</b> <span class="value">${r.misses}</span></span>
            <span class="chip" title="Rank" style="color: var(--good)"><b>Rank</b> <span class="value">${grade}${r.improved? ' • New Best!' : ''}</span></span>
            <span class="chip" title="Best"><b>Best</b> <span class="value">${r.best}</span></span>
          </div>
          <div class="actions">
            <button class="btn" id="againBtn">Play Again</button>
            <button class="btn secondary" id="shareBtn">Share</button>
          </div>
        </div>
        <div class="confetti" aria-hidden="true" id="confetti"></div>
      `;
      overlay.style.display = 'grid';
      document.getElementById('againBtn').addEventListener('click', ()=>{ startGame(); });
      document.getElementById('shareBtn').addEventListener('click', ()=>shareResults(r));
    }

    function shareResults(r){
      const pct = (r.accuracy*100).toFixed(0);
      const txt = `I scored ${r.score} with ${pct}% accuracy in Target Clicker (20s)! Can you beat me?`;
      if (navigator.share){
        navigator.share({ title: 'Target Clicker — 20s', text: txt }).catch(()=>{});
      } else {
        navigator.clipboard?.writeText(txt).then(()=>{
          toast('Copied summary to clipboard');
        }).catch(()=>{
          alert(txt);
        });
      }
    }

    function toast(message){
      const t = document.createElement('div');
      t.className = 'chip'; t.style.position = 'fixed'; t.style.left = '50%'; t.style.bottom = '18px'; t.style.transform = 'translateX(-50%)'; t.style.zIndex = 40;
      t.innerHTML = `<b>Copied</b> <span class="value">${message}</span>`;
      document.body.appendChild(t);
      setTimeout(()=>{ t.style.transition='opacity .2s ease, transform .2s ease'; t.style.opacity='0'; t.style.transform='translateX(-50%) translateY(6px)'; setTimeout(()=>t.remove(), 220); }, 1200);
    }

    function fireConfetti(){
      const container = document.getElementById('confetti');
      if (!container) return;
      container.innerHTML = '';
      const colors = ['#5b8cff', '#7c6cff', '#ffd36e', '#87f7a0', '#ff8a8a', '#d9a0ff'];
      const N = 90;
      for (let i=0;i<N;i++){
        const el = document.createElement('i');
        const left = Math.random()*100; // vw
        const delay = Math.random()*0.1 + (i/N)*0.9; // stagger
        const dur = 1.2 + Math.random()*0.8;
        const bg = colors[i % colors.length];
        el.style.left = left+'%';
        el.style.background = bg;
        el.style.animationDuration = dur+'s';
        el.style.animationDelay = delay+'s';
        container.appendChild(el);
      }
    }

    // Miss clicks on playfield
    play.addEventListener('click', (e)=>{
      if (!state.active) return;
      state.clicks++; state.misses++;
      updateHUD();
      ripple(e.clientX, e.clientY);
    });

    // How it works
    howBtn.addEventListener('click', ()=>{
      alert('Click targets as they appear. You have 20 seconds. Each click counts toward accuracy: hits vs total clicks. Try to keep accuracy high!');
    });

    // Start button
    startBtn.addEventListener('click', startGame);

    // Keyboard support
    window.addEventListener('keydown', (e)=>{
      if (e.key === ' ' || e.key === 'Enter'){
        if (overlay.style.display !== 'none') startGame();
      }
    });

    // On load, show best in overlay subtitle if present
    (function showBestOnLoad(){
      if (state.best > 0){
        const sub = overlay.querySelector('p');
        if (sub) sub.innerHTML += ` <span style="color: var(--ink); font-weight:600">Best: ${state.best}</span>`;
      }
    })();
  })();
  </script>
</body>
</html>
