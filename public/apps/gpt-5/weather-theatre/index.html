<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather Theatre • React + Canvas</title>
  <meta name="theme-color" content="#1a1a1a" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0c10;
      --gold:#f7c66a;
      --scarlet:#a80d1a;
      --curtain:#b01724;
      --ink:#1b1f2a;
      --panel:#10131a;
      --panel-2:#0b0e14;
      --accent:#6bc5ff;
      --accent-2:#9df1d4;
      --night:#0a0e1a;
      --day:#f0f6ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:#e8eef7;
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 600px at 15% -10%, rgba(255,255,255,.08), transparent 60%),
        radial-gradient(1000px 500px at 85% -20%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, #0a0d14 0%, #0a0d14 40%, #07090e 100%);
      overflow-x:hidden;
    }
    .container{max-width:1120px;margin:40px auto;padding:0 20px}
    .title{
      font-family:"Playfair Display", serif;
      letter-spacing:.5px;
      font-weight:700;
      font-size:34px;
      display:flex;align-items:center;gap:14px;
    }
    .title .dot{width:10px;height:10px;border-radius:50%;background:var(--gold);box-shadow:0 0 10px 2px rgba(247,198,106,.6),0 0 30px rgba(247,198,106,.25)}
    .subtitle{opacity:.85;margin-top:6px}

    .marquee{
      margin:22px 0 16px 0;
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 16px;border-radius:12px;
      background:linear-gradient(180deg, #121621, #0c101a);
      border:1px solid rgba(255,255,255,.06);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06), 0 10px 30px rgba(0,0,0,.35);
    }
    .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#121621;border:1px solid rgba(255,255,255,.08)}
    .badge .lamp{width:8px;height:8px;border-radius:50%;background:var(--gold);box-shadow:0 0 10px rgba(247,198,106,.9)}
    .forecast{display:flex;gap:14px;align-items:baseline;font-feature-settings:"tnum" 1, "lnum" 1}
    .forecast .temp{font-size:28px;font-weight:700;color:#ffffff}
    .forecast .meta{opacity:.85}

    .stage-wrap{position:relative;border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg, #0a0d14, #0a0d14);box-shadow:0 20px 60px rgba(0,0,0,.5)}
    .stage{position:relative;width:100%;padding-top:56.25%; /* 16:9 */}
    canvas.stage-canvas{position:absolute;inset:0;width:100%;height:100%;display:block}

    /* Theatrical curtain */
    .curtain{position:absolute;inset:0;pointer-events:none}
    .drape{position:absolute;top:0;bottom:0;width:55%;background:
        radial-gradient(120px 120px at 30% 8%, rgba(255,255,255,.06), rgba(255,255,255,0) 60%),
        repeating-linear-gradient(90deg, rgba(0,0,0,.08) 0 8px, rgba(255,255,255,.04) 8px 16px),
        linear-gradient(180deg, #a10d1c, #7f0d18);
      box-shadow:inset -30px 0 60px rgba(0,0,0,.45), inset 0 -40px 80px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.06);
      transform:translateX(0);
      transition:transform 1400ms cubic-bezier(.22,.9,.25,1.02);
    }
    .drape.left{left:0;border-right:2px solid rgba(0,0,0,.35)}
    .drape.right{right:0;border-left:2px solid rgba(0,0,0,.35)}
    .valance{position:absolute;left:0;right:0;top:0;height:18%;background:
        linear-gradient(180deg, #8e0f1b, #6e0d16 70%, #36060c),
        radial-gradient(800px 100px at 50% 100%, rgba(0,0,0,.45), transparent 60%);
      border-bottom:2px solid rgba(0,0,0,.35);
      box-shadow:inset 0 -25px 40px rgba(0,0,0,.55)
    }
    .curtain.open .drape.left{transform:translateX(-102%)}
    .curtain.open .drape.right{transform:translateX(102%)}

    /* Spotlight overlay (CSS layer over canvas to add stage vibe) */
    .spotlights{position:absolute;inset:0;pointer-events:none;mix-blend-mode:screen;opacity:.9}
    .spot{position:absolute;width:40vmax;height:40vmax;border-radius:50%;filter:blur(26px);background:radial-gradient(circle at 50% 50%, rgba(255,247,200,.7), rgba(255,247,200,.05) 60%, transparent 70%);animation: sweep 8s ease-in-out infinite}
    .spot.slow{animation-duration:12s}
    .spot.fast{animation-duration:6s}
    @keyframes sweep{0%{transform:translate(-20%,-15%)}50%{transform:translate(70%,10%)}100%{transform:translate(-20%,-15%)}}

    /* Controls */
    .panel{margin-top:16px;background:linear-gradient(180deg, var(--panel), var(--panel-2));border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px;box-shadow:inset 0 1px 0 rgba(255,255,255,.06)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;align-items:center}
    .g-6{grid-column:span 6}
    .g-4{grid-column:span 4}
    .g-3{grid-column:span 3}
    .g-2{grid-column:span 2}
    .g-8{grid-column:span 8}
    @media (max-width:980px){.grid{grid-template-columns:1fr}.g-6,.g-4,.g-3,.g-2,.g-8{grid-column:span 1}}

    .label{font-size:12px;letter-spacing:.3px;text-transform:uppercase;opacity:.8;margin-bottom:6px}
    .slider{appearance:none;width:100%;height:10px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);position:relative}
    .slider::-webkit-slider-thumb{appearance:none;width:22px;height:22px;border-radius:50%;background:linear-gradient(180deg,#fff,#e6edf7);border:1px solid rgba(0,0,0,.25);box-shadow:0 6px 14px rgba(0,0,0,.35), 0 0 0 4px rgba(107,197,255,.2)}
    .slider::-moz-range-thumb{width:22px;height:22px;border-radius:50%;background:#fff;border:none}
    .row{display:flex;gap:14px;align-items:center}
    .pill{display:inline-flex;align-items:center;gap:10px;background:#0e1220;border:1px solid rgba(255,255,255,.08);padding:10px 12px;border-radius:999px}
    .button{cursor:pointer;user-select:none;display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(180deg,#1a2031,#121828);color:#fff;transition:transform .05s ease, box-shadow .2s ease}
    .button:hover{box-shadow:0 6px 22px rgba(0,0,0,.35)}
    .button:active{transform:translateY(1px)}
    .accent{background:linear-gradient(180deg, #2a6fff, #2456e0);border-color:rgba(0,0,0,.4)}
    .accent-2{background:linear-gradient(180deg, #0ea072, #0a805b)}
    .ghost{background:linear-gradient(180deg,#151a28,#0f1420)}

    .switch{position:relative;width:76px;height:34px;border-radius:999px;background:linear-gradient(180deg,#12182a,#0b0f1c);border:1px solid rgba(255,255,255,.1);cursor:pointer;box-shadow:inset 0 1px 0 rgba(255,255,255,.06)}
    .knob{position:absolute;top:3px;left:3px;width:28px;height:28px;border-radius:50%;background:linear-gradient(180deg,#f6f8ff,#ccd6ee);box-shadow:0 6px 16px rgba(0,0,0,.35);transition:left .25s cubic-bezier(.2,.8,.2,1)}
    .switch.on .knob{left:45px}
    .switch .icon{position:absolute;top:50%;transform:translateY(-50%);opacity:.9}
    .switch .icon.sun{left:10px;color:#ffb545}
    .switch .icon.moon{right:10px;color:#a0c9ff}

    .caption{margin-top:14px;text-align:center;font-family:"Playfair Display",serif;font-size:18px;color:#eaeffc;min-height:28px}
    .caption em{color:var(--gold);font-style:normal}

    /* Tiny shimmering footlights */
    .footlights{position:absolute;left:0;right:0;bottom:0;height:18px;background:radial-gradient(60% 100% at 50% 0%, rgba(255,255,255,.08), rgba(0,0,0,0) 70%)}

    /* Helper utilities */
    .muted{opacity:.75}
    .right{margin-left:auto}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
  ;(function(){
    const {useEffect, useMemo, useRef, useState} = React;

    // Utilities
    const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
    const lerp=(a,b,t)=>a+(b-a)*t;
    const ease=(t)=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
    function rand(a=1,b=0){if(b===0){b=a;a=0}return Math.random()*(b-a)+a}
    function prng(seed){let s = seed>>>0; return ()=>{s=(s*1664525+1013904223)>>>0; return s/4294967296}}

    // Simple 2D noise using value noise
    function makeNoise(seed=1){
      const rnd=prng(seed);
      const gradX=new Float32Array(512);
      const gradY=new Float32Array(512);
      for(let i=0;i<512;i++){const a=rnd()*Math.PI*2;gradX[i]=Math.cos(a);gradY[i]=Math.sin(a)}
      const perm=new Uint16Array(512);for(let i=0;i<256;i++){perm[i]=i}for(let i=255;i>0;i--){const j=(rnd()*i)|0;const t=perm[i];perm[i]=perm[j];perm[j]=t}for(let i=0;i<256;i++)perm[i+256]=perm[i];
      function fade(t){return t*t*t*(t*(t*6-15)+10)}
      function dotGrid(ix,iy,x,y){const g=perm[(ix+perm[iy&255])&255];const dx=x-ix,dy=y-iy;return dx*gradX[g]+dy*gradY[g]}
      return function(x,y){const x0=Math.floor(x), y0=Math.floor(y);const x1=x0+1,y1=y0+1;const sx=fade(x-x0), sy=fade(y-y0);
        const n0=dotGrid(x0,y0,x,y); const n1=dotGrid(x1,y0,x,y); const ix0=lerp(n0,n1,sx);
        const n2=dotGrid(x0,y1,x,y); const n3=dotGrid(x1,y1,x,y); const ix1=lerp(n2,n3,sx);
        return lerp(ix0,ix1,sy);
      }
    }

    // Mock forecast
    function mockForecast(){
      const now=new Date();
      const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]; const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      const label = days[now.getDay()]+", "+months[now.getMonth()]+" "+now.getDate();
      return {
        label,
        condition:"Partly Cloudy",
        tempF:72,
        wind:rand(6,12).toFixed(0)+" mph",
        precip:20,
      };
    }

    function useTypewriter(text, speed=28){
      const [out,setOut]=useState("");
      useEffect(()=>{
        let i=0; let raf; let last=0; function step(ts){if(!last) last=ts; const dt=ts-last; if(dt>speed){last=ts; i++; setOut(text.slice(0,i))} if(i<text.length){raf=requestAnimationFrame(step)}}; cancelAnimationFrame(raf); setOut(""); raf=requestAnimationFrame(step); return ()=>cancelAnimationFrame(raf)} , [text,speed]);
      return out;
    }

    function useResizeObserver(ref, cb){
      useEffect(()=>{ if(!ref.current) return; const ro=new ResizeObserver(()=>cb()); ro.observe(ref.current); return ()=>ro.disconnect(); }, [ref,cb]);
    }

    // Map sliders to scene parameters
    function mapMood({cosy, eerie, heroic}, isNight){
      const coz=cosy/100, eer=eerie/100, her=heroic/100;
      const warmth = lerp(0.15, 0.85, coz) * (isNight?0.65:1);
      const fog = lerp(0.0, 0.6, eer);
      const drama = lerp(0.2, 1.0, her);
      const wind = clamp( lerp(0.2, 1.2, her) - lerp(0, .4, coz) + lerp(0, .3, eer), 0.05, 1.6 );
      const cloudDensity = clamp(0.25 + eer*0.35 + coz*0.2, 0.15, 0.85);
      const spotlight = clamp(0.25 + her*0.75, 0.25, 1.5);
      const color = palette(warmth, isNight);
      const precip = eer*0.6 + (1-coz)*0.1; // mood-based rain chance
      const rays = her>0.4 ? her : 0;
      return {warmth,fog,drama,wind,cloudDensity,spotlight,color,precip,rays};
    }

    function palette(warmth, night){
      // warmth in [0..1]
      const coolSky = {top: [12,25,58], bottom:[24,40,85]};
      const warmSky = {top: [38,22,48], bottom:[255,166,105]};
      function mix(a,b,t){return a.map((v,i)=>Math.round(lerp(v,b[i],t)))}
      const top = night ? mix([2,6,20],[18,24,56], warmth*0.4) : mix(coolSky.top, warmSky.top, warmth);
      const bottom = night ? mix([4,8,24],[32,46,86], warmth*0.4) : mix(coolSky.bottom, warmSky.bottom, warmth);
      const sun = night ? [220,234,255] : mix([255,236,200],[255,210,120], warmth);
      const hillA = night ? mix([15,22,40],[26,30,52], warmth*0.7) : mix([26,46,68],[42,56,72], warmth*.4);
      const hillB = night ? mix([10,16,28],[18,22,38], warmth*0.6) : mix([20,35,52],[32,44,60], warmth*.35);
      return {skyTop:top, skyBottom:bottom, sun:sun, hillA:hillA, hillB:hillB};
    }

    function rgba(arr, a=1){return `rgba(${arr[0]}, ${arr[1]}, ${arr[2]}, ${a})`}

    function StageCanvas({mood, isNight, forecast, onAfterReveal}){
      const wrapRef=useRef(null);
      const ref=useRef(null);
      const stateRef=useRef({});
      const [open,setOpen]=useState(false);

      useEffect(()=>{ const t=setTimeout(()=>{setOpen(true); onAfterReveal && onAfterReveal();}, 900); return ()=>clearTimeout(t); },[]);

      useEffect(()=>{
        const canvas=ref.current; if(!canvas) return; const ctx=canvas.getContext('2d');
        let dpr=window.devicePixelRatio||1; let w=0,h=0; let running=true; let t0=performance.now();
        const noise = makeNoise(1312);
        function resize(){ const r=wrapRef.current.getBoundingClientRect(); w=r.width; h=r.height; canvas.width=w*dpr; canvas.height=h*dpr; canvas.style.width=w+'px'; canvas.style.height=h+'px'; ctx.setTransform(dpr,0,0,dpr,0,0)}
        resize();
        const onResize=()=>resize();
        window.addEventListener('resize', onResize);

        // Scene objects
        const clouds=[]; const stars=[]; const drops=[]; const sparkles=[];
        const cloudCount=18; const starCount=140;
        for(let i=0;i<cloudCount;i++){
          clouds.push({x:rand(-.2,1.1), y:rand(.05,.6), z:rand(.2,1), w:rand(120,320), h:rand(40,90), p:rand(0,1000)});
        }
        for(let i=0;i<starCount;i++) stars.push({x:Math.random(), y:Math.random()*0.55, b:rand(0.2,1), r:rand(0.4,1.3), s:Math.random()});

        function drawMountains(){
          const p=mapMood(mood,isNight);
          // Back hill
          ctx.fillStyle=rgba(p.color.hillB,1);
          ctx.beginPath();
          const y0=h*0.78; ctx.moveTo(-50,y0);
          for(let i=0;i<=16;i++){ const x=(i/16)*w; const y=y0 - Math.sin((i/16)*Math.PI*2)*28 - (i%2?30:0); ctx.lineTo(x,y)}
          ctx.lineTo(w+50,h+50); ctx.lineTo(-50,h+50); ctx.closePath(); ctx.fill();
          // Front hill
          ctx.fillStyle=rgba(p.color.hillA,1);
          ctx.beginPath();
          const y1=h*0.86; ctx.moveTo(-50,y1);
          for(let i=0;i<=18;i++){ const x=(i/18)*w; const y=y1 - Math.sin((i/18)*Math.PI*2+0.3)*34 - (i%3?26:0); ctx.lineTo(x,y)}
          ctx.lineTo(w+50,h+50); ctx.lineTo(-50,h+50); ctx.closePath(); ctx.fill();
        }

        function drawSky(){
          const p=mapMood(mood,isNight);
          const g=ctx.createLinearGradient(0,0,0,h);
          g.addColorStop(0, rgba(p.color.skyTop,1));
          g.addColorStop(1, rgba(p.color.skyBottom,1));
          ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
          // sun/moon
          const cx=w*0.76, cy=h*0.22;
          const r=isNight? 30: 44;
          const radial=ctx.createRadialGradient(cx,cy,2,cx,cy,r*2.2);
          if(isNight){ radial.addColorStop(0, rgba([210,226,255],.95)); radial.addColorStop(1, rgba([120,150,220],0)); }
          else{ radial.addColorStop(0, rgba(p.color.sun,.95)); radial.addColorStop(1, rgba([255,220,150],0)); }
          ctx.globalCompositeOperation='lighter'; ctx.fillStyle=radial; ctx.beginPath(); ctx.arc(cx,cy,r*2.2,0,Math.PI*2); ctx.fill(); ctx.globalCompositeOperation='source-over';
        }

        function drawStars(t){ if(!isNight) return; ctx.save(); ctx.globalCompositeOperation='lighter';
          for(const s of stars){ const x=s.x*w; const y=s.y*h; const tw= (Math.sin(t*0.002+s.s*7)+1)/2; const a = 0.2 + tw*0.7*s.b; const grad=ctx.createRadialGradient(x,y,0,x,y,1.6*s.r); grad.addColorStop(0,`rgba(255,255,255,${a})`); grad.addColorStop(1,'rgba(255,255,255,0)'); ctx.fillStyle=grad; ctx.beginPath(); ctx.arc(x,y,1.6*s.r,0,Math.PI*2); ctx.fill(); }
          ctx.restore();
        }

        function drawGodRays(t){ const p=mapMood(mood,isNight); if(p.rays<=0 || isNight) return; const cx=w*0.76, cy=h*0.22; const count=Math.floor(6+ p.rays*10); ctx.save(); ctx.globalCompositeOperation='screen';
          for(let i=0;i<count;i++){ const ang = Math.sin(t*0.00025 + i*0.7)*0.25 + (i/count)*0.2; const len=h*0.9; const wth= 80 + i*14; const x2=cx+Math.cos(ang)*len; const y2=cy+Math.sin(ang)*len; const g=ctx.createLinearGradient(cx,cy,x2,y2); g.addColorStop(0, 'rgba(255,240,190,0.22)'); g.addColorStop(0.5, 'rgba(255,244,200,0.08)'); g.addColorStop(1, 'rgba(255,255,255,0)'); ctx.strokeStyle=g; ctx.lineWidth=wth; ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x2,y2); ctx.stroke(); }
          ctx.restore(); }

        function drawClouds(t){ const p=mapMood(mood,isNight); const baseAlpha = 0.35 + p.fog*0.2 + p.cloudDensity*0.25; ctx.save();
          for(const c of clouds){ c.x += (0.00002 + p.wind*0.00008) * (1.4 - c.z); if(c.x>1.2) c.x=-.3; const x=c.x*w, y=c.y*h; const scale=lerp(.8,1.4,c.z)*(isNight?0.95:1);
            // shape via noise blobby
            const grad=ctx.createLinearGradient(x,y-20*scale,x,y+20*scale); grad.addColorStop(0,`rgba(255,255,255,${baseAlpha*(isNight?0.7:1)*(0.85)})`); grad.addColorStop(1,`rgba(${isNight?140:230},${isNight?170:240},${isNight?210:255},${baseAlpha*(isNight?0.55:0.7)})`);
            ctx.fillStyle=grad; ctx.beginPath(); const puff=6; for(let i=0;i<puff;i++){ const px = x + (i-(puff-1)/2) * (c.w/puff) * 0.9; const py=y + Math.sin(i*1.2 + t*0.001 + c.p*0.01)*8; const r= c.h*scale * (0.6 + 0.25*Math.cos(i*1.7 + c.p)); ctx.moveTo(px+r,py); ctx.arc(px,py,r,0,Math.PI*2); }
            ctx.fill();
          }
          // fog layer
          if(p.fog>0.02){ const gh= ctx.createLinearGradient(0,h*0.6,0,h); gh.addColorStop(0,`rgba(200,220,240,${0.0})`); gh.addColorStop(1,`rgba(200,220,240,${0.35*p.fog})`); ctx.fillStyle=gh; ctx.fillRect(0,0,w,h); }
          ctx.restore();
        }

        function ensureRain(n){ while(drops.length<n){ drops.push({x:Math.random()*w, y:Math.random()*h, v:rand(220,380)}) } while(drops.length>n){ drops.pop() } }
        function drawRain(dt){ const p=mapMood(mood,isNight); const amount = Math.floor(p.precip*500); ensureRain(amount); if(amount<=0) return; ctx.save(); ctx.strokeStyle=`rgba(${isNight?150:180},${isNight?175:195},${isNight?210:220},0.45)`; ctx.lineWidth=1; ctx.beginPath(); for(const d of drops){ d.y += d.v*dt*(0.001 + p.wind*0.0007); d.x += p.wind*60*dt*0.001; if(d.y>h){ d.y = -Math.random()*50; d.x=Math.random()*w } ctx.moveTo(d.x,d.y); ctx.lineTo(d.x-2,d.y-8); } ctx.stroke(); ctx.restore(); }

        function drawSparkles(t){ const p=mapMood(mood,isNight); const want = Math.floor(p.warmth*18); while(sparkles.length<want){ sparkles.push({x:Math.random()*w, y:h*0.86 + Math.random()*h*0.12, s:rand(0.6,1.4), p:Math.random()*1000}) } while(sparkles.length>want){ sparkles.pop() }
          ctx.save(); ctx.globalCompositeOperation='screen'; for(const s of sparkles){ const k=(Math.sin(t*0.002+s.p)+1)/2; const a=0.12 + 0.35*k; const gr=ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,4*s.s); gr.addColorStop(0,`rgba(255,220,120,${a})`); gr.addColorStop(1,'rgba(255,220,120,0)'); ctx.fillStyle=gr; ctx.beginPath(); ctx.arc(s.x,s.y,4*s.s,0,Math.PI*2); ctx.fill(); }
          ctx.restore();
        }

        function frame(ts){ if(!running) return; const dt=(ts-t0); t0=ts; const p=mapMood(mood,isNight);
          drawSky(); drawStars(ts); drawGodRays(ts); drawClouds(ts); drawMountains(); drawRain(dt); drawSparkles(ts);
          // vignette
          ctx.save(); const vg=ctx.createRadialGradient(w/2,h*0.65,0,w/2,h*0.65,Math.max(w,h)); vg.addColorStop(0, 'rgba(0,0,0,0)'); vg.addColorStop(1, `rgba(0,0,0,${0.45 + p.drama*0.25})`); ctx.fillStyle=vg; ctx.fillRect(0,0,w,h); ctx.restore();
          requestAnimationFrame(frame);
        }
        requestAnimationFrame(frame);
        return ()=>{ running=false; window.removeEventListener('resize', onResize); }
      }, [mood.cosy, mood.eerie, mood.heroic, isNight]);

      return (
        React.createElement('div', {className:'stage-wrap'},
          React.createElement('div',{ref:wrapRef, className:'stage'},
            React.createElement('canvas',{ref, className:'stage-canvas'}),
            React.createElement('div',{className:'spotlights'},
              React.createElement('div',{className:'spot slow', style:{left:'-10%', top:'-6%'}}),
              React.createElement('div',{className:'spot fast', style:{right:'-5%', top:'14%'}})
            ),
            React.createElement('div',{className:'footlights'})
          ),
          React.createElement('div',{className:'curtain '+(open?'open':'')},
            React.createElement('div',{className:'valance'}),
            React.createElement('div',{className:'drape left'}),
            React.createElement('div',{className:'drape right'})
          )
        )
      );
    }

    function App(){
      const [cosy,setCosy]=useState(40);
      const [eerie,setEerie]=useState(22);
      const [heroic,setHeroic]=useState(48);
      const [isNight,setIsNight]=useState(false);
      const fc=useMemo(()=>mockForecast(),[]);

      const mood={cosy,eerie,heroic};
      const mapped=mapMood(mood,isNight);

      const sceneLine = useMemo(()=>{
        const tones = [];
        if(cosy>50) tones.push('warm'); if(eerie>50) tones.push('brooding'); if(heroic>50) tones.push('triumphant');
        const m = tones.length? tones.join(' & ') : (isNight? 'quiet' : 'gentle');
        const sky = isNight? 'under a velvet sky' : (mapped.precip>0.35? 'beneath gathering clouds' : 'under cotton clouds');
        const act = heroic>50? 'the hills stand tall' : (eerie>50? 'fog curls through the pines' : 'the town yawns awake');
        return `${isNight? 'Night':'Matinée'} • A ${m} ${fc.tempF}°F ${sky}; ${act}.`;
      }, [cosy,eerie,heroic,isNight,fc.tempF,mapped.precip]);

      const typed = useTypewriter(sceneLine, 20);

      function remix(){ setCosy(Math.round(rand(10,90))); setEerie(Math.round(rand(10,90))); setHeroic(Math.round(rand(10,90))); }

      return (
        React.createElement('div',{className:'container'},
          React.createElement('div',{className:'title'},
            React.createElement('div',{className:'dot'}),
            React.createElement('div',null,'Weather Theatre'),
            React.createElement('div',{className:'dot'})
          ),
          React.createElement('div',{className:'subtitle muted'}, 'Sliders remix a mock forecast into shifting stage sets.'),

          React.createElement('div',{className:'marquee'},
            React.createElement('div',{className:'badge'},
              React.createElement('span',{className:'lamp'}),
              React.createElement('span',null,'Tonight’s Bill')
            ),
            React.createElement('div',{className:'forecast'},
              React.createElement('span',{className:'meta'}, fc.label + ' • ' + fc.condition + ' • '),
              React.createElement('span',{className:'temp'}, fc.tempF + '°F'),
              React.createElement('span',{className:'meta'}, ' • Wind '+fc.wind+' • Precip '+fc.precip+'%')
            ),
            React.createElement('div',{className:'right row'},
              React.createElement('div',{className:'pill mono muted'}, 'Matinée / Night'),
              React.createElement('div',{className:'switch '+(isNight?'on':''), onClick:()=>setIsNight(v=>!v)},
                React.createElement('svg',{className:'icon sun',width:16,height:16,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':2},
                  React.createElement('circle',{cx:12,cy:12,r:4}),
                  React.createElement('path',{d:'M12 2v2M12 20v2M4 12H2M22 12h-2M5 5l-1.4-1.4M20.4 20.4L19 19M19 5l1.4-1.4M4.6 20.4L5.9 19'})
                ),
                React.createElement('svg',{className:'icon moon',width:16,height:16,viewBox:'0 0 24 24',fill:'currentColor'},
                  React.createElement('path',{d:'M21 12.8A8.5 8.5 0 1 1 11.2 3a7 7 0 1 0 9.8 9.8Z'})
                ),
                React.createElement('div',{className:'knob'})
              )
            )
          ),

          React.createElement(StageCanvas,{mood, isNight, forecast:fc}),

          React.createElement('div',{className:'panel'},
            React.createElement('div',{className:'grid'},
              React.createElement('div',{className:'g-4'},
                React.createElement('div',{className:'label'}, 'Cosy'),
                React.createElement('input',{className:'slider', type:'range', min:0,max:100,value:cosy,onChange:e=>setCosy(+e.target.value)})
              ),
              React.createElement('div',{className:'g-4'},
                React.createElement('div',{className:'label'}, 'Eerie'),
                React.createElement('input',{className:'slider', type:'range', min:0,max:100,value:eerie,onChange:e=>setEerie(+e.target.value)})
              ),
              React.createElement('div',{className:'g-4'},
                React.createElement('div',{className:'label'}, 'Heroic'),
                React.createElement('input',{className:'slider', type:'range', min:0,max:100,value:heroic,onChange:e=>setHeroic(+e.target.value)})
              ),

              React.createElement('div',{className:'g-8 row'},
                React.createElement('button',{className:'button ghost', onClick:()=>{setCosy(40);setEerie(22);setHeroic(48)}},
                  icon('rotate-cw'), ' Reset'
                ),
                React.createElement('button',{className:'button accent', onClick:remix},
                  icon('shuffle'), ' Remix'
                ),
                React.createElement('button',{className:'button accent-2', onClick:()=>{ setIsNight(n=>!n)}},
                  icon('sparkle'), ' Matinée / Night'
                )
              )
            )
          ),

          React.createElement('div',{className:'caption'},
            React.createElement('span',null, typed),
            React.createElement('span',null, typed.length<sceneLine.length? '\u258B' : '')
          )
        )
      );
    }

    function icon(name){
      const base={width:18,height:18,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':2,'stroke-linecap':'round','stroke-linejoin':'round',style:{opacity:.9}};
      switch(name){
        case 'rotate-cw': return React.createElement('svg',base,
          React.createElement('polyline',{points:'23 4 23 10 17 10'}),
          React.createElement('path',{d:'M20.49 15A9 9 0 1 1 23 10h-6'})
        );
        case 'shuffle': return React.createElement('svg',base,
          React.createElement('polyline',{points:'16 3 21 3 21 8'}),
          React.createElement('line',{x1:4,y1:20,x2:21,y2:3}),
          React.createElement('polyline',{points:'21 16 21 21 16 21'}),
          React.createElement('line',{x1:15,y1:15,x2:21,y2:21}),
          React.createElement('line',{x1:4,y1:4,x2:9,y2:9})
        );
        case 'sparkle': return React.createElement('svg',base,
          React.createElement('path',{d:'M12 3l2.5 5 5 2.5-5 2.5L12 18l-2.5-5L4 10.5 9.5 8 12 3z'})
        );
        default: return React.createElement('span');
      }
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  })();
  </script>
</body>
</html>

