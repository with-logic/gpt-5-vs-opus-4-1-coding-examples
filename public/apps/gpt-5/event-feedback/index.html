<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Event Feedback Dashboard</title>
  <meta name="description" content="Single-page dashboard showing event participant feedback with search, sorting, and AI summary." />
  <style>
    :root{
      --bg:#f7f8fb;
      --panel:#ffffff;
      --text:#0f172a; /* slate-900 */
      --muted:#6b7280; /* gray-500 */
      --border:#e5e7eb; /* gray-200 */
      --accent:#2563eb; /* blue-600 */
      --accent-600:#2563eb;
      --accent-700:#1d4ed8;
      --accent-50:#eef2ff; /* indigo-50 */
      --success:#16a34a; /* green-600 */
      --warning:#ca8a04; /* yellow-600 */
      --danger:#dc2626; /* red-600 */
      --shadow:0 10px 25px rgba(2,6,23,.08), 0 2px 6px rgba(2,6,23,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background:var(--bg); color:var(--text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .container{max-width:1200px; margin:0 auto; padding:28px 20px 48px}
    .header{display:flex; align-items:flex-end; justify-content:space-between; gap:16px; margin-bottom:18px}
    .title{margin:0; font-size: clamp(1.25rem, 2.2vw, 1.75rem); letter-spacing:.2px}
    .subtitle{margin:4px 0 0; color:var(--muted); font-size:.95rem}

    /* Summary card */
    .summary{position:relative; background:var(--panel); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:18px 18px 14px 18px; margin:10px 0 18px; overflow:hidden}
    .summary::before{content:""; position:absolute; inset:0 0 auto 0; height:5px; background:linear-gradient(90deg, var(--accent) 0%, #22c55e 50%, #a855f7 100%); opacity:.9}
    .summary-header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px}
    .summary h2{margin:0; font-size:1.05rem; letter-spacing:.2px}
    .summary .close{border:0; background:transparent; color:var(--muted); cursor:pointer; padding:6px; border-radius:8px}
    .summary .close:hover{background:#f3f4f6; color:#111827}
    .summary-grid{display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px}
    @media (max-width: 900px){ .summary-grid{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 520px){ .summary-grid{grid-template-columns: 1fr;} }
    .stat{border:1px dashed var(--border); border-radius:12px; padding:12px 12px}
    .stat h3{margin:4px 0; font-size:.78rem; color:var(--muted); font-weight:600}
    .stat .value{font-size:1.35rem; font-weight:700; letter-spacing:.2px}
    .chip-row{display:flex; flex-wrap:wrap; gap:8px; padding-top:4px}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#f9fafb; color:#111827; font-size:.85rem}
    .chip svg{width:14px; height:14px; color:var(--accent)}
    .dist{display:flex; align-items:center; gap:8px}
    .dist-bar{flex:1; height:8px; background:#f1f5f9; border-radius:999px; overflow:hidden}
    .dist-bar > span{display:block; height:100%; background:linear-gradient(90deg, var(--accent) 0%, #60a5fa 100%)}

    /* Toolbar */
    .toolbar{display:flex; align-items:center; gap:12px; margin:8px 0 14px}
    .search{position:relative; flex:1;}
    .search input{
      width:100%; padding:12px 40px 12px 40px; border-radius:12px; border:1px solid var(--border); background:var(--panel); color:var(--text);
      box-shadow:var(--shadow);
      outline:none; transition:border-color .2s, box-shadow .2s;
    }
    .search input::placeholder{color:#9ca3af}
    .search input:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(37,99,235,.15)}
    .search .icon{position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#94a3b8}
    .search .clear{position:absolute; right:8px; top:50%; transform:translateY(-50%); border:0; background:transparent; color:#9ca3af; cursor:pointer; padding:6px; border-radius:8px}
    .search .clear:hover{color:#111827; background:#f3f4f6}
    .count{color:var(--muted); font-size:.95rem}
    .show-summary{border:1px solid var(--border); background:var(--panel); border-radius:10px; padding:8px 10px; color:#111827; cursor:pointer; box-shadow:var(--shadow)}
    .show-summary:hover{border-color:#cbd5e1}

    /* Table */
    .table-wrap{background:var(--panel); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); overflow:hidden}
    table{width:100%; border-collapse:separate; border-spacing:0}
    thead th{position:sticky; top:0; background:#f8fafc; z-index:2; border-bottom:1px solid var(--border); text-align:left; font-weight:700; padding:12px 14px; font-size:.9rem; color:#0f172a}
    tbody td{padding:12px 14px; border-bottom:1px solid var(--border); vertical-align:top; color:#111827; font-size:.95rem}
    tbody tr:nth-child(even) td{background:#fcfcfd}
    tbody tr:hover td{background:#f8fafc}

    .badge{display:inline-block; padding:6px 10px; border-radius:999px; background:var(--accent-50); color:var(--accent-700); border:1px solid #c7d2fe; font-weight:600; font-size:.85rem}

    .rating{display:inline-flex; align-items:center; gap:2px}
    .rating svg{width:16px; height:16px}
    .rating .filled{color:#f59e0b}
    .rating .empty{color:#e5e7eb}

    .feedback{max-width:640px; line-height:1.45}
    .clamp-3{display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden}

    /* Sortable headers */
    .sort-btn{appearance:none; border:0; background:transparent; font:inherit; color:inherit; padding:0; display:inline-flex; align-items:center; gap:8px; cursor:pointer}
    .sort-icon{display:inline-flex; flex-direction:column; gap:2px}
    .sort-icon svg{width:12px; height:12px; color:#94a3b8}
    th[aria-sort="ascending"] .sort-icon .up{color:var(--accent)}
    th[aria-sort="descending"] .sort-icon .down{color:var(--accent)}

    .no-results{padding:22px; text-align:center; color:var(--muted)}

    /* Animations */
    .fade-enter{opacity:0; transform:translateY(-4px)}
    .fade-enter-active{opacity:1; transform:none; transition:opacity .18s ease, transform .18s ease}
    .fade-exit{opacity:1}
    .fade-exit-active{opacity:0; transform:translateY(-6px); transition:opacity .18s ease, transform .18s ease}
  </style>
</head>
<body>
  <main class="container" aria-label="Event Feedback Dashboard">
    <div class="header">
      <div>
        <h1 class="title">Event Feedback Dashboard</h1>
        <p class="subtitle">Search, sort, and scan participant feedback across recent events.</p>
      </div>
      <button id="btnShowSummary" class="show-summary" style="display:none" aria-label="Show AI summary">Show AI Summary</button>
    </div>

    <!-- AI Summary Card -->
    <section id="summaryCard" class="summary" aria-live="polite">
      <div class="summary-header">
        <h2>AI Summary</h2>
        <button class="close" id="btnCloseSummary" aria-label="Close AI summary" title="Close">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="summaryText" style="margin:0 2px 10px; color:#111827"></div>
      <div class="summary-grid">
        <div class="stat">
          <h3>Submissions</h3>
          <div class="value" id="statSubmissions">—</div>
          <div style="color:var(--muted); font-size:.85rem" id="statEvents">— events</div>
        </div>
        <div class="stat">
          <h3>Average Rating</h3>
          <div class="value" id="statAvg">—</div>
          <div class="rating" id="statStars" aria-hidden="true"></div>
        </div>
        <div class="stat">
          <h3>Rating Distribution</h3>
          <div class="dist" aria-label="5-star submissions"><span style="width:22px; color:#64748b">5★</span><div class="dist-bar"><span id="bar5" style="width:0%"></span></div><span id="count5" style="width:32px; text-align:right; color:#64748b">0</span></div>
          <div class="dist" aria-label="4-star submissions"><span style="width:22px; color:#64748b">4★</span><div class="dist-bar"><span id="bar4" style="width:0%"></span></div><span id="count4" style="width:32px; text-align:right; color:#64748b">0</span></div>
          <div class="dist" aria-label="3-star submissions"><span style="width:22px; color:#64748b">3★</span><div class="dist-bar"><span id="bar3" style="width:0%"></span></div><span id="count3" style="width:32px; text-align:right; color:#64748b">0</span></div>
        </div>
        <div class="stat">
          <h3>Common Keywords</h3>
          <div class="chip-row" id="keywordChips"></div>
        </div>
      </div>
    </section>

    <!-- Toolbar -->
    <div class="toolbar">
      <div class="search" role="search">
        <svg class="icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"/><path d="m21 21-3.5-3.5"/></svg>
        <input id="searchInput" type="search" placeholder="Search feedback, names, events…" aria-label="Search feedback" autocomplete="off" />
        <button id="clearSearch" class="clear" aria-label="Clear search" title="Clear">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="count"><span id="countFiltered">0</span> of <span id="countTotal">0</span> shown</div>
    </div>

    <!-- Table -->
    <div class="table-wrap" role="region" aria-label="Feedback table">
      <table>
        <thead>
          <tr>
            <th scope="col" id="thDate" data-key="date" data-type="date" aria-sort="none">
              <button class="sort-btn" aria-label="Sort by date"><span>Date</span>
                <span class="sort-icon" aria-hidden="true">
                  <svg class="up" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                  <svg class="down" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
                </span>
              </button>
            </th>
            <th scope="col" id="thEvent" data-key="event" data-type="string" aria-sort="none">
              <button class="sort-btn" aria-label="Sort by event"><span>Event</span>
                <span class="sort-icon" aria-hidden="true">
                  <svg class="up" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                  <svg class="down" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
                </span>
              </button>
            </th>
            <th scope="col" id="thParticipant" data-key="participant" data-type="string" aria-sort="none">
              <button class="sort-btn" aria-label="Sort by participant"><span>Participant</span>
                <span class="sort-icon" aria-hidden="true">
                  <svg class="up" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                  <svg class="down" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
                </span>
              </button>
            </th>
            <th scope="col" id="thRating" data-key="rating" data-type="number" aria-sort="none">
              <button class="sort-btn" aria-label="Sort by rating"><span>Rating</span>
                <span class="sort-icon" aria-hidden="true">
                  <svg class="up" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                  <svg class="down" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
                </span>
              </button>
            </th>
            <th scope="col" id="thFeedback" data-key="feedback" data-type="string" aria-sort="none">
              <button class="sort-btn" aria-label="Sort by feedback"><span>Feedback</span>
                <span class="sort-icon" aria-hidden="true">
                  <svg class="up" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                  <svg class="down" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
                </span>
              </button>
            </th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      <div id="noResults" class="no-results" style="display:none">No matching results.</div>
    </div>
  </main>

  <script>
    (function(){
      const state = { q: '', sortKey: 'date', sortDir: 'desc' };

      // Seeded RNG for stable realism
      function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296}};
      const rand = mulberry32(0xC0FFEE ^ Math.floor(Date.now()/86400000));

      const events = [
        'Customer Success Summit','Product Launch Webinar','Leadership Retreat',
        'Data Strategy Workshop','Sales Kickoff','UI/UX Masterclass',
        'Cloud Migration Roundtable','Annual Partner Conference','Security Compliance Training',
        'AI in Business Forum','Marketing Analytics Bootcamp','Operational Excellence Expo'
      ];
      const first = ['Alex','Jordan','Taylor','Casey','Riley','Morgan','Sam','Avery','Jamie','Harper','Quinn','Reese','Parker','Drew','Rowan'];
      const last = ['Nguyen','Patel','Garcia','Lee','Johnson','Brown','Davis','Miller','Wilson','Martinez','Anderson','Thomas','Jackson','White','Harris'];
      const sentences = [
        'The content struck a great balance between strategy and practical examples.',
        'Speakers were engaging and left time for thoughtful Q&A at the end.',
        'Logistics were smooth, with clear communication before and during the event.',
        'I appreciated the real-world case studies and actionable templates provided.',
        'Some sessions ran long, but the breaks were well-timed and helpful.',
        'The workshop exceeded expectations and sparked new ideas for our team.',
        'Networking opportunities were plentiful and facilitated meaningful connections.',
        'The venue setup supported collaboration without feeling crowded or noisy.',
        'I would have liked deeper dives into a few technical topics.',
        'Resource links and follow-ups arrived quickly and were easy to navigate.',
        'Live demos showcased realistic scenarios and common pitfalls to avoid.',
        'The pacing felt energetic without being overwhelming for newcomers.',
        'Panel discussions offered diverse perspectives and constructive debate.',
        'Hands-on exercises made abstract concepts much more concrete.',
        'The event fostered a collaborative atmosphere across different industries.'
      ];

      function pick(arr){ return arr[Math.floor(rand()*arr.length)] }
      function randomInt(min,max){ return Math.floor(rand()*(max-min+1))+min }
      function weightedRating(){
        // Skew toward 4-5 stars
        const r = rand();
        if(r<0.55) return 5;
        if(r<0.85) return 4;
        if(r<0.95) return 3;
        return r<0.985 ? 2 : 1;
      }
      function randomDateWithin(days){
        const now = new Date();
        const past = new Date(now.getTime() - randomInt(0,days)*86400000);
        // randomize time a little for stable ordering
        past.setHours(randomInt(8,18), randomInt(0,59), 0, 0);
        return past;
      }
      function formatDate(d){
        const opts = { month:'short', day:'numeric', year:'numeric' };
        return d.toLocaleDateString(undefined, opts);
      }
      function makeFeedback(){
        const n = randomInt(3,5);
        let text = [];
        for(let i=0;i<n;i++){ text.push(pick(sentences)); }
        return text.join(' ');
      }

      function generateData(n){
        const out = [];
        for(let i=0;i<n;i++){
          const event = pick(events);
          const participant = pick(first) + ' ' + pick(last);
          const date = randomDateWithin(330); // ~last 11 months
          const rating = weightedRating();
          const feedback = makeFeedback();
          out.push({ id:i+1, date, event, participant, rating, feedback });
        }
        return out;
      }

      const DATA = generateData(30);

      // Summary calculations
      function average(arr, sel){ return arr.length ? arr.reduce((a,b)=>a+sel(b),0)/arr.length : 0 }
      function distinctCount(arr, sel){ return new Set(arr.map(sel)).size }
      function topKeywords(arr, k){
        const stop = new Set('the a an and or of to for with were was are is be been being on at from this that those these into over under but as by about across within between after before it they we i our your their you he she his her them us in not very more most less least felt few lot lots much many such suchlike each every either neither both'.split(' '));
        const tally = new Map();
        for(const item of arr){
          const text = (item.feedback + ' ' + item.event).toLowerCase().replace(/[^a-z0-9\s]/g,' ');
          text.split(/\s+/).forEach(w=>{
            if(!w || stop.has(w) || w.length<3) return;
            tally.set(w, (tally.get(w)||0)+1);
          });
        }
        return [...tally.entries()].sort((a,b)=>b[1]-a[1]).slice(0,k);
      }

      // DOM refs
      const tbody = document.getElementById('tbody');
      const searchInput = document.getElementById('searchInput');
      const clearSearch = document.getElementById('clearSearch');
      const countFiltered = document.getElementById('countFiltered');
      const countTotal = document.getElementById('countTotal');
      const noResults = document.getElementById('noResults');

      const ths = {
        date: document.getElementById('thDate'),
        event: document.getElementById('thEvent'),
        participant: document.getElementById('thParticipant'),
        rating: document.getElementById('thRating'),
        feedback: document.getElementById('thFeedback')
      };

      // Summary refs
      const summaryCard = document.getElementById('summaryCard');
      const btnCloseSummary = document.getElementById('btnCloseSummary');
      const btnShowSummary = document.getElementById('btnShowSummary');
      const statSubmissions = document.getElementById('statSubmissions');
      const statEvents = document.getElementById('statEvents');
      const statAvg = document.getElementById('statAvg');
      const statStars = document.getElementById('statStars');
      const summaryText = document.getElementById('summaryText');
      const bar5 = document.getElementById('bar5');
      const bar4 = document.getElementById('bar4');
      const bar3 = document.getElementById('bar3');
      const count5 = document.getElementById('count5');
      const count4 = document.getElementById('count4');
      const count3 = document.getElementById('count3');
      const keywordChips = document.getElementById('keywordChips');

      function renderStars(n){
        let html='';
        for(let i=1;i<=5;i++){
          const cls = i<=n ? 'filled' : 'empty';
          html += `<svg class="${cls}" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`;
        }
        return html;
      }

      function renderRow(item){
        const dateText = formatDate(item.date);
        const feedbackTitle = item.feedback.replace(/\"/g,'"');
        return `
          <tr>
            <td data-value="${item.date.toISOString()}">${dateText}</td>
            <td><span class="badge" title="${item.event}">${item.event}</span></td>
            <td>${item.participant}</td>
            <td><span class="rating" aria-label="${item.rating} out of 5">${renderStars(item.rating)}</span></td>
            <td class="feedback"><div class="clamp-3" title="${feedbackTitle}">${item.feedback}</div></td>
          </tr>
        `;
      }

      function filterData(q, data){
        if(!q) return data.slice();
        const s = q.toLowerCase();
        return data.filter(d =>
          d.event.toLowerCase().includes(s) ||
          d.participant.toLowerCase().includes(s) ||
          d.feedback.toLowerCase().includes(s) ||
          String(d.rating).includes(s) ||
          formatDate(d.date).toLowerCase().includes(s)
        );
      }

      function sortData(data){
        const {sortKey, sortDir} = state;
        const dir = sortDir === 'asc' ? 1 : -1;
        const val = (d)=>{
          switch(sortKey){
            case 'date': return d.date.getTime();
            case 'rating': return d.rating;
            case 'event': return d.event.toLowerCase();
            case 'participant': return d.participant.toLowerCase();
            case 'feedback': return d.feedback.toLowerCase();
          }
        };
        return data.slice().sort((a,b)=>{
          const va = val(a), vb = val(b);
          if(va<vb) return -1*dir;
          if(va>vb) return 1*dir;
          // tie-breaker stable by id desc for date default
          return (a.id - b.id)*dir;
        });
      }

      function updateSortIndicators(){
        for(const key in ths){ ths[key].setAttribute('aria-sort','none'); }
        ths[state.sortKey].setAttribute('aria-sort', state.sortDir==='asc'?'ascending':'descending');
      }

      function renderTable(){
        const filtered = filterData(state.q, DATA);
        const sorted = sortData(filtered);
        tbody.innerHTML = sorted.map(renderRow).join('');
        countFiltered.textContent = String(sorted.length);
        countTotal.textContent = String(DATA.length);
        noResults.style.display = sorted.length ? 'none' : 'block';
      }

      function debounce(fn, ms){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(null,args), ms); } }

      // Summary rendering
      function renderSummary(){
        const total = DATA.length;
        const eventsCount = distinctCount(DATA, d=>d.event);
        const avg = average(DATA, d=>d.rating);
        const dist = {1:0,2:0,3:0,4:0,5:0}; DATA.forEach(d=>dist[d.rating]++)
        const top = topKeywords(DATA, 6);

        statSubmissions.textContent = String(total);
        statEvents.textContent = `${eventsCount} events`;
        statAvg.textContent = avg.toFixed(1) + '★';
        statStars.innerHTML = renderStars(Math.round(avg));

        const pct = (n)=> total? (n/total*100).toFixed(0) : 0;
        bar5.style.width = pct(dist[5])+'%'; count5.textContent = String(dist[5]);
        bar4.style.width = pct(dist[4])+'%'; count4.textContent = String(dist[4]);
        bar3.style.width = pct(dist[3])+'%'; count3.textContent = String(dist[3]);

        keywordChips.innerHTML = top.map(([w,c])=>
          `<span class="chip" title="${c} mentions"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h9"/></svg>${w}</span>`
        ).join('');

        // Narrative
        const best = (()=>{
          const map = new Map();
          DATA.forEach(d=>{
            const m = map.get(d.event)||{sum:0,count:0};
            m.sum+=d.rating; m.count++; map.set(d.event, m);
          });
          const arr = [...map.entries()].map(([event,{sum,count}])=>({event,avg:sum/count,count}));
          arr.sort((a,b)=> b.avg - a.avg || b.count - a.count);
          return arr.slice(0,2);
        })();
        const dateRange = (()=>{
          const times = DATA.map(d=>d.date.getTime());
          const min = new Date(Math.min(...times));
          const max = new Date(Math.max(...times));
          return `${formatDate(min)} — ${formatDate(max)}`;
        })();
        summaryText.textContent = `Analyzed ${total} submissions across ${eventsCount} events (${dateRange}). Average rating ${avg.toFixed(1)}★ with a positive skew toward 4–5 stars. Top highlights include ${best.map(b=>`${b.event} (${b.avg.toFixed(1)}★)`).join(' and ')}.`;
      }

      // Event wiring
      searchInput.addEventListener('input', debounce((e)=>{
        state.q = e.target.value.trim();
        renderTable();
        clearSearch.style.visibility = state.q ? 'visible' : 'hidden';
      }, 120));
      clearSearch.addEventListener('click', ()=>{ searchInput.value=''; state.q=''; renderTable(); clearSearch.style.visibility='hidden'; searchInput.focus(); });

      function bindSort(thEl, key){
        thEl.querySelector('.sort-btn').addEventListener('click', ()=>{
          if(state.sortKey===key){ state.sortDir = state.sortDir==='asc'?'desc':'asc'; }
          else { state.sortKey=key; state.sortDir = key==='date'?'desc':'asc'; }
          updateSortIndicators();
          renderTable();
        });
      }
      bindSort(ths.date,'date');
      bindSort(ths.event,'event');
      bindSort(ths.participant,'participant');
      bindSort(ths.rating,'rating');
      bindSort(ths.feedback,'feedback');

      // Summary toggles
      btnCloseSummary.addEventListener('click', ()=>{
        summaryCard.classList.add('fade-exit-active');
        setTimeout(()=>{ summaryCard.style.display='none'; btnShowSummary.style.display='inline-block'; }, 160);
      });
      btnShowSummary.addEventListener('click', ()=>{
        summaryCard.style.display='block';
        summaryCard.classList.add('fade-enter');
        requestAnimationFrame(()=>{ summaryCard.classList.add('fade-enter-active'); summaryCard.classList.remove('fade-enter'); });
        setTimeout(()=>{ summaryCard.classList.remove('fade-enter-active'); }, 200);
        btnShowSummary.style.display='none';
      });

      // Initial render
      updateSortIndicators();
      renderSummary();
      renderTable();
      clearSearch.style.visibility='hidden';
    })();
  </script>
</body>
</html>
