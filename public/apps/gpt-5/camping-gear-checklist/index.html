<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Camping Gear Checklist</title>
  <meta name="description" content="Outdoor-themed checklist with weight calculator and saved lists for camping trips."/>
  <style>
    :root{
      --sky:#bfe3ff;
      --dusk:#7fb3d5;
      --pine:#1f5633;
      --moss:#2f6d3f;
      --fern:#3d8750;
      --leaf:#75b067;
      --earth:#5a4633;
      --sand:#d1b899;
      --cloud:#f2f6f9;
      --fog:#e7eef3;
      --ink:#173023;
      --accent:#ffbf4d; /* campfire glow */
      --accent-2:#ff6a3d; /* ember */
      --danger:#c7473a;
      --ok:#4caf50;
      --muted:#6b7f75;
      --ring: 0 0 0 2px rgba(255,191,77,.55), 0 3px 10px rgba(0,0,0,.15);
      --shadow:0 8px 20px rgba(0,0,0,.18);
      --radius:14px;
    }
    html,body{height:100%;}
    *{box-sizing:border-box}
    body{
      margin:0; color:#0e2219; font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      background:
        radial-gradient(1200px 500px at 70% -10%, rgba(255,255,255,.6), transparent 60%),
        linear-gradient(180deg, var(--sky) 0%, #9fd0f1 30%, #8bbfdc 50%, #78a9c5 60%, #6494ae 70%, #4f7e97 78%, #3b6980 86%, #2a5368 100%);
      background-attachment: fixed;
    }
    /* Stylized mountains */
    body::before, body::after{
      content:""; position:fixed; left:0; right:0; bottom:0; pointer-events:none;
    }
    body::before{
      height:36vh; background:
        linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.04) 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 300" preserveAspectRatio="none"><defs><linearGradient id="g" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="%23345b42"/><stop offset="1" stop-color="%232a4b35"/></linearGradient></defs><path d="M0 230 L150 150 L300 230 L420 160 L540 220 L650 170 L800 230 L950 140 L1200 230 V300 H0 Z" fill="url(%23g)" opacity="0.9"/><path d="M0 250 L180 180 L320 250 L480 190 L620 250 L760 200 L940 250 L1200 200 V300 H0 Z" fill="%23284331" opacity="0.95"/></svg>');
      background-size: cover; background-position: bottom;
      z-index:-1;
    }
    body::after{
      height:18vh; background:linear-gradient(180deg, rgba(42,83,56,0) 0, rgba(42,83,56,.95) 65%, rgba(42,83,56,1) 100%);
      z-index:-1;
    }

    /* Layout */
    .app{display:grid; grid-template-columns: 320px 1fr; min-height:100dvh;}
    @media (max-width: 980px){.app{grid-template-columns:1fr} #sidebar{position:fixed; inset:0 30% 0 0; max-width:420px; transform:translateX(-100%); transition:transform .3s ease; z-index:30} .app.nav-open #sidebar{transform:none} .sidebar-dim{display:block}}
    .sidebar-dim{display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:20}

    #sidebar{background:linear-gradient(180deg, #2f6d3f, #274f36); color:#ecf7ef; border-right:1px solid rgba(255,255,255,.08);}
    .brand{display:flex; gap:10px; align-items:center; padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.08)}
    .brand .title{font-weight:800; letter-spacing:.3px}
    .brand .version{margin-left:auto; font-size:12px; opacity:.75}

    .panel{padding:16px 18px}
    .panel h3{margin:8px 0 10px; font-size:14px; text-transform:uppercase; letter-spacing:.12em; opacity:.9}
    .trip-form input, .trip-form select, .trip-form button, .control, .search input{
      width:100%; border:none; border-radius:10px; padding:10px 12px; margin:6px 0; outline:none; background:rgba(255,255,255,.12); color:#e9fff2;
    }
    .trip-form input::placeholder{color:#e9fff2cc}
    .btn{cursor:pointer; user-select:none; transition:transform .05s ease, box-shadow .2s ease}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg, #ffcc66, #ffb84d); color:#462f0b; box-shadow: var(--ring)}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.25)}

    .list-actions{display:grid; grid-template-columns:1fr 1fr; gap:8px}
    .lists{max-height:38vh; overflow:auto; border-top:1px dashed rgba(255,255,255,.2); padding-top:8px}
    .lists .item{display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; cursor:pointer}
    .lists .item:hover{background:rgba(255,255,255,.08)}
    .lists .item.active{background:rgba(255,255,255,.16)}
    .lists .item .name{font-weight:600}
    .lists .item .meta{margin-left:auto; font-size:12px; opacity:.8}

    /* Top bar */
    header.top{position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(6px); background:linear-gradient(180deg, rgba(242,246,249,.9), rgba(242,246,249,.65)); border-bottom:1px solid rgba(23,48,35,.08)}
    .top-inner{display:flex; align-items:center; gap:12px; padding:12px 16px}
    .menu-btn{display:none}
    @media (max-width:980px){.menu-btn{display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:10px; background:#e8f2ea; border:1px solid #d7e5da}}
    .titlebar{display:flex; align-items:center; gap:10px; font-weight:800; color:var(--ink)}
    .titlebar small{font-weight:600; color:#557568}
    .toolbar{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap}
    .toolbar .chip{display:inline-flex; align-items:center; gap:8px; background:#ecf5ee; padding:8px 10px; border-radius:999px; border:1px solid #d7e5da}

    /* Content */
    main{padding:16px; max-width:1200px; margin:0 auto}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:16px}
    @media (max-width: 1100px){.grid{grid-template-columns:1fr}}

    .summary{
      background:#f4faf4; border:1px solid #d7e5da; border-radius:var(--radius); padding:12px; position:sticky; top:68px; box-shadow:var(--shadow)
    }
    .summary h3{margin:0 0 10px}
    .summary .stats{display:grid; grid-template-columns: repeat(4, 1fr); gap:10px}
    @media (max-width:760px){.summary .stats{grid-template-columns: repeat(2, 1fr)}}
    .pill{background:#fff; border:1px solid #e1ece3; border-radius:12px; padding:10px; display:flex; gap:8px; align-items:center}
    .pill .num{font-weight:800; color:#1c4d34}

    .progress{height:8px; background:#e1ece3; border-radius:999px; overflow:hidden; margin-top:10px}
    .progress > i{display:block; height:100%; background:linear-gradient(90deg, var(--leaf), var(--fern)); width:0}

    /* Category + Items */
    .card{background:#ffffffeb; backdrop-filter:saturate(1.1); border:1px solid #d7e5da; border-radius:var(--radius); box-shadow:var(--shadow)}
    .card .hd{display:flex; align-items:center; gap:10px; padding:12px 14px; border-bottom:1px solid #e6efe8}
    .card .hd h3{margin:0; display:flex; align-items:center; gap:8px}
    .card .hd .meta{margin-left:auto; color:#557568; font-weight:600}
    .card .bd{padding:6px 10px}
    .cat-ctrls{margin-left:auto; display:flex; gap:8px}

    .item-row{display:grid; grid-template-columns: 26px 1fr 110px 70px 120px 36px 36px; align-items:center; gap:8px; padding:8px; border-radius:10px}
    .item-row:hover{background:#f6fbf7}
    @media (max-width:860px){.item-row{grid-template-columns: 26px 1fr 100px 70px 120px 36px}}
    @media (max-width:680px){.item-row{grid-template-columns: 26px 1fr 1fr; grid-auto-rows:auto}}

    .row-hd{display:grid; grid-template-columns: 26px 1fr 110px 70px 120px 36px 36px; gap:8px; padding:8px 10px; color:#4f6b5e; font-size:12px; text-transform:uppercase; letter-spacing:.12em}
    @media (max-width:860px){.row-hd{grid-template-columns: 26px 1fr 100px 70px 120px 36px}}
    @media (max-width:680px){.row-hd{display:none}}

    .check{appearance:none; width:22px; height:22px; border-radius:6px; border:1px solid #cfe2d5; background:#fff; display:grid; place-content:center; cursor:pointer}
    .check:checked{background:linear-gradient(180deg, #72c27d, #4dae5b); border-color:#78c383}
    .check:checked::after{content:""; width:12px; height:12px; border-radius:3px; background:white; box-shadow:inset 14px 14px #2a6c3e}

    .text, .num, .sel{width:100%; padding:8px 10px; border:1px solid #dce9df; border-radius:10px; outline:none; background:white}
    .num{text-align:right}
    .text:focus, .num:focus, .sel:focus{box-shadow: var(--ring); border-color:#ffcc66}

    .icon-btn{width:36px; height:36px; border-radius:10px; border:1px solid #dce9df; background:#fff; display:grid; place-content:center; cursor:pointer}
    .icon-btn:hover{background:#f2f8f3}
    .icon-btn.danger{border-color:#f3d2d0; color:#a1443b}

    .add-row{display:grid; grid-template-columns: 1fr 110px 70px 160px auto; gap:8px; padding:10px}
    @media (max-width:860px){.add-row{grid-template-columns: 1fr 1fr}}

    .muted{color:#6c8378}

    /* Modals */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50}
    .modal.open{display:flex}
    .modal .sheet{background:#fff; width:min(680px, 94vw); border-radius:16px; border:1px solid #dfeae2; box-shadow:var(--shadow)}
    .modal .sheet .hd{padding:12px 14px; border-bottom:1px solid #e7f0e9; display:flex; align-items:center}
    .modal .sheet .bd{padding:14px}
    .modal .sheet .ft{padding:12px 14px; display:flex; gap:8px; justify-content:flex-end; background:#f8fbf9; border-top:1px solid #e7f0e9}

    /* Print */
    @media print{
      body{background:#fff}
      #sidebar, .menu-btn, .toolbar, .summary{display:none}
      main{padding:0}
      .card{box-shadow:none; border-color:#cfdad0}
      .item-row:hover{background:none}
    }
  </style>
</head>
<body>
  <!-- SVG sprite for icons -->
  <svg style="position:absolute; width:0; height:0; overflow:hidden" aria-hidden="true" focusable="false">
    <symbol id="ico-mountain" viewBox="0 0 24 24"><path fill="currentColor" d="M3 18l6.5-10L13 12l3-3 5 9H3zM9.5 8.4L5.6 15h7.2l-3.3-5.6z"/></symbol>
    <symbol id="ico-pack" viewBox="0 0 24 24"><path fill="currentColor" d="M7 2h10a2 2 0 012 2v16a2 2 0 01-2 2h-1v-4a3 3 0 00-3-3H11a3 3 0 00-3 3v4H7a2 2 0 01-2-2V4a2 2 0 012-2zm8 16v4H9v-4a1 1 0 011-1h4a1 1 0 011 1zM9 6h6v4H9V6z"/></symbol>
    <symbol id="ico-fire" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2s3 3 1 7c0 0 3-1 4 2 1.2 2.9-1 7-5 7s-6.2-4.1-5-7c1-2.5 4-2 4-2-1.5-2 1-7 1-7z"/><path fill="currentColor" d="M7 20h10v2H7z"/></symbol>
    <symbol id="ico-water" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2s6 6 6 10a6 6 0 11-12 0C6 8 12 2 12 2z"/></symbol>
    <symbol id="ico-compass" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a10 10 0 100 20 10 10 0 000-20zm3.8 6.2l-2 5.6-5.6 2 2-5.6 5.6-2z"/></symbol>
    <symbol id="ico-knife" viewBox="0 0 24 24"><path fill="currentColor" d="M2 13l9 9 2-2-6-6 13-13 2 2-6 6 2 2 6-6v8l-9 9-3-3-3 3-5-5 3-3-3-3z"/></symbol>
    <symbol id="ico-plus" viewBox="0 0 24 24"><path fill="currentColor" d="M11 5h2v6h6v2h-6v6h-2v-6H5v-2h6z"/></symbol>
    <symbol id="ico-trash" viewBox="0 0 24 24"><path fill="currentColor" d="M6 7h12l-1 13a2 2 0 01-2 2H9a2 2 0 01-2-2L6 7zm3-3h6l1 2H8l1-2z"/></symbol>
    <symbol id="ico-save" viewBox="0 0 24 24"><path fill="currentColor" d="M5 3h11l3 3v13a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2zm2 2v6h10V7h-6V5H7z"/></symbol>
    <symbol id="ico-download" viewBox="0 0 24 24"><path fill="currentColor" d="M5 20h14v2H5v-2zM11 3h2v9h3l-4 4-4-4h3V3z"/></symbol>
    <symbol id="ico-upload" viewBox="0 0 24 24"><path fill="currentColor" d="M5 20h14v2H5v-2zM11 21h2V12h3l-4-4-4 4h3v9z"/></symbol>
    <symbol id="ico-expand" viewBox="0 0 24 24"><path fill="currentColor" d="M7 10l5 5 5-5H7z"/></symbol>
    <symbol id="ico-search" viewBox="0 0 24 24"><path fill="currentColor" d="M21 20l-5.6-5.6a7 7 0 10-1.4 1.4L20 21l1-1zM5 10a5 5 0 1110 0A5 5 0 015 10z"/></symbol>
    <symbol id="ico-print" viewBox="0 0 24 24"><path fill="currentColor" d="M6 9V3h12v6H6zm-2 2h16a2 2 0 012 2v5h-4v3H8v-3H4v-5a2 2 0 012-2zm4 7h8v-5H8v5z"/></symbol>
    <symbol id="ico-close" viewBox="0 0 24 24"><path fill="currentColor" d="M18.3 5.7L12 12l6.3 6.3-1.4 1.4L10.6 13.4 4.3 19.7 2.9 18.3 9.2 12 2.9 5.7 4.3 4.3l6.3 6.3 6.3-6.3z"/></symbol>
  </svg>

  <div class="app" id="app">
    <div class="sidebar-dim" id="dim"></div>
    <aside id="sidebar">
      <div class="brand">
        <span style="display:grid;place-content:center;width:38px;height:38px;border-radius:10px;background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.2)"><svg width="22" height="22"><use href="#ico-mountain"/></svg></span>
        <div class="title">Camping Gear Checklist</div>
        <div class="version">v1.0</div>
      </div>
      <div class="panel">
        <h3>Trip</h3>
        <div class="trip-form">
          <input id="trip-name" placeholder="Trip name e.g. Sierra Overnighter"/>
          <div style="display:flex; gap:8px">
            <input id="trip-date" type="date"/>
            <input id="trip-location" placeholder="Location"/>
          </div>
          <div class="list-actions" style="margin-top:6px">
            <button class="btn primary" id="btn-save"><svg width="16" height="16"><use href="#ico-save"/></svg>&nbsp;Save</button>
            <button class="btn ghost" id="btn-saveas">Save As</button>
            <button class="btn ghost" id="btn-new">New</button>
            <button class="btn ghost" id="btn-dup">Duplicate</button>
            <button class="btn ghost" id="btn-export"><svg width="16" height="16"><use href="#ico-download"/></svg>&nbsp;Export</button>
            <button class="btn ghost" id="btn-import"><svg width="16" height="16"><use href="#ico-upload"/></svg>&nbsp;Import</button>
          </div>
        </div>
      </div>
      <div class="panel">
        <h3>My Lists</h3>
        <div class="search" style="position:relative">
          <svg width="18" height="18" style="position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.8"><use href="#ico-search"/></svg>
          <input id="lists-search" class="control" placeholder="Search saved lists" style="padding-left:36px"/>
        </div>
        <div class="lists" id="lists"></div>
      </div>
      <div class="panel muted" style="font-size:12px">
        Pro tip: Use Export to share a list or back it up. Printing hides controls for a tidy checklist.
      </div>
    </aside>

    <div>
      <header class="top">
        <div class="top-inner">
          <button class="menu-btn" id="menu"><svg width="18" height="18"><use href="#ico-mountain"/></svg></button>
          <div class="titlebar">
            <svg width="22" height="22" style="color:#2c5f3d"><use href="#ico-pack"/></svg>
            <div>
              <div id="title-text">Your Camping Pack</div>
              <small id="subtitle-text">Plan, pack, and weigh your gear.</small>
            </div>
          </div>
          <div class="toolbar">
            <div class="chip">
              <label for="unit">Units:</label>
              <select id="unit" class="sel" style="width:auto">
                <option value="g">grams (g)</option>
                <option value="oz">ounces (oz)</option>
                <option value="lb">pounds (lb)</option>
              </select>
            </div>
            <div class="chip">
              <svg width="18" height="18" style="color:#ff8a3d"><use href="#ico-fire"/></svg>
              <button class="icon-btn" id="btn-print" title="Print"><svg width="18" height="18"><use href="#ico-print"/></svg></button>
            </div>
          </div>
        </div>
      </header>

      <main>
        <div class="grid">
          <section>
            <div class="card summary" id="summary">
              <h3>Weight Summary</h3>
              <div class="stats">
                <div class="pill"><span class="muted">Base</span><span class="num" id="base-weight">0</span><span class="muted" id="base-unit">g</span></div>
                <div class="pill"><span class="muted">Consumables</span><span class="num" id="consumable-weight">0</span><span class="muted" id="consumable-unit">g</span></div>
                <div class="pill"><span class="muted">Worn</span><span class="num" id="worn-weight">0</span><span class="muted" id="worn-unit">g</span></div>
                <div class="pill"><span class="muted">Planned Total</span><span class="num" id="total-weight">0</span><span class="muted" id="total-unit">g</span></div>
              </div>
              <div class="progress" title="Packed progress">
                <i id="progress-bar" style="width:0%"></i>
              </div>
              <div class="muted" id="progress-text" style="margin-top:6px; font-size:12px">0 / 0 items packed</div>
            </div>

            <div id="categories"></div>
          </section>

          <aside>
            <div class="card" style="margin-bottom:16px">
              <div class="hd"><h3>Add Item</h3></div>
              <div class="bd">
                <div class="add-row">
                  <input id="add-name" class="text" placeholder="Item name (e.g., Tent)" />
                  <input id="add-weight" class="num" type="number" min="0" step="0.1" placeholder="Weight" />
                  <input id="add-qty" class="num" type="number" min="1" step="1" value="1" placeholder="Qty" />
                  <select id="add-class" class="sel">
                    <option value="base">Base</option>
                    <option value="consumable">Consumable</option>
                    <option value="worn">Worn</option>
                  </select>
                  <button id="add-btn" class="btn primary" style="white-space:nowrap"><svg width="16" height="16"><use href="#ico-plus"/></svg>&nbsp;Add</button>
                </div>
                <div style="display:flex; gap:8px; align-items:center; padding:0 10px 10px">
                  <label for="add-cat">Category:</label>
                  <select id="add-cat" class="sel" style="flex:1"></select>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="hd"><h3>Quick Templates</h3></div>
              <div class="bd" style="display:grid; gap:8px; padding-bottom:12px">
                <button class="btn ghost" id="tpl-ul">Ultralight Overnight</button>
                <button class="btn ghost" id="tpl-family">Family Camp Weekend</button>
                <button class="btn ghost" id="tpl-clear">Empty Starter</button>
              </div>
            </div>
          </aside>
        </div>
      </main>
    </div>
  </div>

  <!-- Import/Export Modal -->
  <div class="modal" id="modal">
    <div class="sheet">
      <div class="hd"><strong id="modal-title">Import</strong><span style="margin-left:auto"></span><button class="icon-btn" id="modal-close"><svg width="18" height="18"><use href="#ico-close"/></svg></button></div>
      <div class="bd">
        <textarea id="modal-text" class="text" rows="10" placeholder="Paste JSON here"></textarea>
        <div class="muted" style="margin-top:8px">Tip: Export produces JSON you can share or re-import.</div>
      </div>
      <div class="ft">
        <button class="btn ghost" id="modal-cancel">Cancel</button>
        <button class="btn primary" id="modal-apply">Apply</button>
      </div>
    </div>
  </div>

  <script>
  ;(() => {
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
    const uid = () => Math.random().toString(36).slice(2, 10);

    const UNIT = {
      g: { name:'grams', short:'g', to_g: v => v, from_g: v => v, step: 1 },
      oz:{ name:'ounces', short:'oz', to_g: v => v*28.349523125, from_g: v => v/28.349523125, step: 0.1 },
      lb:{ name:'pounds', short:'lb', to_g: v => v*453.59237, from_g: v => v/453.59237, step: 0.01 }
    };

    const ICONS = {
      Shelter:'ico-mountain', Sleep:'ico-pack', Cooking:'ico-fire', Water:'ico-water', Clothing:'ico-knife', Health:'ico-knife', Tools:'ico-knife', Navigation:'ico-compass', Misc:'ico-pack', Food:'ico-fire'
    };

    const LS = {
      KEY_INDEX: 'campcheck:index',
      KEY_LAST: 'campcheck:last',
      listKey: id => `campcheck:list:${id}`,
      readIndex(){ try{ return JSON.parse(localStorage.getItem(this.KEY_INDEX) || '[]'); }catch{return []} },
      writeIndex(ids){ localStorage.setItem(this.KEY_INDEX, JSON.stringify(ids)); },
      saveList(list){ list.updatedAt = Date.now(); localStorage.setItem(this.listKey(list.id), JSON.stringify(list)); if(!this.readIndex().includes(list.id)){ this.writeIndex([list.id, ...this.readIndex()]); } localStorage.setItem(this.KEY_LAST, list.id); },
      loadList(id){ const raw = localStorage.getItem(this.listKey(id)); return raw? JSON.parse(raw) : null; },
      deleteList(id){ localStorage.removeItem(this.listKey(id)); const rest = this.readIndex().filter(x=>x!==id); this.writeIndex(rest); if(localStorage.getItem(this.KEY_LAST)===id){ localStorage.removeItem(this.KEY_LAST); }},
      all(){ return this.readIndex().map(id => this.loadList(id)).filter(Boolean).sort((a,b)=> b.updatedAt - a.updatedAt); }
    };

    function grams(v){ return Math.max(0, Number.isFinite(+v)? +v : 0); }

    function createEmptyList(name='New Pack'){
      const cats = ['Shelter','Sleep','Clothing','Cooking','Water','Food','Health','Tools','Navigation','Misc'];
      return {
        id: uid(), name, date: '', location: '', unit:'g', createdAt: Date.now(), updatedAt: Date.now(),
        categories: cats.map(c => ({ id: uid(), name:c, icon:ICONS[c]||'ico-pack', collapsed:false, items:[] }))
      };
    }

    function templateUltralight(){
      const L = createEmptyList('Ultralight Overnight');
      const by = (cat, name, g, qty=1, klass='base') => L.categories.find(c=>c.name===cat).items.push({ id:uid(), name, weight_g:g, quantity:qty, checked:false, class:klass, notes:'' });
      by('Shelter','UL Tarp', 350);
      by('Shelter','Titanium Stakes', 60, 6);
      by('Sleep','Quilt 20°F', 650);
      by('Sleep','Pad (foam)', 420);
      by('Cooking','Alcohol Stove', 30);
      by('Cooking','Pot 750ml', 120);
      by('Cooking','Spoon (Ti)', 12);
      by('Water','Bottle 1L', 50, 2, 'base');
      by('Water','Water (per L)', 1000, 2, 'consumable');
      by('Clothing','Rain Jacket', 220, 1, 'worn');
      by('Clothing','Fleece', 280, 1, 'worn');
      by('Tools','Headlamp', 70);
      by('Health','Mini First Aid', 95);
      by('Navigation','Map & Compass', 120);
      by('Food','Food (per day)', 700, 1, 'consumable');
      return L;
    }

    function templateFamily(){
      const L = createEmptyList('Family Camp Weekend');
      const by = (cat, name, g, qty=1, klass='base') => L.categories.find(c=>c.name===cat).items.push({ id:uid(), name, weight_g:g, quantity:qty, checked:false, class:klass, notes:'' });
      by('Shelter','Family Tent (4P)', 4200);
      by('Shelter','Ground Tarp', 600);
      by('Sleep','Sleeping Bags', 1400, 4);
      by('Sleep','Pads', 500, 4);
      by('Cooking','2-Burner Stove', 3600);
      by('Cooking','Propane (small)', 390, 2, 'consumable');
      by('Cooking','Cookset', 1200);
      by('Water','Water Jug 5L', 500, 1, 'base');
      by('Water','Water (per L)', 1000, 5, 'consumable');
      by('Clothing','Rain Jackets', 350, 4, 'worn');
      by('Tools','Multi-tool', 250);
      by('Health','First Aid Kit', 550);
      by('Navigation','GPS', 210);
      by('Food','Snacks', 600, 1, 'consumable');
      by('Misc','Camp Chairs', 1200, 2);
      return L;
    }

    // App State
    let state = { list: createEmptyList() };

    // UI Helpers
    function formatWeightG(gVal, unit){
      const u = UNIT[unit];
      const v = u.from_g(gVal);
      const rounded = unit==='g' ? Math.round(v) : +v.toFixed(unit==='oz'? 2 : 3);
      return rounded;
    }

    function computeTotals(list){
      let base=0, cons=0, worn=0, items=0, packed=0;
      list.categories.forEach(cat => cat.items.forEach(it => {
        const totalG = grams(it.weight_g) * Math.max(1, grams(it.quantity));
        if(it.class==='base') base += totalG; else if(it.class==='consumable') cons += totalG; else if(it.class==='worn') worn += totalG;
        items++;
        if(it.checked) packed++;
      }));
      return { base, cons, worn, items, packed, planned: base+cons };
    }

    function setUnit(unit){ state.list.unit = unit; $('#base-unit').textContent = unit; $('#consumable-unit').textContent = unit; $('#worn-unit').textContent = unit; $('#total-unit').textContent = unit; render(); }

    function updateSummary(){
      const {base,cons,worn,items,packed,planned} = computeTotals(state.list);
      const u = state.list.unit;
      $('#base-weight').textContent = formatWeightG(base, u);
      $('#consumable-weight').textContent = formatWeightG(cons, u);
      $('#worn-weight').textContent = formatWeightG(worn, u);
      $('#total-weight').textContent = formatWeightG(planned, u);
      const pct = items? Math.round((packed/items)*100) : 0;
      $('#progress-bar').style.width = pct + '%';
      $('#progress-text').textContent = `${packed} / ${items} items packed`;
    }

    function renderCategories(){
      const wrap = $('#categories');
      wrap.innerHTML = '';

      const rowHead = document.createElement('div');
      rowHead.className = 'row-hd';
      rowHead.innerHTML = '<div></div><div>Item</div><div>Weight</div><div>Qty</div><div>Class</div><div></div><div></div>';

      state.list.categories.forEach(cat => {
        const card = document.createElement('div');
        card.className = 'card';
        const icon = cat.icon || 'ico-pack';
        const catWeightG = cat.items.reduce((s,it)=> s + grams(it.weight_g) * Math.max(1, grams(it.quantity)), 0);
        const total = formatWeightG(catWeightG, state.list.unit);

        const hd = document.createElement('div');
        hd.className = 'hd';
        hd.innerHTML = `
          <h3><svg width="18" height="18" style="color:#2f6d3f"><use href="#${icon}"/></svg>${cat.name}</h3>
          <div class="meta">${cat.items.length} items • ${total} ${UNIT[state.list.unit].short}</div>
          <div class="cat-ctrls">
            <button class="icon-btn" data-act="collapse" title="Collapse"><svg width="16" height="16"><use href="#ico-expand"/></svg></button>
          </div>`;
        card.appendChild(hd);

        const bd = document.createElement('div');
        bd.className = 'bd';
        if(!cat.collapsed){ bd.appendChild(rowHead.cloneNode(true)); }

        const listEl = document.createElement('div');
        if(!cat.collapsed){
          cat.items.forEach(it => listEl.appendChild(renderItemRow(cat, it)));
          // Quick add inline
          const inline = document.createElement('div'); inline.style.padding='0 10px 10px';
          inline.innerHTML = `<button class="btn ghost" data-act="quick-add" data-cat="${cat.id}"><svg width="14" height="14"><use href="#ico-plus"/></svg> Add to ${cat.name}</button>`;
          bd.appendChild(listEl);
          bd.appendChild(inline);
        }
        card.appendChild(bd);

        // Events
        hd.querySelector('[data-act="collapse"]').onclick = () => { cat.collapsed = !cat.collapsed; render(); };

        wrap.appendChild(card);
      });
    }

    function renderItemRow(cat, it){
      const row = document.createElement('div');
      row.className = 'item-row';
      row.dataset.cat = cat.id; row.dataset.id = it.id;
      const unit = state.list.unit;

      const weightDisplay = formatWeightG(it.weight_g, unit);

      row.innerHTML = `
        <input type="checkbox" class="check" ${it.checked?'checked':''} aria-label="Packed" />
        <input class="text" value="${escapeHtml(it.name)}" aria-label="Item name" />
        <input class="num" type="number" step="${UNIT[unit].step}" min="0" value="${weightDisplay}" aria-label="Weight" />
        <input class="num" type="number" step="1" min="1" value="${it.quantity}" aria-label="Quantity" />
        <select class="sel" aria-label="Class">
          <option value="base" ${it.class==='base'?'selected':''}>Base</option>
          <option value="consumable" ${it.class==='consumable'?'selected':''}>Consumable</option>
          <option value="worn" ${it.class==='worn'?'selected':''}>Worn</option>
        </select>
        <button class="icon-btn" data-act="delete" title="Delete"><svg width="16" height="16"><use href="#ico-trash"/></svg></button>
        <button class="icon-btn" data-act="dup" title="Duplicate"><svg width="16" height="16"><use href="#ico-plus"/></svg></button>
      `;

      const [chk,nameEl,wEl,qEl,clsEl,delBtn,dupBtn] = row.children;
      chk.oninput = () => { it.checked = chk.checked; updateSummary(); };
      nameEl.onchange = () => { it.name = nameEl.value.trim()||'Item'; saveSilent(); renderListsSidebar(); };
      wEl.onchange = () => { it.weight_g = grams(UNIT[unit].to_g(+wEl.value||0)); updateSummary(); renderCategories(); saveSilent(); };
      qEl.onchange = () => { it.quantity = Math.max(1, Math.round(+qEl.value||1)); updateSummary(); saveSilent(); };
      clsEl.onchange = () => { it.class = clsEl.value; updateSummary(); saveSilent(); };
      delBtn.onclick = () => { if(confirm('Remove item?')){ cat.items = cat.items.filter(x=>x.id!==it.id); render(); saveSilent(); }};
      dupBtn.onclick = () => { const c = {...it, id:uid(), checked:false}; cat.items.push(c); render(); saveSilent(); };

      return row;
    }

    // Add form
    function populateCatSelect(){ const sel=$('#add-cat'); sel.innerHTML=''; state.list.categories.forEach(c=>{ const o=document.createElement('option'); o.value=c.id; o.textContent=c.name; sel.appendChild(o); }); }
    function addItemFromForm(){
      const name=$('#add-name').value.trim(); if(!name){ $('#add-name').focus(); return; }
      const unit=state.list.unit; const w=grams(UNIT[unit].to_g(+$('#add-weight').value||0));
      const qty=Math.max(1, Math.round(+$('#add-qty').value||1));
      const klass=$('#add-class').value; const cid=$('#add-cat').value;
      const cat = state.list.categories.find(c=>c.id===cid) || state.list.categories[0];
      cat.items.push({ id:uid(), name, weight_g:w, quantity:qty, checked:false, class:klass, notes:'' });
      $('#add-name').value=''; $('#add-weight').value=''; $('#add-qty').value='1';
      render(); saveSilent();
    }

    // Lists sidebar
    function renderListsSidebar(){
      const query = $('#lists-search').value.trim().toLowerCase();
      const box = $('#lists');
      box.innerHTML = '';
      LS.all().filter(l => !query || l.name.toLowerCase().includes(query) || (l.location||'').toLowerCase().includes(query)).forEach(l => {
        const {base,cons} = computeTotals(l); const u=l.unit||'g';
        const el = document.createElement('div'); el.className='item'+(l.id===state.list.id?' active':'');
        el.innerHTML = `
          <svg width="18" height="18" style="opacity:.9"><use href="#ico-pack"/></svg>
          <div>
            <div class="name">${escapeHtml(l.name)}</div>
            <div class="muted" style="font-size:12px">${l.location||'—'} • ${new Date(l.updatedAt).toLocaleDateString()}</div>
          </div>
          <div class="meta">${formatWeightG(base+cons, u)} ${UNIT[u].short}</div>
        `;
        el.onclick = () => { loadList(l.id); closeNav(); };
        box.appendChild(el);
      });
    }

    function saveCurrentList(){
      syncTripForm(); LS.saveList(state.list); renderListsSidebar(); toast('Saved');
    }
    function saveAs(){
      const name = prompt('Save as (new list name):', state.list.name + ' (copy)'); if(!name) return;
      const clone = JSON.parse(JSON.stringify(state.list)); clone.id = uid(); clone.name = name; clone.createdAt = Date.now(); clone.updatedAt = Date.now();
      LS.saveList(clone); loadList(clone.id); toast('Saved as new list');
    }
    function duplicateList(){ saveAs(); }
    function newList(){ if(!confirm('Start a new empty list?')) return; const l=createEmptyList('New Pack'); state.list=l; fillTripForm(); renderAll(); toast('New list'); }
    function exportList(){ const data = JSON.stringify(state.list, null, 2); openModal('Export', data, false, true); }
    function importList(){ openModal('Import', '', true, false); }

    function loadList(id){ const l = LS.loadList(id); if(!l) return; state.list = migrate(l); fillTripForm(); renderAll(); }

    function migrate(l){ // ensure structure
      l.categories = (l.categories||[]).map(c => ({ id:c.id||uid(), name:c.name, icon:c.icon||ICONS[c.name]||'ico-pack', collapsed:!!c.collapsed, items:(c.items||[]).map(it=> ({ id:it.id||uid(), name:it.name||'Item', weight_g:grams(it.weight_g||0), quantity:Math.max(1, it.quantity||1), checked:!!it.checked, class:it.class||'base', notes:it.notes||'' })) }));
      l.unit = l.unit||'g';
      return l;
    }

    // Trip form sync
    function fillTripForm(){ $('#trip-name').value=state.list.name||''; $('#trip-date').value=state.list.date||''; $('#trip-location').value=state.list.location||''; $('#unit').value=state.list.unit||'g'; document.title = state.list.name + ' • Camping Gear Checklist'; $('#title-text').textContent = state.list.name; $('#subtitle-text').textContent = state.list.location? state.list.location : 'Plan, pack, and weigh your gear.'; }
    function syncTripForm(){ state.list.name = $('#trip-name').value.trim()||'My Pack'; state.list.date = $('#trip-date').value; state.list.location = $('#trip-location').value.trim(); state.list.unit = $('#unit').value; }

    // Modal helpers
    function openModal(title, text, editable, selectable){ $('#modal-title').textContent=title; const ta=$('#modal-text'); ta.value=text||''; ta.readOnly = !editable; $('#modal').classList.add('open'); if(selectable){ setTimeout(()=>{ta.select(); ta.focus();}, 0);} }
    function closeModal(){ $('#modal').classList.remove('open'); }

    // Toast
    let toastTimer=null; function toast(msg){ clearTimeout(toastTimer); let t=$('#_toast'); if(!t){ t=document.createElement('div'); t.id='_toast'; t.style.cssText='position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#173023;color:#ecffef;padding:10px 14px;border-radius:12px;box-shadow:0 10px 20px rgba(0,0,0,.25);z-index:60'; document.body.appendChild(t); } t.textContent=msg; t.style.opacity='1'; toastTimer=setTimeout(()=>{t.style.transition='opacity .4s'; t.style.opacity='0';}, 1200); }

    function render(){ populateCatSelect(); renderCategories(); updateSummary(); }
    function renderAll(){ render(); renderListsSidebar(); }

    function saveSilent(){ syncTripForm(); LS.saveList(state.list); }

    function escapeHtml(s){ return s.replace(/[&<>"]+/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    // Event wiring
    $('#unit').onchange = () => setUnit($('#unit').value);
    $('#add-btn').onclick = addItemFromForm;
    $('#add-name').addEventListener('keydown', e=>{ if(e.key==='Enter') addItemFromForm(); });
    $('#add-weight').addEventListener('keydown', e=>{ if(e.key==='Enter') addItemFromForm(); });
    $('#add-qty').addEventListener('keydown', e=>{ if(e.key==='Enter') addItemFromForm(); });

    $('#btn-save').onclick = saveCurrentList;
    $('#btn-saveas').onclick = saveAs;
    $('#btn-dup').onclick = duplicateList;
    $('#btn-new').onclick = newList;
    $('#btn-export').onclick = exportList;
    $('#btn-import').onclick = importList;
    $('#btn-print').onclick = () => window.print();

    $('#lists-search').oninput = renderListsSidebar;

    // Modal actions
    $('#modal-close').onclick = closeModal;
    $('#modal-cancel').onclick = closeModal;
    $('#modal-apply').onclick = () => {
      try{
        const data = JSON.parse($('#modal-text').value);
        if(!data || !data.categories) throw new Error('Invalid list');
        data.id = data.id || uid();
        LS.saveList(data); loadList(data.id); closeModal(); toast('Imported');
      }catch(err){ alert('Import failed: ' + err.message); }
    };

    // Nav (mobile)
    const root = $('#app'); const dim = $('#dim'); const menu = $('#menu');
    function openNav(){ root.classList.add('nav-open'); }
    function closeNav(){ root.classList.remove('nav-open'); }
    menu && (menu.onclick = openNav);
    dim && (dim.onclick = closeNav);

    // Templates
    $('#tpl-ul').onclick = () => { if(!confirm('Replace current list with Ultralight template?')) return; state.list = templateUltralight(); fillTripForm(); renderAll(); toast('Template loaded'); };
    $('#tpl-family').onclick = () => { if(!confirm('Replace current list with Family Camp template?')) return; state.list = templateFamily(); fillTripForm(); renderAll(); toast('Template loaded'); };
    $('#tpl-clear').onclick = () => { if(!confirm('Replace current list with an empty starter?')) return; state.list = createEmptyList('Empty Starter'); fillTripForm(); renderAll(); toast('Empty list'); };

    // Bootstrap
    (function init(){
      const lastId = localStorage.getItem(LS.KEY_LAST);
      if(lastId){ const l=LS.loadList(lastId); if(l){ state.list=migrate(l); }}
      // If no lists saved, seed with UL template for wow factor
      if(LS.all().length===0 && (!state.list || (state.list.categories||[]).every(c=>c.items.length===0))){ state.list = templateUltralight(); LS.saveList(state.list); }
      fillTripForm(); renderAll();
    })();
  })();
  </script>
</body>
</html>
