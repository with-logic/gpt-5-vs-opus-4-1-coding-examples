<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LinguaFlip - Language Learning Flashcards</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;
    --accent: #f59e0b;
    --accent-dark: #d97706;
    --success: #10b981;
    --success-dark: #059669;
    --bg: #0f172a;
    --bg-card: #1e293b;
    --bg-elevated: #334155;
    --text: #f1f5f9;
    --text-muted: #94a3b8;
    --text-dim: #64748b;
    --border: #475569;
    --danger: #ef4444;
    --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    --shadow-lg: 0 35px 60px -15px rgba(0, 0, 0, 0.6);
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Animated background */
  .bg-pattern {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
  }
  .bg-pattern::before {
    content: '';
    position: absolute;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(99,102,241,0.15) 0%, transparent 70%);
    top: -200px; right: -200px;
    animation: floatBg 20s ease-in-out infinite;
  }
  .bg-pattern::after {
    content: '';
    position: absolute;
    width: 500px; height: 500px;
    background: radial-gradient(circle, rgba(245,158,11,0.1) 0%, transparent 70%);
    bottom: -150px; left: -150px;
    animation: floatBg 25s ease-in-out infinite reverse;
  }
  @keyframes floatBg {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(50px, -30px) scale(1.1); }
    66% { transform: translate(-30px, 50px) scale(0.9); }
  }

  .app-container {
    position: relative;
    z-index: 1;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  .header {
    text-align: center;
    padding: 30px 0 20px;
  }
  .logo {
    font-size: 2rem;
    font-weight: 800;
    background: linear-gradient(135deg, var(--primary-light), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -0.5px;
  }
  .logo-icon {
    display: inline-block;
    margin-right: 8px;
    font-size: 1.8rem;
    -webkit-text-fill-color: initial;
  }
  .subtitle {
    color: var(--text-muted);
    font-size: 0.95rem;
    margin-top: 4px;
    font-weight: 300;
  }

  /* Screen transitions */
  .screen {
    display: none;
    animation: fadeSlideIn 0.5s ease forwards;
    flex: 1;
  }
  .screen.active {
    display: flex;
    flex-direction: column;
  }
  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeSlideOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-20px); }
  }
  .screen.exiting {
    animation: fadeSlideOut 0.35s ease forwards;
  }

  /* Language Selection */
  .lang-select-screen {
    justify-content: center;
    align-items: center;
    padding-bottom: 80px;
  }
  .lang-select-title {
    font-size: 1.6rem;
    font-weight: 700;
    margin-bottom: 6px;
    text-align: center;
  }
  .lang-select-subtitle {
    color: var(--text-muted);
    margin-bottom: 36px;
    text-align: center;
    font-size: 0.95rem;
  }
  .lang-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    width: 100%;
    max-width: 480px;
  }
  .lang-card {
    background: var(--bg-card);
    border: 2px solid transparent;
    border-radius: 16px;
    padding: 28px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  .lang-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(245,158,11,0.05));
    opacity: 0;
    transition: opacity 0.3s;
  }
  .lang-card:hover {
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -15px rgba(99, 102, 241, 0.3);
  }
  .lang-card:hover::before { opacity: 1; }
  .lang-card:active { transform: translateY(-2px) scale(0.98); }
  .lang-flag {
    font-size: 3rem;
    margin-bottom: 12px;
    display: block;
    position: relative;
    z-index: 1;
  }
  .lang-name {
    font-weight: 600;
    font-size: 1.15rem;
    position: relative;
    z-index: 1;
    margin-bottom: 2px;
  }
  .lang-native {
    color: var(--text-muted);
    font-size: 0.85rem;
    position: relative;
    z-index: 1;
  }

  /* Study Screen */
  .study-screen {
    padding-top: 10px;
  }
  .toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
  }
  .toolbar-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 18px;
    border: none;
    border-radius: 10px;
    font-family: inherit;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  .btn::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.1);
    opacity: 0;
    transition: opacity 0.2s;
  }
  .btn:hover::after { opacity: 1; }
  .btn:active { transform: scale(0.96); }

  .btn-back {
    background: var(--bg-elevated);
    color: var(--text);
    padding: 10px 14px;
  }
  .btn-shuffle {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
  }
  .btn-shuffle:hover { box-shadow: 0 8px 24px -6px rgba(99,102,241,0.5); }
  .btn-shuffle svg {
    transition: transform 0.4s;
  }
  .btn-shuffle:hover svg {
    transform: rotate(180deg);
  }

  .progress-section {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .progress-bar-container {
    width: 140px;
    height: 6px;
    background: var(--bg-elevated);
    border-radius: 3px;
    overflow: hidden;
  }
  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--success), var(--accent));
    border-radius: 3px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .progress-text {
    font-size: 0.8rem;
    color: var(--text-muted);
    font-weight: 500;
    white-space: nowrap;
  }

  /* Card Counter */
  .card-counter {
    text-align: center;
    margin-bottom: 12px;
    font-size: 0.9rem;
    color: var(--text-muted);
    font-weight: 500;
  }
  .card-counter .current-num {
    color: var(--primary-light);
    font-weight: 700;
  }

  /* Flashcard */
  .card-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    perspective: 1200px;
    padding: 10px 0 20px;
    min-height: 340px;
  }
  .flashcard-container {
    width: 100%;
    max-width: 480px;
    height: 320px;
    cursor: pointer;
    position: relative;
  }
  .flashcard {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .flashcard.flipped {
    transform: rotateY(180deg);
  }
  .flashcard-face {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    border-radius: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 36px;
    text-align: center;
    box-shadow: var(--shadow);
  }
  .flashcard-front {
    background: linear-gradient(145deg, var(--bg-card) 0%, #253349 100%);
    border: 1px solid rgba(99,102,241,0.2);
  }
  .flashcard-back {
    background: linear-gradient(145deg, #1a2744 0%, #0f2035 100%);
    border: 1px solid rgba(245,158,11,0.2);
    transform: rotateY(180deg);
  }
  .card-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 20px;
    padding: 4px 14px;
    border-radius: 20px;
  }
  .card-label-front {
    color: var(--primary-light);
    background: rgba(99,102,241,0.15);
  }
  .card-label-back {
    color: var(--accent);
    background: rgba(245,158,11,0.15);
  }
  .card-phrase {
    font-size: 1.65rem;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 12px;
  }
  .card-pronunciation {
    font-size: 1rem;
    color: var(--text-muted);
    font-style: italic;
    font-weight: 300;
  }
  .card-hint {
    position: absolute;
    bottom: 20px;
    font-size: 0.75rem;
    color: var(--text-dim);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* Swipe-out animations */
  @keyframes swipeRight {
    to {
      transform: translateX(120%) rotate(15deg);
      opacity: 0;
    }
  }
  @keyframes swipeLeft {
    to {
      transform: translateX(-120%) rotate(-15deg);
      opacity: 0;
    }
  }
  @keyframes cardEnter {
    from {
      transform: scale(0.85) translateY(30px);
      opacity: 0;
    }
    to {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
  }
  .flashcard-container.swipe-right {
    animation: swipeRight 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  .flashcard-container.swipe-left {
    animation: swipeLeft 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  .flashcard-container.card-entering {
    animation: cardEnter 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  /* Navigation */
  .card-nav {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-top: 20px;
    flex-wrap: wrap;
  }
  .btn-nav {
    background: var(--bg-elevated);
    color: var(--text);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    font-size: 1.2rem;
    transition: all 0.25s;
  }
  .btn-nav:hover {
    background: var(--border);
    transform: scale(1.1);
  }
  .btn-nav:active { transform: scale(0.95); }
  .btn-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: none !important;
  }

  .btn-learned {
    background: linear-gradient(135deg, var(--success), var(--success-dark));
    color: white;
    padding: 12px 28px;
    font-size: 0.95rem;
    border-radius: 14px;
  }
  .btn-learned:hover {
    box-shadow: 0 8px 24px -6px rgba(16,185,129,0.5);
  }
  .btn-learned.is-learned {
    background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  }

  /* Card dots indicator */
  .card-dots {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-top: 20px;
    flex-wrap: wrap;
  }
  .card-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--bg-elevated);
    transition: all 0.3s;
    cursor: pointer;
  }
  .card-dot:hover {
    background: var(--border);
    transform: scale(1.3);
  }
  .card-dot.active {
    background: var(--primary);
    width: 24px;
    border-radius: 4px;
  }
  .card-dot.learned {
    background: var(--success);
  }
  .card-dot.learned.active {
    background: var(--success);
    width: 24px;
    border-radius: 4px;
  }

  /* Completion Screen */
  .complete-screen {
    justify-content: center;
    align-items: center;
    text-align: center;
    padding-bottom: 80px;
  }
  .complete-icon {
    font-size: 5rem;
    margin-bottom: 24px;
    animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  }
  @keyframes bounceIn {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  .complete-title {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 8px;
    background: linear-gradient(135deg, var(--success), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .complete-text {
    color: var(--text-muted);
    font-size: 1.05rem;
    margin-bottom: 36px;
    line-height: 1.6;
  }
  .btn-restart {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    padding: 14px 32px;
    font-size: 1rem;
    border-radius: 14px;
  }
  .btn-new-lang {
    background: var(--bg-elevated);
    color: var(--text);
    padding: 14px 32px;
    font-size: 1rem;
    border-radius: 14px;
    margin-left: 12px;
  }

  /* Confetti */
  .confetti-piece {
    position: fixed;
    z-index: 100;
    width: 10px;
    height: 10px;
    border-radius: 2px;
    pointer-events: none;
  }
  @keyframes confettiFall {
    0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
    100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
  }

  /* Toast notification */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--bg-card);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 500;
    box-shadow: var(--shadow);
    z-index: 50;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .toast.show {
    transform: translateX(-50%) translateY(0);
  }

  /* Keyboard shortcut hints */
  .keyboard-hints {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 16px;
    flex-wrap: wrap;
  }
  .kbd-hint {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.72rem;
    color: var(--text-dim);
  }
  kbd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 22px;
    height: 22px;
    padding: 0 6px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: inherit;
    font-size: 0.7rem;
    color: var(--text-muted);
  }

  /* Responsive */
  @media (max-width: 600px) {
    .lang-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .lang-card { padding: 20px 14px; }
    .lang-flag { font-size: 2.4rem; }
    .flashcard-container { height: 280px; }
    .card-phrase { font-size: 1.35rem; }
    .toolbar { gap: 8px; }
    .btn { padding: 8px 14px; font-size: 0.8rem; }
    .card-nav { gap: 10px; }
    .btn-learned { padding: 10px 20px; font-size: 0.85rem; }
    .logo { font-size: 1.6rem; }
    .keyboard-hints { display: none; }
    .header { padding: 16px 0 10px; }
    .complete-title { font-size: 1.5rem; }
    .btn-restart, .btn-new-lang { padding: 12px 24px; }
  }
</style>
</head>
<body>

<div class="bg-pattern"></div>

<div class="app-container">
  <header class="header">
    <div class="logo"><span class="logo-icon">&#x1F30D;</span>LinguaFlip</div>
    <p class="subtitle" id="appSubtitle">Master essential phrases, one card at a time</p>
  </header>

  <!-- Language Selection Screen -->
  <div class="screen active" id="langScreen">
    <div class="lang-select-screen" style="display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;">
      <h2 class="lang-select-title" id="selectTitle">Which language do you want to learn?</h2>
      <p class="lang-select-subtitle" id="selectSubtitle">Choose a language to get started with essential travel phrases</p>
      <div class="lang-grid">
        <div class="lang-card" data-lang="english" tabindex="0" role="button">
          <span class="lang-flag">&#127468;&#127463;</span>
          <div class="lang-name">English</div>
          <div class="lang-native">English</div>
        </div>
        <div class="lang-card" data-lang="spanish" tabindex="0" role="button">
          <span class="lang-flag">&#127466;&#127480;</span>
          <div class="lang-name">Spanish</div>
          <div class="lang-native">Espa&#241;ol</div>
        </div>
        <div class="lang-card" data-lang="french" tabindex="0" role="button">
          <span class="lang-flag">&#127467;&#127479;</span>
          <div class="lang-name">French</div>
          <div class="lang-native">Fran&#231;ais</div>
        </div>
        <div class="lang-card" data-lang="japanese" tabindex="0" role="button">
          <span class="lang-flag">&#127471;&#127477;</span>
          <div class="lang-name">Japanese</div>
          <div class="lang-native">&#26085;&#26412;&#35486;</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Study Screen -->
  <div class="screen" id="studyScreen">
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="btn btn-back" id="btnBack" aria-label="Go back">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <button class="btn btn-shuffle" id="btnShuffle">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
          <span id="shuffleText">Shuffle</span>
        </button>
      </div>
      <div class="progress-section">
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
        </div>
        <span class="progress-text" id="progressText">0 / 10 learned</span>
      </div>
    </div>

    <div class="card-counter">
      <span class="current-num" id="cardCurrent">1</span> <span id="ofText">of</span> <span id="cardTotal">10</span>
    </div>

    <div class="card-area">
      <div class="flashcard-container" id="flashcardContainer">
        <div class="flashcard" id="flashcard">
          <div class="flashcard-face flashcard-front">
            <span class="card-label card-label-front" id="frontLabel">YOUR LANGUAGE</span>
            <div class="card-phrase" id="frontPhrase">Hello</div>
            <div class="card-hint" id="tapHint">
              <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5"/></svg>
              <span id="tapHintText">Tap to flip</span>
            </div>
          </div>
          <div class="flashcard-face flashcard-back">
            <span class="card-label card-label-back" id="backLabel">TRANSLATION</span>
            <div class="card-phrase" id="backPhrase">Hola</div>
            <div class="card-pronunciation" id="backPronunciation"></div>
            <div class="card-hint" id="tapHintBack">
              <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5"/></svg>
              <span id="tapHintTextBack">Tap to flip back</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card-nav">
      <button class="btn-nav" id="btnPrev" aria-label="Previous card">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
      </button>
      <button class="btn btn-learned" id="btnLearned">
        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
        <span id="learnedText">Mark as Learned</span>
      </button>
      <button class="btn-nav" id="btnNext" aria-label="Next card">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
      </button>
    </div>

    <div class="card-dots" id="cardDots"></div>

    <div class="keyboard-hints">
      <span class="kbd-hint"><kbd>&#8592;</kbd><kbd>&#8594;</kbd> navigate</span>
      <span class="kbd-hint"><kbd>Space</kbd> flip</span>
      <span class="kbd-hint"><kbd>Enter</kbd> <span id="kbdLearnText">learn</span></span>
      <span class="kbd-hint"><kbd>S</kbd> shuffle</span>
    </div>
  </div>

  <!-- Completion Screen -->
  <div class="screen" id="completeScreen">
    <div class="complete-screen" style="display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;">
      <div class="complete-icon">&#127881;</div>
      <h2 class="complete-title" id="completeTitle">Amazing work!</h2>
      <p class="complete-text" id="completeText">You've mastered all 10 essential travel phrases.<br>Keep practicing to stay sharp!</p>
      <div>
        <button class="btn btn-restart" id="btnRestart">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
          <span id="restartText">Practice Again</span>
        </button>
        <button class="btn btn-new-lang" id="btnNewLang">
          <span id="newLangText">New Language</span>
        </button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast">
  <span id="toastIcon"></span>
  <span id="toastMsg"></span>
</div>

<script>
(function() {
  'use strict';

  // --- Phrase Database ---
  const phrases = {
    english: [
      { phrase: "Hello", translation: "Hello", pronunciation: "" },
      { phrase: "Thank you very much", translation: "Thank you very much", pronunciation: "" },
      { phrase: "Where is the bathroom?", translation: "Where is the bathroom?", pronunciation: "" },
      { phrase: "How much does this cost?", translation: "How much does this cost?", pronunciation: "" },
      { phrase: "I need help, please", translation: "I need help, please", pronunciation: "" },
      { phrase: "Can you recommend a restaurant?", translation: "Can you recommend a restaurant?", pronunciation: "" },
      { phrase: "I would like to order this", translation: "I would like to order this", pronunciation: "" },
      { phrase: "Where is the train station?", translation: "Where is the train station?", pronunciation: "" },
      { phrase: "Do you speak my language?", translation: "Do you speak my language?", pronunciation: "" },
      { phrase: "Goodbye, have a nice day!", translation: "Goodbye, have a nice day!", pronunciation: "" }
    ],
    spanish: [
      { phrase: "Hello", translation: "Hola", pronunciation: "OH-lah" },
      { phrase: "Thank you very much", translation: "Muchas gracias", pronunciation: "MOO-chas GRAH-see-ahs" },
      { phrase: "Where is the bathroom?", translation: "\u00bfD\u00f3nde est\u00e1 el ba\u00f1o?", pronunciation: "DOHN-deh ehs-TAH el BAH-nyoh" },
      { phrase: "How much does this cost?", translation: "\u00bfCu\u00e1nto cuesta esto?", pronunciation: "KWAHN-toh KWEHS-tah EHS-toh" },
      { phrase: "I need help, please", translation: "Necesito ayuda, por favor", pronunciation: "neh-seh-SEE-toh ah-YOO-dah por fah-VOR" },
      { phrase: "Can you recommend a restaurant?", translation: "\u00bfPuede recomendar un restaurante?", pronunciation: "PWEH-deh reh-koh-men-DAR oon rehs-tow-RAHN-teh" },
      { phrase: "I would like to order this", translation: "Me gustar\u00eda pedir esto", pronunciation: "meh goos-tah-REE-ah peh-DEER EHS-toh" },
      { phrase: "Where is the train station?", translation: "\u00bfD\u00f3nde est\u00e1 la estaci\u00f3n de tren?", pronunciation: "DOHN-deh ehs-TAH lah ehs-tah-see-OHN deh trehn" },
      { phrase: "Do you speak English?", translation: "\u00bfHabla ingl\u00e9s?", pronunciation: "AH-blah een-GLEHS" },
      { phrase: "Goodbye, have a nice day!", translation: "\u00a1Adi\u00f3s, que tenga un buen d\u00eda!", pronunciation: "ah-dee-OHS keh TEHN-gah oon bwehn DEE-ah" }
    ],
    french: [
      { phrase: "Hello", translation: "Bonjour", pronunciation: "bohn-ZHOOR" },
      { phrase: "Thank you very much", translation: "Merci beaucoup", pronunciation: "mehr-SEE boh-KOO" },
      { phrase: "Where is the bathroom?", translation: "O\u00f9 sont les toilettes\u00a0?", pronunciation: "oo sohn leh twah-LET" },
      { phrase: "How much does this cost?", translation: "Combien \u00e7a co\u00fbte\u00a0?", pronunciation: "kohm-bee-EHN sah KOOT" },
      { phrase: "I need help, please", translation: "J\u2019ai besoin d\u2019aide, s\u2019il vous pla\u00eet", pronunciation: "zhay beh-ZWAHN dehd seel voo PLEH" },
      { phrase: "Can you recommend a restaurant?", translation: "Pouvez-vous recommander un restaurant\u00a0?", pronunciation: "poo-vay VOO reh-koh-mahn-DAY uhn rehs-toh-RAHN" },
      { phrase: "I would like to order this", translation: "Je voudrais commander ceci", pronunciation: "zhuh voo-DREH koh-mahn-DAY seh-SEE" },
      { phrase: "Where is the train station?", translation: "O\u00f9 est la gare\u00a0?", pronunciation: "oo eh lah GAHR" },
      { phrase: "Do you speak English?", translation: "Parlez-vous anglais\u00a0?", pronunciation: "par-lay VOO ahn-GLEH" },
      { phrase: "Goodbye, have a nice day!", translation: "Au revoir, bonne journ\u00e9e\u00a0!", pronunciation: "oh reh-VWAHR bun zhoor-NAY" }
    ],
    japanese: [
      { phrase: "Hello", translation: "\u3053\u3093\u306b\u3061\u306f", pronunciation: "Konnichiwa" },
      { phrase: "Thank you very much", translation: "\u3069\u3046\u3082\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059", pronunciation: "Domo arigato gozaimasu" },
      { phrase: "Where is the bathroom?", translation: "\u30c8\u30a4\u30ec\u306f\u3069\u3053\u3067\u3059\u304b\uff1f", pronunciation: "Toire wa doko desu ka?" },
      { phrase: "How much does this cost?", translation: "\u3053\u308c\u306f\u3044\u304f\u3089\u3067\u3059\u304b\uff1f", pronunciation: "Kore wa ikura desu ka?" },
      { phrase: "I need help, please", translation: "\u52a9\u3051\u3066\u304f\u3060\u3055\u3044", pronunciation: "Tasukete kudasai" },
      { phrase: "Can you recommend a restaurant?", translation: "\u304a\u3059\u3059\u3081\u306e\u30ec\u30b9\u30c8\u30e9\u30f3\u306f\u3042\u308a\u307e\u3059\u304b\uff1f", pronunciation: "Osusume no resutoran wa arimasu ka?" },
      { phrase: "I would like to order this", translation: "\u3053\u308c\u3092\u304f\u3060\u3055\u3044", pronunciation: "Kore o kudasai" },
      { phrase: "Where is the train station?", translation: "\u99c5\u306f\u3069\u3053\u3067\u3059\u304b\uff1f", pronunciation: "Eki wa doko desu ka?" },
      { phrase: "Do you speak English?", translation: "\u82f1\u8a9e\u3092\u8a71\u305b\u307e\u3059\u304b\uff1f", pronunciation: "Eigo o hanasemasu ka?" },
      { phrase: "Goodbye, have a nice day!", translation: "\u3055\u3088\u3046\u306a\u3089\u3001\u826f\u3044\u4e00\u65e5\u3092\uff01", pronunciation: "Sayonara, yoi ichinichi o!" }
    ]
  };

  // --- UI Translations (locale-based) ---
  const uiStrings = {
    en: {
      subtitle: "Master essential phrases, one card at a time",
      selectTitle: "Which language do you want to learn?",
      selectSubtitle: "Choose a language to get started with essential travel phrases",
      shuffle: "Shuffle",
      of: "of",
      learned: "learned",
      markLearned: "Mark as Learned",
      unmark: "Unmark",
      tapFlip: "Tap to flip",
      tapFlipBack: "Tap to flip back",
      completeTitle: "Amazing work!",
      completeText: "You've mastered all 10 essential travel phrases.<br>Keep practicing to stay sharp!",
      restart: "Practice Again",
      newLang: "New Language",
      toastLearned: "Phrase marked as learned!",
      toastUnlearned: "Phrase unmarked",
      toastShuffled: "Cards shuffled!",
      toastAllDone: "All cards learned!",
      kbdLearn: "learn",
      yourLang: "YOUR LANGUAGE",
      translation: "TRANSLATION"
    },
    es: {
      subtitle: "Domina frases esenciales, una tarjeta a la vez",
      selectTitle: "\u00bfQu\u00e9 idioma quieres aprender?",
      selectSubtitle: "Elige un idioma para comenzar con frases de viaje esenciales",
      shuffle: "Mezclar",
      of: "de",
      learned: "aprendidas",
      markLearned: "Marcar aprendida",
      unmark: "Desmarcar",
      tapFlip: "Toca para voltear",
      tapFlipBack: "Toca para volver",
      completeTitle: "\u00a1Excelente trabajo!",
      completeText: "Has dominado las 10 frases de viaje esenciales.<br>\u00a1Sigue practicando!",
      restart: "Practicar de nuevo",
      newLang: "Nuevo idioma",
      toastLearned: "\u00a1Frase marcada como aprendida!",
      toastUnlearned: "Frase desmarcada",
      toastShuffled: "\u00a1Tarjetas mezcladas!",
      toastAllDone: "\u00a1Todas las tarjetas aprendidas!",
      kbdLearn: "aprender",
      yourLang: "TU IDIOMA",
      translation: "TRADUCCI\u00d3N"
    },
    fr: {
      subtitle: "Ma\u00eetrisez les phrases essentielles, une carte \u00e0 la fois",
      selectTitle: "Quelle langue voulez-vous apprendre\u00a0?",
      selectSubtitle: "Choisissez une langue pour d\u00e9buter avec des phrases de voyage essentielles",
      shuffle: "M\u00e9langer",
      of: "sur",
      learned: "apprises",
      markLearned: "Marquer apprise",
      unmark: "D\u00e9marquer",
      tapFlip: "Appuyez pour retourner",
      tapFlipBack: "Appuyez pour revenir",
      completeTitle: "Excellent travail\u00a0!",
      completeText: "Vous avez ma\u00eetris\u00e9 les 10 phrases de voyage essentielles.<br>Continuez \u00e0 pratiquer\u00a0!",
      restart: "Recommencer",
      newLang: "Nouvelle langue",
      toastLearned: "Phrase marqu\u00e9e comme apprise\u00a0!",
      toastUnlearned: "Phrase d\u00e9marqu\u00e9e",
      toastShuffled: "Cartes m\u00e9lang\u00e9es\u00a0!",
      toastAllDone: "Toutes les cartes apprises\u00a0!",
      kbdLearn: "apprendre",
      yourLang: "VOTRE LANGUE",
      translation: "TRADUCTION"
    },
    ja: {
      subtitle: "\u4e00\u679a\u305a\u3064\u3001\u5fc5\u9808\u30d5\u30ec\u30fc\u30ba\u3092\u30de\u30b9\u30bf\u30fc",
      selectTitle: "\u3069\u306e\u8a00\u8a9e\u3092\u5b66\u3073\u305f\u3044\u3067\u3059\u304b\uff1f",
      selectSubtitle: "\u65c5\u884c\u306b\u4fbf\u5229\u306a\u30d5\u30ec\u30fc\u30ba\u3092\u5b66\u3073\u307e\u3057\u3087\u3046",
      shuffle: "\u30b7\u30e3\u30c3\u30d5\u30eb",
      of: "/",
      learned: "\u7fd2\u5f97\u6e08\u307f",
      markLearned: "\u7fd2\u5f97\u6e08\u307f\u306b\u3059\u308b",
      unmark: "\u53d6\u308a\u6d88\u3059",
      tapFlip: "\u30bf\u30c3\u30d7\u3067\u88cf\u8fd4\u3057",
      tapFlipBack: "\u30bf\u30c3\u30d7\u3067\u623b\u3059",
      completeTitle: "\u7d20\u6674\u3089\u3057\u3044\uff01",
      completeText: "\u65c5\u884c\u306b\u5fc5\u9808\u306e10\u30d5\u30ec\u30fc\u30ba\u3092\u5168\u3066\u7fd2\u5f97\u3057\u307e\u3057\u305f\u3002<br>\u5f15\u304d\u7d9a\u304d\u7df4\u7fd2\u3057\u307e\u3057\u3087\u3046\uff01",
      restart: "\u3082\u3046\u4e00\u5ea6\u7df4\u7fd2",
      newLang: "\u65b0\u3057\u3044\u8a00\u8a9e",
      toastLearned: "\u30d5\u30ec\u30fc\u30ba\u3092\u7fd2\u5f97\u6e08\u307f\u306b\u3057\u307e\u3057\u305f\uff01",
      toastUnlearned: "\u30d5\u30ec\u30fc\u30ba\u306e\u7fd2\u5f97\u3092\u53d6\u308a\u6d88\u3057\u307e\u3057\u305f",
      toastShuffled: "\u30ab\u30fc\u30c9\u3092\u30b7\u30e3\u30c3\u30d5\u30eb\u3057\u307e\u3057\u305f\uff01",
      toastAllDone: "\u5168\u3066\u306e\u30ab\u30fc\u30c9\u3092\u7fd2\u5f97\u3057\u307e\u3057\u305f\uff01",
      kbdLearn: "\u7fd2\u5f97",
      yourLang: "\u3042\u306a\u305f\u306e\u8a00\u8a9e",
      translation: "\u7ffb\u8a33"
    }
  };

  // --- Detect user locale ---
  function detectLocale() {
    const lang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
    if (lang.startsWith('es')) return 'es';
    if (lang.startsWith('fr')) return 'fr';
    if (lang.startsWith('ja')) return 'ja';
    return 'en';
  }

  let currentLocale = detectLocale();
  let ui = uiStrings[currentLocale];

  function applyUITranslations() {
    ui = uiStrings[currentLocale];
    document.getElementById('appSubtitle').textContent = ui.subtitle;
    document.getElementById('selectTitle').textContent = ui.selectTitle;
    document.getElementById('selectSubtitle').textContent = ui.selectSubtitle;
    document.getElementById('shuffleText').textContent = ui.shuffle;
    document.getElementById('ofText').textContent = ui.of;
    document.getElementById('tapHintText').textContent = ui.tapFlip;
    document.getElementById('tapHintTextBack').textContent = ui.tapFlipBack;
    document.getElementById('completeTitle').textContent = ui.completeTitle;
    document.getElementById('completeText').innerHTML = ui.completeText;
    document.getElementById('restartText').textContent = ui.restart;
    document.getElementById('newLangText').textContent = ui.newLang;
    document.getElementById('kbdLearnText').textContent = ui.kbdLearn;
  }

  // --- State ---
  let currentLang = null;
  let currentCards = [];
  let learned = new Set();
  let currentIndex = 0;
  let isFlipped = false;
  let isAnimating = false;

  // --- DOM Refs ---
  const langScreen = document.getElementById('langScreen');
  const studyScreen = document.getElementById('studyScreen');
  const completeScreen = document.getElementById('completeScreen');
  const flashcard = document.getElementById('flashcard');
  const flashcardContainer = document.getElementById('flashcardContainer');
  const frontPhrase = document.getElementById('frontPhrase');
  const backPhrase = document.getElementById('backPhrase');
  const backPronunciation = document.getElementById('backPronunciation');
  const frontLabel = document.getElementById('frontLabel');
  const backLabel = document.getElementById('backLabel');
  const cardCurrent = document.getElementById('cardCurrent');
  const cardTotal = document.getElementById('cardTotal');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  const learnedText = document.getElementById('learnedText');
  const btnLearned = document.getElementById('btnLearned');
  const btnPrev = document.getElementById('btnPrev');
  const btnNext = document.getElementById('btnNext');
  const cardDots = document.getElementById('cardDots');
  const toast = document.getElementById('toast');
  const toastMsg = document.getElementById('toastMsg');
  const toastIcon = document.getElementById('toastIcon');

  // --- Screen Transitions ---
  function switchScreen(from, to) {
    from.classList.add('exiting');
    setTimeout(() => {
      from.classList.remove('active', 'exiting');
      to.classList.add('active');
    }, 350);
  }

  // --- Init Language ---
  function selectLanguage(lang) {
    currentLang = lang;
    // Adjust the "front" label based on what the user's base language likely is
    // and which language they are learning
    const langNames = { english: "English", spanish: "Spanish", french: "French", japanese: "Japanese" };

    // For English speakers learning X: front=English, back=X
    // But we adapt based on the phrases structure
    currentCards = phrases[lang].map((p, i) => ({ ...p, id: i }));
    learned = new Set();
    currentIndex = 0;
    isFlipped = false;

    frontLabel.textContent = ui.yourLang;
    backLabel.textContent = ui.translation;

    renderCard();
    renderDots();
    updateProgress();
    updateNavButtons();
    switchScreen(langScreen, studyScreen);
  }

  // --- Render Card ---
  function renderCard() {
    if (currentCards.length === 0) return;
    const card = currentCards[currentIndex];
    frontPhrase.textContent = card.phrase;
    backPhrase.textContent = card.translation;
    backPronunciation.textContent = card.pronunciation || '';
    backPronunciation.style.display = card.pronunciation ? 'block' : 'none';

    // Reset flip
    isFlipped = false;
    flashcard.classList.remove('flipped');

    // Update learned button
    const isLearned = learned.has(card.id);
    btnLearned.classList.toggle('is-learned', isLearned);
    learnedText.textContent = isLearned ? ui.unmark : ui.markLearned;
  }

  function renderDots() {
    cardDots.innerHTML = '';
    currentCards.forEach((card, i) => {
      const dot = document.createElement('div');
      dot.className = 'card-dot';
      if (i === currentIndex) dot.classList.add('active');
      if (learned.has(card.id)) dot.classList.add('learned');
      dot.addEventListener('click', () => {
        if (isAnimating) return;
        goToCard(i);
      });
      cardDots.appendChild(dot);
    });
  }

  function updateProgress() {
    const total = currentCards.length;
    const count = learned.size;
    const pct = total > 0 ? (count / total * 100) : 0;
    progressBar.style.width = pct + '%';
    progressText.textContent = count + ' ' + ui.of + ' ' + total + ' ' + ui.learned;
    cardCurrent.textContent = currentIndex + 1;
    cardTotal.textContent = total;
  }

  function updateNavButtons() {
    btnPrev.disabled = currentIndex <= 0;
    btnNext.disabled = currentIndex >= currentCards.length - 1;
  }

  function goToCard(index) {
    if (index < 0 || index >= currentCards.length || index === currentIndex || isAnimating) return;
    isAnimating = true;
    const direction = index > currentIndex ? 'swipe-left' : 'swipe-right';
    flashcardContainer.classList.add(direction);
    setTimeout(() => {
      currentIndex = index;
      renderCard();
      renderDots();
      updateProgress();
      updateNavButtons();
      flashcardContainer.classList.remove(direction);
      flashcardContainer.classList.add('card-entering');
      setTimeout(() => {
        flashcardContainer.classList.remove('card-entering');
        isAnimating = false;
      }, 400);
    }, 400);
  }

  // --- Flip Card ---
  function flipCard() {
    if (isAnimating) return;
    isFlipped = !isFlipped;
    flashcard.classList.toggle('flipped', isFlipped);
  }

  // --- Toggle Learned ---
  function toggleLearned() {
    if (currentCards.length === 0 || isAnimating) return;
    const card = currentCards[currentIndex];
    if (learned.has(card.id)) {
      learned.delete(card.id);
      showToast(ui.toastUnlearned, '\u21A9\uFE0F');
    } else {
      learned.add(card.id);
      showToast(ui.toastLearned, '\u2705');

      // Check if all learned
      if (learned.size === currentCards.length) {
        setTimeout(() => {
          showCompletionScreen();
        }, 600);
        return;
      }

      // Auto-advance to next unlearned card
      const nextUnlearned = findNextUnlearned();
      if (nextUnlearned !== -1 && nextUnlearned !== currentIndex) {
        setTimeout(() => goToCard(nextUnlearned), 350);
      }
    }
    const isLearned = learned.has(card.id);
    btnLearned.classList.toggle('is-learned', isLearned);
    learnedText.textContent = isLearned ? ui.unmark : ui.markLearned;
    renderDots();
    updateProgress();
  }

  function findNextUnlearned() {
    // Find next unlearned card after current
    for (let i = currentIndex + 1; i < currentCards.length; i++) {
      if (!learned.has(currentCards[i].id)) return i;
    }
    // Wrap around
    for (let i = 0; i < currentIndex; i++) {
      if (!learned.has(currentCards[i].id)) return i;
    }
    return -1;
  }

  // --- Shuffle ---
  function shuffleCards() {
    if (isAnimating || currentCards.length === 0) return;
    isAnimating = true;
    flashcardContainer.classList.add('swipe-left');
    setTimeout(() => {
      // Fisher-Yates shuffle
      for (let i = currentCards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [currentCards[i], currentCards[j]] = [currentCards[j], currentCards[i]];
      }
      currentIndex = 0;
      renderCard();
      renderDots();
      updateProgress();
      updateNavButtons();
      flashcardContainer.classList.remove('swipe-left');
      flashcardContainer.classList.add('card-entering');
      showToast(ui.toastShuffled, '\u{1F500}');
      setTimeout(() => {
        flashcardContainer.classList.remove('card-entering');
        isAnimating = false;
      }, 400);
    }, 400);
  }

  // --- Completion ---
  function showCompletionScreen() {
    showToast(ui.toastAllDone, '\u{1F389}');
    setTimeout(() => {
      switchScreen(studyScreen, completeScreen);
      launchConfetti();
    }, 300);
  }

  function launchConfetti() {
    const colors = ['#6366f1', '#f59e0b', '#10b981', '#ef4444', '#818cf8', '#fbbf24', '#34d399', '#f87171'];
    for (let i = 0; i < 60; i++) {
      const piece = document.createElement('div');
      piece.className = 'confetti-piece';
      piece.style.left = Math.random() * 100 + 'vw';
      piece.style.background = colors[Math.floor(Math.random() * colors.length)];
      piece.style.width = (Math.random() * 8 + 6) + 'px';
      piece.style.height = (Math.random() * 8 + 6) + 'px';
      piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
      piece.style.animation = `confettiFall ${Math.random() * 2 + 2}s linear ${Math.random() * 0.5}s forwards`;
      document.body.appendChild(piece);
      setTimeout(() => piece.remove(), 4000);
    }
  }

  // --- Toast ---
  let toastTimer;
  function showToast(msg, icon) {
    clearTimeout(toastTimer);
    toastMsg.textContent = msg;
    toastIcon.textContent = icon || '';
    toast.classList.add('show');
    toastTimer = setTimeout(() => {
      toast.classList.remove('show');
    }, 2200);
  }

  // --- Event Listeners ---

  // Language cards
  document.querySelectorAll('.lang-card').forEach(card => {
    card.addEventListener('click', () => selectLanguage(card.dataset.lang));
    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        selectLanguage(card.dataset.lang);
      }
    });
  });

  // Flashcard flip
  flashcardContainer.addEventListener('click', flipCard);

  // Navigation
  btnPrev.addEventListener('click', () => goToCard(currentIndex - 1));
  btnNext.addEventListener('click', () => goToCard(currentIndex + 1));
  btnLearned.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleLearned();
  });
  document.getElementById('btnShuffle').addEventListener('click', shuffleCards);
  document.getElementById('btnBack').addEventListener('click', () => {
    switchScreen(studyScreen, langScreen);
  });

  // Completion screen
  document.getElementById('btnRestart').addEventListener('click', () => {
    learned = new Set();
    currentIndex = 0;
    currentCards = phrases[currentLang].map((p, i) => ({ ...p, id: i }));
    renderCard();
    renderDots();
    updateProgress();
    updateNavButtons();
    switchScreen(completeScreen, studyScreen);
  });
  document.getElementById('btnNewLang').addEventListener('click', () => {
    switchScreen(completeScreen, langScreen);
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Only when study screen is active
    if (!studyScreen.classList.contains('active')) return;
    if (e.key === 'ArrowLeft') {
      e.preventDefault();
      goToCard(currentIndex - 1);
    } else if (e.key === 'ArrowRight') {
      e.preventDefault();
      goToCard(currentIndex + 1);
    } else if (e.key === ' ') {
      e.preventDefault();
      flipCard();
    } else if (e.key === 'Enter') {
      e.preventDefault();
      toggleLearned();
    } else if (e.key === 's' || e.key === 'S') {
      e.preventDefault();
      shuffleCards();
    }
  });

  // Touch swipe support
  let touchStartX = 0;
  let touchStartY = 0;
  let touchMoved = false;
  flashcardContainer.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
    touchMoved = false;
  }, { passive: true });
  flashcardContainer.addEventListener('touchmove', (e) => {
    const dx = Math.abs(e.touches[0].clientX - touchStartX);
    const dy = Math.abs(e.touches[0].clientY - touchStartY);
    if (dx > 10 || dy > 10) touchMoved = true;
  }, { passive: true });
  flashcardContainer.addEventListener('touchend', (e) => {
    if (touchMoved) {
      const dx = e.changedTouches[0].clientX - touchStartX;
      if (Math.abs(dx) > 60) {
        if (dx > 0) goToCard(currentIndex - 1);
        else goToCard(currentIndex + 1);
        e.preventDefault();
        return;
      }
    }
    // tap handled by click
  });

  // --- For English learners: Adjust the front to match user's locale language ---
  // If user locale is Spanish and they're learning French, front shows Spanish phrase
  // We'll create locale-translated front phrases for non-English locales
  const localePhrases = {
    en: [
      "Hello",
      "Thank you very much",
      "Where is the bathroom?",
      "How much does this cost?",
      "I need help, please",
      "Can you recommend a restaurant?",
      "I would like to order this",
      "Where is the train station?",
      "Do you speak English?",
      "Goodbye, have a nice day!"
    ],
    es: [
      "Hola",
      "Muchas gracias",
      "\u00bfD\u00f3nde est\u00e1 el ba\u00f1o?",
      "\u00bfCu\u00e1nto cuesta esto?",
      "Necesito ayuda, por favor",
      "\u00bfPuede recomendar un restaurante?",
      "Me gustar\u00eda pedir esto",
      "\u00bfD\u00f3nde est\u00e1 la estaci\u00f3n de tren?",
      "\u00bfHabla ingl\u00e9s?",
      "\u00a1Adi\u00f3s, que tenga un buen d\u00eda!"
    ],
    fr: [
      "Bonjour",
      "Merci beaucoup",
      "O\u00f9 sont les toilettes\u00a0?",
      "Combien \u00e7a co\u00fbte\u00a0?",
      "J\u2019ai besoin d\u2019aide, s\u2019il vous pla\u00eet",
      "Pouvez-vous recommander un restaurant\u00a0?",
      "Je voudrais commander ceci",
      "O\u00f9 est la gare\u00a0?",
      "Parlez-vous anglais\u00a0?",
      "Au revoir, bonne journ\u00e9e\u00a0!"
    ],
    ja: [
      "\u3053\u3093\u306b\u3061\u306f",
      "\u3069\u3046\u3082\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059",
      "\u30c8\u30a4\u30ec\u306f\u3069\u3053\u3067\u3059\u304b\uff1f",
      "\u3053\u308c\u306f\u3044\u304f\u3089\u3067\u3059\u304b\uff1f",
      "\u52a9\u3051\u3066\u304f\u3060\u3055\u3044",
      "\u304a\u3059\u3059\u3081\u306e\u30ec\u30b9\u30c8\u30e9\u30f3\u306f\u3042\u308a\u307e\u3059\u304b\uff1f",
      "\u3053\u308c\u3092\u304f\u3060\u3055\u3044",
      "\u99c5\u306f\u3069\u3053\u3067\u3059\u304b\uff1f",
      "\u82f1\u8a9e\u3092\u8a71\u305b\u307e\u3059\u304b\uff1f",
      "\u3055\u3088\u3046\u306a\u3089\u3001\u826f\u3044\u4e00\u65e5\u3092\uff01"
    ]
  };

  // Override selectLanguage to also set front phrases from user's locale
  const origSelectLanguage = selectLanguage;
  selectLanguage = function(lang) {
    currentLang = lang;
    const userPhrases = localePhrases[currentLocale] || localePhrases.en;

    currentCards = phrases[lang].map((p, i) => ({
      ...p,
      id: i,
      // If user is learning English and their locale is e.g. Spanish,
      // front = Spanish phrase (from their locale), back = English phrase
      // If learning a different lang, front = user's locale phrase, back = target lang
      phrase: userPhrases[i],
    }));

    // If the user's locale matches the target language, use English as the front
    if ((currentLocale === 'es' && lang === 'spanish') ||
        (currentLocale === 'fr' && lang === 'french') ||
        (currentLocale === 'ja' && lang === 'japanese') ||
        (currentLocale === 'en' && lang === 'english')) {
      // They're "learning" their own language â€” use English as front
      currentCards = phrases[lang].map((p, i) => ({
        ...p,
        id: i,
        phrase: localePhrases.en[i],
      }));
    }

    // Handle the "do you speak..." phrase contextually
    // For each language, adjust phrase #9 (index 8) if needed
    // The target translation should ask about the user's language, not English
    // Actually, keep it as-is since these are the target language phrases

    learned = new Set();
    currentIndex = 0;
    isFlipped = false;

    const langLabels = {
      en: { english: "English", spanish: "Spanish", french: "French", japanese: "Japanese" },
      es: { english: "Ingl\u00e9s", spanish: "Espa\u00f1ol", french: "Franc\u00e9s", japanese: "Japon\u00e9s" },
      fr: { english: "Anglais", spanish: "Espagnol", french: "Fran\u00e7ais", japanese: "Japonais" },
      ja: { english: "\u82f1\u8a9e", spanish: "\u30b9\u30da\u30a4\u30f3\u8a9e", french: "\u30d5\u30e9\u30f3\u30b9\u8a9e", japanese: "\u65e5\u672c\u8a9e" }
    };

    frontLabel.textContent = ui.yourLang;
    backLabel.textContent = (langLabels[currentLocale] || langLabels.en)[lang] || ui.translation;

    renderCard();
    renderDots();
    updateProgress();
    updateNavButtons();
    switchScreen(langScreen, studyScreen);
  };

  // --- Init ---
  applyUITranslations();

})();
</script>
</body>
</html>