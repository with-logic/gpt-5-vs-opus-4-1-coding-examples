<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online Poll Board</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

  :root {
    --bg: #f0f4ff;
    --card: #ffffff;
    --primary: #6366f1;
    --primary-light: #818cf8;
    --primary-dark: #4f46e5;
    --accent: #f59e0b;
    --accent-light: #fbbf24;
    --text: #1e293b;
    --text-light: #64748b;
    --text-lighter: #94a3b8;
    --border: #e2e8f0;
    --success: #10b981;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.04);
    --shadow-lg: 0 10px 30px rgba(0,0,0,0.08), 0 4px 8px rgba(0,0,0,0.04);
    --shadow-xl: 0 20px 50px rgba(0,0,0,0.1), 0 8px 16px rgba(0,0,0,0.05);
    --radius: 16px;
    --radius-sm: 10px;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  /* Animated background blobs */
  .bg-blob {
    position: fixed;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.4;
    z-index: 0;
    animation: blobFloat 20s ease-in-out infinite;
    pointer-events: none;
  }
  .bg-blob:nth-child(1) {
    width: 500px; height: 500px;
    background: #c7d2fe;
    top: -100px; left: -100px;
    animation-delay: 0s;
  }
  .bg-blob:nth-child(2) {
    width: 400px; height: 400px;
    background: #fde68a;
    top: 50%; right: -80px;
    animation-delay: -7s;
    animation-duration: 25s;
  }
  .bg-blob:nth-child(3) {
    width: 350px; height: 350px;
    background: #a7f3d0;
    bottom: -50px; left: 30%;
    animation-delay: -14s;
    animation-duration: 22s;
  }
  .bg-blob:nth-child(4) {
    width: 300px; height: 300px;
    background: #fecaca;
    top: 20%; left: 50%;
    animation-delay: -3s;
    animation-duration: 28s;
  }

  @keyframes blobFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(40px, -30px) scale(1.05); }
    50% { transform: translate(-20px, 40px) scale(0.95); }
    75% { transform: translate(30px, 20px) scale(1.02); }
  }

  .app-container {
    position: relative;
    z-index: 1;
    max-width: 960px;
    margin: 0 auto;
    padding: 20px 20px 60px;
  }

  /* Header */
  .header {
    text-align: center;
    padding: 48px 20px 40px;
    position: relative;
  }
  .header-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    font-size: 12px;
    font-weight: 600;
    padding: 6px 14px;
    border-radius: 20px;
    margin-bottom: 16px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    box-shadow: 0 2px 10px rgba(99, 102, 241, 0.3);
  }
  .header-badge svg {
    width: 14px; height: 14px;
  }
  .header h1 {
    font-size: clamp(32px, 5vw, 48px);
    font-weight: 800;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary), #a855f7);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.15;
    margin-bottom: 12px;
  }
  .header p {
    font-size: 17px;
    color: var(--text-light);
    max-width: 500px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Stats bar */
  .stats-bar {
    display: flex;
    justify-content: center;
    gap: 32px;
    margin: 28px 0 8px;
    flex-wrap: wrap;
  }
  .stat-item {
    text-align: center;
  }
  .stat-value {
    font-size: 26px;
    font-weight: 700;
    color: var(--primary);
  }
  .stat-label {
    font-size: 12px;
    color: var(--text-lighter);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }

  /* Filter tabs */
  .filter-bar {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: 32px 0 28px;
    flex-wrap: wrap;
  }
  .filter-btn {
    padding: 8px 20px;
    border-radius: 24px;
    border: 2px solid var(--border);
    background: white;
    color: var(--text-light);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s ease;
    font-family: inherit;
  }
  .filter-btn:hover {
    border-color: var(--primary-light);
    color: var(--primary);
    transform: translateY(-1px);
  }
  .filter-btn.active {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border-color: transparent;
    color: white;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
  }

  /* Poll grid */
  .polls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 420px), 1fr));
    gap: 24px;
  }

  /* Poll card */
  .poll-card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 28px;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border);
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    opacity: 0;
    transform: translateY(20px);
    animation: cardIn 0.5s ease forwards;
  }
  .poll-card:hover {
    box-shadow: var(--shadow-xl);
    transform: translateY(-4px);
    border-color: var(--primary-light);
  }

  @keyframes cardIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .poll-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
    border-radius: var(--radius) var(--radius) 0 0;
  }

  .poll-category {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.6px;
    padding: 4px 10px;
    border-radius: 6px;
    margin-bottom: 14px;
  }
  .poll-category svg { width: 12px; height: 12px; }

  .poll-question {
    font-size: 19px;
    font-weight: 700;
    line-height: 1.35;
    margin-bottom: 6px;
    color: var(--text);
  }

  .poll-meta {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
    font-size: 13px;
    color: var(--text-lighter);
  }
  .poll-meta span {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .poll-meta svg { width: 14px; height: 14px; }

  /* Options */
  .poll-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 18px;
  }

  .poll-option {
    position: relative;
    border-radius: var(--radius-sm);
    overflow: hidden;
    cursor: pointer;
    border: 2px solid var(--border);
    transition: all 0.25s ease;
    background: #fafbff;
  }
  .poll-option:hover:not(.voted):not(.disabled) {
    border-color: var(--primary-light);
    background: #f0f0ff;
    transform: scale(1.01);
  }
  .poll-option.selected {
    border-color: var(--primary);
    background: #eef2ff;
  }
  .poll-option.disabled {
    cursor: default;
  }

  .option-bar {
    position: absolute;
    top: 0; left: 0; bottom: 0;
    border-radius: 8px;
    transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    width: 0;
    z-index: 0;
  }

  .option-content {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
  }

  .option-left {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
    font-size: 15px;
  }

  .option-radio {
    width: 20px; height: 20px;
    border-radius: 50%;
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.25s ease;
    flex-shrink: 0;
  }
  .option-radio::after {
    content: '';
    width: 10px; height: 10px;
    border-radius: 50%;
    background: var(--primary);
    transform: scale(0);
    transition: transform 0.25s ease;
  }
  .poll-option.selected .option-radio {
    border-color: var(--primary);
  }
  .poll-option.selected .option-radio::after {
    transform: scale(1);
  }

  .option-right {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: var(--text-light);
    font-weight: 600;
    opacity: 0;
    transition: opacity 0.4s ease;
  }
  .poll-card.voted .option-right {
    opacity: 1;
  }

  .option-percent {
    font-weight: 700;
    color: var(--text);
    min-width: 40px;
    text-align: right;
  }

  .option-votes-num {
    font-size: 12px;
    color: var(--text-lighter);
    font-weight: 500;
  }

  /* Check icon for selected after voting */
  .vote-check {
    width: 20px; height: 20px;
    border-radius: 50%;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    transform: scale(0);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .poll-card.voted .poll-option.selected .vote-check {
    transform: scale(1);
  }
  .poll-card.voted .poll-option.selected .option-radio {
    display: none;
  }
  .vote-check svg {
    width: 12px; height: 12px;
    color: white;
  }

  /* Vote button */
  .vote-btn {
    width: 100%;
    padding: 13px;
    border-radius: var(--radius-sm);
    border: none;
    font-size: 15px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .vote-btn.primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    box-shadow: 0 4px 14px rgba(99, 102, 241, 0.35);
  }
  .vote-btn.primary:hover:not(:disabled) {
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45);
    transform: translateY(-2px);
  }
  .vote-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
  }
  .vote-btn.voted-btn {
    background: #ecfdf5;
    color: var(--success);
    cursor: default;
    box-shadow: none;
  }
  .vote-btn svg { width: 16px; height: 16px; }

  /* Results mini bar */
  .total-votes-label {
    text-align: center;
    font-size: 12px;
    color: var(--text-lighter);
    margin-top: 10px;
    font-weight: 500;
  }

  /* Confetti canvas */
  #confetti-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 1000;
  }

  /* Category colors */
  .cat-tech { background: #eef2ff; color: #4f46e5; }
  .cat-tech-bar { background: rgba(99, 102, 241, 0.12); }
  .cat-food { background: #fef3c7; color: #d97706; }
  .cat-food-bar { background: rgba(245, 158, 11, 0.12); }
  .cat-lifestyle { background: #ecfdf5; color: #059669; }
  .cat-lifestyle-bar { background: rgba(16, 185, 129, 0.12); }
  .cat-entertainment { background: #fce7f3; color: #db2777; }
  .cat-entertainment-bar { background: rgba(219, 39, 119, 0.12); }
  .cat-travel { background: #e0f2fe; color: #0284c7; }
  .cat-travel-bar { background: rgba(2, 132, 199, 0.12); }
  .cat-sports { background: #fef2f2; color: #dc2626; }
  .cat-sports-bar { background: rgba(220, 38, 38, 0.12); }

  .poll-card[data-cat="tech"]::before { background: linear-gradient(90deg, #6366f1, #818cf8); }
  .poll-card[data-cat="food"]::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
  .poll-card[data-cat="lifestyle"]::before { background: linear-gradient(90deg, #10b981, #34d399); }
  .poll-card[data-cat="entertainment"]::before { background: linear-gradient(90deg, #ec4899, #f472b6); }
  .poll-card[data-cat="travel"]::before { background: linear-gradient(90deg, #0ea5e9, #38bdf8); }
  .poll-card[data-cat="sports"]::before { background: linear-gradient(90deg, #ef4444, #f87171); }

  /* Toast notification */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--text);
    color: white;
    padding: 14px 28px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 500;
    z-index: 999;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  .toast svg { width: 18px; height: 18px; color: var(--success); }

  /* Responsive */
  @media (max-width: 600px) {
    .app-container { padding: 12px 12px 40px; }
    .header { padding: 32px 12px 28px; }
    .poll-card { padding: 22px 18px; }
    .stats-bar { gap: 20px; }
    .polls-grid { gap: 16px; }
  }

  /* Animated number counter */
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
  }
  .pulse { animation: pulse 0.4s ease; }

  /* Shimmer loading effect */
  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }

  /* Create poll modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.5);
    backdrop-filter: blur(4px);
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    padding: 20px;
  }
  .modal-overlay.show {
    opacity: 1;
    pointer-events: all;
  }
  .modal {
    background: white;
    border-radius: var(--radius);
    padding: 32px;
    max-width: 500px;
    width: 100%;
    box-shadow: var(--shadow-xl);
    transform: translateY(20px) scale(0.97);
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .modal-overlay.show .modal {
    transform: translateY(0) scale(1);
  }
  .modal h2 {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 20px;
  }
  .modal-input {
    width: 100%;
    padding: 12px 14px;
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    font-size: 15px;
    font-family: inherit;
    margin-bottom: 12px;
    transition: border-color 0.2s ease;
    outline: none;
  }
  .modal-input:focus {
    border-color: var(--primary-light);
  }
  .modal-input::placeholder {
    color: var(--text-lighter);
  }
  .modal-actions {
    display: flex;
    gap: 10px;
    margin-top: 8px;
  }
  .modal-actions button {
    flex: 1;
    padding: 12px;
    border-radius: var(--radius-sm);
    border: 2px solid var(--border);
    font-size: 14px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.2s ease;
    background: white;
    color: var(--text);
  }
  .modal-actions .btn-create {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border-color: transparent;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
  }
  .modal-actions .btn-create:hover {
    box-shadow: 0 6px 18px rgba(99, 102, 241, 0.4);
  }

  /* Floating create button */
  .fab {
    position: fixed;
    bottom: 28px;
    right: 28px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    cursor: pointer;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }
  .fab:hover {
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
  }
  .fab svg { width: 24px; height: 24px; }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-lighter);
  }
  .empty-state svg {
    width: 64px; height: 64px;
    margin-bottom: 16px;
    opacity: 0.4;
  }
</style>
</head>
<body>

<!-- Background blobs -->
<div class="bg-blob"></div>
<div class="bg-blob"></div>
<div class="bg-blob"></div>
<div class="bg-blob"></div>

<!-- Confetti -->
<canvas id="confetti-canvas"></canvas>

<!-- Toast -->
<div class="toast" id="toast">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
  <span id="toast-msg">Vote recorded!</span>
</div>

<!-- Create Poll Modal -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h2>Create a New Poll</h2>
    <input class="modal-input" id="newQ" placeholder="Enter your question..." maxlength="120">
    <input class="modal-input" id="newO1" placeholder="Option 1" maxlength="60">
    <input class="modal-input" id="newO2" placeholder="Option 2" maxlength="60">
    <input class="modal-input" id="newO3" placeholder="Option 3 (optional)" maxlength="60">
    <input class="modal-input" id="newO4" placeholder="Option 4 (optional)" maxlength="60">
    <select class="modal-input" id="newCat">
      <option value="tech">üíª Technology</option>
      <option value="food">üçï Food & Drink</option>
      <option value="lifestyle">üåø Lifestyle</option>
      <option value="entertainment">üé¨ Entertainment</option>
      <option value="travel">‚úàÔ∏è Travel</option>
      <option value="sports">‚öΩ Sports</option>
    </select>
    <div class="modal-actions">
      <button onclick="closeModal()">Cancel</button>
      <button class="btn-create" onclick="createPoll()">Create Poll</button>
    </div>
  </div>
</div>

<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div class="header-badge">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
      Live Polls
    </div>
    <h1>Online Poll Board</h1>
    <p>Cast your vote, see results instantly, and discover what others think.</p>
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-value" id="stat-polls">0</div>
        <div class="stat-label">Active Polls</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="stat-votes">0</div>
        <div class="stat-label">Total Votes</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="stat-participants">0</div>
        <div class="stat-label">Participants</div>
      </div>
    </div>
  </header>

  <!-- Filters -->
  <div class="filter-bar" id="filters"></div>

  <!-- Polls Grid -->
  <div class="polls-grid" id="polls-grid"></div>
</div>

<!-- FAB -->
<button class="fab" onclick="openModal()" title="Create a new poll">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
</button>

<script>
const categoryConfig = {
  tech: { label: 'Technology', icon: 'üíª', cls: 'cat-tech', barCls: 'cat-tech-bar', color: '#6366f1' },
  food: { label: 'Food & Drink', icon: 'üçï', cls: 'cat-food', barCls: 'cat-food-bar', color: '#f59e0b' },
  lifestyle: { label: 'Lifestyle', icon: 'üåø', cls: 'cat-lifestyle', barCls: 'cat-lifestyle-bar', color: '#10b981' },
  entertainment: { label: 'Entertainment', icon: 'üé¨', cls: 'cat-entertainment', barCls: 'cat-entertainment-bar', color: '#ec4899' },
  travel: { label: 'Travel', icon: '‚úàÔ∏è', cls: 'cat-travel', barCls: 'cat-travel-bar', color: '#0ea5e9' },
  sports: { label: 'Sports', icon: '‚öΩ', cls: 'cat-sports', barCls: 'cat-sports-bar', color: '#ef4444' },
};

const barColors = {
  tech: ['rgba(99,102,241,0.15)', 'rgba(99,102,241,0.25)'],
  food: ['rgba(245,158,11,0.15)', 'rgba(245,158,11,0.25)'],
  lifestyle: ['rgba(16,185,129,0.15)', 'rgba(16,185,129,0.25)'],
  entertainment: ['rgba(236,72,153,0.15)', 'rgba(236,72,153,0.25)'],
  travel: ['rgba(14,165,233,0.15)', 'rgba(14,165,233,0.25)'],
  sports: ['rgba(239,68,68,0.15)', 'rgba(239,68,68,0.25)'],
};

let polls = [
  {
    id: 1, question: 'What is the best programming language to learn in 2025?',
    category: 'tech',
    options: [
      { text: 'Python', votes: 234 },
      { text: 'JavaScript', votes: 198 },
      { text: 'Rust', votes: 145 },
      { text: 'Go', votes: 89 },
    ],
    createdAgo: '2h ago',
  },
  {
    id: 2, question: 'What is your go-to comfort food?',
    category: 'food',
    options: [
      { text: 'Pizza', votes: 312 },
      { text: 'Mac & Cheese', votes: 178 },
      { text: 'Ramen', votes: 256 },
      { text: 'Tacos', votes: 201 },
    ],
    createdAgo: '5h ago',
  },
  {
    id: 3, question: 'Best way to stay productive while working remotely?',
    category: 'lifestyle',
    options: [
      { text: 'Pomodoro technique', votes: 167 },
      { text: 'Dedicated workspace', votes: 223 },
      { text: 'Regular exercise breaks', votes: 189 },
    ],
    createdAgo: '1d ago',
  },
  {
    id: 4, question: 'Which 2025 movie are you most excited for?',
    category: 'entertainment',
    options: [
      { text: 'Avatar 3', votes: 278 },
      { text: 'The Fantastic Four', votes: 315 },
      { text: 'Jurassic World: Rebirth', votes: 192 },
      { text: 'Tron: Ares', votes: 156 },
    ],
    createdAgo: '3h ago',
  },
  {
    id: 5, question: 'Dream travel destination for your next vacation?',
    category: 'travel',
    options: [
      { text: 'Japan', votes: 345 },
      { text: 'Iceland', votes: 198 },
      { text: 'New Zealand', votes: 224 },
      { text: 'Italy', votes: 267 },
    ],
    createdAgo: '8h ago',
  },
  {
    id: 6, question: 'What is the greatest sport to watch live?',
    category: 'sports',
    options: [
      { text: 'Football (Soccer)', votes: 298 },
      { text: 'Basketball', votes: 234 },
      { text: 'Tennis', votes: 112 },
      { text: 'Formula 1', votes: 189 },
    ],
    createdAgo: '12h ago',
  },
  {
    id: 7, question: 'Which AI tool has changed your workflow the most?',
    category: 'tech',
    options: [
      { text: 'ChatGPT / Claude', votes: 410 },
      { text: 'GitHub Copilot', votes: 287 },
      { text: 'Midjourney / DALL¬∑E', votes: 156 },
    ],
    createdAgo: '4h ago',
  },
  {
    id: 8, question: 'Best coffee order?',
    category: 'food',
    options: [
      { text: 'Espresso', votes: 142 },
      { text: 'Latte', votes: 265 },
      { text: 'Cold Brew', votes: 198 },
      { text: 'Cappuccino', votes: 176 },
    ],
    createdAgo: '6h ago',
  },
];

let votedPolls = {};
let selectedOptions = {};
let activeFilter = 'all';
let nextId = 100;

// --- Render ---
function getTotalVotes(poll) {
  return poll.options.reduce((s, o) => s + o.votes, 0);
}

function renderFilters() {
  const cats = [...new Set(polls.map(p => p.category))];
  const f = document.getElementById('filters');
  let html = `<button class="filter-btn ${activeFilter==='all'?'active':''}" onclick="setFilter('all')">All Polls</button>`;
  cats.forEach(c => {
    const cfg = categoryConfig[c];
    html += `<button class="filter-btn ${activeFilter===c?'active':''}" onclick="setFilter('${c}')">${cfg.icon} ${cfg.label}</button>`;
  });
  f.innerHTML = html;
}

function renderPolls() {
  const grid = document.getElementById('polls-grid');
  const filtered = activeFilter === 'all' ? polls : polls.filter(p => p.category === activeFilter);

  if (filtered.length === 0) {
    grid.innerHTML = `<div class="empty-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M8 15h8M9 9h.01M15 9h.01"/></svg>
      <p>No polls in this category yet.</p>
    </div>`;
    return;
  }

  grid.innerHTML = filtered.map((poll, i) => {
    const cfg = categoryConfig[poll.category];
    const voted = !!votedPolls[poll.id];
    const total = getTotalVotes(poll);
    const sel = selectedOptions[poll.id];

    return `<div class="poll-card ${voted?'voted':''}" data-cat="${poll.category}" data-id="${poll.id}" style="animation-delay:${i*0.06}s">
      <div class="poll-category ${cfg.cls}">
        <span>${cfg.icon}</span> ${cfg.label}
      </div>
      <div class="poll-question">${escHtml(poll.question)}</div>
      <div class="poll-meta">
        <span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          ${poll.createdAgo}
        </span>
        <span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          <span class="vote-count" data-poll="${poll.id}">${total.toLocaleString()}</span> votes
        </span>
      </div>
      <div class="poll-options">
        ${poll.options.map((opt, oi) => {
          const pct = total > 0 ? Math.round(opt.votes / total * 100) : 0;
          const isSelected = sel === oi || (voted && votedPolls[poll.id] === oi);
          const bcolor = barColors[poll.category];
          return `<div class="poll-option ${isSelected?'selected':''} ${voted?'disabled':''}"
                       onclick="selectOption(${poll.id}, ${oi})" data-poll="${poll.id}" data-opt="${oi}">
            <div class="option-bar" style="width:${voted ? pct+'%' : '0%'};background:${isSelected? bcolor[1] : bcolor[0]}"></div>
            <div class="option-content">
              <div class="option-left">
                <div class="vote-check">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                </div>
                <div class="option-radio"></div>
                ${escHtml(opt.text)}
              </div>
              <div class="option-right">
                <span class="option-percent">${pct}%</span>
                <span class="option-votes-num">(${opt.votes.toLocaleString()})</span>
              </div>
            </div>
          </div>`;
        }).join('')}
      </div>
      ${voted
        ? `<button class="vote-btn voted-btn" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            Voted ‚Äî Thanks!
          </button>`
        : `<button class="vote-btn primary" onclick="vote(${poll.id})" ${sel===undefined?'disabled':''} id="vote-btn-${poll.id}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3H14z"/><path d="M7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
            Cast Your Vote
          </button>`
      }
      <div class="total-votes-label">${total.toLocaleString()} total votes</div>
    </div>`;
  }).join('');

  updateStats();
}

function escHtml(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

function updateStats() {
  const totalVotes = polls.reduce((s, p) => s + getTotalVotes(p), 0);
  animateNumber('stat-polls', polls.length);
  animateNumber('stat-votes', totalVotes);
  animateNumber('stat-participants', Math.round(totalVotes * 0.72));
}

function animateNumber(id, target) {
  const el = document.getElementById(id);
  const current = parseInt(el.textContent.replace(/,/g, '')) || 0;
  if (current === target) return;
  const diff = target - current;
  const steps = 30;
  const inc = diff / steps;
  let step = 0;
  const interval = setInterval(() => {
    step++;
    const val = step === steps ? target : Math.round(current + inc * step);
    el.textContent = val.toLocaleString();
    if (step >= steps) clearInterval(interval);
  }, 20);
  el.classList.add('pulse');
  setTimeout(() => el.classList.remove('pulse'), 400);
}

function setFilter(cat) {
  activeFilter = cat;
  renderFilters();
  renderPolls();
}

function selectOption(pollId, optIdx) {
  if (votedPolls[pollId] !== undefined) return;
  selectedOptions[pollId] = optIdx;

  // Update UI without full re-render for snappy feel
  const card = document.querySelector(`.poll-card[data-id="${pollId}"]`);
  if (!card) return;
  card.querySelectorAll('.poll-option').forEach((el, i) => {
    el.classList.toggle('selected', i === optIdx);
  });
  const btn = document.getElementById(`vote-btn-${pollId}`);
  if (btn) btn.disabled = false;
}

function vote(pollId) {
  const optIdx = selectedOptions[pollId];
  if (optIdx === undefined || votedPolls[pollId] !== undefined) return;

  // Record vote
  const poll = polls.find(p => p.id === pollId);
  if (!poll) return;
  poll.options[optIdx].votes++;
  votedPolls[pollId] = optIdx;

  // Show results with animation
  const card = document.querySelector(`.poll-card[data-id="${pollId}"]`);
  if (card) {
    card.classList.add('voted');
    const total = getTotalVotes(poll);

    // Animate bars
    card.querySelectorAll('.poll-option').forEach((el, i) => {
      const pct = Math.round(poll.options[i].votes / total * 100);
      const bar = el.querySelector('.option-bar');
      const pctEl = el.querySelector('.option-percent');
      const numEl = el.querySelector('.option-votes-num');
      el.classList.add('disabled');

      setTimeout(() => {
        bar.style.width = pct + '%';
      }, 50 + i * 80);

      // Animate percentage count up
      animatePercentage(pctEl, pct);
      if (numEl) numEl.textContent = `(${poll.options[i].votes.toLocaleString()})`;
    });

    // Update button
    const btnArea = card.querySelector('.vote-btn');
    if (btnArea) {
      btnArea.outerHTML = `<button class="vote-btn voted-btn" disabled>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        Voted ‚Äî Thanks!
      </button>`;
    }

    // Update total label
    const totalLabel = card.querySelector('.total-votes-label');
    if (totalLabel) totalLabel.textContent = total.toLocaleString() + ' total votes';

    // Update vote count in meta
    const vcEl = card.querySelector(`.vote-count[data-poll="${pollId}"]`);
    if (vcEl) vcEl.textContent = total.toLocaleString();
  }

  updateStats();
  showToast('Vote recorded! Thanks for participating.');
  launchConfetti();
}

function animatePercentage(el, target) {
  let current = 0;
  const steps = 25;
  const inc = target / steps;
  let step = 0;
  const interval = setInterval(() => {
    step++;
    current = step === steps ? target : Math.round(inc * step);
    el.textContent = current + '%';
    if (step >= steps) clearInterval(interval);
  }, 25);
}

// --- Toast ---
function showToast(msg) {
  const t = document.getElementById('toast');
  document.getElementById('toast-msg').textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}

// --- Confetti ---
function launchConfetti() {
  const canvas = document.getElementById('confetti-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const pieces = [];
  const colors = ['#6366f1','#f59e0b','#10b981','#ec4899','#0ea5e9','#ef4444','#a855f7','#fbbf24'];

  for (let i = 0; i < 80; i++) {
    pieces.push({
      x: Math.random() * canvas.width,
      y: -20 - Math.random() * 100,
      w: 6 + Math.random() * 6,
      h: 4 + Math.random() * 4,
      color: colors[Math.floor(Math.random() * colors.length)],
      vx: (Math.random() - 0.5) * 6,
      vy: 2 + Math.random() * 4,
      rotation: Math.random() * 360,
      rotSpeed: (Math.random() - 0.5) * 12,
      opacity: 1,
    });
  }

  let frame = 0;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    let alive = false;
    pieces.forEach(p => {
      if (p.opacity <= 0) return;
      alive = true;
      p.x += p.vx;
      p.vy += 0.08;
      p.y += p.vy;
      p.rotation += p.rotSpeed;
      if (frame > 40) p.opacity -= 0.015;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rotation * Math.PI / 180);
      ctx.globalAlpha = Math.max(0, p.opacity);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
      ctx.restore();
    });
    frame++;
    if (alive) requestAnimationFrame(animate);
    else ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  animate();
}

// --- Modal ---
function openModal() {
  document.getElementById('modal').classList.add('show');
  setTimeout(() => document.getElementById('newQ').focus(), 100);
}
function closeModal() {
  document.getElementById('modal').classList.remove('show');
  ['newQ','newO1','newO2','newO3','newO4'].forEach(id => document.getElementById(id).value = '');
}

function createPoll() {
  const q = document.getElementById('newQ').value.trim();
  const o1 = document.getElementById('newO1').value.trim();
  const o2 = document.getElementById('newO2').value.trim();
  const o3 = document.getElementById('newO3').value.trim();
  const o4 = document.getElementById('newO4').value.trim();
  const cat = document.getElementById('newCat').value;

  if (!q || !o1 || !o2) {
    showToast('Please enter a question and at least 2 options.');
    return;
  }

  const options = [{ text: o1, votes: 0 }, { text: o2, votes: 0 }];
  if (o3) options.push({ text: o3, votes: 0 });
  if (o4) options.push({ text: o4, votes: 0 });

  polls.unshift({
    id: nextId++,
    question: q,
    category: cat,
    options,
    createdAgo: 'Just now',
  });

  closeModal();
  renderFilters();
  renderPolls();
  showToast('New poll created!');

  // Scroll to top to see new poll
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// --- Simulate live votes ---
function simulateLiveVotes() {
  setInterval(() => {
    const unvotedPolls = polls.filter(p => !votedPolls[p.id]);
    if (unvotedPolls.length === 0) return;
    const poll = unvotedPolls[Math.floor(Math.random() * unvotedPolls.length)];
    const optIdx = Math.floor(Math.random() * poll.options.length);
    poll.options[optIdx].votes += Math.floor(Math.random() * 3) + 1;

    // Update the vote count in the UI without full re-render
    const card = document.querySelector(`.poll-card[data-id="${poll.id}"]`);
    if (card) {
      const total = getTotalVotes(poll);
      const vcEl = card.querySelector(`.vote-count[data-poll="${poll.id}"]`);
      if (vcEl) vcEl.textContent = total.toLocaleString();
      const totalLabel = card.querySelector('.total-votes-label');
      if (totalLabel) totalLabel.textContent = total.toLocaleString() + ' total votes';
    }

    updateStats();
  }, 3000);
}

// --- Keyboard ---
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeModal();
});

// --- Init ---
renderFilters();
renderPolls();
simulateLiveVotes();

// Resize confetti canvas on window resize
window.addEventListener('resize', () => {
  const c = document.getElementById('confetti-canvas');
  c.width = window.innerWidth;
  c.height = window.innerHeight;
});
</script>
</body>
</html>
