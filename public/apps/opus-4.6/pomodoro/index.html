<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pomodoro</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600;700&display=swap');

  :root {
    --bg-primary: #faf7f5;
    --bg-secondary: #ffffff;
    --bg-tertiary: #f0ebe6;
    --text-primary: #1a1a2e;
    --text-secondary: #555566;
    --text-muted: #999aaa;
    --accent: #e74c3c;
    --accent-glow: rgba(231, 76, 60, 0.3);
    --accent-soft: rgba(231, 76, 60, 0.1);
    --short-break: #27ae60;
    --short-break-glow: rgba(39, 174, 96, 0.3);
    --short-break-soft: rgba(39, 174, 96, 0.1);
    --long-break: #2980b9;
    --long-break-glow: rgba(41, 128, 185, 0.3);
    --long-break-soft: rgba(41, 128, 185, 0.1);
    --border: rgba(0,0,0,0.08);
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
    --shadow-glow: 0 0 40px var(--accent-glow);
    --radius: 16px;
    --radius-sm: 10px;
    --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .dark {
    --bg-primary: #0f0f1a;
    --bg-secondary: #1a1a2e;
    --bg-tertiary: #16213e;
    --text-primary: #e8e8f0;
    --text-secondary: #a0a0b8;
    --text-muted: #666680;
    --border: rgba(255,255,255,0.08);
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.4);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    transition: background var(--transition), color var(--transition);
    overflow-x: hidden;
  }

  /* Animated background */
  .bg-animation {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
  }
  .bg-orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.15;
    animation: float 20s ease-in-out infinite;
  }
  .dark .bg-orb { opacity: 0.08; }
  .bg-orb:nth-child(1) {
    width: 400px; height: 400px;
    background: var(--accent);
    top: -100px; left: -100px;
    animation-delay: 0s;
  }
  .bg-orb:nth-child(2) {
    width: 350px; height: 350px;
    background: var(--short-break);
    bottom: -100px; right: -100px;
    animation-delay: -7s;
    animation-duration: 25s;
  }
  .bg-orb:nth-child(3) {
    width: 300px; height: 300px;
    background: var(--long-break);
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    animation-delay: -14s;
    animation-duration: 30s;
  }
  @keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(40px, -30px) scale(1.05); }
    50% { transform: translate(-20px, 40px) scale(0.95); }
    75% { transform: translate(30px, 20px) scale(1.02); }
  }

  .app-container {
    position: relative;
    z-index: 1;
    max-width: 520px;
    margin: 0 auto;
    padding: 20px 16px 40px;
    min-height: 100vh;
  }

  /* Header */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0 24px;
  }
  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .logo-icon {
    width: 36px;
    height: 36px;
    background: var(--accent);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    box-shadow: 0 2px 8px var(--accent-glow);
  }
  .logo-text {
    font-weight: 800;
    font-size: 22px;
    letter-spacing: -0.5px;
  }
  .header-actions {
    display: flex;
    gap: 6px;
    align-items: center;
  }
  .icon-btn {
    width: 40px;
    height: 40px;
    border: none;
    border-radius: var(--radius-sm);
    background: var(--bg-secondary);
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition);
    border: 1px solid var(--border);
    font-size: 18px;
  }
  .icon-btn:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
  }

  /* Mode Tabs */
  .mode-tabs {
    display: flex;
    gap: 6px;
    background: var(--bg-secondary);
    padding: 5px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    margin-bottom: 28px;
    box-shadow: var(--shadow-sm);
  }
  .mode-tab {
    flex: 1;
    padding: 10px 8px;
    border: none;
    border-radius: 12px;
    background: transparent;
    color: var(--text-secondary);
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    transition: all var(--transition);
    font-family: inherit;
    white-space: nowrap;
  }
  .mode-tab:hover { color: var(--text-primary); background: var(--bg-tertiary); }
  .mode-tab.active[data-mode="focus"] {
    background: var(--accent);
    color: white;
    box-shadow: 0 2px 12px var(--accent-glow);
  }
  .mode-tab.active[data-mode="short"] {
    background: var(--short-break);
    color: white;
    box-shadow: 0 2px 12px var(--short-break-glow);
  }
  .mode-tab.active[data-mode="long"] {
    background: var(--long-break);
    color: white;
    box-shadow: 0 2px 12px var(--long-break-glow);
  }

  /* Timer Display */
  .timer-section {
    text-align: center;
    margin-bottom: 28px;
  }
  .timer-ring-container {
    position: relative;
    width: 280px;
    height: 280px;
    margin: 0 auto 24px;
  }
  .timer-ring-svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
  }
  .timer-ring-bg {
    fill: none;
    stroke: var(--bg-tertiary);
    stroke-width: 6;
  }
  .dark .timer-ring-bg {
    stroke: rgba(255,255,255,0.06);
  }
  .timer-ring-progress {
    fill: none;
    stroke: var(--accent);
    stroke-width: 6;
    stroke-linecap: round;
    transition: stroke-dashoffset 0.5s linear, stroke var(--transition);
    filter: drop-shadow(0 0 8px var(--accent-glow));
  }
  .timer-ring-progress.short-break {
    stroke: var(--short-break);
    filter: drop-shadow(0 0 8px var(--short-break-glow));
  }
  .timer-ring-progress.long-break {
    stroke: var(--long-break);
    filter: drop-shadow(0 0 8px var(--long-break-glow));
  }
  .timer-display {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  .timer-time {
    font-family: 'JetBrains Mono', monospace;
    font-size: 64px;
    font-weight: 700;
    letter-spacing: -2px;
    line-height: 1;
    margin-bottom: 4px;
  }
  .timer-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 2px;
  }

  /* Timer Controls */
  .timer-controls {
    display: flex;
    gap: 12px;
    justify-content: center;
    align-items: center;
  }
  .btn-primary {
    padding: 14px 48px;
    border: none;
    border-radius: 14px;
    font-size: 16px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    transition: all var(--transition);
    text-transform: uppercase;
    letter-spacing: 1.5px;
  }
  .btn-primary.focus-mode {
    background: var(--accent);
    color: white;
    box-shadow: 0 4px 20px var(--accent-glow);
  }
  .btn-primary.focus-mode:hover {
    box-shadow: 0 6px 28px var(--accent-glow);
    transform: translateY(-2px);
  }
  .btn-primary.short-mode {
    background: var(--short-break);
    color: white;
    box-shadow: 0 4px 20px var(--short-break-glow);
  }
  .btn-primary.short-mode:hover {
    box-shadow: 0 6px 28px var(--short-break-glow);
    transform: translateY(-2px);
  }
  .btn-primary.long-mode {
    background: var(--long-break);
    color: white;
    box-shadow: 0 4px 20px var(--long-break-glow);
  }
  .btn-primary.long-mode:hover {
    box-shadow: 0 6px 28px var(--long-break-glow);
    transform: translateY(-2px);
  }
  .btn-secondary {
    width: 48px;
    height: 48px;
    border: none;
    border-radius: 14px;
    background: var(--bg-secondary);
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition);
    border: 1px solid var(--border);
    font-size: 18px;
  }
  .btn-secondary:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    transform: translateY(-1px);
  }

  /* Session Counter */
  .session-counter {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
    margin-bottom: 8px;
  }
  .session-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--bg-tertiary);
    border: 2px solid var(--border);
    transition: all var(--transition);
  }
  .dark .session-dot {
    background: rgba(255,255,255,0.06);
  }
  .session-dot.filled {
    background: var(--accent);
    border-color: var(--accent);
    box-shadow: 0 0 8px var(--accent-glow);
  }
  .session-hint {
    text-align: center;
    font-size: 12px;
    color: var(--text-muted);
    font-weight: 500;
  }

  /* Cards */
  .card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 16px;
    box-shadow: var(--shadow-sm);
    transition: all var(--transition);
  }
  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }
  .card-title {
    font-weight: 700;
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .card-title-icon {
    font-size: 16px;
  }

  /* Stats */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 16px;
  }
  .stat-item {
    text-align: center;
    padding: 14px 8px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-sm);
    transition: all var(--transition);
  }
  .dark .stat-item { background: rgba(255,255,255,0.04); }
  .stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 24px;
    font-weight: 700;
    color: var(--accent);
  }
  .stat-label {
    font-size: 11px;
    color: var(--text-muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }

  /* Chart */
  .chart-container {
    width: 100%;
    padding: 8px 0;
  }
  .chart-container svg {
    width: 100%;
    display: block;
  }
  .chart-bar {
    transition: all var(--transition);
    cursor: pointer;
    rx: 4;
    ry: 4;
  }
  .chart-bar:hover {
    filter: brightness(1.15);
  }
  .chart-label {
    font-family: 'Inter', sans-serif;
    font-size: 10px;
    fill: var(--text-muted);
    font-weight: 600;
  }
  .chart-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    fill: var(--text-secondary);
    font-weight: 600;
  }
  .chart-empty {
    font-family: 'Inter', sans-serif;
    font-size: 13px;
    fill: var(--text-muted);
    font-weight: 500;
  }

  /* Session Log */
  .session-log {
    max-height: 260px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .session-log::-webkit-scrollbar { width: 4px; }
  .session-log::-webkit-scrollbar-track { background: transparent; }
  .session-log::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .session-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    transition: background var(--transition);
    border-bottom: 1px solid var(--border);
  }
  .session-item:last-child { border-bottom: none; }
  .session-item:hover { background: var(--bg-tertiary); }
  .dark .session-item:hover { background: rgba(255,255,255,0.03); }
  .session-type-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .session-type-dot.focus { background: var(--accent); box-shadow: 0 0 6px var(--accent-glow); }
  .session-type-dot.short { background: var(--short-break); box-shadow: 0 0 6px var(--short-break-glow); }
  .session-type-dot.long { background: var(--long-break); box-shadow: 0 0 6px var(--long-break-glow); }
  .session-info { flex: 1; }
  .session-type-name {
    font-weight: 600;
    font-size: 13px;
  }
  .session-meta {
    font-size: 11px;
    color: var(--text-muted);
    font-weight: 500;
  }
  .session-duration {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
  }
  .empty-state {
    text-align: center;
    padding: 32px 16px;
    color: var(--text-muted);
  }
  .empty-state-icon { font-size: 32px; margin-bottom: 8px; }
  .empty-state-text { font-size: 13px; font-weight: 500; }

  /* Settings Panel */
  .settings-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.4);
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition);
    backdrop-filter: blur(4px);
  }
  .settings-overlay.open { opacity: 1; visibility: visible; }
  .settings-panel {
    position: fixed;
    top: 0;
    right: -400px;
    width: min(380px, 90vw);
    height: 100vh;
    background: var(--bg-secondary);
    z-index: 101;
    transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    box-shadow: -8px 0 40px rgba(0,0,0,0.15);
  }
  .settings-panel.open { right: 0; }
  .settings-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    background: var(--bg-secondary);
    z-index: 1;
  }
  .settings-title {
    font-weight: 700;
    font-size: 18px;
  }
  .settings-body { padding: 20px 24px; }
  .setting-group {
    margin-bottom: 24px;
  }
  .setting-group-title {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    margin-bottom: 12px;
  }
  .setting-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
  }
  .setting-row:last-child { border-bottom: none; }
  .setting-label {
    font-weight: 600;
    font-size: 14px;
  }
  .setting-desc {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
  }
  .setting-input {
    width: 72px;
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    transition: all var(--transition);
    outline: none;
  }
  .dark .setting-input { background: rgba(255,255,255,0.06); }
  .setting-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-soft);
  }

  /* Toggle */
  .toggle {
    position: relative;
    width: 48px;
    height: 26px;
    background: var(--bg-tertiary);
    border-radius: 13px;
    cursor: pointer;
    transition: background var(--transition);
    border: 1px solid var(--border);
    flex-shrink: 0;
  }
  .dark .toggle { background: rgba(255,255,255,0.08); }
  .toggle.active {
    background: var(--accent);
    border-color: var(--accent);
  }
  .toggle-knob {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    transition: transform var(--transition);
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  }
  .toggle.active .toggle-knob {
    transform: translateX(22px);
  }

  /* Clear btn */
  .btn-clear {
    padding: 10px 20px;
    border: 1px solid #e74c3c;
    border-radius: 10px;
    background: transparent;
    color: #e74c3c;
    font-weight: 600;
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
    transition: all var(--transition);
    width: 100%;
  }
  .btn-clear:hover { background: #e74c3c; color: white; }

  /* Motivational text */
  .motivation {
    text-align: center;
    margin-top: 12px;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-muted);
    font-style: italic;
    min-height: 20px;
  }

  /* Pulse animation when running */
  @keyframes pulse-ring {
    0% { box-shadow: 0 0 0 0 var(--accent-glow); }
    50% { box-shadow: 0 0 0 12px transparent; }
    100% { box-shadow: 0 0 0 0 transparent; }
  }
  .timer-ring-container.running {
    animation: pulse-ring 2.5s ease-in-out infinite;
  }

  /* Completion animation */
  @keyframes celebrate {
    0% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.05); }
    100% { transform: translate(-50%, -50%) scale(1); }
  }
  .timer-display.celebrate {
    animation: celebrate 0.5s ease-in-out;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .timer-ring-container { width: 240px; height: 240px; }
    .timer-time { font-size: 52px; }
    .stats-grid { grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .stat-value { font-size: 20px; }
    .btn-primary { padding: 12px 36px; font-size: 14px; }
  }
</style>
</head>
<body>
<div class="bg-animation">
  <div class="bg-orb"></div>
  <div class="bg-orb"></div>
  <div class="bg-orb"></div>
</div>

<div class="app-container" id="app">
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <div class="logo-icon">üçÖ</div>
      <span class="logo-text">Pomodoro</span>
    </div>
    <div class="header-actions">
      <button class="icon-btn" id="darkModeBtn" title="Toggle dark mode">
        <span id="darkModeIcon">üåô</span>
      </button>
      <button class="icon-btn" id="settingsBtn" title="Settings">
        ‚öôÔ∏è
      </button>
    </div>
  </div>

  <!-- Mode Tabs -->
  <div class="mode-tabs">
    <button class="mode-tab active" data-mode="focus" id="tabFocus">üéØ Focus</button>
    <button class="mode-tab" data-mode="short" id="tabShort">‚òï Short Break</button>
    <button class="mode-tab" data-mode="long" id="tabLong">üåø Long Break</button>
  </div>

  <!-- Timer -->
  <div class="timer-section">
    <div class="timer-ring-container" id="timerRingContainer">
      <svg class="timer-ring-svg" viewBox="0 0 280 280">
        <circle class="timer-ring-bg" cx="140" cy="140" r="124"/>
        <circle class="timer-ring-progress" id="timerRingProgress" cx="140" cy="140" r="124"
          stroke-dasharray="779.2" stroke-dashoffset="0"/>
      </svg>
      <div class="timer-display" id="timerDisplay">
        <div class="timer-time" id="timerTime">25:00</div>
        <div class="timer-label" id="timerLabel">Focus Time</div>
      </div>
    </div>

    <div class="timer-controls">
      <button class="btn-secondary" id="resetBtn" title="Reset">‚Ü∫</button>
      <button class="btn-primary focus-mode" id="startBtn">Start</button>
      <button class="btn-secondary" id="skipBtn" title="Skip">‚è≠</button>
    </div>

    <div class="session-counter" id="sessionCounter"></div>
    <div class="session-hint" id="sessionHint">Complete 4 focus sessions for a long break</div>
    <div class="motivation" id="motivation"></div>
  </div>

  <!-- Today's Stats -->
  <div class="card">
    <div class="card-header">
      <div class="card-title"><span class="card-title-icon">üìä</span> Today's Stats</div>
    </div>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value" id="statSessions">0</div>
        <div class="stat-label">Sessions</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="statMinutes">0</div>
        <div class="stat-label">Minutes</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="statStreak">0</div>
        <div class="stat-label">Streak</div>
      </div>
    </div>
  </div>

  <!-- Weekly Chart -->
  <div class="card">
    <div class="card-header">
      <div class="card-title"><span class="card-title-icon">üìà</span> This Week</div>
    </div>
    <div class="chart-container" id="weeklyChart"></div>
  </div>

  <!-- Session Log -->
  <div class="card">
    <div class="card-header">
      <div class="card-title"><span class="card-title-icon">üìã</span> Session Log</div>
      <button class="icon-btn" id="clearLogBtn" title="Clear log" style="width:32px;height:32px;font-size:14px;">üóëÔ∏è</button>
    </div>
    <div class="session-log" id="sessionLog"></div>
  </div>
</div>

<!-- Settings Panel -->
<div class="settings-overlay" id="settingsOverlay"></div>
<div class="settings-panel" id="settingsPanel">
  <div class="settings-header">
    <span class="settings-title">‚öôÔ∏è Settings</span>
    <button class="icon-btn" id="closeSettingsBtn" style="width:36px;height:36px;">‚úï</button>
  </div>
  <div class="settings-body">
    <div class="setting-group">
      <div class="setting-group-title">Timer Durations (minutes)</div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Focus</div>
          <div class="setting-desc">Concentration period</div>
        </div>
        <input type="number" class="setting-input" id="settingFocus" min="1" max="120" value="25">
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Short Break</div>
          <div class="setting-desc">Quick rest</div>
        </div>
        <input type="number" class="setting-input" id="settingShort" min="1" max="30" value="5">
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Long Break</div>
          <div class="setting-desc">Extended rest</div>
        </div>
        <input type="number" class="setting-input" id="settingLong" min="1" max="60" value="15">
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Sessions until Long Break</div>
          <div class="setting-desc">Focus rounds per cycle</div>
        </div>
        <input type="number" class="setting-input" id="settingCycle" min="2" max="10" value="4">
      </div>
    </div>
    <div class="setting-group">
      <div class="setting-group-title">Behavior</div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Auto-start Breaks</div>
          <div class="setting-desc">Start break timer automatically</div>
        </div>
        <div class="toggle" id="toggleAutoBreak"><div class="toggle-knob"></div></div>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Auto-start Focus</div>
          <div class="setting-desc">Start next focus automatically</div>
        </div>
        <div class="toggle" id="toggleAutoFocus"><div class="toggle-knob"></div></div>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Sound Alert</div>
          <div class="setting-desc">Beep when timer ends</div>
        </div>
        <div class="toggle active" id="toggleSound"><div class="toggle-knob"></div></div>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Browser Notifications</div>
          <div class="setting-desc">Show desktop notifications</div>
        </div>
        <div class="toggle" id="toggleNotif"><div class="toggle-knob"></div></div>
      </div>
    </div>
    <div class="setting-group">
      <div class="setting-group-title">Data</div>
      <button class="btn-clear" id="clearAllBtn">Clear All Session Data</button>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';

  // ---- Audio Context for Beep ----
  let audioCtx = null;
  function getAudioCtx() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    return audioCtx;
  }
  function playBeep() {
    if (!state.settings.sound) return;
    try {
      const ctx = getAudioCtx();
      const now = ctx.currentTime;
      // Play a pleasant three-tone chime
      const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
      notes.forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.type = 'sine';
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0, now + i * 0.18);
        gain.gain.linearRampToValueAtTime(0.25, now + i * 0.18 + 0.04);
        gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.18 + 0.5);
        osc.start(now + i * 0.18);
        osc.stop(now + i * 0.18 + 0.5);
      });
      // Second chime (repeat higher)
      setTimeout(() => {
        const ctx2 = getAudioCtx();
        const now2 = ctx2.currentTime;
        [659.25, 783.99, 1046.5].forEach((freq, i) => {
          const osc = ctx2.createOscillator();
          const gain = ctx2.createGain();
          osc.connect(gain);
          gain.connect(ctx2.destination);
          osc.type = 'sine';
          osc.frequency.value = freq;
          gain.gain.setValueAtTime(0, now2 + i * 0.15);
          gain.gain.linearRampToValueAtTime(0.2, now2 + i * 0.15 + 0.04);
          gain.gain.exponentialRampToValueAtTime(0.001, now2 + i * 0.15 + 0.6);
          osc.start(now2 + i * 0.15);
          osc.stop(now2 + i * 0.15 + 0.6);
        });
      }, 600);
    } catch(e) { /* silent fail */ }
  }

  // ---- State ----
  const STORAGE_KEY = 'pomodoro_app_data';
  const defaultSettings = {
    focusDuration: 25,
    shortBreakDuration: 5,
    longBreakDuration: 15,
    sessionsPerCycle: 4,
    autoStartBreak: false,
    autoStartFocus: false,
    sound: true,
    notifications: false,
    darkMode: false
  };

  let state = {
    settings: { ...defaultSettings },
    currentMode: 'focus', // focus, short, long
    timeRemaining: 25 * 60,
    totalTime: 25 * 60,
    isRunning: false,
    sessionCount: 0, // focus sessions completed in current cycle
    sessions: [] // { type, duration, timestamp, date }
  };

  let timerInterval = null;

  // ---- Persistence ----
  function saveState() {
    const data = {
      settings: state.settings,
      sessionCount: state.sessionCount,
      sessions: state.sessions
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const data = JSON.parse(raw);
        if (data.settings) state.settings = { ...defaultSettings, ...data.settings };
        if (typeof data.sessionCount === 'number') state.sessionCount = data.sessionCount;
        if (Array.isArray(data.sessions)) state.sessions = data.sessions;
      }
    } catch(e) { /* use defaults */ }
    state.currentMode = 'focus';
    state.totalTime = state.settings.focusDuration * 60;
    state.timeRemaining = state.totalTime;
    state.isRunning = false;
  }

  // ---- DOM refs ----
  const $ = id => document.getElementById(id);
  const timerTime = $('timerTime');
  const timerLabel = $('timerLabel');
  const timerRingProgress = $('timerRingProgress');
  const timerRingContainer = $('timerRingContainer');
  const timerDisplay = $('timerDisplay');
  const startBtn = $('startBtn');
  const resetBtn = $('resetBtn');
  const skipBtn = $('skipBtn');
  const sessionCounter = $('sessionCounter');
  const sessionHint = $('sessionHint');
  const motivation = $('motivation');
  const statSessions = $('statSessions');
  const statMinutes = $('statMinutes');
  const statStreak = $('statStreak');
  const weeklyChart = $('weeklyChart');
  const sessionLog = $('sessionLog');
  const darkModeBtn = $('darkModeBtn');
  const darkModeIcon = $('darkModeIcon');
  const settingsBtn = $('settingsBtn');
  const settingsPanel = $('settingsPanel');
  const settingsOverlay = $('settingsOverlay');
  const closeSettingsBtn = $('closeSettingsBtn');

  const tabFocus = $('tabFocus');
  const tabShort = $('tabShort');
  const tabLong = $('tabLong');
  const tabs = [tabFocus, tabShort, tabLong];

  // Settings inputs
  const settingFocus = $('settingFocus');
  const settingShort = $('settingShort');
  const settingLong = $('settingLong');
  const settingCycle = $('settingCycle');
  const toggleAutoBreak = $('toggleAutoBreak');
  const toggleAutoFocus = $('toggleAutoFocus');
  const toggleSound = $('toggleSound');
  const toggleNotif = $('toggleNotif');
  const clearAllBtn = $('clearAllBtn');
  const clearLogBtn = $('clearLogBtn');

  // ---- Motivational Quotes ----
  const focusQuotes = [
    "Deep work leads to a deep life.",
    "Focus is the new superpower.",
    "One task at a time. You've got this!",
    "Small steps, big results.",
    "Stay present, stay powerful.",
    "Your future self will thank you.",
    "Discipline is choosing between what you want now and what you want most.",
    "The secret of getting ahead is getting started.",
    "Lock in. Level up.",
    "Consistency beats intensity."
  ];
  const breakQuotes = [
    "You earned this rest!",
    "Stretch, breathe, recharge.",
    "Great work! Take it easy.",
    "Rest is productive too.",
    "Recharge your batteries!",
    "Step away, come back stronger.",
    "Your brain needs this break.",
    "Relax and let ideas marinate."
  ];

  function getRandomQuote(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // ---- Ring ----
  const RING_CIRCUMFERENCE = 2 * Math.PI * 124; // ~779.2

  function updateRing() {
    const progress = state.totalTime > 0 ? state.timeRemaining / state.totalTime : 0;
    const offset = RING_CIRCUMFERENCE * (1 - progress);
    timerRingProgress.setAttribute('stroke-dashoffset', offset);

    timerRingProgress.classList.remove('short-break', 'long-break');
    if (state.currentMode === 'short') timerRingProgress.classList.add('short-break');
    else if (state.currentMode === 'long') timerRingProgress.classList.add('long-break');
  }

  // ---- Format Time ----
  function formatTime(seconds) {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
  }

  // ---- Labels ----
  const modeLabels = { focus: 'Focus Time', short: 'Short Break', long: 'Long Break' };
  const modeColors = { focus: 'focus-mode', short: 'short-mode', long: 'long-mode' };

  // ---- Update Display ----
  function updateDisplay() {
    timerTime.textContent = formatTime(state.timeRemaining);
    timerLabel.textContent = modeLabels[state.currentMode];
    updateRing();

    startBtn.textContent = state.isRunning ? 'Pause' : 'Start';
    startBtn.className = 'btn-primary ' + modeColors[state.currentMode];

    timerRingContainer.classList.toggle('running', state.isRunning);

    // Update document title
    document.title = state.isRunning
      ? `${formatTime(state.timeRemaining)} - ${modeLabels[state.currentMode]}`
      : 'Pomodoro';

    // Tabs
    tabs.forEach(t => t.classList.remove('active'));
    if (state.currentMode === 'focus') tabFocus.classList.add('active');
    else if (state.currentMode === 'short') tabShort.classList.add('active');
    else tabLong.classList.add('active');

    // Session counter dots
    renderSessionDots();
    updateStats();
  }

  function renderSessionDots() {
    const cycle = state.settings.sessionsPerCycle;
    let html = '';
    for (let i = 0; i < cycle; i++) {
      html += `<div class="session-dot${i < state.sessionCount ? ' filled' : ''}"></div>`;
    }
    sessionCounter.innerHTML = html;
    const remaining = cycle - state.sessionCount;
    if (remaining > 0 && state.currentMode === 'focus') {
      sessionHint.textContent = remaining === 1
        ? '1 more focus session until long break!'
        : `${remaining} focus sessions until long break`;
    } else if (state.currentMode === 'short') {
      sessionHint.textContent = 'Enjoy your short break';
    } else if (state.currentMode === 'long') {
      sessionHint.textContent = 'Enjoy your long break ‚Äî you earned it!';
    } else {
      sessionHint.textContent = 'Cycle complete! Starting fresh';
    }
  }

  // ---- Timer Logic ----
  function startTimer() {
    if (state.isRunning) return;
    // Ensure AudioContext is unlocked by user gesture
    try { getAudioCtx().resume(); } catch(e) {}
    state.isRunning = true;
    motivation.textContent = state.currentMode === 'focus'
      ? getRandomQuote(focusQuotes) : getRandomQuote(breakQuotes);
    timerInterval = setInterval(tick, 1000);
    updateDisplay();
  }

  function pauseTimer() {
    state.isRunning = false;
    clearInterval(timerInterval);
    timerInterval = null;
    updateDisplay();
  }

  function resetTimer() {
    pauseTimer();
    state.timeRemaining = getDuration(state.currentMode) * 60;
    state.totalTime = state.timeRemaining;
    motivation.textContent = '';
    updateDisplay();
  }

  function tick() {
    if (state.timeRemaining > 0) {
      state.timeRemaining--;
      updateDisplay();
    } else {
      completeSession();
    }
  }

  function getDuration(mode) {
    if (mode === 'focus') return state.settings.focusDuration;
    if (mode === 'short') return state.settings.shortBreakDuration;
    return state.settings.longBreakDuration;
  }

  function completeSession() {
    pauseTimer();
    playBeep();
    timerDisplay.classList.add('celebrate');
    setTimeout(() => timerDisplay.classList.remove('celebrate'), 600);

    // Log session
    const now = new Date();
    state.sessions.unshift({
      type: state.currentMode,
      duration: getDuration(state.currentMode),
      timestamp: now.toISOString(),
      date: now.toISOString().slice(0, 10)
    });

    // Send notification
    if (state.settings.notifications && Notification.permission === 'granted') {
      const msg = state.currentMode === 'focus'
        ? 'Focus session complete! Time for a break.'
        : 'Break is over! Ready to focus?';
      new Notification('Pomodoro', { body: msg, icon: 'üçÖ' });
    }

    // Auto-advance
    if (state.currentMode === 'focus') {
      state.sessionCount++;
      if (state.sessionCount >= state.settings.sessionsPerCycle) {
        state.sessionCount = 0;
        switchMode('long');
      } else {
        switchMode('short');
      }
      if (state.settings.autoStartBreak) {
        setTimeout(startTimer, 500);
      }
    } else {
      switchMode('focus');
      if (state.settings.autoStartFocus) {
        setTimeout(startTimer, 500);
      }
    }

    saveState();
    updateDisplay();
    renderSessionLog();
    renderChart();
  }

  function switchMode(mode) {
    pauseTimer();
    state.currentMode = mode;
    state.totalTime = getDuration(mode) * 60;
    state.timeRemaining = state.totalTime;
    motivation.textContent = '';
    updateDisplay();
  }

  function skipSession() {
    if (state.isRunning || state.timeRemaining < state.totalTime) {
      completeSession();
    }
  }

  // ---- Stats ----
  function getTodaySessions() {
    const today = new Date().toISOString().slice(0, 10);
    return state.sessions.filter(s => s.date === today && s.type === 'focus');
  }

  function updateStats() {
    const todayFocus = getTodaySessions();
    statSessions.textContent = todayFocus.length;
    statMinutes.textContent = todayFocus.reduce((sum, s) => sum + s.duration, 0);

    // Streak: consecutive days with at least 1 focus session
    let streak = 0;
    const d = new Date();
    while (true) {
      const dateStr = d.toISOString().slice(0, 10);
      const hasFocus = state.sessions.some(s => s.date === dateStr && s.type === 'focus');
      if (hasFocus) {
        streak++;
        d.setDate(d.getDate() - 1);
      } else {
        break;
      }
    }
    statStreak.textContent = streak;
  }

  // ---- Chart ----
  function renderChart() {
    const days = [];
    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const today = new Date();

    for (let i = 6; i >= 0; i--) {
      const d = new Date(today);
      d.setDate(d.getDate() - i);
      const dateStr = d.toISOString().slice(0, 10);
      const focusMins = state.sessions
        .filter(s => s.date === dateStr && s.type === 'focus')
        .reduce((sum, s) => sum + s.duration, 0);
      days.push({
        label: i === 0 ? 'Today' : dayNames[d.getDay()],
        value: focusMins,
        date: dateStr
      });
    }

    const maxVal = Math.max(...days.map(d => d.value), 1);
    const barWidth = 36;
    const gap = 12;
    const chartWidth = days.length * (barWidth + gap) - gap + 40;
    const chartHeight = 160;
    const barMaxHeight = 100;

    const hasData = days.some(d => d.value > 0);

    if (!hasData) {
      weeklyChart.innerHTML = `
        <svg viewBox="0 0 ${chartWidth} 80" xmlns="http://www.w3.org/2000/svg">
          <text x="${chartWidth/2}" y="45" text-anchor="middle" class="chart-empty">
            No sessions yet this week. Start your first focus!
          </text>
        </svg>`;
      return;
    }

    let bars = '';
    days.forEach((d, i) => {
      const x = 20 + i * (barWidth + gap);
      const barH = Math.max((d.value / maxVal) * barMaxHeight, d.value > 0 ? 6 : 2);
      const y = chartHeight - 30 - barH;
      const isToday = d.label === 'Today';

      const color = isToday ? 'var(--accent)' : 'var(--text-muted)';
      const opacity = isToday ? '1' : '0.4';

      bars += `<rect class="chart-bar" x="${x}" y="${y}" width="${barWidth}" height="${barH}"
        fill="${color}" opacity="${opacity}" rx="4" ry="4"/>`;

      if (d.value > 0) {
        bars += `<text x="${x + barWidth/2}" y="${y - 6}" text-anchor="middle" class="chart-value">${d.value}m</text>`;
      }

      bars += `<text x="${x + barWidth/2}" y="${chartHeight - 8}" text-anchor="middle" class="chart-label">${d.label}</text>`;
    });

    weeklyChart.innerHTML = `
      <svg viewBox="0 0 ${chartWidth} ${chartHeight}" xmlns="http://www.w3.org/2000/svg">
        ${bars}
      </svg>`;
  }

  // ---- Session Log ----
  function renderSessionLog() {
    const todaySessions = state.sessions.filter(s => {
      const today = new Date().toISOString().slice(0, 10);
      return s.date === today;
    });

    if (todaySessions.length === 0) {
      sessionLog.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">üçÖ</div>
          <div class="empty-state-text">No sessions today yet.<br>Start a focus session to begin!</div>
        </div>`;
      return;
    }

    const typeNames = { focus: 'Focus', short: 'Short Break', long: 'Long Break' };
    let html = '';
    todaySessions.forEach(s => {
      const time = new Date(s.timestamp);
      const timeStr = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      html += `
        <div class="session-item">
          <div class="session-type-dot ${s.type}"></div>
          <div class="session-info">
            <div class="session-type-name">${typeNames[s.type]}</div>
            <div class="session-meta">${timeStr}</div>
          </div>
          <div class="session-duration">${s.duration}m</div>
        </div>`;
    });
    sessionLog.innerHTML = html;
  }

  // ---- Dark Mode ----
  function setDarkMode(enabled) {
    state.settings.darkMode = enabled;
    document.documentElement.classList.toggle('dark', enabled);
    darkModeIcon.textContent = enabled ? '‚òÄÔ∏è' : 'üåô';
    saveState();
  }

  // ---- Settings ----
  function openSettings() {
    settingsPanel.classList.add('open');
    settingsOverlay.classList.add('open');
    populateSettings();
  }
  function closeSettings() {
    settingsPanel.classList.remove('open');
    settingsOverlay.classList.remove('open');
  }
  function populateSettings() {
    settingFocus.value = state.settings.focusDuration;
    settingShort.value = state.settings.shortBreakDuration;
    settingLong.value = state.settings.longBreakDuration;
    settingCycle.value = state.settings.sessionsPerCycle;
    toggleAutoBreak.classList.toggle('active', state.settings.autoStartBreak);
    toggleAutoFocus.classList.toggle('active', state.settings.autoStartFocus);
    toggleSound.classList.toggle('active', state.settings.sound);
    toggleNotif.classList.toggle('active', state.settings.notifications);
  }

  function applySettings() {
    const f = parseInt(settingFocus.value) || 25;
    const s = parseInt(settingShort.value) || 5;
    const l = parseInt(settingLong.value) || 15;
    const c = parseInt(settingCycle.value) || 4;

    state.settings.focusDuration = Math.max(1, Math.min(120, f));
    state.settings.shortBreakDuration = Math.max(1, Math.min(30, s));
    state.settings.longBreakDuration = Math.max(1, Math.min(60, l));
    state.settings.sessionsPerCycle = Math.max(2, Math.min(10, c));

    // If not running, update current timer
    if (!state.isRunning) {
      state.totalTime = getDuration(state.currentMode) * 60;
      state.timeRemaining = state.totalTime;
    }

    saveState();
    updateDisplay();
  }

  function toggleSetting(el, key) {
    state.settings[key] = !state.settings[key];
    el.classList.toggle('active', state.settings[key]);
    if (key === 'notifications' && state.settings.notifications) {
      if (Notification.permission === 'default') {
        Notification.requestPermission();
      }
    }
    saveState();
  }

  // ---- Event Listeners ----
  startBtn.addEventListener('click', () => {
    state.isRunning ? pauseTimer() : startTimer();
  });
  resetBtn.addEventListener('click', resetTimer);
  skipBtn.addEventListener('click', skipSession);

  tabFocus.addEventListener('click', () => switchMode('focus'));
  tabShort.addEventListener('click', () => switchMode('short'));
  tabLong.addEventListener('click', () => switchMode('long'));

  darkModeBtn.addEventListener('click', () => setDarkMode(!state.settings.darkMode));
  settingsBtn.addEventListener('click', openSettings);
  closeSettingsBtn.addEventListener('click', closeSettings);
  settingsOverlay.addEventListener('click', closeSettings);

  [settingFocus, settingShort, settingLong, settingCycle].forEach(input => {
    input.addEventListener('change', applySettings);
    input.addEventListener('input', applySettings);
  });

  toggleAutoBreak.addEventListener('click', () => toggleSetting(toggleAutoBreak, 'autoStartBreak'));
  toggleAutoFocus.addEventListener('click', () => toggleSetting(toggleAutoFocus, 'autoStartFocus'));
  toggleSound.addEventListener('click', () => toggleSetting(toggleSound, 'sound'));
  toggleNotif.addEventListener('click', () => toggleSetting(toggleNotif, 'notifications'));

  clearAllBtn.addEventListener('click', () => {
    if (confirm('Clear all session data? This cannot be undone.')) {
      state.sessions = [];
      state.sessionCount = 0;
      saveState();
      updateDisplay();
      renderSessionLog();
      renderChart();
      closeSettings();
    }
  });

  clearLogBtn.addEventListener('click', () => {
    const today = new Date().toISOString().slice(0, 10);
    if (confirm("Clear today's session log?")) {
      state.sessions = state.sessions.filter(s => s.date !== today);
      saveState();
      updateDisplay();
      renderSessionLog();
      renderChart();
    }
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT') return;
    if (e.code === 'Space') {
      e.preventDefault();
      state.isRunning ? pauseTimer() : startTimer();
    } else if (e.code === 'KeyR') {
      resetTimer();
    } else if (e.code === 'KeyS') {
      skipSession();
    }
  });

  // ---- Init ----
  loadState();
  setDarkMode(state.settings.darkMode);
  updateDisplay();
  renderSessionLog();
  renderChart();

  // Show motivational hint
  motivation.textContent = '';

})();
</script>
</body>
</html>
