<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Healthy Meal Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --green-50: #f0fdf4;
    --green-100: #dcfce7;
    --green-200: #bbf7d0;
    --green-300: #86efac;
    --green-400: #4ade80;
    --green-500: #22c55e;
    --green-600: #16a34a;
    --green-700: #15803d;
    --orange-50: #fff7ed;
    --orange-100: #ffedd5;
    --orange-400: #fb923c;
    --orange-500: #f97316;
    --orange-600: #ea580c;
    --blue-50: #eff6ff;
    --blue-100: #dbeafe;
    --blue-400: #60a5fa;
    --blue-500: #3b82f6;
    --blue-600: #2563eb;
    --purple-50: #faf5ff;
    --purple-100: #f3e8ff;
    --purple-400: #c084fc;
    --purple-500: #a855f7;
    --red-50: #fef2f2;
    --red-100: #fee2e2;
    --red-400: #f87171;
    --red-500: #ef4444;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
    --radius: 12px;
    --radius-lg: 16px;
    --radius-xl: 20px;
    --transition: all 0.2s ease;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 25%, #f0f9ff 50%, #faf5ff 100%);
    min-height: 100vh;
    color: var(--gray-800);
    line-height: 1.5;
  }

  .app-container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px;
  }

  /* Header */
  .header {
    text-align: center;
    padding: 32px 20px 24px;
    margin-bottom: 28px;
  }

  .header-icon {
    font-size: 48px;
    margin-bottom: 8px;
    display: inline-block;
    animation: bounce 2s infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  .header h1 {
    font-size: 32px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--green-600), var(--green-500), var(--orange-500));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 6px;
    letter-spacing: -0.5px;
  }

  .header p {
    color: var(--gray-500);
    font-size: 15px;
    font-weight: 400;
  }

  /* Date Navigation */
  .date-nav {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-bottom: 28px;
  }

  .date-nav button {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: 10px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    color: var(--gray-600);
    font-size: 18px;
  }

  .date-nav button:hover {
    background: var(--green-50);
    border-color: var(--green-300);
    color: var(--green-600);
    transform: scale(1.05);
  }

  .date-display {
    font-size: 17px;
    font-weight: 600;
    color: var(--gray-700);
    min-width: 200px;
    text-align: center;
  }

  .date-today-badge {
    display: inline-block;
    background: var(--green-100);
    color: var(--green-700);
    font-size: 11px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 20px;
    margin-left: 8px;
    vertical-align: middle;
  }

  /* Dashboard Grid */
  .dashboard {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 28px;
  }

  @media (max-width: 700px) {
    .dashboard { grid-template-columns: 1fr; }
  }

  .summary-card {
    background: white;
    border-radius: var(--radius-lg);
    padding: 22px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(0,0,0,0.04);
    transition: var(--transition);
  }

  .summary-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }

  .summary-card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
  }

  .summary-card-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }

  .summary-card-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--gray-500);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .summary-card-value {
    font-size: 32px;
    font-weight: 800;
    color: var(--gray-900);
    line-height: 1;
  }

  .summary-card-unit {
    font-size: 14px;
    font-weight: 500;
    color: var(--gray-400);
    margin-left: 4px;
  }

  .summary-card-sub {
    font-size: 12px;
    color: var(--gray-400);
    margin-top: 6px;
  }

  /* Macro bars */
  .macro-bars {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 4px;
  }

  .macro-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .macro-label {
    font-size: 13px;
    font-weight: 600;
    width: 60px;
    color: var(--gray-600);
  }

  .macro-bar-bg {
    flex: 1;
    height: 10px;
    background: var(--gray-100);
    border-radius: 10px;
    overflow: hidden;
  }

  .macro-bar-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 0.6s ease;
  }

  .macro-value {
    font-size: 13px;
    font-weight: 600;
    width: 50px;
    text-align: right;
    color: var(--gray-700);
  }

  /* Calorie ring */
  .calorie-ring-container {
    display: flex;
    align-items: center;
    gap: 24px;
  }

  .calorie-ring-wrap {
    position: relative;
    width: 110px;
    height: 110px;
    flex-shrink: 0;
  }

  .calorie-ring-wrap svg {
    transform: rotate(-90deg);
  }

  .calorie-ring-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }

  .calorie-ring-number {
    font-size: 22px;
    font-weight: 800;
    color: var(--gray-800);
    display: block;
    line-height: 1.1;
  }

  .calorie-ring-label {
    font-size: 10px;
    color: var(--gray-400);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .calorie-info { flex: 1; }

  .calorie-info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    border-bottom: 1px solid var(--gray-100);
  }

  .calorie-info-row:last-child { border: none; }

  .calorie-info-label {
    font-size: 13px;
    color: var(--gray-500);
  }

  .calorie-info-value {
    font-size: 14px;
    font-weight: 700;
    color: var(--gray-700);
  }

  /* Goal Settings */
  .goal-edit-btn {
    background: none;
    border: none;
    color: var(--gray-400);
    cursor: pointer;
    font-size: 14px;
    padding: 2px 6px;
    border-radius: 6px;
    transition: var(--transition);
  }

  .goal-edit-btn:hover {
    background: var(--gray-100);
    color: var(--gray-600);
  }

  /* Main Content */
  .main-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
  }

  /* Meal Sections */
  .meal-section {
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow);
    border: 1px solid rgba(0,0,0,0.04);
    overflow: hidden;
    transition: var(--transition);
  }

  .meal-section:hover {
    box-shadow: var(--shadow-md);
  }

  .meal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 22px;
    cursor: pointer;
    user-select: none;
    transition: background 0.15s;
  }

  .meal-header:hover {
    background: var(--gray-50);
  }

  .meal-header-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .meal-icon {
    width: 42px;
    height: 42px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
  }

  .meal-title {
    font-size: 17px;
    font-weight: 700;
    color: var(--gray-800);
  }

  .meal-subtitle {
    font-size: 12px;
    color: var(--gray-400);
    font-weight: 500;
  }

  .meal-header-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .meal-cal-badge {
    font-size: 14px;
    font-weight: 700;
    color: var(--gray-600);
    background: var(--gray-100);
    padding: 4px 12px;
    border-radius: 20px;
  }

  .meal-toggle {
    font-size: 14px;
    color: var(--gray-400);
    transition: transform 0.3s;
  }

  .meal-toggle.open { transform: rotate(180deg); }

  .meal-body {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
  }

  .meal-body.open {
    max-height: 2000px;
  }

  .meal-body-inner {
    padding: 0 22px 18px;
  }

  /* Ingredient List */
  .ingredient-list {
    list-style: none;
  }

  .ingredient-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 14px;
    border-radius: 10px;
    margin-bottom: 4px;
    transition: background 0.15s;
    position: relative;
  }

  .ingredient-item:hover {
    background: var(--gray-50);
  }

  .ingredient-left {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    min-width: 0;
  }

  .ingredient-emoji {
    font-size: 22px;
    width: 32px;
    text-align: center;
    flex-shrink: 0;
  }

  .ingredient-info { flex: 1; min-width: 0; }

  .ingredient-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--gray-800);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .ingredient-portion {
    font-size: 12px;
    color: var(--gray-400);
  }

  .ingredient-macros {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-shrink: 0;
  }

  .ingredient-macro {
    text-align: center;
    min-width: 44px;
  }

  .ingredient-macro-val {
    font-size: 13px;
    font-weight: 700;
    color: var(--gray-700);
  }

  .ingredient-macro-label {
    font-size: 10px;
    color: var(--gray-400);
    text-transform: uppercase;
  }

  .ingredient-cal {
    font-size: 14px;
    font-weight: 700;
    min-width: 55px;
    text-align: right;
    flex-shrink: 0;
  }

  .ingredient-delete {
    opacity: 0;
    background: none;
    border: none;
    color: var(--red-400);
    cursor: pointer;
    font-size: 16px;
    padding: 4px 6px;
    border-radius: 6px;
    transition: var(--transition);
    margin-left: 4px;
    flex-shrink: 0;
  }

  .ingredient-item:hover .ingredient-delete {
    opacity: 1;
  }

  .ingredient-delete:hover {
    background: var(--red-50);
    color: var(--red-500);
  }

  /* Add Ingredient Form */
  .add-ingredient-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 12px;
    background: var(--gray-50);
    border: 2px dashed var(--gray-200);
    border-radius: 10px;
    color: var(--gray-500);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    margin-top: 8px;
  }

  .add-ingredient-btn:hover {
    border-color: var(--green-300);
    color: var(--green-600);
    background: var(--green-50);
  }

  /* Modal */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s;
    padding: 20px;
  }

  .modal-overlay.active {
    opacity: 1;
    pointer-events: all;
  }

  .modal {
    background: white;
    border-radius: var(--radius-xl);
    padding: 0;
    width: 100%;
    max-width: 480px;
    box-shadow: var(--shadow-xl);
    transform: translateY(20px) scale(0.97);
    transition: transform 0.25s ease;
    max-height: 90vh;
    overflow-y: auto;
  }

  .modal-overlay.active .modal {
    transform: translateY(0) scale(1);
  }

  .modal-header {
    padding: 24px 24px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .modal-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--gray-800);
  }

  .modal-close {
    background: var(--gray-100);
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--gray-500);
    font-size: 18px;
    transition: var(--transition);
  }

  .modal-close:hover {
    background: var(--gray-200);
    color: var(--gray-700);
  }

  .modal-body {
    padding: 20px 24px 24px;
  }

  .form-group {
    margin-bottom: 16px;
  }

  .form-label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: var(--gray-600);
    margin-bottom: 6px;
  }

  .form-input {
    width: 100%;
    padding: 10px 14px;
    border: 2px solid var(--gray-200);
    border-radius: 10px;
    font-size: 14px;
    font-family: inherit;
    color: var(--gray-800);
    transition: var(--transition);
    outline: none;
    background: white;
  }

  .form-input:focus {
    border-color: var(--green-400);
    box-shadow: 0 0 0 3px rgba(34,197,94,0.1);
  }

  .form-input::placeholder {
    color: var(--gray-300);
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .form-row-3 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
  }

  /* Quick Add Suggestions */
  .quick-add-section {
    margin-bottom: 16px;
  }

  .quick-add-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--gray-400);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 10px;
  }

  .quick-add-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .quick-add-chip {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: var(--transition);
    color: var(--gray-600);
  }

  .quick-add-chip:hover {
    background: var(--green-50);
    border-color: var(--green-300);
    color: var(--green-700);
    transform: scale(1.03);
  }

  .quick-add-chip span {
    font-size: 16px;
  }

  .btn-primary {
    width: 100%;
    padding: 12px 20px;
    background: linear-gradient(135deg, var(--green-500), var(--green-600));
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: 0 2px 8px rgba(34,197,94,0.3);
  }

  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(34,197,94,0.4);
  }

  .btn-primary:active {
    transform: translateY(0);
  }

  .btn-secondary {
    padding: 8px 16px;
    background: var(--gray-100);
    color: var(--gray-600);
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: var(--transition);
  }

  .btn-secondary:hover {
    background: var(--gray-200);
    color: var(--gray-700);
  }

  /* Separator */
  .or-separator {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 16px 0;
    color: var(--gray-300);
    font-size: 12px;
    font-weight: 600;
  }

  .or-separator::before, .or-separator::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--gray-200);
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 24px 16px;
    color: var(--gray-400);
  }

  .empty-state-icon {
    font-size: 36px;
    margin-bottom: 8px;
  }

  .empty-state-text {
    font-size: 14px;
    font-weight: 500;
  }

  /* Water Tracker */
  .water-section {
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow);
    border: 1px solid rgba(0,0,0,0.04);
    padding: 20px 22px;
    margin-bottom: 20px;
  }

  .water-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }

  .water-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 16px;
    font-weight: 700;
    color: var(--gray-800);
  }

  .water-title-icon {
    font-size: 22px;
  }

  .water-count {
    font-size: 14px;
    color: var(--blue-500);
    font-weight: 600;
  }

  .water-glasses {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .water-glass {
    width: 44px;
    height: 44px;
    border-radius: 10px;
    border: 2px solid var(--gray-200);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
    transition: var(--transition);
    background: white;
  }

  .water-glass:hover {
    border-color: var(--blue-300);
    transform: scale(1.08);
  }

  .water-glass.filled {
    background: var(--blue-50);
    border-color: var(--blue-400);
  }

  /* Meal type colors */
  .meal-breakfast .meal-icon { background: var(--orange-100); }
  .meal-breakfast .meal-cal-badge { color: var(--orange-600); background: var(--orange-50); }
  .meal-lunch .meal-icon { background: var(--green-100); }
  .meal-lunch .meal-cal-badge { color: var(--green-600); background: var(--green-50); }
  .meal-dinner .meal-icon { background: var(--purple-100); }
  .meal-dinner .meal-cal-badge { color: var(--purple-500); background: var(--purple-50); }
  .meal-snack .meal-icon { background: var(--blue-100); }
  .meal-snack .meal-cal-badge { color: var(--blue-500); background: var(--blue-50); }

  .cal-color-orange { color: var(--orange-600); }
  .cal-color-green { color: var(--green-600); }
  .cal-color-purple { color: var(--purple-500); }
  .cal-color-blue { color: var(--blue-500); }

  /* Animations */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .animate-in {
    animation: fadeInUp 0.3s ease forwards;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--gray-400); }

  /* Responsive */
  @media (max-width: 600px) {
    .app-container { padding: 12px; }
    .header { padding: 20px 12px 16px; }
    .header h1 { font-size: 26px; }
    .ingredient-macros { display: none; }
    .dashboard { gap: 12px; }
    .summary-card { padding: 16px; }
    .summary-card-value { font-size: 26px; }
    .calorie-ring-container { flex-direction: column; align-items: center; }
    .form-row, .form-row-3 { grid-template-columns: 1fr; }
  }

  /* Toast */
  .toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .toast {
    background: var(--gray-800);
    color: white;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 500;
    box-shadow: var(--shadow-lg);
    animation: toastIn 0.3s ease, toastOut 0.3s ease 2.5s forwards;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  @keyframes toastIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes toastOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(20px); }
  }

  /* Goal modal */
  .goal-input-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .goal-input-row label {
    font-size: 13px;
    font-weight: 600;
    color: var(--gray-600);
    width: 90px;
    flex-shrink: 0;
  }

  .goal-input-row input {
    flex: 1;
    padding: 8px 12px;
    border: 2px solid var(--gray-200);
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
    outline: none;
    transition: var(--transition);
  }

  .goal-input-row input:focus {
    border-color: var(--green-400);
  }

  .goal-input-row span {
    font-size: 12px;
    color: var(--gray-400);
    width: 20px;
  }

  /* Footer */
  .footer {
    text-align: center;
    padding: 28px 0 16px;
    color: var(--gray-400);
    font-size: 12px;
  }

  .footer span { font-size: 14px; }
</style>
</head>
<body>

<div class="app-container" id="app">
  <!-- Header -->
  <div class="header">
    <div class="header-icon">ü•ó</div>
    <h1>Healthy Meal Tracker</h1>
    <p>Track your meals, hit your goals, feel amazing.</p>
  </div>

  <!-- Date Navigation -->
  <div class="date-nav">
    <button onclick="app.changeDate(-1)" title="Previous day">‚Äπ</button>
    <div class="date-display" id="dateDisplay"></div>
    <button onclick="app.changeDate(1)" title="Next day">‚Ä∫</button>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard"></div>

  <!-- Water Tracker -->
  <div class="water-section" id="waterSection"></div>

  <!-- Meals -->
  <div class="main-content" id="mealsContainer"></div>

  <!-- Footer -->
  <div class="footer">
    <span>üåø</span> Healthy Meal Tracker &mdash; Nourish your body
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay" onclick="app.closeModalOverlay(event)">
  <div class="modal" id="modal"></div>
</div>

<!-- Toasts -->
<div class="toast-container" id="toastContainer"></div>

<script>
(function() {
  // ========== DATA & STATE ==========
  const MEAL_TYPES = [
    { id: 'breakfast', name: 'Breakfast', icon: 'üç≥', time: '7:00 - 10:00 AM', colorClass: 'orange' },
    { id: 'lunch', name: 'Lunch', icon: 'ü•™', time: '12:00 - 2:00 PM', colorClass: 'green' },
    { id: 'dinner', name: 'Dinner', icon: 'üçΩÔ∏è', time: '6:00 - 9:00 PM', colorClass: 'purple' },
    { id: 'snack', name: 'Snacks', icon: 'üçé', time: 'Anytime', colorClass: 'blue' }
  ];

  const FOOD_DATABASE = [
    { name: 'Banana', emoji: 'üçå', portion: '1 medium (118g)', calories: 105, protein: 1.3, carbs: 27, fat: 0.4 },
    { name: 'Chicken Breast', emoji: 'üçó', portion: '100g grilled', calories: 165, protein: 31, carbs: 0, fat: 3.6 },
    { name: 'Brown Rice', emoji: 'üçö', portion: '1 cup cooked', calories: 216, protein: 5, carbs: 45, fat: 1.8 },
    { name: 'Broccoli', emoji: 'ü•¶', portion: '1 cup (91g)', calories: 31, protein: 2.6, carbs: 6, fat: 0.3 },
    { name: 'Salmon', emoji: 'üêü', portion: '100g fillet', calories: 208, protein: 20, carbs: 0, fat: 13 },
    { name: 'Egg', emoji: 'ü•ö', portion: '1 large', calories: 72, protein: 6.3, carbs: 0.4, fat: 4.8 },
    { name: 'Avocado', emoji: 'ü•ë', portion: '¬Ω medium', calories: 120, protein: 1.5, carbs: 6, fat: 11 },
    { name: 'Greek Yogurt', emoji: 'ü•õ', portion: '170g plain', calories: 100, protein: 17, carbs: 6, fat: 0.7 },
    { name: 'Oatmeal', emoji: 'ü•£', portion: '1 cup cooked', calories: 154, protein: 5, carbs: 27, fat: 2.6 },
    { name: 'Sweet Potato', emoji: 'üç†', portion: '1 medium', calories: 103, protein: 2.3, carbs: 24, fat: 0.1 },
    { name: 'Apple', emoji: 'üçé', portion: '1 medium', calories: 95, protein: 0.5, carbs: 25, fat: 0.3 },
    { name: 'Almonds', emoji: 'ü•ú', portion: '28g (23 nuts)', calories: 164, protein: 6, carbs: 6, fat: 14 },
    { name: 'Spinach', emoji: 'ü•¨', portion: '2 cups raw', calories: 14, protein: 1.7, carbs: 2.2, fat: 0.2 },
    { name: 'Whole Wheat Toast', emoji: 'üçû', portion: '1 slice', calories: 81, protein: 4, carbs: 14, fat: 1.1 },
    { name: 'Blueberries', emoji: 'ü´ê', portion: '1 cup (148g)', calories: 84, protein: 1.1, carbs: 21, fat: 0.5 },
    { name: 'Turkey Breast', emoji: 'ü¶É', portion: '100g sliced', calories: 104, protein: 18, carbs: 4.2, fat: 1.2 },
    { name: 'Cottage Cheese', emoji: 'üßÄ', portion: '1 cup', calories: 206, protein: 28, carbs: 6, fat: 9 },
    { name: 'Quinoa', emoji: 'ü´ò', portion: '1 cup cooked', calories: 222, protein: 8, carbs: 39, fat: 3.6 },
    { name: 'Tomato', emoji: 'üçÖ', portion: '1 medium', calories: 22, protein: 1.1, carbs: 4.8, fat: 0.2 },
    { name: 'Orange', emoji: 'üçä', portion: '1 medium', calories: 62, protein: 1.2, carbs: 15, fat: 0.2 },
    { name: 'Lentils', emoji: 'ü´ò', portion: '1 cup cooked', calories: 230, protein: 18, carbs: 40, fat: 0.8 },
    { name: 'Peanut Butter', emoji: 'ü•ú', portion: '2 tbsp', calories: 188, protein: 8, carbs: 6, fat: 16 },
    { name: 'Strawberries', emoji: 'üçì', portion: '1 cup (152g)', calories: 49, protein: 1, carbs: 12, fat: 0.5 },
    { name: 'Olive Oil', emoji: 'ü´í', portion: '1 tbsp', calories: 119, protein: 0, carbs: 0, fat: 14 },
    { name: 'Carrot', emoji: 'ü•ï', portion: '1 medium', calories: 25, protein: 0.6, carbs: 6, fat: 0.1 },
    { name: 'Milk (2%)', emoji: 'ü•õ', portion: '1 cup (240ml)', calories: 122, protein: 8, carbs: 12, fat: 5 },
    { name: 'Pasta', emoji: 'üçù', portion: '1 cup cooked', calories: 220, protein: 8, carbs: 43, fat: 1.3 },
    { name: 'Hummus', emoji: 'ü´ï', portion: '2 tbsp', calories: 50, protein: 2, carbs: 4, fat: 3 },
    { name: 'Dark Chocolate', emoji: 'üç´', portion: '30g (70% cocoa)', calories: 170, protein: 2.2, carbs: 13, fat: 12 },
    { name: 'Green Tea', emoji: 'üçµ', portion: '1 cup', calories: 2, protein: 0.3, carbs: 0, fat: 0 }
  ];

  const QUICK_SUGGESTIONS = {
    breakfast: ['Egg', 'Oatmeal', 'Banana', 'Whole Wheat Toast', 'Greek Yogurt', 'Blueberries'],
    lunch: ['Chicken Breast', 'Brown Rice', 'Spinach', 'Quinoa', 'Turkey Breast', 'Tomato'],
    dinner: ['Salmon', 'Sweet Potato', 'Broccoli', 'Pasta', 'Lentils', 'Olive Oil'],
    snack: ['Apple', 'Almonds', 'Hummus', 'Carrot', 'Dark Chocolate', 'Strawberries']
  };

  let state = {
    currentDate: new Date().toISOString().split('T')[0],
    data: {},
    goals: { calories: 2000, protein: 150, carbs: 250, fat: 65 },
    openMeals: { breakfast: true, lunch: false, dinner: false, snack: false }
  };

  function getDateKey() { return state.currentDate; }

  function getDayData() {
    if (!state.data[getDateKey()]) {
      state.data[getDateKey()] = {
        meals: { breakfast: [], lunch: [], dinner: [], snack: [] },
        water: 0
      };
    }
    return state.data[getDateKey()];
  }

  function saveState() {
    try {
      localStorage.setItem('mealTracker', JSON.stringify({
        data: state.data,
        goals: state.goals
      }));
    } catch(e) {}
  }

  function loadState() {
    try {
      const saved = localStorage.getItem('mealTracker');
      if (saved) {
        const parsed = JSON.parse(saved);
        state.data = parsed.data || {};
        state.goals = parsed.goals || state.goals;
      }
    } catch(e) {}
  }

  // ========== COMPUTATIONS ==========
  function getDayTotals() {
    const day = getDayData();
    let totals = { calories: 0, protein: 0, carbs: 0, fat: 0 };
    Object.values(day.meals).forEach(items => {
      items.forEach(item => {
        totals.calories += item.calories;
        totals.protein += item.protein;
        totals.carbs += item.carbs;
        totals.fat += item.fat;
      });
    });
    return totals;
  }

  function getMealCalories(mealId) {
    const day = getDayData();
    return day.meals[mealId].reduce((sum, item) => sum + item.calories, 0);
  }

  // ========== RENDERING ==========
  function formatDate(dateStr) {
    const d = new Date(dateStr + 'T12:00:00');
    const today = new Date();
    today.setHours(12, 0, 0, 0);
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);

    const options = { weekday: 'long', month: 'long', day: 'numeric' };
    const formatted = d.toLocaleDateString('en-US', options);

    const dStr = d.toISOString().split('T')[0];
    const todayStr = today.toISOString().split('T')[0];
    const yestStr = yesterday.toISOString().split('T')[0];
    const tomStr = tomorrow.toISOString().split('T')[0];

    let badge = '';
    if (dStr === todayStr) badge = '<span class="date-today-badge">Today</span>';
    else if (dStr === yestStr) badge = '<span class="date-today-badge" style="background:#fef3c7;color:#92400e">Yesterday</span>';
    else if (dStr === tomStr) badge = '<span class="date-today-badge" style="background:#dbeafe;color:#1e40af">Tomorrow</span>';

    return formatted + badge;
  }

  function renderDateNav() {
    document.getElementById('dateDisplay').innerHTML = formatDate(state.currentDate);
  }

  function renderDashboard() {
    const totals = getDayTotals();
    const g = state.goals;
    const remaining = Math.max(0, g.calories - totals.calories);
    const pct = Math.min(100, (totals.calories / g.calories) * 100);
    const overBudget = totals.calories > g.calories;

    const circumference = 2 * Math.PI * 44;
    const dashOffset = circumference - (pct / 100) * circumference;
    const ringColor = overBudget ? 'var(--red-400)' : 'var(--green-400)';

    const proteinPct = Math.min(100, (totals.protein / g.protein) * 100);
    const carbsPct = Math.min(100, (totals.carbs / g.carbs) * 100);
    const fatPct = Math.min(100, (totals.fat / g.fat) * 100);

    document.getElementById('dashboard').innerHTML = `
      <div class="summary-card">
        <div class="summary-card-header">
          <div class="summary-card-icon" style="background: ${overBudget ? 'var(--red-100)' : 'var(--green-100)'}">üî•</div>
          <div>
            <div class="summary-card-title">Calories</div>
          </div>
          <button class="goal-edit-btn" onclick="app.openGoalModal()" title="Edit goals">‚öôÔ∏è</button>
        </div>
        <div class="calorie-ring-container">
          <div class="calorie-ring-wrap">
            <svg width="110" height="110" viewBox="0 0 110 110">
              <circle cx="55" cy="55" r="44" fill="none" stroke="var(--gray-100)" stroke-width="10"/>
              <circle cx="55" cy="55" r="44" fill="none" stroke="${ringColor}" stroke-width="10"
                stroke-dasharray="${circumference}" stroke-dashoffset="${dashOffset}"
                stroke-linecap="round" style="transition: stroke-dashoffset 0.8s ease"/>
            </svg>
            <div class="calorie-ring-text">
              <span class="calorie-ring-number">${Math.round(pct)}%</span>
              <span class="calorie-ring-label">of goal</span>
            </div>
          </div>
          <div class="calorie-info">
            <div class="calorie-info-row">
              <span class="calorie-info-label">Consumed</span>
              <span class="calorie-info-value">${totals.calories.toLocaleString()} kcal</span>
            </div>
            <div class="calorie-info-row">
              <span class="calorie-info-label">Remaining</span>
              <span class="calorie-info-value" style="color: ${overBudget ? 'var(--red-500)' : 'var(--green-600)'}">
                ${overBudget ? '+' + (totals.calories - g.calories) : remaining} kcal
              </span>
            </div>
            <div class="calorie-info-row">
              <span class="calorie-info-label">Goal</span>
              <span class="calorie-info-value">${g.calories.toLocaleString()} kcal</span>
            </div>
          </div>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-card-header">
          <div class="summary-card-icon" style="background: var(--blue-100)">üí™</div>
          <div>
            <div class="summary-card-title">Macronutrients</div>
          </div>
        </div>
        <div class="macro-bars">
          <div class="macro-row">
            <span class="macro-label">Protein</span>
            <div class="macro-bar-bg">
              <div class="macro-bar-fill" style="width: ${proteinPct}%; background: linear-gradient(90deg, var(--orange-400), var(--orange-500))"></div>
            </div>
            <span class="macro-value">${Math.round(totals.protein)}g</span>
          </div>
          <div class="macro-row">
            <span class="macro-label">Carbs</span>
            <div class="macro-bar-bg">
              <div class="macro-bar-fill" style="width: ${carbsPct}%; background: linear-gradient(90deg, var(--blue-400), var(--blue-500))"></div>
            </div>
            <span class="macro-value">${Math.round(totals.carbs)}g</span>
          </div>
          <div class="macro-row">
            <span class="macro-label">Fat</span>
            <div class="macro-bar-bg">
              <div class="macro-bar-fill" style="width: ${fatPct}%; background: linear-gradient(90deg, var(--purple-400), var(--purple-500))"></div>
            </div>
            <span class="macro-value">${Math.round(totals.fat)}g</span>
          </div>
        </div>
        <div style="margin-top: 14px; display: flex; gap: 16px; font-size: 12px; color: var(--gray-400);">
          <span>üéØ P: ${g.protein}g</span>
          <span>üéØ C: ${g.carbs}g</span>
          <span>üéØ F: ${g.fat}g</span>
        </div>
      </div>
    `;
  }

  function renderWater() {
    const day = getDayData();
    const glasses = day.water || 0;
    const target = 8;
    let html = `
      <div class="water-header">
        <div class="water-title">
          <span class="water-title-icon">üíß</span> Water Intake
        </div>
        <div class="water-count">${glasses} / ${target} glasses</div>
      </div>
      <div class="water-glasses">
    `;
    for (let i = 0; i < target; i++) {
      html += `<div class="water-glass ${i < glasses ? 'filled' : ''}" onclick="app.toggleWater(${i})">
        ${i < glasses ? 'üíß' : '‚óã'}
      </div>`;
    }
    html += '</div>';
    document.getElementById('waterSection').innerHTML = html;
  }

  function renderMeals() {
    const day = getDayData();
    let html = '';

    MEAL_TYPES.forEach(meal => {
      const items = day.meals[meal.id];
      const cal = getMealCalories(meal.id);
      const isOpen = state.openMeals[meal.id];

      html += `
        <div class="meal-section meal-${meal.id} animate-in">
          <div class="meal-header" onclick="app.toggleMeal('${meal.id}')">
            <div class="meal-header-left">
              <div class="meal-icon">${meal.icon}</div>
              <div>
                <div class="meal-title">${meal.name}</div>
                <div class="meal-subtitle">${meal.time} ¬∑ ${items.length} item${items.length !== 1 ? 's' : ''}</div>
              </div>
            </div>
            <div class="meal-header-right">
              <div class="meal-cal-badge">${cal} kcal</div>
              <div class="meal-toggle ${isOpen ? 'open' : ''}">‚ñº</div>
            </div>
          </div>
          <div class="meal-body ${isOpen ? 'open' : ''}">
            <div class="meal-body-inner">
      `;

      if (items.length === 0) {
        html += `
          <div class="empty-state">
            <div class="empty-state-icon">${meal.icon}</div>
            <div class="empty-state-text">No items yet. Add your first ${meal.name.toLowerCase()} item!</div>
          </div>
        `;
      } else {
        html += '<ul class="ingredient-list">';
        items.forEach((item, idx) => {
          html += `
            <li class="ingredient-item">
              <div class="ingredient-left">
                <span class="ingredient-emoji">${item.emoji}</span>
                <div class="ingredient-info">
                  <div class="ingredient-name">${item.name}</div>
                  <div class="ingredient-portion">${item.portion}</div>
                </div>
              </div>
              <div class="ingredient-macros">
                <div class="ingredient-macro">
                  <div class="ingredient-macro-val">${Math.round(item.protein)}g</div>
                  <div class="ingredient-macro-label">Prot</div>
                </div>
                <div class="ingredient-macro">
                  <div class="ingredient-macro-val">${Math.round(item.carbs)}g</div>
                  <div class="ingredient-macro-label">Carb</div>
                </div>
                <div class="ingredient-macro">
                  <div class="ingredient-macro-val">${Math.round(item.fat)}g</div>
                  <div class="ingredient-macro-label">Fat</div>
                </div>
              </div>
              <div class="ingredient-cal cal-color-${meal.colorClass}">${item.calories} kcal</div>
              <button class="ingredient-delete" onclick="app.removeItem('${meal.id}', ${idx})" title="Remove">‚úï</button>
            </li>
          `;
        });
        html += '</ul>';
      }

      html += `
              <button class="add-ingredient-btn" onclick="app.openAddModal('${meal.id}')">
                <span style="font-size:18px">+</span> Add Food
              </button>
            </div>
          </div>
        </div>
      `;
    });

    document.getElementById('mealsContainer').innerHTML = html;
  }

  function renderAll() {
    renderDateNav();
    renderDashboard();
    renderWater();
    renderMeals();
  }

  // ========== ACTIONS ==========
  function changeDate(offset) {
    const d = new Date(state.currentDate + 'T12:00:00');
    d.setDate(d.getDate() + offset);
    state.currentDate = d.toISOString().split('T')[0];
    renderAll();
  }

  function toggleMeal(mealId) {
    state.openMeals[mealId] = !state.openMeals[mealId];
    renderMeals();
  }

  function toggleWater(index) {
    const day = getDayData();
    if (index < day.water) {
      day.water = index;
    } else {
      day.water = index + 1;
    }
    saveState();
    renderWater();
  }

  function removeItem(mealId, idx) {
    const day = getDayData();
    const removed = day.meals[mealId].splice(idx, 1)[0];
    saveState();
    renderAll();
    showToast(`Removed ${removed.name}`, 'üóëÔ∏è');
  }

  function addItem(mealId, item) {
    const day = getDayData();
    day.meals[mealId].push({...item, id: Date.now()});
    saveState();
    state.openMeals[mealId] = true;
    renderAll();
    showToast(`Added ${item.name} to ${MEAL_TYPES.find(m => m.id === mealId).name}`, '‚úÖ');
  }

  // ========== MODALS ==========
  let currentMealId = null;

  function openAddModal(mealId) {
    currentMealId = mealId;
    const meal = MEAL_TYPES.find(m => m.id === mealId);
    const suggestions = QUICK_SUGGESTIONS[mealId] || [];

    let quickChips = suggestions.map(name => {
      const food = FOOD_DATABASE.find(f => f.name === name);
      if (!food) return '';
      return `<div class="quick-add-chip" onclick="app.quickAdd('${mealId}', '${name}')">
        <span>${food.emoji}</span> ${food.name}
      </div>`;
    }).join('');

    document.getElementById('modal').innerHTML = `
      <div class="modal-header">
        <div class="modal-title">${meal.icon} Add to ${meal.name}</div>
        <button class="modal-close" onclick="app.closeModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="quick-add-section">
          <div class="quick-add-title">Quick Add</div>
          <div class="quick-add-grid">${quickChips}</div>
        </div>

        <div class="or-separator">or search</div>

        <div class="form-group">
          <input type="text" class="form-input" id="foodSearch" placeholder="Search foods..." oninput="app.filterFoods(this.value)" autocomplete="off">
        </div>
        <div id="searchResults" style="max-height: 200px; overflow-y: auto; margin-bottom: 16px;"></div>

        <div class="or-separator">or add custom</div>

        <div class="form-group">
          <label class="form-label">Food Name</label>
          <input type="text" class="form-input" id="customName" placeholder="e.g., Grilled Chicken Salad">
        </div>
        <div class="form-group">
          <label class="form-label">Portion</label>
          <input type="text" class="form-input" id="customPortion" placeholder="e.g., 1 bowl">
        </div>
        <div class="form-row" style="margin-bottom: 16px;">
          <div class="form-group">
            <label class="form-label">Calories (kcal)</label>
            <input type="number" class="form-input" id="customCal" placeholder="0" min="0">
          </div>
          <div class="form-group">
            <label class="form-label">Protein (g)</label>
            <input type="number" class="form-input" id="customProtein" placeholder="0" min="0" step="0.1">
          </div>
        </div>
        <div class="form-row" style="margin-bottom: 20px;">
          <div class="form-group">
            <label class="form-label">Carbs (g)</label>
            <input type="number" class="form-input" id="customCarbs" placeholder="0" min="0" step="0.1">
          </div>
          <div class="form-group">
            <label class="form-label">Fat (g)</label>
            <input type="number" class="form-input" id="customFat" placeholder="0" min="0" step="0.1">
          </div>
        </div>
        <button class="btn-primary" onclick="app.addCustomItem()">Add Food</button>
      </div>
    `;

    document.getElementById('modalOverlay').classList.add('active');
    setTimeout(() => document.getElementById('foodSearch').focus(), 200);
  }

  function filterFoods(query) {
    const results = document.getElementById('searchResults');
    if (!query || query.length < 1) {
      results.innerHTML = '';
      return;
    }

    const q = query.toLowerCase();
    const matches = FOOD_DATABASE.filter(f => f.name.toLowerCase().includes(q)).slice(0, 8);

    if (matches.length === 0) {
      results.innerHTML = '<div style="text-align:center;color:var(--gray-400);font-size:13px;padding:12px;">No results found. Add a custom entry below.</div>';
      return;
    }

    results.innerHTML = matches.map(food => `
      <div class="ingredient-item" style="cursor:pointer; border-radius: 10px; margin-bottom: 2px;" onclick="app.quickAddFromDB('${food.name}')">
        <div class="ingredient-left">
          <span class="ingredient-emoji">${food.emoji}</span>
          <div class="ingredient-info">
            <div class="ingredient-name">${food.name}</div>
            <div class="ingredient-portion">${food.portion}</div>
          </div>
        </div>
        <div class="ingredient-cal" style="color: var(--gray-600)">${food.calories} kcal</div>
      </div>
    `).join('');
  }

  function quickAdd(mealId, foodName) {
    const food = FOOD_DATABASE.find(f => f.name === foodName);
    if (food) {
      addItem(mealId, {...food});
      closeModal();
    }
  }

  function quickAddFromDB(foodName) {
    const food = FOOD_DATABASE.find(f => f.name === foodName);
    if (food && currentMealId) {
      addItem(currentMealId, {...food});
      closeModal();
    }
  }

  function addCustomItem() {
    const name = document.getElementById('customName').value.trim();
    const portion = document.getElementById('customPortion').value.trim() || '1 serving';
    const cal = parseInt(document.getElementById('customCal').value) || 0;
    const protein = parseFloat(document.getElementById('customProtein').value) || 0;
    const carbs = parseFloat(document.getElementById('customCarbs').value) || 0;
    const fat = parseFloat(document.getElementById('customFat').value) || 0;

    if (!name) {
      showToast('Please enter a food name', '‚ö†Ô∏è');
      return;
    }

    if (cal === 0 && protein === 0 && carbs === 0 && fat === 0) {
      showToast('Please enter nutrition info', '‚ö†Ô∏è');
      return;
    }

    const emoji = guessEmoji(name);
    addItem(currentMealId, { name, emoji, portion, calories: cal, protein, carbs, fat });
    closeModal();
  }

  function guessEmoji(name) {
    const n = name.toLowerCase();
    const map = {
      chicken: 'üçó', beef: 'ü•©', steak: 'ü•©', fish: 'üêü', salmon: 'üêü', tuna: 'üêü',
      rice: 'üçö', pasta: 'üçù', bread: 'üçû', toast: 'üçû', egg: 'ü•ö',
      salad: 'ü•ó', veget: 'ü•¨', broccoli: 'ü•¶', spinach: 'ü•¨', tomato: 'üçÖ', carrot: 'ü•ï',
      apple: 'üçé', banana: 'üçå', orange: 'üçä', berry: 'ü´ê', fruit: 'üçë', grape: 'üçá',
      yogurt: 'ü•õ', milk: 'ü•õ', cheese: 'üßÄ', butter: 'üßà',
      coffee: '‚òï', tea: 'üçµ', juice: 'üßÉ', water: 'üíß', smoothie: 'ü•§',
      cake: 'üç∞', cookie: 'üç™', chocolate: 'üç´', ice: 'üç¶',
      pizza: 'üçï', burger: 'üçî', sandwich: 'ü•™', taco: 'üåÆ', sushi: 'üç£',
      soup: 'üç≤', stew: 'üç≤', curry: 'üçõ', noodle: 'üçú',
      nut: 'ü•ú', almond: 'ü•ú', seed: 'üåª', avocado: 'ü•ë', potato: 'ü•î', 'sweet potato': 'üç†',
      corn: 'üåΩ', pepper: 'üå∂Ô∏è', mushroom: 'üçÑ', bean: 'ü´ò', lentil: 'ü´ò',
      shrimp: 'ü¶ê', crab: 'ü¶Ä', lobster: 'ü¶û', pork: 'ü•ì', bacon: 'ü•ì', ham: 'üçñ',
      waffle: 'üßá', pancake: 'ü•û', cereal: 'ü•£', oat: 'ü•£'
    };
    for (const [key, emoji] of Object.entries(map)) {
      if (n.includes(key)) return emoji;
    }
    return 'üçΩÔ∏è';
  }

  function openGoalModal() {
    const g = state.goals;
    document.getElementById('modal').innerHTML = `
      <div class="modal-header">
        <div class="modal-title">‚öôÔ∏è Daily Goals</div>
        <button class="modal-close" onclick="app.closeModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <p style="font-size: 13px; color: var(--gray-500); margin-bottom: 16px;">Set your daily nutrition targets to track progress throughout the day.</p>
        <div class="goal-input-row">
          <label>üî• Calories</label>
          <input type="number" id="goalCal" value="${g.calories}" min="0" step="50"> <span>kcal</span>
        </div>
        <div class="goal-input-row">
          <label>ü•© Protein</label>
          <input type="number" id="goalProtein" value="${g.protein}" min="0" step="5"> <span>g</span>
        </div>
        <div class="goal-input-row">
          <label>üçû Carbs</label>
          <input type="number" id="goalCarbs" value="${g.carbs}" min="0" step="5"> <span>g</span>
        </div>
        <div class="goal-input-row">
          <label>ü•ë Fat</label>
          <input type="number" id="goalFat" value="${g.fat}" min="0" step="5"> <span>g</span>
        </div>
        <div style="margin-top: 20px;">
          <button class="btn-primary" onclick="app.saveGoals()">Save Goals</button>
        </div>
      </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
  }

  function saveGoals() {
    state.goals.calories = parseInt(document.getElementById('goalCal').value) || 2000;
    state.goals.protein = parseInt(document.getElementById('goalProtein').value) || 150;
    state.goals.carbs = parseInt(document.getElementById('goalCarbs').value) || 250;
    state.goals.fat = parseInt(document.getElementById('goalFat').value) || 65;
    saveState();
    closeModal();
    renderAll();
    showToast('Goals updated!', 'üéØ');
  }

  function closeModal() {
    document.getElementById('modalOverlay').classList.remove('active');
    currentMealId = null;
  }

  function closeModalOverlay(e) {
    if (e.target === document.getElementById('modalOverlay')) {
      closeModal();
    }
  }

  // ========== TOAST ==========
  function showToast(message, icon = '‚úÖ') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.innerHTML = `<span>${icon}</span> ${message}`;
    container.appendChild(toast);
    setTimeout(() => {
      if (toast.parentNode) toast.parentNode.removeChild(toast);
    }, 3000);
  }

  // ========== INIT ==========
  loadState();

  // Pre-populate sample data if first visit
  const todayKey = new Date().toISOString().split('T')[0];
  if (!state.data[todayKey]) {
    state.data[todayKey] = {
      meals: {
        breakfast: [
          { ...FOOD_DATABASE.find(f => f.name === 'Oatmeal'), id: 1 },
          { ...FOOD_DATABASE.find(f => f.name === 'Banana'), id: 2 },
          { ...FOOD_DATABASE.find(f => f.name === 'Blueberries'), id: 3 }
        ],
        lunch: [
          { ...FOOD_DATABASE.find(f => f.name === 'Chicken Breast'), id: 4 },
          { ...FOOD_DATABASE.find(f => f.name === 'Brown Rice'), id: 5 },
          { ...FOOD_DATABASE.find(f => f.name === 'Broccoli'), id: 6 }
        ],
        dinner: [],
        snack: [
          { ...FOOD_DATABASE.find(f => f.name === 'Apple'), id: 7 },
          { ...FOOD_DATABASE.find(f => f.name === 'Almonds'), id: 8 }
        ]
      },
      water: 5
    };
    saveState();
  }

  renderAll();

  // ========== PUBLIC API ==========
  window.app = {
    changeDate,
    toggleMeal,
    toggleWater,
    removeItem,
    openAddModal,
    filterFoods,
    quickAdd,
    quickAddFromDB,
    addCustomItem,
    openGoalModal,
    saveGoals,
    closeModal,
    closeModalOverlay
  };

  // Keyboard shortcut to close modal
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeModal();
  });
})();
</script>
</body>
</html>
