<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro - Focus Timer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #fafafa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --accent: #ef4444;
            --accent-hover: #dc2626;
            --accent-light: #fee2e2;
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --border: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-lg: rgba(0, 0, 0, 0.15);
            --gradient-start: #f43f5e;
            --gradient-end: #fb923c;
        }

        .dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent: #f43f5e;
            --accent-hover: #fb7185;
            --accent-light: #4c1d2b;
            --success: #34d399;
            --success-light: #064e3b;
            --warning: #fbbf24;
            --warning-light: #78350f;
            --border: #475569;
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-lg: rgba(0, 0, 0, 0.4);
            --gradient-start: #f43f5e;
            --gradient-end: #fb923c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(244, 63, 94, 0.3);
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-controls {
            display: flex;
            gap: 12px;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border: none;
            background: var(--bg-secondary);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-lg);
            color: var(--text-primary);
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Timer Section */
        .timer-section {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 4px 20px var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 40px;
            background: var(--bg-tertiary);
            padding: 6px;
            border-radius: 16px;
        }

        .mode-tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .mode-tab.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .mode-tab:hover:not(.active) {
            color: var(--text-primary);
        }

        /* Timer Ring */
        .timer-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin-bottom: 40px;
        }

        .timer-ring {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .timer-ring-bg {
            fill: none;
            stroke: var(--bg-tertiary);
            stroke-width: 12;
        }

        .timer-ring-progress {
            fill: none;
            stroke: url(#timerGradient);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
            filter: drop-shadow(0 0 10px rgba(244, 63, 94, 0.4));
        }

        .timer-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .timer-time {
            font-size: 72px;
            font-weight: 700;
            letter-spacing: -2px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .timer-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Timer Controls */
        .timer-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .btn {
            padding: 16px 40px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            box-shadow: 0 4px 15px rgba(244, 63, 94, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 63, 94, 0.5);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        /* Session Counter */
        .session-counter {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .session-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            transition: all 0.3s ease;
        }

        .session-dot.completed {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            box-shadow: 0 0 10px rgba(244, 63, 94, 0.5);
        }

        .session-dot.current {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-badge {
            background: var(--accent-light);
            color: var(--accent);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Settings */
        .setting-group {
            margin-bottom: 20px;
        }

        .setting-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .setting-label span {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .setting-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .setting-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--bg-tertiary);
            appearance: none;
            cursor: pointer;
        }

        .setting-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(244, 63, 94, 0.4);
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .toggle-container:last-child {
            border-bottom: none;
        }

        .toggle-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .toggle {
            width: 48px;
            height: 28px;
            background: var(--bg-tertiary);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle.active {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px var(--shadow);
        }

        .toggle.active::after {
            transform: translateX(20px);
        }

        /* Session Log */
        .session-log {
            max-height: 200px;
            overflow-y: auto;
        }

        .session-log::-webkit-scrollbar {
            width: 6px;
        }

        .session-log::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .session-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin-bottom: 8px;
            transition: transform 0.2s ease;
        }

        .session-item:hover {
            transform: translateX(4px);
        }

        .session-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .session-icon.work {
            background: var(--accent-light);
        }

        .session-icon.break {
            background: var(--success-light);
        }

        .session-info {
            flex: 1;
        }

        .session-type {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .session-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        .session-duration {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Chart Card */
        .chart-container {
            height: 180px;
            position: relative;
        }

        .chart-svg {
            width: 100%;
            height: 100%;
        }

        .chart-bar {
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            filter: brightness(1.1);
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding: 0 4px;
        }

        .chart-label {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 3px;
        }

        .legend-dot.work {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }

        .legend-dot.break {
            background: var(--success);
        }

        /* Stats Row */
        .stats-row {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }

        .stat-item {
            flex: 1;
            text-align: center;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Motivational Quote */
        .quote-card {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            text-align: center;
        }

        .quote-text {
            font-size: 16px;
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .quote-author {
            font-size: 13px;
            opacity: 0.8;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 24px;
            text-align: center;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-actions .btn {
            flex: 1;
            justify-content: center;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-secondary);
            padding: 16px 24px;
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-text {
            font-weight: 500;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-in {
            animation: fadeIn 0.5s ease forwards;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .app-container {
                padding: 16px;
            }

            .timer-section {
                padding: 24px;
            }

            .timer-container {
                width: 260px;
                height: 260px;
            }

            .timer-time {
                font-size: 56px;
            }

            .mode-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .mode-tab {
                padding: 10px 18px;
                font-size: 13px;
            }

            .btn {
                padding: 14px 28px;
            }

            .stats-row {
                flex-direction: column;
            }
        }

        /* Focus visible states */
        button:focus-visible,
        input:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header animate-in">
            <div class="logo">
                <div class="logo-icon">üçÖ</div>
                <span class="logo-text">Pomodoro</span>
            </div>
            <div class="header-controls">
                <button class="icon-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                <button class="icon-btn" id="darkModeBtn" title="Toggle Dark Mode">üåô</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-grid">
            <!-- Timer Section -->
            <section class="timer-section animate-in" style="animation-delay: 0.1s">
                <!-- Mode Tabs -->
                <div class="mode-tabs">
                    <button class="mode-tab active" data-mode="work">Focus</button>
                    <button class="mode-tab" data-mode="shortBreak">Short Break</button>
                    <button class="mode-tab" data-mode="longBreak">Long Break</button>
                </div>

                <!-- Timer Ring -->
                <div class="timer-container">
                    <svg class="timer-ring" viewBox="0 0 320 320">
                        <defs>
                            <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#f43f5e"/>
                                <stop offset="100%" style="stop-color:#fb923c"/>
                            </linearGradient>
                        </defs>
                        <circle class="timer-ring-bg" cx="160" cy="160" r="145"/>
                        <circle class="timer-ring-progress" cx="160" cy="160" r="145"
                                stroke-dasharray="911" stroke-dashoffset="0"/>
                    </svg>
                    <div class="timer-display">
                        <div class="timer-time" id="timerDisplay">25:00</div>
                        <div class="timer-label" id="timerLabel">Focus Time</div>
                    </div>
                </div>

                <!-- Timer Controls -->
                <div class="timer-controls">
                    <button class="btn btn-primary" id="startBtn">
                        <span>‚ñ∂</span> Start
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <span>‚Ü∫</span> Reset
                    </button>
                </div>

                <!-- Session Counter -->
                <div class="session-counter" id="sessionCounter">
                    <div class="session-dot"></div>
                    <div class="session-dot"></div>
                    <div class="session-dot"></div>
                    <div class="session-dot"></div>
                </div>
            </section>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Quote Card -->
                <div class="card quote-card animate-in" style="animation-delay: 0.2s">
                    <p class="quote-text" id="quoteText">"The secret of getting ahead is getting started."</p>
                    <p class="quote-author" id="quoteAuthor">‚Äî Mark Twain</p>
                </div>

                <!-- Today's Stats -->
                <div class="card animate-in" style="animation-delay: 0.3s">
                    <div class="card-header">
                        <h3 class="card-title">Today's Progress</h3>
                        <span class="card-badge" id="todayDate">Today</span>
                    </div>
                    <div class="chart-container">
                        <svg class="chart-svg" id="chartSvg" viewBox="0 0 340 140">
                            <!-- Chart will be rendered here -->
                        </svg>
                        <div class="chart-labels" id="chartLabels">
                            <!-- Labels will be rendered here -->
                        </div>
                    </div>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-dot work"></div>
                            <span>Focus</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot break"></div>
                            <span>Break</span>
                        </div>
                    </div>
                    <div class="stats-row">
                        <div class="stat-item">
                            <div class="stat-value" id="totalFocus">0</div>
                            <div class="stat-label">Focus Min</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalSessions">0</div>
                            <div class="stat-label">Sessions</div>
                        </div>
                    </div>
                </div>

                <!-- Session Log -->
                <div class="card animate-in" style="animation-delay: 0.4s">
                    <div class="card-header">
                        <h3 class="card-title">Recent Sessions</h3>
                    </div>
                    <div class="session-log" id="sessionLog">
                        <p style="color: var(--text-muted); font-size: 14px; text-align: center; padding: 20px;">
                            No sessions yet. Start focusing! üí™
                        </p>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <h2 class="modal-title">‚öôÔ∏è Settings</h2>

            <div class="setting-group">
                <div class="setting-label">
                    <span>Focus Duration</span>
                    <span class="setting-value"><span id="workDurationValue">25</span> min</span>
                </div>
                <input type="range" class="setting-slider" id="workDuration"
                       min="1" max="60" value="25">
            </div>

            <div class="setting-group">
                <div class="setting-label">
                    <span>Short Break</span>
                    <span class="setting-value"><span id="shortBreakValue">5</span> min</span>
                </div>
                <input type="range" class="setting-slider" id="shortBreakDuration"
                       min="1" max="30" value="5">
            </div>

            <div class="setting-group">
                <div class="setting-label">
                    <span>Long Break</span>
                    <span class="setting-value"><span id="longBreakValue">15</span> min</span>
                </div>
                <input type="range" class="setting-slider" id="longBreakDuration"
                       min="5" max="60" value="15">
            </div>

            <div class="toggle-container">
                <span class="toggle-label">Auto-start Breaks</span>
                <div class="toggle" id="autoStartBreaks"></div>
            </div>

            <div class="toggle-container">
                <span class="toggle-label">Auto-start Focus</span>
                <div class="toggle" id="autoStartWork"></div>
            </div>

            <div class="toggle-container">
                <span class="toggle-label">Sound Alert</span>
                <div class="toggle active" id="soundEnabled"></div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" id="closeSettings">Cancel</button>
                <button class="btn btn-primary" id="saveSettings">Save</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span class="notification-icon">üéâ</span>
        <span class="notification-text" id="notificationText">Great job!</span>
    </div>

    <script>
        // Pomodoro Timer App
        class PomodoroTimer {
            constructor() {
                // State
                this.state = {
                    mode: 'work', // work, shortBreak, longBreak
                    isRunning: false,
                    timeRemaining: 25 * 60, // in seconds
                    completedSessions: 0,
                    sessions: [],
                    currentSessionStart: null
                };

                // Settings
                this.settings = {
                    workDuration: 25,
                    shortBreakDuration: 5,
                    longBreakDuration: 15,
                    autoStartBreaks: false,
                    autoStartWork: false,
                    soundEnabled: true,
                    darkMode: false
                };

                // Quotes for motivation
                this.quotes = [
                    { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
                    { text: "Focus on being productive instead of busy.", author: "Tim Ferriss" },
                    { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
                    { text: "It's not that I'm so smart, it's just that I stay with problems longer.", author: "Albert Einstein" },
                    { text: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
                    { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
                    { text: "The future depends on what you do today.", author: "Mahatma Gandhi" },
                    { text: "Your time is limited, don't waste it.", author: "Steve Jobs" }
                ];

                this.timer = null;
                this.audioContext = null;

                this.init();
            }

            init() {
                this.loadSettings();
                this.loadSessions();
                this.bindEvents();
                this.updateDisplay();
                this.updateChart();
                this.updateSessionDots();
                this.setRandomQuote();
                this.updateTodayDate();

                // Apply dark mode if saved
                if (this.settings.darkMode) {
                    document.body.classList.add('dark');
                    document.getElementById('darkModeBtn').textContent = '‚òÄÔ∏è';
                }
            }

            bindEvents() {
                // Timer controls
                document.getElementById('startBtn').addEventListener('click', () => this.toggleTimer());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetTimer());

                // Mode tabs
                document.querySelectorAll('.mode-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchMode(e.target.dataset.mode));
                });

                // Settings
                document.getElementById('settingsBtn').addEventListener('click', () => this.openSettings());
                document.getElementById('closeSettings').addEventListener('click', () => this.closeSettings());
                document.getElementById('saveSettings').addEventListener('click', () => this.saveSettings());

                // Settings sliders
                document.getElementById('workDuration').addEventListener('input', (e) => {
                    document.getElementById('workDurationValue').textContent = e.target.value;
                });
                document.getElementById('shortBreakDuration').addEventListener('input', (e) => {
                    document.getElementById('shortBreakValue').textContent = e.target.value;
                });
                document.getElementById('longBreakDuration').addEventListener('input', (e) => {
                    document.getElementById('longBreakValue').textContent = e.target.value;
                });

                // Toggles
                document.querySelectorAll('.toggle').forEach(toggle => {
                    toggle.addEventListener('click', () => toggle.classList.toggle('active'));
                });

                // Dark mode
                document.getElementById('darkModeBtn').addEventListener('click', () => this.toggleDarkMode());

                // Close modal on overlay click
                document.getElementById('settingsModal').addEventListener('click', (e) => {
                    if (e.target.id === 'settingsModal') this.closeSettings();
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && !e.target.matches('input')) {
                        e.preventDefault();
                        this.toggleTimer();
                    }
                    if (e.code === 'KeyR' && !e.target.matches('input')) {
                        this.resetTimer();
                    }
                });
            }

            toggleTimer() {
                if (this.state.isRunning) {
                    this.pauseTimer();
                } else {
                    this.startTimer();
                }
            }

            startTimer() {
                this.state.isRunning = true;
                this.state.currentSessionStart = new Date();

                const startBtn = document.getElementById('startBtn');
                startBtn.innerHTML = '<span>‚è∏</span> Pause';

                this.timer = setInterval(() => {
                    this.state.timeRemaining--;
                    this.updateDisplay();

                    if (this.state.timeRemaining <= 0) {
                        this.completeSession();
                    }
                }, 1000);
            }

            pauseTimer() {
                this.state.isRunning = false;
                clearInterval(this.timer);

                const startBtn = document.getElementById('startBtn');
                startBtn.innerHTML = '<span>‚ñ∂</span> Start';
            }

            resetTimer() {
                this.pauseTimer();
                this.state.timeRemaining = this.getDuration(this.state.mode) * 60;
                this.updateDisplay();
            }

            switchMode(mode) {
                this.pauseTimer();
                this.state.mode = mode;
                this.state.timeRemaining = this.getDuration(mode) * 60;

                // Update active tab
                document.querySelectorAll('.mode-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.mode === mode);
                });

                // Update label
                const labels = {
                    work: 'Focus Time',
                    shortBreak: 'Short Break',
                    longBreak: 'Long Break'
                };
                document.getElementById('timerLabel').textContent = labels[mode];

                this.updateDisplay();
            }

            getDuration(mode) {
                const durations = {
                    work: this.settings.workDuration,
                    shortBreak: this.settings.shortBreakDuration,
                    longBreak: this.settings.longBreakDuration
                };
                return durations[mode];
            }

            completeSession() {
                this.pauseTimer();

                // Play sound
                if (this.settings.soundEnabled) {
                    this.playBeep();
                }

                // Log session
                const session = {
                    type: this.state.mode,
                    duration: this.getDuration(this.state.mode),
                    completedAt: new Date().toISOString(),
                    startedAt: this.state.currentSessionStart.toISOString()
                };
                this.state.sessions.push(session);
                this.saveSessions();
                this.updateSessionLog();
                this.updateChart();

                // Update completed sessions counter
                if (this.state.mode === 'work') {
                    this.state.completedSessions++;
                    this.updateSessionDots();
                    this.showNotification('üéâ Focus session complete! Great work!');
                } else {
                    this.showNotification('‚òï Break over! Ready to focus?');
                }

                // Determine next mode
                let nextMode;
                if (this.state.mode === 'work') {
                    nextMode = this.state.completedSessions % 4 === 0 ? 'longBreak' : 'shortBreak';
                } else {
                    nextMode = 'work';
                }

                this.switchMode(nextMode);

                // Auto-start if enabled
                if ((nextMode === 'work' && this.settings.autoStartWork) ||
                    (nextMode !== 'work' && this.settings.autoStartBreaks)) {
                    setTimeout(() => this.startTimer(), 1000);
                }
            }

            updateDisplay() {
                const minutes = Math.floor(this.state.timeRemaining / 60);
                const seconds = this.state.timeRemaining % 60;
                const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                document.getElementById('timerDisplay').textContent = display;
                document.title = `${display} - Pomodoro`;

                // Update progress ring
                const totalTime = this.getDuration(this.state.mode) * 60;
                const progress = (totalTime - this.state.timeRemaining) / totalTime;
                const circumference = 2 * Math.PI * 145;
                const offset = circumference * (1 - progress);

                const progressRing = document.querySelector('.timer-ring-progress');
                progressRing.style.strokeDashoffset = offset;
            }

            updateSessionDots() {
                const dots = document.querySelectorAll('.session-dot');
                const sessionsInCycle = this.state.completedSessions % 4;

                dots.forEach((dot, index) => {
                    dot.classList.remove('completed', 'current');
                    if (index < sessionsInCycle) {
                        dot.classList.add('completed');
                    }
                    if (index === sessionsInCycle && this.state.mode === 'work') {
                        dot.classList.add('current');
                    }
                });
            }

            updateSessionLog() {
                const logContainer = document.getElementById('sessionLog');
                const todaySessions = this.getTodaySessions();

                if (todaySessions.length === 0) {
                    logContainer.innerHTML = `
                        <p style="color: var(--text-muted); font-size: 14px; text-align: center; padding: 20px;">
                            No sessions yet. Start focusing! üí™
                        </p>
                    `;
                    return;
                }

                const recentSessions = todaySessions.slice(-5).reverse();
                logContainer.innerHTML = recentSessions.map(session => {
                    const time = new Date(session.completedAt).toLocaleTimeString([], {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    const isWork = session.type === 'work';

                    return `
                        <div class="session-item">
                            <div class="session-icon ${isWork ? 'work' : 'break'}">
                                ${isWork ? 'üéØ' : '‚òï'}
                            </div>
                            <div class="session-info">
                                <div class="session-type">${isWork ? 'Focus Session' : 'Break'}</div>
                                <div class="session-time">${time}</div>
                            </div>
                            <div class="session-duration">${session.duration}m</div>
                        </div>
                    `;
                }).join('');

                // Update stats
                const workSessions = todaySessions.filter(s => s.type === 'work');
                const totalFocusMinutes = workSessions.reduce((acc, s) => acc + s.duration, 0);

                document.getElementById('totalFocus').textContent = totalFocusMinutes;
                document.getElementById('totalSessions').textContent = workSessions.length;
            }

            updateChart() {
                const chartSvg = document.getElementById('chartSvg');
                const labelsContainer = document.getElementById('chartLabels');

                // Get last 7 days of data
                const days = [];
                const now = new Date();

                for (let i = 6; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    date.setHours(0, 0, 0, 0);

                    const dayStr = date.toDateString();
                    const daySessions = this.state.sessions.filter(s => {
                        const sessionDate = new Date(s.completedAt);
                        return sessionDate.toDateString() === dayStr;
                    });

                    const workMinutes = daySessions
                        .filter(s => s.type === 'work')
                        .reduce((acc, s) => acc + s.duration, 0);
                    const breakMinutes = daySessions
                        .filter(s => s.type !== 'work')
                        .reduce((acc, s) => acc + s.duration, 0);

                    days.push({
                        label: date.toLocaleDateString('en', { weekday: 'short' }),
                        work: workMinutes,
                        break: breakMinutes
                    });
                }

                // Calculate max for scaling
                const maxMinutes = Math.max(120, ...days.map(d => d.work + d.break));

                // Render bars
                const barWidth = 32;
                const gap = 16;
                const chartHeight = 120;
                const startX = 20;

                let barsHtml = '';
                days.forEach((day, i) => {
                    const x = startX + i * (barWidth + gap);
                    const workHeight = (day.work / maxMinutes) * chartHeight;
                    const breakHeight = (day.break / maxMinutes) * chartHeight;

                    // Work bar
                    barsHtml += `
                        <rect class="chart-bar"
                              x="${x}"
                              y="${chartHeight - workHeight}"
                              width="${barWidth}"
                              height="${workHeight}"
                              rx="4"
                              fill="url(#barGradient)"/>
                    `;

                    // Break bar (stacked)
                    if (breakHeight > 0) {
                        barsHtml += `
                            <rect class="chart-bar"
                                  x="${x}"
                                  y="${chartHeight - workHeight - breakHeight - 2}"
                                  width="${barWidth}"
                                  height="${breakHeight}"
                                  rx="4"
                                  fill="#10b981"/>
                        `;
                    }
                });

                chartSvg.innerHTML = `
                    <defs>
                        <linearGradient id="barGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#f43f5e"/>
                            <stop offset="100%" style="stop-color:#fb923c"/>
                        </linearGradient>
                    </defs>
                    ${barsHtml}
                `;

                // Render labels
                labelsContainer.innerHTML = days.map(d =>
                    `<span class="chart-label">${d.label}</span>`
                ).join('');
            }

            getTodaySessions() {
                const today = new Date().toDateString();
                return this.state.sessions.filter(s => {
                    const sessionDate = new Date(s.completedAt);
                    return sessionDate.toDateString() === today;
                });
            }

            playBeep() {
                try {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }

                    const playTone = (freq, startTime, duration) => {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);

                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';

                        gainNode.gain.setValueAtTime(0.3, startTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);

                        oscillator.start(startTime);
                        oscillator.stop(startTime + duration);
                    };

                    const now = this.audioContext.currentTime;
                    playTone(523.25, now, 0.15); // C5
                    playTone(659.25, now + 0.15, 0.15); // E5
                    playTone(783.99, now + 0.3, 0.3); // G5
                } catch (e) {
                    console.log('Audio not available');
                }
            }

            showNotification(message) {
                const notification = document.getElementById('notification');
                const notificationText = document.getElementById('notificationText');

                notificationText.textContent = message;
                notification.classList.add('show');

                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }

            openSettings() {
                const modal = document.getElementById('settingsModal');

                // Populate current values
                document.getElementById('workDuration').value = this.settings.workDuration;
                document.getElementById('workDurationValue').textContent = this.settings.workDuration;
                document.getElementById('shortBreakDuration').value = this.settings.shortBreakDuration;
                document.getElementById('shortBreakValue').textContent = this.settings.shortBreakDuration;
                document.getElementById('longBreakDuration').value = this.settings.longBreakDuration;
                document.getElementById('longBreakValue').textContent = this.settings.longBreakDuration;

                document.getElementById('autoStartBreaks').classList.toggle('active', this.settings.autoStartBreaks);
                document.getElementById('autoStartWork').classList.toggle('active', this.settings.autoStartWork);
                document.getElementById('soundEnabled').classList.toggle('active', this.settings.soundEnabled);

                modal.classList.add('active');
            }

            closeSettings() {
                document.getElementById('settingsModal').classList.remove('active');
            }

            saveSettings() {
                this.settings.workDuration = parseInt(document.getElementById('workDuration').value);
                this.settings.shortBreakDuration = parseInt(document.getElementById('shortBreakDuration').value);
                this.settings.longBreakDuration = parseInt(document.getElementById('longBreakDuration').value);
                this.settings.autoStartBreaks = document.getElementById('autoStartBreaks').classList.contains('active');
                this.settings.autoStartWork = document.getElementById('autoStartWork').classList.contains('active');
                this.settings.soundEnabled = document.getElementById('soundEnabled').classList.contains('active');

                localStorage.setItem('pomodoroSettings', JSON.stringify(this.settings));

                // Update timer if not running
                if (!this.state.isRunning) {
                    this.state.timeRemaining = this.getDuration(this.state.mode) * 60;
                    this.updateDisplay();
                }

                this.closeSettings();
                this.showNotification('‚úÖ Settings saved!');
            }

            loadSettings() {
                const saved = localStorage.getItem('pomodoroSettings');
                if (saved) {
                    this.settings = { ...this.settings, ...JSON.parse(saved) };
                }
                this.state.timeRemaining = this.settings.workDuration * 60;
            }

            saveSessions() {
                // Keep only last 30 days of sessions
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

                const recentSessions = this.state.sessions.filter(s =>
                    new Date(s.completedAt) > thirtyDaysAgo
                );

                localStorage.setItem('pomodoroSessions', JSON.stringify(recentSessions));
            }

            loadSessions() {
                const saved = localStorage.getItem('pomodoroSessions');
                if (saved) {
                    this.state.sessions = JSON.parse(saved);
                    this.updateSessionLog();
                }
            }

            toggleDarkMode() {
                document.body.classList.toggle('dark');
                this.settings.darkMode = document.body.classList.contains('dark');

                const btn = document.getElementById('darkModeBtn');
                btn.textContent = this.settings.darkMode ? '‚òÄÔ∏è' : 'üåô';

                localStorage.setItem('pomodoroSettings', JSON.stringify(this.settings));
            }

            setRandomQuote() {
                const quote = this.quotes[Math.floor(Math.random() * this.quotes.length)];
                document.getElementById('quoteText').textContent = `"${quote.text}"`;
                document.getElementById('quoteAuthor').textContent = `‚Äî ${quote.author}`;
            }

            updateTodayDate() {
                const today = new Date();
                const options = { month: 'short', day: 'numeric' };
                document.getElementById('todayDate').textContent = today.toLocaleDateString('en', options);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            new PomodoroTimer();
        });
    </script>
</body>
</html>
