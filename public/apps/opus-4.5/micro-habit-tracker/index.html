<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Habit Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        :root {
            --gradient-start: #667eea;
            --gradient-end: #764ba2;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
        }

        .glass {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .habit-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .habit-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .check-btn {
            transition: all 0.2s ease;
        }

        .check-btn:hover {
            transform: scale(1.1);
        }

        .check-btn.checked {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }

        .check-btn.skipped {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
        }

        .streak-badge {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(249, 115, 22, 0.5); }
            50% { box-shadow: 0 0 25px rgba(249, 115, 22, 0.8); }
        }

        .add-btn {
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .motivational-text {
            background: linear-gradient(90deg, #667eea, #764ba2, #f97316, #10b981);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 8s ease infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .day-cell {
            width: 28px;
            height: 28px;
            transition: all 0.2s ease;
        }

        .day-cell:hover {
            transform: scale(1.2);
        }

        .day-cell.completed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .day-cell.skipped {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .day-cell.missed {
            background: rgba(239, 68, 68, 0.3);
            border: 1px dashed rgba(239, 68, 68, 0.5);
        }

        .confetti {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
        }

        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .emoji-btn {
            font-size: 1.5rem;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .emoji-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.1);
        }

        .emoji-btn.selected {
            background: rgba(102, 126, 234, 0.3);
            border: 2px solid rgba(102, 126, 234, 0.5);
        }

        .progress-ring {
            transition: stroke-dashoffset 0.5s ease;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-up {
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-white p-4 md:p-8">
    <div id="app" class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8 fade-in">
            <h1 class="text-3xl md:text-4xl font-bold mb-2">
                <span class="motivational-text">Micro Habit Tracker</span>
            </h1>
            <p class="text-gray-400 text-sm md:text-base" id="motivational-quote">Small steps, big changes</p>
            <div class="mt-4 flex justify-center items-center gap-4">
                <div class="glass rounded-full px-4 py-2 text-sm">
                    <span class="text-gray-400">Today:</span>
                    <span id="today-date" class="font-semibold ml-1"></span>
                </div>
                <div class="glass rounded-full px-4 py-2 text-sm">
                    <span class="text-gray-400">Progress:</span>
                    <span id="today-progress" class="font-semibold text-green-400 ml-1">0/0</span>
                </div>
            </div>
        </header>

        <!-- Daily Progress Ring -->
        <div class="flex justify-center mb-8 fade-in" style="animation-delay: 0.1s;">
            <div class="relative">
                <svg class="w-24 h-24 md:w-32 md:h-32 transform -rotate-90">
                    <circle cx="50%" cy="50%" r="45%" stroke="rgba(255,255,255,0.1)" stroke-width="8" fill="none"/>
                    <circle id="progress-ring" class="progress-ring" cx="50%" cy="50%" r="45%"
                            stroke="url(#gradient)" stroke-width="8" fill="none"
                            stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="283"/>
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#10b981"/>
                            <stop offset="100%" style="stop-color:#059669"/>
                        </linearGradient>
                    </defs>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span id="progress-percent" class="text-2xl md:text-3xl font-bold">0%</span>
                </div>
            </div>
        </div>

        <!-- Habits List -->
        <div id="habits-container" class="space-y-4 mb-6">
            <!-- Habits will be rendered here -->
        </div>

        <!-- Add Habit Button -->
        <div class="flex justify-center mb-8" id="add-habit-container">
            <button id="add-habit-btn" class="add-btn text-white font-semibold py-3 px-8 rounded-full flex items-center gap-2 shadow-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add New Habit
            </button>
        </div>

        <!-- Weekly Chart -->
        <div class="glass rounded-2xl p-4 md:p-6 mb-6 fade-in" style="animation-delay: 0.2s;">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                Weekly Overview
            </h3>
            <div class="h-48 md:h-64">
                <canvas id="weekly-chart"></canvas>
            </div>
        </div>

        <!-- Import/Export -->
        <div class="glass rounded-2xl p-4 md:p-6 fade-in" style="animation-delay: 0.3s;">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                </svg>
                Data Management
            </h3>
            <div class="flex flex-wrap gap-3">
                <button id="export-btn" class="glass-dark hover:bg-white/10 py-2 px-4 rounded-lg text-sm font-medium transition-all flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                    </svg>
                    Export JSON
                </button>
                <label class="glass-dark hover:bg-white/10 py-2 px-4 rounded-lg text-sm font-medium transition-all flex items-center gap-2 cursor-pointer">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    Import JSON
                    <input type="file" id="import-input" accept=".json" class="hidden">
                </label>
                <button id="reset-btn" class="glass-dark hover:bg-red-500/20 py-2 px-4 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-red-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Reset All
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-gray-500 text-xs mt-8 pb-4">
            <p>Build better habits, one day at a time ðŸŒ±</p>
        </footer>
    </div>

    <!-- Add/Edit Habit Modal -->
    <div id="habit-modal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
        <div class="glass rounded-2xl p-6 w-full max-w-md slide-up">
            <h2 id="modal-title" class="text-xl font-bold mb-4">Add New Habit</h2>
            <form id="habit-form" class="space-y-4">
                <input type="hidden" id="habit-id">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Habit Name</label>
                    <input type="text" id="habit-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" placeholder="e.g., Morning meditation" maxlength="30" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Choose an Icon</label>
                    <div class="emoji-picker" id="emoji-picker">
                        <!-- Emojis will be rendered here -->
                    </div>
                    <input type="hidden" id="habit-emoji" value="âœ¨">
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" id="cancel-btn" class="flex-1 glass-dark hover:bg-white/10 py-3 rounded-xl font-medium transition-all">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 add-btn py-3 rounded-xl font-medium">
                        Save Habit
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="delete-modal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
        <div class="glass rounded-2xl p-6 w-full max-w-sm slide-up">
            <h2 class="text-xl font-bold mb-2">Delete Habit?</h2>
            <p class="text-gray-400 mb-6">This action cannot be undone. All history for this habit will be lost.</p>
            <div class="flex gap-3">
                <button id="cancel-delete-btn" class="flex-1 glass-dark hover:bg-white/10 py-3 rounded-xl font-medium transition-all">
                    Cancel
                </button>
                <button id="confirm-delete-btn" class="flex-1 bg-red-500 hover:bg-red-600 py-3 rounded-xl font-medium transition-all">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 glass rounded-full px-6 py-3 hidden z-50 transition-all">
        <span id="toast-message" class="text-sm font-medium"></span>
    </div>

    <script>
        // ===== Constants =====
        const EMOJIS = ['âœ¨', 'ðŸ’ª', 'ðŸ§˜', 'ðŸ“š', 'ðŸ’§', 'ðŸƒ', 'ðŸŽ¯', 'ðŸŒ…', 'ðŸ’¤', 'ðŸ¥—', 'ðŸ§ ', 'ðŸŽ¨', 'âœï¸', 'ðŸŽµ', 'ðŸ‹ï¸', 'ðŸš´', 'ðŸ§¹', 'ðŸ’Š'];
        const MOTIVATIONAL_QUOTES = [
            "Small steps, big changes",
            "Consistency is the key to success",
            "Every day is a fresh start",
            "Progress, not perfection",
            "You're doing amazing!",
            "One habit at a time",
            "The journey of a thousand miles begins with one step",
            "Make today count"
        ];
        const MAX_HABITS = 7;
        const STORAGE_KEY = 'microHabitTracker';

        // ===== State =====
        let habits = [];
        let deleteHabitId = null;
        let weeklyChart = null;

        // ===== Utility Functions =====
        function getToday() {
            return new Date().toISOString().split('T')[0];
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function getDaysAgo(days) {
            const date = new Date();
            date.setDate(date.getDate() - days);
            return date.toISOString().split('T')[0];
        }

        function getLast7Days() {
            return Array.from({ length: 7 }, (_, i) => getDaysAgo(6 - i));
        }

        function calculateStreak(habit) {
            let streak = 0;
            const today = getToday();
            let currentDate = new Date();

            // Check if today is completed or skipped
            const todayEntry = habit.history[today];
            if (todayEntry === 'completed' || todayEntry === 'skipped') {
                streak++;
                currentDate.setDate(currentDate.getDate() - 1);
            }

            // Count backwards
            while (true) {
                const dateStr = currentDate.toISOString().split('T')[0];
                const entry = habit.history[dateStr];
                if (entry === 'completed' || entry === 'skipped') {
                    streak++;
                    currentDate.setDate(currentDate.getDate() - 1);
                } else {
                    break;
                }
            }

            return streak;
        }

        // ===== Storage =====
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(habits));
        }

        function loadData() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                habits = JSON.parse(stored);
            } else {
                // Initialize with demo data
                initDemoData();
            }
        }

        function initDemoData() {
            const demoHabits = [
                { name: 'Morning Meditation', emoji: 'ðŸ§˜' },
                { name: 'Read 20 pages', emoji: 'ðŸ“š' },
                { name: 'Drink 8 glasses water', emoji: 'ðŸ’§' },
                { name: 'Exercise 30 mins', emoji: 'ðŸƒ' }
            ];

            habits = demoHabits.map(h => {
                const habit = {
                    id: generateId(),
                    name: h.name,
                    emoji: h.emoji,
                    history: {},
                    createdAt: getDaysAgo(10)
                };

                // Add some random history for the last 7 days
                for (let i = 1; i <= 7; i++) {
                    const date = getDaysAgo(i);
                    const rand = Math.random();
                    if (rand > 0.3) {
                        habit.history[date] = 'completed';
                    } else if (rand > 0.15) {
                        habit.history[date] = 'skipped';
                    }
                }

                return habit;
            });

            saveData();
        }

        // ===== UI Updates =====
        function updateUI() {
            renderHabits();
            updateProgress();
            updateChart();
            updateAddButton();
            updateMotivationalQuote();
        }

        function updateMotivationalQuote() {
            const quoteEl = document.getElementById('motivational-quote');
            const quote = MOTIVATIONAL_QUOTES[Math.floor(Math.random() * MOTIVATIONAL_QUOTES.length)];
            quoteEl.textContent = quote;
        }

        function updateAddButton() {
            const container = document.getElementById('add-habit-container');
            if (habits.length >= MAX_HABITS) {
                container.innerHTML = `
                    <div class="glass rounded-full px-6 py-3 text-sm text-gray-400">
                        Maximum ${MAX_HABITS} habits reached
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <button id="add-habit-btn" class="add-btn text-white font-semibold py-3 px-8 rounded-full flex items-center gap-2 shadow-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Add New Habit
                    </button>
                `;
                document.getElementById('add-habit-btn').addEventListener('click', () => openModal());
            }
        }

        function updateProgress() {
            const today = getToday();
            document.getElementById('today-date').textContent = formatDate(today);

            const completed = habits.filter(h => h.history[today] === 'completed').length;
            const total = habits.length;
            document.getElementById('today-progress').textContent = `${completed}/${total}`;

            const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('progress-percent').textContent = `${percent}%`;

            // Update progress ring
            const ring = document.getElementById('progress-ring');
            const circumference = 283; // 2 * PI * 45%
            const offset = circumference - (percent / 100) * circumference;
            ring.style.strokeDashoffset = offset;
        }

        function renderHabits() {
            const container = document.getElementById('habits-container');
            const today = getToday();
            const last7Days = getLast7Days();

            if (habits.length === 0) {
                container.innerHTML = `
                    <div class="glass rounded-2xl p-8 text-center">
                        <div class="text-4xl mb-4">ðŸŒ±</div>
                        <h3 class="text-lg font-semibold mb-2">No habits yet</h3>
                        <p class="text-gray-400 text-sm">Start by adding your first micro habit!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = habits.map((habit, index) => {
                const streak = calculateStreak(habit);
                const todayStatus = habit.history[today] || 'pending';

                return `
                    <div class="habit-card glass rounded-2xl p-4 md:p-5 fade-in" style="animation-delay: ${index * 0.05}s;">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <span class="text-2xl md:text-3xl flex-shrink-0">${habit.emoji}</span>
                                <div class="min-w-0">
                                    <h3 class="font-semibold text-base md:text-lg truncate">${habit.name}</h3>
                                    <div class="flex items-center gap-2 mt-1">
                                        ${streak > 0 ? `
                                            <span class="streak-badge text-xs font-bold px-2 py-1 rounded-full">
                                                ðŸ”¥ ${streak} day${streak !== 1 ? 's' : ''}
                                            </span>
                                        ` : `
                                            <span class="text-xs text-gray-500">Start your streak today!</span>
                                        `}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 flex-shrink-0">
                                <button onclick="toggleStatus('${habit.id}', 'completed')"
                                        class="check-btn w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center ${todayStatus === 'completed' ? 'checked' : 'glass-dark hover:bg-white/10'}"
                                        title="Mark as done">
                                    <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/>
                                    </svg>
                                </button>
                                <button onclick="toggleStatus('${habit.id}', 'skipped')"
                                        class="check-btn w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center ${todayStatus === 'skipped' ? 'skipped' : 'glass-dark hover:bg-white/10'}"
                                        title="Skip today">
                                    <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Last 7 days mini calendar -->
                        <div class="mt-4 flex items-center justify-between">
                            <div class="flex gap-1.5">
                                ${last7Days.map(date => {
                                    const status = habit.history[date] || 'missed';
                                    const isToday = date === today;
                                    return `
                                        <div class="day-cell rounded-md ${status === 'pending' ? 'glass-dark' : status} ${isToday ? 'ring-2 ring-white/30' : ''}"
                                             title="${formatDate(date)}${status !== 'pending' ? ': ' + status : ''}">
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            <div class="flex gap-1">
                                <button onclick="openModal('${habit.id}')" class="p-2 hover:bg-white/10 rounded-lg transition-colors" title="Edit">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                    </svg>
                                </button>
                                <button onclick="confirmDelete('${habit.id}')" class="p-2 hover:bg-red-500/20 rounded-lg transition-colors" title="Delete">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateChart() {
            const ctx = document.getElementById('weekly-chart').getContext('2d');
            const last7Days = getLast7Days();

            const data = last7Days.map(date => {
                return habits.filter(h => h.history[date] === 'completed').length;
            });

            const labels = last7Days.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-US', { weekday: 'short' });
            });

            if (weeklyChart) {
                weeklyChart.destroy();
            }

            weeklyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completed',
                        data: data,
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: Math.max(habits.length, 1),
                            ticks: {
                                stepSize: 1,
                                color: 'rgba(255, 255, 255, 0.5)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.5)'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ===== Actions =====
        function toggleStatus(habitId, status) {
            const habit = habits.find(h => h.id === habitId);
            if (!habit) return;

            const today = getToday();
            const currentStatus = habit.history[today];

            if (currentStatus === status) {
                delete habit.history[today];
            } else {
                habit.history[today] = status;
                if (status === 'completed') {
                    celebrateCompletion();
                }
            }

            saveData();
            updateUI();
        }

        function celebrateCompletion() {
            // Simple confetti effect
            const colors = ['#10b981', '#f97316', '#667eea', '#f59e0b'];
            for (let i = 0; i < 20; i++) {
                createConfetti(colors[Math.floor(Math.random() * colors.length)]);
            }
        }

        function createConfetti(color) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.cssText = `
                position: fixed;
                width: 10px;
                height: 10px;
                background: ${color};
                left: ${50 + (Math.random() - 0.5) * 20}%;
                top: 40%;
                border-radius: 50%;
                pointer-events: none;
                z-index: 1000;
            `;
            document.body.appendChild(confetti);

            const animation = confetti.animate([
                { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
                { transform: `translate(${(Math.random() - 0.5) * 200}px, ${Math.random() * 300 + 100}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
            ], {
                duration: 1000 + Math.random() * 500,
                easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
            });

            animation.onfinish = () => confetti.remove();
        }

        function openModal(habitId = null) {
            const modal = document.getElementById('habit-modal');
            const title = document.getElementById('modal-title');
            const nameInput = document.getElementById('habit-name');
            const emojiInput = document.getElementById('habit-emoji');
            const idInput = document.getElementById('habit-id');

            if (habitId) {
                const habit = habits.find(h => h.id === habitId);
                if (!habit) return;
                title.textContent = 'Edit Habit';
                nameInput.value = habit.name;
                emojiInput.value = habit.emoji;
                idInput.value = habit.id;
            } else {
                title.textContent = 'Add New Habit';
                nameInput.value = '';
                emojiInput.value = 'âœ¨';
                idInput.value = '';
            }

            renderEmojiPicker(emojiInput.value);
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            nameInput.focus();
        }

        function closeModal() {
            const modal = document.getElementById('habit-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function renderEmojiPicker(selected) {
            const picker = document.getElementById('emoji-picker');
            picker.innerHTML = EMOJIS.map(emoji => `
                <button type="button" class="emoji-btn ${emoji === selected ? 'selected' : ''}" onclick="selectEmoji('${emoji}')">
                    ${emoji}
                </button>
            `).join('');
        }

        function selectEmoji(emoji) {
            document.getElementById('habit-emoji').value = emoji;
            renderEmojiPicker(emoji);
        }

        function handleFormSubmit(e) {
            e.preventDefault();

            const name = document.getElementById('habit-name').value.trim();
            const emoji = document.getElementById('habit-emoji').value;
            const id = document.getElementById('habit-id').value;

            if (!name) return;

            if (id) {
                // Edit existing
                const habit = habits.find(h => h.id === id);
                if (habit) {
                    habit.name = name;
                    habit.emoji = emoji;
                    showToast('Habit updated!');
                }
            } else {
                // Add new
                if (habits.length >= MAX_HABITS) {
                    showToast('Maximum habits reached!', 'error');
                    return;
                }
                habits.push({
                    id: generateId(),
                    name: name,
                    emoji: emoji,
                    history: {},
                    createdAt: getToday()
                });
                showToast('Habit added!');
            }

            saveData();
            updateUI();
            closeModal();
        }

        function confirmDelete(habitId) {
            deleteHabitId = habitId;
            const modal = document.getElementById('delete-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeDeleteModal() {
            deleteHabitId = null;
            const modal = document.getElementById('delete-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function executeDelete() {
            if (!deleteHabitId) return;
            habits = habits.filter(h => h.id !== deleteHabitId);
            saveData();
            updateUI();
            closeDeleteModal();
            showToast('Habit deleted');
        }

        function exportData() {
            const dataStr = JSON.stringify(habits, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `micro-habits-${getToday()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Data exported!');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const imported = JSON.parse(event.target.result);
                    if (Array.isArray(imported)) {
                        habits = imported.slice(0, MAX_HABITS);
                        saveData();
                        updateUI();
                        showToast('Data imported!');
                    } else {
                        showToast('Invalid file format', 'error');
                    }
                } catch {
                    showToast('Error reading file', 'error');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        function resetAll() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                habits = [];
                localStorage.removeItem(STORAGE_KEY);
                initDemoData();
                updateUI();
                showToast('Data reset to demo');
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            toast.style.background = type === 'error' ? 'rgba(239, 68, 68, 0.9)' : 'rgba(16, 185, 129, 0.9)';

            setTimeout(() => {
                toast.classList.add('hidden');
            }, 2500);
        }

        // ===== Event Listeners =====
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateUI();

            // Form submission
            document.getElementById('habit-form').addEventListener('submit', handleFormSubmit);

            // Modal controls
            document.getElementById('cancel-btn').addEventListener('click', closeModal);
            document.getElementById('cancel-delete-btn').addEventListener('click', closeDeleteModal);
            document.getElementById('confirm-delete-btn').addEventListener('click', executeDelete);

            // Close modal on backdrop click
            document.getElementById('habit-modal').addEventListener('click', (e) => {
                if (e.target.id === 'habit-modal') closeModal();
            });
            document.getElementById('delete-modal').addEventListener('click', (e) => {
                if (e.target.id === 'delete-modal') closeDeleteModal();
            });

            // Import/Export
            document.getElementById('export-btn').addEventListener('click', exportData);
            document.getElementById('import-input').addEventListener('change', importData);
            document.getElementById('reset-btn').addEventListener('click', resetAll);

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    closeDeleteModal();
                }
            });
        });
    </script>
</body>
</html>
