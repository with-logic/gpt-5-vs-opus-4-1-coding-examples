<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equation Solver Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.2.1/math.min.js"></script>
    <style>
        :root {
            --color-bg: #faf9f7;
            --color-paper: #ffffff;
            --color-text: #1a1a1a;
            --color-text-muted: #6b6b6b;
            --color-accent: #2c4a7c;
            --color-accent-light: #e8eef6;
            --color-border: #e0ddd8;
            --color-success: #2d5a3d;
            --color-error: #8b3a3a;
            --font-serif: 'EB Garamond', Georgia, serif;
            --font-mono: 'JetBrains Mono', 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-serif);
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.7;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--color-border);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 500;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--color-text-muted);
            font-style: italic;
        }

        .input-section {
            background: var(--color-paper);
            border: 1px solid var(--color-border);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .input-label {
            display: block;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-text-muted);
            margin-bottom: 0.75rem;
        }

        .input-wrapper {
            display: flex;
            gap: 1rem;
            align-items: stretch;
        }

        .equation-input {
            flex: 1;
            font-family: var(--font-mono);
            font-size: 1.25rem;
            padding: 1rem 1.25rem;
            border: 2px solid var(--color-border);
            background: var(--color-bg);
            transition: border-color 0.2s ease;
        }

        .equation-input:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        .equation-input::placeholder {
            color: #bbb;
        }

        .solve-btn {
            font-family: var(--font-serif);
            font-size: 1rem;
            padding: 1rem 2rem;
            background: var(--color-accent);
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.2s ease;
            letter-spacing: 0.05em;
        }

        .solve-btn:hover {
            background: #1e3a5f;
        }

        .solve-btn:active {
            transform: translateY(1px);
        }

        .examples {
            margin-top: 1.25rem;
            font-size: 0.9rem;
            color: var(--color-text-muted);
        }

        .examples span {
            margin-right: 0.5rem;
        }

        .example-btn {
            font-family: var(--font-mono);
            font-size: 0.85rem;
            background: var(--color-accent-light);
            border: none;
            padding: 0.25rem 0.5rem;
            margin: 0.2rem;
            cursor: pointer;
            color: var(--color-accent);
            transition: all 0.2s ease;
        }

        .example-btn:hover {
            background: var(--color-accent);
            color: white;
        }

        .results-section {
            display: none;
        }

        .results-section.visible {
            display: block;
        }

        .result-card {
            background: var(--color-paper);
            border: 1px solid var(--color-border);
            margin-bottom: 1.5rem;
        }

        .result-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-text-muted);
        }

        .result-body {
            padding: 1.5rem;
        }

        .solution-display {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            color: var(--color-accent);
            text-align: center;
            padding: 1rem;
        }

        .step {
            padding: 1rem 0;
            border-bottom: 1px dashed var(--color-border);
        }

        .step:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .step-number {
            display: inline-block;
            width: 1.75rem;
            height: 1.75rem;
            background: var(--color-accent-light);
            color: var(--color-accent);
            border-radius: 50%;
            text-align: center;
            line-height: 1.75rem;
            font-size: 0.85rem;
            margin-right: 0.75rem;
            font-family: var(--font-mono);
        }

        .step-title {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .step-content {
            font-family: var(--font-mono);
            font-size: 1.1rem;
            background: var(--color-bg);
            padding: 0.75rem 1rem;
            margin-top: 0.5rem;
            margin-left: 2.5rem;
        }

        .step-explanation {
            font-size: 0.95rem;
            color: var(--color-text-muted);
            margin-left: 2.5rem;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .export-section {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .export-btn {
            font-family: var(--font-serif);
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--color-border);
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--color-text-muted);
        }

        .export-btn:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .error-message {
            background: #fdf2f2;
            border: 1px solid #f5c6c6;
            color: var(--color-error);
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: none;
        }

        .error-message.visible {
            display: block;
        }

        .history-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--color-border);
        }

        .history-title {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .history-list {
            list-style: none;
        }

        .history-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .history-item:hover {
            background: var(--color-accent-light);
            margin: 0 -1rem;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .history-equation {
            font-family: var(--font-mono);
            font-size: 0.95rem;
        }

        .history-result {
            color: var(--color-accent);
            font-family: var(--font-mono);
        }

        .empty-history {
            color: var(--color-text-muted);
            font-style: italic;
            text-align: center;
            padding: 2rem;
        }

        .clear-history-btn {
            font-family: var(--font-serif);
            font-size: 0.85rem;
            background: none;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            text-decoration: underline;
            margin-top: 1rem;
        }

        .clear-history-btn:hover {
            color: var(--color-error);
        }

        footer {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--color-border);
            text-align: center;
            color: var(--color-text-muted);
            font-size: 0.9rem;
        }

        .supported-operations {
            margin-top: 2rem;
            font-size: 0.85rem;
            color: var(--color-text-muted);
        }

        .supported-operations h3 {
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .operations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .operation-item {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            background: var(--color-bg);
        }

        @media (max-width: 600px) {
            .container {
                padding: 2rem 1rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .input-wrapper {
                flex-direction: column;
            }

            .equation-input {
                font-size: 1rem;
            }

            .solve-btn {
                width: 100%;
            }

            .solution-display {
                font-size: 1.25rem;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: var(--color-text-muted);
        }

        .loading.visible {
            display: block;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Equation Solver</h1>
            <p class="subtitle">A mathematical tool for solving and understanding equations</p>
        </header>

        <section class="input-section">
            <label class="input-label" for="equation">Enter Your Equation</label>
            <div class="input-wrapper">
                <input
                    type="text"
                    id="equation"
                    class="equation-input"
                    placeholder="e.g., 2x + 5 = 15"
                    autocomplete="off"
                    spellcheck="false"
                >
                <button class="solve-btn" id="solveBtn">Solve</button>
            </div>
            <div class="examples">
                <span>Examples:</span>
                <button class="example-btn" data-eq="2x + 5 = 15">2x + 5 = 15</button>
                <button class="example-btn" data-eq="x^2 - 4 = 0">x² - 4 = 0</button>
                <button class="example-btn" data-eq="3(x - 2) = 12">3(x - 2) = 12</button>
                <button class="example-btn" data-eq="sqrt(x) = 4">√x = 4</button>
                <button class="example-btn" data-eq="2^x = 16">2^x = 16</button>
            </div>
        </section>

        <div class="error-message" id="errorMessage"></div>

        <div class="loading" id="loading">
            <span>Solving<span class="loading-dots"></span></span>
        </div>

        <section class="results-section" id="resultsSection">
            <div class="result-card">
                <div class="result-header">
                    <span class="result-title">Solution</span>
                </div>
                <div class="result-body">
                    <div class="solution-display" id="solutionDisplay"></div>
                </div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-title">Step-by-Step Solution</span>
                </div>
                <div class="result-body" id="stepsContainer"></div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-title">Export Results</span>
                </div>
                <div class="result-body">
                    <div class="export-section">
                        <button class="export-btn" id="exportText">Copy as Text</button>
                        <button class="export-btn" id="exportLatex">Copy as LaTeX</button>
                        <button class="export-btn" id="exportJson">Download JSON</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="history-section" id="historySection">
            <h2 class="history-title">Recent Calculations</h2>
            <ul class="history-list" id="historyList">
                <li class="empty-history">No calculations yet</li>
            </ul>
            <button class="clear-history-btn" id="clearHistory" style="display: none;">Clear history</button>
        </section>

        <footer>
            <div class="supported-operations">
                <h3>Supported Operations</h3>
                <div class="operations-grid">
                    <span class="operation-item">+ − × ÷ (arithmetic)</span>
                    <span class="operation-item">^ (exponents)</span>
                    <span class="operation-item">sqrt() (square root)</span>
                    <span class="operation-item">log(), ln() (logarithms)</span>
                    <span class="operation-item">sin, cos, tan</span>
                    <span class="operation-item">Linear equations</span>
                    <span class="operation-item">Quadratic equations</span>
                    <span class="operation-item">Exponential equations</span>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Equation Solver Application
        (function() {
            'use strict';

            // State
            let currentSolution = null;
            let history = JSON.parse(localStorage.getItem('equationHistory') || '[]');

            // DOM Elements
            const equationInput = document.getElementById('equation');
            const solveBtn = document.getElementById('solveBtn');
            const resultsSection = document.getElementById('resultsSection');
            const solutionDisplay = document.getElementById('solutionDisplay');
            const stepsContainer = document.getElementById('stepsContainer');
            const errorMessage = document.getElementById('errorMessage');
            const loading = document.getElementById('loading');
            const historyList = document.getElementById('historyList');
            const clearHistoryBtn = document.getElementById('clearHistory');
            const exportTextBtn = document.getElementById('exportText');
            const exportLatexBtn = document.getElementById('exportLatex');
            const exportJsonBtn = document.getElementById('exportJson');
            const exampleBtns = document.querySelectorAll('.example-btn');

            // Initialize
            function init() {
                renderHistory();
                bindEvents();
            }

            function bindEvents() {
                solveBtn.addEventListener('click', handleSolve);
                equationInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleSolve();
                });
                exampleBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        equationInput.value = btn.dataset.eq;
                        handleSolve();
                    });
                });
                clearHistoryBtn.addEventListener('click', clearHistory);
                exportTextBtn.addEventListener('click', exportAsText);
                exportLatexBtn.addEventListener('click', exportAsLatex);
                exportJsonBtn.addEventListener('click', exportAsJson);
            }

            function handleSolve() {
                const equation = equationInput.value.trim();
                if (!equation) {
                    showError('Please enter an equation to solve.');
                    return;
                }

                hideError();
                hideResults();
                showLoading();

                // Simulate brief processing time for UX
                setTimeout(() => {
                    try {
                        const solution = solveEquation(equation);
                        currentSolution = solution;
                        displaySolution(solution);
                        addToHistory(equation, solution);
                        hideLoading();
                        showResults();
                    } catch (error) {
                        hideLoading();
                        showError(error.message || 'Unable to solve this equation. Please check the syntax.');
                    }
                }, 300);
            }

            function solveEquation(equation) {
                // Normalize the equation
                let normalized = equation
                    .replace(/×/g, '*')
                    .replace(/÷/g, '/')
                    .replace(/√/g, 'sqrt')
                    .replace(/²/g, '^2')
                    .replace(/³/g, '^3')
                    .replace(/\s+/g, '');

                // Detect equation type and solve
                if (normalized.includes('=')) {
                    return solveEquality(normalized);
                } else {
                    return evaluateExpression(normalized);
                }
            }

            function solveEquality(equation) {
                const [left, right] = equation.split('=');
                if (!left || !right) {
                    throw new Error('Invalid equation format.');
                }

                const steps = [];
                const variable = detectVariable(equation);

                if (!variable) {
                    // No variable - just evaluate both sides
                    const leftVal = math.evaluate(left);
                    const rightVal = math.evaluate(right);
                    return {
                        original: equation,
                        type: 'verification',
                        solution: leftVal === rightVal ? 'True' : 'False',
                        steps: [{
                            title: 'Evaluate both sides',
                            content: `${left} = ${leftVal}, ${right} = ${rightVal}`,
                            explanation: leftVal === rightVal ? 'Both sides are equal.' : 'The sides are not equal.'
                        }]
                    };
                }

                // Check for quadratic equation
                if (equation.includes('^2') || equation.includes('²')) {
                    return solveQuadratic(equation, variable);
                }

                // Check for exponential equation (like 2^x = 16)
                const expMatch = equation.match(new RegExp(`(\\d+)\\^${variable}\\s*=\\s*(\\d+)`));
                if (expMatch) {
                    return solveExponential(equation, variable, parseFloat(expMatch[1]), parseFloat(expMatch[2]));
                }

                // Check for sqrt equation
                if (equation.includes('sqrt')) {
                    return solveSqrt(equation, variable);
                }

                // Linear equation
                return solveLinear(equation, variable);
            }

            function detectVariable(equation) {
                const variables = ['x', 'y', 'z', 'n', 'm', 't', 'a', 'b'];
                for (const v of variables) {
                    if (equation.includes(v) && !/[a-zA-Z]/.test(equation.replace(new RegExp(v, 'g'), '').replace(/sqrt|log|ln|sin|cos|tan/g, ''))) {
                        return v;
                    }
                }
                // Default fallback
                const match = equation.match(/[a-zA-Z]/);
                if (match && !['s', 'q', 'r', 't', 'l', 'o', 'g', 'n', 'i', 'c', 'a'].includes(match[0])) {
                    return match[0];
                }
                return equation.match(/[xyz]/)?.[0] || null;
            }

            function solveLinear(equation, variable) {
                const steps = [];
                const [left, right] = equation.split('=');

                steps.push({
                    title: 'Original equation',
                    content: `${left} = ${right}`,
                    explanation: 'Start with the given equation.'
                });

                // Move everything to left side
                const combined = `(${left}) - (${right})`;
                steps.push({
                    title: 'Rearrange to standard form',
                    content: `${combined} = 0`,
                    explanation: 'Move all terms to one side by subtracting the right side from both sides.'
                });

                // Expand and simplify
                let expanded;
                try {
                    expanded = math.simplify(combined, {}, { exactFractions: false });
                } catch {
                    expanded = math.parse(combined);
                }

                steps.push({
                    title: 'Simplify',
                    content: `${expanded.toString()} = 0`,
                    explanation: 'Combine like terms and simplify the expression.'
                });

                // Solve for variable
                let solution;
                try {
                    // Try to solve algebraically
                    const expr = expanded.toString();

                    // Extract coefficient and constant
                    // Parse: ax + b = 0 => x = -b/a
                    const scope = {};
                    scope[variable] = 0;
                    const atZero = math.evaluate(expr, scope);
                    scope[variable] = 1;
                    const atOne = math.evaluate(expr, scope);
                    const coefficient = atOne - atZero;
                    const constant = atZero;

                    if (Math.abs(coefficient) < 1e-10) {
                        throw new Error('This equation has no solution or infinite solutions.');
                    }

                    solution = -constant / coefficient;

                    steps.push({
                        title: 'Isolate the variable',
                        content: `${variable} = ${formatNumber(solution)}`,
                        explanation: `Divide both sides to solve for ${variable}.`
                    });
                } catch (e) {
                    throw new Error('Unable to solve this linear equation.');
                }

                // Verify
                const scope = {};
                scope[variable] = solution;
                const leftVal = math.evaluate(left.replace(/(\d)([a-z])/gi, '$1*$2'), scope);
                const rightVal = math.evaluate(right.replace(/(\d)([a-z])/gi, '$1*$2'), scope);

                steps.push({
                    title: 'Verify solution',
                    content: `${formatNumber(leftVal)} = ${formatNumber(rightVal)} ✓`,
                    explanation: `Substituting ${variable} = ${formatNumber(solution)} confirms the solution.`
                });

                return {
                    original: equation,
                    type: 'linear',
                    variable: variable,
                    solution: `${variable} = ${formatNumber(solution)}`,
                    numericValue: solution,
                    steps: steps
                };
            }

            function solveQuadratic(equation, variable) {
                const steps = [];
                const [left, right] = equation.split('=');

                steps.push({
                    title: 'Original equation',
                    content: `${left} = ${right}`,
                    explanation: 'Start with the given quadratic equation.'
                });

                // Move to standard form ax² + bx + c = 0
                const combined = `(${left}) - (${right})`;

                // Get coefficients
                const scope = {};
                scope[variable] = 0;
                const c = math.evaluate(combined.replace(/(\d)([a-z])/gi, '$1*$2').replace(/\^2/g, '^2'), scope);
                scope[variable] = 1;
                const apc1 = math.evaluate(combined.replace(/(\d)([a-z])/gi, '$1*$2').replace(/\^2/g, '^2'), scope);
                scope[variable] = -1;
                const amc1 = math.evaluate(combined.replace(/(\d)([a-z])/gi, '$1*$2').replace(/\^2/g, '^2'), scope);

                const a = (apc1 + amc1 - 2*c) / 2;
                const b = (apc1 - amc1) / 2;

                steps.push({
                    title: 'Convert to standard form',
                    content: `${formatCoef(a)}${variable}² ${formatTerm(b, variable)} ${formatConstant(c)} = 0`,
                    explanation: 'Rearrange to the form ax² + bx + c = 0.'
                });

                // Calculate discriminant
                const discriminant = b*b - 4*a*c;

                steps.push({
                    title: 'Calculate discriminant',
                    content: `Δ = b² - 4ac = ${formatNumber(b)}² - 4(${formatNumber(a)})(${formatNumber(c)}) = ${formatNumber(discriminant)}`,
                    explanation: discriminant > 0 ? 'Positive discriminant means two real solutions.' :
                                discriminant === 0 ? 'Zero discriminant means one repeated solution.' :
                                'Negative discriminant means two complex solutions.'
                });

                let solutions = [];
                if (discriminant >= 0) {
                    const sqrtD = Math.sqrt(discriminant);
                    const x1 = (-b + sqrtD) / (2*a);
                    const x2 = (-b - sqrtD) / (2*a);

                    steps.push({
                        title: 'Apply quadratic formula',
                        content: `${variable} = (-b ± √Δ) / 2a = (${formatNumber(-b)} ± ${formatNumber(sqrtD)}) / ${formatNumber(2*a)}`,
                        explanation: 'Use the quadratic formula to find the solutions.'
                    });

                    if (discriminant === 0) {
                        solutions = [x1];
                        steps.push({
                            title: 'Solution',
                            content: `${variable} = ${formatNumber(x1)}`,
                            explanation: 'The equation has one repeated root.'
                        });
                    } else {
                        solutions = [x1, x2];
                        steps.push({
                            title: 'Solutions',
                            content: `${variable}₁ = ${formatNumber(x1)}, ${variable}₂ = ${formatNumber(x2)}`,
                            explanation: 'The equation has two distinct real roots.'
                        });
                    }
                } else {
                    const realPart = -b / (2*a);
                    const imagPart = Math.sqrt(-discriminant) / (2*a);
                    solutions = [`${formatNumber(realPart)} + ${formatNumber(imagPart)}i`, `${formatNumber(realPart)} - ${formatNumber(imagPart)}i`];

                    steps.push({
                        title: 'Complex solutions',
                        content: `${variable} = ${solutions[0]}, ${variable} = ${solutions[1]}`,
                        explanation: 'The equation has two complex conjugate roots.'
                    });
                }

                const solutionStr = solutions.length === 1
                    ? `${variable} = ${formatNumber(solutions[0])}`
                    : `${variable} = ${typeof solutions[0] === 'number' ? formatNumber(solutions[0]) : solutions[0]} or ${variable} = ${typeof solutions[1] === 'number' ? formatNumber(solutions[1]) : solutions[1]}`;

                return {
                    original: equation,
                    type: 'quadratic',
                    variable: variable,
                    solution: solutionStr,
                    numericValues: solutions,
                    coefficients: { a, b, c },
                    discriminant: discriminant,
                    steps: steps
                };
            }

            function solveExponential(equation, variable, base, result) {
                const steps = [];

                steps.push({
                    title: 'Original equation',
                    content: equation,
                    explanation: 'Start with the exponential equation.'
                });

                steps.push({
                    title: 'Take logarithm of both sides',
                    content: `log(${base}^${variable}) = log(${result})`,
                    explanation: 'Apply logarithm to both sides to bring down the exponent.'
                });

                const solution = Math.log(result) / Math.log(base);

                steps.push({
                    title: 'Apply logarithm property',
                    content: `${variable} · log(${base}) = log(${result})`,
                    explanation: 'Use the property log(a^n) = n·log(a).'
                });

                steps.push({
                    title: 'Solve for variable',
                    content: `${variable} = log(${result}) / log(${base}) = ${formatNumber(solution)}`,
                    explanation: 'Divide both sides by log(' + base + ').'
                });

                // Verify
                const check = Math.pow(base, solution);
                steps.push({
                    title: 'Verify solution',
                    content: `${base}^${formatNumber(solution)} = ${formatNumber(check)} ≈ ${result} ✓`,
                    explanation: 'Substituting confirms the solution.'
                });

                return {
                    original: equation,
                    type: 'exponential',
                    variable: variable,
                    solution: `${variable} = ${formatNumber(solution)}`,
                    numericValue: solution,
                    steps: steps
                };
            }

            function solveSqrt(equation, variable) {
                const steps = [];
                const [left, right] = equation.split('=');

                steps.push({
                    title: 'Original equation',
                    content: `${left} = ${right}`,
                    explanation: 'Start with the radical equation.'
                });

                // Simple case: sqrt(x) = n
                const sqrtMatch = left.match(/sqrt\(([^)]+)\)/);
                if (sqrtMatch) {
                    const inner = sqrtMatch[1];
                    const rightVal = math.evaluate(right);

                    steps.push({
                        title: 'Square both sides',
                        content: `(${left})² = (${right})²`,
                        explanation: 'Eliminate the square root by squaring both sides.'
                    });

                    const squared = rightVal * rightVal;
                    steps.push({
                        title: 'Simplify',
                        content: `${inner} = ${formatNumber(squared)}`,
                        explanation: 'The square root and square cancel out.'
                    });

                    // If inner is just the variable
                    if (inner === variable) {
                        steps.push({
                            title: 'Verify solution',
                            content: `√${formatNumber(squared)} = ${formatNumber(rightVal)} ✓`,
                            explanation: 'Check that the solution is valid (not extraneous).'
                        });

                        return {
                            original: equation,
                            type: 'radical',
                            variable: variable,
                            solution: `${variable} = ${formatNumber(squared)}`,
                            numericValue: squared,
                            steps: steps
                        };
                    }
                }

                throw new Error('Unable to solve this radical equation.');
            }

            function evaluateExpression(expression) {
                const steps = [];

                steps.push({
                    title: 'Original expression',
                    content: expression,
                    explanation: 'Evaluate the mathematical expression.'
                });

                const result = math.evaluate(expression);

                steps.push({
                    title: 'Result',
                    content: formatNumber(result),
                    explanation: 'The evaluated result.'
                });

                return {
                    original: expression,
                    type: 'expression',
                    solution: formatNumber(result),
                    numericValue: result,
                    steps: steps
                };
            }

            function formatNumber(num) {
                if (typeof num !== 'number') return num;
                if (Number.isInteger(num)) return num.toString();
                if (Math.abs(num - Math.round(num)) < 1e-10) return Math.round(num).toString();
                return parseFloat(num.toPrecision(10)).toString();
            }

            function formatCoef(n) {
                if (n === 1) return '';
                if (n === -1) return '-';
                return formatNumber(n);
            }

            function formatTerm(coef, variable) {
                if (coef === 0) return '';
                const sign = coef > 0 ? '+' : '-';
                const absCoef = Math.abs(coef);
                const coefStr = absCoef === 1 ? '' : formatNumber(absCoef);
                return ` ${sign} ${coefStr}${variable}`;
            }

            function formatConstant(c) {
                if (c === 0) return '';
                const sign = c > 0 ? '+' : '-';
                return ` ${sign} ${formatNumber(Math.abs(c))}`;
            }

            function displaySolution(solution) {
                solutionDisplay.textContent = solution.solution;

                stepsContainer.innerHTML = '';
                solution.steps.forEach((step, index) => {
                    const stepEl = document.createElement('div');
                    stepEl.className = 'step';
                    stepEl.innerHTML = `
                        <div class="step-title">
                            <span class="step-number">${index + 1}</span>
                            ${step.title}
                        </div>
                        <div class="step-content">${step.content}</div>
                        <div class="step-explanation">${step.explanation}</div>
                    `;
                    stepsContainer.appendChild(stepEl);
                });
            }

            function addToHistory(equation, solution) {
                history.unshift({
                    equation: equation,
                    result: solution.solution,
                    timestamp: Date.now()
                });

                // Keep only last 10 items
                if (history.length > 10) {
                    history = history.slice(0, 10);
                }

                localStorage.setItem('equationHistory', JSON.stringify(history));
                renderHistory();
            }

            function renderHistory() {
                if (history.length === 0) {
                    historyList.innerHTML = '<li class="empty-history">No calculations yet</li>';
                    clearHistoryBtn.style.display = 'none';
                    return;
                }

                historyList.innerHTML = history.map(item => `
                    <li class="history-item" data-equation="${escapeHtml(item.equation)}">
                        <span class="history-equation">${escapeHtml(item.equation)}</span>
                        <span class="history-result">${escapeHtml(item.result)}</span>
                    </li>
                `).join('');

                clearHistoryBtn.style.display = 'block';

                // Add click handlers
                document.querySelectorAll('.history-item').forEach(item => {
                    item.addEventListener('click', () => {
                        equationInput.value = item.dataset.equation;
                        handleSolve();
                    });
                });
            }

            function clearHistory() {
                history = [];
                localStorage.removeItem('equationHistory');
                renderHistory();
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            function exportAsText() {
                if (!currentSolution) return;

                let text = `EQUATION SOLVER - RESULTS\n`;
                text += `${'='.repeat(40)}\n\n`;
                text += `Original: ${currentSolution.original}\n`;
                text += `Solution: ${currentSolution.solution}\n\n`;
                text += `STEP-BY-STEP SOLUTION\n`;
                text += `${'-'.repeat(40)}\n\n`;

                currentSolution.steps.forEach((step, i) => {
                    text += `Step ${i + 1}: ${step.title}\n`;
                    text += `  ${step.content}\n`;
                    text += `  → ${step.explanation}\n\n`;
                });

                copyToClipboard(text);
            }

            function exportAsLatex() {
                if (!currentSolution) return;

                let latex = `\\documentclass{article}\n\\usepackage{amsmath}\n\\begin{document}\n\n`;
                latex += `\\section*{Equation Solution}\n\n`;
                latex += `\\textbf{Original equation:} $${currentSolution.original.replace(/\*/g, ' \\cdot ')}$\n\n`;
                latex += `\\textbf{Solution:} $${currentSolution.solution.replace(/\*/g, ' \\cdot ')}$\n\n`;
                latex += `\\subsection*{Steps}\n`;
                latex += `\\begin{enumerate}\n`;

                currentSolution.steps.forEach(step => {
                    latex += `\\item \\textbf{${step.title}}\n`;
                    latex += `$$${step.content.replace(/\*/g, ' \\cdot ')}$$\n`;
                    latex += `\\textit{${step.explanation}}\n`;
                });

                latex += `\\end{enumerate}\n\n\\end{document}`;

                copyToClipboard(latex);
            }

            function exportAsJson() {
                if (!currentSolution) return;

                const json = JSON.stringify(currentSolution, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `equation-solution-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    // Brief visual feedback
                    const btn = event.target;
                    const originalText = btn.textContent;
                    btn.textContent = 'Copied!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                    }, 1500);
                }).catch(() => {
                    // Fallback
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                });
            }

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.add('visible');
            }

            function hideError() {
                errorMessage.classList.remove('visible');
            }

            function showResults() {
                resultsSection.classList.add('visible');
            }

            function hideResults() {
                resultsSection.classList.remove('visible');
            }

            function showLoading() {
                loading.classList.add('visible');
            }

            function hideLoading() {
                loading.classList.remove('visible');
            }

            // Initialize on DOM ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>
