<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tea Dunkability Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a2332;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --text-primary: #f0f4f8;
            --text-secondary: #8899a6;
            --accent-tea: #d4a574;
            --accent-warm: #e8a87c;
            --accent-danger: #e74c3c;
            --accent-success: #27ae60;
            --accent-warning: #f39c12;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            background-image:
                radial-gradient(ellipse at 20% 20%, rgba(212, 165, 116, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(232, 168, 124, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(139, 90, 43, 0.04) 0%, transparent 70%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-tea), var(--accent-warm));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 40px rgba(212, 165, 116, 0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .keyboard-hint {
            display: inline-flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .key-hint {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .key-hint kbd {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-family: monospace;
            margin-right: 0.25rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            gap: 2rem;
            align-items: start;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--glass-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--accent-tea);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group {
            margin-bottom: 1.5rem;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .control-label span:first-child {
            color: var(--text-primary);
            font-weight: 500;
        }

        .control-value {
            color: var(--accent-tea);
            font-weight: 600;
            background: rgba(212, 165, 116, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
        }

        .slider-container {
            position: relative;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: visible;
        }

        .slider-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            border-radius: 4px;
            transition: width 0.1s ease;
        }

        .slider-fill.temp {
            background: linear-gradient(90deg, #3498db, #e74c3c);
        }

        .slider-fill.time {
            background: linear-gradient(90deg, var(--accent-tea), var(--accent-warm));
        }

        .slider-fill.integrity {
            background: linear-gradient(90deg, var(--accent-danger), var(--accent-success));
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: transparent;
            cursor: pointer;
            position: relative;
            z-index: 2;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            border: none;
        }

        .biscuit-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .biscuit-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .biscuit-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .biscuit-option.selected {
            border-color: var(--accent-tea);
            background: rgba(212, 165, 116, 0.15);
        }

        .biscuit-emoji {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .biscuit-name {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .biscuit-rating {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* Teacup Animation Container */
        .teacup-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .teacup-scene {
            position: relative;
            width: 280px;
            height: 300px;
        }

        /* Teacup */
        .teacup {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 140px;
        }

        .cup-body {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 100px;
            background: linear-gradient(180deg, #f5f5f5 0%, #e0e0e0 100%);
            border-radius: 0 0 80px 80px;
            box-shadow:
                inset -10px 0 20px rgba(0, 0, 0, 0.1),
                0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .tea-liquid {
            position: absolute;
            bottom: 5px;
            left: 5px;
            right: 5px;
            height: 80px;
            background: linear-gradient(180deg,
                rgba(139, 90, 43, 0.9) 0%,
                rgba(101, 67, 33, 0.95) 100%);
            border-radius: 0 0 75px 75px;
            animation: teaWave 3s ease-in-out infinite;
        }

        @keyframes teaWave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .tea-surface {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(180deg,
                rgba(180, 120, 60, 0.8) 0%,
                rgba(139, 90, 43, 0.9) 100%);
            border-radius: 50%;
            transform: scaleY(0.3);
        }

        .cup-handle {
            position: absolute;
            right: -25px;
            top: 20px;
            width: 40px;
            height: 60px;
            border: 8px solid #e0e0e0;
            border-left: none;
            border-radius: 0 30px 30px 0;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);
        }

        .cup-rim {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 170px;
            height: 16px;
            background: linear-gradient(180deg, #ffffff 0%, #e8e8e8 100%);
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .saucer {
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 220px;
            height: 25px;
            background: linear-gradient(180deg, #f0f0f0 0%, #d0d0d0 100%);
            border-radius: 50%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        /* Steam */
        .steam-container {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 80px;
            pointer-events: none;
        }

        .steam {
            position: absolute;
            bottom: 0;
            width: 8px;
            height: 60px;
            background: linear-gradient(to top,
                rgba(255, 255, 255, 0.4),
                rgba(255, 255, 255, 0));
            border-radius: 50%;
            filter: blur(3px);
            animation: steamRise 2s ease-out infinite;
        }

        .steam:nth-child(1) { left: 25%; animation-delay: 0s; }
        .steam:nth-child(2) { left: 50%; animation-delay: 0.3s; }
        .steam:nth-child(3) { left: 75%; animation-delay: 0.6s; }

        @keyframes steamRise {
            0% {
                opacity: 0;
                transform: translateY(0) scaleX(1);
            }
            20% {
                opacity: 0.6;
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scaleX(2) translateX(10px);
            }
        }

        /* Biscuit */
        .biscuit {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            transition: top 0.5s ease-in-out;
            z-index: 10;
        }

        .biscuit.dunking {
            animation: dunkBiscuit 2s ease-in-out infinite;
        }

        @keyframes dunkBiscuit {
            0%, 100% { top: 20px; }
            30%, 70% { top: 90px; }
        }

        .biscuit-body {
            width: 60px;
            height: 70px;
            background: linear-gradient(180deg, #d4a574 0%, #b8956a 50%, #a07d5a 100%);
            border-radius: 8px;
            position: relative;
            box-shadow:
                inset 2px 2px 5px rgba(255, 255, 255, 0.3),
                inset -2px -2px 5px rgba(0, 0, 0, 0.2),
                3px 3px 10px rgba(0, 0, 0, 0.3);
        }

        .biscuit-body::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 50px;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 8px,
                rgba(0, 0, 0, 0.1) 8px,
                rgba(0, 0, 0, 0.1) 10px
            );
            border-radius: 4px;
        }

        .biscuit-chocolate {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(180deg, #5d4037 0%, #3e2723 100%);
            border-radius: 0 0 8px 8px;
        }

        .biscuit-soggy {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(101, 67, 33, 0.6);
            border-radius: 0 0 8px 8px;
            transition: height 0.3s ease;
        }

        /* Crumbs */
        .crumbs-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .crumb {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--accent-tea);
            border-radius: 50%;
            opacity: 0;
            animation: crumbFall 1.5s ease-in forwards;
        }

        @keyframes crumbFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(200px) rotate(720deg);
            }
        }

        /* Status Display */
        .status-display {
            text-align: center;
            margin-top: 1.5rem;
        }

        .status-text {
            font-size: 1.1rem;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 30px;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .status-perfect {
            background: rgba(39, 174, 96, 0.2);
            color: var(--accent-success);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }

        .status-warning {
            background: rgba(243, 156, 18, 0.2);
            color: var(--accent-warning);
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .status-danger {
            background: rgba(231, 76, 60, 0.2);
            color: var(--accent-danger);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        /* Crumble-O-Meter */
        .crumble-meter {
            margin-top: 1.5rem;
        }

        .meter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .meter-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .meter-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-tea);
        }

        .meter-bar {
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease, background 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .meter-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.2) 50%,
                transparent 100%
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .meter-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Graph */
        .graph-container {
            margin-top: 1.5rem;
        }

        .graph-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .graph {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 1rem;
            height: 200px;
            position: relative;
        }

        .graph-svg {
            width: 100%;
            height: 100%;
        }

        .graph-line {
            fill: none;
            stroke: var(--accent-tea);
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .graph-area {
            fill: url(#graphGradient);
        }

        .graph-grid-line {
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 1;
        }

        .graph-label {
            fill: var(--text-secondary);
            font-size: 10px;
        }

        .graph-dot {
            fill: var(--accent-tea);
            stroke: white;
            stroke-width: 2;
        }

        /* Dunk Button */
        .dunk-button {
            width: 100%;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent-tea), var(--accent-warm));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 1rem;
            box-shadow: 0 4px 15px rgba(212, 165, 116, 0.3);
        }

        .dunk-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 165, 116, 0.4);
        }

        .dunk-button:active {
            transform: translateY(0);
        }

        .dunk-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Stats Panel */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-tea);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* Reset Button */
        .reset-button {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            margin-top: 1rem;
            width: 100%;
        }

        .reset-button:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .biscuit-selector {
                grid-template-columns: repeat(2, 1fr);
            }

            .teacup-scene {
                transform: scale(0.8);
            }
        }

        /* Animation for component mount */
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // Biscuit data
        const BISCUITS = [
            { id: 'digestive', name: 'Digestive', emoji: 'üç™', baseIntegrity: 70, dunkability: 8 },
            { id: 'hobnob', name: 'Hobnob', emoji: 'ü•Æ', baseIntegrity: 85, dunkability: 9 },
            { id: 'bourbon', name: 'Bourbon', emoji: 'üü´', baseIntegrity: 55, dunkability: 6 },
            { id: 'custard', name: 'Custard Cream', emoji: 'üç¨', baseIntegrity: 45, dunkability: 5 },
            { id: 'rich-tea', name: 'Rich Tea', emoji: 'ü´ì', baseIntegrity: 30, dunkability: 3 },
            { id: 'ginger', name: 'Ginger Nut', emoji: 'üß°', baseIntegrity: 90, dunkability: 7 },
        ];

        // Calculate crumble risk
        const calculateCrumbleRisk = (temp, dunkTime, biscuit, integrity) => {
            const tempFactor = (temp - 40) / 60; // 0 at 40¬∞C, 1 at 100¬∞C
            const timeFactor = dunkTime / 10; // 0-1 based on dunk time
            const biscuitFactor = 1 - (biscuit.baseIntegrity / 100);
            const integrityFactor = 1 - (integrity / 100);

            const risk = (tempFactor * 0.3 + timeFactor * 0.4 + biscuitFactor * 0.15 + integrityFactor * 0.15) * 100;
            return Math.min(100, Math.max(0, risk));
        };

        // Get status based on crumble risk
        const getStatus = (risk) => {
            if (risk < 30) return { text: '‚ú® Perfect Dunk!', class: 'status-perfect' };
            if (risk < 60) return { text: '‚ö†Ô∏è Getting Risky...', class: 'status-warning' };
            return { text: 'üö® Catastrophic Failure Imminent!', class: 'status-danger' };
        };

        // Crumb component
        const Crumb = ({ x, delay }) => {
            return (
                <div
                    className="crumb"
                    style={{
                        left: `${x}%`,
                        top: '100px',
                        animationDelay: `${delay}ms`,
                        width: `${4 + Math.random() * 4}px`,
                        height: `${4 + Math.random() * 4}px`,
                    }}
                />
            );
        };

        // Steam component
        const Steam = ({ intensity }) => {
            const steamCount = Math.ceil(intensity / 30);
            return (
                <div className="steam-container" style={{ opacity: intensity / 100 }}>
                    {[...Array(steamCount)].map((_, i) => (
                        <div key={i} className="steam" style={{
                            left: `${20 + (i * 30)}%`,
                            animationDelay: `${i * 0.2}s`,
                            height: `${40 + intensity * 0.4}px`
                        }} />
                    ))}
                </div>
            );
        };

        // Teacup component
        const Teacup = ({ temp }) => {
            const steamIntensity = Math.max(0, (temp - 50) * 2);

            return (
                <div className="teacup">
                    <Steam intensity={steamIntensity} />
                    <div className="cup-rim"></div>
                    <div className="cup-body">
                        <div className="tea-liquid">
                            <div className="tea-surface"></div>
                        </div>
                    </div>
                    <div className="cup-handle"></div>
                    <div className="saucer"></div>
                </div>
            );
        };

        // Biscuit visual component
        const BiscuitVisual = ({ biscuit, soggyLevel, isDunking }) => {
            const hasChocolate = biscuit.id === 'bourbon' || biscuit.id === 'digestive';

            return (
                <div className={`biscuit ${isDunking ? 'dunking' : ''}`}>
                    <div className="biscuit-body">
                        {hasChocolate && <div className="biscuit-chocolate"></div>}
                        <div className="biscuit-soggy" style={{ height: `${soggyLevel}%` }}></div>
                    </div>
                </div>
            );
        };

        // Graph component
        const CrumbleGraph = ({ history }) => {
            const maxPoints = 20;
            const displayHistory = history.slice(-maxPoints);

            if (displayHistory.length < 2) {
                return (
                    <div className="graph">
                        <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            height: '100%',
                            color: 'var(--text-secondary)'
                        }}>
                            Start dunking to see the graph!
                        </div>
                    </div>
                );
            }

            const width = 100;
            const height = 100;
            const padding = 10;

            const points = displayHistory.map((value, index) => {
                const x = padding + (index / (maxPoints - 1)) * (width - 2 * padding);
                const y = height - padding - (value / 100) * (height - 2 * padding);
                return `${x},${y}`;
            });

            const linePath = `M ${points.join(' L ')}`;
            const areaPath = `${linePath} L ${padding + ((displayHistory.length - 1) / (maxPoints - 1)) * (width - 2 * padding)},${height - padding} L ${padding},${height - padding} Z`;

            return (
                <div className="graph">
                    <svg className="graph-svg" viewBox={`0 0 ${width} ${height}`} preserveAspectRatio="none">
                        <defs>
                            <linearGradient id="graphGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stopColor="rgba(212, 165, 116, 0.4)" />
                                <stop offset="100%" stopColor="rgba(212, 165, 116, 0)" />
                            </linearGradient>
                        </defs>

                        {/* Grid lines */}
                        {[0, 25, 50, 75, 100].map((val) => {
                            const y = height - padding - (val / 100) * (height - 2 * padding);
                            return (
                                <g key={val}>
                                    <line
                                        x1={padding}
                                        y1={y}
                                        x2={width - padding}
                                        y2={y}
                                        className="graph-grid-line"
                                    />
                                    <text x="2" y={y + 3} className="graph-label">{val}</text>
                                </g>
                            );
                        })}

                        {/* Area fill */}
                        <path d={areaPath} className="graph-area" />

                        {/* Line */}
                        <path d={linePath} className="graph-line" />

                        {/* Current point */}
                        {displayHistory.length > 0 && (
                            <circle
                                cx={padding + ((displayHistory.length - 1) / (maxPoints - 1)) * (width - 2 * padding)}
                                cy={height - padding - (displayHistory[displayHistory.length - 1] / 100) * (height - 2 * padding)}
                                r="3"
                                className="graph-dot"
                            />
                        )}
                    </svg>
                </div>
            );
        };

        // Main App
        const App = () => {
            const [temp, setTemp] = useState(75);
            const [dunkTime, setDunkTime] = useState(3);
            const [selectedBiscuit, setSelectedBiscuit] = useState(BISCUITS[0]);
            const [integrity, setIntegrity] = useState(100);
            const [isDunking, setIsDunking] = useState(false);
            const [crumbleHistory, setCrumbleHistory] = useState([]);
            const [crumbs, setCrumbs] = useState([]);
            const [totalDunks, setTotalDunks] = useState(0);
            const [disasters, setDisasters] = useState(0);
            const crumbIdRef = useRef(0);

            const crumbleRisk = useMemo(() =>
                calculateCrumbleRisk(temp, dunkTime, selectedBiscuit, integrity),
                [temp, dunkTime, selectedBiscuit, integrity]
            );

            const status = useMemo(() => getStatus(crumbleRisk), [crumbleRisk]);

            const performDunk = useCallback(() => {
                if (isDunking) return;

                setIsDunking(true);
                setTotalDunks(prev => prev + 1);

                // Add to history
                setCrumbleHistory(prev => [...prev, crumbleRisk]);

                // Calculate integrity loss
                const integrityLoss = (crumbleRisk / 100) * (dunkTime * 3) + Math.random() * 5;

                setTimeout(() => {
                    setIntegrity(prev => {
                        const newIntegrity = Math.max(0, prev - integrityLoss);

                        // Spawn crumbs if risky
                        if (crumbleRisk > 40) {
                            const crumbCount = Math.floor(crumbleRisk / 15);
                            const newCrumbs = [];
                            for (let i = 0; i < crumbCount; i++) {
                                newCrumbs.push({
                                    id: crumbIdRef.current++,
                                    x: 35 + Math.random() * 30,
                                    delay: Math.random() * 500
                                });
                            }
                            setCrumbs(prev => [...prev, ...newCrumbs]);

                            // Clean up crumbs after animation
                            setTimeout(() => {
                                setCrumbs(prev => prev.filter(c => !newCrumbs.includes(c)));
                            }, 2000);
                        }

                        // Check for disaster
                        if (newIntegrity <= 0 || (crumbleRisk > 80 && Math.random() > 0.5)) {
                            setDisasters(prev => prev + 1);
                        }

                        return newIntegrity;
                    });

                    setIsDunking(false);
                }, 2000);
            }, [isDunking, crumbleRisk, dunkTime]);

            const resetSimulation = useCallback(() => {
                setIntegrity(100);
                setCrumbleHistory([]);
                setCrumbs([]);
            }, []);

            // Keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.target.tagName === 'INPUT') return;

                    switch(e.key.toLowerCase()) {
                        case ' ':
                        case 'd':
                            e.preventDefault();
                            performDunk();
                            break;
                        case 'r':
                            resetSimulation();
                            break;
                        case 'arrowup':
                            e.preventDefault();
                            setTemp(prev => Math.min(100, prev + 5));
                            break;
                        case 'arrowdown':
                            e.preventDefault();
                            setTemp(prev => Math.max(40, prev - 5));
                            break;
                        case 'arrowleft':
                            e.preventDefault();
                            setDunkTime(prev => Math.max(1, prev - 1));
                            break;
                        case 'arrowright':
                            e.preventDefault();
                            setDunkTime(prev => Math.min(10, prev + 1));
                            break;
                        case '1':
                        case '2':
                        case '3':
                        case '4':
                        case '5':
                        case '6':
                            const index = parseInt(e.key) - 1;
                            if (BISCUITS[index]) {
                                setSelectedBiscuit(BISCUITS[index]);
                                setIntegrity(100);
                            }
                            break;
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [performDunk, resetSimulation]);

            const getMeterColor = (risk) => {
                if (risk < 30) return 'linear-gradient(90deg, #27ae60, #2ecc71)';
                if (risk < 60) return 'linear-gradient(90deg, #f39c12, #e67e22)';
                return 'linear-gradient(90deg, #e74c3c, #c0392b)';
            };

            return (
                <div className="app-container">
                    <header className="header fade-in">
                        <h1>‚òï Tea Dunkability Simulator</h1>
                        <p>The definitive scientific approach to biscuit dunking</p>
                        <div className="keyboard-hint">
                            <span className="key-hint"><kbd>Space</kbd> Dunk</span>
                            <span className="key-hint"><kbd>‚Üë‚Üì</kbd> Temp</span>
                            <span className="key-hint"><kbd>‚Üê‚Üí</kbd> Time</span>
                            <span className="key-hint"><kbd>1-6</kbd> Biscuit</span>
                            <span className="key-hint"><kbd>R</kbd> Reset</span>
                        </div>
                    </header>

                    <main className="main-grid">
                        {/* Controls Panel */}
                        <div className="glass-card fade-in" style={{ animationDelay: '0.1s' }}>
                            <h2 className="card-title">üéõÔ∏è Controls</h2>

                            <div className="control-group">
                                <div className="control-label">
                                    <span>üå°Ô∏è Tea Temperature</span>
                                    <span className="control-value">{temp}¬∞C</span>
                                </div>
                                <div className="slider-container">
                                    <div className="slider-fill temp" style={{ width: `${((temp - 40) / 60) * 100}%` }}></div>
                                    <input
                                        type="range"
                                        min="40"
                                        max="100"
                                        value={temp}
                                        onChange={(e) => setTemp(Number(e.target.value))}
                                    />
                                </div>
                            </div>

                            <div className="control-group">
                                <div className="control-label">
                                    <span>‚è±Ô∏è Dunk Time</span>
                                    <span className="control-value">{dunkTime}s</span>
                                </div>
                                <div className="slider-container">
                                    <div className="slider-fill time" style={{ width: `${(dunkTime / 10) * 100}%` }}></div>
                                    <input
                                        type="range"
                                        min="1"
                                        max="10"
                                        value={dunkTime}
                                        onChange={(e) => setDunkTime(Number(e.target.value))}
                                    />
                                </div>
                            </div>

                            <div className="control-group">
                                <div className="control-label">
                                    <span>üí™ Structural Integrity</span>
                                    <span className="control-value">{Math.round(integrity)}%</span>
                                </div>
                                <div className="slider-container">
                                    <div className="slider-fill integrity" style={{ width: `${integrity}%` }}></div>
                                    <input
                                        type="range"
                                        min="0"
                                        max="100"
                                        value={integrity}
                                        onChange={(e) => setIntegrity(Number(e.target.value))}
                                    />
                                </div>
                            </div>

                            <div className="control-group">
                                <div className="control-label">
                                    <span>üç™ Biscuit Type</span>
                                </div>
                                <div className="biscuit-selector">
                                    {BISCUITS.map((biscuit, index) => (
                                        <div
                                            key={biscuit.id}
                                            className={`biscuit-option ${selectedBiscuit.id === biscuit.id ? 'selected' : ''}`}
                                            onClick={() => {
                                                setSelectedBiscuit(biscuit);
                                                setIntegrity(100);
                                            }}
                                        >
                                            <div className="biscuit-emoji">{biscuit.emoji}</div>
                                            <div className="biscuit-name">{biscuit.name}</div>
                                            <div className="biscuit-rating">Dunkability: {biscuit.dunkability}/10</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Main Visualization */}
                        <div className="glass-card fade-in" style={{ animationDelay: '0.2s' }}>
                            <h2 className="card-title">ü´ñ Dunk Chamber</h2>

                            <div className="teacup-container">
                                <div className="teacup-scene">
                                    <div className="crumbs-container">
                                        {crumbs.map(crumb => (
                                            <Crumb key={crumb.id} x={crumb.x} delay={crumb.delay} />
                                        ))}
                                    </div>
                                    <BiscuitVisual
                                        biscuit={selectedBiscuit}
                                        soggyLevel={100 - integrity}
                                        isDunking={isDunking}
                                    />
                                    <Teacup temp={temp} />
                                </div>
                            </div>

                            <div className="status-display">
                                <div className={`status-text ${status.class}`}>
                                    {status.text}
                                </div>
                            </div>

                            <div className="crumble-meter">
                                <div className="meter-header">
                                    <span className="meter-title">Crumble-O-Meter‚Ñ¢</span>
                                    <span className="meter-value">{Math.round(crumbleRisk)}%</span>
                                </div>
                                <div className="meter-bar">
                                    <div
                                        className="meter-fill"
                                        style={{
                                            width: `${crumbleRisk}%`,
                                            background: getMeterColor(crumbleRisk)
                                        }}
                                    ></div>
                                </div>
                                <div className="meter-labels">
                                    <span>Safe</span>
                                    <span>Risky</span>
                                    <span>DANGER!</span>
                                </div>
                            </div>

                            <button
                                className="dunk-button"
                                onClick={performDunk}
                                disabled={isDunking || integrity <= 0}
                            >
                                {isDunking ? 'ü´ñ Dunking...' : integrity <= 0 ? 'üíî Biscuit Lost!' : 'üç™ Dunk Biscuit'}
                            </button>
                        </div>

                        {/* Analytics Panel */}
                        <div className="glass-card fade-in" style={{ animationDelay: '0.3s' }}>
                            <h2 className="card-title">üìä Analytics</h2>

                            <div className="graph-container">
                                <div className="graph-title">Crumble Risk Over Time</div>
                                <CrumbleGraph history={crumbleHistory} />
                            </div>

                            <div className="stats-grid">
                                <div className="stat-item">
                                    <div className="stat-value">{totalDunks}</div>
                                    <div className="stat-label">Total Dunks</div>
                                </div>
                                <div className="stat-item">
                                    <div className="stat-value">{disasters}</div>
                                    <div className="stat-label">Disasters</div>
                                </div>
                                <div className="stat-item">
                                    <div className="stat-value">{selectedBiscuit.dunkability}/10</div>
                                    <div className="stat-label">Dunkability</div>
                                </div>
                                <div className="stat-item">
                                    <div className="stat-value">{totalDunks > 0 ? Math.round((1 - disasters / totalDunks) * 100) : 100}%</div>
                                    <div className="stat-label">Success Rate</div>
                                </div>
                            </div>

                            <button className="reset-button" onClick={resetSimulation}>
                                üîÑ Reset Simulation
                            </button>
                        </div>
                    </main>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
