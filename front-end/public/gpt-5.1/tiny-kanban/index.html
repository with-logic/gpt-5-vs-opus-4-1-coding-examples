<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tiny Kanban</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #f7f8fb;
        --todo: #dbeafe;
        --doing: #fee2e2;
        --done: #dcfce7;
      }
      body {
        margin: 0;
        font-family: "Inter", system-ui;
        background: var(--bg);
        color: #0f172a;
        min-height: 100vh;
        padding: 1.5rem;
      }
      header {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: center;
      }
      input,
      select,
      button {
        font: inherit;
        border-radius: 0.7rem;
        border: 1px solid rgba(15, 23, 42, 0.2);
        padding: 0.4rem 0.6rem;
      }
      button {
        background: #0f172a;
        color: #fff;
        cursor: pointer;
      }
      .board {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1rem;
        margin-top: 1.5rem;
      }
      .column {
        border-radius: 1rem;
        padding: 1rem;
        background: #fff;
        min-height: 300px;
      }
      .column h2 {
        display: flex;
        justify-content: space-between;
        margin-top: 0;
      }
      .card {
        border-radius: 0.8rem;
        padding: 0.8rem;
        margin-bottom: 0.6rem;
        background: #fff;
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.1);
        cursor: grab;
      }
      .card[data-priority="high"] {
        border-left: 4px solid #ef4444;
      }
      .card[data-priority="medium"] {
        border-left: 4px solid #f97316;
      }
      .card[data-priority="low"] {
        border-left: 4px solid #10b981;
      }
      .assign {
        font-size: 0.85rem;
        color: #475569;
      }
    </style>
  </head>
  <body>
    <header>
      <input id="title" placeholder="Task" />
      <select id="assignee">
        <option>Ava</option>
        <option>Ben</option>
        <option>Cheng</option>
      </select>
      <select id="priority">
        <option value="high">High</option>
        <option value="medium">Medium</option>
        <option value="low">Low</option>
      </select>
      <button id="add">Add card</button>
      <input id="filter" placeholder="Search" />
    </header>
    <section class="board" id="board"></section>

    <script>
      const boardEl = document.getElementById("board");
      const filterInput = document.getElementById("filter");
      const WIP_LIMIT = 3;
      const state = {
        todo: [],
        doing: [],
        done: [],
      };

      function createCard(title, assignee, priority) {
        return { id: crypto.randomUUID(), title, assignee, priority };
      }

      function render() {
        boardEl.innerHTML = "";
        [
          { key: "todo", label: "Todo", color: "var(--todo)" },
          { key: "doing", label: "Doing", color: "var(--doing)" },
          { key: "done", label: "Done", color: "var(--done)" },
        ].forEach((column) => {
          const col = document.createElement("div");
          col.className = "column";
          col.dataset.column = column.key;
          col.style.background = column.color;
          col.innerHTML = `<h2>${column.label} <span>${state[column.key].length}${
            column.key === "doing" ? `/${WIP_LIMIT}` : ""
          }</span></h2>`;
          col.addEventListener("dragover", (event) => event.preventDefault());
          col.addEventListener("drop", (event) => handleDrop(event, column.key));
          state[column.key]
            .filter((card) => card.title.toLowerCase().includes(filterInput.value.toLowerCase()))
            .forEach((card) => {
              const div = document.createElement("div");
              div.className = "card";
              div.draggable = true;
              div.dataset.id = card.id;
              div.dataset.priority = card.priority;
              div.innerHTML = `<strong>${card.title}</strong><div class="assign">${card.assignee}</div><button data-delete>Ã—</button>`;
              div.addEventListener("dragstart", (event) => event.dataTransfer.setData("text/plain", card.id));
              div.querySelector("[data-delete]").addEventListener("click", () => deleteCard(card.id));
              col.appendChild(div);
            });
          boardEl.appendChild(col);
        });
      }

      function handleDrop(event, column) {
        const id = event.dataTransfer.getData("text/plain");
        if (!id) return;
        if (column === "doing" && state.doing.length >= WIP_LIMIT) {
          alert("WIP limit reached");
          return;
        }
        moveCard(id, column);
      }

      function moveCard(id, column) {
        Object.keys(state).forEach((key) => {
          state[key] = state[key].filter((card) => card.id !== id);
        });
        const card = allCards.find((card) => card.id === id);
        if (card) state[column].push(card);
        render();
      }

      function deleteCard(id) {
        Object.keys(state).forEach((key) => {
          state[key] = state[key].filter((card) => card.id !== id);
        });
        render();
      }

      const allCards = [];
      document.getElementById("add").addEventListener("click", () => {
        const title = document.getElementById("title").value.trim();
        if (!title) return;
        const card = createCard(title, document.getElementById("assignee").value, document.getElementById("priority").value);
        allCards.push(card);
        state.todo.push(card);
        document.getElementById("title").value = "";
        render();
      });
      filterInput.addEventListener("input", render);
      render();
    </script>
  </body>
</html>
