<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cloud Painter</title>
    <style>
      :root {
        color-scheme: light;
        --sky-top: #a5d8ff;
        --sky-bottom: #fef6ff;
        --lavender: #d9c9ff;
        --peach: #ffd3ba;
        --mint: #c3f8e5;
        --text: #3b3b58;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Fredoka", "Nunito", sans-serif;
        background: linear-gradient(180deg, var(--sky-top), var(--sky-bottom));
        color: var(--text);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 1rem;
      }
      header {
        text-align: center;
        margin-bottom: 1rem;
      }
      h1 {
        font-size: clamp(2rem, 8vw, 3rem);
        margin: 0;
      }
      p {
        margin: 0.5rem 0;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        justify-content: center;
        margin-bottom: 1rem;
      }
      .controls button,
      .controls input[type="range"],
      .controls select {
        border: none;
        border-radius: 999px;
        font-size: 1rem;
        padding: 0.5rem 1rem;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 10px 25px rgba(59, 59, 88, 0.15);
      }
      .controls button.active {
        background: var(--mint);
      }
      #stage {
        width: min(900px, 100%);
        aspect-ratio: 4 / 3;
        border-radius: 1.5rem;
        border: 6px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 25px 40px rgba(0, 0, 0, 0.15);
        touch-action: none;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Cloud Painter</h1>
      <p>Tap or click to puff clouds, switch brushes, and watch airplanes zip by.</p>
    </header>
    <div class="controls" aria-label="Brush controls">
      <button data-shape="puff" class="active">Puffy</button>
      <button data-shape="swirl">Swirl</button>
      <button data-shape="star">Sparkle</button>
      <label>
        Size
        <input type="range" id="size" min="20" max="120" value="60" />
      </label>
      <button id="clear">Clear sky</button>
      <button id="save">Save sky</button>
    </div>
    <canvas id="stage" width="900" height="675" aria-label="Sky canvas"></canvas>

    <script>
      const canvas = document.getElementById("stage");
      const ctx = canvas.getContext("2d");
      const buttons = document.querySelectorAll("[data-shape]");
      const sizeInput = document.getElementById("size");
      const clearBtn = document.getElementById("clear");
      const saveBtn = document.getElementById("save");
      let shape = "puff";
      let drawing = false;
      const clouds = [];
      const planes = [];

      function resize() {
        const width = canvas.clientWidth;
        canvas.height = (width * 3) / 4;
      }
      window.addEventListener("resize", resize);
      resize();

      buttons.forEach((btn) =>
        btn.addEventListener("click", () => {
          shape = btn.dataset.shape;
          buttons.forEach((b) => b.classList.toggle("active", b === btn));
        })
      );

      function addCloud(x, y) {
        clouds.push({
          x,
          y,
          size: Number(sizeInput.value),
          shape,
          drift: Math.random() * 0.15 + 0.05,
          offset: Math.random() * Math.PI * 2,
        });
      }

      function pointerPos(event) {
        const rect = canvas.getBoundingClientRect();
        return {
          x: ((event.clientX || event.touches?.[0].clientX) - rect.left) * (canvas.width / rect.width),
          y: ((event.clientY || event.touches?.[0].clientY) - rect.top) * (canvas.height / rect.height),
        };
      }

      function startDraw(event) {
        drawing = true;
        const pos = pointerPos(event);
        addCloud(pos.x, pos.y);
      }
      function moveDraw(event) {
        if (!drawing) return;
        event.preventDefault();
        const pos = pointerPos(event);
        addCloud(pos.x, pos.y);
      }
      function endDraw() {
        drawing = false;
      }

      canvas.addEventListener("pointerdown", startDraw);
      canvas.addEventListener("pointermove", moveDraw);
      canvas.addEventListener("pointerup", endDraw);
      canvas.addEventListener("pointerleave", endDraw);

      clearBtn.addEventListener("click", () => clouds.splice(0));
      saveBtn.addEventListener("click", () => {
        const link = document.createElement("a");
        link.download = "cloud-painting.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });

      function spawnPlane() {
        const y = Math.random() * canvas.height * 0.5;
        const direction = Math.random() > 0.5 ? 1 : -1;
        planes.push({
          x: direction > 0 ? -80 : canvas.width + 80,
          y,
          speed: (Math.random() * 0.4 + 0.2) * direction,
        });
      }
      setInterval(spawnPlane, 5000);

      function drawCloud(cloud) {
        ctx.save();
        ctx.translate(cloud.x, cloud.y);
        ctx.fillStyle = "rgba(255,255,255,0.9)";
        if (cloud.shape === "puff") {
          ctx.beginPath();
          ctx.arc(0, 0, cloud.size / 2, 0, Math.PI * 2);
          ctx.fill();
          ctx.beginPath();
          ctx.arc(-cloud.size / 4, -cloud.size / 4, cloud.size / 3, 0, Math.PI * 2);
          ctx.arc(cloud.size / 4, -cloud.size / 4, cloud.size / 3, 0, Math.PI * 2);
          ctx.fill();
        } else if (cloud.shape === "swirl") {
          ctx.rotate(Math.sin(cloud.offset) * 0.4);
          ctx.scale(1.4, 0.8);
          ctx.beginPath();
          ctx.arc(0, 0, cloud.size / 2, 0, Math.PI * 2);
          ctx.fill();
        } else {
          ctx.beginPath();
          for (let i = 0; i < 5; i++) {
            const angle = (i / 5) * Math.PI * 2;
            ctx.lineTo(
              Math.cos(angle) * (cloud.size / 2),
              Math.sin(angle) * (cloud.size / 2)
            );
            ctx.lineTo(
              Math.cos(angle + Math.PI / 5) * (cloud.size / 4),
              Math.sin(angle + Math.PI / 5) * (cloud.size / 4)
            );
          }
          ctx.closePath();
          ctx.fillStyle = "rgba(255,255,255,0.85)";
          ctx.fill();
        }
        ctx.restore();
      }

      function drawPlane(plane) {
        ctx.save();
        ctx.translate(plane.x, plane.y);
        ctx.scale(1.5, 1.5);
        ctx.fillStyle = "rgba(255,255,255,0.9)";
        ctx.beginPath();
        ctx.moveTo(-20, 0);
        ctx.lineTo(10, 0);
        ctx.lineTo(20, -4);
        ctx.lineTo(10, 0);
        ctx.lineTo(20, 4);
        ctx.closePath();
        ctx.fill();
        ctx.fillStyle = "rgba(255,255,255,0.6)";
        ctx.fillRect(-6, -2, 12, 4);
        ctx.restore();
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        gradient.addColorStop(0, "#a5d8ff");
        gradient.addColorStop(1, "#fef6ff");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        clouds.forEach((cloud) => {
          cloud.y -= cloud.drift;
          cloud.x += Math.sin(cloud.offset += 0.01);
          if (cloud.y < -120) cloud.y = canvas.height + 50;
          drawCloud(cloud);
        });
        planes.forEach((plane) => {
          plane.x += plane.speed * 10;
        });
        while (planes.length > 6) planes.shift();
        for (let i = planes.length - 1; i >= 0; i--) {
          const plane = planes[i];
          if (plane.speed > 0 && plane.x > canvas.width + 120) planes.splice(i, 1);
          else if (plane.speed < 0 && plane.x < -120) planes.splice(i, 1);
          else drawPlane(plane);
        }
        requestAnimationFrame(animate);
      }
      animate();
    </script>
  </body>
</html>
