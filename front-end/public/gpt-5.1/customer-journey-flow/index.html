<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Customer Journey Flow</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #f6f8fb;
        --board: #ffffff;
        --ink: #151c2f;
        --accent: #2563eb;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Inter", system-ui, sans-serif;
        background: var(--bg);
        color: var(--ink);
        padding: 1.5rem;
      }
      h1 {
        margin-bottom: 0.25rem;
      }
      p {
        margin-top: 0;
        color: #5f6c88;
      }
      .app {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: minmax(0, 3fr) minmax(240px, 1fr);
        margin-top: 1.5rem;
      }
      .board {
        background: var(--board);
        border-radius: 1.5rem;
        padding: 1rem;
        position: relative;
        min-height: 520px;
        box-shadow: 0 30px 60px rgba(15, 23, 42, 0.08);
      }
      #canvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      .node {
        position: absolute;
        width: 180px;
        min-height: 90px;
        background: #f9fbff;
        border: 2px solid #d6e3ff;
        border-radius: 1rem;
        padding: 0.75rem;
        box-shadow: 0 10px 20px rgba(37, 99, 235, 0.08);
        cursor: grab;
        transition: transform 0.1s ease;
      }
      .node:active {
        cursor: grabbing;
        transform: scale(1.02);
      }
      .node h3 {
        margin: 0 0 0.25rem;
        font-size: 1rem;
      }
      .node small {
        color: #6c7797;
      }
      aside {
        background: var(--board);
        border-radius: 1.5rem;
        padding: 1.5rem;
        box-shadow: 0 30px 60px rgba(15, 23, 42, 0.08);
      }
      aside h2 {
        margin-top: 0;
        font-size: 1.2rem;
      }
      aside label {
        display: block;
        font-size: 0.85rem;
        color: #6c7797;
        margin-bottom: 0.25rem;
      }
      aside input {
        width: 100%;
        border-radius: 0.75rem;
        border: 1px solid #cdd7ee;
        padding: 0.5rem 0.75rem;
        margin-bottom: 0.75rem;
        font: inherit;
      }
      button {
        width: 100%;
        border: none;
        border-radius: 0.75rem;
        padding: 0.75rem;
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Customer Journey Flow</h1>
      <p>Arrange stages from awareness to purchase. Drag cards to rewire the path, and rename them inline.</p>
    </header>
    <div class="app">
      <div class="board" id="board">
        <svg id="canvas"></svg>
      </div>
      <aside>
        <h2>Stage editor</h2>
        <label for="stageTitle">Stage title</label>
        <input type="text" id="stageTitle" placeholder="Stage title" />
        <label for="stageSummary">Short note</label>
        <input type="text" id="stageSummary" placeholder="What happens here?" />
        <button id="update">Update stage</button>
        <hr />
        <button id="add">Add new stage</button>
      </aside>
    </div>

    <script>
      const board = document.getElementById("board");
      const canvas = document.getElementById("canvas");
      const stageTitle = document.getElementById("stageTitle");
      const stageSummary = document.getElementById("stageSummary");
      const updateBtn = document.getElementById("update");
      const addBtn = document.getElementById("add");
      let selectedId = null;
      let stages = [
        { id: crypto.randomUUID(), title: "Awareness", summary: "See paid ads, social", x: 40, y: 60 },
        { id: crypto.randomUUID(), title: "Consideration", summary: "Download guide", x: 260, y: 160 },
        { id: crypto.randomUUID(), title: "Evaluation", summary: "Trial workspace", x: 480, y: 80 },
        { id: crypto.randomUUID(), title: "Purchase", summary: "Contract signed", x: 700, y: 200 },
      ];

      const lineColor = "rgba(37, 99, 235, 0.7)";

      function render() {
        board.querySelectorAll(".node").forEach((n) => n.remove());
        canvas.innerHTML = "";
        stages.forEach((stage) => {
          const node = document.createElement("article");
          node.className = "node";
          node.dataset.id = stage.id;
          node.style.left = `${stage.x}px`;
          node.style.top = `${stage.y}px`;
          node.innerHTML = `<h3>${stage.title}</h3><small>${stage.summary}</small>`;
          node.addEventListener("click", () => selectStage(stage.id));
          enableDrag(node, stage.id);
          board.appendChild(node);
        });
        drawConnections();
      }

      function drawConnections() {
        const points = stages.map((stage) => [stage.x + 90, stage.y + 45]);
        if (!points.length) return;
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        const d = points
          .map((point, index) => (index === 0 ? `M ${point[0]} ${point[1]}` : `L ${point[0]} ${point[1]}`))
          .join(" ");
        path.setAttribute("d", d);
        path.setAttribute("fill", "none");
        path.setAttribute("stroke", lineColor);
        path.setAttribute("stroke-width", "3");
        path.setAttribute("stroke-linecap", "round");
        path.setAttribute("stroke-linejoin", "round");
        canvas.appendChild(path);
      }

      function selectStage(id) {
        selectedId = id;
        const stage = stages.find((s) => s.id === id);
        stageTitle.value = stage?.title || "";
        stageSummary.value = stage?.summary || "";
        board.querySelectorAll(".node").forEach((node) => {
          node.style.borderColor = node.dataset.id === id ? lineColor : "#d6e3ff";
        });
      }

      function enableDrag(node, id) {
        let offsetX = 0;
        let offsetY = 0;
        function pointerDown(event) {
          node.setPointerCapture(event.pointerId);
          offsetX = event.clientX - node.offsetLeft;
          offsetY = event.clientY - node.offsetTop;
          node.addEventListener("pointermove", pointerMove);
          node.addEventListener("pointerup", pointerUp);
        }
        function pointerMove(event) {
          const x = event.clientX - offsetX;
          const y = event.clientY - offsetY;
          node.style.left = `${x}px`;
          node.style.top = `${y}px`;
          const stage = stages.find((s) => s.id === id);
          stage.x = x;
          stage.y = y;
          canvas.innerHTML = "";
          drawConnections();
        }
        function pointerUp(event) {
          node.releasePointerCapture(event.pointerId);
          node.removeEventListener("pointermove", pointerMove);
          node.removeEventListener("pointerup", pointerUp);
        }
        node.addEventListener("pointerdown", pointerDown);
      }

      updateBtn.addEventListener("click", () => {
        if (!selectedId) return;
        const stage = stages.find((s) => s.id === selectedId);
        stage.title = stageTitle.value || stage.title;
        stage.summary = stageSummary.value || stage.summary;
        render();
        selectStage(selectedId);
      });

      addBtn.addEventListener("click", () => {
        const newStage = {
          id: crypto.randomUUID(),
          title: "New stage",
          summary: "Describe this step",
          x: 100,
          y: 320,
        };
        stages.push(newStage);
        render();
        selectStage(newStage.id);
      });

      render();
      selectStage(stages[0].id);
    </script>
  </body>
</html>
