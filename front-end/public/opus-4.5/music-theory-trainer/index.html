<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Theory Trainer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8b5cf6;
            --success: #22c55e;
            --danger: #ef4444;
            --bg: #18181b;
            --card: #27272a;
            --text: #fafafa;
            --text-light: #a1a1aa;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            color: var(--text-light);
        }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 40px;
        }

        .tab-btn {
            padding: 12px 25px;
            background: var(--card);
            border: none;
            border-radius: 10px;
            color: var(--text);
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: #3f3f46;
        }

        .tab-btn.active {
            background: var(--primary);
        }

        /* Piano Container */
        .piano-section {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .piano-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .note-display {
            font-size: 2rem;
            font-weight: 700;
        }

        .score-display {
            font-size: 1.2rem;
            color: var(--text-light);
        }

        .score-display .correct {
            color: var(--success);
        }

        /* Piano Keys */
        .piano {
            display: flex;
            justify-content: center;
            position: relative;
            height: 200px;
            margin: 20px 0;
        }

        .white-keys {
            display: flex;
            gap: 2px;
        }

        .white-key {
            width: 50px;
            height: 200px;
            background: linear-gradient(180deg, #fff 0%, #e5e5e5 100%);
            border: 1px solid #ccc;
            border-radius: 0 0 8px 8px;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .white-key:hover {
            background: linear-gradient(180deg, #f0f0f0 0%, #d5d5d5 100%);
        }

        .white-key:active, .white-key.active {
            background: linear-gradient(180deg, #d5d5d5 0%, #c5c5c5 100%);
        }

        .white-key.highlight {
            background: linear-gradient(180deg, #c4b5fd 0%, #a78bfa 100%);
        }

        .white-key.correct {
            background: linear-gradient(180deg, #86efac 0%, #22c55e 100%);
        }

        .white-key.wrong {
            background: linear-gradient(180deg, #fca5a5 0%, #ef4444 100%);
        }

        .black-keys {
            position: absolute;
            display: flex;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
        }

        .black-key-container {
            width: 52px;
            display: flex;
            justify-content: center;
        }

        .black-key {
            width: 32px;
            height: 120px;
            background: linear-gradient(180deg, #333 0%, #111 100%);
            border-radius: 0 0 6px 6px;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.1s;
        }

        .black-key:hover {
            background: linear-gradient(180deg, #444 0%, #222 100%);
        }

        .black-key:active, .black-key.active {
            background: linear-gradient(180deg, #222 0%, #000 100%);
        }

        .black-key.highlight {
            background: linear-gradient(180deg, #7c3aed 0%, #5b21b6 100%);
        }

        .black-key.correct {
            background: linear-gradient(180deg, #16a34a 0%, #15803d 100%);
        }

        .black-key.wrong {
            background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%);
        }

        .black-key.spacer {
            visibility: hidden;
            pointer-events: none;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 25px;
            background: var(--primary);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .control-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .control-btn.secondary {
            background: #3f3f46;
        }

        /* Exercise Section */
        .exercise-section {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
        }

        .exercise-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .exercise-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 15px 30px;
            background: #3f3f46;
            border: 2px solid #52525b;
            border-radius: 12px;
            color: var(--text);
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .option-btn:hover {
            border-color: var(--primary);
        }

        .option-btn.correct {
            background: var(--success);
            border-color: var(--success);
        }

        .option-btn.wrong {
            background: var(--danger);
            border-color: var(--danger);
        }

        /* Staff */
        .staff-container {
            background: #1f1f23;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .staff {
            position: relative;
            height: 100px;
            max-width: 400px;
            margin: 0 auto;
        }

        .staff-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: #52525b;
        }

        .clef {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 4rem;
            color: var(--text-light);
        }

        .note-on-staff {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
        }

        /* Chord Display */
        .chord-display {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 30px 0;
            color: var(--primary);
        }

        /* Theory info */
        .theory-info {
            background: #1f1f23;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }

        .theory-info h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .theory-info p {
            color: var(--text-light);
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            .white-key {
                width: 35px;
                height: 150px;
            }

            .black-key {
                width: 24px;
                height: 90px;
            }

            .black-key-container {
                width: 37px;
            }

            .piano {
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéπ Music Theory Trainer</h1>
            <p>Learn notes, scales, and chords interactively</p>
        </header>

        <!-- Mode Tabs -->
        <div class="mode-tabs">
            <button class="tab-btn active" onclick="setMode('freeplay')">Free Play</button>
            <button class="tab-btn" onclick="setMode('notes')">Note Reading</button>
            <button class="tab-btn" onclick="setMode('ear')">Ear Training</button>
            <button class="tab-btn" onclick="setMode('chords')">Chord Builder</button>
        </div>

        <!-- Piano Section -->
        <div class="piano-section">
            <div class="piano-info">
                <div class="note-display" id="noteDisplay">üéµ Play a note!</div>
                <div class="score-display">
                    Score: <span class="correct" id="correctCount">0</span> / <span id="totalCount">0</span>
                </div>
            </div>

            <div class="piano" id="piano">
                <div class="white-keys">
                    <div class="white-key" data-note="C4">C</div>
                    <div class="white-key" data-note="D4">D</div>
                    <div class="white-key" data-note="E4">E</div>
                    <div class="white-key" data-note="F4">F</div>
                    <div class="white-key" data-note="G4">G</div>
                    <div class="white-key" data-note="A4">A</div>
                    <div class="white-key" data-note="B4">B</div>
                    <div class="white-key" data-note="C5">C</div>
                </div>
                <div class="black-keys">
                    <div class="black-key-container"><div class="black-key" data-note="C#4"></div></div>
                    <div class="black-key-container"><div class="black-key" data-note="D#4"></div></div>
                    <div class="black-key-container"><div class="black-key spacer"></div></div>
                    <div class="black-key-container"><div class="black-key" data-note="F#4"></div></div>
                    <div class="black-key-container"><div class="black-key" data-note="G#4"></div></div>
                    <div class="black-key-container"><div class="black-key" data-note="A#4"></div></div>
                    <div class="black-key-container"><div class="black-key spacer"></div></div>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn" id="playNoteBtn" onclick="playCurrentNote()">üîä Play Note</button>
                <button class="control-btn secondary" id="nextBtn" onclick="nextQuestion()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Exercise Section -->
        <div class="exercise-section" id="exerciseSection">
            <div class="exercise-title" id="exerciseTitle">Select a mode to start practicing</div>
            <div id="exerciseContent"></div>
        </div>
    </div>

    <script>
        // Audio context
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        // Note frequencies
        const noteFrequencies = {
            'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
            'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
            'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
            'C5': 523.25
        };

        const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

        let mode = 'freeplay';
        let currentQuestion = null;
        let correctCount = 0;
        let totalCount = 0;

        // Initialize audio
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
        }

        // Play note
        function playNote(note, duration = 0.5) {
            initAudio();
            const freq = noteFrequencies[note];
            if (!freq) return;

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);

            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + duration);
        }

        // Setup piano
        document.querySelectorAll('.white-key, .black-key').forEach(key => {
            if (key.classList.contains('spacer')) return;

            key.addEventListener('mousedown', () => handleKeyPress(key));
            key.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleKeyPress(key);
            });
        });

        function handleKeyPress(key) {
            const note = key.dataset.note;
            playNote(note);

            key.classList.add('active');
            setTimeout(() => key.classList.remove('active'), 200);

            document.getElementById('noteDisplay').textContent = `üéµ ${note.replace('#', '‚ôØ')}`;

            if (mode !== 'freeplay' && currentQuestion) {
                checkAnswer(note);
            }
        }

        // Mode functions
        function setMode(newMode) {
            mode = newMode;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(newMode.split(/(?=[A-Z])/).join(' ').toLowerCase().split(' ')[0]));
            });

            clearHighlights();
            currentQuestion = null;

            switch (mode) {
                case 'freeplay':
                    showFreeplay();
                    break;
                case 'notes':
                    startNoteReading();
                    break;
                case 'ear':
                    startEarTraining();
                    break;
                case 'chords':
                    startChordBuilder();
                    break;
            }
        }

        function showFreeplay() {
            document.getElementById('exerciseTitle').textContent = 'Free Play Mode';
            document.getElementById('exerciseContent').innerHTML = `
                <div class="theory-info">
                    <h4>Tips</h4>
                    <p>Click or tap the piano keys to play notes. The white keys are natural notes (C, D, E, F, G, A, B) and the black keys are sharps/flats.</p>
                </div>
            `;
        }

        function startNoteReading() {
            totalCount = 0;
            correctCount = 0;
            updateScore();
            generateNoteQuestion();
        }

        function generateNoteQuestion() {
            const notes = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5'];
            currentQuestion = notes[Math.floor(Math.random() * notes.length)];

            const notePositions = {
                'C4': 80, 'D4': 70, 'E4': 60, 'F4': 50, 'G4': 40, 'A4': 30, 'B4': 20, 'C5': 10
            };

            document.getElementById('exerciseTitle').textContent = 'What note is this?';
            document.getElementById('exerciseContent').innerHTML = `
                <div class="staff-container">
                    <div class="staff">
                        <div class="staff-line" style="top: 20%"></div>
                        <div class="staff-line" style="top: 35%"></div>
                        <div class="staff-line" style="top: 50%"></div>
                        <div class="staff-line" style="top: 65%"></div>
                        <div class="staff-line" style="top: 80%"></div>
                        <div class="clef">ùÑû</div>
                        <div class="note-on-staff" style="top: ${notePositions[currentQuestion]}%">‚óè</div>
                    </div>
                </div>
                <p style="color: var(--text-light); margin-top: 15px;">Click the correct key on the piano</p>
            `;

            document.getElementById('noteDisplay').textContent = 'üéµ Find this note!';
        }

        function startEarTraining() {
            totalCount = 0;
            correctCount = 0;
            updateScore();
            generateEarQuestion();
        }

        function generateEarQuestion() {
            const notes = Object.keys(noteFrequencies);
            currentQuestion = notes[Math.floor(Math.random() * notes.length)];

            document.getElementById('exerciseTitle').textContent = 'What note did you hear?';
            document.getElementById('exerciseContent').innerHTML = `
                <button class="control-btn" onclick="playCurrentNote()" style="font-size: 1.2rem; padding: 20px 40px;">
                    üîä Play Sound
                </button>
                <p style="color: var(--text-light); margin-top: 20px;">Listen carefully, then click the matching key</p>
            `;

            document.getElementById('noteDisplay').textContent = 'üéß Listen and find!';

            setTimeout(() => playNote(currentQuestion), 500);
        }

        function startChordBuilder() {
            totalCount = 0;
            correctCount = 0;
            updateScore();
            generateChordQuestion();
        }

        function generateChordQuestion() {
            const chords = [
                { name: 'C Major', notes: ['C4', 'E4', 'G4'], formula: 'Root + Major 3rd + Perfect 5th' },
                { name: 'D Minor', notes: ['D4', 'F4', 'A4'], formula: 'Root + Minor 3rd + Perfect 5th' },
                { name: 'E Minor', notes: ['E4', 'G4', 'B4'], formula: 'Root + Minor 3rd + Perfect 5th' },
                { name: 'F Major', notes: ['F4', 'A4', 'C5'], formula: 'Root + Major 3rd + Perfect 5th' },
                { name: 'G Major', notes: ['G4', 'B4', 'D4'], formula: 'Root + Major 3rd + Perfect 5th' },
                { name: 'A Minor', notes: ['A4', 'C5', 'E4'], formula: 'Root + Minor 3rd + Perfect 5th' }
            ];

            const chord = chords[Math.floor(Math.random() * chords.length)];
            currentQuestion = chord;

            document.getElementById('exerciseTitle').textContent = 'Build this chord:';
            document.getElementById('exerciseContent').innerHTML = `
                <div class="chord-display">${chord.name}</div>
                <div class="theory-info">
                    <h4>Formula</h4>
                    <p>${chord.formula}</p>
                    <p style="margin-top: 10px">Click all ${chord.notes.length} notes of the chord</p>
                </div>
            `;

            document.getElementById('noteDisplay').textContent = `Build: ${chord.name}`;

            // Highlight the target notes
            chord.notes.forEach(note => {
                const key = document.querySelector(`[data-note="${note}"]`);
                if (key) key.classList.add('highlight');
            });
        }

        function playCurrentNote() {
            if (currentQuestion) {
                if (typeof currentQuestion === 'string') {
                    playNote(currentQuestion);
                } else if (currentQuestion.notes) {
                    currentQuestion.notes.forEach((note, i) => {
                        setTimeout(() => playNote(note, 0.8), i * 200);
                    });
                }
            }
        }

        function checkAnswer(note) {
            if (!currentQuestion) return;

            let isCorrect = false;

            if (typeof currentQuestion === 'string') {
                // Note reading or ear training
                isCorrect = note === currentQuestion;
                totalCount++;

                const key = document.querySelector(`[data-note="${note}"]`);
                if (isCorrect) {
                    correctCount++;
                    key.classList.add('correct');
                    document.getElementById('noteDisplay').textContent = '‚úÖ Correct!';
                } else {
                    key.classList.add('wrong');
                    document.getElementById('noteDisplay').textContent = `‚ùå That was ${currentQuestion}`;

                    // Show correct answer
                    const correctKey = document.querySelector(`[data-note="${currentQuestion}"]`);
                    if (correctKey) correctKey.classList.add('correct');
                }

                setTimeout(() => {
                    clearHighlights();
                    if (mode === 'notes') generateNoteQuestion();
                    else if (mode === 'ear') generateEarQuestion();
                }, 1500);

            } else if (currentQuestion.notes) {
                // Chord builder - just highlight the pressed key
                const key = document.querySelector(`[data-note="${note}"]`);
                if (currentQuestion.notes.includes(note)) {
                    key.classList.remove('highlight');
                    key.classList.add('correct');

                    // Check if all notes played
                    const remaining = document.querySelectorAll('.highlight').length;
                    if (remaining === 0) {
                        correctCount++;
                        totalCount++;
                        document.getElementById('noteDisplay').textContent = '‚úÖ Perfect chord!';

                        setTimeout(() => {
                            clearHighlights();
                            generateChordQuestion();
                        }, 1500);
                    }
                }
            }

            updateScore();
        }

        function nextQuestion() {
            clearHighlights();
            if (mode === 'notes') generateNoteQuestion();
            else if (mode === 'ear') generateEarQuestion();
            else if (mode === 'chords') generateChordQuestion();
        }

        function clearHighlights() {
            document.querySelectorAll('.white-key, .black-key').forEach(key => {
                key.classList.remove('highlight', 'correct', 'wrong');
            });
        }

        function updateScore() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('totalCount').textContent = totalCount;
        }

        // Keyboard support
        const keyMap = {
            'a': 'C4', 'w': 'C#4', 's': 'D4', 'e': 'D#4', 'd': 'E4',
            'f': 'F4', 't': 'F#4', 'g': 'G4', 'y': 'G#4', 'h': 'A4',
            'u': 'A#4', 'j': 'B4', 'k': 'C5'
        };

        document.addEventListener('keydown', (e) => {
            const note = keyMap[e.key.toLowerCase()];
            if (note) {
                const key = document.querySelector(`[data-note="${note}"]`);
                if (key) handleKeyPress(key);
            }
        });

        // Initialize
        setMode('freeplay');
    </script>
</body>
</html>
