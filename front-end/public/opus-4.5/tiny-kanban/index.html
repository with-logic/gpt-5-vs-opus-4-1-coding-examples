<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiny Kanban</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #1E1E2E;
            min-height: 100vh;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            color: #CDD6F4;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: #313244;
            border-radius: 10px;
            padding: 10px 15px;
        }

        .search-box input {
            background: none;
            border: none;
            color: #CDD6F4;
            font-family: inherit;
            font-size: 1rem;
            width: 200px;
        }

        .search-box input::placeholder {
            color: #6C7086;
        }

        .search-box input:focus {
            outline: none;
        }

        .add-btn {
            padding: 12px 24px;
            background: #89B4FA;
            color: #1E1E2E;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-btn:hover {
            background: #B4BEFE;
            transform: translateY(-2px);
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            min-height: calc(100vh - 150px);
        }

        .column {
            background: #313244;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .column-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .column-title h2 {
            color: #CDD6F4;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .column-count {
            background: #45475A;
            color: #A6ADC8;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .wip-limit {
            font-size: 0.75rem;
            color: #F38BA8;
        }

        .column.todo .column-title h2::before { content: 'üìã '; }
        .column.doing .column-title h2::before { content: '‚ö° '; }
        .column.done .column-title h2::before { content: '‚úÖ '; }

        .cards-container {
            flex: 1;
            overflow-y: auto;
            min-height: 200px;
        }

        .card {
            background: #45475A;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: grab;
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }

        .card:active {
            cursor: grabbing;
        }

        .card.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }

        .card.priority-high {
            border-left-color: #F38BA8;
        }

        .card.priority-medium {
            border-left-color: #FAB387;
        }

        .card.priority-low {
            border-left-color: #A6E3A1;
        }

        .card-title {
            color: #CDD6F4;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-assignee {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #A6ADC8;
            font-size: 0.85rem;
        }

        .avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #89B4FA, #CBA6F7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: white;
            font-weight: 600;
        }

        .delete-btn {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            color: #6C7086;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .delete-btn:hover {
            background: #F38BA8;
            color: white;
        }

        .drop-zone {
            border: 2px dashed #6C7086;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            color: #6C7086;
            margin-top: 10px;
            transition: all 0.2s;
            display: none;
        }

        .column.drag-over .drop-zone {
            display: block;
            border-color: #89B4FA;
            background: rgba(137, 180, 250, 0.1);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #313244;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 450px;
        }

        .modal h2 {
            color: #CDD6F4;
            margin-bottom: 25px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #A6ADC8;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            background: #45475A;
            border: 2px solid transparent;
            border-radius: 10px;
            color: #CDD6F4;
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #89B4FA;
        }

        .form-group select {
            cursor: pointer;
        }

        .priority-options {
            display: flex;
            gap: 10px;
        }

        .priority-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #45475A;
            border-radius: 8px;
            background: transparent;
            color: #A6ADC8;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
        }

        .priority-btn.selected {
            border-color: currentColor;
            background: currentColor;
            color: #1E1E2E;
        }

        .priority-btn.high { color: #F38BA8; }
        .priority-btn.high.selected { background: #F38BA8; color: #1E1E2E; }
        .priority-btn.medium { color: #FAB387; }
        .priority-btn.medium.selected { background: #FAB387; color: #1E1E2E; }
        .priority-btn.low { color: #A6E3A1; }
        .priority-btn.low.selected { background: #A6E3A1; color: #1E1E2E; }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-actions button {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cancel-btn {
            background: #45475A;
            border: none;
            color: #CDD6F4;
        }

        .cancel-btn:hover {
            background: #585B70;
        }

        .save-btn {
            background: #89B4FA;
            border: none;
            color: #1E1E2E;
        }

        .save-btn:hover {
            background: #B4BEFE;
        }

        @media (max-width: 900px) {
            .board {
                grid-template-columns: 1fr;
            }

            .search-box input {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Tiny Kanban</h1>
        <div class="header-controls">
            <div class="search-box">
                <span>üîç</span>
                <input type="text" id="searchInput" placeholder="Search tasks..." oninput="filterCards()">
            </div>
            <button class="add-btn" onclick="openModal()">+ Add Task</button>
        </div>
    </header>

    <div class="board">
        <div class="column todo" data-status="todo" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" ondragleave="handleDragLeave(event)">
            <div class="column-header">
                <div class="column-title">
                    <h2>Todo</h2>
                    <span class="column-count" id="todoCount">0</span>
                </div>
            </div>
            <div class="cards-container" id="todoCards"></div>
            <div class="drop-zone">Drop here</div>
        </div>

        <div class="column doing" data-status="doing" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" ondragleave="handleDragLeave(event)">
            <div class="column-header">
                <div class="column-title">
                    <h2>Doing</h2>
                    <span class="column-count" id="doingCount">0</span>
                </div>
                <span class="wip-limit" id="wipWarning"></span>
            </div>
            <div class="cards-container" id="doingCards"></div>
            <div class="drop-zone">Drop here</div>
        </div>

        <div class="column done" data-status="done" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" ondragleave="handleDragLeave(event)">
            <div class="column-header">
                <div class="column-title">
                    <h2>Done</h2>
                    <span class="column-count" id="doneCount">0</span>
                </div>
            </div>
            <div class="cards-container" id="doneCards"></div>
            <div class="drop-zone">Drop here</div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h2>Add New Task</h2>
            <form onsubmit="saveTask(event)">
                <div class="form-group">
                    <label>Task Title</label>
                    <input type="text" id="taskTitle" placeholder="Enter task title..." required>
                </div>

                <div class="form-group">
                    <label>Assign To</label>
                    <select id="taskAssignee">
                        <option value="">Unassigned</option>
                        <option value="Alex">Alex</option>
                        <option value="Jordan">Jordan</option>
                        <option value="Sam">Sam</option>
                        <option value="Taylor">Taylor</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Priority</label>
                    <div class="priority-options">
                        <button type="button" class="priority-btn low" data-priority="low" onclick="selectPriority('low')">Low</button>
                        <button type="button" class="priority-btn medium selected" data-priority="medium" onclick="selectPriority('medium')">Medium</button>
                        <button type="button" class="priority-btn high" data-priority="high" onclick="selectPriority('high')">High</button>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="save-btn">Add Task</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const WIP_LIMIT = 3;
        let tasks = [];
        let selectedPriority = 'medium';
        let draggedTaskId = null;

        // Load from localStorage
        function loadTasks() {
            const saved = localStorage.getItem('kanbanTasks');
            if (saved) {
                tasks = JSON.parse(saved);
            } else {
                // Sample tasks
                tasks = [
                    { id: 1, title: 'Design homepage mockup', assignee: 'Alex', priority: 'high', status: 'todo' },
                    { id: 2, title: 'Set up CI/CD pipeline', assignee: 'Jordan', priority: 'medium', status: 'doing' },
                    { id: 3, title: 'Write API documentation', assignee: 'Sam', priority: 'low', status: 'todo' },
                    { id: 4, title: 'Review pull requests', assignee: 'Taylor', priority: 'medium', status: 'doing' },
                    { id: 5, title: 'Fix login bug', assignee: 'Alex', priority: 'high', status: 'done' }
                ];
            }
            renderTasks();
        }

        function saveTasks() {
            localStorage.setItem('kanbanTasks', JSON.stringify(tasks));
        }

        function renderTasks(filter = '') {
            const containers = {
                todo: document.getElementById('todoCards'),
                doing: document.getElementById('doingCards'),
                done: document.getElementById('doneCards')
            };

            Object.values(containers).forEach(c => c.innerHTML = '');

            const counts = { todo: 0, doing: 0, done: 0 };

            tasks.forEach(task => {
                if (filter && !task.title.toLowerCase().includes(filter.toLowerCase()) &&
                    !task.assignee?.toLowerCase().includes(filter.toLowerCase())) {
                    return;
                }

                counts[task.status]++;

                const card = document.createElement('div');
                card.className = `card priority-${task.priority}`;
                card.draggable = true;
                card.dataset.taskId = task.id;

                card.innerHTML = `
                    <div class="card-title">${task.title}</div>
                    <div class="card-meta">
                        <div class="card-assignee">
                            ${task.assignee ? `
                                <div class="avatar">${task.assignee.charAt(0)}</div>
                                <span>${task.assignee}</span>
                            ` : '<span style="color: #6C7086">Unassigned</span>'}
                        </div>
                        <button class="delete-btn" onclick="deleteTask(${task.id})">üóëÔ∏è</button>
                    </div>
                `;

                card.addEventListener('dragstart', (e) => {
                    draggedTaskId = task.id;
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    document.querySelectorAll('.column').forEach(col => col.classList.remove('drag-over'));
                });

                containers[task.status].appendChild(card);
            });

            // Update counts
            document.getElementById('todoCount').textContent = counts.todo;
            document.getElementById('doingCount').textContent = counts.doing;
            document.getElementById('doneCount').textContent = counts.done;

            // WIP warning
            const wipWarning = document.getElementById('wipWarning');
            if (counts.doing >= WIP_LIMIT) {
                wipWarning.textContent = `WIP Limit (${WIP_LIMIT}) reached!`;
            } else {
                wipWarning.textContent = '';
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const column = e.currentTarget;
            column.classList.remove('drag-over');

            const newStatus = column.dataset.status;
            const task = tasks.find(t => t.id === draggedTaskId);

            if (task) {
                // Check WIP limit
                const doingCount = tasks.filter(t => t.status === 'doing').length;
                if (newStatus === 'doing' && task.status !== 'doing' && doingCount >= WIP_LIMIT) {
                    alert(`WIP limit of ${WIP_LIMIT} reached! Complete some tasks first.`);
                    return;
                }

                task.status = newStatus;
                saveTasks();
                renderTasks(document.getElementById('searchInput').value);
            }

            draggedTaskId = null;
        }

        function openModal() {
            document.getElementById('modalOverlay').classList.add('active');
            document.getElementById('taskTitle').focus();
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskAssignee').value = '';
            selectPriority('medium');
        }

        function selectPriority(priority) {
            selectedPriority = priority;
            document.querySelectorAll('.priority-btn').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.priority === priority);
            });
        }

        function saveTask(e) {
            e.preventDefault();

            const title = document.getElementById('taskTitle').value.trim();
            const assignee = document.getElementById('taskAssignee').value;

            if (!title) return;

            const newTask = {
                id: Date.now(),
                title,
                assignee: assignee || null,
                priority: selectedPriority,
                status: 'todo'
            };

            tasks.push(newTask);
            saveTasks();
            renderTasks();
            closeModal();
        }

        function deleteTask(id) {
            if (confirm('Delete this task?')) {
                tasks = tasks.filter(t => t.id !== id);
                saveTasks();
                renderTasks(document.getElementById('searchInput').value);
            }
        }

        function filterCards() {
            const query = document.getElementById('searchInput').value;
            renderTasks(query);
        }

        // Close modal on overlay click
        document.getElementById('modalOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('modalOverlay')) {
                closeModal();
            }
        });

        // Keyboard shortcut
        document.addEventListener('keydown', (e) => {
            if (e.key === 'n' && !e.target.matches('input, textarea')) {
                openModal();
            }
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        loadTasks();
    </script>
</body>
</html>
