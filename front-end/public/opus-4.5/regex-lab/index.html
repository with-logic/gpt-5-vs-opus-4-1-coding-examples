<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regex Lab</title>
    <style>
        :root {
            --bg: #1a1b26;
            --surface: #24283b;
            --surface2: #1f2335;
            --border: #414868;
            --text: #c0caf5;
            --text-dim: #565f89;
            --accent: #7aa2f7;
            --accent2: #bb9af7;
            --green: #9ece6a;
            --red: #f7768e;
            --yellow: #e0af68;
            --cyan: #7dcfff;
            --orange: #ff9e64;
        }

        [data-theme="light"] {
            --bg: #f5f5f5;
            --surface: #ffffff;
            --surface2: #e8e8e8;
            --border: #d4d4d4;
            --text: #1a1b26;
            --text-dim: #6b7280;
            --accent: #3b82f6;
            --accent2: #8b5cf6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .title h1 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .title span {
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            width: 38px;
            height: 38px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .terminal-window {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .terminal-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--surface2);
            border-bottom: 1px solid var(--border);
        }

        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .terminal-dot.red { background: #ff5f56; }
        .terminal-dot.yellow { background: #ffbd2e; }
        .terminal-dot.green { background: #27c93f; }

        .terminal-title {
            flex: 1;
            text-align: center;
            color: var(--text-dim);
            font-size: 0.85rem;
        }

        .pattern-section {
            padding: 20px;
        }

        .pattern-input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .pattern-prefix {
            color: var(--accent);
            font-size: 1.2rem;
        }

        .pattern-input {
            flex: 1;
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 14px 16px;
            border-radius: 8px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
        }

        .pattern-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .pattern-input.error {
            border-color: var(--red);
        }

        .pattern-suffix {
            color: var(--accent);
            font-size: 1.2rem;
        }

        .flags-row {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .flag-btn {
            padding: 6px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-dim);
            cursor: pointer;
            font-family: inherit;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .flag-btn:hover {
            border-color: var(--accent);
        }

        .flag-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .error-message {
            display: none;
            padding: 12px;
            background: rgba(247, 118, 142, 0.1);
            border: 1px solid var(--red);
            border-radius: 8px;
            color: var(--red);
            margin-top: 12px;
            font-size: 0.9rem;
        }

        .error-message.visible {
            display: block;
        }

        .quick-inserts {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .quick-insert {
            padding: 5px 10px;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--cyan);
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .quick-insert:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .test-text-section {
            padding: 20px;
            border-top: 1px solid var(--border);
        }

        .test-text-label {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-bottom: 10px;
        }

        .test-text {
            width: 100%;
            min-height: 150px;
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 14px 16px;
            border-radius: 8px;
            color: var(--text);
            font-family: inherit;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical;
        }

        .test-text:focus {
            outline: none;
            border-color: var(--accent);
        }

        .highlighted-text {
            width: 100%;
            min-height: 150px;
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 14px 16px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .match {
            background: rgba(122, 162, 247, 0.3);
            color: var(--accent);
            border-radius: 2px;
            padding: 1px 2px;
        }

        .match.group-1 { background: rgba(187, 154, 247, 0.3); color: var(--accent2); }
        .match.group-2 { background: rgba(158, 206, 106, 0.3); color: var(--green); }
        .match.group-3 { background: rgba(224, 175, 104, 0.3); color: var(--yellow); }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .matches-panel, .explanation-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .panel-header {
            padding: 14px 18px;
            background: var(--surface2);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .match-count {
            background: var(--accent);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .panel-content {
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .matches-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .matches-table th {
            text-align: left;
            padding: 8px 10px;
            background: var(--surface2);
            color: var(--text-dim);
            font-weight: 500;
        }

        .matches-table td {
            padding: 8px 10px;
            border-top: 1px solid var(--border);
        }

        .matches-table .match-text {
            color: var(--cyan);
            font-family: inherit;
        }

        .matches-table .match-index {
            color: var(--text-dim);
        }

        .matches-table .match-groups {
            color: var(--accent2);
        }

        .explanation-list {
            list-style: none;
        }

        .explanation-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }

        .explanation-item:last-child {
            border-bottom: none;
        }

        .token {
            background: var(--bg);
            color: var(--cyan);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .explanation {
            color: var(--text-dim);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .no-matches {
            color: var(--text-dim);
            text-align: center;
            padding: 30px;
        }

        @media (max-width: 900px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="title">
                <h1><span>/</span>Regex<span>/</span> Lab</h1>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="sharePattern()" title="Share">üîó</button>
                <button class="icon-btn" onclick="clearAll()" title="Clear">üóëÔ∏è</button>
                <button class="icon-btn" onclick="toggleTheme()" title="Toggle theme">üåô</button>
            </div>
        </header>

        <div class="terminal-window">
            <div class="terminal-header">
                <div class="terminal-dot red"></div>
                <div class="terminal-dot yellow"></div>
                <div class="terminal-dot green"></div>
                <span class="terminal-title">regex-lab ‚Äî pattern builder</span>
            </div>
            <div class="pattern-section">
                <div class="pattern-input-row">
                    <span class="pattern-prefix">/</span>
                    <input type="text" class="pattern-input" id="patternInput" placeholder="Enter regex pattern..." value="\b\w+@\w+\.\w+\b">
                    <span class="pattern-suffix">/</span>
                </div>
                <div class="flags-row">
                    <button class="flag-btn active" data-flag="g" title="Global">g</button>
                    <button class="flag-btn" data-flag="i" title="Case insensitive">i</button>
                    <button class="flag-btn" data-flag="m" title="Multiline">m</button>
                    <button class="flag-btn" data-flag="s" title="Dotall">s</button>
                    <button class="flag-btn" data-flag="u" title="Unicode">u</button>
                    <button class="flag-btn" data-flag="y" title="Sticky">y</button>
                </div>
                <div class="error-message" id="errorMessage"></div>
                <div class="quick-inserts">
                    <button class="quick-insert" data-insert="\d" title="Digit">\d</button>
                    <button class="quick-insert" data-insert="\w" title="Word character">\w</button>
                    <button class="quick-insert" data-insert="\s" title="Whitespace">\s</button>
                    <button class="quick-insert" data-insert="[A-Z]" title="Uppercase letter">[A-Z]</button>
                    <button class="quick-insert" data-insert="[a-z]" title="Lowercase letter">[a-z]</button>
                    <button class="quick-insert" data-insert="[0-9]" title="Digit range">[0-9]</button>
                    <button class="quick-insert" data-insert="." title="Any character">.</button>
                    <button class="quick-insert" data-insert="^" title="Start of line">^</button>
                    <button class="quick-insert" data-insert="$" title="End of line">$</button>
                    <button class="quick-insert" data-insert="+" title="One or more">+</button>
                    <button class="quick-insert" data-insert="*" title="Zero or more">*</button>
                    <button class="quick-insert" data-insert="?" title="Optional">?</button>
                    <button class="quick-insert" data-insert="(?=...)" title="Positive lookahead">(?=)</button>
                    <button class="quick-insert" data-insert="(?!...)" title="Negative lookahead">(?!)</button>
                    <button class="quick-insert" data-insert="(...)" title="Capture group">()</button>
                    <button class="quick-insert" data-insert="(?:...)" title="Non-capture group">(?:)</button>
                </div>
            </div>
            <div class="test-text-section">
                <div class="test-text-label">Test Text</div>
                <textarea class="test-text" id="testText" placeholder="Enter text to test against...">Contact us at hello@example.com or support@company.org
You can also reach john.doe@email.co.uk for assistance.</textarea>
                <div class="test-text-label" style="margin-top: 15px;">Highlighted Matches</div>
                <div class="highlighted-text" id="highlightedText"></div>
            </div>
        </div>

        <div class="results-grid">
            <div class="matches-panel">
                <div class="panel-header">
                    <span>Matches</span>
                    <span class="match-count" id="matchCount">0</span>
                </div>
                <div class="panel-content" id="matchesContent">
                    <table class="matches-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Match</th>
                                <th>Index</th>
                                <th>Groups</th>
                            </tr>
                        </thead>
                        <tbody id="matchesTable"></tbody>
                    </table>
                </div>
            </div>
            <div class="explanation-panel">
                <div class="panel-header">
                    <span>Pattern Explanation</span>
                </div>
                <div class="panel-content">
                    <ul class="explanation-list" id="explanationList"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const tokenExplanations = {
            '\\d': 'Matches any digit (0-9)',
            '\\D': 'Matches any non-digit',
            '\\w': 'Matches word character (a-z, A-Z, 0-9, _)',
            '\\W': 'Matches non-word character',
            '\\s': 'Matches whitespace (space, tab, newline)',
            '\\S': 'Matches non-whitespace',
            '\\b': 'Word boundary',
            '\\B': 'Non-word boundary',
            '.': 'Matches any character (except newline)',
            '^': 'Start of string/line',
            '$': 'End of string/line',
            '*': 'Zero or more of preceding',
            '+': 'One or more of preceding',
            '?': 'Zero or one of preceding (optional)',
            '|': 'Alternation (OR)',
            '\\': 'Escape next character'
        };

        let currentFlags = 'g';

        function getFlags() {
            return Array.from(document.querySelectorAll('.flag-btn.active'))
                .map(btn => btn.dataset.flag)
                .join('');
        }

        function updateHighlights() {
            const pattern = document.getElementById('patternInput').value;
            const text = document.getElementById('testText').value;
            const errorEl = document.getElementById('errorMessage');
            const highlightEl = document.getElementById('highlightedText');
            const matchesTable = document.getElementById('matchesTable');
            const matchCount = document.getElementById('matchCount');

            errorEl.classList.remove('visible');
            document.getElementById('patternInput').classList.remove('error');

            if (!pattern) {
                highlightEl.textContent = text;
                matchesTable.innerHTML = '<tr><td colspan="4" class="no-matches">Enter a pattern</td></tr>';
                matchCount.textContent = '0';
                updateExplanation(pattern);
                return;
            }

            try {
                const flags = getFlags();
                const regex = new RegExp(pattern, flags);

                // Highlight matches
                let lastIndex = 0;
                let html = '';
                let matches = [];
                let match;

                const testRegex = new RegExp(pattern, flags.includes('g') ? flags : flags + 'g');
                while ((match = testRegex.exec(text)) !== null) {
                    if (match.index === testRegex.lastIndex) {
                        testRegex.lastIndex++;
                    }

                    html += escapeHtml(text.slice(lastIndex, match.index));
                    html += `<span class="match">${escapeHtml(match[0])}</span>`;
                    lastIndex = match.index + match[0].length;

                    matches.push({
                        full: match[0],
                        index: match.index,
                        groups: match.slice(1).filter(g => g !== undefined)
                    });
                }
                html += escapeHtml(text.slice(lastIndex));
                highlightEl.innerHTML = html;

                // Update matches table
                matchCount.textContent = matches.length;

                if (matches.length === 0) {
                    matchesTable.innerHTML = '<tr><td colspan="4" class="no-matches">No matches found</td></tr>';
                } else {
                    matchesTable.innerHTML = matches.map((m, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td class="match-text">${escapeHtml(m.full)}</td>
                            <td class="match-index">${m.index}</td>
                            <td class="match-groups">${m.groups.length > 0 ? m.groups.map(g => escapeHtml(g)).join(', ') : '-'}</td>
                        </tr>
                    `).join('');
                }

                updateExplanation(pattern);

            } catch (e) {
                errorEl.textContent = e.message;
                errorEl.classList.add('visible');
                document.getElementById('patternInput').classList.add('error');
                highlightEl.textContent = text;
                matchesTable.innerHTML = '<tr><td colspan="4" class="no-matches">Invalid pattern</td></tr>';
                matchCount.textContent = '0';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateExplanation(pattern) {
            const list = document.getElementById('explanationList');

            if (!pattern) {
                list.innerHTML = '<li class="no-matches">Enter a pattern to see explanation</li>';
                return;
            }

            const tokens = parsePattern(pattern);
            list.innerHTML = tokens.map(t => `
                <li class="explanation-item">
                    <span class="token">${escapeHtml(t.token)}</span>
                    <span class="explanation">${t.explanation}</span>
                </li>
            `).join('');
        }

        function parsePattern(pattern) {
            const tokens = [];
            let i = 0;

            while (i < pattern.length) {
                const remaining = pattern.slice(i);

                // Character classes
                if (remaining.match(/^\[.*?\]/)) {
                    const match = remaining.match(/^\[(\^)?(.+?)\]/);
                    if (match) {
                        tokens.push({
                            token: match[0],
                            explanation: match[1] ? `Match any character NOT in: ${match[2]}` : `Match any character in: ${match[2]}`
                        });
                        i += match[0].length;
                        continue;
                    }
                }

                // Groups
                if (remaining.match(/^\(\?[=!:]/)) {
                    if (remaining.startsWith('(?=')) {
                        tokens.push({ token: '(?=...)', explanation: 'Positive lookahead' });
                        i += 3;
                        continue;
                    }
                    if (remaining.startsWith('(?!')) {
                        tokens.push({ token: '(?!...)', explanation: 'Negative lookahead' });
                        i += 3;
                        continue;
                    }
                    if (remaining.startsWith('(?:')) {
                        tokens.push({ token: '(?:...)', explanation: 'Non-capturing group' });
                        i += 3;
                        continue;
                    }
                }

                if (remaining.startsWith('(')) {
                    tokens.push({ token: '(', explanation: 'Start capture group' });
                    i++;
                    continue;
                }

                if (remaining.startsWith(')')) {
                    tokens.push({ token: ')', explanation: 'End group' });
                    i++;
                    continue;
                }

                // Escape sequences
                if (remaining.startsWith('\\')) {
                    const escaped = remaining.slice(0, 2);
                    tokens.push({
                        token: escaped,
                        explanation: tokenExplanations[escaped] || `Escaped: ${escaped[1]}`
                    });
                    i += 2;
                    continue;
                }

                // Quantifiers
                if (remaining.match(/^\{(\d+)(,(\d*))?\}/)) {
                    const match = remaining.match(/^\{(\d+)(,(\d*))?\}/);
                    if (match[2] === undefined) {
                        tokens.push({ token: match[0], explanation: `Exactly ${match[1]} times` });
                    } else if (match[3] === '') {
                        tokens.push({ token: match[0], explanation: `${match[1]} or more times` });
                    } else {
                        tokens.push({ token: match[0], explanation: `Between ${match[1]} and ${match[3]} times` });
                    }
                    i += match[0].length;
                    continue;
                }

                // Single characters
                const char = pattern[i];
                if (tokenExplanations[char]) {
                    tokens.push({ token: char, explanation: tokenExplanations[char] });
                } else if (char.match(/[a-zA-Z0-9]/)) {
                    tokens.push({ token: char, explanation: `Literal: "${char}"` });
                } else {
                    tokens.push({ token: char, explanation: `Character: "${char}"` });
                }
                i++;
            }

            return tokens;
        }

        // Flag buttons
        document.querySelectorAll('.flag-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.classList.toggle('active');
                updateHighlights();
            });
        });

        // Quick inserts
        document.querySelectorAll('.quick-insert').forEach(btn => {
            btn.addEventListener('click', () => {
                const input = document.getElementById('patternInput');
                const insert = btn.dataset.insert.replace('...', '');
                const start = input.selectionStart;
                const end = input.selectionEnd;
                const value = input.value;

                input.value = value.slice(0, start) + insert + value.slice(end);
                input.focus();
                input.setSelectionRange(start + insert.length, start + insert.length);
                updateHighlights();
            });
        });

        // Input listeners
        document.getElementById('patternInput').addEventListener('input', updateHighlights);
        document.getElementById('testText').addEventListener('input', updateHighlights);

        function clearAll() {
            document.getElementById('patternInput').value = '';
            document.getElementById('testText').value = '';
            updateHighlights();
        }

        function sharePattern() {
            const pattern = document.getElementById('patternInput').value;
            const flags = getFlags();
            const text = document.getElementById('testText').value;

            const data = btoa(JSON.stringify({ pattern, flags, text }));
            const url = `${window.location.origin}${window.location.pathname}#${data}`;

            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        function loadFromHash() {
            if (window.location.hash) {
                try {
                    const data = JSON.parse(atob(window.location.hash.slice(1)));
                    document.getElementById('patternInput').value = data.pattern || '';
                    document.getElementById('testText').value = data.text || '';

                    // Set flags
                    document.querySelectorAll('.flag-btn').forEach(btn => {
                        btn.classList.toggle('active', data.flags.includes(btn.dataset.flag));
                    });

                    updateHighlights();
                } catch (e) {
                    console.error('Failed to load from hash');
                }
            }
        }

        function toggleTheme() {
            const theme = document.body.dataset.theme === 'light' ? '' : 'light';
            document.body.dataset.theme = theme;
            localStorage.setItem('regexLabTheme', theme);
        }

        // Initialize
        const savedTheme = localStorage.getItem('regexLabTheme');
        if (savedTheme) document.body.dataset.theme = savedTheme;

        loadFromHash();
        updateHighlights();
    </script>
</body>
</html>
