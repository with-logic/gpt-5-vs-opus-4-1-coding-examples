<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roman Tic Tac Toe</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F5F5DC;
            --marble: linear-gradient(135deg, #F0EDE5 0%, #E8E4DA 50%, #F5F2EC 100%);
            --gold: #D4AF37;
            --gold-dark: #B8960C;
            --text: #2C1810;
            --text-dim: #6B5B4F;
            --shadow: rgba(44, 24, 16, 0.2);
        }

        [data-theme="night"] {
            --bg: #1A1A2E;
            --marble: linear-gradient(135deg, #2D2D44 0%, #1F1F33 50%, #252538 100%);
            --gold: #FFD700;
            --gold-dark: #D4AF37;
            --text: #F0EDE5;
            --text-dim: #A09080;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cinzel', serif;
            background: var(--marble);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--text);
            transition: all 0.3s;
        }

        header {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 20px;
            background: var(--marble);
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-crest {
            font-size: 1.5rem;
        }

        .logo-text {
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 18px;
            background: var(--marble);
            border: 2px solid var(--gold);
            border-radius: 8px;
            color: var(--text);
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background: var(--gold);
            color: white;
        }

        .scoreboard {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
        }

        .score-item {
            text-align: center;
            padding: 15px 25px;
            background: var(--marble);
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--shadow);
            min-width: 80px;
        }

        .score-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .score-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gold);
        }

        .victory-banner {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: white;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .victory-banner.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            padding: 20px;
            background: var(--marble);
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow);
            max-width: 100%;
            width: min(90vmin, 400px);
        }

        .cell {
            aspect-ratio: 1;
            background: var(--marble);
            border: 3px solid var(--gold);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: min(15vmin, 4rem);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
        }

        .cell:hover:not(.taken) {
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.02);
        }

        .cell.taken {
            cursor: default;
        }

        .cell.winner {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: white;
            animation: winPulse 0.5s ease;
        }

        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .status {
            margin-top: 25px;
            font-size: 1.1rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--marble);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.3rem;
            letter-spacing: 2px;
        }

        .option-group {
            margin-bottom: 20px;
        }

        .option-label {
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .option-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .option-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px;
            background: transparent;
            border: 2px solid var(--gold);
            border-radius: 8px;
            color: var(--text);
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-btn:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .option-btn.selected {
            background: var(--gold);
            color: white;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 9999;
        }

        @media (max-width: 500px) {
            header {
                flex-direction: column;
                gap: 15px;
            }

            .scoreboard {
                gap: 20px;
            }

            .score-item {
                padding: 10px 15px;
                min-width: 60px;
            }

            .score-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <canvas id="confettiCanvas"></canvas>

    <header>
        <div class="logo">
            <span class="logo-crest">üèõÔ∏è</span>
            <span class="logo-text">SPQR</span>
        </div>
        <div class="header-buttons">
            <button class="btn" onclick="newRound()">New Round</button>
            <button class="btn" onclick="openCustomize()">Customize</button>
            <button class="btn" onclick="resetScores()">Reset</button>
        </div>
    </header>

    <div class="scoreboard">
        <div class="score-item">
            <div class="score-label" id="xLabel">X</div>
            <div class="score-value" id="xScore">0</div>
        </div>
        <div class="score-item">
            <div class="score-label">Draws</div>
            <div class="score-value" id="drawScore">0</div>
        </div>
        <div class="score-item">
            <div class="score-label" id="oLabel">O</div>
            <div class="score-value" id="oScore">0</div>
        </div>
    </div>

    <div class="victory-banner hidden" id="victoryBanner">Victory!</div>

    <div class="game-board" id="board" role="grid" aria-label="Tic Tac Toe board">
        <div class="cell" role="gridcell" tabindex="0" data-index="0" aria-label="Cell 1"></div>
        <div class="cell" role="gridcell" tabindex="0" data-index="1" aria-label="Cell 2"></div>
        <div class="cell" role="gridcell" tabindex="0" data-index="2" aria-label="Cell 3"></div>
        <div class="cell" role="gridcell" tabindex="0" data-index="3" aria-label="Cell 4"></div>
        <div class="cell" role="gridcell" tabindex="0" data-index="4" aria-label="Cell 5"></div>
        <div class="cell" role="gridcell" tabindex="0" data-index="5" aria-label="Cell 6"></div>
        <div class="cell" role="gridcell" tabindex="0" data-index="6" aria-label="Cell 7"></div>
        <div class="cell" role="gridcell" tabindex="0" data-index="7" aria-label="Cell 8"></div>
        <div class="cell" role="gridcell" tabindex="0" data-index="8" aria-label="Cell 9"></div>
    </div>

    <div class="status" id="status" role="status" aria-live="polite">X's turn</div>

    <div class="modal-overlay" id="customizeModal">
        <div class="modal">
            <h2>Customize Game</h2>

            <div class="option-group">
                <div class="option-label">Theme</div>
                <div class="option-buttons">
                    <button class="option-btn selected" data-option="theme" data-value="day">Marble Day</button>
                    <button class="option-btn" data-option="theme" data-value="night">Night Legion</button>
                </div>
            </div>

            <div class="option-group">
                <div class="option-label">Glyphs</div>
                <div class="option-buttons">
                    <button class="option-btn selected" data-option="glyphs" data-value="standard">X / O</button>
                    <button class="option-btn" data-option="glyphs" data-value="roman">‚öîÔ∏è / üèÜ</button>
                </div>
            </div>

            <div class="option-group">
                <div class="option-label">Game Mode</div>
                <div class="option-buttons">
                    <button class="option-btn selected" data-option="mode" data-value="2player">2 Players</button>
                    <button class="option-btn" data-option="mode" data-value="ai">vs AI</button>
                </div>
            </div>

            <div class="option-group">
                <div class="option-label">First Move</div>
                <div class="option-buttons">
                    <button class="option-btn selected" data-option="first" data-value="X">X</button>
                    <button class="option-btn" data-option="first" data-value="O">O</button>
                </div>
            </div>

            <div class="option-group">
                <div class="option-label">AI Discipline</div>
                <div class="option-buttons">
                    <button class="option-btn" data-option="ai" data-value="perfect">Perfect</button>
                    <button class="option-btn selected" data-option="ai" data-value="pragmatic">Pragmatic</button>
                    <button class="option-btn" data-option="ai" data-value="reckless">Reckless</button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn" onclick="closeCustomize()">Close</button>
                <button class="btn" onclick="applySettings()">Apply</button>
            </div>
        </div>
    </div>

    <script>
        const settings = {
            theme: 'day',
            glyphs: 'standard',
            mode: '2player',
            first: 'X',
            ai: 'pragmatic'
        };

        const glyphMap = {
            standard: { X: 'X', O: 'O' },
            roman: { X: '‚öîÔ∏è', O: 'üèÜ' }
        };

        let board = Array(9).fill(null);
        let currentPlayer = 'X';
        let gameOver = false;
        let scores = { X: 0, O: 0, draw: 0 };

        const winPatterns = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        const cells = document.querySelectorAll('.cell');

        cells.forEach(cell => {
            cell.addEventListener('click', () => handleMove(parseInt(cell.dataset.index)));
            cell.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleMove(parseInt(cell.dataset.index));
                }
            });
        });

        function handleMove(index) {
            if (gameOver || board[index]) return;
            if (settings.mode === 'ai' && currentPlayer === 'O') return;

            makeMove(index);

            if (!gameOver && settings.mode === 'ai' && currentPlayer === 'O') {
                setTimeout(aiMove, 500);
            }
        }

        function makeMove(index) {
            board[index] = currentPlayer;
            const glyph = glyphMap[settings.glyphs][currentPlayer];
            cells[index].textContent = glyph;
            cells[index].classList.add('taken');
            cells[index].setAttribute('aria-label', `Cell ${index + 1}: ${currentPlayer}`);

            const winner = checkWinner();
            if (winner) {
                endGame(winner);
            } else if (board.every(cell => cell)) {
                endGame('draw');
            } else {
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                updateStatus();
            }
        }

        function checkWinner() {
            for (const pattern of winPatterns) {
                const [a, b, c] = pattern;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return { player: board[a], pattern };
                }
            }
            return null;
        }

        function endGame(result) {
            gameOver = true;

            if (result === 'draw') {
                scores.draw++;
                document.getElementById('drawScore').textContent = scores.draw;
                document.getElementById('status').textContent = 'Draw!';
                document.getElementById('victoryBanner').textContent = 'Draw!';
            } else {
                scores[result.player]++;
                document.getElementById(result.player === 'X' ? 'xScore' : 'oScore').textContent = scores[result.player];
                document.getElementById('status').textContent = `${result.player} Wins!`;
                document.getElementById('victoryBanner').textContent = `${result.player} Victorious!`;

                // Highlight winning cells
                result.pattern.forEach(i => cells[i].classList.add('winner'));

                // Confetti
                if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                    createConfetti();
                }
            }

            document.getElementById('victoryBanner').classList.remove('hidden');
        }

        function updateStatus() {
            document.getElementById('status').textContent = `${currentPlayer}'s Turn`;
        }

        function newRound() {
            board = Array(9).fill(null);
            gameOver = false;
            currentPlayer = settings.first;

            cells.forEach((cell, i) => {
                cell.textContent = '';
                cell.classList.remove('taken', 'winner');
                cell.setAttribute('aria-label', `Cell ${i + 1}`);
            });

            document.getElementById('victoryBanner').classList.add('hidden');
            updateStatus();

            if (settings.mode === 'ai' && currentPlayer === 'O') {
                setTimeout(aiMove, 500);
            }
        }

        function resetScores() {
            scores = { X: 0, O: 0, draw: 0 };
            document.getElementById('xScore').textContent = '0';
            document.getElementById('oScore').textContent = '0';
            document.getElementById('drawScore').textContent = '0';
            newRound();
        }

        // AI Logic
        function aiMove() {
            if (gameOver) return;

            let move;
            const difficulty = settings.ai;

            if (difficulty === 'reckless' || (difficulty === 'pragmatic' && Math.random() < 0.3)) {
                // Random move
                const available = board.map((v, i) => v === null ? i : null).filter(v => v !== null);
                move = available[Math.floor(Math.random() * available.length)];
            } else {
                // Minimax
                move = findBestMove();
            }

            if (move !== undefined) {
                makeMove(move);
            }
        }

        function findBestMove() {
            let bestScore = -Infinity;
            let bestMove;

            for (let i = 0; i < 9; i++) {
                if (!board[i]) {
                    board[i] = 'O';
                    const score = minimax(board, 0, false);
                    board[i] = null;
                    if (score > bestScore) {
                        bestScore = score;
                        bestMove = i;
                    }
                }
            }
            return bestMove;
        }

        function minimax(board, depth, isMaximizing) {
            const winner = checkWinner();
            if (winner) {
                return winner.player === 'O' ? 10 - depth : depth - 10;
            }
            if (board.every(cell => cell)) return 0;

            if (isMaximizing) {
                let bestScore = -Infinity;
                for (let i = 0; i < 9; i++) {
                    if (!board[i]) {
                        board[i] = 'O';
                        bestScore = Math.max(bestScore, minimax(board, depth + 1, false));
                        board[i] = null;
                    }
                }
                return bestScore;
            } else {
                let bestScore = Infinity;
                for (let i = 0; i < 9; i++) {
                    if (!board[i]) {
                        board[i] = 'X';
                        bestScore = Math.min(bestScore, minimax(board, depth + 1, true));
                        board[i] = null;
                    }
                }
                return bestScore;
            }
        }

        // Confetti
        function createConfetti() {
            const canvas = document.getElementById('confettiCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const colors = ['#D4AF37', '#FFD700', '#B8960C', '#FFF8DC', '#F5DEB3'];

            for (let i = 0; i < 150; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 6 + 3,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    vx: Math.random() * 4 - 2,
                    vy: Math.random() * 3 + 2,
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 10 - 5
                });
            }

            let frame = 0;
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.rotation += p.rotationSpeed;

                    ctx.save();
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.rotation * Math.PI / 180);
                    ctx.fillStyle = p.color;
                    ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                    ctx.restore();
                });

                frame++;
                if (frame < 180) {
                    requestAnimationFrame(animate);
                } else {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }

            animate();
        }

        // Customize Modal
        function openCustomize() {
            document.getElementById('customizeModal').classList.add('active');
        }

        function closeCustomize() {
            document.getElementById('customizeModal').classList.remove('active');
        }

        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const option = btn.dataset.option;
                const siblings = document.querySelectorAll(`[data-option="${option}"]`);
                siblings.forEach(s => s.classList.remove('selected'));
                btn.classList.add('selected');
            });
        });

        function applySettings() {
            document.querySelectorAll('.option-btn.selected').forEach(btn => {
                settings[btn.dataset.option] = btn.dataset.value;
            });

            // Apply theme
            document.body.dataset.theme = settings.theme === 'night' ? 'night' : '';

            // Update labels
            const glyphs = glyphMap[settings.glyphs];
            document.getElementById('xLabel').textContent = glyphs.X;
            document.getElementById('oLabel').textContent = glyphs.O;

            closeCustomize();
            newRound();
        }

        // Initialize
        updateStatus();
    </script>
</body>
</html>
