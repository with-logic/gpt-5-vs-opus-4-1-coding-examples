<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regex Lab</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #1a1a1a;
            --panel-bg: #2d2d2d;
            --border-color: #444;
            --text-color: #e0e0e0;
            --text-muted: #999;
            --accent-color: #00ff88;
            --error-color: #ff4444;
            --warning-color: #ffaa00;
            --group-colors: #ff6b6b, #4ecdc4, #45b7d1, #f9ca24, #6c5ce7, #a0e7e5;
        }

        [data-theme="light"] {
            --bg-color: #f5f5f5;
            --panel-bg: #ffffff;
            --border-color: #ddd;
            --text-color: #333;
            --text-muted: #666;
        }

        body {
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            background: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }

        .terminal-window {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
        }

        .terminal-header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            justify-content: space-between;
        }

        .terminal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .terminal-dots {
            display: flex;
            gap: 5px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot.red { background: #ff5f57; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #28ca42; }

        .controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }

        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr;
            gap: 1px;
            background: var(--border-color);
        }

        .input-section {
            grid-column: 1 / -1;
            background: var(--panel-bg);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .pattern-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pattern-input {
            flex: 1;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
        }

        .pattern-input.error {
            border-color: var(--error-color);
        }

        .flags-container {
            display: flex;
            gap: 5px;
        }

        .flag-checkbox {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 12px;
        }

        .flag-checkbox input {
            accent-color: var(--accent-color);
        }

        .quick-inserts {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .quick-insert {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.2s;
        }

        .quick-insert:hover {
            background: var(--accent-color);
            color: var(--bg-color);
        }

        .test-text {
            width: 100%;
            height: 120px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 13px;
            resize: none;
        }

        .output-section {
            background: var(--panel-bg);
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .section-title {
            font-weight: bold;
            font-size: 14px;
            color: var(--accent-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }

        .highlighted-text {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .match {
            background: var(--accent-color);
            color: var(--bg-color);
            padding: 1px 3px;
            border-radius: 2px;
            font-weight: bold;
        }

        .group-0 { background: #ff6b6b; }
        .group-1 { background: #4ecdc4; }
        .group-2 { background: #45b7d1; }
        .group-3 { background: #f9ca24; }
        .group-4 { background: #6c5ce7; }
        .group-5 { background: #a0e7e5; }

        .matches-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .matches-table th,
        .matches-table td {
            border: 1px solid var(--border-color);
            padding: 5px 8px;
            text-align: left;
        }

        .matches-table th {
            background: var(--bg-color);
            font-weight: bold;
        }

        .matches-table tr:nth-child(even) {
            background: var(--bg-color);
        }

        .explanation {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            line-height: 1.4;
        }

        .error-message {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 5px;
        }

        .permalink {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }

        .permalink input {
            flex: 1;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 5px 8px;
            border-radius: 3px;
            font-family: inherit;
            font-size: 11px;
        }

        .copy-btn, .clear-btn {
            background: var(--accent-color);
            color: var(--bg-color);
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            font-family: inherit;
        }

        .clear-btn {
            background: var(--error-color);
        }

        .utility-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body data-theme="dark">
    <div class="terminal-window">
        <div class="terminal-header">
            <div class="terminal-title">
                <div class="terminal-dots">
                    <div class="dot red"></div>
                    <div class="dot yellow"></div>
                    <div class="dot green"></div>
                </div>
                <span>Regex Lab</span>
            </div>
            <div class="controls">
                <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</button>
            </div>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="pattern-input-group">
                    <input type="text" class="pattern-input" id="pattern" placeholder="Enter regex pattern..." value="(\w+)@(\w+\.\w+)">
                    <div class="flags-container">
                        <label class="flag-checkbox"><input type="checkbox" id="flag-g" checked> g</label>
                        <label class="flag-checkbox"><input type="checkbox" id="flag-i"> i</label>
                        <label class="flag-checkbox"><input type="checkbox" id="flag-m"> m</label>
                        <label class="flag-checkbox"><input type="checkbox" id="flag-s"> s</label>
                        <label class="flag-checkbox"><input type="checkbox" id="flag-u"> u</label>
                        <label class="flag-checkbox"><input type="checkbox" id="flag-y"> y</label>
                    </div>
                </div>
                <div id="error-message" class="error-message"></div>

                <div class="quick-inserts">
                    <span class="quick-insert" onclick="insertToken('\\d')">\d</span>
                    <span class="quick-insert" onclick="insertToken('\\w')">\w</span>
                    <span class="quick-insert" onclick="insertToken('\\s')">\s</span>
                    <span class="quick-insert" onclick="insertToken('[A-Z]')">[A-Z]</span>
                    <span class="quick-insert" onclick="insertToken('[0-9]')">[0-9]</span>
                    <span class="quick-insert" onclick="insertToken('(?=...)')">(?=...)</span>
                    <span class="quick-insert" onclick="insertToken('(?!...)')">(?!...)</span>
                    <span class="quick-insert" onclick="insertToken('(?<=...)')">(?<=...)</span>
                    <span class="quick-insert" onclick="insertToken('(?<!...)')">(?<!...)</span>
                    <span class="quick-insert" onclick="insertToken('(.*?)')">(.+?)</span>
                    <span class="quick-insert" onclick="insertToken('.*?')">.*?</span>
                    <span class="quick-insert" onclick="insertToken('.+?')">.+?</span>
                    <span class="quick-insert" onclick="insertToken('^')">^</span>
                    <span class="quick-insert" onclick="insertToken('$')">$</span>
                </div>

                <textarea class="test-text" id="testText" placeholder="Enter test text here...">john@example.com
jane.doe@company.org
test@domain.net
invalid-email
another@test.co.uk</textarea>

                <div class="utility-buttons">
                    <button class="clear-btn" onclick="clearAll()">Clear All</button>
                </div>

                <div class="permalink">
                    <input type="text" id="permalink" readonly placeholder="Permalink will appear here...">
                    <button class="copy-btn" onclick="copyPermalink()">Copy</button>
                </div>
            </div>

            <div class="output-section">
                <div class="section-title">Highlighted Matches</div>
                <div class="highlighted-text" id="highlightedText"></div>

                <div class="section-title">Pattern Explanation</div>
                <div class="explanation" id="explanation"></div>
            </div>

            <div class="output-section">
                <div class="section-title">Match Details</div>
                <table class="matches-table" id="matchesTable">
                    <thead>
                        <tr>
                            <th>Index</th>
                            <th>Match</th>
                            <th>Start</th>
                            <th>End</th>
                            <th>Groups</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let currentRegex = null;

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            body.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
        }

        function insertToken(token) {
            const patternInput = document.getElementById('pattern');
            const start = patternInput.selectionStart;
            const end = patternInput.selectionEnd;
            const currentValue = patternInput.value;
            
            patternInput.value = currentValue.substring(0, start) + token + currentValue.substring(end);
            patternInput.focus();
            patternInput.selectionStart = patternInput.selectionEnd = start + token.length;
            
            updateRegex();
        }

        function getFlags() {
            const flags = [];
            if (document.getElementById('flag-g').checked) flags.push('g');
            if (document.getElementById('flag-i').checked) flags.push('i');
            if (document.getElementById('flag-m').checked) flags.push('m');
            if (document.getElementById('flag-s').checked) flags.push('s');
            if (document.getElementById('flag-u').checked) flags.push('u');
            if (document.getElementById('flag-y').checked) flags.push('y');
            return flags.join('');
        }

        function explainPattern(pattern) {
            const explanations = {
                '\\d': 'any digit (0-9)',
                '\\D': 'any non-digit',
                '\\w': 'any word character (a-z, A-Z, 0-9, _)',
                '\\W': 'any non-word character',
                '\\s': 'any whitespace character',
                '\\S': 'any non-whitespace character',
                '.': 'any character except newline',
                '^': 'start of string/line',
                '$': 'end of string/line',
                '*': 'zero or more of the preceding',
                '+': 'one or more of the preceding',
                '?': 'zero or one of the preceding (optional)',
                '(?=': 'positive lookahead',
                '(?!': 'negative lookahead',
                '(?<=': 'positive lookbehind',
                '(?<!': 'negative lookbehind',
                '\\b': 'word boundary',
                '\\B': 'non-word boundary',
                '[': 'character class',
                '(': 'capturing group',
                '(?:': 'non-capturing group'
            };

            let explanation = '';
            let i = 0;
            
            while (i < pattern.length) {
                let found = false;
                
                // Check for multi-character tokens
                for (let len = 4; len >= 1; len--) {
                    const token = pattern.substr(i, len);
                    if (explanations[token]) {
                        if (explanation) explanation += ' + ';
                        explanation += `"${token}" (${explanations[token]})`;
                        i += len;
                        found = true;
                        break;
                    }
                }
                
                if (!found) {
                    if (explanation) explanation += ' + ';
                    explanation += `"${pattern[i]}" (literal)`;
                    i++;
                }
            }
            
            return explanation || 'Pattern explanation not available';
        }

        function updateRegex() {
            const pattern = document.getElementById('pattern').value;
            const flags = getFlags();
            const testText = document.getElementById('testText').value;
            const errorElement = document.getElementById('error-message');
            const patternInput = document.getElementById('pattern');
            
            errorElement.textContent = '';
            patternInput.classList.remove('error');

            if (!pattern) {
                clearOutputs();
                return;
            }

            try {
                currentRegex = new RegExp(pattern, flags);
                highlightMatches(testText, currentRegex);
                showMatchDetails(testText, currentRegex);
                showExplanation(pattern);
                updatePermalink(pattern, flags);
            } catch (error) {
                errorElement.textContent = `Invalid regex: ${error.message}`;
                patternInput.classList.add('error');
                clearOutputs();
            }
        }

        function highlightMatches(text, regex) {
            const highlightedElement = document.getElementById('highlightedText');
            
            if (!text) {
                highlightedElement.textContent = '';
                return;
            }

            let highlighted = text;
            const matches = [...text.matchAll(regex)];
            
            if (matches.length === 0) {
                highlightedElement.textContent = text;
                return;
            }

            // Process matches in reverse order to maintain indices
            for (let i = matches.length - 1; i >= 0; i--) {
                const match = matches[i];
                const fullMatch = match[0];
                const start = match.index;
                const end = start + fullMatch.length;
                
                // Highlight the full match
                const replacement = `<span class="match">${escapeHtml(fullMatch)}</span>`;
                highlighted = highlighted.slice(0, start) + replacement + highlighted.slice(end);
            }
            
            highlightedElement.innerHTML = highlighted;
        }

        function showMatchDetails(text, regex) {
            const tbody = document.querySelector('#matchesTable tbody');
            tbody.innerHTML = '';
            
            if (!text) return;

            const matches = [...text.matchAll(regex)];
            
            matches.forEach((match, index) => {
                const row = document.createElement('tr');
                
                const groups = match.slice(1).map((group, i) => 
                    group !== undefined ? `$${i + 1}: "${group}"` : `$${i + 1}: undefined`
                ).join(', ') || 'None';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>"${escapeHtml(match[0])}"</td>
                    <td>${match.index}</td>
                    <td>${match.index + match[0].length}</td>
                    <td>${groups}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function showExplanation(pattern) {
            const explanationElement = document.getElementById('explanation');
            explanationElement.textContent = explainPattern(pattern);
        }

        function updatePermalink(pattern, flags) {
            const encoded = btoa(JSON.stringify({ pattern, flags }));
            const permalink = `${window.location.origin}${window.location.pathname}#${encoded}`;
            document.getElementById('permalink').value = permalink;
        }

        function copyPermalink() {
            const permalinkInput = document.getElementById('permalink');
            permalinkInput.select();
            document.execCommand('copy');
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 1000);
        }

        function clearAll() {
            document.getElementById('pattern').value = '';
            document.getElementById('testText').value = '';
            // Uncheck all flags
            document.querySelectorAll('.flag-checkbox input').forEach(cb => cb.checked = false);
            clearOutputs();
        }

        function clearOutputs() {
            document.getElementById('highlightedText').textContent = '';
            document.getElementById('explanation').textContent = '';
            document.getElementById('permalink').value = '';
            document.querySelector('#matchesTable tbody').innerHTML = '';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function loadFromHash() {
            const hash = window.location.hash.slice(1);
            if (!hash) return;
            
            try {
                const { pattern, flags } = JSON.parse(atob(hash));
                document.getElementById('pattern').value = pattern;
                
                // Set flags
                document.getElementById('flag-g').checked = flags.includes('g');
                document.getElementById('flag-i').checked = flags.includes('i');
                document.getElementById('flag-m').checked = flags.includes('m');
                document.getElementById('flag-s').checked = flags.includes('s');
                document.getElementById('flag-u').checked = flags.includes('u');
                document.getElementById('flag-y').checked = flags.includes('y');
                
                updateRegex();
            } catch (error) {
                console.error('Failed to load from hash:', error);
            }
        }

        // Event listeners
        document.getElementById('pattern').addEventListener('input', updateRegex);
        document.getElementById('testText').addEventListener('input', updateRegex);
        document.querySelectorAll('.flag-checkbox input').forEach(checkbox => {
            checkbox.addEventListener('change', updateRegex);
        });

        // Initialize
        window.addEventListener('load', () => {
            loadFromHash();
            updateRegex();
        });

        window.addEventListener('hashchange', loadFromHash);
    </script>
</body>
</html>