<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jumpy Jumper!</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: #87CEEB;
            touch-action: none;
        }

        #gameCanvas {
            display: block;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            pointer-events: none;
        }

        #startScreen, #gameOverScreen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
        }

        h1 { font-size: 60px; margin: 0 0 20px 0; color: #FFD700; text-shadow: 4px 4px 0 #FF6347; }
        
        button {
            padding: 15px 40px;
            font-size: 24px;
            background: #FF6347;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 6px 0 #b71c1c;
            transition: transform 0.1s;
        }

        button:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #b71c1c;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="ui">
        Score: <span id="scoreVal">0</span><br>
        High Score: <span id="highScoreVal">0</span>
    </div>

    <div id="startScreen">
        <h1>Jumpy Jumper!</h1>
        <p>Press Space, Up, or Tap to Jump!</p>
        <button onclick="startGame()">Start Game</button>
    </div>

    <div id="gameOverScreen" class="hidden">
        <h1>Ouch!</h1>
        <p>Score: <span id="finalScore">0</span></p>
        <button onclick="startGame()">Try Again</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let width, height;
        let animationId;
        let gameSpeed = 5;
        let score = 0;
        let highScore = localStorage.getItem('jumpyHighScore') || 0;
        document.getElementById('highScoreVal').textContent = highScore;
        let frame = 0;

        // Audio Context
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'jump') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'hit') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // Game Objects
        const player = {
            x: 50,
            y: 0,
            width: 50,
            height: 50,
            dy: 0,
            jumpPower: -15,
            grounded: false,
            color: '#FFD700',
            emoji: 'ðŸ¤ª'
        };

        let obstacles = [];
        let particles = [];
        let clouds = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            player.y = height - 150; // Ground level
        }
        window.addEventListener('resize', resize);
        resize();

        // Input
        function jump() {
            if (player.grounded) {
                player.dy = player.jumpPower;
                player.grounded = false;
                playSound('jump');
                // Particles
                for(let i=0; i<5; i++) {
                    particles.push({
                        x: player.x + 25,
                        y: player.y + 50,
                        vx: (Math.random() - 0.5) * 5,
                        vy: Math.random() * 2,
                        life: 20,
                        color: '#fff'
                    });
                }
            }
        }

        window.addEventListener('keydown', e => {
            if (e.code === 'Space' || e.code === 'ArrowUp') jump();
        });
        window.addEventListener('touchstart', (e) => {
            e.preventDefault();
            jump();
        });
        window.addEventListener('mousedown', jump);


        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            
            player.y = height - 150;
            player.dy = 0;
            obstacles = [];
            score = 0;
            gameSpeed = 6;
            frame = 0;
            
            // Init Clouds
            clouds = [];
            for(let i=0; i<5; i++) {
                clouds.push({
                    x: Math.random() * width,
                    y: Math.random() * (height/2),
                    scale: 0.5 + Math.random() * 0.5
                });
            }

            loop();
        }

        function spawnObstacle() {
            const size = 40 + Math.random() * 30;
            const type = Math.random() > 0.5 ? 'cactus' : 'rock';
            obstacles.push({
                x: width,
                y: height - 100 - size,
                width: size,
                height: size,
                type: type
            });
        }

        function update() {
            frame++;
            score++;
            document.getElementById('scoreVal').textContent = Math.floor(score/10);
            
            // Increase speed
            if (frame % 500 === 0) gameSpeed += 0.5;

            // Player Physics
            player.dy += 0.8; // Gravity
            player.y += player.dy;

            // Ground Collision
            const groundY = height - 100 - player.height;
            if (player.y > groundY) {
                player.y = groundY;
                player.dy = 0;
                player.grounded = true;
            }

            // Clouds (Parallax)
            clouds.forEach(c => {
                c.x -= gameSpeed * 0.2;
                if(c.x < -100) c.x = width + 100;
            });

            // Obstacles
            if (frame % Math.floor(1000/gameSpeed * (0.8 + Math.random())) === 0) {
                spawnObstacle();
            }

            for (let i = obstacles.length - 1; i >= 0; i--) {
                let ob = obstacles[i];
                ob.x -= gameSpeed;

                // Collision
                if (
                    player.x < ob.x + ob.width &&
                    player.x + player.width > ob.x &&
                    player.y < ob.y + ob.height &&
                    player.y + player.height > ob.y
                ) {
                    gameOver();
                    return;
                }

                if (ob.x + ob.width < 0) obstacles.splice(i, 1);
            }

            // Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                if(p.life <= 0) particles.splice(i, 1);
            }
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);

            // Sky
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, "#87CEEB");
            gradient.addColorStop(1, "#E0F7FA");
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // Clouds
            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
            clouds.forEach(c => {
                ctx.beginPath();
                ctx.arc(c.x, c.y, 30 * c.scale, 0, Math.PI * 2);
                ctx.arc(c.x + 25*c.scale, c.y - 10*c.scale, 35*c.scale, 0, Math.PI * 2);
                ctx.arc(c.x + 50*c.scale, c.y, 30*c.scale, 0, Math.PI * 2);
                ctx.fill();
            });

            // Ground
            ctx.fillStyle = "#8BC34A";
            ctx.fillRect(0, height - 100, width, 100);
            ctx.fillStyle = "#689F38"; // Grass trim
            ctx.fillRect(0, height - 100, width, 10);

            // Obstacles
            obstacles.forEach(ob => {
                if (ob.type === 'cactus') {
                    ctx.fillStyle = "#2E7D32";
                    // Simple cactus shape
                    ctx.fillRect(ob.x + ob.width/3, ob.y, ob.width/3, ob.height);
                    ctx.fillRect(ob.x, ob.y + ob.height/3, ob.width, ob.height/4);
                } else {
                    ctx.fillStyle = "#795548";
                    ctx.beginPath();
                    ctx.arc(ob.x + ob.width/2, ob.y + ob.height/2, ob.width/2, 0, Math.PI*2);
                    ctx.fill();
                }
            });

            // Player
            // Rotate based on jump
            ctx.save();
            ctx.translate(player.x + player.width/2, player.y + player.height/2);
            if(!player.grounded) ctx.rotate(frame * 0.1);
            ctx.font = '50px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(player.emoji, 0, 0);
            ctx.restore();

            // Particles
            ctx.fillStyle = "#fff";
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 5, 0, Math.PI*2);
                ctx.fill();
            });
        }

        function loop() {
            if (document.getElementById('gameOverScreen').classList.contains('hidden') && 
                document.getElementById('startScreen').classList.contains('hidden')) {
                update();
                draw();
                animationId = requestAnimationFrame(loop);
            }
        }

        function gameOver() {
            playSound('hit');
            const finalScore = Math.floor(score/10);
            if (finalScore > highScore) {
                highScore = finalScore;
                localStorage.setItem('jumpyHighScore', highScore);
                document.getElementById('highScoreVal').textContent = highScore;
            }
            document.getElementById('finalScore').textContent = finalScore;
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

    </script>
</body>
</html>
