<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Theory Trainer</title>
    <style>
        body {
            background-color: #222;
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 { margin-bottom: 20px; color: #ffcc00; text-shadow: 0 0 10px #ffcc00; }

        .piano-container {
            position: relative;
            background: #111;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .keys {
            display: flex;
            position: relative;
        }

        .key {
            width: 50px;
            height: 200px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 0 0 5px 5px;
            margin: 0 2px;
            cursor: pointer;
            position: relative;
            z-index: 1;
            transition: background 0.1s;
        }

        .key:active, .key.active {
            background: #eee;
            transform: translateY(2px);
        }

        .key.black {
            width: 30px;
            height: 120px;
            background: black;
            position: absolute;
            top: 0;
            z-index: 2;
            margin: 0;
            border: 1px solid #000;
        }

        .key.black:active, .key.black.active {
            background: #333;
        }

        /* Positioning Black Keys */
        /* C# */ .key[data-note="C#4"] { left: 35px; }
        /* D# */ .key[data-note="D#4"] { left: 90px; }
        /* F# */ .key[data-note="F#4"] { left: 200px; }
        /* G# */ .key[data-note="G#4"] { left: 255px; }
        /* A# */ .key[data-note="A#4"] { left: 310px; }

        /* Controls */
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        button {
            padding: 10px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #444;
            color: white;
            transition: background 0.2s;
        }

        button:hover { background: #666; }
        
        button.primary {
            background: #ffcc00;
            color: #000;
            font-weight: bold;
        }
        
        button.primary:hover { background: #e6b800; }

        .status {
            margin-top: 20px;
            font-size: 1.5rem;
            height: 1.5em;
        }

    </style>
</head>
<body>

    <h1>Music Theory Trainer</h1>

    <div class="piano-container">
        <div class="keys">
            <!-- White Keys -->
            <div class="key" data-note="C4"></div>
            <div class="key" data-note="D4"></div>
            <div class="key" data-note="E4"></div>
            <div class="key" data-note="F4"></div>
            <div class="key" data-note="G4"></div>
            <div class="key" data-note="A4"></div>
            <div class="key" data-note="B4"></div>
            <div class="key" data-note="C5"></div>

            <!-- Black Keys -->
            <div class="key black" data-note="C#4"></div>
            <div class="key black" data-note="D#4"></div>
            <div class="key black" data-note="F#4"></div>
            <div class="key black" data-note="G#4"></div>
            <div class="key black" data-note="A#4"></div>
        </div>
    </div>

    <div class="status" id="statusText">Play a note...</div>

    <div class="controls">
        <button class="primary" onclick="startEarTraining()">Ear Training: Guess Note</button>
        <button onclick="playScale()">Play C Major Scale</button>
        <button onclick="playChord()">Play C Major Chord</button>
    </div>

    <script>
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        const frequencies = {
            "C4": 261.63, "C#4": 277.18, "D4": 293.66, "D#4": 311.13,
            "E4": 329.63, "F4": 349.23, "F#4": 369.99, "G4": 392.00,
            "G#4": 415.30, "A4": 440.00, "A#4": 466.16, "B4": 493.88,
            "C5": 523.25
        };

        let targetNote = null;
        const statusEl = document.getElementById('statusText');

        function playTone(freq, duration = 0.5) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'triangle';
            osc.frequency.value = freq;
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function handleNote(note) {
            const freq = frequencies[note];
            playTone(freq);
            
            // Visual feedback
            const key = document.querySelector(`.key[data-note="${note}"]`);
            if (key) {
                key.classList.add('active');
                setTimeout(() => key.classList.remove('active'), 200);
            }

            // Game Logic
            if (targetNote) {
                if (note === targetNote) {
                    statusEl.textContent = `Correct! It was ${targetNote}.`;
                    statusEl.style.color = '#4cd964';
                    targetNote = null;
                } else {
                    statusEl.textContent = `Try again.`;
                    statusEl.style.color = '#ff3b30';
                }
            } else {
                statusEl.textContent = note;
                statusEl.style.color = '#fff';
            }
        }

        // Piano Interaction
        document.querySelectorAll('.key').forEach(k => {
            k.addEventListener('mousedown', () => handleNote(k.dataset.note));
        });

        // Exercises
        function startEarTraining() {
            const notes = Object.keys(frequencies);
            targetNote = notes[Math.floor(Math.random() * notes.length)];
            statusEl.textContent = "Listen...";
            statusEl.style.color = '#ffcc00';
            
            setTimeout(() => {
                playTone(frequencies[targetNote], 1);
                setTimeout(() => {
                    statusEl.textContent = "Which note was it?";
                }, 1000);
            }, 500);
        }

        function playScale() {
            const scale = ["C4", "D4", "E4", "F4", "G4", "A4", "B4", "C5"];
            let i = 0;
            const interval = setInterval(() => {
                if (i >= scale.length) {
                    clearInterval(interval);
                    return;
                }
                handleNote(scale[i]);
                i++;
            }, 300);
        }

        function playChord() {
            // C Major: C-E-G
            handleNote("C4");
            setTimeout(() => handleNote("E4"), 100);
            setTimeout(() => handleNote("G4"), 200);
        }

    </script>
</body>
</html>
