<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Music Theory Trainer</title>
    <style>
      :root {
        color-scheme: light;
        --bg: radial-gradient(circle at top, #1b1d3d, #090912);
        --panel: rgba(255, 255, 255, 0.06);
        --accent: #f8b400;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Space Grotesk", system-ui, sans-serif;
        background: var(--bg);
        color: #fefefe;
        min-height: 100vh;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }
      header {
        text-align: center;
      }
      main {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }
      section {
        background: var(--panel);
        border-radius: 1.5rem;
        padding: 1.5rem;
        backdrop-filter: blur(10px);
      }
      .keyboard {
        position: relative;
        display: flex;
        margin-top: 1rem;
      }
      .white {
        width: 40px;
        height: 200px;
        background: #fff;
        border: 1px solid #ccc;
        position: relative;
        cursor: pointer;
      }
      .white.active {
        background: var(--accent);
      }
      .black {
        width: 24px;
        height: 120px;
        background: #111;
        position: absolute;
        left: 28px;
        top: 0;
        z-index: 2;
        border-radius: 0 0 4px 4px;
        cursor: pointer;
      }
      .black.active {
        background: #f45b69;
      }
      .ear-options {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .ear-options button,
      select,
      button {
        font: inherit;
        border-radius: 999px;
        border: none;
        padding: 0.6rem 1rem;
        cursor: pointer;
      }
      button.primary {
        background: var(--accent);
        color: #1b1d3d;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Music Theory Trainer</h1>
      <p>Play notes, visualize scales, and sharpen your ears.</p>
    </header>
    <main>
      <section>
        <h2>Interactive Piano</h2>
        <label>Highlight scale
          <select id="scale">
            <option value="C">C major</option>
            <option value="G">G major</option>
            <option value="A minor">A minor</option>
          </select>
        </label>
        <div class="keyboard" id="keyboard"></div>
      </section>
      <section>
        <h2>Ear training</h2>
        <button class="primary" id="playNote">Play a note</button>
        <p id="earFeedback"></p>
        <div class="ear-options" id="earOptions"></div>
        <p>Score: <span id="earScore">0</span></p>
      </section>
    </main>

    <script>
      const notes = [
        { name: "C", freq: 261.63, type: "white" },
        { name: "C#", freq: 277.18, type: "black" },
        { name: "D", freq: 293.66, type: "white" },
        { name: "D#", freq: 311.13, type: "black" },
        { name: "E", freq: 329.63, type: "white" },
        { name: "F", freq: 349.23, type: "white" },
        { name: "F#", freq: 369.99, type: "black" },
        { name: "G", freq: 392.0, type: "white" },
        { name: "G#", freq: 415.3, type: "black" },
        { name: "A", freq: 440.0, type: "white" },
        { name: "A#", freq: 466.16, type: "black" },
        { name: "B", freq: 493.88, type: "white" },
      ];

      const keyboard = document.getElementById("keyboard");
      const scaleSelect = document.getElementById("scale");
      const ctxAudio = new (window.AudioContext || window.webkitAudioContext)();
      function playFreq(freq) {
        const osc = ctxAudio.createOscillator();
        const gain = ctxAudio.createGain();
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.001, ctxAudio.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.2, ctxAudio.currentTime + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.001, ctxAudio.currentTime + 0.6);
        osc.connect(gain).connect(ctxAudio.destination);
        osc.start();
        osc.stop(ctxAudio.currentTime + 0.6);
      }

      notes.forEach((note, idx) => {
        if (note.type === "white") {
          const key = document.createElement("div");
          key.className = "white";
          key.textContent = note.name;
          key.addEventListener("mousedown", () => {
            playFreq(note.freq);
            key.classList.add("active");
          });
          key.addEventListener("mouseup", () => key.classList.remove("active"));
          keyboard.appendChild(key);
          const sharp = notes[idx + 1];
          if (sharp && sharp.type === "black") {
            const blackKey = document.createElement("div");
            blackKey.className = "black";
            blackKey.style.left = `${keyboard.children.length * 40 - 16}px`;
            blackKey.textContent = sharp.name;
            blackKey.addEventListener("mousedown", () => {
              playFreq(sharp.freq);
              blackKey.classList.add("active");
            });
            blackKey.addEventListener("mouseup", () => blackKey.classList.remove("active"));
            keyboard.appendChild(blackKey);
          }
        }
      });

      const scales = {
        C: ["C", "D", "E", "F", "G", "A", "B"],
        G: ["G", "A", "B", "C", "D", "E", "F#"],
        "A minor": ["A", "B", "C", "D", "E", "F", "G"],
      };

      function highlightScale() {
        const selected = scaleSelect.value;
        document.querySelectorAll(".white, .black").forEach((key) => key.classList.remove("active"));
        scales[selected].forEach((noteName) => {
          const key = Array.from(keyboard.children).find((child) => child.textContent === noteName);
          if (key) key.classList.add("active");
        });
      }
      scaleSelect.addEventListener("change", highlightScale);
      highlightScale();

      const playNoteBtn = document.getElementById("playNote");
      const earOptions = document.getElementById("earOptions");
      const earFeedback = document.getElementById("earFeedback");
      const earScore = document.getElementById("earScore");
      let challenge;
      let score = 0;
      function newChallenge() {
        challenge = notes[Math.floor(Math.random() * notes.length)];
        playFreq(challenge.freq);
        earFeedback.textContent = "Which note did you hear?";
      }
      playNoteBtn.addEventListener("click", newChallenge);

      notes.filter((note) => note.type === "white").forEach((note) => {
        const btn = document.createElement("button");
        btn.textContent = note.name;
        btn.addEventListener("click", () => {
          if (!challenge) return;
          if (btn.textContent === challenge.name.replace("#", "#")) {
            earFeedback.textContent = "Correct!";
            score += 1;
          } else {
            earFeedback.textContent = `It was ${challenge.name}`;
            score = Math.max(0, score - 1);
          }
          earScore.textContent = score;
          challenge = null;
        });
        earOptions.appendChild(btn);
      });
    </script>
  </body>
</html>
